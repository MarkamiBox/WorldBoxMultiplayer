=== START OF SOURCE 2 ===



// --- Start of File: DelayedAction.cs ---
using System;

public class DelayedAction
{
	public readonly Action action;

	private bool _game_speed_affected;

	private float _timer;

	public DelayedAction(Action pAction, float pDelay, bool pGameSpeedAffected)
	{
		action = pAction;
		_game_speed_affected = pGameSpeedAffected;
		_timer = pDelay;
	}

	public bool update(float pElapsed, float pDeltaTime)
	{
		if (_game_speed_affected)
		{
			_timer -= pElapsed;
		}
		else
		{
			_timer -= pDeltaTime;
		}
		if (_timer > 0f)
		{
			return false;
		}
		action();
		return true;
	}
}
// --- End of File: DelayedAction.cs ---



// --- Start of File: DelayedActionsManager.cs ---
using System;
using System.Collections.Generic;

public class DelayedActionsManager
{
	private List<DelayedAction> _delayed_actions = new List<DelayedAction>();

	private List<DelayedAction> _to_remove = new List<DelayedAction>();

	public void update(float pElapsed, float pDeltaTime)
	{
		for (int i = 0; i < _delayed_actions.Count; i++)
		{
			DelayedAction delayedAction = _delayed_actions[i];
			if (delayedAction.update(pElapsed, pDeltaTime))
			{
				_to_remove.Add(delayedAction);
			}
		}
		for (int j = 0; j < _to_remove.Count; j++)
		{
			DelayedAction item = _to_remove[j];
			_delayed_actions.Remove(item);
		}
		_to_remove.Clear();
	}

	public static void addAction(Action pAction, float pDelay, bool pGameSpeed = true)
	{
		MapBox.instance.delayed_actions_manager.addActionInstance(pAction, pDelay, pGameSpeed);
	}

	private void addActionInstance(Action pAction, float pDelay, bool pGameSpeed = true)
	{
		DelayedAction item = new DelayedAction(pAction, pDelay, pGameSpeed);
		_delayed_actions.Add(item);
	}

	public void clear()
	{
		_delayed_actions.Clear();
		_to_remove.Clear();
	}
}
// --- End of File: DelayedActionsManager.cs ---



// --- Start of File: DelegateConverter.cs ---
using System;
using Newtonsoft.Json;

public class DelegateConverter : JsonConverter
{
	public override void WriteJson(JsonWriter pWriter, object pValue, JsonSerializer pSerializer)
	{
		if (pValue != null)
		{
			Delegate[] invocationList = ((Delegate)pValue).GetInvocationList();
			string[] array = new string[invocationList.Length];
			for (int i = 0; i < invocationList.Length; i++)
			{
				array[i] = invocationList[i].Method.DeclaringType?.ToString() + "." + invocationList[i].Method.Name;
			}
			pSerializer.Serialize(pWriter, (object)array, typeof(string[]));
		}
	}

	public override object ReadJson(JsonReader pReader, Type pObjectType, object pExistingValue, JsonSerializer pSerializer)
	{
		return null;
	}

	public override bool CanConvert(Type pObjectType)
	{
		if (pObjectType != null)
		{
			if (!(pObjectType == typeof(Delegate)))
			{
				return pObjectType.IsSubclassOf(typeof(Delegate));
			}
			return true;
		}
		return false;
	}
}
// --- End of File: DelegateConverter.cs ---



// --- Start of File: DelegateExtensions.cs ---
using System;

public static class DelegateExtensions
{
	public static string AsString<T>(this T pDelegate) where T : Delegate
	{
		if (pDelegate == null)
		{
			return "";
		}
		using ListPool<string> listPool = new ListPool<string>(pDelegate.GetInvocationList().Length);
		Delegate[] invocationList = pDelegate.GetInvocationList();
		for (int i = 0; i < invocationList.Length; i++)
		{
			T val = (T)invocationList[i];
			listPool.Add(val.Method.Name);
		}
		return string.Join(", ", listPool.ToArray());
	}
}
// --- End of File: DelegateExtensions.cs ---



// --- Start of File: DeleteMapQueue.cs ---
using System;

[Serializable]
public class DeleteMapQueue : QueueItem
{
	public string username;

	public string userId;

	public string reason;

	public string error;

	public string status;

	public string mapId;
}
// --- End of File: DeleteMapQueue.cs ---



// --- Start of File: DeleteWorldButton.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class DeleteWorldButton : MonoBehaviour
{
	private void Start()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Expected O, but got Unknown
		Button val = default(Button);
		if (((Component)this).TryGetComponent<Button>(ref val))
		{
			((UnityEvent)val.onClick).AddListener(new UnityAction(deleteWorld));
		}
	}

	private void deleteWorld()
	{
		ScrollWindow.showWindow("save_delete_confirm");
	}
}
// --- End of File: DeleteWorldButton.cs ---



// --- Start of File: DepthGeneratorType.cs ---
public enum DepthGeneratorType
{
	Generator,
	Gameplay
}
// --- End of File: DepthGeneratorType.cs ---



// --- Start of File: Derp.cs ---
public class Derp : GenericType
{
}
// --- End of File: Derp.cs ---



// --- Start of File: DiagonalMovement.cs ---
namespace EpPathFinding.cs;

public enum DiagonalMovement
{
	Always,
	Never,
	IfAtLeastOneWalkable,
	OnlyWhenNoObstacles
}
// --- End of File: DiagonalMovement.cs ---



// --- Start of File: DictionaryExtensions.cs ---
using System;
using System.Collections.Generic;

public static class DictionaryExtensions
{
	public static int RemoveByValue<TKey, TValue>(this IDictionary<TKey, TValue> pDict, Predicate<TValue> pPredicate)
	{
		using ListPool<TKey> listPool = new ListPool<TKey>(pDict.Count);
		foreach (KeyValuePair<TKey, TValue> item in pDict)
		{
			if (pPredicate(item.Value))
			{
				listPool.Add(item.Key);
			}
		}
		foreach (ref TKey item2 in listPool)
		{
			TKey current2 = item2;
			pDict.Remove(current2);
		}
		return listPool.Count;
	}

	public static int RemoveByKey<TKey, TValue>(this IDictionary<TKey, TValue> pDict, Predicate<TKey> pPredicate)
	{
		using ListPool<TKey> listPool = new ListPool<TKey>(pDict.Count);
		foreach (TKey key in pDict.Keys)
		{
			if (pPredicate(key))
			{
				listPool.Add(key);
			}
		}
		foreach (ref TKey item in listPool)
		{
			TKey current2 = item;
			pDict.Remove(current2);
		}
		return listPool.Count;
	}
}
// --- End of File: DictionaryExtensions.cs ---



// --- Start of File: DiplomacyHelpers.cs ---
public static class DiplomacyHelpers
{
	public static WarManager wars => World.world.wars;

	public static DiplomacyManager diplomacy => World.world.diplomacy;

	public static bool isWarNeeded(Kingdom pKingdom)
	{
		if (!pKingdom.hasCities())
		{
			return false;
		}
		if (!pKingdom.hasCapital())
		{
			return false;
		}
		if (pKingdom.data.timestamp_last_war != -1.0 && Date.getYearsSince(pKingdom.data.timestamp_last_war) <= SimGlobals.m.diplomacy_years_war_timeout)
		{
			return false;
		}
		if (wars.hasWars(pKingdom))
		{
			return false;
		}
		if (pKingdom.countTotalWarriors() <= SimGlobals.m.diplomacy_years_war_min_warriors)
		{
			return false;
		}
		float num = pKingdom.getPopulationPeople();
		float num2 = pKingdom.getPopulationTotalPossible();
		if (pKingdom.countCities() < 4 && num < num2 * 0.6f)
		{
			return false;
		}
		return true;
	}

	public static Kingdom getWarTarget(Kingdom pInitiatorKingdom)
	{
		Kingdom result = null;
		float num = float.MaxValue;
		int num2 = pInitiatorKingdom.countTotalWarriors();
		if (pInitiatorKingdom.hasAlliance())
		{
			num2 = pInitiatorKingdom.getAlliance().countWarriors();
		}
		using ListPool<Kingdom> listPool = wars.getNeutralKingdoms(pInitiatorKingdom);
		foreach (ref Kingdom item in listPool)
		{
			Kingdom current = item;
			if (!current.hasCities() || !current.hasCapital() || current.getAge() < SimGlobals.m.minimum_kingdom_age_for_attack)
			{
				continue;
			}
			int num3 = 0;
			num3 = ((!current.hasAlliance()) ? current.countTotalWarriors() : current.getAlliance().countWarriors());
			if (num2 >= num3 && pInitiatorKingdom.capital.reachableFrom(current.capital) && !((float)Date.getYearsSince(diplomacy.getRelation(pInitiatorKingdom, current).data.timestamp_last_war_ended) < (float)SimGlobals.m.minimum_years_between_wars) && !pInitiatorKingdom.isOpinionTowardsKingdomGood(current))
			{
				float num4 = Kingdom.distanceBetweenKingdom(pInitiatorKingdom, current);
				if (num4 < num)
				{
					num = num4;
					result = current;
				}
			}
		}
		return result;
	}

	public static Kingdom getAllianceTarget(Kingdom pKingdomStarter)
	{
		if (pKingdomStarter.isSupreme())
		{
			return null;
		}
		using ListPool<Kingdom> listPool = World.world.wars.getNeutralKingdoms(pKingdomStarter, pOnlyWithoutWars: true, pOnlyWithoutAlliances: true);
		if (listPool.Count == 0)
		{
			return null;
		}
		foreach (Kingdom item in listPool.LoopRandom())
		{
			if (item.hasKing() && !item.isSupreme() && !item.king.hasPlot() && pKingdomStarter.isOpinionTowardsKingdomGood(item) && item.getRenown() >= PlotsLibrary.alliance_create.min_renown_kingdom)
			{
				bool flag = false;
				if (pKingdomStarter.countCities() <= 2 && item.countCities() <= 2 && !pKingdomStarter.hasNearbyKingdoms() && !item.hasNearbyKingdoms())
				{
					flag = true;
				}
				if (!flag && areKingdomsClose(item, pKingdomStarter))
				{
					flag = true;
				}
				if (flag)
				{
					return item;
				}
			}
		}
		return null;
	}

	public static bool areKingdomsClose(Kingdom pMain, Kingdom pTarget)
	{
		foreach (City city in pMain.getCities())
		{
			foreach (City city2 in pTarget.getCities())
			{
				if (City.nearbyBorders(city, city2))
				{
					return true;
				}
			}
		}
		return false;
	}

	public static bool isThereActiveCityConquest(Kingdom pKingdom, Kingdom pTargetKingdom)
	{
		foreach (City city in pKingdom.getCities())
		{
			if (city.isGettingCapturedBy(pTargetKingdom))
			{
				return true;
			}
		}
		foreach (City city2 in pTargetKingdom.getCities())
		{
			if (city2.isGettingCapturedBy(pKingdom))
			{
				return true;
			}
		}
		return false;
	}

	public static bool isThereFightBetween(Kingdom pKingdom1, Kingdom pKingdom2)
	{
		if (isThereActiveCityFight(pKingdom1, pKingdom2))
		{
			return true;
		}
		if (isThereActiveCityFight(pKingdom2, pKingdom1))
		{
			return true;
		}
		return false;
	}

	private static bool isThereActiveCityFight(Kingdom pDefenderKingdom, Kingdom pAttackerKingdom)
	{
		foreach (City city in pDefenderKingdom.getCities())
		{
			if (!city.hasArmy())
			{
				continue;
			}
			Army army = city.army;
			if (army.hasCaptain())
			{
				Actor captain = army.getCaptain();
				if (captain.current_tile.hasCity() && captain.current_tile.zone_city.kingdom == pAttackerKingdom)
				{
					return true;
				}
			}
		}
		return false;
	}

	public static bool areDefendersGettingCaptured(this War pWar)
	{
		foreach (Kingdom defender in pWar.getDefenders())
		{
			if (defender.isGettingCaptured())
			{
				return true;
			}
		}
		return false;
	}

	public static bool areAttackersGettingCaptured(this War pWar)
	{
		foreach (Kingdom attacker in pWar.getAttackers())
		{
			if (attacker.isGettingCaptured())
			{
				return true;
			}
		}
		return false;
	}

	public static bool areAttackersAttackingAnotherCity(this War pWar)
	{
		foreach (Kingdom attacker in pWar.getAttackers())
		{
			if (attacker.isAttackingAnotherCity())
			{
				return true;
			}
		}
		return false;
	}

	public static bool areDefendersAttackingAnotherCity(this War pWar)
	{
		foreach (Kingdom defender in pWar.getDefenders())
		{
			if (defender.isAttackingAnotherCity())
			{
				return true;
			}
		}
		return false;
	}

	public static bool isAttackingAnotherCity(this Kingdom pAttackerKingdom)
	{
		foreach (City city in pAttackerKingdom.getCities())
		{
			if (!city.hasArmy())
			{
				continue;
			}
			Army army = city.army;
			if (army.hasCaptain())
			{
				Actor captain = army.getCaptain();
				if (captain.current_tile.hasCity() && captain.current_tile.zone_city.kingdom.isEnemy(pAttackerKingdom))
				{
					return true;
				}
			}
		}
		return false;
	}
}
// --- End of File: DiplomacyHelpers.cs ---



// --- Start of File: DiplomacyHelpersRebellion.cs ---
public static class DiplomacyHelpersRebellion
{
	public static void startRebellion(Actor pActor, Plot pPlot, bool pCheckForHappiness)
	{
		City city = pActor.city;
		Kingdom kingdom = city.kingdom;
		if (pActor.isCityLeader())
		{
			pActor.city.removeLeader();
		}
		Kingdom kingdom2 = city.makeOwnKingdom(pActor, pRebellion: true);
		using ListPool<City> listPool = new ListPool<City>();
		listPool.Add(city);
		pActor.joinCity(city);
		War war = null;
		foreach (War war2 in kingdom.getWars())
		{
			if (war2.isMainAttacker(kingdom) && war2.getAsset() == WarTypeLibrary.rebellion)
			{
				war = war2;
				war.joinDefenders(kingdom2);
				break;
			}
		}
		if (war == null)
		{
			war = World.world.diplomacy.startWar(kingdom, kingdom2, WarTypeLibrary.rebellion);
			if (kingdom.hasAlliance())
			{
				foreach (Kingdom item in kingdom.getAlliance().kingdoms_hashset)
				{
					if (item != kingdom && item.isOpinionTowardsKingdomGood(kingdom))
					{
						war.joinAttackers(item);
					}
				}
			}
		}
		foreach (Actor unit in pPlot.units)
		{
			City city2 = unit.city;
			if (city2 != null && city2.kingdom != kingdom2 && city2.kingdom == kingdom)
			{
				city2.joinAnotherKingdom(kingdom2, pCaptured: false, pRebellion: true);
			}
		}
		int num = kingdom.countCities();
		int maxCities = kingdom2.getMaxCities();
		maxCities -= listPool.Count;
		if (maxCities < 0)
		{
			maxCities = 0;
		}
		if (maxCities > num / 3)
		{
			maxCities = (int)((float)num / 3f);
		}
		for (int i = 0; i < maxCities; i++)
		{
			if (!checkMoreAlignedCities(kingdom2, kingdom, listPool, pCheckForHappiness))
			{
				break;
			}
		}
	}

	public static bool checkMoreAlignedCities(Kingdom pNewKingdom, Kingdom pOldKingdom, ListPool<City> pNewCities, bool pCheckForHappiness)
	{
		using ListPool<City> listPool = new ListPool<City>(World.world.cities.Count);
		addNeighbourCities(listPool, pNewCities);
		if (listPool.Count == 0)
		{
			listPool.AddRange(pOldKingdom.getCities());
		}
		if (listPool.Count == 0)
		{
			return false;
		}
		foreach (City item in listPool.LoopRandom())
		{
			if (item.kingdom == pOldKingdom && !item.isCapitalCity() && (!pCheckForHappiness || !item.isHappy()) && !Randy.randomBool())
			{
				item.joinAnotherKingdom(pNewKingdom, pCaptured: false, pRebellion: true);
				return true;
			}
		}
		return true;
	}

	private static void addNeighbourCities(ListPool<City> pTempCitiesToCheck, ListPool<City> pRebelledCities)
	{
		foreach (ref City pRebelledCity in pRebelledCities)
		{
			pRebelledCity.recalculateNeighbourCities();
		}
		foreach (ref City pRebelledCity2 in pRebelledCities)
		{
			City current = pRebelledCity2;
			pTempCitiesToCheck.AddRange(current.neighbours_cities);
		}
	}
}
// --- End of File: DiplomacyHelpersRebellion.cs ---



// --- Start of File: DiplomacyManager.cs ---
using System.Collections.Generic;
using UnityEngine;

public class DiplomacyManager : CoreSystemManager<DiplomacyRelation, DiplomacyRelationData>
{
	public static Kingdom kingdom_supreme;

	public static Kingdom kingdom_second;

	public static List<Kingdom> superpowers = new List<Kingdom>();

	private float diplomacyTick;

	private static List<Kingdom> _kingdom_sorter = new List<Kingdom>();

	private static List<DiplomacyRelation> _relations_remover = new List<DiplomacyRelation>();

	protected readonly Dictionary<string, DiplomacyRelation> _dict = new Dictionary<string, DiplomacyRelation>();

	public DiplomacyManager()
	{
		type_id = "diplomacy";
	}

	public override List<DiplomacyRelationData> save(List<DiplomacyRelation> pList = null)
	{
		List<DiplomacyRelationData> list = new List<DiplomacyRelationData>();
		using IEnumerator<DiplomacyRelation> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			DiplomacyRelation current = enumerator.Current;
			current.kingdom1 = World.world.kingdoms.get(current.data.kingdom1_id);
			current.kingdom2 = World.world.kingdoms.get(current.data.kingdom2_id);
			if (current.kingdom1 != null && current.kingdom2 != null)
			{
				list.Add(current.data);
			}
		}
		return list;
	}

	public override void loadFromSave(List<DiplomacyRelationData> pList)
	{
		for (int i = 0; i < pList.Count; i++)
		{
			DiplomacyRelationData diplomacyRelationData = pList[i];
			Kingdom kingdom = World.world.kingdoms.get(diplomacyRelationData.kingdom1_id);
			Kingdom kingdom2 = World.world.kingdoms.get(diplomacyRelationData.kingdom2_id);
			if (kingdom != null && kingdom2 != null)
			{
				if (diplomacyRelationData.id == -1)
				{
					diplomacyRelationData.id = World.world.map_stats.getNextId(type_id);
				}
				loadObject(diplomacyRelationData);
			}
		}
	}

	public override DiplomacyRelation loadObject(DiplomacyRelationData pData)
	{
		Kingdom kingdom = World.world.kingdoms.get(pData.kingdom1_id);
		Kingdom kingdom2 = World.world.kingdoms.get(pData.kingdom2_id);
		pData.rel_id = pData.kingdom1_id + "_" + pData.kingdom2_id;
		DiplomacyRelation diplomacyRelation = base.loadObject(pData);
		_dict.Add(pData.rel_id, diplomacyRelation);
		diplomacyRelation.kingdom1 = kingdom;
		diplomacyRelation.kingdom2 = kingdom2;
		return diplomacyRelation;
	}

	public override void update(float pElapsed)
	{
		base.update(pElapsed);
		if (!World.world.isPaused())
		{
			if (diplomacyTick > 0f)
			{
				diplomacyTick -= pElapsed;
			}
			else if (!World.world.cities.isLocked())
			{
				diplomacyTick = 2f;
				newDiplomacyTick();
			}
		}
	}

	public void newDiplomacyTick()
	{
		findSupremeKingdom();
		checkAchievements();
	}

	private void checkAchievements()
	{
		AchievementLibrary.world_war.check();
	}

	private void findSupremeKingdom()
	{
		kingdom_supreme = null;
		kingdom_second = null;
		if (World.world.kingdoms.Count != 0)
		{
			List<Kingdom> kingdom_sorter = _kingdom_sorter;
			kingdom_sorter.AddRange(World.world.kingdoms);
			for (int i = 0; i < kingdom_sorter.Count; i++)
			{
				Kingdom kingdom = kingdom_sorter[i];
				kingdom.power = kingdom.countTotalWarriors() * 2 + kingdom.countCities() * 5 + 1;
			}
			kingdom_sorter.Sort(sortByPower);
			kingdom_supreme = kingdom_sorter[0];
			if (kingdom_sorter.Count > 1)
			{
				kingdom_second = kingdom_sorter[1];
			}
			else
			{
				kingdom_second = null;
			}
			kingdom_sorter.Clear();
		}
	}

	public int sortByPower(Kingdom o1, Kingdom o2)
	{
		return o2.power.CompareTo(o1.power);
	}

	private War startTotalWar(Kingdom pAttacker, WarTypeAsset pType)
	{
		if (World.world.kingdoms.Count == 1)
		{
			return null;
		}
		foreach (War war in pAttacker.getWars())
		{
			if (war.isMainAttacker(pAttacker) && war.isTotalWar())
			{
				return null;
			}
		}
		if (pAttacker.hasAlliance())
		{
			pAttacker.getAlliance().leave(pAttacker);
		}
		War result = World.world.wars.newWar(pAttacker, null, pType);
		using ListPool<War> listPool = new ListPool<War>(pAttacker.getWars());
		foreach (ref War item in listPool)
		{
			War current2 = item;
			if (current2.isTotalWar())
			{
				continue;
			}
			if (current2.isAttacker(pAttacker))
			{
				if (!current2.isMainAttacker(pAttacker))
				{
					current2.leaveWar(pAttacker);
				}
				else
				{
					World.world.wars.endWar(current2, WarWinner.Merged);
				}
			}
			else if (current2.isDefender(pAttacker))
			{
				if (!current2.isMainDefender(pAttacker))
				{
					current2.leaveWar(pAttacker);
				}
				else
				{
					current2.lostWar(pAttacker);
				}
			}
		}
		WorldLog.logNewTotalWar(pAttacker);
		return result;
	}

	internal War startWar(Kingdom pAttacker, Kingdom pDefender, WarTypeAsset pAsset, bool pLog = true)
	{
		if (pAsset.total_war)
		{
			return startTotalWar(pAttacker, pAsset);
		}
		if (pAttacker == pDefender)
		{
			return null;
		}
		if (World.world.wars.getWar(pAttacker, pDefender) != null)
		{
			return null;
		}
		if (pLog)
		{
			WorldLog.logNewWar(pAttacker, pDefender);
		}
		War war = World.world.wars.newWar(pAttacker, pDefender, pAsset);
		if (pAsset.alliance_join)
		{
			Alliance alliance = pAttacker.getAlliance();
			Alliance alliance2 = pDefender.getAlliance();
			if (alliance != null)
			{
				foreach (Kingdom item in alliance.kingdoms_hashset)
				{
					war.joinAttackers(item);
				}
			}
			if (alliance2 != null)
			{
				foreach (Kingdom item2 in alliance2.kingdoms_hashset)
				{
					war.joinDefenders(item2);
				}
			}
		}
		return war;
	}

	public void eventSpite(Kingdom pKingdom)
	{
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		if (World.world.kingdoms.Count <= 1)
		{
			return;
		}
		using ListPool<Kingdom> listPool = new ListPool<Kingdom>(World.world.kingdoms.Count);
		War war = startWar(pKingdom, null, WarTypeLibrary.spite);
		if (war == null)
		{
			return;
		}
		pKingdom.affectKingByPowers();
		listPool.AddRange(war.getAttackers());
		listPool.AddRange(war.getDefenders());
		foreach (ref Kingdom item in listPool)
		{
			EffectsLibrary.highlightKingdomZones(item, Color.red);
		}
	}

	public void eventFriendship(Kingdom pKingdom)
	{
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		War randomWarFor = World.world.wars.getRandomWarFor(pKingdom);
		if (randomWarFor == null)
		{
			return;
		}
		using ListPool<Kingdom> listPool = new ListPool<Kingdom>(World.world.kingdoms.Count);
		if (randomWarFor.isTotalWar() || randomWarFor.isMainAttacker(pKingdom) || randomWarFor.isMainDefender(pKingdom))
		{
			listPool.AddRange(randomWarFor.getAttackers());
			listPool.AddRange(randomWarFor.getDefenders());
		}
		Alliance alliance = pKingdom.getAlliance();
		if (alliance == null)
		{
			randomWarFor.leaveWar(pKingdom);
			listPool.Add(pKingdom);
			pKingdom.affectKingByPowers();
		}
		else
		{
			foreach (Kingdom item in alliance.kingdoms_hashset)
			{
				randomWarFor.leaveWar(item);
				listPool.Add(item);
				item.affectKingByPowers();
			}
		}
		if (randomWarFor.isTotalWar())
		{
			World.world.wars.endWar(randomWarFor, WarWinner.Peace);
		}
		foreach (ref Kingdom item2 in listPool)
		{
			EffectsLibrary.highlightKingdomZones(item2, Color.green);
		}
	}

	public KingdomOpinion getOpinion(Kingdom k1, Kingdom k2)
	{
		return getRelation(k1, k2).getOpinion(k1, k2);
	}

	public int sortID(Kingdom o1, Kingdom o2)
	{
		return o1.id.CompareTo(o2.id);
	}

	public DiplomacyRelation getRelation(Kingdom pK1, Kingdom pK2)
	{
		Kingdom kingdom;
		Kingdom kingdom2;
		if (pK1.id.CompareTo(pK2.id) > 0)
		{
			kingdom = pK1;
			kingdom2 = pK2;
		}
		else
		{
			kingdom = pK2;
			kingdom2 = pK1;
		}
		string text = kingdom.id + "_" + kingdom2.id;
		if (tryGet(text, out var pObject))
		{
			return pObject;
		}
		pObject = newObject();
		pObject.data.rel_id = text;
		_dict.Add(text, pObject);
		pObject.data.kingdom1_id = kingdom.id;
		pObject.data.kingdom2_id = kingdom2.id;
		pObject.kingdom1 = kingdom;
		pObject.kingdom2 = kingdom2;
		return pObject;
	}

	public void removeRelationsFor(Kingdom pKingdom)
	{
		using (IEnumerator<DiplomacyRelation> enumerator = GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				DiplomacyRelation current = enumerator.Current;
				if (current.kingdom1 == pKingdom || current.kingdom2 == pKingdom)
				{
					_relations_remover.Add(current);
				}
			}
		}
		foreach (DiplomacyRelation item in _relations_remover)
		{
			removeObject(item);
		}
		_relations_remover.Clear();
	}

	public bool tryGet(string pID, out DiplomacyRelation pObject)
	{
		return _dict.TryGetValue(pID, out pObject);
	}

	public DiplomacyRelation get(string pID)
	{
		if (string.IsNullOrEmpty(pID))
		{
			return null;
		}
		tryGet(pID, out var pObject);
		return pObject;
	}

	public override void removeObject(DiplomacyRelation pObject)
	{
		_dict.Remove(pObject.data.rel_id);
		base.removeObject(pObject);
	}

	public override void clear()
	{
		diplomacyTick = 0f;
		kingdom_supreme = null;
		kingdom_second = null;
		_dict.Clear();
		base.clear();
	}
}
// --- End of File: DiplomacyManager.cs ---



// --- Start of File: DiplomacyRelation.cs ---
using System;
using UnityEngine;

public class DiplomacyRelation : CoreSystemObject<DiplomacyRelationData>
{
	public Kingdom kingdom1;

	public Kingdom kingdom2;

	internal KingdomOpinion opinion_k1;

	internal KingdomOpinion opinion_k2;

	public override BaseSystemManager manager => World.world.diplomacy;

	protected sealed override void setDefaultValues()
	{
		base.setDefaultValues();
	}

	public KingdomOpinion getOpinion(Kingdom pMain, Kingdom pTarget)
	{
		recalculate(pMain, pTarget);
		if (opinion_k1.target == pTarget)
		{
			return opinion_k1;
		}
		return opinion_k2;
	}

	private void recalculate(Kingdom k1 = null, Kingdom k2 = null)
	{
		if (opinion_k1 == null)
		{
			opinion_k1 = new KingdomOpinion(kingdom1, kingdom2);
			opinion_k2 = new KingdomOpinion(kingdom2, kingdom1);
		}
		try
		{
			opinion_k1.calculate(kingdom1, kingdom2, this);
			opinion_k2.calculate(kingdom2, kingdom1, this);
		}
		catch (Exception ex)
		{
			Debug.LogError((object)ex);
			Debug.LogError((object)data.id);
			Debug.LogError((object)data.kingdom1_id);
			Debug.LogError((object)data.kingdom2_id);
			Debug.LogError((object)("kingdom1 " + (kingdom1 == null)));
			Debug.LogError((object)("kingdom2 " + (kingdom2 == null)));
			Debug.LogError((object)(kingdom1 == k1).ToString());
			Debug.LogError((object)(kingdom2 == k2).ToString());
			Debug.LogError((object)JsonUtility.ToJson((object)kingdom1));
			Debug.LogError((object)JsonUtility.ToJson((object)kingdom2));
			Debug.LogError((object)JsonUtility.ToJson((object)k1));
			Debug.LogError((object)JsonUtility.ToJson((object)k2));
			throw ex;
		}
	}

	public override void Dispose()
	{
		opinion_k1?.Dispose();
		opinion_k2?.Dispose();
		opinion_k1 = null;
		opinion_k2 = null;
		kingdom1 = null;
		kingdom2 = null;
		base.Dispose();
	}
}
// --- End of File: DiplomacyRelation.cs ---



// --- Start of File: DiplomacyRelationData.cs ---
public class DiplomacyRelationData : BaseSystemData
{
	public string rel_id;

	public long kingdom1_id;

	public long kingdom2_id;

	public double timestamp_last_war_ended;
}
// --- End of File: DiplomacyRelationData.cs ---



// --- Start of File: DiplomacyState.cs ---
public enum DiplomacyState
{
	War,
	Ally,
	Clear
}
// --- End of File: DiplomacyState.cs ---



// --- Start of File: DisasterAction.cs ---
using System;

[Serializable]
public delegate void DisasterAction(DisasterAsset pAsset);
// --- End of File: DisasterAction.cs ---



// --- Start of File: DisasterAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class DisasterAsset : Asset
{
	public DisasterAction action;

	public int rate = 1;

	public float chance = 1f;

	public string world_log;

	public int min_world_population;

	public int min_world_cities;

	public bool premium_only;

	public DisasterType type = DisasterType.Other;

	public string spawn_asset_unit = string.Empty;

	public string spawn_asset_building = string.Empty;

	public int max_existing_units = 20;

	public int units_min = 1;

	public int units_max = 10;

	public HashSet<string> ages_allow = new HashSet<string>();

	public HashSet<string> ages_forbid = new HashSet<string>();
}
// --- End of File: DisasterAsset.cs ---



// --- Start of File: DisasterLibrary.cs ---
using Beebyte.Obfuscator;

[ObfuscateLiterals]
public class DisasterLibrary : AssetLibrary<DisasterAsset>
{
	public override void init()
	{
		base.init();
		add(new DisasterAsset
		{
			id = "tornado",
			rate = 3,
			chance = 0.5f,
			min_world_cities = 3,
			world_log = "disaster_tornado",
			min_world_population = 100,
			type = DisasterType.Nature
		});
		t.ages_allow.Add("age_tears");
		t.ages_allow.Add("age_ash");
		t.ages_allow.Add("age_chaos");
		t.ages_allow.Add("age_wonders");
		t.ages_allow.Add("age_moon");
		t.action = spawnTornado;
		add(new DisasterAsset
		{
			id = "heatwave",
			rate = 4,
			chance = 0.5f,
			world_log = "disaster_heatwave",
			premium_only = false,
			type = DisasterType.Nature
		});
		t.ages_allow.Add("age_sun");
		t.action = spawnHeatwave;
		add(new DisasterAsset
		{
			id = "small_meteorite",
			rate = 5,
			chance = 0.5f,
			world_log = "disaster_meteorite",
			min_world_population = 400,
			min_world_cities = 3,
			premium_only = true,
			type = DisasterType.Nature
		});
		t.ages_forbid.Add("age_hope");
		t.ages_forbid.Add("age_sun");
		t.action = spawnMeteorite;
		add(new DisasterAsset
		{
			id = "small_earthquake",
			rate = 3,
			chance = 0.4f,
			world_log = "disaster_earthquake",
			min_world_population = 400,
			min_world_cities = 5,
			type = DisasterType.Nature
		});
		t.ages_forbid.Add("age_hope");
		t.ages_forbid.Add("age_sun");
		t.action = spawnSmallEarthquake;
		add(new DisasterAsset
		{
			id = "hellspawn",
			rate = 2,
			chance = 0.9f,
			min_world_cities = 5,
			world_log = "disaster_hellspawn",
			min_world_population = 300,
			premium_only = true,
			spawn_asset_unit = "demon",
			max_existing_units = 5,
			units_min = 2,
			units_max = 5
		});
		t.ages_allow.Add("age_chaos");
		t.action = simpleUnitAssetSpawnUsingIslands;
		add(new DisasterAsset
		{
			id = "ice_ones_awoken",
			rate = 2,
			chance = 0.9f,
			min_world_cities = 5,
			world_log = "disaster_ice_ones",
			min_world_population = 300,
			premium_only = true,
			spawn_asset_unit = "cold_one",
			max_existing_units = 5,
			units_min = 10,
			units_max = 20
		});
		t.ages_allow.Add("age_despair");
		t.ages_allow.Add("age_ice");
		t.action = simpleUnitAssetSpawnUsingIslands;
		add(new DisasterAsset
		{
			id = "sudden_snowman",
			rate = 3,
			chance = 0.9f,
			min_world_cities = 5,
			world_log = "disaster_sudden_snowman",
			min_world_population = 100,
			spawn_asset_unit = "snowman",
			max_existing_units = 5,
			units_min = 20,
			units_max = 40
		});
		t.ages_allow.Add("age_ice");
		t.action = simpleUnitAssetSpawnUsingIslands;
		add(new DisasterAsset
		{
			id = "garden_surprise",
			rate = 1,
			chance = 0.9f,
			min_world_cities = 5,
			world_log = "disaster_garden_surprise",
			min_world_population = 800,
			spawn_asset_building = "super_pumpkin",
			spawn_asset_unit = "lil_pumpkin",
			max_existing_units = 5,
			units_min = 50,
			units_max = 100
		});
		t.ages_allow.Add("age_sun");
		t.ages_allow.Add("age_wonders");
		t.action = gardenSurprise;
		add(new DisasterAsset
		{
			id = "dragon_from_farlands",
			rate = 1,
			chance = 0.9f,
			min_world_cities = 10,
			world_log = "disaster_dragon_from_farlands",
			min_world_population = 3000,
			spawn_asset_unit = "dragon",
			max_existing_units = 1,
			units_min = 1,
			units_max = 1
		});
		t.ages_allow.Add("age_chaos");
		t.ages_allow.Add("age_dark");
		t.ages_allow.Add("age_despair");
		t.action = spawnDragon;
		add(new DisasterAsset
		{
			id = "ash_bandits",
			rate = 1,
			chance = 0.9f,
			min_world_cities = 10,
			world_log = "disaster_bandits",
			min_world_population = 700,
			spawn_asset_unit = "bandit",
			max_existing_units = 10,
			units_min = 15,
			units_max = 30
		});
		t.ages_allow.Add("age_ash");
		t.action = simpleUnitAssetSpawnUsingIslands;
		add(new DisasterAsset
		{
			id = "alien_invasion",
			rate = 1,
			chance = 0.9f,
			min_world_cities = 10,
			world_log = "disaster_alien_invasion",
			min_world_population = 1500,
			spawn_asset_unit = "UFO",
			max_existing_units = 1,
			units_min = 5,
			units_max = 10
		});
		t.ages_allow.Add("age_moon");
		t.action = startAlienInvasion;
		add(new DisasterAsset
		{
			id = "biomass",
			rate = 1,
			chance = 0.9f,
			min_world_cities = 10,
			world_log = "disaster_biomass",
			min_world_population = 700,
			spawn_asset_building = "biomass",
			spawn_asset_unit = "bioblob",
			max_existing_units = 10,
			units_min = 20,
			units_max = 30
		});
		t.ages_allow.Add("age_ash");
		t.action = spawnBiomass;
		add(new DisasterAsset
		{
			id = "tumor",
			rate = 1,
			chance = 0.9f,
			min_world_cities = 10,
			world_log = "disaster_tumor",
			min_world_population = 700,
			spawn_asset_building = "tumor",
			spawn_asset_unit = "tumor_monster_unit",
			max_existing_units = 10,
			units_min = 20,
			units_max = 30
		});
		t.ages_allow.Add("age_moon");
		t.action = spawnTumor;
		add(new DisasterAsset
		{
			id = "wild_mage",
			rate = 1,
			chance = 0.8f,
			world_log = "disaster_evil_mage",
			min_world_population = 400,
			min_world_cities = 5,
			premium_only = true,
			max_existing_units = 1,
			spawn_asset_unit = "evil_mage",
			units_min = 1,
			units_max = 1
		});
		t.ages_forbid.Add("age_hope");
		t.action = spawnEvilMage;
		add(new DisasterAsset
		{
			id = "underground_necromancer",
			rate = 2,
			chance = 0.9f,
			world_log = "disaster_underground_necromancer",
			min_world_population = 200,
			min_world_cities = 4,
			premium_only = true,
			spawn_asset_unit = "necromancer",
			max_existing_units = 1,
			units_min = 1,
			units_max = 1
		});
		t.ages_allow.Add("age_dark");
		t.ages_allow.Add("age_despair");
		t.action = spawnNecromancer;
		add(new DisasterAsset
		{
			id = "mad_thoughts",
			rate = 2,
			chance = 0.7f,
			world_log = "disaster_mad_thoughts",
			min_world_cities = 5,
			min_world_population = 150
		});
		t.ages_forbid.Add("age_hope");
		t.ages_forbid.Add("age_wonders");
		t.action = spawnMadThought;
		add(new DisasterAsset
		{
			id = "greg_abominations",
			rate = 1,
			chance = 0.5f,
			world_log = "disaster_greg_abominations",
			min_world_population = 1000,
			min_world_cities = 3,
			spawn_asset_unit = "greg",
			max_existing_units = 1,
			units_min = 30,
			units_max = 55
		});
		t.ages_allow.Add("age_despair");
		t.action = spawnGreg;
	}

	public DisasterAsset getRandomAssetFromPool()
	{
		using ListPool<DisasterAsset> listPool = new ListPool<DisasterAsset>();
		for (int i = 0; i < list.Count; i++)
		{
			DisasterAsset disasterAsset = list[i];
			if ((disasterAsset.ages_allow.Count <= 0 || disasterAsset.ages_allow.Contains(World.world_era.id)) && (disasterAsset.ages_forbid.Count <= 0 || !disasterAsset.ages_forbid.Contains(World.world_era.id)))
			{
				for (int j = 0; j < disasterAsset.rate; j++)
				{
					listPool.Add(disasterAsset);
				}
			}
		}
		if (listPool.Count == 0)
		{
			return null;
		}
		DisasterAsset random = listPool.GetRandom();
		if (random.type == DisasterType.Nature)
		{
			if (!WorldLawLibrary.world_law_disasters_nature.isEnabled())
			{
				return null;
			}
		}
		else if (random.type == DisasterType.Other && !WorldLawLibrary.world_law_disasters_other.isEnabled())
		{
			return null;
		}
		if (random.min_world_cities > World.world.cities.Count)
		{
			return null;
		}
		if (random.min_world_population > World.world.units.Count)
		{
			return null;
		}
		return random;
	}

	public void spawnMadThought(DisasterAsset pAsset)
	{
		City random = World.world.cities.getRandom();
		if (random == null || random.getPopulationPeople() < 50 || random.getTile() == null)
		{
			return;
		}
		using ListPool<Actor> listPool = new ListPool<Actor>(random.countUnits());
		foreach (Actor item in random.units.LoopRandom())
		{
			if (item.city == random && Randy.randomChance(0.2f))
			{
				listPool.Add(item);
			}
		}
		for (int i = 0; i < listPool.Count; i++)
		{
			listPool[i].addTrait("madness");
		}
		WorldLog.logDisaster(pAsset, random.getTile(), null, random);
	}

	public void spawnGreg(DisasterAsset pAsset)
	{
		if (!DebugConfig.isOn(DebugOption.Greg) || !checkUnitSpawnLimits(pAsset))
		{
			return;
		}
		City random = World.world.cities.getRandom();
		if (random != null)
		{
			Building buildingOfType = random.getBuildingOfType("type_mine");
			if (buildingOfType != null)
			{
				WorldTile current_tile = buildingOfType.current_tile;
				Actor actor = spawnDisasterUnit(pAsset, current_tile);
				WorldLog.logDisaster(pAsset, current_tile, actor.getName(), random, actor);
				spawnDisasterUnit(pAsset, current_tile.region.tiles.GetRandom());
				AchievementLibrary.greg.check();
			}
		}
	}

	public void spawnNecromancer(DisasterAsset pAsset)
	{
		if (!checkUnitSpawnLimits(pAsset))
		{
			return;
		}
		City random = World.world.cities.getRandom();
		if (random == null)
		{
			return;
		}
		Building buildingOfType = random.getBuildingOfType("type_mine");
		if (buildingOfType != null)
		{
			WorldTile current_tile = buildingOfType.current_tile;
			Actor actor = spawnDisasterUnit(pAsset, current_tile);
			WorldLog.logDisaster(pAsset, current_tile, actor.getName(), random, actor);
			int num = Randy.randomInt(5, 25);
			for (int i = 0; i < num; i++)
			{
				World.world.units.createNewUnit("skeleton", current_tile.region.tiles.GetRandom(), pMiracleSpawn: false, 0f, null, null, pSpawnWithItems: true, pAdultAge: true);
			}
		}
	}

	public void spawnEvilMage(DisasterAsset pAsset)
	{
		if (checkUnitSpawnLimits(pAsset))
		{
			TileIsland randomIslandGround = World.world.islands_calculator.getRandomIslandGround();
			if (randomIslandGround != null)
			{
				WorldTile randomTile = randomIslandGround.getRandomTile();
				Actor actor = spawnDisasterUnit(pAsset, randomTile);
				WorldLog.logDisaster(pAsset, randomTile, actor.getName(), null, actor);
			}
		}
	}

	public void spawnHeatwave(DisasterAsset pAsset)
	{
		if (!WorldLawLibrary.world_law_disasters_nature.isEnabled())
		{
			return;
		}
		int num = Randy.randomInt(1, 3);
		WorldTile worldTile = null;
		bool flag = false;
		for (int i = 0; i < num; i++)
		{
			TileIsland randomIslandGround = World.world.islands_calculator.getRandomIslandGround();
			if (randomIslandGround != null)
			{
				worldTile = randomIslandGround.getRandomTile();
				flag = true;
				WorldTile[] neighboursAll = worldTile.neighboursAll;
				for (int j = 0; j < neighboursAll.Length; j++)
				{
					neighboursAll[j].startFire();
				}
			}
		}
		if (flag)
		{
			WorldLog.logDisaster(pAsset, worldTile);
		}
	}

	public void spawnSmallEarthquake(DisasterAsset pAsset)
	{
		WorldTile random = World.world.tiles_list.GetRandom();
		Earthquake.startQuake(random, EarthquakeType.SmallDisaster);
		WorldLog.logDisaster(pAsset, random);
	}

	public void spawnDragon(DisasterAsset pAsset)
	{
		if (checkUnitSpawnLimits(pAsset))
		{
			TileZone tileZone = ((!Randy.randomBool()) ? World.world.zone_calculator.getZone(World.world.zone_calculator.zones_total_x - 1, Randy.randomInt(0, World.world.zone_calculator.zones_total_y)) : World.world.zone_calculator.getZone(0, Randy.randomInt(0, World.world.zone_calculator.zones_total_y)));
			WorldTile centerTile = tileZone.centerTile;
			spawnDisasterUnit(pAsset, centerTile);
			WorldLog.logDisaster(pAsset, centerTile);
		}
	}

	public void startAlienInvasion(DisasterAsset pAsset)
	{
		if (checkUnitSpawnLimits(pAsset))
		{
			TileZone tileZone = ((!Randy.randomBool()) ? World.world.zone_calculator.getZone(World.world.zone_calculator.zones_total_x - 1, Randy.randomInt(0, World.world.zone_calculator.zones_total_y)) : World.world.zone_calculator.getZone(0, Randy.randomInt(0, World.world.zone_calculator.zones_total_y)));
			WorldTile centerTile = tileZone.centerTile;
			spawnDisasterUnit(pAsset, centerTile);
			WorldLog.logDisaster(pAsset, centerTile);
		}
	}

	public void spawnBiomass(DisasterAsset pAsset)
	{
		if (!checkUnitSpawnLimits(pAsset))
		{
			return;
		}
		Building building = null;
		foreach (City item in World.world.cities.list.LoopRandom())
		{
			Building random = Randy.getRandom(item.buildings);
			if (random != null && random.isUsable())
			{
				building = random;
				break;
			}
		}
		if (building != null)
		{
			WorldTile random2 = building.tiles.GetRandom();
			if (spawnDisasterBuilding(pAsset, random2) != null)
			{
				spawnDisasterUnit(pAsset, random2);
				WorldLog.logDisaster(pAsset, random2);
			}
		}
	}

	public void spawnTumor(DisasterAsset pAsset)
	{
		if (!checkUnitSpawnLimits(pAsset))
		{
			return;
		}
		Building building = null;
		foreach (City item in World.world.cities.list.LoopRandom())
		{
			Building random = Randy.getRandom(item.buildings);
			if (random != null && random.isUsable())
			{
				building = random;
				break;
			}
		}
		if (building != null)
		{
			WorldTile random2 = building.tiles.GetRandom();
			if (spawnDisasterBuilding(pAsset, random2) != null)
			{
				spawnDisasterUnit(pAsset, random2);
				WorldLog.logDisaster(pAsset, random2);
			}
		}
	}

	public void gardenSurprise(DisasterAsset pAsset)
	{
		if (!checkUnitSpawnLimits(pAsset))
		{
			return;
		}
		Building building = null;
		foreach (City item in World.world.cities.list.LoopRandom())
		{
			Building buildingOfType = item.getBuildingOfType("type_windmill");
			if (buildingOfType != null && buildingOfType.isAlive())
			{
				building = buildingOfType;
				break;
			}
		}
		if (building != null)
		{
			WorldTile random = building.tiles.GetRandom();
			if (spawnDisasterBuilding(pAsset, random) != null)
			{
				spawnDisasterUnit(pAsset, random);
				WorldLog.logDisaster(pAsset, random);
			}
		}
	}

	public void spawnTornado(DisasterAsset pAsset)
	{
		WorldTile random = World.world.tiles_list.GetRandom();
		EffectsLibrary.spawnAtTile("fx_tornado", random, 0.5f);
		WorldLog.logDisaster(pAsset, random);
	}

	public void spawnMeteorite(DisasterAsset pAsset)
	{
		WorldTile random = World.world.tiles_list.GetRandom();
		Meteorite.spawnMeteoriteDisaster(random);
		WorldLog.logDisaster(pAsset, random);
	}

	public void simpleUnitAssetSpawnUsingIslands(DisasterAsset pAsset)
	{
		if (checkUnitSpawnLimits(pAsset))
		{
			TileIsland randomIslandGround = World.world.islands_calculator.getRandomIslandGround();
			if (randomIslandGround != null)
			{
				WorldTile randomTile = randomIslandGround.getRandomTile();
				spawnDisasterUnit(pAsset, randomTile);
				WorldLog.logDisaster(pAsset, randomTile);
			}
		}
	}

	private bool checkUnitSpawnLimits(DisasterAsset pAsset)
	{
		if (string.IsNullOrEmpty(pAsset.spawn_asset_unit))
		{
			return false;
		}
		if (AssetManager.actor_library.get(pAsset.spawn_asset_unit).units.Count >= pAsset.max_existing_units)
		{
			return false;
		}
		return true;
	}

	private Actor spawnDisasterUnit(DisasterAsset pAsset, WorldTile pTile)
	{
		EffectsLibrary.spawn("fx_spawn", pTile);
		Actor result = null;
		int num = Randy.randomInt(pAsset.units_min, pAsset.units_max);
		for (int i = 0; i < num; i++)
		{
			result = World.world.units.createNewUnit(pAsset.spawn_asset_unit, pTile, pMiracleSpawn: false, 0f, null, null, pSpawnWithItems: true, pAdultAge: true, pGiveOwnerlessItems: true);
		}
		return result;
	}

	private Building spawnDisasterBuilding(DisasterAsset pAsset, WorldTile pTile)
	{
		if (string.IsNullOrEmpty(pAsset.spawn_asset_building))
		{
			return null;
		}
		return World.world.buildings.addBuilding(pAsset.spawn_asset_building, pTile, pCheckForBuild: true);
	}
}
// --- End of File: DisasterLibrary.cs ---



// --- Start of File: DisasterType.cs ---
public enum DisasterType
{
	Nature,
	Other
}
// --- End of File: DisasterType.cs ---



// --- Start of File: DiscordTracker.cs ---
using System;
using System.Runtime.CompilerServices;
using Discord;
using Proyecto26;
using UnityEngine;

public class DiscordTracker : MonoBehaviour, IRichTracker
{
	[Serializable]
	[CompilerGenerated]
	private sealed class _003C_003Ec
	{
		public static readonly _003C_003Ec _003C_003E9 = new _003C_003Ec();

		public static UpdateActivityHandler _003C_003E9__10_0;

		public static UpdateActivityHandler _003C_003E9__23_0;

		public static UpdateActivityHandler _003C_003E9__24_0;

		internal void _003CStart_003Eb__10_0(Result pRes)
		{
			//IL_0000: Unknown result type (might be due to invalid IL or missing references)
			//IL_000d: Unknown result type (might be due to invalid IL or missing references)
			if ((int)pRes != 0)
			{
				Debug.Log((object)"Disabling Discord");
				Debug.Log((object)pRes);
				Object.Destroy((Object)(object)_instance);
			}
		}

		internal void _003CtrackActivity_003Eb__23_0(Result _)
		{
		}

		internal void _003CupdateDetails_003Eb__24_0(Result _)
		{
		}
	}

	private const long DISCORD_GAME_ID = 816251591299432468L;

	private const ulong DISCORD_FLAGS = 1uL;

	private static Discord _discord;

	private static ActivityManager _activity_manager;

	private bool _initiated;

	private static DiscordTracker _instance;

	private static Activity _activity;

	private static bool _have_user = false;

	private static int _user_tries = 10;

	private static float _timer = 10f;

	private void Start()
	{
		//IL_00fa: Expected O, but got Unknown
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Expected O, but got Unknown
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Expected O, but got Unknown
		if (_initiated)
		{
			return;
		}
		_initiated = true;
		bool flag = false;
		try
		{
			_instance = this;
			_discord = new Discord(816251591299432468L, 1uL);
			_activity_manager = _discord.GetActivityManager();
			Activity activity = default(Activity);
			activity.State = LocalizedTextManager.getText("discord_browsing");
			activity.Assets.LargeImage = "worldboxlogo";
			activity.Assets.LargeText = "WorldBox";
			activity.Timestamps.Start = (long)DateTime.UtcNow.Subtract(new DateTime(1970, 1, 1)).TotalSeconds;
			activity.Instance = true;
			_activity = activity;
			ActivityManager activity_manager = _activity_manager;
			if (activity_manager != null)
			{
				Activity activity2 = _activity;
				object obj = _003C_003Ec._003C_003E9__10_0;
				if (obj == null)
				{
					UpdateActivityHandler val = delegate(Result pRes)
					{
						//IL_0000: Unknown result type (might be due to invalid IL or missing references)
						//IL_000d: Unknown result type (might be due to invalid IL or missing references)
						if ((int)pRes != 0)
						{
							Debug.Log((object)"Disabling Discord");
							Debug.Log((object)pRes);
							Object.Destroy((Object)(object)_instance);
						}
					};
					_003C_003Ec._003C_003E9__10_0 = val;
					obj = (object)val;
				}
				activity_manager.UpdateActivity(activity2, (UpdateActivityHandler)obj);
			}
		}
		catch (ResultException val2)
		{
			Debug.Log((object)"Disabling Discord Integration (Discord not running, or game not run as Administrator)");
			Debug.Log((object)val2);
			flag = true;
		}
		catch (Exception ex)
		{
			Debug.Log((object)"Disabling Discord Integration (Discord not running, or game not run as Administrator)");
			Debug.Log((object)ex);
			flag = true;
		}
		if (flag)
		{
			Object.Destroy((Object)(object)_instance);
		}
	}

	private static void tryGetUser()
	{
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		try
		{
			_user_tries--;
			User currentUser = _discord.GetUserManager().GetCurrentUser();
			string text = currentUser.Id.ToString();
			if (!string.IsNullOrEmpty(text))
			{
				Config.discordId = text;
				RestClient.DefaultRequestHeaders["wb-dsc"] = text;
				_have_user = true;
				Debug.Log((object)("D:" + Config.discordId));
			}
			else
			{
				Debug.Log((object)"D:nf");
			}
			string username = currentUser.Username;
			if (!string.IsNullOrEmpty(username))
			{
				Config.discordName = username;
			}
			string discriminator = currentUser.Discriminator;
			if (!string.IsNullOrEmpty(discriminator))
			{
				Config.discordDiscriminator = discriminator;
			}
			VersionCheck.checkVersion();
		}
		catch (Exception)
		{
			Debug.Log((object)"D:F");
		}
	}

	private void Update()
	{
		if (!_initiated)
		{
			return;
		}
		try
		{
			_discord.RunCallbacks();
		}
		catch (Exception ex)
		{
			Debug.Log((object)"Disabling Discord");
			Debug.Log((object)ex);
			Object.Destroy((Object)(object)_instance);
			return;
		}
		if (_timer > 0f)
		{
			_timer -= Time.deltaTime;
			return;
		}
		_timer = 10f;
		try
		{
			if (!_have_user && _user_tries > 0)
			{
				tryGetUser();
			}
			updateDetails(PowerTracker.activeStat);
		}
		catch (Exception ex2)
		{
			Debug.Log((object)"Disabling Discord");
			Debug.Log((object)ex2);
			Object.Destroy((Object)(object)_instance);
		}
	}

	private void OnDisable()
	{
		Discord discord = _discord;
		if (discord != null)
		{
			discord.Dispose();
		}
	}

	private void OnDestroy()
	{
		_instance = null;
		_activity_manager = null;
		PowerTracker.discordTracker = null;
	}

	public void trackViewing(string pString)
	{
		if ((Object)(object)_instance == (Object)null)
		{
			return;
		}
		if (pString != "" && LocalizedTextManager.stringExists(pString))
		{
			pString = LocalizedTextManager.getText("discord_viewing").Replace("$window$", LocalizedTextManager.getText(pString));
		}
		else
		{
			if (pString != "")
			{
				Debug.Log((object)("Missing translation for " + pString));
			}
			pString = LocalizedTextManager.getText("discord_browsing");
		}
		trackActivity(pString);
	}

	public void trackWatching()
	{
		if (!((Object)(object)_instance == (Object)null))
		{
			trackActivity(LocalizedTextManager.getText("discord_watching"));
		}
	}

	public void trackUsing(string pPower)
	{
		if (!((Object)(object)_instance == (Object)null))
		{
			trackActivity(LocalizedTextManager.getText("discord_using").Replace("$power$", LocalizedTextManager.getText(pPower)));
		}
	}

	public void updateUsing(int pAmount, string pPower = "")
	{
		trackActivity(LocalizedTextManager.getText(pPower) + " (" + pAmount + ")");
	}

	public void inspectKingdom(string pKingdom)
	{
		trackActivity(LocalizedTextManager.getText("village_statistics_kingdom") + ": " + pKingdom);
	}

	public void inspectVillage(string pVillage)
	{
		trackActivity(LocalizedTextManager.getText("village") + ": " + pVillage);
	}

	public void inspectUnit(string pUnit)
	{
		trackActivity("inspect".Localize() + ": " + pUnit);
	}

	public void spectatingUnit(string pUnit)
	{
		trackActivity(LocalizedTextManager.getText("tip_following_unit").Replace("$name$", pUnit));
	}

	public void trackActivity(string pState = "")
	{
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Expected O, but got Unknown
		if ((Object)(object)_instance == (Object)null)
		{
			return;
		}
		_activity.State = pState;
		ActivityManager activity_manager = _activity_manager;
		if (activity_manager != null)
		{
			Activity activity = _activity;
			object obj = _003C_003Ec._003C_003E9__23_0;
			if (obj == null)
			{
				UpdateActivityHandler val = delegate
				{
				};
				_003C_003Ec._003C_003E9__23_0 = val;
				obj = (object)val;
			}
			activity_manager.UpdateActivity(activity, (UpdateActivityHandler)obj);
		}
	}

	public void updateDetails(StatisticsAsset pStat)
	{
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Expected O, but got Unknown
		if ((Object)(object)_instance == (Object)null)
		{
			return;
		}
		string localeID = pStat.getLocaleID();
		if (!string.IsNullOrEmpty(localeID))
		{
			_activity.Details = LocalizedTextManager.getText(localeID) + ": " + pStat.last_value;
		}
		else
		{
			_activity.Details = pStat.last_value;
		}
		ActivityManager activity_manager = _activity_manager;
		if (activity_manager != null)
		{
			Activity activity = _activity;
			object obj = _003C_003Ec._003C_003E9__24_0;
			if (obj == null)
			{
				UpdateActivityHandler val = delegate
				{
				};
				_003C_003Ec._003C_003E9__24_0 = val;
				obj = (object)val;
			}
			activity_manager.UpdateActivity(activity, (UpdateActivityHandler)obj);
		}
	}
}
// --- End of File: DiscordTracker.cs ---



// --- Start of File: DiscountData.cs ---
using Beebyte.Obfuscator;

[Skip]
[SkipRename]
public struct DiscountData
{
	public string discount;

	public string price_current;

	public string price_old;
}
// --- End of File: DiscountData.cs ---



// --- Start of File: Discounts.cs ---
using System;
using Newtonsoft.Json;
using Proyecto26;
using UnityEngine;
using UnityEngine.Purchasing;

internal static class Discounts
{
	private static ProductMetadata localPriceData;

	private static string platform;

	internal static void checkDiscounts()
	{
		try
		{
			checkPlatform();
			if ((Object)(object)InAppManager.instance != (Object)null)
			{
				InAppManager instance = InAppManager.instance;
				object obj;
				if (instance == null)
				{
					obj = null;
				}
				else
				{
					IStoreController controller = instance.controller;
					obj = ((controller != null) ? controller.products : null);
				}
				if (obj != null)
				{
					Product val = InAppManager.instance.controller.products.WithID("premium");
					if (val != null)
					{
						discountRequest(val.metadata);
					}
					else
					{
						Debug.Log((object)"DC:no req/prod");
					}
					return;
				}
			}
			Debug.Log((object)"DC:np");
		}
		catch (Exception ex)
		{
			Debug.Log((object)"DC:err");
			Debug.Log((object)ex);
		}
	}

	private static void discountRequest(ProductMetadata pProductMeta)
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Expected O, but got Unknown
		if (platform.Length < 2 || pProductMeta == null)
		{
			return;
		}
		string text = "https://currency.superworldbox.com/discounts/" + platform + ".json?" + Toolbox.cacheBuster();
		string text2 = JsonConvert.SerializeObject((object)pProductMeta, new JsonSerializerSettings
		{
			DefaultValueHandling = (DefaultValueHandling)3
		});
		if (string.IsNullOrEmpty(text2) || text2 == "{}")
		{
			return;
		}
		RestClient.Post(text, text2).Then((Action<ResponseHelper>)delegate(ResponseHelper response)
		{
			string text3 = response.Text;
			if (!string.IsNullOrEmpty(text3) && !(text3 == "{}") && !(text3.Substring(0, 1) != "{"))
			{
				Debug.Log((object)text3);
				DiscountData discountData = JsonConvert.DeserializeObject<DiscountData>(text3);
				Debug.Log((object)"DS:Setting");
				if (!string.IsNullOrEmpty(discountData.discount) && !string.IsNullOrEmpty(discountData.price_current) && !string.IsNullOrEmpty(discountData.price_old))
				{
					LocalizedTextPrice.discount = discountData.discount;
					LocalizedTextPrice.price_current = discountData.price_current;
					LocalizedTextPrice.price_old = discountData.price_old;
					Debug.Log((object)"DS:Set");
				}
				else
				{
					Debug.Log((object)"DS:NSet");
				}
			}
		}).Catch((Action<Exception>)delegate(Exception err)
		{
			Debug.Log((object)"DS:err");
			Debug.Log((object)err.Message);
		});
	}

	private static void checkPlatform()
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Invalid comparison between Unknown and I4
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Invalid comparison between Unknown and I4
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Expected I4, but got Unknown
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Invalid comparison between Unknown and I4
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Invalid comparison between Unknown and I4
		RuntimePlatform val = Application.platform;
		if ((int)val <= 11)
		{
			switch ((int)val)
			{
			default:
				if ((int)val != 11)
				{
					break;
				}
				platform = "android";
				return;
			case 2:
				platform = "pc";
				return;
			case 7:
				platform = "pc";
				return;
			case 0:
				platform = "mac";
				return;
			case 1:
				platform = "mac";
				return;
			case 8:
				platform = "ios";
				return;
			case 3:
			case 4:
			case 5:
			case 6:
				break;
			}
		}
		else
		{
			if ((int)val == 13)
			{
				platform = "linux";
				return;
			}
			if ((int)val == 16)
			{
				platform = "linux";
				return;
			}
		}
		platform = "unknown";
	}
}
// --- End of File: Discounts.cs ---



// --- Start of File: DivineLightState.cs ---
internal enum DivineLightState
{
	SpawnFirstStage,
	SpawnSecondStage,
	Idle,
	Hide
}
// --- End of File: DivineLightState.cs ---



// --- Start of File: Docks.cs ---
using System.Collections.Generic;
using UnityPools;

public class Docks : BaseBuildingComponent
{
	public ListPool<WorldTile> tiles_ocean;

	private Dictionary<string, int> _boat_types;

	internal override void create(Building pBuilding)
	{
		base.create(pBuilding);
		tiles_ocean = new ListPool<WorldTile>();
		_boat_types = UnsafeCollectionPool<Dictionary<string, int>, KeyValuePair<string, int>>.Get();
	}

	public TileIsland getIsland()
	{
		if (building.hasCity())
		{
			return building.city.getTile()?.region.island;
		}
		return null;
	}

	public WorldTile getOceanTileInSameOcean(WorldTile pTile)
	{
		foreach (WorldTile item in tiles_ocean.LoopRandom())
		{
			if (item.isSameIsland(pTile))
			{
				return item;
			}
		}
		return null;
	}

	public bool hasOceanTiles()
	{
		recalculateOceanTiles();
		return tiles_ocean.Count > 0;
	}

	public void recalculateOceanTiles()
	{
		tiles_ocean.Clear();
		WorldTile tile = World.world.GetTile(building.current_tile.x - 4, building.current_tile.y);
		if (tile != null && tile.isGoodForBoat())
		{
			tiles_ocean.Add(tile);
		}
		tile = World.world.GetTile(building.current_tile.x + 5, building.current_tile.y);
		if (tile != null && tile.isGoodForBoat())
		{
			tiles_ocean.Add(tile);
		}
		tile = World.world.GetTile(building.current_tile.x, building.current_tile.y - 4);
		if (tile != null && tile.isGoodForBoat())
		{
			tiles_ocean.Add(tile);
		}
		tile = World.world.GetTile(building.current_tile.x, building.current_tile.y + 7);
		if (tile != null && tile.isGoodForBoat())
		{
			tiles_ocean.Add(tile);
		}
		if (tiles_ocean.Count == 0)
		{
			building.startDestroyBuilding();
		}
	}

	public bool isDockGood()
	{
		if (tiles_ocean.Count == 0)
		{
			return false;
		}
		for (int i = 0; i < tiles_ocean.Count; i++)
		{
			if (!tiles_ocean[i].Type.ocean)
			{
				return false;
			}
		}
		return true;
	}

	private bool ifStayingOnGround()
	{
		for (int i = 0; i < building.tiles.Count; i++)
		{
			if (building.tiles[i].Type.ground)
			{
				return true;
			}
		}
		return false;
	}

	public override void update(float pElapsed)
	{
		base.update(pElapsed);
		if (ifStayingOnGround())
		{
			building.getHit(1000f);
		}
		if (building.hasCity() && building.city.buildings.Count == 1)
		{
			building.getHit(1000f);
		}
	}

	public int countBoatTypes(string pType)
	{
		_boat_types.TryGetValue(pType, out var value);
		return value;
	}

	public bool isFull(string pType)
	{
		if (countBoatTypes(pType) >= 1)
		{
			return true;
		}
		return false;
	}

	public bool isOverfilled(string pType)
	{
		if (countBoatTypes(pType) > 1)
		{
			return true;
		}
		return false;
	}

	public Actor buildBoatFromHere(City pCity)
	{
		ActorAsset randomBoatAssetToBuild = building.asset.getRandomBoatAssetToBuild(pCity);
		if (randomBoatAssetToBuild == null)
		{
			return null;
		}
		if (countBoatTypes(randomBoatAssetToBuild.boat_type) >= 1)
		{
			return null;
		}
		if (!pCity.hasEnoughResourcesFor(randomBoatAssetToBuild.cost))
		{
			return null;
		}
		if (tiles_ocean.Count == 0)
		{
			recalculateOceanTiles();
			return null;
		}
		WorldTile random = tiles_ocean.GetRandom();
		if (!random.region.island.goodForDocks())
		{
			return null;
		}
		Actor actor = World.world.units.createNewUnit(randomBoatAssetToBuild.id, random);
		if (actor == null)
		{
			return null;
		}
		addBoatToDock(actor);
		pCity.spendResourcesForBuildingAsset(randomBoatAssetToBuild.cost);
		return actor;
	}

	public void clearBoatCounter()
	{
		_boat_types.Clear();
	}

	public void increaseBoatCounter(Actor pActor)
	{
		int num = countBoatTypes(pActor.asset.boat_type);
		num = (_boat_types[pActor.asset.boat_type] = num + 1);
	}

	public void addBoatToDock(Actor pBoat)
	{
		pBoat.setHomeBuilding(building);
		pBoat.joinCity(building.city);
		increaseBoatCounter(pBoat);
	}

	public override void Dispose()
	{
		base.Dispose();
		tiles_ocean.Dispose();
		tiles_ocean = null;
		_boat_types.Clear();
		UnsafeCollectionPool<Dictionary<string, int>, KeyValuePair<string, int>>.Release(_boat_types);
		_boat_types = null;
	}
}
// --- End of File: Docks.cs ---



// --- Start of File: DownloadCounterMapQueue.cs ---
using System;

[Serializable]
public class DownloadCounterMapQueue : QueueItem
{
	public string username;

	public string userId;

	public string reason;

	public string error;

	public string status;

	public string mapId;
}
// --- End of File: DownloadCounterMapQueue.cs ---



// --- Start of File: DraggableLayoutElement.cs ---
using System;
using System.Collections.Generic;
using LayoutGroupExt;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

[RequireComponent(typeof(CanvasGroup))]
public class DraggableLayoutElement : MonoBehaviour, IInitializePotentialDragHandler, IEventSystemHandler, IDragHandler, IBeginDragHandler, IEndDragHandler, ILayoutIgnorer, IDraggable
{
	public const float TOUCH_DELAY = 0.2f;

	[SerializeField]
	private bool _spawn_particles_on_drag = true;

	private RectTransform _rect;

	private CanvasGroup _canvas_group;

	private LayoutGroupExtended _parent_layout;

	private RectTransform _parent;

	private Rect _cached_parent_rect;

	private Vector3 _cached_parent_position;

	[SerializeField]
	private Transform _attach_parent;

	[SerializeField]
	private bool _touch_drag_delay;

	private DraggableLayoutElement _drag_object;

	private int _target_index = -1;

	private List<MonoBehaviour> _toggle_elements = new List<MonoBehaviour>(3);

	private static bool _any_dragging;

	private bool? _dragging_cache;

	[SerializeField]
	private bool _drag_only_over_parent = true;

	internal Action<DraggableLayoutElement> start_being_dragged;

	private float _drag_timer_started_at;

	public bool spawn_particles_on_drag => _spawn_particles_on_drag;

	public bool ignoreLayout { get; set; }

	private List<RectTransform> _siblings => _parent_layout.m_Children;

	private Vector2[] _sibling_positions => _parent_layout.m_Positions;

	private void Start()
	{
		_rect = ((Component)this).GetComponent<RectTransform>();
		_canvas_group = ((Component)this).GetComponent<CanvasGroup>();
		_parent = ((Component)((Component)this).transform.parent).GetComponent<RectTransform>();
		_parent_layout = ((Component)_parent).GetComponent<LayoutGroupExtended>();
		if (!((Object)(object)_parent_layout == (Object)null))
		{
			addToggleComponent<ScrollableButton>();
			addToggleComponent<Button>();
			addToggleComponent<TipButton>();
			if ((Object)(object)_attach_parent == (Object)null)
			{
				_attach_parent = World.world.drag_parent;
			}
		}
	}

	private void OnEnable()
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		_cached_parent_position = new Vector3(-1000f, -1000f, -1000f);
		_target_index = -1;
	}

	public void KillDrag()
	{
		OnDisable();
	}

	private void OnDisable()
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Expected O, but got Unknown
		if (_any_dragging && !((Object)(object)_drag_object == (Object)null))
		{
			OnEndDrag(new PointerEventData(EventSystem.current));
		}
	}

	public void OnInitializePotentialDrag(PointerEventData pEventData)
	{
		if (_touch_drag_delay)
		{
			_drag_timer_started_at = Time.time;
		}
	}

	public void OnBeginDrag(PointerEventData pEventData)
	{
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		if (!Config.isDraggingItem() && !isTouchDragDelayed() && !_any_dragging)
		{
			_any_dragging = true;
			_drag_object = Object.Instantiate<DraggableLayoutElement>(this, _attach_parent, true);
			((Component)_drag_object).transform.position = Vector2.op_Implicit(pEventData.position);
			_drag_object.ignoreLayout = true;
			_drag_object.start_being_dragged?.Invoke(this);
			_canvas_group.alpha = 0.2f;
			Config.setDraggingObject(_drag_object);
		}
	}

	public void OnDrag(PointerEventData pEventData)
	{
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		if (!isTouchDragDelayed() && _any_dragging && Config.isDraggingObject(_drag_object))
		{
			((Component)_drag_object).transform.position = Vector2.op_Implicit(pEventData.position);
			if (isOverParent(pEventData.position))
			{
				findTarget();
			}
		}
	}

	public void OnEndDrag(PointerEventData pEventData)
	{
		ScrollRectExtended.SendMessageToAll("OnEndDrag", pEventData);
		if (_any_dragging && Config.isDraggingObject(_drag_object))
		{
			Config.clearDraggingObject();
			_any_dragging = false;
			_drag_timer_started_at = 0f;
			Object.Destroy((Object)(object)((Component)_drag_object).gameObject);
			_canvas_group.alpha = 1f;
		}
	}

	public void Update()
	{
		if (_dragging_cache != _any_dragging)
		{
			_dragging_cache = _any_dragging;
			_canvas_group.interactable = !_any_dragging;
			_canvas_group.blocksRaycasts = !_any_dragging;
			foreach (MonoBehaviour toggle_element in _toggle_elements)
			{
				if (toggle_element is Selectable)
				{
					((Selectable)((toggle_element is Selectable) ? toggle_element : null)).interactable = !_any_dragging;
				}
				else
				{
					((Behaviour)toggle_element).enabled = !_any_dragging;
				}
			}
		}
		moveToTarget();
	}

	internal void lockToParent(bool pLock = true)
	{
		_drag_only_over_parent = pLock;
	}

	internal void setDragParent(Transform pParent)
	{
		_attach_parent = pParent;
	}

	private void moveToTarget()
	{
		if (_target_index < 0)
		{
			return;
		}
		int num = _siblings.IndexOf(_rect);
		int num2 = _target_index;
		using ListPool<int> listPool = getNeighbours(num);
		if (!listPool.Contains(num2))
		{
			num2 = findClosestNeighbour(num2, listPool);
		}
		swapSiblings(num, num2);
		if (num2 == _target_index)
		{
			_target_index = -1;
		}
	}

	private void recalcParent()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		if (!(_cached_parent_position == ((Transform)_parent).position))
		{
			_cached_parent_position = ((Transform)_parent).position;
			_cached_parent_rect = _parent.GetWorldRect();
			Rect rect = _rect.rect;
			float num = ((Rect)(ref rect)).width * 10f;
			rect = _rect.rect;
			float num2 = ((Rect)(ref rect)).height * 10f;
			ref Rect cached_parent_rect = ref _cached_parent_rect;
			((Rect)(ref cached_parent_rect)).x = ((Rect)(ref cached_parent_rect)).x - num;
			ref Rect cached_parent_rect2 = ref _cached_parent_rect;
			((Rect)(ref cached_parent_rect2)).y = ((Rect)(ref cached_parent_rect2)).y - num2;
			ref Rect cached_parent_rect3 = ref _cached_parent_rect;
			((Rect)(ref cached_parent_rect3)).width = ((Rect)(ref cached_parent_rect3)).width + num * 2f;
			ref Rect cached_parent_rect4 = ref _cached_parent_rect;
			((Rect)(ref cached_parent_rect4)).height = ((Rect)(ref cached_parent_rect4)).height + num2 * 2f;
		}
	}

	private void findTarget()
	{
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)_drag_object == (Object)null)
		{
			return;
		}
		Vector3 position = ((Component)_drag_object).transform.position;
		float num = float.MaxValue;
		float num2 = float.MaxValue;
		int num3 = -1;
		int num4 = -1;
		for (int i = 0; i < _sibling_positions.Length; i++)
		{
			float num5 = Vector2.Distance(_sibling_positions[i], Vector2.op_Implicit(position));
			if ((Object)(object)_siblings[i] == (Object)(object)_rect)
			{
				num4 = i;
				num2 = num5;
			}
			if (num5 < num)
			{
				num = num5;
				num3 = i;
			}
		}
		if (num3 != num4 && !Mathf.Approximately(num2, num))
		{
			_target_index = num3;
		}
	}

	private bool isOverParent(Vector2 pPosition)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		recalcParent();
		if (((Rect)(ref _cached_parent_rect)).Contains(pPosition))
		{
			return true;
		}
		return false;
	}

	private void swapSiblings(int pStartIndex, int pTargetIndex)
	{
		if (pStartIndex < _siblings.Count && pTargetIndex < _siblings.Count)
		{
			int siblingIndex = ((Component)_siblings[pStartIndex]).transform.GetSiblingIndex();
			int siblingIndex2 = ((Component)_siblings[pTargetIndex]).transform.GetSiblingIndex();
			if (siblingIndex > siblingIndex2)
			{
				((Component)_siblings[pTargetIndex]).transform.SetSiblingIndex(siblingIndex);
				((Component)this).transform.SetSiblingIndex(siblingIndex2);
			}
			else
			{
				((Component)this).transform.SetSiblingIndex(siblingIndex2);
				((Component)_siblings[pTargetIndex]).transform.SetSiblingIndex(siblingIndex);
			}
			_siblings.Swap(pStartIndex, pTargetIndex);
		}
	}

	private int findClosestNeighbour(int pIndex, ListPool<int> pNeighbours)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		int result = pIndex;
		Vector2 val = _sibling_positions[pIndex];
		float num = float.MaxValue;
		foreach (ref int pNeighbour in pNeighbours)
		{
			int current = pNeighbour;
			float num2 = Vector2.Distance(_sibling_positions[current], val);
			if (num2 < num)
			{
				num = num2;
				result = current;
			}
		}
		return result;
	}

	private ListPool<int> getNeighbours(int pIndex)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		ListPool<int> listPool = new ListPool<int>(8);
		if (_sibling_positions.Length < 2)
		{
			return listPool;
		}
		Vector2 val = _sibling_positions[pIndex];
		float num = Vector2.Distance(_sibling_positions[0], _sibling_positions[1]) * 1.5f;
		for (int i = 0; i < _sibling_positions.Length; i++)
		{
			if (i != pIndex && Vector2.Distance(val, _sibling_positions[i]) <= num)
			{
				listPool.Add(i);
			}
		}
		return listPool;
	}

	private void addToggleComponent<T>() where T : MonoBehaviour
	{
		if (((Component)(object)this).HasComponent<T>())
		{
			_toggle_elements.Add((MonoBehaviour)(object)((Component)this).GetComponent<T>());
		}
	}

	private bool isTouchDragDelayed()
	{
		if (_touch_drag_delay && !InputHelpers.mouseSupported)
		{
			return Time.time - _drag_timer_started_at < 0.2f;
		}
		return false;
	}

	Transform IDraggable.get_transform()
	{
		return ((Component)this).transform;
	}
}
// --- End of File: DraggableLayoutElement.cs ---



// --- Start of File: Dragon.cs ---
using System.Collections.Generic;
using UnityEngine;

public class Dragon : BaseActorComponent
{
	private DragonAsset dragonAsset;

	private DragonState state;

	internal float idle_time = -1f;

	internal float sleep_time = -1f;

	internal SpriteAnimation spriteAnimation;

	internal HashSet<Actor> aggroTargets = new HashSet<Actor>();

	internal WorldTile lastLanded;

	private HashSet<WorldTile> _landAttackTiles = new HashSet<WorldTile>();

	private WorldTile _landAttackPosCheck;

	internal int _landAttackCache;

	internal HashSet<WorldTile> _slideAttackTilesFlip = new HashSet<WorldTile>();

	internal HashSet<WorldTile> _slideAttackTilesNoFlip = new HashSet<WorldTile>();

	private WorldTile _slideAttackPosCheckFlip;

	private WorldTile _slideAttackPosCheckNoFlip;

	internal int _slideAttackTilesFlipCache;

	internal int _slideAttackTilesNoFlipCache;

	internal override void create(Actor pActor)
	{
		base.create(pActor);
		spriteAnimation = ((Component)this).GetComponent<SpriteAnimation>();
		if (actor.asset.id == "zombie_dragon")
		{
			dragonAsset = PrefabLibrary.instance.zombieDragonAsset;
		}
		else
		{
			dragonAsset = PrefabLibrary.instance.dragonAsset;
		}
		actor.setFlying(pVal: true);
		setFrames(DragonState.Fly, pForce: true);
	}

	private void playSound(DragonState pState)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		switch (state)
		{
		case DragonState.LandAttack:
			MusicBox.playSound("event:/SFX/UNITS/dragon/fire_breath", ((Component)this).transform.localPosition.x, ((Component)this).transform.localPosition.y);
			break;
		case DragonState.Slide:
			MusicBox.playSound("event:/SFX/UNITS/dragon/swoop", ((Component)this).transform.localPosition.x, ((Component)this).transform.localPosition.y);
			break;
		}
	}

	internal static bool shouldFly(Actor pActor, WorldTile pTile = null)
	{
		if (pTile == null)
		{
			pTile = pActor.current_tile;
		}
		return !canLand(pActor, pTile);
	}

	internal static bool canLand(Actor pActor, WorldTile pTile = null)
	{
		if (pTile == null)
		{
			pTile = pActor.current_tile;
		}
		if (!pTile.Type.ground)
		{
			if (pTile.Type.lava)
			{
				return !pActor.asset.die_in_lava;
			}
			return false;
		}
		return true;
	}

	internal void attackTile(WorldTile pTile)
	{
		if (pTile == null)
		{
			return;
		}
		bool flag = actor.hasTrait("zombie");
		if (flag)
		{
			DropsLibrary.action_acid(pTile);
			if (pTile.hasUnits() || Randy.randomBool())
			{
				World.world.drop_manager.spawnParabolicDrop(pTile, "acid", 0f, 0.1f, 3.5f, 0.5f, 4f, Randy.randomFloat(0.025f, 0.2f));
			}
		}
		else
		{
			pTile.startFire(pForce: true);
			if (pTile.hasBuilding())
			{
				pTile.building.getHit(10f);
			}
			if (pTile.hasUnits() || Randy.randomBool())
			{
				World.world.drop_manager.spawnParabolicDrop(pTile, "fire", 0f, 0.1f, 3.5f, 0.5f, 4f, Randy.randomFloat(0.025f, 0.2f));
			}
		}
		if (pTile.hasUnits())
		{
			MapAction.damageWorld(pTile, 2, AssetManager.terraform.get(flag ? "zombie_dragon_attack" : "dragon_attack"), actor);
		}
	}

	internal bool hasTargetsForSlide()
	{
		if (WorldLawLibrary.world_law_peaceful_monsters.isEnabled())
		{
			return false;
		}
		attackRange(actor.flip);
		foreach (WorldTile item in actor.flip ? _slideAttackTilesFlip : _slideAttackTilesNoFlip)
		{
			if (hasTarget(item, actor))
			{
				return true;
			}
		}
		return false;
	}

	internal bool targetWithinSlide(WorldTile pTargetTile)
	{
		if (WorldLawLibrary.world_law_peaceful_monsters.isEnabled())
		{
			return false;
		}
		attackRange(flip: true);
		if (_slideAttackTilesFlip.Contains(pTargetTile))
		{
			actor.setFlip(pFlip: true);
			return true;
		}
		attackRange(flip: false);
		if (_slideAttackTilesNoFlip.Contains(pTargetTile))
		{
			actor.setFlip(pFlip: false);
			return true;
		}
		return false;
	}

	internal static Kingdom getIgnoredKingdom(Actor pActor)
	{
		if (pActor.hasTrait("zombie"))
		{
			return World.world.kingdoms_wild.get("undead");
		}
		return World.world.kingdoms_wild.get("dragons");
	}

	internal bool targetsWithinLandAttackRange()
	{
		foreach (Actor aggroTarget in aggroTargets)
		{
			if (!aggroTarget.isRekt() && landAttackRange(aggroTarget.current_tile))
			{
				return true;
			}
		}
		return false;
	}

	internal bool landAttackRange(WorldTile pTargetTile)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		Vector2Int pos = actor.current_tile.pos;
		int x = ((Vector2Int)(ref pos)).x;
		pos = actor.current_tile.pos;
		int y = ((Vector2Int)(ref pos)).y;
		pos = pTargetTile.pos;
		int x2 = ((Vector2Int)(ref pos)).x;
		pos = pTargetTile.pos;
		if (Toolbox.Dist(x, y, x2, ((Vector2Int)(ref pos)).y) > 9f)
		{
			return false;
		}
		landAttackTiles(actor.current_tile);
		return _landAttackTiles.Contains(pTargetTile);
	}

	internal HashSet<WorldTile> landAttackTiles(WorldTile pTile)
	{
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		if (_landAttackPosCheck == pTile)
		{
			_landAttackCache++;
			return _landAttackTiles;
		}
		_landAttackCache = 0;
		_landAttackTiles.Clear();
		_landAttackPosCheck = pTile;
		for (int i = 0; i < 12; i++)
		{
			for (int j = 0; j < 20; j++)
			{
				MapBox world = World.world;
				Vector2Int pos = pTile.pos;
				int pX = ((Vector2Int)(ref pos)).x + j - 10;
				pos = pTile.pos;
				WorldTile tile = world.GetTile(pX, ((Vector2Int)(ref pos)).y - i + 1);
				if (tile != null)
				{
					pos = pTile.pos;
					int x = ((Vector2Int)(ref pos)).x;
					pos = pTile.pos;
					int y = ((Vector2Int)(ref pos)).y;
					pos = tile.pos;
					int x2 = ((Vector2Int)(ref pos)).x;
					pos = tile.pos;
					if (!(Toolbox.Dist(x, y, x2, ((Vector2Int)(ref pos)).y) > 9f))
					{
						_landAttackTiles.Add(tile);
					}
				}
			}
		}
		return _landAttackTiles;
	}

	internal WorldTile randomTileWithinLandAttackRange(WorldTile pTile)
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		Toolbox.temp_list_tiles.Clear();
		Vector2Int pos;
		for (int num = 9; num > 1; num--)
		{
			MapBox world = World.world;
			pos = pTile.pos;
			int x = ((Vector2Int)(ref pos)).x;
			pos = pTile.pos;
			WorldTile tile = world.GetTile(x, ((Vector2Int)(ref pos)).y + num);
			if (tile != null)
			{
				pTile = tile;
				break;
			}
		}
		for (int i = 0; i < 12; i++)
		{
			for (int j = 0; j < 20; j++)
			{
				MapBox world2 = World.world;
				pos = pTile.pos;
				int pX = ((Vector2Int)(ref pos)).x + j - 10;
				pos = pTile.pos;
				WorldTile tile2 = world2.GetTile(pX, ((Vector2Int)(ref pos)).y - i + 1);
				if (tile2 != null)
				{
					pos = pTile.pos;
					int x2 = ((Vector2Int)(ref pos)).x;
					pos = pTile.pos;
					int y = ((Vector2Int)(ref pos)).y;
					pos = tile2.pos;
					int x3 = ((Vector2Int)(ref pos)).x;
					pos = tile2.pos;
					if (!(Toolbox.Dist(x2, y, x3, ((Vector2Int)(ref pos)).y) > 9f) && canLand(actor, tile2))
					{
						Toolbox.temp_list_tiles.Add(tile2);
					}
				}
			}
		}
		if (Toolbox.temp_list_tiles.Count == 0)
		{
			return pTile;
		}
		return Toolbox.temp_list_tiles.GetRandom();
	}

	internal HashSet<WorldTile> attackRange(bool flip)
	{
		if (flip)
		{
			if (_slideAttackPosCheckFlip == actor.current_tile)
			{
				_slideAttackTilesFlipCache++;
				return _slideAttackTilesFlip;
			}
			_slideAttackTilesFlipCache = 0;
			_slideAttackTilesFlip.Clear();
			_slideAttackPosCheckFlip = actor.current_tile;
		}
		else
		{
			if (_slideAttackPosCheckNoFlip == actor.current_tile)
			{
				_slideAttackTilesNoFlipCache++;
				return _slideAttackTilesNoFlip;
			}
			_slideAttackTilesNoFlipCache = 0;
			_slideAttackTilesNoFlip.Clear();
			_slideAttackPosCheckNoFlip = actor.current_tile;
		}
		int num = 0;
		num = ((!flip) ? 20 : (-25));
		for (int i = 0; i < 4; i++)
		{
			for (int j = 0; j < 35; j++)
			{
				WorldTile tile = World.world.GetTile(actor.current_tile.x + j - 15 + num, actor.current_tile.y - i + 2);
				if (tile != null)
				{
					if (flip)
					{
						_slideAttackTilesFlip.Add(tile);
					}
					if (!flip)
					{
						_slideAttackTilesNoFlip.Add(tile);
					}
				}
			}
		}
		if (flip)
		{
			return _slideAttackTilesFlip;
		}
		return _slideAttackTilesNoFlip;
	}

	private static bool hasTarget(WorldTile tTile, Actor pActor)
	{
		if (tTile.hasBuilding() && tTile.building.isUsable())
		{
			return true;
		}
		if (!tTile.hasUnits())
		{
			return false;
		}
		Kingdom tIgnoredKingdom = getIgnoredKingdom(pActor);
		bool tTargetFound = false;
		tTile.doUnits(delegate(Actor pActor)
		{
			if (pActor.position_height > 0f)
			{
				return true;
			}
			if (pActor.kingdom == tIgnoredKingdom)
			{
				return true;
			}
			tTargetFound = true;
			return false;
		});
		return tTargetFound;
	}

	public void setFrames(DragonState pDragonState, bool pForce = false)
	{
		if (state != pDragonState || pForce)
		{
			actor.setShowShadow(pDragonState == DragonState.Fly);
			state = pDragonState;
			playSound(state);
			DragonAssetContainer asset = dragonAsset.getAsset(pDragonState);
			spriteAnimation.setFrames(asset.frames);
			spriteAnimation.timeBetweenFrames = asset.speed;
			spriteAnimation.resetAnim();
			spriteAnimation.looped = true;
		}
	}

	internal static bool clickToWakeup(BaseSimObject pTarget, WorldTile pTile = null)
	{
		if (pTarget.a.isTask("dragon_sleep"))
		{
			pTarget.a.cancelAllBeh();
			pTarget.a.setTask("dragon_wakeup");
			return true;
		}
		return false;
	}

	internal static bool canFlip(BaseSimObject pTarget = null, WorldTile pTile = null)
	{
		switch (pTarget.a.getActorComponent<Dragon>().state)
		{
		case DragonState.Fly:
		case DragonState.Idle:
			return true;
		case DragonState.LandAttack:
		case DragonState.Death:
		case DragonState.SleepStart:
		case DragonState.SleepLoop:
		case DragonState.SleepUp:
		case DragonState.Landing:
		case DragonState.Slide:
		case DragonState.Up:
			return false;
		default:
			return true;
		}
	}

	internal static bool getHit(BaseSimObject pSelf, BaseSimObject pAttackedBy = null, WorldTile pTile = null)
	{
		Actor a = pSelf.a;
		Dragon actorComponent = a.getActorComponent<Dragon>();
		if (WorldLawLibrary.world_law_peaceful_monsters.isEnabled())
		{
			return true;
		}
		bool flag = false;
		actorComponent.aggroTargets.RemoveWhere((Actor tAttacker) => tAttacker.isRekt());
		if (pAttackedBy != null)
		{
			if (pAttackedBy.isActor() && actorComponent.aggroTargets.Add(pAttackedBy.a))
			{
				flag = actorComponent.aggroTargets.Count == 1;
			}
			if (pAttackedBy.hasCity())
			{
				a.data.set("cityToAttack", pAttackedBy.getCity().data.id);
				a.data.set("attacksForCity", Randy.randomInt(4, 12));
			}
		}
		switch (a.ai.task?.id)
		{
		case "dragon_sleep":
			a.data.set("justGotHit", pData: true);
			a.cancelAllBeh();
			a.setTask("dragon_wakeup");
			break;
		case "dragon_idle":
		{
			a.data.get("landAttacks", out var pResult, 0);
			if (pResult > 2 || shouldFly(a) || pAttackedBy == null)
			{
				a.data.set("justGotHit", pData: true);
				a.cancelAllBeh();
				a.setTask("dragon_up");
			}
			else if (!pAttackedBy.isFlying() && actorComponent.landAttackRange(pAttackedBy.current_tile) && canLand(a))
			{
				a.cancelAllBeh();
				a.setTask("dragon_land_attack");
			}
			break;
		}
		case "dragon_fly":
			if (flag)
			{
				a.cancelAllBeh();
				if (!pAttackedBy.isFlying() && actorComponent.landAttackRange(pAttackedBy.current_tile) && canLand(a) && actorComponent.lastLanded != a.current_tile)
				{
					a.setTask("dragon_land");
				}
				else if (actorComponent.targetWithinSlide(pAttackedBy.current_tile))
				{
					a.setTask("dragon_slide");
				}
				else
				{
					a.setTask("dragon_fly");
				}
			}
			break;
		case "dragon_wakeup":
		case "dragon_up":
			a.data.set("justGotHit", pData: true);
			break;
		}
		return true;
	}

	internal static bool dragonFall(BaseSimObject pTarget, WorldTile pTile, float pElapsed)
	{
		Dragon actorComponent = pTarget.a.getActorComponent<Dragon>();
		SpriteAnimation spriteAnimation = actorComponent.spriteAnimation;
		spriteAnimation.looped = false;
		spriteAnimation.ignorePause = true;
		if (pTarget.isFlying())
		{
			actorComponent.setFrames(DragonState.Landing);
			if (spriteAnimation.currentFrameIndex < spriteAnimation.frames.Length - 1)
			{
				return true;
			}
			pTarget.a.setFlying(pVal: false);
			return true;
		}
		actorComponent.setFrames(DragonState.Death);
		if (spriteAnimation.currentFrameIndex == spriteAnimation.frames.Length - 1)
		{
			pTarget.a.updateDeadBlackAnimation(World.world.elapsed);
		}
		return true;
	}

	public override void update(float pElapsed)
	{
		base.update(pElapsed);
		if (!actor.isRekt() && !World.world.isPaused())
		{
			checkLiquid();
		}
	}

	internal void checkLiquid()
	{
		if (actor.isFlying() || actor.is_moving || actor.isEgg() || !actor.current_tile.Type.liquid)
		{
			return;
		}
		if (actor.hasTask())
		{
			if (actor.isTask("dragon_up") || actor.isTask("dragon_wakeup"))
			{
				return;
			}
			if (actor.isTask("dragon_sleep"))
			{
				actor.cancelAllBeh();
				actor.setTask("dragon_wakeup");
				return;
			}
		}
		actor.cancelAllBeh();
		actor.setTask("dragon_up");
	}

	public HashSet<WorldTile> getLandAttackTiles()
	{
		return _landAttackTiles;
	}
}
// --- End of File: Dragon.cs ---



// --- Start of File: DragonAsset.cs ---
using System.Collections.Generic;
using UnityEngine;

public class DragonAsset : ScriptableObject
{
	private Dictionary<DragonState, DragonAssetContainer> _dict;

	public DragonAssetContainer[] list;

	public DragonAssetContainer getAsset(DragonState pState)
	{
		if (_dict == null)
		{
			_dict = new Dictionary<DragonState, DragonAssetContainer>();
			DragonAssetContainer[] array = list;
			foreach (DragonAssetContainer dragonAssetContainer in array)
			{
				_dict.Add(dragonAssetContainer.id, dragonAssetContainer);
			}
		}
		return _dict[pState];
	}
}
// --- End of File: DragonAsset.cs ---



// --- Start of File: DragonAssetContainer.cs ---
using System;
using UnityEngine;

[Serializable]
public class DragonAssetContainer
{
	public string name;

	public DragonState id;

	public Sprite[] frames;

	public DragonState[] states;

	public float speed = 0.1f;
}
// --- End of File: DragonAssetContainer.cs ---



// --- Start of File: DragonState.cs ---
public enum DragonState
{
	Fly,
	LandAttack,
	Death,
	SleepStart,
	SleepLoop,
	SleepUp,
	Landing,
	Slide,
	Up,
	Idle
}
// --- End of File: DragonState.cs ---



// --- Start of File: DragOrderContainer.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class DragOrderContainer : MonoBehaviour
{
	public enum SnapAxis
	{
		Horizontal,
		Vertical,
		No
	}

	internal static float drag_delay = 0.25f;

	public MonoBehaviour scroll_rect;

	public SnapAxis snapping_axis = SnapAxis.No;

	public bool limit_moving;

	public bool delay_before_drag = true;

	public bool debug;

	public Action on_order_changed;

	internal DragOrderElement dragging_element;

	internal bool is_anything_dragging;

	internal RectTransform rect_transform;

	internal LayoutGroup grid_layout;

	internal LayoutElement layout_element;

	private List<DragOrderElement> _elements = new List<DragOrderElement>();

	private Dictionary<int, DragOrderElement> _elements_dict = new Dictionary<int, DragOrderElement>();

	private Dictionary<int, Vector2> _children_positions = new Dictionary<int, Vector2>();

	private Dictionary<int, Rect> _children_rects = new Dictionary<int, Rect>();

	private Transform _to_ignore_in_intersection;

	private int _previous_elements_count;

	private bool _marked_for_update;

	private int _marked_for_update_on_frame;

	private bool _initialized;

	private void Awake()
	{
		if ((Object)(object)scroll_rect == (Object)null)
		{
			scroll_rect = (MonoBehaviour)(object)((Component)this).GetComponentInParent<ScrollRectExtended>();
		}
		if ((Object)(object)scroll_rect == (Object)null)
		{
			scroll_rect = (MonoBehaviour)(object)((Component)this).GetComponentInParent<ScrollRect>();
		}
		rect_transform = ((Component)this).GetComponent<RectTransform>();
		grid_layout = ((Component)this).GetComponent<LayoutGroup>();
		layout_element = ((Component)this).gameObject.AddOrGetComponent<LayoutElement>();
		((Behaviour)layout_element).enabled = false;
	}

	private void markForUpdate()
	{
		_marked_for_update = true;
		_marked_for_update_on_frame = Time.frameCount;
	}

	private void OnApplicationFocus(bool pHasFocus)
	{
		if (!pHasFocus)
		{
			disable();
		}
	}

	private void OnEnable()
	{
		markForUpdate();
		ScrollWindow.addCallbackShow(onWindowClose);
		ScrollWindow.addCallbackHide(onWindowClose);
	}

	private void OnDisable()
	{
		disable();
		ScrollWindow.removeCallbackShow(onWindowClose);
		ScrollWindow.removeCallbackHide(onWindowClose);
	}

	private void onWindowClose(string pId)
	{
		disable();
	}

	private void disable()
	{
		((Behaviour)grid_layout).enabled = true;
		LayoutRebuilder.MarkLayoutForRebuild(rect_transform);
		if ((Object)(object)dragging_element != (Object)null)
		{
			dragging_element.stopDrag();
		}
		foreach (DragOrderElement element in _elements)
		{
			if (!element.is_target_reached)
			{
				element.is_target_reached = true;
				element.unsetOnTop();
			}
		}
	}

	private void Update()
	{
		if (_marked_for_update && _marked_for_update_on_frame != Time.frameCount)
		{
			_marked_for_update = false;
			updateChildrenData();
		}
		checkIntersections();
		updatePositions();
	}

	private void OnDrawGizmos()
	{
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		if (!debug)
		{
			return;
		}
		foreach (Rect value in _children_rects.Values)
		{
			Rect current = value;
			((Rect)(ref current)).min = Vector2.op_Implicit(((Transform)rect_transform).TransformPoint(Vector2.op_Implicit(((Rect)(ref current)).min)));
			((Rect)(ref current)).max = Vector2.op_Implicit(((Transform)rect_transform).TransformPoint(Vector2.op_Implicit(((Rect)(ref current)).max)));
			drawRect(current, Color.green);
		}
	}

	private void checkIntersections()
	{
		if (is_anything_dragging)
		{
			DragOrderElement intersectedWith = getIntersectedWith();
			if ((Object)(object)intersectedWith == (Object)null)
			{
				_to_ignore_in_intersection = null;
			}
			else if (!((Object)(object)intersectedWith.main_transform == (Object)(object)_to_ignore_in_intersection))
			{
				_to_ignore_in_intersection = (Transform)(object)intersectedWith.main_transform;
				switchElements(dragging_element, intersectedWith);
				on_order_changed?.Invoke();
			}
		}
	}

	private DragOrderElement getIntersectedWith()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_012b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0130: Unknown result type (might be due to invalid IL or missing references)
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		int order_index = dragging_element.order_index;
		Vector2 val = Vector2.op_Implicit(((Transform)dragging_element.main_transform).localPosition);
		RectTransform obj = rect_transform;
		Rect val2 = _children_rects[order_index];
		Debug.DrawLine(((Transform)obj).TransformPoint(Vector2.op_Implicit(((Rect)(ref val2)).center)), ((Transform)rect_transform).TransformPoint(Vector2.op_Implicit(val)));
		if (snapping_axis != SnapAxis.No)
		{
			int key = 0;
			int key2 = _elements.Count - 1;
			Rect val3 = _children_rects[key];
			Rect val4 = _children_rects[key2];
			if (snapping_axis == SnapAxis.Horizontal)
			{
				if (val.x <= ((Rect)(ref val3)).xMax)
				{
					return _elements_dict[key];
				}
				if (val.x >= ((Rect)(ref val4)).xMin)
				{
					return _elements_dict[key2];
				}
			}
			if (snapping_axis == SnapAxis.Vertical)
			{
				if (val.y >= ((Rect)(ref val3)).yMax)
				{
					return _elements_dict[key];
				}
				if (val.y <= ((Rect)(ref val4)).yMin)
				{
					return _elements_dict[key2];
				}
			}
		}
		for (int i = 0; i < _elements.Count; i++)
		{
			if (i != order_index)
			{
				Rect val5 = _children_rects[i];
				if (((Rect)(ref val5)).Contains(val))
				{
					return _elements_dict[i];
				}
			}
		}
		return null;
	}

	private void updatePositions()
	{
		if (((Behaviour)grid_layout).enabled)
		{
			return;
		}
		bool flag = false;
		foreach (DragOrderElement element in _elements)
		{
			if (!((Object)(object)element == (Object)(object)dragging_element))
			{
				element.updatePosition();
				if (!element.is_target_reached)
				{
					flag = true;
				}
			}
		}
		if (!flag && !is_anything_dragging)
		{
			((Behaviour)grid_layout).enabled = true;
		}
	}

	public void updateChildrenData()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0102: Unknown result type (might be due to invalid IL or missing references)
		//IL_0104: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		LayoutElement obj = layout_element;
		Rect rect = rect_transform.rect;
		obj.minHeight = ((Rect)(ref rect)).height;
		LayoutElement obj2 = layout_element;
		rect = rect_transform.rect;
		obj2.minWidth = ((Rect)(ref rect)).width;
		_elements.Clear();
		_elements_dict.Clear();
		_children_positions.Clear();
		_children_rects.Clear();
		DragOrderElement[] componentsInChildren = ((Component)rect_transform).GetComponentsInChildren<DragOrderElement>();
		int num = 0;
		DragOrderElement[] array = componentsInChildren;
		foreach (DragOrderElement dragOrderElement in array)
		{
			Vector2 val = ((!dragOrderElement.is_target_reached && _previous_elements_count == componentsInChildren.Length) ? dragOrderElement.current_destination : Vector2.op_Implicit(((Transform)dragOrderElement.main_transform).localPosition));
			dragOrderElement.order_index = num;
			_elements.Add(dragOrderElement);
			_elements_dict.Add(num, dragOrderElement);
			_children_positions.Add(num, val);
			Rect rect2 = dragOrderElement.getRect();
			_children_rects.Add(num, rect2);
			dragOrderElement.current_destination = val;
			dragOrderElement.unsetOnTop();
			num++;
		}
		_previous_elements_count = componentsInChildren.Length;
	}

	private void switchElements(DragOrderElement pFirst, DragOrderElement pSecond)
	{
		((Transform)pFirst.main_transform).SetSiblingIndex(((Transform)pSecond.main_transform).GetSiblingIndex());
		int order_index = pFirst.order_index;
		int order_index2 = pSecond.order_index;
		bool tIsAscending = order_index > order_index2;
		pFirst.order_index = order_index2;
		_elements.Sort((DragOrderElement e1, DragOrderElement e2) => sort(e1, e2, tIsAscending));
		int order_index3 = pFirst.order_index;
		foreach (DragOrderElement element in _elements)
		{
			if (!((Object)(object)element == (Object)(object)pFirst) && (!tIsAscending || element.order_index >= order_index3) && (tIsAscending || element.order_index <= order_index3) && element.order_index == order_index3)
			{
				element.order_index += (tIsAscending ? 1 : (-1));
				order_index3 = element.order_index;
			}
		}
		foreach (DragOrderElement element2 in _elements)
		{
			_elements_dict[element2.order_index] = element2;
		}
	}

	public Vector3 getChildPosition(int pIndex)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.op_Implicit(_children_positions[pIndex]);
	}

	private int sort(DragOrderElement pFirst, DragOrderElement pSecond, bool pIsAscending)
	{
		return pFirst.order_index.CompareTo(pSecond.order_index) * (pIsAscending ? 1 : (-1));
	}

	private static void drawRect(Rect pRect, Color pColor)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = Vector2.op_Implicit(((Rect)(ref pRect)).min);
		Vector3 val2 = Vector2.op_Implicit(((Rect)(ref pRect)).max);
		Debug.DrawLine(val, new Vector3(val.x, val2.y), pColor);
		Debug.DrawLine(new Vector3(val.x, val2.y), val2, pColor);
		Debug.DrawLine(val2, new Vector3(val2.x, val.y), pColor);
		Debug.DrawLine(val, new Vector3(val2.x, val.y), pColor);
	}
}
// --- End of File: DragOrderContainer.cs ---



// --- Start of File: DragOrderElement.cs ---
using LayoutGroupExt;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class DragOrderElement : MonoBehaviour, IDraggable, IEndDragHandler, IEventSystemHandler
{
	[SerializeField]
	private bool _spawn_particles_on_drag = true;

	public RectTransform main_transform;

	public bool can_be_dragged = true;

	private DragOrderContainer _container;

	private int _parent_canvas_sorting_order;

	private Canvas _canvas;

	private GraphicRaycaster _raycaster;

	private Button _button;

	private Transform _current_parent;

	internal Vector2 current_destination;

	internal bool is_target_reached;

	internal int order_index;

	private bool _drag_initialized;

	private float _drag_started_at;

	private int _mouse_button = -1;

	private Vector3 _prev_mouse_position;

	public bool spawn_particles_on_drag => _spawn_particles_on_drag;

	private void Start()
	{
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Expected O, but got Unknown
		if ((Object)(object)main_transform == (Object)null)
		{
			main_transform = ((Component)this).GetComponent<RectTransform>();
		}
		_parent_canvas_sorting_order = ((Component)main_transform).gameObject.GetComponentInParent<Canvas>().sortingOrder;
		_canvas = ((Component)main_transform).gameObject.AddComponent<Canvas>();
		_canvas.sortingOrder = _parent_canvas_sorting_order;
		_canvas.overrideSorting = false;
		_raycaster = ((Component)main_transform).gameObject.AddComponent<GraphicRaycaster>();
		_raycaster.blockingObjects = (BlockingObjects)3;
		_raycaster.blockingMask = LayerMask.op_Implicit(-1);
		_raycaster.ignoreReversedGraphics = true;
		_button = ((Component)this).GetComponent<Button>();
		((UnityEvent)_button.onClick).AddListener((UnityAction)delegate
		{
			_container?.updateChildrenData();
		});
		is_target_reached = true;
		checkContainer();
	}

	private void checkContainer()
	{
		if (!((Object)(object)_container != (Object)null))
		{
			_container = ((Component)main_transform).GetComponentInParent<DragOrderContainer>();
		}
	}

	private void checkParent()
	{
		Transform parent = ((Transform)main_transform).parent;
		if (!((Object)(object)_current_parent == (Object)(object)parent))
		{
			_current_parent = parent;
			checkContainer();
		}
	}

	private void Update()
	{
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		if (!((Behaviour)this).enabled)
		{
			return;
		}
		checkParent();
		if ((Object)(object)_container == (Object)null)
		{
			return;
		}
		checkDrag();
		if (((Behaviour)_container.grid_layout).enabled)
		{
			return;
		}
		if ((Object)(object)_container.dragging_element == (Object)(object)this)
		{
			moveDraggingTab();
		}
		else if (!is_target_reached)
		{
			if (Vector3.Distance(((Transform)main_transform).localPosition, Vector2.op_Implicit(current_destination)) < 0.1f)
			{
				is_target_reached = true;
				unsetOnTop();
			}
			else
			{
				((Transform)main_transform).localPosition = Vector3.Lerp(((Transform)main_transform).localPosition, Vector2.op_Implicit(current_destination), Time.deltaTime * 10f);
			}
		}
	}

	private void setOnTop()
	{
		_canvas.overrideSorting = true;
		_canvas.sortingOrder = 24;
	}

	internal void unsetOnTop()
	{
		if (_canvas.overrideSorting)
		{
			_canvas.sortingOrder = _parent_canvas_sorting_order;
			_canvas.overrideSorting = false;
		}
	}

	public void updatePosition()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Vector2.op_Implicit(getChildPositionInContainer());
		if (!(Vector2.op_Implicit(((Transform)main_transform).localPosition) == val) && !(current_destination == val))
		{
			current_destination = val;
			is_target_reached = false;
		}
	}

	private void moveDraggingTab()
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_010e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		if (!_container.is_anything_dragging)
		{
			endDrag();
			return;
		}
		if (!InputHelpers.GetMouseButton(_mouse_button))
		{
			endDrag();
			return;
		}
		Vector3 mousePosition = Input.mousePosition;
		switch (_container.snapping_axis)
		{
		case DragOrderContainer.SnapAxis.Horizontal:
			mousePosition.y = ((Transform)main_transform).position.y;
			break;
		case DragOrderContainer.SnapAxis.Vertical:
			mousePosition.x = ((Transform)main_transform).position.x;
			break;
		}
		if (!_container.limit_moving)
		{
			((Transform)main_transform).position = mousePosition;
			return;
		}
		Rect worldRect = _container.rect_transform.GetWorldRect();
		getGridValues(_container.grid_layout, out var pCellSize, out var _);
		pCellSize *= 0.5f;
		mousePosition.x = Mathf.Min(mousePosition.x, ((Rect)(ref worldRect)).xMax - pCellSize.x);
		mousePosition.x = Mathf.Max(mousePosition.x, ((Rect)(ref worldRect)).xMin + pCellSize.x);
		mousePosition.y = Mathf.Min(mousePosition.y, ((Rect)(ref worldRect)).yMax - pCellSize.y);
		mousePosition.y = Mathf.Max(mousePosition.y, ((Rect)(ref worldRect)).yMin + pCellSize.y);
		((Transform)main_transform).position = mousePosition;
	}

	private void checkDrag()
	{
		checkDragBegin();
		checkDragEnd();
	}

	private void checkDragBegin()
	{
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		if (Config.isDraggingItem() || _container.is_anything_dragging || !can_be_dragged)
		{
			return;
		}
		if (_container.delay_before_drag && !isMouseOver())
		{
			_drag_initialized = false;
			return;
		}
		if (InputHelpers.GetAnyMouseButtonDown() && isMouseOver())
		{
			_mouse_button = InputHelpers.GetAnyMouseButtonDownIndex();
			_drag_started_at = Time.time;
			if (!_container.delay_before_drag)
			{
				_drag_started_at -= DragOrderContainer.drag_delay;
				_prev_mouse_position = Input.mousePosition;
			}
			_drag_initialized = true;
		}
		if (_drag_initialized)
		{
			if (!InputHelpers.GetMouseButton(_mouse_button))
			{
				_drag_initialized = false;
			}
			else if ((_container.delay_before_drag || shouldStartDrag(Vector2.op_Implicit(Input.mousePosition), Vector2.op_Implicit(_prev_mouse_position))) && !(Time.time - _drag_started_at < DragOrderContainer.drag_delay))
			{
				startDrag();
			}
		}
	}

	private void checkDragEnd()
	{
		if (InputHelpers.GetMouseButtonUp(_mouse_button) && _container.is_anything_dragging)
		{
			_drag_initialized = false;
			endDrag();
		}
	}

	public void OnEndDrag(PointerEventData pData)
	{
		if (_container.is_anything_dragging)
		{
			_drag_initialized = false;
			endDrag();
		}
	}

	private void startDrag()
	{
		_drag_started_at = Time.realtimeSinceStartup;
		_container.dragging_element = this;
		Config.setDraggingObject(this);
		_container.is_anything_dragging = true;
		((Behaviour)_container.grid_layout).enabled = false;
		((Behaviour)_container.layout_element).enabled = true;
		((Selectable)_button).interactable = false;
		if ((Object)(object)_container.scroll_rect != (Object)null)
		{
			((Behaviour)_container.scroll_rect).enabled = false;
		}
		_container.updateChildrenData();
		setOnTop();
	}

	public void stopDrag()
	{
		endDrag();
	}

	private void endDrag()
	{
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		if (Config.isDraggingObject(this))
		{
			((Selectable)_button).interactable = true;
			_mouse_button = -1;
			if ((Object)(object)_container.scroll_rect != (Object)null)
			{
				((Behaviour)_container.scroll_rect).enabled = true;
			}
			Vector3 childPositionInContainer = getChildPositionInContainer();
			current_destination = Vector2.op_Implicit(childPositionInContainer);
			is_target_reached = false;
			if (!((Object)(object)_container.dragging_element != (Object)(object)this))
			{
				((Behaviour)_container.layout_element).enabled = false;
				_drag_initialized = false;
				_container.dragging_element = null;
				Config.clearDraggingObject();
				_container.is_anything_dragging = false;
			}
		}
	}

	private Vector3 getChildPositionInContainer()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return _container.getChildPosition(order_index);
	}

	private bool isMouseOver()
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Vector2.op_Implicit(((Transform)_container.rect_transform).InverseTransformPoint(Input.mousePosition));
		Rect rect = getRect();
		return ((Rect)(ref rect)).Contains(val);
	}

	public Rect getRect()
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		getGridValues(_container.grid_layout, out var pCellSize, out var pSpacing);
		Vector2 val = Vector2.op_Implicit(((Transform)main_transform).localPosition) - pCellSize * main_transform.pivot - pSpacing / 2f;
		Vector2 val2 = pCellSize + pSpacing;
		return new Rect(val, val2);
	}

	private void getGridValues(LayoutGroup pLayoutGroup, out Vector2 pCellSize, out Vector2 pSpacing)
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		GridLayoutGroup val = (GridLayoutGroup)(object)((pLayoutGroup is GridLayoutGroup) ? pLayoutGroup : null);
		if (val == null)
		{
			if (pLayoutGroup is GridLayoutGroupExtended gridLayoutGroupExtended)
			{
				pCellSize = gridLayoutGroupExtended.cellSize;
				pSpacing = gridLayoutGroupExtended.spacing;
			}
			else
			{
				pCellSize = Vector2.zero;
				pSpacing = Vector2.zero;
			}
		}
		else
		{
			pCellSize = val.cellSize;
			pSpacing = val.spacing;
		}
	}

	private static bool shouldStartDrag(Vector2 pPressPos, Vector2 pCurrentPos)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		float num = EventSystem.current.pixelDragThreshold;
		Vector2 val = pPressPos - pCurrentPos;
		return ((Vector2)(ref val)).sqrMagnitude >= num * num;
	}

	private void OnDisable()
	{
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Expected O, but got Unknown
		DragOrderContainer container = _container;
		if (container != null && container.is_anything_dragging)
		{
			OnEndDrag(new PointerEventData(EventSystem.current));
		}
	}

	public void KillDrag()
	{
		OnDisable();
	}

	Transform IDraggable.get_transform()
	{
		return ((Component)this).transform;
	}
}
// --- End of File: DragOrderElement.cs ---



// --- Start of File: DragSnapElement.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

[RequireComponent(typeof(LayoutElement))]
public class DragSnapElement : MonoBehaviour, IInitializePotentialDragHandler, IEventSystemHandler, IDragHandler, IBeginDragHandler, IEndDragHandler, IScrollHandler, IDraggable, IPointerEnterHandler, IPointerExitHandler
{
	[SerializeField]
	private bool _spawn_particles_on_drag = true;

	[SerializeField]
	private bool _touch_drag_delay;

	private float _drag_timer_started_at;

	private Tweener _tweener;

	private LayoutElement _layout_element;

	private Button _button;

	private Vector3 _start_local_position;

	private Transform _start_parent;

	public float limit_max_drag_distance = 77f;

	public float snapback_max_distance = 77f;

	public float snapback_speed_max_distance = 0.35f;

	public float snapback_min_distance = 22f;

	public float snapback_speed_min_distance = 0.9f;

	public Transform attach_parent;

	public Transform fly_back_parent;

	public Ease ease = (Ease)24;

	public float speed = 0.4f;

	private ScrollRect _scroll_rect;

	private ScrollRectExtended _scroll_rect_extended;

	private bool _initial_ignore_layout;

	private bool _hovered;

	private bool _is_dragging;

	public bool spawn_particles_on_drag => _spawn_particles_on_drag;

	private void Start()
	{
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		_layout_element = ((Component)this).GetComponent<LayoutElement>();
		_button = ((Component)this).GetComponent<Button>();
		_start_parent = ((Component)this).transform.parent;
		_start_local_position = ((Component)this).transform.localPosition;
		_initial_ignore_layout = _layout_element.ignoreLayout;
		if ((Object)(object)attach_parent == (Object)null)
		{
			attach_parent = World.world.drag_parent;
		}
		if ((Object)(object)fly_back_parent == (Object)null)
		{
			fly_back_parent = ((Component)this).transform.FindParentWithName("Content", "Viewport") ?? attach_parent;
		}
		ScrollableButton scrollableButton = default(ScrollableButton);
		if (((Component)this).gameObject.TryGetComponent<ScrollableButton>(ref scrollableButton))
		{
			((Behaviour)scrollableButton).enabled = false;
			_scroll_rect_extended = ((Component)this).gameObject.GetComponentInParent<ScrollRectExtended>();
			if ((Object)(object)_scroll_rect_extended == (Object)null)
			{
				_scroll_rect = ((Component)this).gameObject.GetComponentInParent<ScrollRect>();
			}
		}
	}

	public void OnInitializePotentialDrag(PointerEventData pEventData)
	{
		if (_touch_drag_delay)
		{
			_drag_timer_started_at = Time.time;
		}
	}

	public void OnBeginDrag(PointerEventData pEventData)
	{
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		if (!_is_dragging && !Config.isDraggingItem() && !isTouchDragDelayed())
		{
			TweenExtensions.Kill((Tween)(object)_tweener, false);
			Config.setDraggingObject(this);
			_is_dragging = true;
			((Component)this).transform.SetParent(attach_parent);
			((Behaviour)_button).enabled = false;
			((Behaviour)_layout_element).enabled = true;
			updatePosition(Vector2.op_Implicit(pEventData.position));
		}
	}

	public void OnDrag(PointerEventData pEventData)
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		if (Config.isDraggingObject(this) && !isTouchDragDelayed())
		{
			updatePosition(Vector2.op_Implicit(pEventData.position));
		}
	}

	public float getDragMod()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		if (!_is_dragging)
		{
			return 0f;
		}
		Vector3 val = _start_parent.TransformPoint(_start_local_position);
		Vector3 val2 = val - ((Component)this).transform.position;
		float num = Mathf.Clamp01(((Vector3)(ref val2)).magnitude / limit_max_drag_distance);
		if (val.y > ((Component)this).transform.position.y)
		{
			num = 0f - num;
		}
		return num;
	}

	private void updatePosition(Vector3 pTargetPosition)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = _start_parent.TransformPoint(_start_local_position);
		Vector3 val2 = pTargetPosition - val;
		if (((Vector3)(ref val2)).magnitude > limit_max_drag_distance)
		{
			((Component)this).transform.position = val + ((Vector3)(ref val2)).normalized * limit_max_drag_distance;
		}
		else
		{
			((Component)this).transform.position = pTargetPosition;
		}
	}

	public void OnEndDrag(PointerEventData pEventData)
	{
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Expected O, but got Unknown
		if (Config.isDraggingItem() && Config.isDraggingObject(this))
		{
			Config.clearDraggingObject();
			_is_dragging = false;
			_drag_timer_started_at = 0f;
			_layout_element.ignoreLayout = true;
			((Component)this).transform.SetParent(fly_back_parent);
			Tweener tweener = _tweener;
			if (tweener != null)
			{
				TweenExtensions.Kill((Tween)(object)tweener, false);
			}
			Vector3 val = _start_parent.TransformPoint(_start_local_position);
			Vector3 val2 = val - ((Component)this).transform.position;
			float magnitude = ((Vector3)(ref val2)).magnitude;
			float num = dragSpeed(magnitude);
			_tweener = (Tweener)(object)TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(DOTween.To((DOGetter<Vector3>)(() => ((Component)this).transform.position), (DOSetter<Vector3>)delegate(Vector3 pVector)
			{
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				((Component)this).transform.position = pVector;
			}, val, num), ease), new TweenCallback(resetElement));
			Tooltip.blockTooltips(num * 0.7f);
		}
	}

	public void resetElement()
	{
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		if (_hovered)
		{
			_button.TriggerHover();
		}
		if (!((Object)(object)_start_parent == (Object)null) && (!((Object)(object)fly_back_parent != (Object)(object)_start_parent) || !((Object)(object)_start_parent == (Object)(object)((Component)this).transform.parent)))
		{
			((Component)this).transform.SetParent(_start_parent);
			((Component)this).transform.localPosition = _start_local_position;
			((Behaviour)_button).enabled = true;
			_layout_element.ignoreLayout = _initial_ignore_layout;
			((Behaviour)_layout_element).enabled = false;
		}
	}

	public float dragSpeed(float pDistance)
	{
		float num = (Mathf.Clamp(pDistance, snapback_min_distance, snapback_max_distance) - snapback_min_distance) / (snapback_max_distance - snapback_min_distance);
		return Mathf.Lerp(snapback_speed_min_distance, snapback_speed_max_distance, num);
	}

	public void onWindowClose(string pId)
	{
		TweenExtensions.Kill((Tween)(object)_tweener, true);
	}

	public void OnScroll(PointerEventData pEventData)
	{
		sendMessage("OnScroll", pEventData);
	}

	public void OnPointerEnter(PointerEventData eventData)
	{
		_hovered = true;
	}

	public void OnPointerExit(PointerEventData eventData)
	{
		_hovered = false;
	}

	private void sendMessage(string pMethodName, PointerEventData pEventData)
	{
		ScrollRect scroll_rect = _scroll_rect;
		if (scroll_rect != null)
		{
			((Component)scroll_rect).SendMessage(pMethodName, (object)pEventData);
		}
		ScrollRectExtended scroll_rect_extended = _scroll_rect_extended;
		if (scroll_rect_extended != null)
		{
			((Component)scroll_rect_extended).SendMessage(pMethodName, (object)pEventData);
		}
	}

	public void OnEnable()
	{
		ScrollWindow.addCallbackHide(onWindowClose);
	}

	public void OnDisable()
	{
		ScrollWindow.removeCallbackHide(onWindowClose);
		KillDrag();
		if (TweenExtensions.IsActive((Tween)(object)_tweener))
		{
			Debug.LogError((object)"OnDisable kill called, shouldn't happen", (Object)(object)this);
			TweenExtensions.Kill((Tween)(object)_tweener, false);
		}
	}

	public void KillDrag()
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Expected O, but got Unknown
		if (_is_dragging)
		{
			OnEndDrag(new PointerEventData(EventSystem.current));
			TweenExtensions.Kill((Tween)(object)_tweener, true);
		}
	}

	private bool isTouchDragDelayed()
	{
		if (_touch_drag_delay && !InputHelpers.mouseSupported)
		{
			return Time.time - _drag_timer_started_at < 0.2f;
		}
		return false;
	}

	Transform IDraggable.get_transform()
	{
		return ((Component)this).transform;
	}
}
// --- End of File: DragSnapElement.cs ---



// --- Start of File: Drop.cs ---
using UnityEngine;

public class Drop : BaseMapObject
{
	private readonly bool DEBUG_COLOR;

	public int drop_index;

	internal bool active;

	private SpriteRenderer _sprite_renderer;

	private SpriteAnimation _sprite_animation;

	private float _currentHeightZ;

	private bool _landed;

	private DropAsset _asset;

	internal bool soundOn;

	private bool _parabolic;

	private float _falling_speed;

	private float _scale = 1f;

	private bool _force_surprise;

	private long _caster_id = -1L;

	private Vector2 _targetPosition;

	private Vector2 _startPosition;

	private float _targetHeight;

	private float _timeToTarget;

	private float _timeInAir;

	private Color _gizmoColor = Color.op_Implicit(Vector4.zero);

	private Color _gizmoColor2 = Color.op_Implicit(Vector4.zero);

	private float _rotation_speed;

	private void Awake()
	{
		_sprite_renderer = ((Component)this).gameObject.GetComponent<SpriteRenderer>();
		_sprite_animation = ((Component)this).gameObject.GetComponent<SpriteAnimation>();
	}

	public void setForceSurprise()
	{
		_force_surprise = true;
	}

	internal void prepare()
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		if (!created)
		{
			create();
		}
		((Component)this).gameObject.SetActive(true);
		m_transform.localScale = Vector3.one;
		active = true;
		_force_surprise = false;
		_timeInAir = 0f;
		_timeToTarget = 0f;
		_landed = false;
		_parabolic = false;
		soundOn = false;
		_currentHeightZ = 0f;
		_caster_id = -1L;
		((Component)this).transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, 0f));
		if (DEBUG_COLOR)
		{
			_sprite_renderer.color = Randy.getRandomColor();
		}
	}

	internal void launchStraight(WorldTile pTile, DropAsset pAsset, float zDropHeight = -1f)
	{
		//IL_0216: Unknown result type (might be due to invalid IL or missing references)
		//IL_021b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0222: Unknown result type (might be due to invalid IL or missing references)
		//IL_0227: Unknown result type (might be due to invalid IL or missing references)
		_asset = pAsset;
		if (_asset.animation_rotation)
		{
			_rotation_speed = Randy.randomFloat(_asset.animation_rotation_speed_min, _asset.animation_rotation_speed_max);
			if (Randy.randomBool())
			{
				_rotation_speed *= -1f;
			}
		}
		if (!string.IsNullOrEmpty(_asset.sound_launch))
		{
			MusicBox.playSound(_asset.sound_launch, pTile);
		}
		if (_asset.action_launch != null)
		{
			_asset.action_launch();
		}
		_falling_speed = _asset.falling_speed + Randy.randomFloat(0f, _asset.falling_speed_random);
		if (_asset.cached_sprites == null || _asset.cached_sprites.Length == 0)
		{
			_asset.cached_sprites = SpriteTextureLoader.getSpriteList(_asset.path_texture);
		}
		((Renderer)_sprite_renderer).sharedMaterial = LibraryMaterials.instance.dict[_asset.material];
		_sprite_animation.setFrames(_asset.cached_sprites);
		if (_asset.random_flip)
		{
			_sprite_renderer.flipX = (Randy.randomBool() ? true : false);
		}
		if (_asset.animated)
		{
			_sprite_animation.isOn = true;
			_sprite_animation.timeBetweenFrames = _asset.animation_speed + Randy.randomFloat(0f, _asset.animation_speed_random);
		}
		else
		{
			_sprite_animation.isOn = false;
		}
		if (_asset.random_frame)
		{
			_sprite_animation.setRandomFrame();
		}
		_sprite_animation.forceUpdateFrame();
		current_tile = pTile;
		if (zDropHeight != -1f)
		{
			_currentHeightZ = zDropHeight;
		}
		else
		{
			_currentHeightZ = (int)Randy.randomFloat(pAsset.falling_height.x, pAsset.falling_height.y);
		}
		current_position = new Vector2(pTile.posV3.x, pTile.posV3.y);
		_startPosition = current_position;
		updatePosition();
	}

	public void launchParabolic(float pStartHeight, float pMinHeight, float pMaxHeight, float pMinRadius, float pMaxRadius)
	{
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Randy.randomPointOnCircle(pMinRadius, pMaxRadius);
		_targetPosition = _startPosition + val;
		_targetHeight = Randy.randomFloat(pMinHeight, pMaxHeight);
		_startPosition.y += pStartHeight;
		_currentHeightZ = _startPosition.y;
		_timeInAir = 0f;
		if (_scale < 1f)
		{
			_falling_speed /= _scale * 2f;
		}
		float num = Toolbox.DistVec2Float(_startPosition, _targetPosition);
		_timeToTarget = (num + _targetHeight * 3f) * 0.25f / _falling_speed;
		if (_timeToTarget < 1f)
		{
			_timeToTarget += 0.5f;
		}
		_parabolic = true;
		updatePosition();
	}

	private void updateStraightFall(float pElapsed)
	{
		float num = 15f * pElapsed;
		num = ((!(_scale < 1f)) ? (num * _falling_speed) : (num * (_falling_speed / (_scale * 2f))));
		if (_currentHeightZ < 0f)
		{
			num = 0f;
		}
		_currentHeightZ -= num * _scale;
		applyRandomXMove(num);
		if (_currentHeightZ <= 0f)
		{
			_currentHeightZ = 0f;
			updatePosition();
			current_tile = World.world.GetTile((int)current_position.x, (int)current_position.y);
			land();
		}
		else
		{
			updatePosition();
		}
	}

	private void applyRandomXMove(float pChangeX)
	{
		if (_asset.falling_random_x_move && !(pChangeX <= 0f) && Randy.randomBool())
		{
			if (Randy.randomBool())
			{
				current_position.x -= 1f * _scale;
			}
			else
			{
				current_position.x += 1f * _scale;
			}
		}
	}

	private void land()
	{
		if (current_tile != null)
		{
			if (_asset.action_landed != null)
			{
				_asset.action_landed(current_tile, _asset.id);
			}
			if (_asset.action_landed_drop != null)
			{
				_asset.action_landed_drop(this, current_tile, _asset.id);
			}
			if (current_tile.zone.visible && _asset.sound_drop != string.Empty)
			{
				MusicBox.playSound(_asset.sound_drop, current_tile);
			}
			if (_force_surprise || _asset.surprises_units)
			{
				ActionLibrary.suprisedByArchitector(null, current_tile);
			}
		}
		World.world.drop_manager.landDrop(this);
		_landed = true;
	}

	public override void update(float pElapsed)
	{
		if (!_landed)
		{
			_sprite_animation.update(pElapsed);
			if (_parabolic)
			{
				updateParabolicFall(pElapsed);
			}
			else
			{
				updateStraightFall(pElapsed);
			}
			if (!_landed && _asset.animation_rotation)
			{
				updateRotation(pElapsed);
			}
		}
	}

	private void updateRotation(float pElapsed)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		Quaternion rotation = ((Component)this).transform.rotation;
		float num = ((Quaternion)(ref rotation)).eulerAngles.z + _rotation_speed * pElapsed;
		((Component)this).transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, num));
	}

	private void updateParabolicFall(float pElapsed)
	{
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		if (!(_timeInAir > _timeToTarget))
		{
			_timeInAir += pElapsed;
			if (_timeInAir > _timeToTarget)
			{
				_timeInAir = _timeToTarget;
			}
			float num = _timeInAir / _timeToTarget;
			Vector2 val = Toolbox.ParabolaDrag(_startPosition, _targetPosition, _targetHeight, num);
			Vector2 val2 = Vector2.Lerp(_startPosition, _targetPosition, num);
			_currentHeightZ = val.y - val2.y;
			float x = val.x;
			float num2 = val.y - _currentHeightZ;
			((Vector2)(ref current_position)).Set(x, num2);
			if (current_position == _targetPosition)
			{
				current_tile = World.world.GetTile((int)_targetPosition.x, (int)_targetPosition.y);
				land();
			}
			else if (_timeInAir >= _timeToTarget)
			{
				current_tile = World.world.GetTile((int)_targetPosition.x, (int)_targetPosition.y);
				land();
			}
			else
			{
				updatePosition();
			}
		}
	}

	private void updatePosition()
	{
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		Vector3 position = default(Vector3);
		((Vector3)(ref position))._002Ector(current_position.x, current_position.y + _currentHeightZ, _currentHeightZ);
		m_transform.position = position;
	}

	public void setScale(Vector3 pVec)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		m_transform.localScale = pVec;
		_scale = pVec.x;
	}

	public void setCasterId(long pCasterId)
	{
		_caster_id = pCasterId;
	}

	public long getCasterId()
	{
		return _caster_id;
	}

	public void makeInactive()
	{
		reset();
		active = false;
		((Component)this).gameObject.SetActive(false);
	}

	public void reset()
	{
		_asset = null;
		current_tile = null;
	}

	private void OnDrawGizmos()
	{
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_0112: Unknown result type (might be due to invalid IL or missing references)
		//IL_0113: Unknown result type (might be due to invalid IL or missing references)
		//IL_0118: Unknown result type (might be due to invalid IL or missing references)
		//IL_011a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0126: Unknown result type (might be due to invalid IL or missing references)
		//IL_012b: Unknown result type (might be due to invalid IL or missing references)
		//IL_012d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Unknown result type (might be due to invalid IL or missing references)
		//IL_0138: Unknown result type (might be due to invalid IL or missing references)
		//IL_013d: Unknown result type (might be due to invalid IL or missing references)
		//IL_013f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0149: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_014c: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		if (_parabolic && !_landed && _timeToTarget != 0f && !(_timeInAir > _timeToTarget))
		{
			if (((Color)(ref _gizmoColor)).Equals(Color.op_Implicit(Vector4.zero)))
			{
				_gizmoColor = Randy.ColorHSV();
			}
			if (((Color)(ref _gizmoColor2)).Equals(Color.op_Implicit(Vector4.zero)))
			{
				_gizmoColor2 = Randy.ColorHSV();
				_gizmoColor2.a = 0.5f;
			}
			Gizmos.color = _gizmoColor;
			Vector2 val = _startPosition;
			Vector2 val2 = _startPosition;
			int num = 60;
			for (int i = 1; i <= num; i++)
			{
				float pTime = (float)i / (float)num * _timeToTarget;
				Vector2 val3 = Toolbox.ParabolaDrag(_startPosition, _targetPosition, _targetHeight, pTime);
				Vector2 val4 = Toolbox.Parabola(_startPosition, _targetPosition, _targetHeight, pTime);
				Gizmos.color = _gizmoColor;
				Gizmos.DrawLine(Vector2.op_Implicit(val), Vector2.op_Implicit(val3));
				Gizmos.color = _gizmoColor2;
				Gizmos.DrawLine(Vector2.op_Implicit(val), Vector2.op_Implicit(val4));
				Gizmos.DrawLine(Vector2.op_Implicit(val3), Vector2.op_Implicit(val4));
				Gizmos.DrawLine(Vector2.op_Implicit(val2), Vector2.op_Implicit(val4));
				val = val3;
				val2 = val4;
			}
		}
	}
}
// --- End of File: Drop.cs ---



// --- Start of File: DropAsset.cs ---
using System;
using System.ComponentModel;
using UnityEngine;

[Serializable]
public class DropAsset : Asset
{
	[DefaultValue(DropType.DropGeneric)]
	public DropType type = DropType.DropGeneric;

	public bool random_frame;

	public bool random_flip;

	public bool animated;

	[DefaultValue(0.1f)]
	public float animation_speed = 0.1f;

	[DefaultValue(0.1f)]
	public float animation_speed_random = 0.1f;

	public bool animation_rotation;

	[DefaultValue(1f)]
	public float animation_rotation_speed_min = 1f;

	[DefaultValue(1f)]
	public float animation_rotation_speed_max = 1f;

	public string sound_drop;

	public string sound_launch;

	public DropsAction action_launch;

	public DropsAction action_landed;

	public DropsLandedAction action_landed_drop;

	public string building_asset;

	[DefaultValue(3.2f)]
	public float falling_speed = 3.2f;

	[DefaultValue(0.5f)]
	public float falling_speed_random = 0.5f;

	public Vector3 falling_height = Vector2.op_Implicit(new Vector2(15f, 20f));

	public bool falling_random_x_move;

	public float particle_interval;

	[DefaultValue("mat_world_object")]
	public string material = "mat_world_object";

	[DefaultValue("drops/drop_pixel")]
	public string path_texture = "drops/drop_pixel";

	[DefaultValue(1f)]
	public float default_scale = 1f;

	public bool surprises_units;

	public string drop_type_low;

	public string drop_type_high;

	[NonSerialized]
	public TopTileType cached_drop_type_low;

	[NonSerialized]
	public TopTileType cached_drop_type_high;

	[NonSerialized]
	public Sprite[] cached_sprites;

	private string[] _building_asset_split;

	public string getRandomBuildingAsset()
	{
		if (_building_asset_split == null)
		{
			_building_asset_split = building_asset.Split(',');
		}
		return _building_asset_split.GetRandom();
	}
}
// --- End of File: DropAsset.cs ---



// --- Start of File: DropManager.cs ---
using System.Collections.Generic;
using UnityEngine;

public class DropManager
{
	private List<Drop> _drops = new List<Drop>();

	private float _timeout_timer;

	private int _activeIndex;

	private GameObject _original_drop;

	private Transform _dropContainer;

	public DropManager(Transform pDropContainer)
	{
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Expected O, but got Unknown
		_dropContainer = pDropContainer;
		string text = "effects/p_drop";
		_original_drop = (GameObject)Resources.Load(text, typeof(GameObject));
	}

	public Drop spawn(WorldTile pTile, string pDropID, float zHeight = -1f, float pScale = -1f, long pCasterId = -1L)
	{
		DropAsset pAsset = AssetManager.drops.get(pDropID);
		return spawn(pTile, pAsset, zHeight, pScale, pForceSurprise: false, pCasterId);
	}

	public Drop spawn(WorldTile pTile, DropAsset pAsset, float zHeight = -1f, float pScale = -1f, bool pForceSurprise = false, long pCasterId = -1L)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		Drop @object = getObject();
		if (pForceSurprise)
		{
			@object.setForceSurprise();
		}
		@object.launchStraight(pTile, pAsset, zHeight);
		if (pScale == -1f)
		{
			pScale = pAsset.default_scale;
		}
		@object.setScale(new Vector3(pScale, pScale, ((Component)@object).transform.localScale.z));
		@object.setCasterId(pCasterId);
		return @object;
	}

	public void spawnParabolicDrop(WorldTile pTile, string pDropID, float pStartHeight = 0f, float pMinHeight = 0f, float pMaxHeight = 0f, float pMinRadius = 0f, float pMaxRadius = 0f, float pScale = -1f)
	{
		spawn(pTile, pDropID, pMinHeight, pScale, -1L).launchParabolic(pStartHeight, pMinHeight, pMaxHeight, pMinRadius, pMaxRadius);
	}

	public void clear()
	{
		List<Drop> drops = _drops;
		for (int i = 0; i < drops.Count; i++)
		{
			drops[i].makeInactive();
		}
		_activeIndex = 0;
	}

	private void killObject(Drop pObject)
	{
		pObject.makeInactive();
		int num = pObject.drop_index - 1;
		int num2 = _activeIndex - 1;
		List<Drop> drops = _drops;
		if (num != num2)
		{
			Drop drop = drops[num2];
			drops[num2] = pObject;
			drops[num] = drop;
			pObject.drop_index = num2 + 1;
			drop.drop_index = num + 1;
		}
		if (_activeIndex > 0)
		{
			_activeIndex--;
		}
	}

	public void landDrop(Drop pObject)
	{
		WorldTile current_tile = pObject.current_tile;
		killObject(pObject);
		if (current_tile != null)
		{
			World.world.flash_effects.flashPixel(current_tile, 14);
		}
	}

	public Drop getObject()
	{
		List<Drop> drops = _drops;
		Drop drop;
		if (drops.Count > _activeIndex)
		{
			drop = drops[_activeIndex];
		}
		else
		{
			drop = Object.Instantiate<GameObject>(_original_drop, _dropContainer).GetComponent<Drop>();
			((Component)drop).gameObject.layer = ((Component)_dropContainer).gameObject.layer;
			((Component)drop).transform.parent = _dropContainer;
			drops.Add(drop);
			drop.drop_index = drops.Count;
		}
		_activeIndex++;
		drop.prepare();
		return drop;
	}

	public void update(float pElapsed)
	{
		Bench.bench("drops", "game_total");
		if (_timeout_timer > 0f)
		{
			_timeout_timer -= World.world.delta_time;
		}
		int num = 0;
		List<Drop> drops = _drops;
		for (num = _activeIndex - 1; num >= 0; num--)
		{
			Drop drop = drops[num];
			if (drop.created && drop.active)
			{
				drop.update(pElapsed);
			}
			else if (_activeIndex == drop.drop_index)
			{
				_activeIndex--;
				Debug.LogError((object)("do we ever hit this??? " + _activeIndex));
			}
		}
		Bench.benchEnd("drops", "game_total", pSaveCounter: false, 0L);
	}

	public void debug(DebugTool pTool)
	{
		pTool.setText("drops total", _drops.Count.ToString() ?? "", 0f, pShowBar: false, 0L);
		pTool.setText("drops active", _activeIndex.ToString() ?? "", 0f, pShowBar: false, 0L);
	}

	public int getActiveIndex()
	{
		return _activeIndex;
	}

	private void debugString()
	{
		string text = "";
		for (int i = 0; i < _drops.Count; i++)
		{
			text = ((!_drops[i].active) ? (text + "x") : (text + "O"));
		}
		Debug.Log((object)(text + " ::: " + _activeIndex));
	}
}
// --- End of File: DropManager.cs ---



// --- Start of File: DropsAction.cs ---
using System;

[Serializable]
public delegate void DropsAction(WorldTile pTile = null, string pDropID = null);
// --- End of File: DropsAction.cs ---



// --- Start of File: DropsLandedAction.cs ---
using System;

[Serializable]
public delegate void DropsLandedAction(Drop pDrop, WorldTile pTile = null, string pDropID = null);
// --- End of File: DropsLandedAction.cs ---



// --- Start of File: DropsLibrary.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using UnityPools;

public class DropsLibrary : AssetLibrary<DropAsset>
{
	private const string TEMPLATE_BIOME_SEEDS = "$biome_seeds$";

	private const string TEMPLATE_SPAWN_BUILDING = "$spawn_building$";

	private const string TEMPLATE_SPAWN_MINERAL = "$spawn_mineral$";

	private const string TEMPLATE_SPAWN_CREEP = "$spawn_creep$";

	private static HashSet<TileZone> _paint_zones_hashset = new HashSet<TileZone>();

	public override void init()
	{
		//IL_0d87: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d8c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d91: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e2b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e30: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e35: Unknown result type (might be due to invalid IL or missing references)
		//IL_0eaf: Unknown result type (might be due to invalid IL or missing references)
		//IL_0eb4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0eb9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f50: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f55: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f5a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0fc9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0fce: Unknown result type (might be due to invalid IL or missing references)
		//IL_0fd3: Unknown result type (might be due to invalid IL or missing references)
		//IL_1057: Unknown result type (might be due to invalid IL or missing references)
		//IL_105c: Unknown result type (might be due to invalid IL or missing references)
		//IL_1061: Unknown result type (might be due to invalid IL or missing references)
		//IL_10f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_10f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_10fa: Unknown result type (might be due to invalid IL or missing references)
		//IL_1182: Unknown result type (might be due to invalid IL or missing references)
		//IL_1187: Unknown result type (might be due to invalid IL or missing references)
		//IL_118c: Unknown result type (might be due to invalid IL or missing references)
		//IL_121b: Unknown result type (might be due to invalid IL or missing references)
		//IL_1220: Unknown result type (might be due to invalid IL or missing references)
		//IL_1225: Unknown result type (might be due to invalid IL or missing references)
		//IL_1294: Unknown result type (might be due to invalid IL or missing references)
		//IL_1299: Unknown result type (might be due to invalid IL or missing references)
		//IL_129e: Unknown result type (might be due to invalid IL or missing references)
		//IL_1311: Unknown result type (might be due to invalid IL or missing references)
		//IL_1316: Unknown result type (might be due to invalid IL or missing references)
		//IL_131b: Unknown result type (might be due to invalid IL or missing references)
		//IL_138e: Unknown result type (might be due to invalid IL or missing references)
		//IL_1393: Unknown result type (might be due to invalid IL or missing references)
		//IL_1398: Unknown result type (might be due to invalid IL or missing references)
		//IL_140b: Unknown result type (might be due to invalid IL or missing references)
		//IL_1410: Unknown result type (might be due to invalid IL or missing references)
		//IL_1415: Unknown result type (might be due to invalid IL or missing references)
		//IL_1488: Unknown result type (might be due to invalid IL or missing references)
		//IL_148d: Unknown result type (might be due to invalid IL or missing references)
		//IL_1492: Unknown result type (might be due to invalid IL or missing references)
		//IL_1505: Unknown result type (might be due to invalid IL or missing references)
		//IL_150a: Unknown result type (might be due to invalid IL or missing references)
		//IL_150f: Unknown result type (might be due to invalid IL or missing references)
		//IL_158d: Unknown result type (might be due to invalid IL or missing references)
		//IL_1592: Unknown result type (might be due to invalid IL or missing references)
		//IL_1597: Unknown result type (might be due to invalid IL or missing references)
		//IL_1640: Unknown result type (might be due to invalid IL or missing references)
		//IL_1645: Unknown result type (might be due to invalid IL or missing references)
		//IL_164a: Unknown result type (might be due to invalid IL or missing references)
		//IL_16cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_16d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_16d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_175e: Unknown result type (might be due to invalid IL or missing references)
		//IL_1763: Unknown result type (might be due to invalid IL or missing references)
		//IL_1768: Unknown result type (might be due to invalid IL or missing references)
		//IL_17ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_17f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_17f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_187c: Unknown result type (might be due to invalid IL or missing references)
		//IL_1881: Unknown result type (might be due to invalid IL or missing references)
		//IL_1886: Unknown result type (might be due to invalid IL or missing references)
		//IL_1901: Unknown result type (might be due to invalid IL or missing references)
		//IL_1906: Unknown result type (might be due to invalid IL or missing references)
		//IL_190b: Unknown result type (might be due to invalid IL or missing references)
		//IL_1989: Unknown result type (might be due to invalid IL or missing references)
		//IL_198e: Unknown result type (might be due to invalid IL or missing references)
		//IL_1993: Unknown result type (might be due to invalid IL or missing references)
		//IL_1a65: Unknown result type (might be due to invalid IL or missing references)
		//IL_1a6a: Unknown result type (might be due to invalid IL or missing references)
		//IL_1a6f: Unknown result type (might be due to invalid IL or missing references)
		base.init();
		add(new DropAsset
		{
			id = "paint",
			path_texture = "drops/drop_paint",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_paint,
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "dust_black",
			path_texture = "drops/drop_dust_black",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		DropAsset dropAsset = t;
		dropAsset.action_landed = (DropsAction)Delegate.Combine(dropAsset.action_landed, new DropsAction(action_dust_white));
		DropAsset dropAsset2 = t;
		dropAsset2.action_landed = (DropsAction)Delegate.Combine(dropAsset2.action_landed, new DropsAction(action_dust_red));
		DropAsset dropAsset3 = t;
		dropAsset3.action_landed = (DropsAction)Delegate.Combine(dropAsset3.action_landed, new DropsAction(action_dust_blue));
		DropAsset dropAsset4 = t;
		dropAsset4.action_landed = (DropsAction)Delegate.Combine(dropAsset4.action_landed, new DropsAction(action_dust_gold));
		DropAsset dropAsset5 = t;
		dropAsset5.action_landed = (DropsAction)Delegate.Combine(dropAsset5.action_landed, new DropsAction(action_dust_purple));
		DropAsset dropAsset6 = t;
		dropAsset6.action_landed = (DropsAction)Delegate.Combine(dropAsset6.action_landed, new DropsAction(action_dust_black));
		add(new DropAsset
		{
			id = "dust_white",
			path_texture = "drops/drop_dust_white",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_dust_white,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "dust_red",
			path_texture = "drops/drop_dust_red",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_dust_red,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "dust_blue",
			path_texture = "drops/drop_dust_blue",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_dust_blue,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "dust_gold",
			path_texture = "drops/drop_dust_gold",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_dust_gold,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "dust_purple",
			path_texture = "drops/drop_dust_purple",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_dust_purple,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "gamma_rain",
			path_texture = "drops/drop_gamma_rain",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_gamma_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropRainGamma",
			type = DropType.DropTraitRain
		});
		add(new DropAsset
		{
			id = "delta_rain",
			path_texture = "drops/drop_delta_rain",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_delta_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropRainDelta",
			type = DropType.DropTraitRain
		});
		add(new DropAsset
		{
			id = "omega_rain",
			path_texture = "drops/drop_omega_rain",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_omega_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropRainOmeaga",
			type = DropType.DropTraitRain
		});
		add(new DropAsset
		{
			id = "loot_rain",
			path_texture = "drops/drop_loot_rain",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_equipment_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropRainGamma",
			type = DropType.DropEquipmentRain
		});
		add(new DropAsset
		{
			id = "tnt",
			animated = true,
			path_texture = "drops/drop_tnt",
			animation_speed = 0.03f,
			default_scale = 0.2f,
			action_landed = action_tnt,
			sound_drop = "event:/SFX/DROPS/DropTnt",
			type = DropType.DropTile
		});
		add(new DropAsset
		{
			id = "tnt_timed",
			path_texture = "drops/drop_tnttimed",
			default_scale = 0.2f,
			action_landed = action_tnt_timed,
			sound_drop = "event:/SFX/DROPS/DropTnt",
			type = DropType.DropTile
		});
		add(new DropAsset
		{
			id = "water_bomb",
			path_texture = "drops/drop_waterbomb",
			default_scale = 0.2f,
			action_landed = action_water_bomb,
			sound_drop = "event:/SFX/DROPS/DropWaterBomb",
			type = DropType.DropTile
		});
		add(new DropAsset
		{
			id = "landmine",
			path_texture = "drops/drop_landmine",
			default_scale = 0.2f,
			action_landed = action_landmine,
			sound_drop = "event:/SFX/DROPS/DropLandmine",
			type = DropType.DropTile
		});
		add(new DropAsset
		{
			id = "fireworks",
			path_texture = "drops/drop_fireworks",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_fireworks,
			sound_drop = "event:/SFX/DROPS/DropFireworks",
			type = DropType.DropTile
		});
		add(new DropAsset
		{
			id = "inspiration",
			path_texture = "drops/drop_inspiration",
			default_scale = 0.2f,
			action_landed = action_inspiration,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropInspiration",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "discord",
			path_texture = "drops/drop_discord",
			default_scale = 0.2f,
			action_landed = action_discord,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropInspiration",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "friendship",
			path_texture = "drops/drop_friendship",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_friendship,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropFriendship",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "spite",
			path_texture = "drops/drop_spite",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_spite,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropSpite",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "madness",
			path_texture = "drops/drop_madness",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_madness,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropMadness",
			type = DropType.DropTrait
		});
		add(new DropAsset
		{
			id = "blessing",
			path_texture = "drops/drop_blessing",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.1f,
			action_landed = action_blessing,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		DropAsset dropAsset7 = t;
		dropAsset7.action_landed = (DropsAction)Delegate.Combine(dropAsset7.action_landed, new DropsAction(ActionLibrary.action_shrinkTornadoes));
		add(new DropAsset
		{
			id = "shield",
			path_texture = "drops/drop_shield",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_shield,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropShield",
			type = DropType.DropStatus
		});
		add(new DropAsset
		{
			id = "coffee",
			path_texture = "drops/drop_coffee",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_coffee,
			sound_drop = "event:/SFX/DROPS/DropCoffee",
			type = DropType.DropStatus
		});
		add(new DropAsset
		{
			id = "powerup",
			path_texture = "drops/drop_mushroom_powerup",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_powerup,
			sound_drop = "event:/SFX/DROPS/DropPowerup",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "curse",
			path_texture = "drops/drop_curse",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_curse,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropCurse",
			type = DropType.DropTrait
		});
		DropAsset dropAsset8 = t;
		dropAsset8.action_landed = (DropsAction)Delegate.Combine(dropAsset8.action_landed, new DropsAction(ActionLibrary.action_growTornadoes));
		add(new DropAsset
		{
			id = "spell_silence",
			path_texture = "drops/drop_spell_silence",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_spell_silence,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropCurse",
			type = DropType.DropTrait
		});
		add(new DropAsset
		{
			id = "zombie_infection",
			path_texture = "drops/drop_zombieinfection",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_zombie_infection,
			sound_drop = "event:/SFX/DROPS/DropZombieInfection",
			type = DropType.DropTrait
		});
		add(new DropAsset
		{
			id = "mush_spores",
			path_texture = "drops/drop_mushSpores",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_mush_spore,
			sound_drop = "event:/SFX/DROPS/DropMushSpores",
			type = DropType.DropTrait
		});
		add(new DropAsset
		{
			id = "plague",
			path_texture = "drops/drop_plague",
			random_frame = true,
			default_scale = 0.1f,
			action_landed = action_plague,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropPlague",
			type = DropType.DropTrait
		});
		add(new DropAsset
		{
			id = "living_plants",
			path_texture = "drops/drop_blessing",
			animated = true,
			default_scale = 0.1f,
			action_landed = action_living_plants,
			sound_drop = "event:/SFX/DROPS/DropLivingPlants",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "living_house",
			path_texture = "drops/drop_blessing",
			animated = true,
			default_scale = 0.1f,
			action_landed = action_living_house,
			sound_drop = "event:/SFX/DROPS/DropLivingHouse",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "bomb",
			path_texture = "drops/drop_bomb",
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			sound_launch = "event:/SFX/DROPS/DropLaunchBombSmall",
			action_landed = action_bomb,
			type = DropType.DropBomb
		});
		DropAsset dropAsset9 = t;
		dropAsset9.action_launch = (DropsAction)Delegate.Combine(dropAsset9.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
		add(new DropAsset
		{
			id = "grenade",
			path_texture = "drops/drop_grenade",
			animated = true,
			default_scale = 0.2f,
			animation_speed = 0.03f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_grenade,
			random_flip = true,
			sound_launch = "event:/SFX/DROPS/DropLaunchGrenade",
			type = DropType.DropBomb
		});
		add(new DropAsset
		{
			id = "crab_bomb",
			path_texture = "drops/drop_crab_bomb_parachute",
			animated = true,
			default_scale = 0.1f,
			animation_speed = 0.05f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_crab_bomb_impact,
			random_flip = true,
			sound_launch = "event:/SFX/DROPS/DropLaunchCrabBomb",
			type = DropType.DropBomb
		});
		add(new DropAsset
		{
			id = "crab_bomb_shrapnel",
			path_texture = "drops/drop_crab_bomb_shrapnel",
			animated = true,
			animation_rotation = true,
			animation_rotation_speed_min = 50f,
			animation_rotation_speed_max = 200f,
			default_scale = 0.175f,
			animation_speed = 0.05f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_crab_bomb_shrapnel,
			random_flip = true,
			sound_launch = "event:/SFX/DROPS/DropLaunchCrabBomb",
			type = DropType.DropBomb,
			surprises_units = true
		});
		add(new DropAsset
		{
			id = "napalm_bomb",
			path_texture = "drops/drop_napalmbomb",
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_napalm_bomb,
			random_flip = true,
			type = DropType.DropBomb
		});
		DropAsset dropAsset10 = t;
		dropAsset10.action_launch = (DropsAction)Delegate.Combine(dropAsset10.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
		add(new DropAsset
		{
			id = "atomic_bomb",
			path_texture = "drops/drop_atomicbomb",
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_atomic_bomb,
			random_flip = true,
			sound_launch = "event:/SFX/DROPS/DropLaunchGrenadeHuge",
			type = DropType.DropBomb
		});
		DropAsset dropAsset11 = t;
		dropAsset11.action_launch = (DropsAction)Delegate.Combine(dropAsset11.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
		add(new DropAsset
		{
			id = "antimatter_bomb",
			path_texture = "drops/drop_antimatterbomb",
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_antimatter_bomb,
			sound_launch = "event:/SFX/DROPS/DropLaunchGrenadeHuge",
			type = DropType.DropBomb
		});
		DropAsset dropAsset12 = t;
		dropAsset12.action_launch = (DropsAction)Delegate.Combine(dropAsset12.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
		add(new DropAsset
		{
			id = "czar_bomba",
			path_texture = "drops/drop_czarbomba",
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(60f, 70f)),
			action_landed = action_czar_bomba,
			sound_launch = "event:/SFX/DROPS/DropLaunchGrenadeHuge",
			type = DropType.DropBomb
		});
		DropAsset dropAsset13 = t;
		dropAsset13.action_launch = (DropsAction)Delegate.Combine(dropAsset13.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
		add(new DropAsset
		{
			id = "rain",
			path_texture = "drops/drop_rain",
			random_frame = true,
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_rain,
			sound_drop = "event:/SFX/DROPS/DropRain",
			type = DropType.DropGeneric,
			surprises_units = false
		});
		add(new DropAsset
		{
			id = "blood_rain",
			path_texture = "drops/drop_blood",
			random_frame = true,
			default_scale = 0.1f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed_drop = action_blood_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBloodRain",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "clone_rain",
			path_texture = "drops/drop_clone",
			random_frame = true,
			default_scale = 0.1f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_clone_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBloodRain",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "jazz",
			path_texture = "drops/drop_jazz",
			random_frame = true,
			default_scale = 0.1f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_jazz_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBloodRain",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "dispel",
			path_texture = "drops/drop_dispel",
			random_frame = true,
			default_scale = 0.1f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_dispel_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBloodRain",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "sleep",
			path_texture = "drops/drop_sleep",
			random_frame = true,
			default_scale = 0.1f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_sleep_rain,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBloodRain",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "cure",
			path_texture = "drops/drop_cure",
			random_frame = true,
			default_scale = 0.1f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_cure,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropCure",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "fire",
			path_texture = "drops/drop_fire",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			falling_random_x_move = true,
			particle_interval = 0.3f,
			action_landed = action_fire,
			animation_speed_random = 0.08f,
			random_frame = true,
			random_flip = true,
			sound_drop = "event:/SFX/DROPS/DropFire",
			material = "mat_world_object_lit",
			type = DropType.DropGeneric
		});
		add(new DropAsset
		{
			id = "snow",
			path_texture = "drops/drop_snow",
			random_frame = true,
			default_scale = 0.2f,
			falling_speed = 0.3f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			falling_random_x_move = true,
			particle_interval = 0.15f,
			sound_drop = "event:/SFX/DROPS/DropSnow",
			action_landed = action_snow,
			type = DropType.DropGeneric
		});
		add(new DropAsset
		{
			id = "life_seed",
			path_texture = "drops/drop_life_seed",
			random_frame = true,
			default_scale = 0.2f,
			falling_speed = 0.3f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			falling_random_x_move = true,
			particle_interval = 0.15f,
			sound_drop = "event:/SFX/DROPS/DropSeedGrass",
			action_landed = action_life_seed,
			type = DropType.DropGeneric
		});
		add(new DropAsset
		{
			id = "ash",
			path_texture = "drops/drop_ash",
			random_frame = true,
			default_scale = 0.2f,
			falling_speed = 0.3f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			falling_random_x_move = true,
			particle_interval = 0.15f,
			sound_drop = "event:/SFX/DROPS/DropAsh",
			action_landed = action_ash,
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "magic_rain",
			path_texture = "drops/drop_magic_rain",
			random_frame = true,
			default_scale = 0.2f,
			falling_speed = 0.3f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			falling_random_x_move = true,
			particle_interval = 0.15f,
			sound_drop = "event:/SFX/DROPS/DropMagicRain",
			action_landed = action_magic_rain,
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "rage",
			path_texture = "drops/drop_rage",
			random_frame = true,
			default_scale = 0.2f,
			falling_speed = 0.3f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			falling_random_x_move = true,
			particle_interval = 0.15f,
			sound_drop = "event:/SFX/DROPS/DropRage",
			action_landed = action_rage,
			type = DropType.DropStatus
		});
		add(new DropAsset
		{
			id = "acid",
			path_texture = "drops/drop_acid",
			random_frame = true,
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_acid,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropAcid",
			type = DropType.DropMagic
		});
		add(new DropAsset
		{
			id = "lava",
			path_texture = "drops/drop_lava",
			animated = true,
			animation_speed = 0.03f,
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(30f, 45f)),
			action_landed = action_lava,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropLava",
			type = DropType.DropGeneric
		});
		add(new DropAsset
		{
			id = "santa_bomb",
			path_texture = "drops/drop_santabomb",
			random_frame = true,
			default_scale = 0.2f,
			sound_launch = "event:/SFX/DROPS/DropLaunchSantaBomb",
			action_landed = action_santa_bomb,
			type = DropType.DropBomb,
			surprises_units = true
		});
		add(new DropAsset
		{
			id = "$spawn_building$",
			path_texture = "drops/drop_stone",
			random_frame = true,
			default_scale = 0.2f,
			falling_height = Vector2.op_Implicit(new Vector2(10f, 15f)),
			falling_speed = 5f,
			type = DropType.DropBuilding
		});
		t.action_landed = action_spawn_building;
		clone("$biome_seeds$", "$spawn_building$");
		t.type = DropType.DropSeed;
		t.action_landed = null;
		clone("seeds_grass", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_grass";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "grass_low";
		t.drop_type_high = "grass_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_enchanted", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_enchanted";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "enchanted_low";
		t.drop_type_high = "enchanted_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedEnchanted";
		clone("seeds_savanna", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_savanna";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "savanna_low";
		t.drop_type_high = "savanna_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedSavanna";
		clone("seeds_corrupted", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_corrupted";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "corrupted_low";
		t.drop_type_high = "corrupted_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedCorrupted";
		clone("seeds_mushroom", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_mushroom";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "mushroom_low";
		t.drop_type_high = "mushroom_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedMushroom";
		clone("seeds_jungle", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_jungle";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "jungle_low";
		t.drop_type_high = "jungle_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedJungle";
		clone("seeds_desert", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_desert";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "desert_low";
		t.drop_type_high = "desert_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedDesert";
		clone("seeds_lemon", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_lemon";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "lemon_low";
		t.drop_type_high = "lemon_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedLemon";
		clone("seeds_permafrost", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_permafrost";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "permafrost_low";
		t.drop_type_high = "permafrost_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedPermafrost";
		clone("seeds_candy", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_candy";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "candy_low";
		t.drop_type_high = "candy_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedCandy";
		clone("seeds_crystal", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_crystal";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "crystal_low";
		t.drop_type_high = "crystal_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedCrystal";
		clone("seeds_swamp", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_swamp";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "swamp_low";
		t.drop_type_high = "swamp_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedSwamp";
		clone("seeds_infernal", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_infernal";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "infernal_low";
		t.drop_type_high = "infernal_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedInfernal";
		clone("seeds_birch", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_birch";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "birch_low";
		t.drop_type_high = "birch_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_maple", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_maple";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "maple_low";
		t.drop_type_high = "maple_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_rocklands", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_rocklands";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "rocklands_low";
		t.drop_type_high = "rocklands_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_garlic", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_garlic";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "garlic_low";
		t.drop_type_high = "garlic_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_flower", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_flower";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "flower_low";
		t.drop_type_high = "flower_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_celestial", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_celestial";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "celestial_low";
		t.drop_type_high = "celestial_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_singularity", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_singularity";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "singularity_low";
		t.drop_type_high = "singularity_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_clover", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_clover";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "clover_low";
		t.drop_type_high = "clover_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("seeds_paradox", "$biome_seeds$");
		t.path_texture = "drops/drop_seed_paradox";
		t.falling_speed = 3f;
		t.action_landed = action_drop_seeds;
		t.drop_type_low = "paradox_low";
		t.drop_type_high = "paradox_high";
		t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
		clone("fruit_bush", "$spawn_building$");
		t.path_texture = "drops/drop_seed";
		t.falling_speed = 3f;
		t.action_landed = action_fruit_bush;
		t.sound_drop = "event:/SFX/DROPS/DropBush";
		clone("fertilizer_plants", "$biome_seeds$");
		t.surprises_units = false;
		t.path_texture = "drops/drop_fertilizer";
		t.falling_speed = 5f;
		DropAsset dropAsset14 = t;
		dropAsset14.action_landed = (DropsAction)Delegate.Combine(dropAsset14.action_landed, new DropsAction(action_fertilizer_plants));
		DropAsset dropAsset15 = t;
		dropAsset15.action_landed = (DropsAction)Delegate.Combine(dropAsset15.action_landed, new DropsAction(tryToGrowWheat));
		DropAsset dropAsset16 = t;
		dropAsset16.action_landed = (DropsAction)Delegate.Combine(dropAsset16.action_landed, new DropsAction(flash));
		t.sound_drop = "event:/SFX/DROPS/DropFertilizerPlants";
		clone("fertilizer_trees", "$biome_seeds$");
		t.path_texture = "drops/drop_fertilizer";
		t.falling_speed = 5f;
		t.action_landed = action_fertilizer_trees;
		DropAsset dropAsset17 = t;
		dropAsset17.action_landed = (DropsAction)Delegate.Combine(dropAsset17.action_landed, new DropsAction(flash));
		t.sound_drop = "event:/SFX/DROPS/DropFertilizerPlants";
		clone("$spawn_mineral$", "$spawn_building$");
		t.falling_speed = 6f;
		t.type = DropType.DropMineral;
		clone("stone", "$spawn_mineral$");
		t.path_texture = "drops/drop_stone";
		t.default_scale = 0.2f;
		t.building_asset = "mineral_stone";
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropStone";
		clone("metals", "$spawn_mineral$");
		t.path_texture = "drops/drop_metal";
		t.default_scale = 0.2f;
		t.building_asset = "mineral_metals";
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropMineral";
		clone("gold", "$spawn_mineral$");
		t.path_texture = "drops/drop_gold";
		t.default_scale = 0.2f;
		t.building_asset = "mineral_gold";
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropGold";
		clone("silver", "$spawn_mineral$");
		t.path_texture = "drops/drop_stone";
		t.default_scale = 0.2f;
		t.building_asset = "mineral_silver";
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropMineral";
		clone("mythril", "$spawn_mineral$");
		t.path_texture = "drops/drop_stone";
		t.default_scale = 0.2f;
		t.building_asset = "mineral_mythril";
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropMineral";
		clone("adamantine", "$spawn_mineral$");
		t.path_texture = "drops/drop_stone";
		t.default_scale = 0.2f;
		t.building_asset = "mineral_adamantine";
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropMineral";
		clone("$spawn_creep$", "$spawn_building$");
		t.type = DropType.DropCreep;
		clone("tumor", "$spawn_creep$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropTumor";
		clone("biomass", "$spawn_creep$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropBiomass";
		clone("cybercore", "$spawn_creep$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropCybercore";
		clone("super_pumpkin", "$spawn_creep$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropSuperPumpkin";
		clone("geyser", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropGeyser";
		clone("geyser_acid", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropGeyser";
		clone("volcano", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropVolcano";
		clone("golden_brain", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropGoldenBrain";
		clone("monolith", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		DropAsset dropAsset18 = t;
		dropAsset18.action_landed = (DropsAction)Delegate.Combine(dropAsset18.action_landed, (DropsAction)delegate
		{
			AchievementLibrary.cant_be_too_much.checkBySignal();
		});
		t.sound_drop = "event:/SFX/DROPS/DropMonolith";
		clone("corrupted_brain", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
		clone("ice_tower", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropIceTower";
		clone("angle_tower", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropIceTower";
		clone("beehive", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropBeehive";
		clone("flame_tower", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropFlameTower";
		addWaypointDrops();
	}

	public override void linkAssets()
	{
		foreach (DropAsset item in list)
		{
			if (!string.IsNullOrEmpty(item.drop_type_high))
			{
				item.cached_drop_type_high = AssetManager.top_tiles.get(item.drop_type_high);
			}
			if (!string.IsNullOrEmpty(item.drop_type_low))
			{
				item.cached_drop_type_low = AssetManager.top_tiles.get(item.drop_type_low);
			}
		}
		base.linkAssets();
	}

	private void addWaypointDrops()
	{
		add(new DropAsset
		{
			id = "desire_alien_mold",
			path_texture = "drops/drop_alien_mold",
			animated = false,
			default_scale = 0.1f,
			material = "mat_world_object_lit",
			sound_drop = "event:/SFX/DROPS/DropBlessing",
			type = DropType.DropMagic
		});
		t.action_landed = action_alien_mold;
		t.surprises_units = true;
		clone("desire_computer", "desire_alien_mold");
		t.path_texture = "drops/drop_computer";
		t.action_landed = action_drop_computer;
		clone("desire_golden_egg", "desire_alien_mold");
		t.path_texture = "drops/drop_golden_egg";
		t.action_landed = action_drop_golden_egg;
		clone("desire_harp", "desire_alien_mold");
		t.path_texture = "drops/drop_harp";
		t.action_landed = action_drop_harp;
		clone("waypoint_alien_mold", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
		clone("waypoint_computer", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
		clone("waypoint_golden_egg", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
		clone("waypoint_harp", "$spawn_building$");
		t.building_asset = t.id;
		t.action_landed = action_spawn_building;
		t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
	}

	public static void action_drop_seeds(WorldTile pTile = null, string pDropID = null)
	{
		DropAsset dropAsset = AssetManager.drops.get(pDropID);
		useDropSeedOn(pTile, dropAsset.cached_drop_type_low, dropAsset.cached_drop_type_high);
	}

	public static void useDropSeedOn(WorldTile pTile, TopTileType pTypeLow, TopTileType pHigh)
	{
		useSeedOn(pTile, pTypeLow, pHigh);
		for (int i = 0; i < pTile.neighbours.Length; i++)
		{
			useSeedOn(pTile.neighbours[i], pTypeLow, pHigh);
		}
	}

	public static void tryToGrowWheat(WorldTile pTile = null, string pDropID = null)
	{
		if (pTile.Type.farm_field && !pTile.hasBuilding())
		{
			World.world.buildings.addBuilding("wheat", pTile);
		}
	}

	public static void useSeedOn(WorldTile pTile, TopTileType pTypeLow, TopTileType pHigh)
	{
		pTile.unfreeze();
		if (!pTile.Type.can_be_biome)
		{
			return;
		}
		if (pTile.isTileRank(TileRank.Low))
		{
			MapAction.growGreens(pTile, pTypeLow);
		}
		else if (pTile.isTileRank(TileRank.High))
		{
			MapAction.growGreens(pTile, pHigh);
		}
		BiomeAsset tBiome = pTile.getBiome();
		if (tBiome == null)
		{
			return;
		}
		pTile.doUnits(delegate(Actor tActor)
		{
			if (!tActor.hasSubspecies() || tBiome.spawn_trait_subspecies_always == null)
			{
				return;
			}
			foreach (string spawn_trait_subspecies_alway in tBiome.spawn_trait_subspecies_always)
			{
				tActor.subspecies.addTrait(spawn_trait_subspecies_alway);
			}
		});
	}

	public static void action_rain(WorldTile pTile = null, string pDropID = null)
	{
		useRainOn(pTile);
		for (int i = 0; i < pTile.neighbours.Length; i++)
		{
			useRainOn(pTile.neighbours[i]);
		}
		for (int j = 0; j < pTile.neighbours.Length; j++)
		{
			WorldTile worldTile = pTile.neighbours[j];
			if (worldTile.isOnFire())
			{
				worldTile.stopFire();
			}
		}
	}

	private static void useRainOn(WorldTile pTile)
	{
		pTile.stopFire();
		pTile.doUnits(delegate(Actor tActor)
		{
			tActor.finishStatusEffect("burning");
			tActor.finishAngryStatus();
			if (tActor.isDamagedByRain())
			{
				tActor.getHit(tActor.getWaterDamage(), pFlash: true, AttackType.Water);
			}
			else
			{
				tActor.addStamina((int)((float)tActor.getMaxStamina() * 0.1f));
			}
		});
		if (pTile.hasBuilding())
		{
			pTile.building.stopFire();
			if (pTile.building.asset.wheat)
			{
				pTile.building.component_wheat.grow();
			}
		}
		if (pTile.hasBuilding() && pTile.building.asset.damaged_by_rain)
		{
			pTile.building.getHit(20f);
		}
		pTile.removeBurn();
		if (pTile.Type.can_be_filled_with_ocean)
		{
			MapAction.setOcean(pTile);
		}
		if (pTile.Type.lava)
		{
			LavaHelper.putOut(pTile);
		}
		if (pTile.Type.explodable_by_ocean)
		{
			World.world.explosion_layer.explodeBomb(pTile);
		}
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_water)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile);
		}
	}

	public static void action_gamma_rain(WorldTile pTile = null, string pDropID = null)
	{
		List<string> trait_editor_gamma = PlayerConfig.instance.data.trait_editor_gamma;
		useTraitRain(pTile, trait_editor_gamma, PlayerConfig.instance.data.trait_editor_gamma_state);
	}

	public static void action_delta_rain(WorldTile pTile = null, string pDropID = null)
	{
		List<string> trait_editor_delta = PlayerConfig.instance.data.trait_editor_delta;
		useTraitRain(pTile, trait_editor_delta, PlayerConfig.instance.data.trait_editor_delta_state);
	}

	public static void action_omega_rain(WorldTile pTile = null, string pDropID = null)
	{
		List<string> trait_editor_omega = PlayerConfig.instance.data.trait_editor_omega;
		useTraitRain(pTile, trait_editor_omega, PlayerConfig.instance.data.trait_editor_omega_state);
	}

	private static void useTraitRain(WorldTile pTile, List<string> pList, RainState pRainState)
	{
		if (pList.Count == 0)
		{
			return;
		}
		using ListPool<ActorTrait> listPool = new ListPool<ActorTrait>(pList.Count);
		foreach (string p in pList)
		{
			ActorTrait actorTrait = AssetManager.traits.get(p);
			if (actorTrait != null && actorTrait.isAvailable() && (pRainState != 0 || actorTrait.can_be_given) && (pRainState != RainState.Remove || actorTrait.can_be_removed))
			{
				listPool.Add(actorTrait);
			}
		}
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (!item.asset.can_edit_traits)
			{
				continue;
			}
			if (pRainState == RainState.Remove)
			{
				item.removeTraits(listPool);
			}
			else
			{
				foreach (ref ActorTrait item2 in listPool)
				{
					ActorTrait current3 = item2;
					item.addTrait(current3, pRemoveOpposites: true);
				}
			}
			item.addTrait("scar_of_divinity");
			item.startShake();
			item.makeConfused(-1f, pColorEffect: true);
		}
	}

	public static void action_equipment_rain(WorldTile pTile = null, string pDropID = null)
	{
		List<string> equipment_editor = PlayerConfig.instance.data.equipment_editor;
		useEquipmentRain(pTile, equipment_editor, PlayerConfig.instance.data.equipment_editor_state);
	}

	private static void useEquipmentRain(WorldTile pTile, List<string> pItems, RainState pRainState)
	{
		if (pItems.Count == 0)
		{
			return;
		}
		pItems.Shuffle();
		using ListPool<EquipmentAsset> listPool = new ListPool<EquipmentAsset>(pItems.Count);
		HashSet<EquipmentType> hashSet = UnsafeCollectionPool<HashSet<EquipmentType>, EquipmentType>.Get();
		for (int i = 0; i < pItems.Count; i++)
		{
			string pID = pItems[i];
			EquipmentAsset equipmentAsset = AssetManager.items.get(pID);
			if (equipmentAsset != null && (pRainState != 0 || !hashSet.Contains(equipmentAsset.equipment_type)) && equipmentAsset.isAvailable() && (pRainState != 0 || equipmentAsset.can_be_given) && (pRainState != RainState.Remove || equipmentAsset.can_be_removed))
			{
				hashSet.Add(equipmentAsset.equipment_type);
				listPool.Add(equipmentAsset);
			}
		}
		UnsafeCollectionPool<HashSet<EquipmentType>, EquipmentType>.Release(hashSet);
		foreach (Actor item3 in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (!item3.canEditEquipment())
			{
				continue;
			}
			for (int j = 0; j < listPool.Count; j++)
			{
				EquipmentAsset equipmentAsset2 = listPool[j];
				if (!item3.asset.canEditItem(equipmentAsset2))
				{
					continue;
				}
				ActorEquipmentSlot slot = item3.equipment.getSlot(equipmentAsset2.equipment_type);
				Item item = slot.getItem();
				if (pRainState == RainState.Remove)
				{
					if (slot.isEmpty() || item.asset.id != equipmentAsset2.id)
					{
						continue;
					}
				}
				else if (!slot.isEmpty() && (item.asset.id == equipmentAsset2.id || item.isFavorite() || item.isCursed()))
				{
					continue;
				}
				if (pRainState == RainState.Remove)
				{
					item.data.favorite = false;
					item.removeMod("eternal");
					slot.takeAwayItem();
				}
				else
				{
					Item item2 = World.world.items.generateItem(equipmentAsset2, item3.kingdom, World.world.map_stats.player_name, 1, item3, 0, pByPlayer: true);
					item2.addMod("divine_rune");
					item3.equipment.setItem(item2, item3);
				}
			}
			item3.startShake();
			item3.makeConfused(-1f, pColorEffect: true);
		}
	}

	public static void action_acid(WorldTile pTile = null, string pDropID = null)
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		MapAction.checkAcidTerraform(pTile);
		if (Randy.randomChance(0.2f))
		{
			World.world.particles_smoke.spawn(pTile.posV3);
		}
		if (pTile.hasBuilding() && pTile.building.asset.affected_by_acid && pTile.building.isAlive())
		{
			pTile.building.getHit(20f);
		}
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (!Randy.randomChance(0.6f) && !item.hasTrait("acid_proof") && !item.hasTrait("acid_blood"))
			{
				item.getHit(20f, pFlash: true, AttackType.Acid);
			}
		}
		World.world.conway_layer.checkKillRange(pTile.pos, 2);
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_acid)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, pCheckRoad: false, pCheckBonuses: false, pForce: true);
		}
	}

	public static void action_fire(WorldTile pTile = null, string pDropID = null)
	{
		ActionLibrary.burnTile(null, null, pTile);
		ActionLibrary.startBurningObjects(null, null, pTile);
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_fire)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, pCheckRoad: false, pCheckBonuses: false, pForce: true);
		}
	}

	public static void action_fireworks(WorldTile pTile = null, string pDropID = null)
	{
		MapAction.terraformTop(pTile, TopTileLibrary.fireworks, TerraformLibrary.remove);
	}

	public static void action_tnt(WorldTile pTile = null, string pDropID = null)
	{
		if (pTile.Type.lava || pTile.isOnFire())
		{
			MapAction.terraformTop(pTile, TopTileLibrary.tnt, TerraformLibrary.remove);
			World.world.explosion_layer.explodeBomb(pTile);
		}
		else
		{
			MapAction.terraformTop(pTile, TopTileLibrary.tnt, TerraformLibrary.remove);
		}
	}

	public static void action_tnt_timed(WorldTile pTile = null, string pDropID = null)
	{
		if (pTile.Type.lava || pTile.isOnFire())
		{
			MapAction.terraformTop(pTile, TopTileLibrary.tnt_timed, TerraformLibrary.remove);
			World.world.explosion_layer.explodeBomb(pTile);
		}
		else
		{
			MapAction.terraformTop(pTile, TopTileLibrary.tnt_timed, TerraformLibrary.remove);
		}
	}

	public static void action_czar_bomba(WorldTile pTile = null, string pDropID = null)
	{
		EffectsLibrary.spawn("fx_nuke_flash", pTile, "czar_bomba");
		World.world.startShake(0.3f, 0.01f, 2.5f, pShakeX: true);
	}

	public static void action_atomic_bomb(WorldTile pTile = null, string pDropID = null)
	{
		World.world.startShake(0.3f, 0.01f, 2f, pShakeX: true);
		EffectsLibrary.spawn("fx_nuke_flash", pTile, "atomic_bomb");
	}

	public static void action_antimatter_bomb(WorldTile pTile = null, string pDropID = null)
	{
		World.world.startShake(0.3f, 0.01f, 0.03f);
		EffectsLibrary.spawn("fx_antimatter_effect", pTile);
	}

	public static void action_napalm_bomb(WorldTile pTile = null, string pDropID = null)
	{
		World.world.startShake(0.3f, 0.01f, 0.5f, pShakeX: true);
		EffectsLibrary.spawn("fx_napalm_flash", pTile);
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_tiny", pTile, 0.15f, 0.3f);
	}

	public static void action_crab_bomb_impact(WorldTile pTile = null, string pDropID = null)
	{
		MusicBox.playSound("event:/SFX/DESTRUCTION/CrabBombImpact", pTile);
		int num = Randy.randomInt(1, 4);
		for (int i = 0; i < num; i++)
		{
			World.world.drop_manager.spawnParabolicDrop(pTile, "crab_bomb_shrapnel", 1f, 15f, 40f, 4f, 16f);
		}
	}

	public static void action_crab_bomb_shrapnel(WorldTile pTile = null, string pDropID = null)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		EffectsLibrary.spawnAt("fx_explosion_crab_bomb", pTile.posV, 0.25f);
		World.world.startShake(0.3f, 0.01f, 0.5f, pShakeX: true);
		MapAction.damageWorld(pTile, 2, AssetManager.terraform.get("crab_bomb"));
		if (Randy.randomChance(0.05f))
		{
			action_crab_bomb_impact(pTile, "crab_bomb_shrapnel");
		}
	}

	public static void action_grenade(WorldTile pTile = null, string pDropID = null)
	{
		MapAction.damageWorld(pTile, 5, AssetManager.terraform.get("grenade"));
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_small", pTile, 0.1f, 0.15f);
	}

	public static void action_bomb(WorldTile pTile = null, string pDropID = null)
	{
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_middle", pTile, 0.45f, 0.6f);
		if (!World.world.explosion_checker.checkNearby(pTile, 10))
		{
			MapAction.damageWorld(pTile, 10, AssetManager.terraform.get("bomb"));
		}
	}

	public static void action_santa_bomb(WorldTile pTile = null, string pDropID = null)
	{
		MapAction.damageWorld(pTile, 10, AssetManager.terraform.get("santa_bomb"));
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_small", pTile, 0.45f, 0.6f);
	}

	public static void action_water_bomb(WorldTile pTile = null, string pDropID = null)
	{
		if (pTile.Type.liquid || pTile.Type.lava || pTile.isOnFire())
		{
			MapAction.terraformTop(pTile, TopTileLibrary.water_bomb, TerraformLibrary.remove);
			World.world.explosion_layer.explodeBomb(pTile);
		}
		else
		{
			MapAction.terraformTop(pTile, TopTileLibrary.water_bomb, TerraformLibrary.remove);
		}
	}

	public static void action_lava(WorldTile pTile = null, string pDropID = null)
	{
		LavaHelper.addLava(pTile);
	}

	public static void action_rage(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (Randy.randomChance(0.2f))
			{
				item.addStatusEffect("rage");
			}
		}
	}

	public static void action_magic_rain(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (Randy.randomChance(0.2f))
			{
				item.addStatusEffect("powerup");
			}
			if (Randy.randomChance(0.2f))
			{
				item.addStatusEffect("spell_boost");
			}
			if (Randy.randomChance(0.2f))
			{
				item.addStatusEffect("shield");
			}
			if (Randy.randomChance(0.2f))
			{
				item.addStatusEffect("caffeinated");
			}
			item.addMana((int)((float)item.getMaxMana() * 0.1f));
		}
	}

	public static void action_ash(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (Randy.randomChance(0.3f))
			{
				item.addStatusEffect("cough");
			}
			if (Randy.randomChance(0.1f))
			{
				item.addStatusEffect("ash_fever");
			}
		}
	}

	public static void action_life_seed(WorldTile pTile = null, string pDropID = null)
	{
		if (WorldLawLibrary.world_law_animals_spawn.isEnabled())
		{
			trySpawnUnit(pTile);
		}
		if (WorldLawLibrary.world_law_vegetation_random_seeds.isEnabled())
		{
			trySpawnVegetation(pTile);
		}
	}

	private void action_jazz_rain(WorldTile pTile, string pDropID)
	{
		Actor actor = null;
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f, pRandom: true))
		{
			if (item.hasSubspecies() && item.isBreedingAge())
			{
				actor = item;
				break;
			}
		}
		if (actor != null)
		{
			BabyMaker.makeBabyFromMiracle(actor, ActorSex.None, pAddToFamily: true);
		}
	}

	private static void trySpawnUnit(WorldTile pTile)
	{
		BiomeAsset biome_asset = pTile.Type.biome_asset;
		if (biome_asset == null || !biome_asset.pot_spawn_units_auto)
		{
			return;
		}
		string pID = biome_asset.pot_units_spawn.GetRandom();
		bool flag = false;
		if (WorldLawLibrary.world_law_drop_of_thoughts.isEnabled() && Randy.randomBool() && biome_asset.pot_sapient_units_spawn != null)
		{
			foreach (string item in biome_asset.pot_sapient_units_spawn.LoopRandom())
			{
				ActorAsset actorAsset = AssetManager.actor_library.get(item);
				if (actorAsset.isAvailable())
				{
					GodPower godPower = actorAsset.getGodPower();
					if (godPower == null || godPower.isAvailable())
					{
						pID = item;
						flag = true;
						break;
					}
				}
			}
		}
		ActorAsset actorAsset2 = AssetManager.actor_library.get(pID);
		if (actorAsset2 == null || actorAsset2.units.Count > actorAsset2.max_random_amount)
		{
			return;
		}
		int num = 0;
		foreach (Actor item2 in Finder.getUnitsFromChunk(pTile, 1))
		{
			_ = item2;
			if (num++ > 3)
			{
				return;
			}
		}
		Actor actor = World.world.units.spawnNewUnit(actorAsset2.id, pTile);
		if (flag && actor != null && actor.subspecies.isJustCreated())
		{
			actor.subspecies.makeSapient();
		}
	}

	private static void trySpawnVegetation(WorldTile pTile)
	{
		BiomeAsset biome_asset = pTile.Type.biome_asset;
		if (biome_asset != null && biome_asset.grow_vegetation_auto)
		{
			ActionLibrary.growRandomVegetation(pTile, biome_asset);
		}
	}

	public static void action_snow(WorldTile pTile = null, string pDropID = null)
	{
		if (pTile.canBeFrozen())
		{
			pTile.freeze();
		}
		for (int i = 0; i < 10; i++)
		{
			WorldTile random = pTile.chunk.tiles.GetRandom();
			if (random.canBeFrozen())
			{
				if (Toolbox.DistTile(pTile, random) < 11f)
				{
					break;
				}
				random.freeze();
			}
		}
		if (pTile.Type.lava)
		{
			return;
		}
		if (Randy.randomBool())
		{
			foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
			{
				ActionLibrary.addFrozenEffectOnTarget(item, item);
			}
		}
		checkColdOneBabies(pTile);
	}

	public static void checkColdOneBabies(WorldTile pTile)
	{
		if (!WorldLawLibrary.world_law_disasters_other.isEnabled() || !World.world_era.era_disaster_snow_turns_babies_into_ice_ones)
		{
			return;
		}
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.canTurnIntoColdOne())
			{
				ActionLibrary.turnIntoIceOne(item);
			}
		}
	}

	private static void action_cure(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 4f))
		{
			item.removeTrait("plague");
			item.removeTrait("tumor_infection");
			item.removeTrait("mush_spores");
			item.removeTrait("infected");
			item.finishStatusEffect("ash_fever");
			item.finishStatusEffect("cursed");
			item.startShake();
			item.startColorEffect();
		}
	}

	private static void action_clone_rain(WorldTile pTile, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 1f, pRandom: true))
		{
			WorldTile worldTile = null;
			foreach (WorldTile item2 in item.current_tile.neighboursAll.LoopRandom())
			{
				if (!item2.hasUnits())
				{
					worldTile = item2;
					break;
				}
			}
			if (worldTile != null && World.world.units.cloneUnit(item, worldTile))
			{
				break;
			}
		}
	}

	private void action_sleep_rain(WorldTile pTile, string pDropID)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.makeSleep(60f) && !item.isLying())
			{
				item.applyRandomForce();
			}
		}
	}

	private void action_dispel_rain(WorldTile pTile, string pDropID)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.finishStatusEffect("powerup");
			item.finishStatusEffect("enchanted");
			item.finishStatusEffect("slowness");
			item.finishStatusEffect("shield");
			item.finishStatusEffect("invincible");
			item.finishStatusEffect("spell_boost");
			if (item.asset.die_from_dispel)
			{
				item.getHit(item.getMaxHealthPercent(0.5f), pFlash: true, AttackType.Other, null, pSkipIfShake: true, pMetallicWeapon: false, pCheckDamageReduction: true);
			}
		}
	}

	public static void action_blood_rain(Drop pDrop, WorldTile pTile = null, string pDropID = null)
	{
		long casterId = pDrop.getCasterId();
		Actor actor = World.world.units.get(casterId);
		bool flag = !actor.isRekt();
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (!flag || item.id == casterId || !actor.kingdom.isEnemy(item.kingdom))
			{
				item.finishStatusEffect("burning");
				item.restoreHealth(item.getMaxHealthPercent(0.2f));
				item.startShake();
				item.startColorEffect();
			}
		}
	}

	public static void action_plague(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 4f))
		{
			if (item.hasTrait("plague"))
			{
				item.startShake();
				item.startColorEffect();
			}
			else
			{
				item.addTrait("plague");
			}
		}
	}

	public static void action_zombie_infection(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.can_turn_into_zombie && !item.hasTrait("zombie"))
			{
				item.addTrait("infected");
				item.startShake();
				item.startColorEffect();
			}
		}
	}

	public static void action_mush_spore(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.can_turn_into_mush && !item.hasTrait("mush_spores"))
			{
				item.addTrait("mush_spores");
				item.startShake();
				item.startColorEffect();
			}
		}
	}

	private static void action_curse(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.addStatusEffect("cursed"))
			{
				item.setStatsDirty();
				item.removeTrait("blessed");
				item.startShake();
				item.startColorEffect();
			}
		}
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_curse)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, pCheckRoad: false, pCheckBonuses: false, pForce: true);
		}
	}

	private static void action_spell_silence(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addStatusEffect("spell_silence");
		}
	}

	private static void action_shield(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addStatusEffect("shield");
		}
	}

	private static void action_powerup(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addStatusEffect("powerup");
			if (item.isSameSpecies("mush_unit") || item.isSameSpecies("mush_animal"))
			{
				AchievementLibrary.super_mushroom.check();
			}
		}
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_powerup)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, pCheckRoad: false, pCheckBonuses: false, pForce: true);
		}
	}

	private static void action_paint(WorldTile pTile = null, string pDropID = null)
	{
		TileZone zone = pTile.zone;
		if (!zone.hasCity())
		{
			return;
		}
		City city = zone.city;
		World.world.city_zone_helper.city_growth.getZoneToClaim(null, city, pDebug: true, _paint_zones_hashset, 1);
		using ListPool<TileZone> listPool = new ListPool<TileZone>();
		foreach (TileZone item in _paint_zones_hashset)
		{
			if (item.hasCity())
			{
				continue;
			}
			TileZone[] neighbours = item.neighbours;
			for (int i = 0; i < neighbours.Length; i++)
			{
				if (neighbours[i].city == city)
				{
					listPool.Add(item);
				}
			}
		}
		if (listPool.Count > 0)
		{
			TileZone random = listPool.GetRandom();
			city.addZone(random);
			city.setAbandonedZonesDirty();
		}
		_paint_zones_hashset.Clear();
	}

	public static void action_dust_black(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.affected_by_dust)
			{
				item.makeConfused(-1f, pColorEffect: true);
			}
		}
	}

	public static void action_dust_white(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.affected_by_dust)
			{
				item.forgetLanguage();
			}
		}
	}

	public static void action_dust_red(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.affected_by_dust)
			{
				item.makeConfused(-1f, pColorEffect: true);
				if (item.hasFamily())
				{
					item.setFamily(null);
				}
				if (item.hasClan())
				{
					item.forgetClan();
				}
				if (item.hasLover())
				{
					Actor lover = item.lover;
					item.setLover(null);
					lover.setLover(null);
				}
			}
		}
	}

	public static void action_dust_blue(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.affected_by_dust)
			{
				item.forgetCulture();
			}
		}
	}

	public static void action_dust_gold(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.affected_by_dust)
			{
				item.forgetKingdomAndCity();
			}
		}
	}

	public static void action_dust_purple(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.asset.affected_by_dust)
			{
				item.forgetReligion();
			}
		}
	}

	public static void action_coffee(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addStatusEffect("caffeinated");
		}
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_coffee)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, pCheckRoad: false, pCheckBonuses: false, pForce: true);
		}
	}

	public static void action_blessing(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			if (item.addTrait("blessed"))
			{
				item.setStatsDirty();
				item.event_full_stats = true;
			}
			item.finishStatusEffect("cursed");
			item.startShake();
			if (item.isSameSpecies("frog"))
			{
				AchievementLibrary.the_princess.check();
			}
			item.startColorEffect();
		}
		BiomeAsset biome = pTile.getBiome();
		if (biome != null && biome.spread_by_drops_blessing)
		{
			WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, pCheckRoad: false, pCheckBonuses: false, pForce: true);
		}
	}

	public static void action_alien_mold(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addTrait("desire_alien_mold");
		}
	}

	public static void action_drop_computer(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addTrait("desire_computer");
		}
	}

	public static void action_drop_golden_egg(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addTrait("desire_golden_egg");
		}
	}

	public static void action_drop_harp(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addTrait("desire_harp");
		}
	}

	public static void action_madness(WorldTile pTile = null, string pDropID = null)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1, 3f))
		{
			item.addTrait("madness");
		}
	}

	public static void action_inspiration(WorldTile pTile, string pDropID = null)
	{
		if (pTile.zone.hasCity() && !World.world.cities.isLocked())
		{
			City zone_city = pTile.zone_city;
			if (!zone_city.isNeutral() && zone_city.kingdom.countCities() != 1 && !zone_city.isCapitalCity() && zone_city.hasLeader())
			{
				zone_city.leader.addStatusEffect("voices_in_my_head");
				zone_city.useInspire(zone_city.leader);
			}
		}
	}

	public static void action_discord(WorldTile pTile, string pDropID = null)
	{
		if (!pTile.zone.hasCity())
		{
			return;
		}
		City zone_city = pTile.zone_city;
		if (zone_city != null && !zone_city.isNeutral())
		{
			Alliance alliance = zone_city.kingdom.getAlliance();
			if (alliance != null)
			{
				World.world.alliances.useDiscordPower(alliance, zone_city);
			}
		}
	}

	public static void action_spite(WorldTile pTile, string pDropID = null)
	{
		if (pTile.zone.hasCity())
		{
			Kingdom kingdom = pTile.zone.city.kingdom;
			if (!kingdom.isNeutral())
			{
				World.world.diplomacy.eventSpite(kingdom);
			}
		}
	}

	public static void action_friendship(WorldTile pTile, string pDropID = null)
	{
		if (pTile.zone.hasCity())
		{
			Kingdom kingdom = pTile.zone.city.kingdom;
			if (!kingdom.isNeutral())
			{
				World.world.diplomacy.eventFriendship(kingdom);
			}
		}
	}

	public static void action_spawn_building(WorldTile pTile = null, string pDropID = null)
	{
		string randomBuildingAsset = AssetManager.drops.get(pDropID).getRandomBuildingAsset();
		BuildingAsset buildingAsset = AssetManager.buildings.get(randomBuildingAsset);
		Building building = World.world.buildings.addBuilding(randomBuildingAsset, pTile, pCheckForBuild: true);
		if (building == null)
		{
			EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
		}
		else
		{
			buildingAsset.checkLimits(building);
		}
	}

	public static void flash(WorldTile pTile, string pDropID)
	{
		World.world.flash_effects.flashPixel(pTile, 20);
	}

	public static void action_fertilizer_plants(WorldTile pTile = null, string pDropID = null)
	{
		BuildingActions.tryGrowVegetationRandom(pTile, VegetationType.Plants, pOnStart: false, pCheckLimit: false, pCheckRandom: false);
		if (pTile.Type.biome_asset != null && pTile.Type.biome_asset.grow_type_selector_plants == null)
		{
			EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
		}
	}

	public static void action_fertilizer_trees(WorldTile pTile = null, string pDropID = null)
	{
		BiomeAsset biome_asset = pTile.Type.biome_asset;
		BuildingActions.tryGrowVegetationRandom(pTile, VegetationType.Trees, pOnStart: false, pCheckLimit: false, pCheckRandom: false);
		if (biome_asset != null && biome_asset.grow_type_selector_trees == null)
		{
			EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
		}
	}

	public static void action_fruit_bush(WorldTile pTile = null, string pDropID = null)
	{
		BuildingAsset buildingAsset = AssetManager.buildings.get("fruit_bush");
		BuildingActions.tryGrowVegetation(pTile, buildingAsset.id, pSfx: true, pCheckLimit: false);
		if (!buildingAsset.isOverlaysBiomeTags(pTile.Type))
		{
			EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
		}
	}

	public static void action_landmine(WorldTile pTile = null, string pDropID = null)
	{
		if (pTile.Type.lava)
		{
			World.world.explosion_layer.explodeBomb(pTile);
		}
		else
		{
			MapAction.terraformTop(pTile, TopTileLibrary.landmine, TerraformLibrary.remove);
		}
	}

	public static void action_living_house(WorldTile pTile = null, string pDropID = null)
	{
		TileZone zone = pTile.zone;
		if (!zone.hasAnyBuildings())
		{
			return;
		}
		using ListPool<Building> listPool = new ListPool<Building>();
		if (zone.hasAnyBuildingsInSet(BuildingList.Civs))
		{
			listPool.AddRange(zone.getHashset(BuildingList.Civs));
		}
		if (zone.hasAnyBuildingsInSet(BuildingList.Ruins))
		{
			listPool.AddRange(zone.getHashset(BuildingList.Ruins));
		}
		if (zone.hasAnyBuildingsInSet(BuildingList.Abandoned))
		{
			listPool.AddRange(zone.getHashset(BuildingList.Abandoned));
		}
		for (int i = 0; i < listPool.Count; i++)
		{
			ActionLibrary.tryToMakeBuildingAlive(listPool[i]);
		}
	}

	public static void action_living_plants(WorldTile pTile = null, string pDropID = null)
	{
		TileZone zone = pTile.zone;
		if (!zone.hasAnyBuildings())
		{
			return;
		}
		using ListPool<Building> listPool = new ListPool<Building>();
		if (zone.hasAnyBuildingsInSet(BuildingList.Food))
		{
			listPool.AddRange(zone.getHashset(BuildingList.Food));
		}
		if (zone.hasAnyBuildingsInSet(BuildingList.Trees))
		{
			listPool.AddRange(zone.getHashset(BuildingList.Trees));
		}
		if (zone.hasAnyBuildingsInSet(BuildingList.Wheat))
		{
			listPool.AddRange(zone.getHashset(BuildingList.Wheat));
		}
		for (int i = 0; i < listPool.Count; i++)
		{
			ActionLibrary.tryToMakeFloraAlive(listPool[i]);
		}
	}
}
// --- End of File: DropsLibrary.cs ---



// --- Start of File: DropType.cs ---
public enum DropType
{
	DropSeed,
	DropBomb,
	DropBuilding,
	DropMineral,
	DropCreep,
	DropTraitRain,
	DropEquipmentRain,
	DropMagic,
	DropGeneric,
	DropTile,
	DropStatus,
	DropTrait
}
// --- End of File: DropType.cs ---



// --- Start of File: DynamicActorSpriteCreatorUI.cs ---
using UnityEngine;

public static class DynamicActorSpriteCreatorUI
{
	private static int[] _boat_angles = new int[8] { 0, -45, -90, -135, 180, 135, 90, 45 };

	public static AnimationContainerUnit getContainerForUI(ActorAsset pAsset, bool pAdult, ActorTextureSubAsset pTextureAsset, SubspeciesTrait pMutationAsset = null, bool pIsEgg = false, SubspeciesTrait pEggAsset = null, string pTexturePath = null)
	{
		string pTexturePath2 = ((!string.IsNullOrEmpty(pTexturePath)) ? pTexturePath : (pIsEgg ? pEggAsset.sprite_path : ((pAdult || !pAsset.has_baby_form) ? pTextureAsset.getUnitTexturePathForUI(pAsset) : pTextureAsset.texture_path_baby)));
		return ActorAnimationLoader.getAnimationContainer(pTexturePath2, pAsset, pEggAsset, pMutationAsset);
	}

	public static AnimationContainerUnit getContainerForUI(Actor pActor)
	{
		Subspecies subspecies = pActor.subspecies;
		ActorAsset asset = pActor.asset;
		SubspeciesTrait subspeciesTrait = null;
		ActorTextureSubAsset texture_asset;
		if (pActor.hasSubspecies() && subspecies.has_mutation_reskin)
		{
			subspeciesTrait = subspecies.mutation_skin_asset;
			texture_asset = subspeciesTrait.texture_asset;
		}
		else
		{
			texture_asset = asset.texture_asset;
		}
		return getContainerForUI(asset, pActor.isAdult(), texture_asset, subspeciesTrait);
	}

	public static Sprite getUnitSpriteForUI(ActorAsset pAsset, Sprite pMainSprite, AnimationContainerUnit pContainer, bool pAdult, ActorSex pSex, int pPhenotypeIndex, int pPhenotypeShade, ColorAsset pKingdomColor, long pActorId, int pHeadId, bool pEgg = false, bool pKing = false, bool pWarrior = false, bool pWise = false)
	{
		long num = 0L;
		long num2 = pPhenotypeIndex;
		long num3 = 0L;
		long num4 = 0L;
		long num5 = DynamicSpriteCreator.getBodySpriteSmallID(pMainSprite);
		if (num2 != 0L)
		{
			num3 = pPhenotypeShade + 1;
		}
		Sprite spriteHeadForUI = getSpriteHeadForUI(pAsset, pSex, pContainer, pActorId, pHeadId, pAdult, pEgg, pKing, pWarrior, pWise);
		int value = 0;
		if ((Object)(object)spriteHeadForUI != (Object)null)
		{
			ActorAnimationLoader.int_ids_heads.TryGetValue(spriteHeadForUI, out value);
			if (value == 0)
			{
				int num6 = ActorAnimationLoader.int_ids_heads.Count + 1;
				ActorAnimationLoader.int_ids_heads.Add(spriteHeadForUI, num6);
				value = num6;
			}
			num4 = value;
		}
		if (pKingdomColor != null)
		{
			num = pKingdomColor.index_id + 1;
		}
		long num7 = num * 10000000 + num4 * 1000000 + num5 * 1000 + num2 * 10 + num3;
		AnimationFrameData value2 = null;
		pContainer?.dict_frame_data.TryGetValue(((Object)pMainSprite).name, out value2);
		DynamicSpritesAsset units = DynamicSpritesLibrary.units;
		Sprite val = units.getSprite(num7);
		if (val == null)
		{
			val = DynamicSpriteCreator.createNewSpriteUnit(value2, pMainSprite, spriteHeadForUI, pKingdomColor, pAsset, pPhenotypeIndex, pPhenotypeShade, pAsset.texture_atlas);
			units.addSprite(num7, val);
		}
		return val;
	}

	public static Sprite getUnitSpriteForUI(Actor pActor, Sprite pSprite)
	{
		ActorAsset asset = pActor.asset;
		AnimationContainerUnit animation_container = pActor.animation_container;
		if (asset.has_override_avatar_frames)
		{
			return asset.get_override_avatar_frames(pActor)[0];
		}
		int phenotype_shade = pActor.data.phenotype_shade;
		int phenotype_index = pActor.data.phenotype_index;
		return getUnitSpriteForUI(pActor.asset, pSprite, animation_container, pActor.isAdult(), pActor.data.sex, phenotype_index, phenotype_shade, pActor.kingdom.getColor(), pActor.data.id, pActor.data.head, pActor.isEgg());
	}

	public static Sprite getSpriteHeadForUI(ActorAsset pAsset, ActorSex pSex, AnimationContainerUnit pContainer, long pActorId, int pHeadId, bool pAdult = true, bool pEgg = false, bool pKing = false, bool pWarrior = false, bool pWise = false, bool pRandom = false)
	{
		if (pEgg)
		{
			return null;
		}
		if (pAsset.is_boat)
		{
			return null;
		}
		if (!pAdult && !pContainer.render_heads_for_children)
		{
			return null;
		}
		string pPath = "";
		int num = 0;
		bool flag = false;
		ActorTextureSubAsset texture_asset = pAsset.texture_asset;
		if (!texture_asset.has_advanced_textures)
		{
			Sprite[] heads = pContainer.heads;
			if (heads != null && heads.Length != 0)
			{
				if (pRandom)
				{
					return pContainer.heads.GetRandom();
				}
				num = AnimationHelper.getSpriteIndex(pActorId, pContainer.heads.Length);
				return getSprite(num, pContainer.heads);
			}
			return null;
		}
		if (pKing)
		{
			pPath = texture_asset.texture_head_king;
			flag = true;
		}
		else if (pWarrior)
		{
			pPath = texture_asset.texture_head_warrior;
			flag = true;
		}
		else if (pWise && texture_asset.has_old_heads)
		{
			flag = true;
			pPath = ((pSex != 0) ? texture_asset.texture_heads_old_female : texture_asset.texture_heads_old_male);
		}
		if (flag)
		{
			return ActorAnimationLoader.getHeadSpecial(pPath);
		}
		if (pSex == ActorSex.Male)
		{
			if (pRandom)
			{
				return pContainer.heads_male.GetRandom();
			}
			num = ((pHeadId != -1) ? pHeadId : AnimationHelper.getSpriteIndex(pActorId, pContainer.heads_male.Length));
			return getSprite(num, pContainer.heads_male);
		}
		if (pRandom)
		{
			return pContainer.heads_female.GetRandom();
		}
		num = ((pHeadId != -1) ? pHeadId : AnimationHelper.getSpriteIndex(pActorId, pContainer.heads_female.Length));
		return getSprite(num, pContainer.heads_female);
	}

	private static Sprite getSprite(int pIndex, Sprite[] pSprites)
	{
		return pSprites[pIndex];
	}

	public static ActorAnimation getBoatAnimation(AnimationDataBoat pBoatAnimation)
	{
		ActorAnimation actorAnimation = new ActorAnimation();
		Sprite[] array = (Sprite[])(object)new Sprite[_boat_angles.Length * 2];
		for (int i = 0; i < _boat_angles.Length; i++)
		{
			int key = _boat_angles[i];
			ActorAnimation actorAnimation2 = pBoatAnimation.dict[key];
			int num = i * 2;
			array[num] = actorAnimation2.frames[0];
			array[num + 1] = actorAnimation2.frames[1];
		}
		actorAnimation.frames = array;
		return actorAnimation;
	}
}
// --- End of File: DynamicActorSpriteCreatorUI.cs ---



// --- Start of File: DynamicColorPixelTool.cs ---
using System;
using UnityEngine;

public static class DynamicColorPixelTool
{
	private static bool _draw_phenotype;

	private static Color32 _phenotype_color;

	public static Color32 phenotype_shade_0;

	public static Color32 phenotype_shade_1;

	public static Color32 phenotype_shade_2;

	public static Color32 phenotype_shade_3;

	private static readonly Color32 _zombie_blood_color = Color32.op_Implicit(Toolbox.makeColor("#CE566E"));

	public static Color32 checkSpecialColors(Color32 pColor, ColorAsset pKingdomColor, bool pCheckForLightColors = false)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0179: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0139: Unknown result type (might be due to invalid IL or missing references)
		//IL_013a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0130: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_014f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0150: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0165: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0172: Unknown result type (might be due to invalid IL or missing references)
		//IL_0177: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011a: Unknown result type (might be due to invalid IL or missing references)
		if (Config.EVERYTHING_MAGIC_COLOR)
		{
			return Toolbox.EVERYTHING_MAGIC_COLOR32;
		}
		if (pCheckForLightColors && Toolbox.areColorsEqual(pColor, Toolbox.color_light))
		{
			pColor = Toolbox.color_light_replace;
			return pColor;
		}
		if (pKingdomColor != null)
		{
			if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_0))
			{
				pColor = pKingdomColor.k_color_0;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_1))
			{
				pColor = pKingdomColor.k_color_1;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_2))
			{
				pColor = pKingdomColor.k_color_2;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_3))
			{
				pColor = pKingdomColor.k_color_3;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_4))
			{
				pColor = pKingdomColor.k_color_4;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_0))
			{
				pColor = pKingdomColor.k2_color_0;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_1))
			{
				pColor = pKingdomColor.k2_color_1;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_2))
			{
				pColor = pKingdomColor.k2_color_2;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_3))
			{
				pColor = pKingdomColor.k2_color_3;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_4))
			{
				pColor = pKingdomColor.k2_color_4;
			}
		}
		if (_draw_phenotype)
		{
			if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_0))
			{
				pColor = phenotype_shade_0;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_1))
			{
				pColor = phenotype_shade_1;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_2))
			{
				pColor = phenotype_shade_2;
			}
			else if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_3))
			{
				pColor = phenotype_shade_3;
			}
		}
		return pColor;
	}

	public static Color32 checkZombieColors(ActorAsset pAsset, Color32 pColor, int pID, bool pHead = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		Color32 pTargetBlendColor = Color32.op_Implicit(Toolbox.makeColor(pAsset.zombie_color_hex));
		return addNoiseAndBlood(multiplyBlend(pColor, pTargetBlendColor), pID);
	}

	private static Color32 addNoiseAndBlood(Color32 pTargetColor, int pID)
	{
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		Random random = new Random(pID);
		if (random.NextDouble() < 0.5)
		{
			return multiplyBlend(pTargetColor, _zombie_blood_color, 0.2f);
		}
		int num = random.Next(0, 20);
		int num2 = Mathf.Clamp(pTargetColor.r + num, 0, 255);
		int num3 = Mathf.Clamp(pTargetColor.g + num, 0, 255);
		int num4 = Mathf.Clamp(pTargetColor.b + num, 0, 255);
		return new Color32((byte)num2, (byte)num3, (byte)num4, pTargetColor.a);
	}

	private static Color32 multiplyBlend(Color32 pBaseColor, Color32 pTargetBlendColor, float pIntensity = 1f)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		float num = (float)(int)pBaseColor.r / 255f;
		float num2 = (float)(int)pBaseColor.g / 255f;
		float num3 = (float)(int)pBaseColor.b / 255f;
		float num4 = Mathf.Lerp(1f, (float)(int)pTargetBlendColor.r / 255f, pIntensity);
		float num5 = Mathf.Lerp(1f, (float)(int)pTargetBlendColor.g / 255f, pIntensity);
		float num6 = Mathf.Lerp(1f, (float)(int)pTargetBlendColor.b / 255f, pIntensity);
		float num7 = Mathf.Clamp01(num * num4);
		float num8 = Mathf.Clamp01(num2 * num5);
		float num9 = Mathf.Clamp01(num3 * num6);
		return new Color32((byte)(num7 * 255f), (byte)(num8 * 255f), (byte)(num9 * 255f), pBaseColor.a);
	}

	private static Color32 overlayBlend(Color32 pBaseColor, Color32 pTargetBlendColor)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		float num = (float)(int)pBaseColor.r / 255f;
		float num2 = (float)(int)pBaseColor.g / 255f;
		float num3 = (float)(int)pBaseColor.b / 255f;
		float num4 = (float)(int)pTargetBlendColor.r / 255f;
		float num5 = (float)(int)pTargetBlendColor.g / 255f;
		float num6 = (float)(int)pTargetBlendColor.b / 255f;
		float num7 = ((num < 0.5f) ? (2f * num * num4) : (1f - 2f * (1f - num) * (1f - num4)));
		float num8 = ((num2 < 0.5f) ? (2f * num2 * num5) : (1f - 2f * (1f - num2) * (1f - num5)));
		float num9 = ((num3 < 0.5f) ? (2f * num3 * num6) : (1f - 2f * (1f - num3) * (1f - num6)));
		return new Color32((byte)(num7 * 255f), (byte)(num8 * 255f), (byte)(num9 * 255f), pBaseColor.a);
	}

	public static void loadPhenotype(int pPhenotypeIndex, int pPhenotypeShadeIndex)
	{
		loadPhenotype(AssetManager.phenotype_library.getAssetByPhenotypeIndex(pPhenotypeIndex), pPhenotypeShadeIndex);
	}

	public static void loadPhenotype(PhenotypeAsset pPhenotypeAsset, int pPhenotypeShadeIndex)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		_phenotype_color = pPhenotypeAsset.colors[pPhenotypeShadeIndex];
		_draw_phenotype = true;
		phenotype_shade_0 = Color32.op_Implicit(Toolbox.makeDarkerColor(Color32.op_Implicit(_phenotype_color), 1f));
		phenotype_shade_1 = Color32.op_Implicit(Toolbox.makeDarkerColor(Color32.op_Implicit(_phenotype_color), 0.9f));
		phenotype_shade_2 = Color32.op_Implicit(Toolbox.makeDarkerColor(Color32.op_Implicit(_phenotype_color), 0.8f));
		phenotype_shade_3 = Color32.op_Implicit(Toolbox.makeDarkerColor(Color32.op_Implicit(_phenotype_color), 0.7f));
	}

	public static void loadSkinColorsPreview(PhenotypeAsset pPhenotype, int pSkinColor)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		_draw_phenotype = true;
		phenotype_shade_0 = pPhenotype.colors[0];
		phenotype_shade_1 = pPhenotype.colors[1];
		phenotype_shade_2 = pPhenotype.colors[2];
		phenotype_shade_3 = pPhenotype.colors[3];
	}

	public static void resetSkinColors()
	{
		_draw_phenotype = false;
	}

	public static void setPlaceholderSkinColor(Color32 pColor)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		_phenotype_color = pColor;
	}
}
// --- End of File: DynamicColorPixelTool.cs ---



// --- Start of File: DynamicGrid.cs ---
using System.Collections.Generic;

namespace EpPathFinding.cs;

public class DynamicGrid : BaseGrid
{
	protected Dictionary<GridPos, Node> m_nodes;

	private bool m_notSet;

	public override int width
	{
		get
		{
			if (m_notSet)
			{
				setBoundingBox();
			}
			return m_gridRect.maxX - m_gridRect.minX + 1;
		}
		protected set
		{
		}
	}

	public override int height
	{
		get
		{
			if (m_notSet)
			{
				setBoundingBox();
			}
			return m_gridRect.maxY - m_gridRect.minY + 1;
		}
		protected set
		{
		}
	}

	public DynamicGrid(List<GridPos> iWalkableGridList = null)
	{
		m_gridRect = new GridRect();
		m_gridRect.minX = 0;
		m_gridRect.minY = 0;
		m_gridRect.maxX = 0;
		m_gridRect.maxY = 0;
		m_notSet = true;
		buildNodes(iWalkableGridList);
	}

	public DynamicGrid(DynamicGrid b)
		: base(b)
	{
		m_notSet = b.m_notSet;
		m_nodes = new Dictionary<GridPos, Node>(b.m_nodes);
	}

	protected void buildNodes(List<GridPos> iWalkableGridList)
	{
		m_nodes = new Dictionary<GridPos, Node>();
		if (iWalkableGridList == null)
		{
			return;
		}
		foreach (GridPos iWalkableGrid in iWalkableGridList)
		{
			SetWalkableAt(iWalkableGrid.x, iWalkableGrid.y, iWalkable: true);
		}
	}

	public override Node GetNodeAt(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return GetNodeAt(iPos);
	}

	public override bool IsWalkableAt(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return IsWalkableAt(iPos);
	}

	private void setBoundingBox()
	{
		m_notSet = true;
		foreach (KeyValuePair<GridPos, Node> node in m_nodes)
		{
			if (node.Key.x < m_gridRect.minX || m_notSet)
			{
				m_gridRect.minX = node.Key.x;
			}
			if (node.Key.x > m_gridRect.maxX || m_notSet)
			{
				m_gridRect.maxX = node.Key.x;
			}
			if (node.Key.y < m_gridRect.minY || m_notSet)
			{
				m_gridRect.minY = node.Key.y;
			}
			if (node.Key.y > m_gridRect.maxY || m_notSet)
			{
				m_gridRect.maxY = node.Key.y;
			}
			m_notSet = false;
		}
		m_notSet = false;
	}

	public override bool SetWalkableAt(int iX, int iY, bool iWalkable, int pCost = 1)
	{
		GridPos gridPos = new GridPos(iX, iY);
		if (iWalkable)
		{
			if (m_nodes.ContainsKey(gridPos))
			{
				return true;
			}
			if (iX < m_gridRect.minX || m_notSet)
			{
				m_gridRect.minX = iX;
			}
			if (iX > m_gridRect.maxX || m_notSet)
			{
				m_gridRect.maxX = iX;
			}
			if (iY < m_gridRect.minY || m_notSet)
			{
				m_gridRect.minY = iY;
			}
			if (iY > m_gridRect.maxY || m_notSet)
			{
				m_gridRect.maxY = iY;
			}
			m_nodes.Add(new GridPos(gridPos.x, gridPos.y), new Node(gridPos.x, gridPos.y, iWalkable));
		}
		else if (m_nodes.ContainsKey(gridPos))
		{
			m_nodes.Remove(gridPos);
			if (iX == m_gridRect.minX || iX == m_gridRect.maxX || iY == m_gridRect.minY || iY == m_gridRect.maxY)
			{
				m_notSet = true;
			}
		}
		return true;
	}

	public override Node GetNodeAt(GridPos iPos)
	{
		if (m_nodes.ContainsKey(iPos))
		{
			return m_nodes[iPos];
		}
		return null;
	}

	public override bool IsWalkableAt(GridPos iPos)
	{
		return m_nodes.ContainsKey(iPos);
	}

	public override bool SetWalkableAt(GridPos iPos, bool iWalkable)
	{
		return SetWalkableAt(iPos.x, iPos.y, iWalkable);
	}

	public override void Reset()
	{
		Reset(null);
	}

	public void Reset(List<GridPos> iWalkableGridList)
	{
		foreach (KeyValuePair<GridPos, Node> node in m_nodes)
		{
			node.Value.Reset();
		}
		if (iWalkableGridList == null)
		{
			return;
		}
		foreach (KeyValuePair<GridPos, Node> node2 in m_nodes)
		{
			if (iWalkableGridList.Contains(node2.Key))
			{
				SetWalkableAt(node2.Key, iWalkable: true);
			}
			else
			{
				SetWalkableAt(node2.Key, iWalkable: false);
			}
		}
	}

	public override BaseGrid Clone()
	{
		DynamicGrid dynamicGrid = new DynamicGrid();
		foreach (KeyValuePair<GridPos, Node> node in m_nodes)
		{
			dynamicGrid.SetWalkableAt(node.Key.x, node.Key.y, iWalkable: true);
		}
		return dynamicGrid;
	}
}
// --- End of File: DynamicGrid.cs ---



// --- Start of File: DynamicGridWPool.cs ---
using System.Collections.Generic;

namespace EpPathFinding.cs;

public class DynamicGridWPool : BaseGrid
{
	private bool m_notSet;

	private NodePool m_nodePool;

	public override int width
	{
		get
		{
			if (m_notSet)
			{
				setBoundingBox();
			}
			return m_gridRect.maxX - m_gridRect.minX + 1;
		}
		protected set
		{
		}
	}

	public override int height
	{
		get
		{
			if (m_notSet)
			{
				setBoundingBox();
			}
			return m_gridRect.maxY - m_gridRect.minY + 1;
		}
		protected set
		{
		}
	}

	public DynamicGridWPool(NodePool iNodePool)
	{
		m_gridRect = new GridRect();
		m_gridRect.minX = 0;
		m_gridRect.minY = 0;
		m_gridRect.maxX = 0;
		m_gridRect.maxY = 0;
		m_notSet = true;
		m_nodePool = iNodePool;
	}

	public DynamicGridWPool(DynamicGridWPool b)
		: base(b)
	{
		m_notSet = b.m_notSet;
		m_nodePool = b.m_nodePool;
	}

	public override Node GetNodeAt(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return GetNodeAt(iPos);
	}

	public override bool IsWalkableAt(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return IsWalkableAt(iPos);
	}

	private void setBoundingBox()
	{
		m_notSet = true;
		foreach (KeyValuePair<GridPos, Node> node in m_nodePool.Nodes)
		{
			if (node.Key.x < m_gridRect.minX || m_notSet)
			{
				m_gridRect.minX = node.Key.x;
			}
			if (node.Key.x > m_gridRect.maxX || m_notSet)
			{
				m_gridRect.maxX = node.Key.x;
			}
			if (node.Key.y < m_gridRect.minY || m_notSet)
			{
				m_gridRect.minY = node.Key.y;
			}
			if (node.Key.y > m_gridRect.maxY || m_notSet)
			{
				m_gridRect.maxY = node.Key.y;
			}
			m_notSet = false;
		}
		m_notSet = false;
	}

	public override bool SetWalkableAt(int iX, int iY, bool iWalkable, int pCost = 1)
	{
		GridPos iPos = new GridPos(iX, iY);
		m_nodePool.SetNode(iPos, iWalkable);
		if (iWalkable)
		{
			if (iX < m_gridRect.minX || m_notSet)
			{
				m_gridRect.minX = iX;
			}
			if (iX > m_gridRect.maxX || m_notSet)
			{
				m_gridRect.maxX = iX;
			}
			if (iY < m_gridRect.minY || m_notSet)
			{
				m_gridRect.minY = iY;
			}
			if (iY > m_gridRect.maxY || m_notSet)
			{
				m_gridRect.maxY = iY;
			}
		}
		else if (iX == m_gridRect.minX || iX == m_gridRect.maxX || iY == m_gridRect.minY || iY == m_gridRect.maxY)
		{
			m_notSet = true;
		}
		return true;
	}

	public override Node GetNodeAt(GridPos iPos)
	{
		return m_nodePool.GetNode(iPos);
	}

	public override bool IsWalkableAt(GridPos iPos)
	{
		return m_nodePool.Nodes.ContainsKey(iPos);
	}

	public override bool SetWalkableAt(GridPos iPos, bool iWalkable)
	{
		return SetWalkableAt(iPos.x, iPos.y, iWalkable);
	}

	public override void Reset()
	{
		foreach (KeyValuePair<GridPos, Node> node in m_nodePool.Nodes)
		{
			node.Value.Reset();
		}
	}

	public override BaseGrid Clone()
	{
		return new DynamicGridWPool(m_nodePool);
	}
}
// --- End of File: DynamicGridWPool.cs ---



// --- Start of File: DynamicSpriteCreator.cs ---
using System.Collections.Generic;
using UnityEngine;

public static class DynamicSpriteCreator
{
	public static Actor debug_actor;

	private static Dictionary<Sprite, int> _int_ids_body = new Dictionary<Sprite, int>();

	private static readonly Color32 _placeholder_color_skin = Color32.op_Implicit(Toolbox.makeColor("#00FF00"));

	private static readonly List<Vector2Int> _light_colors = new List<Vector2Int>();

	public static Sprite createNewItemSprite(DynamicSpritesAsset pAsset, Sprite pSource, ColorAsset pKingdomColor)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas atlas = pAsset.getAtlas();
		Rect rect = pSource.rect;
		int pWidth = (int)((Rect)(ref rect)).width;
		int pHeight = (int)((Rect)(ref rect)).height;
		atlas.checkBounds(pWidth, pHeight);
		int width = ((Texture)atlas.texture).width;
		_ = ((Texture)atlas.texture).height;
		Color32[] pixels = pSource.texture.GetPixels32();
		int width2 = ((Texture)pSource.texture).width;
		for (int i = 0; (float)i < ((Rect)(ref rect)).width; i++)
		{
			for (int j = 0; (float)j < ((Rect)(ref rect)).height; j++)
			{
				int num = i + (int)((Rect)(ref rect)).x;
				int num2 = j + (int)((Rect)(ref rect)).y;
				int num3 = num + num2 * width2;
				Color32 val = pixels[num3];
				if (val.a != 0)
				{
					val = DynamicColorPixelTool.checkSpecialColors(val, pKingdomColor, pCheckForLightColors: true);
					int num4 = i + atlas.last_x;
					int num5 = j + atlas.last_y;
					if (num4 < 0)
					{
						num4 = 0;
					}
					if (num5 < 0)
					{
						num5 = 0;
					}
					num3 = num4 + num5 * width;
					atlas.pixels[num3] = val;
				}
			}
		}
		setAtlasDirty(atlas);
		return createFinalSprite(atlas, pSource, pWidth, pHeight);
	}

	private static Sprite createFinalSprite(UnitSpriteConstructorAtlas pAtlasTexture, Sprite pMain, int pWidth, int pHeight, int pResizeX = 0, int pResizeY = 0)
	{
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		Rect val = default(Rect);
		((Rect)(ref val))._002Ector((float)pAtlasTexture.last_x, (float)pAtlasTexture.last_y, (float)pWidth, (float)pHeight);
		Vector2 val2 = default(Vector2);
		((Vector2)(ref val2))._002Ector((pMain.pivot.x + (float)pResizeX) / (float)pWidth, pMain.pivot.y / (float)pHeight);
		Sprite obj = Sprite.Create(pAtlasTexture.texture, val, val2, 1f);
		((Object)obj).name = "gen_" + ((Object)pMain).name;
		pAtlasTexture.last_x += pWidth + 1;
		return obj;
	}

	private static Sprite createNewSpriteBuildingShadow(DynamicSpritesAsset pDynamicSpritesAsset, BuildingAsset tAsset, Sprite pSource, bool pIsContructionSprite)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0221: Unknown result type (might be due to invalid IL or missing references)
		//IL_0223: Unknown result type (might be due to invalid IL or missing references)
		//IL_014a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Unknown result type (might be due to invalid IL or missing references)
		//IL_0168: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas atlas = pDynamicSpritesAsset.getAtlas();
		Rect rect = pSource.rect;
		int num = 3;
		int num2 = (int)((Rect)(ref rect)).width;
		int num3 = (int)((Rect)(ref rect)).height;
		int num4 = (int)((Rect)(ref rect)).x;
		int num5 = (int)((Rect)(ref rect)).y;
		atlas.checkBounds(num2 + num, num3);
		int width = ((Texture)atlas.texture).width;
		_ = ((Texture)atlas.texture).height;
		Color32[] pixels = pSource.texture.GetPixels32();
		Vector2 val;
		float num6;
		if (pIsContructionSprite)
		{
			val = BuildingLibrary.shadow_under_construction_bound;
			num6 = BuildingLibrary.shadow_under_construction_distortion;
		}
		else
		{
			val = tAsset.shadow_bound;
			num6 = tAsset.shadow_distortion;
		}
		int num7 = (int)(val.x * (float)num2);
		int num8 = (int)((float)num3 * val.y);
		List<Vector2Int> list = new List<Vector2Int>();
		Color32 val2 = Color32.op_Implicit(Color.black);
		int width2 = ((Texture)pSource.texture).width;
		for (int i = 0; i < num2; i++)
		{
			for (int j = 0; j < num3; j++)
			{
				int num9 = i + num4;
				int num10 = j + num5;
				int num11 = num9 + num10 * width2;
				Color32 val3 = pixels[num11];
				if (val3.a == 0)
				{
					continue;
				}
				val3 = val2;
				if (i >= num7)
				{
					int num12 = i + atlas.last_x;
					int num13 = j + atlas.last_y;
					if (j > num8)
					{
						num13 = (int)((float)j * num6) + atlas.last_y;
					}
					if (num12 < 0)
					{
						num12 = 0;
					}
					if (num13 < 0)
					{
						num13 = 0;
					}
					list.Add(new Vector2Int(num12, num13));
					num11 = num12 + num13 * width;
					atlas.pixels[num11] = val3;
				}
			}
		}
		setAtlasDirty(atlas);
		num2 += num;
		foreach (Vector2Int item in list)
		{
			Vector2Int current = item;
			int num14 = ((Vector2Int)(ref current)).x + 1;
			int y = ((Vector2Int)(ref current)).y;
			int num15 = num14 + y * width;
			atlas.pixels[num15] = val2;
			int num16 = ((Vector2Int)(ref current)).x + 2;
			y = ((Vector2Int)(ref current)).y;
			num15 = num16 + y * width;
			atlas.pixels[num15] = val2;
			int num17 = ((Vector2Int)(ref current)).x + 1;
			y = ((Vector2Int)(ref current)).y + 1;
			num15 = num17 + y * width;
			atlas.pixels[num15] = val2;
		}
		return createFinalSprite(atlas, pSource, num2, num3);
	}

	public static Sprite createNewUnitShadow(DynamicSpritesAsset pAsset, Sprite pSource)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00df: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas atlas = pAsset.getAtlas();
		Rect rect = pSource.rect;
		int num = 1;
		int num2 = (int)((Rect)(ref rect)).width;
		int num3 = (int)((Rect)(ref rect)).height;
		int num4 = (int)((Rect)(ref rect)).x;
		int num5 = (int)((Rect)(ref rect)).y;
		atlas.checkBounds(num2 + num, num3);
		int width = ((Texture)atlas.texture).width;
		_ = ((Texture)atlas.texture).height;
		Color32[] pixels = pSource.texture.GetPixels32();
		int width2 = ((Texture)pSource.texture).width;
		for (int i = 0; i < num2; i++)
		{
			for (int j = 0; j < num3; j++)
			{
				int num6 = i + num4;
				int num7 = j + num5;
				int num8 = num6 + num7 * width2;
				Color32 val = pixels[num8];
				if (val.a != 0)
				{
					int num9 = i + atlas.last_x;
					int num10 = j + atlas.last_y;
					if (num9 < 0)
					{
						num9 = 0;
					}
					if (num10 < 0)
					{
						num10 = 0;
					}
					num8 = num9 + num10 * width;
					atlas.pixels[num8] = val;
				}
			}
		}
		num2 += num;
		setAtlasDirty(atlas);
		return createFinalSprite(atlas, pSource, num2, num3);
	}

	public static void createBuildingShadow(BuildingAsset pAsset, Sprite pSprite, bool pIsContructionSprite)
	{
		DynamicSpritesAsset building_shadows = DynamicSpritesLibrary.building_shadows;
		int hashCode = ((object)pSprite).GetHashCode();
		Sprite pSprite2 = createNewSpriteBuildingShadow(building_shadows, pAsset, pSprite, pIsContructionSprite);
		building_shadows.addSprite(hashCode, pSprite2);
	}

	public static Sprite createNewIcon(DynamicSpritesAsset pAsset, Sprite pSource, ColorAsset pKingdomColor, PhenotypeAsset pPhenotype = null)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas atlas = pAsset.getAtlas();
		if (pPhenotype != null)
		{
			DynamicColorPixelTool.loadSkinColorsPreview(pPhenotype, 0);
		}
		Rect rect = pSource.rect;
		int pWidth = (int)((Rect)(ref rect)).width;
		int pHeight = (int)((Rect)(ref rect)).height;
		atlas.checkBounds(pWidth, pHeight);
		int width = ((Texture)atlas.texture).width;
		_ = ((Texture)atlas.texture).height;
		Color32[] pixels = pSource.texture.GetPixels32();
		int width2 = ((Texture)pSource.texture).width;
		for (int i = 0; (float)i < ((Rect)(ref rect)).width; i++)
		{
			for (int j = 0; (float)j < ((Rect)(ref rect)).height; j++)
			{
				int num = i + (int)((Rect)(ref rect)).x;
				int num2 = j + (int)((Rect)(ref rect)).y;
				int num3 = num + num2 * width2;
				Color32 val = pixels[num3];
				if (val.a != 0)
				{
					val = DynamicColorPixelTool.checkSpecialColors(val, pKingdomColor, pCheckForLightColors: true);
					int num4 = i + atlas.last_x;
					int num5 = j + atlas.last_y;
					if (num4 < 0)
					{
						num4 = 0;
					}
					if (num5 < 0)
					{
						num5 = 0;
					}
					num3 = num4 + num5 * width;
					atlas.pixels[num3] = val;
				}
			}
		}
		setAtlasDirty(atlas);
		return createFinalSprite(atlas, pSource, pWidth, pHeight);
	}

	public static Sprite createNewSpriteBuilding(DynamicSpritesAsset pAssetAtlas, long pID, Sprite pSource, ColorAsset pKingdomColor)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas atlas = pAssetAtlas.getAtlas();
		Rect rect = pSource.rect;
		int pWidth = (int)((Rect)(ref rect)).width;
		int pHeight = (int)((Rect)(ref rect)).height;
		atlas.checkBounds(pWidth, pHeight);
		int width = ((Texture)atlas.texture).width;
		_ = ((Texture)atlas.texture).height;
		Color32[] pixels = pSource.texture.GetPixels32();
		_light_colors.Clear();
		int width2 = ((Texture)pSource.texture).width;
		for (int i = 0; (float)i < ((Rect)(ref rect)).width; i++)
		{
			for (int j = 0; (float)j < ((Rect)(ref rect)).height; j++)
			{
				int num = i + (int)((Rect)(ref rect)).x;
				int num2 = j + (int)((Rect)(ref rect)).y;
				int num3 = num + num2 * width2;
				Color32 val = pixels[num3];
				if (val.a != 0)
				{
					if (Toolbox.areColorsEqual(val, Toolbox.color_light))
					{
						_light_colors.Add(new Vector2Int(i, j));
					}
					val = DynamicColorPixelTool.checkSpecialColors(val, pKingdomColor, pCheckForLightColors: true);
					int num4 = i + atlas.last_x;
					int num5 = j + atlas.last_y;
					if (num4 < 0)
					{
						num4 = 0;
					}
					if (num5 < 0)
					{
						num5 = 0;
					}
					num3 = num4 + num5 * width;
					atlas.pixels[num3] = val;
				}
			}
		}
		setAtlasDirty(atlas);
		Sprite result = createFinalSprite(atlas, pSource, pWidth, pHeight);
		if (_light_colors.Count > 0)
		{
			checkBuildingLightSprite(DynamicSpritesLibrary.building_lights, ((object)pSource).GetHashCode(), pSource);
		}
		return result;
	}

	private static void checkBuildingLightSprite(DynamicSpritesAsset pQuantumAsset, long pHashcodeMainSprite, Sprite pSprite)
	{
		Sprite sprite = pQuantumAsset.getSprite(pHashcodeMainSprite);
		if (sprite == null)
		{
			sprite = createNewSpriteBuildingLight(pQuantumAsset, pSprite);
			pQuantumAsset.addSprite(pHashcodeMainSprite, sprite);
		}
	}

	public static Sprite createNewSpriteBuildingLight(DynamicSpritesAsset pAsset, Sprite pSource)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas atlas = pAsset.getAtlas();
		Rect rect = pSource.rect;
		int pWidth = (int)((Rect)(ref rect)).width;
		int pHeight = (int)((Rect)(ref rect)).height;
		atlas.checkBounds(pWidth, pHeight);
		int width = ((Texture)pSource.texture).width;
		for (int i = 0; i < _light_colors.Count; i++)
		{
			Vector2Int val = _light_colors[i];
			drawLightPixel(atlas, ((Vector2Int)(ref val)).x, ((Vector2Int)(ref val)).y, pWidth, pHeight, width, Toolbox.color_light_100);
			drawLightPixel(atlas, ((Vector2Int)(ref val)).x, ((Vector2Int)(ref val)).y - 1, pWidth, pHeight, width, Toolbox.color_light_10);
			drawLightPixel(atlas, ((Vector2Int)(ref val)).x - 1, ((Vector2Int)(ref val)).y, pWidth, pHeight, width, Toolbox.color_light_10);
			drawLightPixel(atlas, ((Vector2Int)(ref val)).x + 1, ((Vector2Int)(ref val)).y, pWidth, pHeight, width, Toolbox.color_light_10);
			drawLightPixel(atlas, ((Vector2Int)(ref val)).x, ((Vector2Int)(ref val)).y + 1, pWidth, pHeight, width, Toolbox.color_light_10);
		}
		setAtlasDirty(atlas);
		return createFinalSprite(atlas, pSource, pWidth, pHeight);
	}

	private static void drawLightPixel(UnitSpriteConstructorAtlas pAtlas, int pColorCoordsX, int pColorCoordsY, int pWidth, int pHeight, int pBodyTextureWidth, Color32 pColor)
	{
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		int num = pColorCoordsX + pAtlas.last_x;
		int num2 = pColorCoordsY + pAtlas.last_y;
		if (num < 0)
		{
			num = 0;
		}
		if (num2 < 0)
		{
			num2 = 0;
		}
		int num3 = num + num2 * ((Texture)pAtlas.texture).width;
		if (pAtlas.pixels[num3].a < pColor.a)
		{
			pAtlas.pixels[num3] = pColor;
		}
	}

	public static Sprite createNewSpriteForDebug(Sprite pSpriteSource, ColorAsset pKingdomColor)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Expected O, but got Unknown
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		Rect rect = pSpriteSource.rect;
		int num = (int)((Rect)(ref rect)).width;
		int num2 = (int)((Rect)(ref rect)).height;
		Color32[] pixels = pSpriteSource.texture.GetPixels32();
		Texture2D val = new Texture2D(num, num2);
		((Texture)val).filterMode = (FilterMode)0;
		((Texture)val).wrapMode = (TextureWrapMode)1;
		Color32[] pixels2 = val.GetPixels32();
		int width = ((Texture)pSpriteSource.texture).width;
		for (int i = 0; (float)i < ((Rect)(ref rect)).width; i++)
		{
			for (int j = 0; (float)j < ((Rect)(ref rect)).height; j++)
			{
				int num3 = i + (int)((Rect)(ref rect)).x;
				int num4 = j + (int)((Rect)(ref rect)).y;
				int num5 = num3 + num4 * width;
				Color32 val2 = pixels[num5];
				if (val2.a == 0)
				{
					pixels2[num5] = val2;
					continue;
				}
				val2 = DynamicColorPixelTool.checkSpecialColors(val2, pKingdomColor, pCheckForLightColors: true);
				pixels2[num5] = val2;
			}
		}
		val.SetPixels32(pixels2);
		val.Apply();
		Sprite obj = Sprite.Create(val, rect, pSpriteSource.pivot, 1f);
		((Object)obj).name = "gen_" + ((Object)pSpriteSource).name;
		return obj;
	}

	public static Sprite createNewSpriteUnit(AnimationFrameData pFrameData, Sprite pSourceBody, Sprite pSourceHead, ColorAsset pKingdomColor, ActorAsset pAsset, int pPhenotypeIndex, int pPhenotypeShade, UnitTextureAtlasID pAtlasID)
	{
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_0129: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0130: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		UnitSpriteConstructorAtlas unitSpriteConstructorAtlas = null;
		switch (pAtlasID)
		{
		case UnitTextureAtlasID.Units:
			unitSpriteConstructorAtlas = DynamicSpritesLibrary.units.getAtlas();
			break;
		case UnitTextureAtlasID.Boats:
			unitSpriteConstructorAtlas = DynamicSpritesLibrary.boats.getAtlas();
			break;
		}
		PixelBag pixelBag = PixelBagManager.getPixelBag(pSourceBody, pCheckPhenotypes: true);
		int texture_rect_width = pixelBag.texture_rect_width;
		int texture_rect_height = pixelBag.texture_rect_height;
		int num = 0;
		int num2 = 0;
		DynamicColorPixelTool.setPlaceholderSkinColor(_placeholder_color_skin);
		DynamicColorPixelTool.resetSkinColors();
		if (pPhenotypeIndex != 0)
		{
			DynamicColorPixelTool.loadPhenotype(pPhenotypeIndex, pPhenotypeShade);
		}
		if (pSourceHead != null && pFrameData != null)
		{
			Rect rect = pSourceHead.rect;
			Vector2 pos_head_new = pFrameData.pos_head_new;
			int num3 = (int)pos_head_new.y + (int)((Rect)(ref rect)).height - texture_rect_height;
			if (num3 > 0)
			{
				num2 = num3;
			}
			int num4 = (int)pos_head_new.x + (int)((Rect)(ref rect)).width - texture_rect_width;
			if (num4 > 0)
			{
				num = num4;
			}
			else if (pos_head_new.x < 0f)
			{
				num = -(int)pos_head_new.x;
			}
		}
		int num5 = num;
		int num6 = num2;
		texture_rect_width += num5;
		texture_rect_height += num6;
		unitSpriteConstructorAtlas.checkBounds(texture_rect_width, texture_rect_height);
		fillDebugColor(texture_rect_width, texture_rect_height, unitSpriteConstructorAtlas);
		bool dynamic_sprite_zombie = pAsset.dynamic_sprite_zombie;
		int num7 = num5 + unitSpriteConstructorAtlas.last_x;
		int last_y = unitSpriteConstructorAtlas.last_y;
		drawPixelsAll(pixelBag, unitSpriteConstructorAtlas, pKingdomColor, num7, last_y, dynamic_sprite_zombie, pAsset);
		if (pSourceHead != null && pFrameData != null)
		{
			PixelBag pixelBag2 = PixelBagManager.getPixelBag(pSourceHead, pCheckPhenotypes: true);
			Vector2 pos_head_new2 = pFrameData.pos_head_new;
			Vector2 pivot = pSourceHead.pivot;
			int num8 = (int)pos_head_new2.x - (int)pivot.x;
			int num9 = (int)pos_head_new2.y - (int)pivot.y;
			num7 += num8;
			last_y += num9;
			drawPixelsAll(pixelBag2, unitSpriteConstructorAtlas, pKingdomColor, num7, last_y, dynamic_sprite_zombie, pAsset, pHead: true);
		}
		setAtlasDirty(unitSpriteConstructorAtlas);
		return createFinalSprite(unitSpriteConstructorAtlas, pSourceBody, texture_rect_width, texture_rect_height, num5);
	}

	private static void fillDebugColor(int pWidth, int pHeight, UnitSpriteConstructorAtlas pAtlas)
	{
	}

	private static void drawPixelsAll(PixelBag pBag, UnitSpriteConstructorAtlas pAtlas, ColorAsset pKingdomColor, int pPartX, int pPartY, bool pDynamicZombie, ActorAsset pActorAsset, bool pHead = false)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_0174: Unknown result type (might be due to invalid IL or missing references)
		//IL_0190: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c7: Unknown result type (might be due to invalid IL or missing references)
		Color32[] pixels = pAtlas.pixels;
		int width = ((Texture)pAtlas.texture).width;
		drawPixels(pixels, width, pBag.arr_pixels_k1_0, pKingdomColor.k_color_0, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k1_1, pKingdomColor.k_color_1, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k1_2, pKingdomColor.k_color_2, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k1_3, pKingdomColor.k_color_3, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k1_4, pKingdomColor.k_color_4, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k2_0, pKingdomColor.k2_color_0, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k2_1, pKingdomColor.k2_color_1, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k2_2, pKingdomColor.k2_color_2, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k2_3, pKingdomColor.k2_color_3, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_k2_4, pKingdomColor.k2_color_4, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_light, Toolbox.color_light_replace, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_normal, Toolbox.color_magenta_1, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: true, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_phenotype_shade_0, DynamicColorPixelTool.phenotype_shade_0, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_phenotype_shade_1, DynamicColorPixelTool.phenotype_shade_1, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_phenotype_shade_2, DynamicColorPixelTool.phenotype_shade_2, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
		drawPixels(pixels, width, pBag.arr_pixels_phenotype_shade_3, DynamicColorPixelTool.phenotype_shade_3, pPartX, pPartY, pDynamicZombie, pActorAsset, pUseNormal: false, pHead);
	}

	private static void drawPixels(Color32[] pPixels, int pAtlasWidth, Pixel[] pListSourcePixels, Color32 pNewColor, int pPartX, int pPartY, bool pDrawDynamicZombie, ActorAsset pActorAsset, bool pUseNormal = false, bool pHead = false)
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		if (pListSourcePixels == null)
		{
			return;
		}
		for (int i = 0; i < pListSourcePixels.Length; i++)
		{
			Pixel pixel = pListSourcePixels[i];
			Color32 val = pNewColor;
			int num = pixel.x + pPartX;
			int num2 = pixel.y + pPartY;
			if (num < 0)
			{
				num = 0;
			}
			if (num2 < 0)
			{
				num2 = 0;
			}
			int num3 = num + num2 * pAtlasWidth;
			if (pUseNormal)
			{
				val = pixel.color;
			}
			if (pDrawDynamicZombie)
			{
				val = DynamicColorPixelTool.checkZombieColors(pActorAsset, val, num3 / 3 + num, pHead);
			}
			pPixels[num3] = val;
		}
	}

	public static Sprite getSpriteUnit(AnimationFrameData pFrameData, Sprite pMainSprite, Actor pActor, ColorAsset pKingdomColor, int pPhenotypeIndex, int pPhenotypeShade, UnitTextureAtlasID pTextureAtlasID)
	{
		long num = 0L;
		long num2 = 0L;
		long num3 = pPhenotypeIndex;
		long num4 = 0L;
		long num5 = getBodySpriteSmallID(pMainSprite);
		if (pActor.has_rendered_sprite_head)
		{
			ActorAnimationLoader.int_ids_heads.TryGetValue(pActor.cached_sprite_head, out var value);
			if (value == 0)
			{
				int num6 = ActorAnimationLoader.int_ids_heads.Count + 1;
				ActorAnimationLoader.int_ids_heads.Add(pActor.cached_sprite_head, num6);
				value = num6;
			}
			num4 = value;
		}
		if (num3 != 0L)
		{
			num2 = pPhenotypeShade + 1;
		}
		if (pKingdomColor != null)
		{
			num = pKingdomColor.index_id + 1;
		}
		long num7 = num * 1000000000000L + num4 * 1000000000 + num5 * 1000000 + num3 * 1000 + num2;
		if (debug_actor == pActor)
		{
			AssetManager.dynamic_sprites_library.setDebugActor(num7, num, num4, num5, num3, num2);
		}
		DynamicSpritesAsset units = DynamicSpritesLibrary.units;
		Sprite val = units.getSprite(num7);
		if (val == null)
		{
			val = createNewSpriteUnit(pFrameData, pMainSprite, pActor.cached_sprite_head, pKingdomColor, pActor.asset, pPhenotypeIndex, pPhenotypeShade, pTextureAtlasID);
			units.addSprite(num7, val);
		}
		return val;
	}

	public static void setAtlasDirty(UnitSpriteConstructorAtlas pAtlas)
	{
		AssetManager.dynamic_sprites_library.setDirty();
		pAtlas.dirty = true;
		if (!pAtlas.isBigSpriteSheetAtlas())
		{
			pAtlas.checkDirty();
		}
	}

	public static int getBodySpriteSmallID(Sprite pSprite)
	{
		if (!_int_ids_body.TryGetValue(pSprite, out var value))
		{
			value = _int_ids_body.Count + 1;
			_int_ids_body.Add(pSprite, value);
		}
		return value;
	}
}
// --- End of File: DynamicSpriteCreator.cs ---



// --- Start of File: DynamicSprites.cs ---
using UnityEngine;

public static class DynamicSprites
{
	public const int NO_COLOR_ID = -900000;

	public static Sprite getIconWithColors(Sprite pSprite, PhenotypeAsset pPhenotype, ColorAsset pKingdomColor)
	{
		DynamicSpritesAsset icons = DynamicSpritesLibrary.icons;
		long num = ((object)pSprite).GetHashCode() * 10000 + (pPhenotype?.GetHashCode() ?? 0) * 100 + (pKingdomColor?.GetHashCode() ?? 0);
		Sprite val = icons.getSprite(num);
		if (val == null)
		{
			val = DynamicSpriteCreator.createNewIcon(icons, pSprite, pKingdomColor, pPhenotype);
			icons.addSprite(num, val);
		}
		return val;
	}

	public static Sprite getRecoloredBuilding(Sprite pBuildingSprite, ColorAsset pColor, DynamicSpritesAsset pAtlasAsset)
	{
		long buildingSpriteID = getBuildingSpriteID(((object)pBuildingSprite).GetHashCode(), pColor);
		Sprite val = pAtlasAsset.getSprite(buildingSpriteID);
		if (val == null)
		{
			val = DynamicSpriteCreator.createNewSpriteBuilding(pAtlasAsset, buildingSpriteID, pBuildingSprite, pColor);
			pAtlasAsset.addSprite(buildingSpriteID, val);
		}
		return val;
	}

	private static long getBuildingSpriteID(int pBaseSpriteID, ColorAsset pColor)
	{
		long num = ((pColor != null) ? (pColor.index_id + 1) : (-1000000));
		return (num + 1) * 10000000 + pBaseSpriteID;
	}

	public static Sprite getBuildingLight(Building pBuilding)
	{
		DynamicSpritesAsset building_lights = DynamicSpritesLibrary.building_lights;
		int hashCode = ((object)pBuilding.last_main_sprite).GetHashCode();
		return building_lights.getSprite(hashCode);
	}

	public static Sprite getIcon(Sprite pSprite, ColorAsset pColorAsset)
	{
		DynamicSpritesAsset icons = DynamicSpritesLibrary.icons;
		long num = ((object)pSprite).GetHashCode() * 10000 + pColorAsset.GetHashCode();
		Sprite val = icons.getSprite(num);
		if (val == null)
		{
			val = DynamicSpriteCreator.createNewIcon(icons, pSprite, pColorAsset);
			icons.addSprite(num, val);
		}
		return val;
	}

	public static Sprite getShadowBuilding(BuildingAsset pAsset, Sprite pSprite)
	{
		if (!pAsset.shadow)
		{
			return null;
		}
		int hashCode = ((object)pSprite).GetHashCode();
		return DynamicSpritesLibrary.building_shadows.getSprite(hashCode);
	}

	public static Sprite getShadowUnit(Sprite pSprite, int pHashCode)
	{
		DynamicSpritesAsset units_shadows = DynamicSpritesLibrary.units_shadows;
		Sprite val = units_shadows.getSprite(pHashCode);
		if (val == null)
		{
			val = DynamicSpriteCreator.createNewUnitShadow(units_shadows, pSprite);
			units_shadows.addSprite(pHashCode, val);
		}
		return val;
	}

	public static void preloadItemSprite(Sprite pSprite, ColorAsset pColorAsset = null)
	{
		long itemSpriteID = getItemSpriteID(pSprite, pColorAsset);
		DynamicSpritesAsset items = DynamicSpritesLibrary.items;
		Sprite pSprite2 = DynamicSpriteCreator.createNewItemSprite(items, pSprite, pColorAsset);
		items.addSprite(itemSpriteID, pSprite2);
	}

	public static long getItemSpriteID(Sprite pSprite, ColorAsset pColor)
	{
		int pColorID = pColor?.GetHashCode() ?? (-900000);
		return getItemSpriteID(pSprite, pColorID);
	}

	public static long getItemSpriteID(Sprite pSprite, int pColorID = -900000)
	{
		return ((object)pSprite).GetHashCode() * 10000 + pColorID;
	}

	public static Sprite getCachedAtlasItemSprite(long pID, Sprite pSpriteSource)
	{
		Sprite sprite = DynamicSpritesLibrary.items.getSprite(pID);
		if (sprite == null)
		{
			Debug.LogError((object)("[getCachedAtlasItemSprite]Dynamic sprite not found: " + pID + " " + (object)pSpriteSource));
			return pSpriteSource;
		}
		return sprite;
	}

	public static Sprite getCachedAtlasItemSprite(long pID, Sprite pSpriteSource, ColorAsset pColorAsset)
	{
		Sprite sprite = DynamicSpritesLibrary.items.getSprite(pID);
		if (sprite == null)
		{
			Debug.LogError((object)("[getCachedAtlasItemSprite]Dynamic sprite not found: " + pID + " " + ((object)pSpriteSource)?.ToString() + " " + ((pColorAsset != null) ? (pColorAsset.index_id + " " + pColorAsset.color_main) : "null")));
			return pSpriteSource;
		}
		return sprite;
	}
}
// --- End of File: DynamicSprites.cs ---



// --- Start of File: DynamicSpritesAsset.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

[Serializable]
public class DynamicSpritesAsset : Asset
{
	public bool big_atlas = true;

	public bool check_wobbly_setting;

	public UnitTextureAtlasID atlas_id;

	public string export_folder_path;

	public bool buildings;

	private Dictionary<long, Sprite> _dictionary_sprites = new Dictionary<long, Sprite>();

	private UnitSpriteConstructorAtlas _atlas;

	public override void create()
	{
		base.create();
		if (_atlas == null)
		{
			_atlas = new UnitSpriteConstructorAtlas(atlas_id, big_atlas);
		}
	}

	public void resetAtlas()
	{
		clear();
		_atlas.setBigAtlas(big_atlas);
	}

	public bool hasSprite(long pID)
	{
		return _dictionary_sprites.ContainsKey(pID);
	}

	public void addSprite(long pHashCode, Sprite pSprite)
	{
		_dictionary_sprites[pHashCode] = pSprite;
	}

	public Sprite getSprite(long pID)
	{
		_dictionary_sprites.TryGetValue(pID, out var value);
		return value;
	}

	public UnitSpriteConstructorAtlas getAtlas()
	{
		return _atlas;
	}

	public void checkAtlasDirty()
	{
		_atlas.checkDirty();
	}

	public void clear()
	{
		_dictionary_sprites.Clear();
		_atlas.clear();
		checkAtlasDirty();
	}

	public int countSprites()
	{
		return _dictionary_sprites.Count;
	}

	public int countTextures()
	{
		return _atlas.textures.Count;
	}
}
// --- End of File: DynamicSpritesAsset.cs ---



// --- Start of File: DynamicSpritesConfig.cs ---
using UnityEngine.Device;

public static class DynamicSpritesConfig
{
	public const int EDGE_PIXEL = 1;

	public const int TEXTURE_SIZE_512 = 512;

	public const int TEXTURE_SIZE_1024 = 1024;

	public const int TEXTURE_SIZE_2048 = 2048;

	private static int _cached_texture_size;

	public static int texture_size
	{
		get
		{
			if (_cached_texture_size == 0)
			{
				_cached_texture_size = calculateTargetTextureSize();
			}
			return _cached_texture_size;
		}
	}

	private static int calculateTargetTextureSize()
	{
		int num = ((!Config.isMobile) ? 1024 : 512);
		int maxTextureSize = SystemInfo.maxTextureSize;
		if (maxTextureSize < num)
		{
			num = maxTextureSize;
		}
		return num;
	}
}
// --- End of File: DynamicSpritesConfig.cs ---



// --- Start of File: DynamicSpritesLibrary.cs ---
public class DynamicSpritesLibrary : AssetLibrary<DynamicSpritesAsset>
{
	public static DynamicSpritesAsset units;

	public static DynamicSpritesAsset boats;

	public static DynamicSpritesAsset units_shadows;

	public static DynamicSpritesAsset building_lights;

	public static DynamicSpritesAsset building_shadows;

	public static DynamicSpritesAsset icons;

	public static DynamicSpritesAsset items;

	public static DynamicSpritesAsset zombies;

	private bool _dirty;

	public static long _debug_id;

	private static long _debug_kingdom_color_id;

	private static long _debug_head_id;

	private static long _debug_main_body_sprite;

	private static long _debug_phenotype_index;

	private static long _debug_shade_id;

	public override void init()
	{
		base.init();
		units = add(new DynamicSpritesAsset
		{
			id = "units",
			atlas_id = UnitTextureAtlasID.Units
		});
		units_shadows = add(new DynamicSpritesAsset
		{
			id = "units_shadows",
			atlas_id = UnitTextureAtlasID.UnitsShadows
		});
		boats = add(new DynamicSpritesAsset
		{
			id = "boats",
			atlas_id = UnitTextureAtlasID.Boats
		});
		add(new DynamicSpritesAsset
		{
			id = "buildings",
			export_folder_path = "buildings",
			atlas_id = UnitTextureAtlasID.Buildings,
			buildings = true
		});
		add(new DynamicSpritesAsset
		{
			id = "buildings_trees",
			export_folder_path = "buildings_trees",
			check_wobbly_setting = true,
			atlas_id = UnitTextureAtlasID.BuildingsTrees,
			buildings = true
		});
		add(new DynamicSpritesAsset
		{
			id = "buildings_wobbly",
			export_folder_path = "buildings_wobbly",
			check_wobbly_setting = true,
			atlas_id = UnitTextureAtlasID.BuildingsWobbly,
			buildings = true
		});
		add(new DynamicSpritesAsset
		{
			id = "buildings_trees_big",
			export_folder_path = "buildings_trees_big",
			check_wobbly_setting = true,
			atlas_id = UnitTextureAtlasID.BuildingsTreesBig,
			buildings = true
		});
		building_lights = add(new DynamicSpritesAsset
		{
			id = "building_lights",
			atlas_id = UnitTextureAtlasID.BuildingsLights
		});
		building_shadows = add(new DynamicSpritesAsset
		{
			id = "building_shadows",
			atlas_id = UnitTextureAtlasID.BuildingsShadows
		});
		icons = add(new DynamicSpritesAsset
		{
			id = "icons",
			big_atlas = false,
			atlas_id = UnitTextureAtlasID.Icons
		});
		items = add(new DynamicSpritesAsset
		{
			id = "items",
			atlas_id = UnitTextureAtlasID.Items
		});
		zombies = add(new DynamicSpritesAsset
		{
			id = "zombies",
			atlas_id = UnitTextureAtlasID.Zombies
		});
	}

	public override DynamicSpritesAsset add(DynamicSpritesAsset pAsset)
	{
		base.add(pAsset);
		return pAsset;
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (DynamicSpritesAsset item in list)
		{
			item.create();
		}
	}

	public void clear()
	{
		foreach (DynamicSpritesAsset item in list)
		{
			item.clear();
		}
	}

	public void debug(DebugTool pTool, Actor pActor)
	{
		DynamicSpriteCreator.debug_actor = pActor;
		pTool.setText("preloaded_sprites_units:", ActorTextureSubAsset.all_preloaded_sprites_units.Count, 0f, pShowBar: false, 0L);
		pTool.setText("pixel_bags:", PixelBagManager.total, 0f, pShowBar: false, 0L);
		pTool.setText("total_sprite_textures:", SpriteTextureLoader.total_sprites, 0f, pShowBar: false, 0L);
		pTool.setText("total_sprites_lists:", SpriteTextureLoader.total_sprites_list, 0f, pShowBar: false, 0L);
		pTool.setText("total_sprites_lists_single_sprites:", SpriteTextureLoader.total_sprites_list_single_sprites, 0f, pShowBar: false, 0L);
		pTool.setText("total_texture_sub_assets:", ActorTextureSubAsset.getTotal(), 0f, pShowBar: false, 0L);
		pTool.setText("hand_renderer_textures:", HandRendererTexturePreloader.getTotal(), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("[ActorAnimationLoader] units:", ActorAnimationLoader.count_units, 0f, pShowBar: false, 0L);
		pTool.setText("[ActorAnimationLoader] heads:", ActorAnimationLoader.count_heads, 0f, pShowBar: false, 0L);
		pTool.setText("[ActorAnimationLoader] boats:", ActorAnimationLoader.count_boats, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		foreach (DynamicSpritesAsset item in AssetManager.dynamic_sprites_library.list)
		{
			pTool.setText("sprites " + item.id + ":", item.countSprites(), 0f, pShowBar: false, 0L);
			pTool.setText("textures " + item.id + ":", item.countTextures(), 0f, pShowBar: false, 0L);
		}
		pTool.setText("units:", units.getAtlas().debug(), 0f, pShowBar: false, 0L);
		pTool.setText("boats:", boats.getAtlas().debug(), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("_debug_id:", _debug_id, 0f, pShowBar: false, 0L);
		pTool.setText("_debug_head_id:", _debug_head_id, 0f, pShowBar: false, 0L);
		pTool.setText("_debug_main_body_sprite:", _debug_main_body_sprite, 0f, pShowBar: false, 0L);
		pTool.setText("_debug_phenotype_index:", _debug_phenotype_index, 0f, pShowBar: false, 0L);
		pTool.setText("_debug_kingdom_color_id:", _debug_kingdom_color_id, 0f, pShowBar: false, 0L);
	}

	public void setDirty()
	{
		_dirty = true;
	}

	public void checkDirty()
	{
		if (!_dirty)
		{
			return;
		}
		_dirty = false;
		foreach (DynamicSpritesAsset item in AssetManager.dynamic_sprites_library.list)
		{
			item.checkAtlasDirty();
		}
	}

	public void setDebugActor(long pID, long pKingdomColorID, long pHeadID, long pMainBodySpriteID, long pPhenotypeIndex, long pShadeID)
	{
		_debug_id = pID;
		_debug_kingdom_color_id = pKingdomColorID;
		_debug_head_id = pHeadID;
		_debug_main_body_sprite = pMainBodySpriteID;
		_debug_phenotype_index = pPhenotypeIndex;
		_debug_shade_id = pShadeID;
	}

	public void export()
	{
	}
}
// --- End of File: DynamicSpritesLibrary.cs ---



// --- Start of File: Earthquake.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using UnityEngine;

public class Earthquake : BaseMapObject
{
	private PrintTemplate _current_print;

	private int _print_tick;

	private WorldTile _print_tile_origin;

	private float _timer;

	private const float INTERVAL = 0.05f;

	private bool _quake_active;

	private EarthquakeType _type;

	private int _current_print_index;

	private static Earthquake _instance;

	public void Awake()
	{
		_instance = this;
	}

	public static void startQuake(WorldTile pTile, EarthquakeType pType = EarthquakeType.RandomPower)
	{
		_instance.spawnQuake(pTile, pType);
	}

	private void spawnQuake(WorldTile pTile, EarthquakeType pType)
	{
		if (isQuakeActive())
		{
			return;
		}
		MusicBox.playSound("event:/SFX/NATURE/EarthQuake", pTile);
		_type = pType;
		_quake_active = true;
		List<PrintTemplate> quakes = PrintLibrary.getQuakes();
		_current_print_index++;
		if (_current_print_index >= quakes.Count)
		{
			quakes.Shuffle();
			_current_print_index = 0;
		}
		_current_print = quakes[_current_print_index];
		_current_print.steps.Shuffle();
		_print_tile_origin = pTile;
		_print_tick = 0;
		if (pType == EarthquakeType.RandomPower)
		{
			if (Randy.randomChance(0.5f))
			{
				_type = EarthquakeType.BigDecrease;
			}
			else
			{
				_type = EarthquakeType.BigIncrease;
			}
		}
	}

	private void Update()
	{
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		if (!isQuakeActive())
		{
			return;
		}
		if (_timer > 0f)
		{
			_timer -= World.world.elapsed;
			return;
		}
		_timer = 0.05f;
		for (int i = 0; i < 300; i++)
		{
			if (_print_tick >= _current_print.steps.Length)
			{
				endQuake();
				break;
			}
			PrintStep printStep = _current_print.steps[_print_tick];
			_print_tick++;
			MapBox world = World.world;
			Vector2Int pos = _print_tile_origin.pos;
			int pX = ((Vector2Int)(ref pos)).x + printStep.x;
			pos = _print_tile_origin.pos;
			WorldTile tile = world.GetTile(pX, ((Vector2Int)(ref pos)).y + printStep.y);
			if (tile != null)
			{
				tileAction(tile);
				if (_print_tick >= _current_print.steps.Length)
				{
					endQuake();
					break;
				}
			}
		}
		World.world.startShake(0.3f, 0.01f, 0.23f, pShakeX: true);
	}

	private void tileAction(WorldTile pTile)
	{
		if (MapAction.checkTileDamageGaiaCovenant(pTile, pDamage: true))
		{
			switch (_type)
			{
			case EarthquakeType.BigDecrease:
				MapAction.decreaseTile(pTile, pDamage: true, "earthquake");
				break;
			case EarthquakeType.BigIncrease:
				MapAction.increaseTile(pTile, pDamage: true, "earthquake");
				break;
			case EarthquakeType.SmallDisaster:
				MapAction.terraformMain(pTile, pTile.main_type, AssetManager.terraform.get("earthquake_disaster"));
				break;
			}
		}
		pTile.removeBurn();
		pTile.doUnits((Action<Actor>)unitAction);
	}

	private void unitAction(Actor pActor)
	{
		if (Randy.randomBool())
		{
			pActor.makeConfused();
		}
		else
		{
			pActor.applyRandomForce();
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool isQuakeActive()
	{
		return _instance._quake_active;
	}

	private void endQuake()
	{
		_quake_active = false;
	}
}
// --- End of File: Earthquake.cs ---



// --- Start of File: EarthquakeType.cs ---
public enum EarthquakeType
{
	RandomPower,
	BigIncrease,
	BigDecrease,
	SmallDisaster
}
// --- End of File: EarthquakeType.cs ---



// --- Start of File: EasterEggBanner.cs ---
using UnityEngine;
using UnityEngine.UI;

public class EasterEggBanner : MonoBehaviour
{
	[SerializeField]
	private GameObject _container_with_elements;

	private float _cur_random_accumulation;

	private const float BASE_CHANCE = 0.1f;

	private const float ACCUMULATION_STEP = 0.01f;

	private bool? _dragging_item;

	public Image main_image;

	private void OnEnable()
	{
		nextChance();
	}

	private void nextChance()
	{
		bool flag = Randy.randomChance(0.1f + _cur_random_accumulation);
		if (!flag)
		{
			_cur_random_accumulation += 0.01f;
		}
		else
		{
			_cur_random_accumulation = 0f;
		}
		_container_with_elements.SetActive(flag);
	}

	private void clearChance()
	{
		_cur_random_accumulation = 0f;
		_container_with_elements.SetActive(false);
	}

	private void Update()
	{
		if (!_container_with_elements.activeSelf)
		{
			return;
		}
		bool flag = Config.isDraggingItem();
		if (flag != _dragging_item)
		{
			_dragging_item = flag;
			if (!flag)
			{
				clearChance();
			}
		}
	}
}
// --- End of File: EasterEggBanner.cs ---



// --- Start of File: EditorHelper.cs ---
using System;

public static class EditorHelper
{
	public static bool HasArgument(string pName)
	{
		string[] commandLineArgs = Environment.GetCommandLineArgs();
		for (int i = 0; i < commandLineArgs.Length; i++)
		{
			if (commandLineArgs[i].Contains(pName))
			{
				return true;
			}
		}
		return false;
	}

	public static string GetArgument(string pName)
	{
		string[] commandLineArgs = Environment.GetCommandLineArgs();
		for (int i = 0; i < commandLineArgs.Length; i++)
		{
			if (commandLineArgs[i].Contains(pName))
			{
				return commandLineArgs[i + 1];
			}
		}
		return null;
	}
}
// --- End of File: EditorHelper.cs ---



// --- Start of File: EffectAction.cs ---
public delegate BaseEffect EffectAction(BaseEffect pEffect, WorldTile pTile = null, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null);
// --- End of File: EffectAction.cs ---



// --- Start of File: EffectActionVector.cs ---
using UnityEngine;

public delegate BaseEffect EffectActionVector(BaseEffect pEffect, Vector3 pVecPosition);
// --- End of File: EffectActionVector.cs ---



// --- Start of File: EffectAsset.cs ---
using System;
using System.ComponentModel;
using Newtonsoft.Json;

[Serializable]
public class EffectAsset : Asset
{
	public string prefab_id;

	public bool use_basic_prefab;

	public bool load_texture;

	public string sprite_path;

	public string sorting_layer_id;

	[DefaultValue(0.1f)]
	public float time_between_frames = 0.1f;

	public int limit;

	public bool limit_unload;

	public string sound_launch;

	public string sound_loop_idle;

	public bool show_on_mini_map;

	public EffectAction spawn_action;

	public double cooldown_interval;

	private double _cooldown;

	public bool draw_light_area;

	public float draw_light_area_offset_x;

	public float draw_light_area_offset_y;

	[DefaultValue(0.5f)]
	public float draw_light_size = 0.5f;

	[JsonIgnore]
	public bool has_sound_launch => sound_launch != null;

	[JsonIgnore]
	public bool has_sound_loop_idle => sound_loop_idle != null;

	public bool checkIsUnderCooldown()
	{
		double curSessionTime = World.world.getCurSessionTime();
		if (curSessionTime - _cooldown < cooldown_interval)
		{
			return true;
		}
		_cooldown = curSessionTime;
		return false;
	}
}
// --- End of File: EffectAsset.cs ---



// --- Start of File: EffectDataRain.cs ---
using System.Runtime.InteropServices;

[StructLayout(LayoutKind.Sequential, Size = 1)]
public struct EffectDataRain
{
}
// --- End of File: EffectDataRain.cs ---



// --- Start of File: EffectDivineLight.cs ---
using UnityEngine;

public class EffectDivineLight : BaseAnimatedObject
{
	public SpriteAnimation raySpawn;

	public SpriteAnimation rayIdle;

	public SpriteAnimation baseSpawn;

	public SpriteAnimation baseIdle;

	public bool isOn;

	private DivineLightState state;

	public override void Awake()
	{
		base.Awake();
		setState(DivineLightState.SpawnFirstStage);
	}

	private void setState(DivineLightState pState)
	{
		state = pState;
		switch (state)
		{
		case DivineLightState.SpawnFirstStage:
			((Component)raySpawn).gameObject.SetActive(true);
			((Component)rayIdle).gameObject.SetActive(false);
			((Component)baseSpawn).gameObject.SetActive(false);
			((Component)baseIdle).gameObject.SetActive(false);
			break;
		case DivineLightState.SpawnSecondStage:
			((Component)raySpawn).gameObject.SetActive(false);
			((Component)rayIdle).gameObject.SetActive(true);
			((Component)baseSpawn).gameObject.SetActive(true);
			((Component)baseIdle).gameObject.SetActive(false);
			break;
		case DivineLightState.Idle:
			((Component)raySpawn).gameObject.SetActive(false);
			((Component)rayIdle).gameObject.SetActive(true);
			((Component)baseSpawn).gameObject.SetActive(false);
			((Component)baseIdle).gameObject.SetActive(true);
			break;
		case DivineLightState.Hide:
			((Component)raySpawn).gameObject.SetActive(true);
			((Component)rayIdle).gameObject.SetActive(false);
			((Component)baseSpawn).gameObject.SetActive(true);
			((Component)baseIdle).gameObject.SetActive(false);
			break;
		}
	}

	private void stopEffet()
	{
	}

	private void useEffect()
	{
	}

	private void Update()
	{
		if (isOn)
		{
			raySpawn.playType = AnimPlayType.Forward;
			baseSpawn.playType = AnimPlayType.Forward;
			if (raySpawn.isLastFrame())
			{
				((Component)raySpawn).gameObject.SetActive(false);
				((Component)rayIdle).gameObject.SetActive(true);
			}
			else
			{
				((Component)raySpawn).gameObject.SetActive(true);
				((Component)rayIdle).gameObject.SetActive(false);
			}
			if (baseSpawn.isLastFrame())
			{
				((Component)baseSpawn).gameObject.SetActive(false);
				((Component)baseIdle).gameObject.SetActive(true);
			}
			else
			{
				((Component)baseSpawn).gameObject.SetActive(true);
				((Component)baseIdle).gameObject.SetActive(false);
			}
		}
		else
		{
			raySpawn.playType = AnimPlayType.Backward;
			baseSpawn.playType = AnimPlayType.Backward;
			((Component)rayIdle).gameObject.SetActive(false);
			((Component)baseIdle).gameObject.SetActive(false);
			if (raySpawn.isFirstFrame())
			{
				((Component)raySpawn).gameObject.SetActive(false);
			}
			else
			{
				((Component)raySpawn).gameObject.SetActive(true);
			}
			if (baseSpawn.isFirstFrame())
			{
				((Component)baseSpawn).gameObject.SetActive(false);
			}
			else
			{
				((Component)baseSpawn).gameObject.SetActive(true);
			}
		}
		if (((Component)baseSpawn).gameObject.activeSelf)
		{
			baseSpawn.update(World.world.delta_time);
		}
		if (((Component)baseIdle).gameObject.activeSelf)
		{
			baseIdle.update(World.world.delta_time);
		}
		if (((Component)raySpawn).gameObject.activeSelf)
		{
			raySpawn.update(World.world.delta_time);
		}
		if (((Component)rayIdle).gameObject.activeSelf)
		{
			rayIdle.update(World.world.delta_time);
		}
		isOn = false;
	}

	public void playOn(WorldTile pTile)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		((Component)this).gameObject.transform.localPosition = pTile.posV3;
		isOn = true;
	}
}
// --- End of File: EffectDivineLight.cs ---



// --- Start of File: EffectDragParticlesManager.cs ---
using System.Collections.Generic;
using UnityEngine;

public class EffectDragParticlesManager : MonoBehaviour
{
	public static EffectDragParticlesManager instance;

	private ObjectPoolGenericMono<EffectParticlesCursor> _pool;

	[SerializeField]
	private EffectParticlesCursor _prefab;

	[SerializeField]
	private List<SpriteSet> _sprite_sets;

	[SerializeField]
	public float _spawn_interval = 10f;

	private void Awake()
	{
		_pool = new ObjectPoolGenericMono<EffectParticlesCursor>(_prefab, ((Component)this).transform);
		instance = this;
	}

	private void Update()
	{
		updateSpawn();
		updateAnimation();
	}

	private void updateAnimation()
	{
		if (_pool.countActive() == 0)
		{
			return;
		}
		foreach (EffectParticlesCursor item in _pool.getListTotal())
		{
			if (((Behaviour)item).isActiveAndEnabled)
			{
				item.update();
			}
		}
	}

	private void updateSpawn()
	{
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		if (Config.isDraggingItem() && Config.dragging_item_object != null && Config.dragging_item_object.spawn_particles_on_drag && (float)Time.frameCount % _spawn_interval == 0f)
		{
			spawnNew(Config.dragging_item_object.transform.position);
		}
	}

	public void spawnNew(Vector3 pPos)
	{
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		EffectParticlesCursor next = _pool.getNext();
		next.setFrames(_sprite_sets.GetRandom().sprites);
		next.launch();
		next.getAnimation().setActionFinish(finishingEffectAction);
		Vector2 val = Vector2.op_Implicit(pPos);
		val.x += Randy.randomFloat(-1f, 1f);
		val.y += Randy.randomFloat(-1f, 1f);
		((Component)next).transform.position = Vector2.op_Implicit(val);
	}

	private void finishingEffectAction(MonoBehaviour pEffectObject)
	{
		_pool.release(((Component)pEffectObject).GetComponent<EffectParticlesCursor>());
	}
}
// --- End of File: EffectDragParticlesManager.cs ---



// --- Start of File: EffectFlyingY.cs ---
using UnityEngine;

public class EffectFlyingY : BaseEffect
{
	public override void update(float pElapsed)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		base.update(pElapsed);
		Vector3 position = ((Component)this).transform.position;
		float x = position.x;
		float num = position.y + pElapsed * 1f / Config.time_scale_asset.multiplier;
		((Component)this).transform.position = new Vector3(x, num);
	}
}
// --- End of File: EffectFlyingY.cs ---



// --- Start of File: EffectHearts.cs ---
using UnityEngine;

public class EffectHearts : BaseEffect
{
	internal override void spawnOnTile(WorldTile pTile)
	{
		float pScale = Randy.randomFloat(0.3f, 0.5f);
		prepare(pTile, pScale);
	}

	public override void update(float pElapsed)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		base.update(pElapsed);
		float x = ((Component)this).transform.position.x;
		float num = ((Component)this).transform.position.y + pElapsed * 3f / Config.time_scale_asset.multiplier;
		((Component)this).transform.position = new Vector3(x, num);
	}
}
// --- End of File: EffectHearts.cs ---



// --- Start of File: EffectInfinityCoin.cs ---
using System.Collections.Generic;
using UnityEngine;

public class EffectInfinityCoin : BaseEffect
{
	private static List<Actor> _temp_list = new List<Actor>();

	private bool used;

	internal override void create()
	{
		base.create();
	}

	internal override void spawnOnTile(WorldTile pTile)
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		prepare(Vector2.op_Implicit(new Vector3(pTile.posV3.x, pTile.posV3.y - 1f)), 0.25f);
	}

	internal override void prepare(Vector2 pVector, float pScale = 1f)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		base.prepare(pVector, pScale);
		Vector3 localPosition = ((Component)this).transform.localPosition;
		localPosition.z = -2f;
		current_position = Vector2.op_Implicit(localPosition);
		((Component)this).transform.localPosition = localPosition;
		used = false;
		World.world.startShake(0.1f, 0.02f, 3f);
	}

	private void Update()
	{
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		if (sprite_animation.currentFrameIndex >= 32 && !used)
		{
			World.world.startShake(0.2f, 0.01f, 3f);
			used = true;
			Vector3 localPosition = ((Component)this).transform.localPosition;
			localPosition.y += 2f;
			BaseEffect baseEffect = EffectsLibrary.spawnAt("fx_boulder_impact", localPosition, ((Component)this).transform.localScale.x);
			if ((Object)(object)baseEffect != (Object)null)
			{
				localPosition = ((Component)baseEffect).transform.localPosition;
				localPosition.z = -1f;
				((Component)baseEffect).transform.localPosition = localPosition;
			}
			EffectsLibrary.spawnExplosionWave(localPosition, 5f);
			doAction();
		}
	}

	private void doAction()
	{
		int num = 0;
		int num2 = 0;
		List<Actor> simpleList = World.world.units.getSimpleList();
		for (int i = 0; i < simpleList.Count; i++)
		{
			Actor actor = simpleList[i];
			if (actor.isAlive() && !actor.isFavorite() && !actor.asset.ignored_by_infinity_coin)
			{
				num++;
			}
		}
		num2 = ((num % 2 != 0) ? (num / 2 + 1) : (num / 2));
		int num3 = 0;
		_temp_list.AddRange(World.world.units);
		for (int j = 0; j < _temp_list.Count; j++)
		{
			_temp_list.ShuffleOne(j);
			Actor actor2 = _temp_list[j];
			if (num2 == 0)
			{
				break;
			}
			if (actor2.isAlive() && !actor2.isFavorite() && !actor2.asset.ignored_by_infinity_coin && !actor2.is_invincible)
			{
				num3++;
				num2--;
				actor2.getHitFullHealth(AttackType.Divine);
			}
		}
		WorldTip.addWordReplacement("$removed$", num3.ToString());
		WorldTip.showNow("infinity_coin_used", pTranslate: true, "top");
		_temp_list.Clear();
	}
}
// --- End of File: EffectInfinityCoin.cs ---



// --- Start of File: EffectParticlesCursor.cs ---
using UnityEngine;

public class EffectParticlesCursor : MonoBehaviour
{
	private SpriteAnimationSimple _sprite_animation;

	private float _speed = 50f;

	private void Awake()
	{
		_sprite_animation = ((Component)this).GetComponent<SpriteAnimationSimple>();
	}

	public void launch()
	{
		_sprite_animation.resetAnim();
		_speed = 50f + Randy.randomFloat(-10f, 10f);
	}

	public void update()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		_sprite_animation.update(Time.deltaTime);
		Transform transform = ((Component)this).transform;
		transform.position += new Vector3(0f, _speed * Time.deltaTime, 0f);
	}

	public SpriteAnimationSimple getAnimation()
	{
		return _sprite_animation;
	}

	public void setFrames(Sprite[] pFrames)
	{
		_sprite_animation.setFrames(pFrames);
	}
}
// --- End of File: EffectParticlesCursor.cs ---



// --- Start of File: EffectParticlesCursorDelegate.cs ---
using UnityEngine;

public delegate void EffectParticlesCursorDelegate(MonoBehaviour pEffectObject);
// --- End of File: EffectParticlesCursorDelegate.cs ---



// --- Start of File: EffectsCamera.cs ---
using UnityEngine;

public class EffectsCamera : MonoBehaviour
{
	private Camera _mainCamera;

	private Camera _effectsCamera;

	internal RenderTexture renderTexture;

	private void Awake()
	{
		_effectsCamera = ((Component)this).GetComponent<Camera>();
	}

	private void Start()
	{
		_mainCamera = World.world.camera;
	}

	private void LateUpdate()
	{
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Expected O, but got Unknown
		_effectsCamera.orthographicSize = _mainCamera.orthographicSize;
		int num = Screen.width / 3;
		int num2 = Screen.height / 3;
		if ((Object)(object)renderTexture == (Object)null || ((Texture)renderTexture).width != num || ((Texture)renderTexture).height != num2)
		{
			renderTexture = new RenderTexture(num, num2, 0);
			((Texture)renderTexture).filterMode = (FilterMode)0;
			((Texture)renderTexture).wrapMode = (TextureWrapMode)1;
			_effectsCamera.targetTexture = renderTexture;
		}
	}
}
// --- End of File: EffectsCamera.cs ---



// --- Start of File: EffectsLibrary.cs ---
using UnityEngine;

public class EffectsLibrary : AssetLibrary<EffectAsset>
{
	public override void init()
	{
		base.init();
		add(new EffectAsset
		{
			id = "fx_spores",
			prefab_id = "effects/prefabs/PrefabSpores",
			show_on_mini_map = true,
			limit = 200
		});
		add(new EffectAsset
		{
			id = "fx_fireball_explosion",
			sprite_path = "effects/fx_fireball_explosion",
			sorting_layer_id = "EffectsTop",
			use_basic_prefab = true,
			draw_light_area = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
		});
		add(new EffectAsset
		{
			id = "fx_firebomb_explosion",
			sprite_path = "effects/fx_firebomb_explosion",
			sorting_layer_id = "EffectsTop",
			use_basic_prefab = true,
			draw_light_area = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
		});
		add(new EffectAsset
		{
			id = "fx_plasma_ball_explosion",
			sprite_path = "effects/fx_plasma_ball_explosion",
			sorting_layer_id = "EffectsTop",
			use_basic_prefab = true,
			draw_light_area = true
		});
		add(new EffectAsset
		{
			id = "fx_cast_ground_blue",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_cast_ground_blue_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_cast_top_blue",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_cast_top_blue_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_cast_ground_red",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_cast_ground_red_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_cast_top_red",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_cast_top_red_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_cast_ground_green",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_cast_ground_green_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_cast_ground_purple",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_cast_ground_purple_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_cast_top_green",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_cast_top_green_t",
			draw_light_area = true,
			draw_light_size = 0.2f,
			limit = 60
		});
		add(new EffectAsset
		{
			id = "fx_create_skeleton",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_create_skeleton_t",
			draw_light_area = true,
			show_on_mini_map = true,
			limit = 0
		});
		add(new EffectAsset
		{
			id = "fx_teleport_blue",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_teleport_blue_t",
			draw_light_area = true,
			limit = 100
		});
		add(new EffectAsset
		{
			id = "fx_teleport_red",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_teleport_red_t",
			draw_light_area = true,
			limit = 100
		});
		add(new EffectAsset
		{
			id = "fx_shield_hit",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_shield_hit_t",
			draw_light_area = true,
			limit = 200
		});
		add(new EffectAsset
		{
			id = "fx_dodge",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/combat_actions/fx_action_dodge_t",
			limit = 100
		});
		add(new EffectAsset
		{
			id = "fx_block",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/combat_actions/fx_action_block_t",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_drowning",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_status_drowning_t",
			limit = 50
		});
		add(new EffectAsset
		{
			id = "fx_water_splash",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_status_drowning_t",
			limit_unload = true,
			limit = 50
		});
		add(new EffectAsset
		{
			id = "fx_grin_reaper",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_grin_reaper_animation",
			show_on_mini_map = false,
			time_between_frames = 0.001f,
			limit = 20
		});
		add(new EffectAsset
		{
			id = "fx_monolith_launch",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_monolith_launch",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_monolith_launch_bottom",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_monolith_launch_bottom",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_monolith_glow_1",
			use_basic_prefab = true,
			sorting_layer_id = "Objects",
			sprite_path = "effects/fx_monolith_glow_1",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_monolith_glow_2",
			use_basic_prefab = true,
			sorting_layer_id = "Objects",
			sprite_path = "effects/fx_monolith_glow_2",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_waypoint_alien_mold_launch_bottom",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_waypoint_alien_mold_launch_bottom",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_waypoint_computer_launch_bottom",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_waypoint_computer_launch_bottom",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_waypoint_golden_egg_launch_bottom",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_waypoint_golden_egg_launch_bottom",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_waypoint_harp_launch_bottom",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_waypoint_harp_launch_bottom",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_bad_place",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_bad_place_t",
			draw_light_area = true,
			limit = 10,
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_debug_tile",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_debug_tile",
			draw_light_area = true,
			time_between_frames = 3f,
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_move",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsBack",
			sprite_path = "effects/fx_move_t",
			draw_light_area = true,
			limit = 30,
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_plasma_trail",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_plasma_trail_t",
			draw_light_area = true,
			show_on_mini_map = true,
			limit = 15
		});
		add(new EffectAsset
		{
			id = "fx_building_sparkle",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_building_sparkle_t",
			limit = 15
		});
		add(new EffectAsset
		{
			id = "fx_fire_smoke",
			prefab_id = "Prefabs/PrefabFireSmoke",
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_boulder_charge",
			prefab_id = "Prefabs/PrefabBoulderCharge",
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_spark",
			prefab_id = "Prefabs/PrefabSpark",
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_lightning_big",
			prefab_id = "effects/prefabs/PrefabLightning",
			show_on_mini_map = true,
			limit = 100,
			draw_light_area = true,
			draw_light_size = 2f,
			draw_light_area_offset_y = 5f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike"
		});
		add(new EffectAsset
		{
			id = "fx_lightning_medium",
			prefab_id = "effects/prefabs/PrefabLightningMedium",
			show_on_mini_map = true,
			limit = 100,
			draw_light_area = true,
			draw_light_size = 2f,
			draw_light_area_offset_y = 5f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike"
		});
		add(new EffectAsset
		{
			id = "fx_lightning_small",
			prefab_id = "effects/prefabs/PrefabLightningSmall",
			show_on_mini_map = true,
			limit = 100,
			draw_light_area = true,
			draw_light_size = 2f,
			draw_light_area_offset_y = 5f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike"
		});
		add(new EffectAsset
		{
			id = "fx_spawn",
			prefab_id = "effects/prefabs/PrefabSpawnSmall",
			show_on_mini_map = false,
			draw_light_area = true,
			spawn_action = showSpawnEffect,
			limit = 100
		});
		add(new EffectAsset
		{
			id = "fx_teleport_singularity",
			use_basic_prefab = true,
			sorting_layer_id = "EffectsTop",
			sprite_path = "effects/fx_teleport_singularity",
			draw_light_area = true,
			limit = 0
		});
		add(new EffectAsset
		{
			id = "fx_spawn_big",
			prefab_id = "effects/prefabs/PrefabSpawnBig",
			show_on_mini_map = true,
			spawn_action = spawnSimpleTile,
			draw_light_area = true,
			draw_light_size = 2f,
			sound_launch = "event:/SFX/UNIQUE/Crabzilla/CrabzillaSpawn"
		});
		add(new EffectAsset
		{
			id = "fx_land_explosion_old",
			prefab_id = "effects/prefabs/PrefabFireballExplosion",
			show_on_mini_map = true,
			draw_light_area = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_crab_bomb",
			prefab_id = "effects/prefabs/PrefabFireballExplosion",
			show_on_mini_map = true,
			draw_light_area = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionCrabBomb"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_tiny",
			prefab_id = "effects/prefabs/PrefabExplosionSmall",
			show_on_mini_map = true,
			draw_light_area = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionTiny"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_small",
			prefab_id = "effects/prefabs/PrefabExplosionSmall",
			show_on_mini_map = true,
			draw_light_area = true,
			draw_light_size = 1f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_ufo",
			prefab_id = "effects/prefabs/PrefabExplosionSmall",
			show_on_mini_map = true,
			draw_light_area = true,
			draw_light_size = 1f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionUFO"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_meteorite",
			prefab_id = "effects/prefabs/PrefabExplosionSmall",
			show_on_mini_map = true,
			draw_light_area = true,
			draw_light_size = 2f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionMeteorite"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_middle",
			prefab_id = "effects/prefabs/PrefabExplosionSmall",
			show_on_mini_map = true,
			draw_light_area = true,
			draw_light_size = 2f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_nuke_atomic",
			show_on_mini_map = true,
			prefab_id = "effects/prefabs/PrefabExplosionBig",
			draw_light_area = true,
			draw_light_size = 5f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionBig"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_huge",
			show_on_mini_map = true,
			prefab_id = "effects/prefabs/PrefabExplosionBig",
			draw_light_area = true,
			draw_light_size = 5f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionHuge"
		});
		add(new EffectAsset
		{
			id = "fx_explosion_wave",
			prefab_id = "effects/prefabs/PrefabExplosionWave",
			show_on_mini_map = true
		});
		add(new EffectAsset
		{
			id = "fx_fireworks",
			prefab_id = "effects/prefabs/PrefabFireworks",
			show_on_mini_map = true,
			spawn_action = spawnFireworks,
			cooldown_interval = 0.20000000298023224,
			draw_light_area = true,
			draw_light_size = 4f,
			draw_light_area_offset_y = 40f,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionFireworks"
		});
		add(new EffectAsset
		{
			id = "fx_hearts",
			prefab_id = "effects/prefabs/PrefabHearts",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_new_border",
			prefab_id = "effects/prefabs/PrefabNewBorder",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_money_got_loot",
			prefab_id = "effects/prefabs/PrefabMoneyGotLoot",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_money_got_money",
			prefab_id = "effects/prefabs/PrefabMoneyGotMoney",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_money_paid_tax",
			prefab_id = "effects/prefabs/PrefabMoneyPaidTax",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_money_paid_tribute",
			prefab_id = "effects/prefabs/PrefabMoneyPaidTribute",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_money_spend_money",
			prefab_id = "effects/prefabs/PrefabMoneySpendMoney",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_conversion_religion",
			load_texture = true,
			prefab_id = "effects/prefabs/PrefabMetaEvent",
			sprite_path = "effects/fx_conversion_religion",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_conversion_culture",
			load_texture = true,
			prefab_id = "effects/prefabs/PrefabMetaEvent",
			sprite_path = "effects/fx_conversion_culture",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_conversion_language",
			load_texture = true,
			prefab_id = "effects/prefabs/PrefabMetaEvent",
			sprite_path = "effects/fx_conversion_language",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_experience_gain",
			load_texture = true,
			prefab_id = "effects/prefabs/PrefabMetaEvent",
			sprite_path = "effects/fx_experience_gain",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_change_happiness_positive",
			load_texture = true,
			prefab_id = "effects/prefabs/PrefabMetaEvent",
			sprite_path = "effects/fx_change_happiness_positive",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_change_happiness_negative",
			load_texture = true,
			prefab_id = "effects/prefabs/PrefabMetaEvent",
			sprite_path = "effects/fx_change_happiness_negative",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_hmm",
			prefab_id = "effects/prefabs/PrefabHmm",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_plot_progress",
			prefab_id = "effects/prefabs/PrefabPlotProgress",
			sorting_layer_id = "EffectsTop",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_nuke_flash",
			prefab_id = "effects/prefabs/PrefabNukeFlash",
			show_on_mini_map = true,
			draw_light_area = true,
			draw_light_size = 3f,
			spawn_action = spawnNukeFlash
		});
		add(new EffectAsset
		{
			id = "fx_napalm_flash",
			show_on_mini_map = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionMiddle",
			prefab_id = "effects/prefabs/PrefabNapalmFlash",
			draw_light_area = true,
			draw_light_size = 2f,
			spawn_action = spawnNapalmFlash
		});
		add(new EffectAsset
		{
			id = "fx_thunder_flash",
			prefab_id = "effects/prefabs/PrefabThunderFlash",
			limit = 3,
			show_on_mini_map = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike",
			spawn_action = spawnThunderFlash
		});
		add(new EffectAsset
		{
			id = "fx_boulder_impact",
			prefab_id = "effects/prefabs/PrefabBoulderImpact",
			show_on_mini_map = true,
			sound_launch = "event:/SFX/DESTRUCTION/DropSimpleImpact"
		});
		add(new EffectAsset
		{
			id = "fx_boulder_impact_water",
			prefab_id = "effects/prefabs/PrefabBoulderImpactWater",
			show_on_mini_map = true,
			sound_launch = "event:/SFX/DESTRUCTION/DropSimpleImpact"
		});
		add(new EffectAsset
		{
			id = "fx_antimatter_effect",
			prefab_id = "effects/prefabs/PrefabAntimatterEffect",
			show_on_mini_map = true,
			sound_launch = "event:/SFX/EXPLOSIONS/ExplosionAntimatterBomb",
			spawn_action = spawnSimpleTile
		});
		add(new EffectAsset
		{
			id = "fx_infinity_coin",
			show_on_mini_map = true,
			prefab_id = "effects/prefabs/PrefabInfinityCoin",
			spawn_action = spawnSimpleTile,
			draw_light_area = true,
			draw_light_size = 1f,
			sound_launch = "event:/SFX/DESTRUCTION/InfinityCoin"
		});
		add(new EffectAsset
		{
			id = "fx_status_particle",
			prefab_id = "effects/prefabs/PrefabStatusParticle",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_weapon_particle",
			prefab_id = "effects/prefabs/PrefabStatusParticle",
			limit = 50
		});
		add(new EffectAsset
		{
			id = "fx_slash",
			prefab_id = "effects/prefabs/PrefabSlash",
			limit = 40
		});
		add(new EffectAsset
		{
			id = "fx_hit",
			prefab_id = "effects/prefabs/PrefabHit",
			limit = 20
		});
		add(new EffectAsset
		{
			id = "fx_miss",
			prefab_id = "effects/prefabs/PrefabMiss",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_jump",
			sorting_layer_id = "EffectsBack",
			load_texture = true,
			sprite_path = "effects/jump",
			use_basic_prefab = true,
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_walk",
			sorting_layer_id = "EffectsBack",
			load_texture = true,
			sprite_path = "effects/walk",
			limit = 15,
			use_basic_prefab = true,
			cooldown_interval = 0.15000000596046448
		});
		add(new EffectAsset
		{
			id = "fx_hit_critical",
			prefab_id = "effects/prefabs/PrefabHitCritical",
			limit = 10
		});
		add(new EffectAsset
		{
			id = "fx_boat_explosion",
			prefab_id = "effects/prefabs/PrefabBoatExplosion",
			draw_light_area = true,
			limit = 20
		});
		add(new EffectAsset
		{
			id = "fx_fishnet",
			prefab_id = "effects/prefabs/PrefabFishnet",
			limit = 20,
			sound_launch = "event:/SFX/CIVILIZATIONS/SpawnFishnet"
		});
		add(new EffectAsset
		{
			id = "fx_tile_effect",
			prefab_id = "effects/prefabs/PrefabTileEffect",
			limit = 20,
			show_on_mini_map = false,
			spawn_action = spawnSimpleTile
		});
		add(new EffectAsset
		{
			id = "fx_cloud",
			prefab_id = "effects/prefabs/PrefabCloud",
			show_on_mini_map = true,
			limit = 200,
			limit_unload = true,
			spawn_action = spawnCloud
		});
		add(new EffectAsset
		{
			id = "fx_meteorite",
			prefab_id = "effects/prefabs/PrefabMeteorite",
			show_on_mini_map = true,
			spawn_action = spawnMeteorite,
			sound_launch = "event:/SFX/DESTRUCTION/FallMeteorite"
		});
		add(new EffectAsset
		{
			id = "fx_boulder",
			prefab_id = "effects/prefabs/PrefabBoulder",
			show_on_mini_map = true,
			spawn_action = spawnBoulder
		});
		add(new EffectAsset
		{
			id = "fx_santa",
			prefab_id = "effects/prefabs/PrefabSanta",
			show_on_mini_map = true,
			spawn_action = spawnSanta,
			sound_loop_idle = "event:/SFX/OTHER/RoboSanta/RoboSantaIdleLoop",
			limit = 100
		});
		add(new EffectAsset
		{
			id = "fx_zone_highlight",
			prefab_id = "effects/prefabs/PrefabZoneFlash",
			show_on_mini_map = true,
			spawn_action = spawnZoneFlash
		});
		add(new EffectAsset
		{
			id = "fx_tornado",
			prefab_id = "effects/prefabs/PrefabTornado",
			show_on_mini_map = true,
			sound_loop_idle = "event:/SFX/NATURE/TornadoIdleLoop"
		});
	}

	public override void editorDiagnostic()
	{
		base.editorDiagnostic();
		foreach (EffectAsset item in list)
		{
			if (item.use_basic_prefab || item.load_texture)
			{
				if (item.sorting_layer_id == null)
				{
					BaseAssetLibrary.logAssetError("EffectsLibrary: sorting_layer_id is missing", item.id);
				}
				if (item.sprite_path == null)
				{
					BaseAssetLibrary.logAssetError("EffectsLibrary: sprite_path is missing", item.id);
				}
			}
			if (!item.use_basic_prefab && item.prefab_id == null)
			{
				BaseAssetLibrary.logAssetError("EffectsLibrary: prefab_id is missing", item.id);
			}
		}
	}

	private static BaseEffect check(string pID)
	{
		EffectAsset effectAsset = AssetManager.effects_library.get(pID);
		if (effectAsset == null)
		{
			return null;
		}
		if (effectAsset.cooldown_interval > 0.0 && effectAsset.checkIsUnderCooldown())
		{
			return null;
		}
		if (!effectAsset.show_on_mini_map && MapBox.isRenderMiniMap())
		{
			return null;
		}
		return World.world.stack_effects.get(pID).spawnNew();
	}

	public static BaseEffect spawnAtTileRandomScale(string pID, WorldTile pTile, float pScaleMin, float pScaleMax)
	{
		float pScale = Randy.randomFloat(pScaleMin, pScaleMax);
		return spawnAtTile(pID, pTile, pScale);
	}

	public static void spawnDebugTile(WorldTile pTile, Color pColor)
	{
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		if (pTile != null)
		{
			BaseEffect baseEffect = spawnAtTile("fx_debug_tile", pTile, 0.75f);
			if (!((Object)(object)baseEffect == (Object)null))
			{
				pColor.a = 0.7f;
				baseEffect.sprite_renderer.color = pColor;
			}
		}
	}

	public static BaseEffect spawnAtTile(string pID, WorldTile pTile, float pScale)
	{
		BaseEffect baseEffect = spawn(pID, pTile);
		if ((Object)(object)baseEffect == (Object)null)
		{
			return null;
		}
		baseEffect.prepare(pTile, pScale);
		return baseEffect;
	}

	public static BaseEffect spawnAt(string pID, Vector2 pPos, float pScale)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = spawn(pID, null, null, null, 0f, pPos.x, pPos.y);
		if ((Object)(object)baseEffect == (Object)null)
		{
			return null;
		}
		baseEffect.prepare(pPos, pScale);
		return baseEffect;
	}

	public static BaseEffect spawnAt(string pID, Vector3 pPos, float pScale)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = spawn(pID, null, null, null, 0f, pPos.x, pPos.y);
		if ((Object)(object)baseEffect == (Object)null)
		{
			return null;
		}
		baseEffect.prepare(Vector2.op_Implicit(pPos), pScale);
		return baseEffect;
	}

	public static BaseEffect spawn(string pID, WorldTile pTile = null, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, float pX = -1f, float pY = -1f, Actor pActor = null)
	{
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = check(pID);
		if ((Object)(object)baseEffect == (Object)null)
		{
			return null;
		}
		EffectAsset effectAsset = AssetManager.effects_library.get(pID);
		if (effectAsset.spawn_action != null)
		{
			effectAsset.spawn_action(baseEffect, pTile, pParam1, pParam2, pFloatParam1, pActor);
		}
		if (effectAsset.has_sound_launch)
		{
			float num = pX;
			float num2 = pY;
			if (pTile != null && num == -1f && num2 == -1f)
			{
				num = pTile.x;
				num2 = pTile.y;
			}
			MusicBox.playSound(effectAsset.sound_launch, num, num2);
		}
		if (pX != -1f && pY != -1f)
		{
			((Component)baseEffect).transform.position = new Vector3(pX, pY, 0f);
		}
		if (effectAsset.has_sound_loop_idle)
		{
			baseEffect.fmod_instance = MusicBox.attachToObject(effectAsset.sound_loop_idle, ((Component)baseEffect).gameObject, Object.op_Implicit((Object)(object)baseEffect));
		}
		return baseEffect;
	}

	public static void spawnExplosionWave(Vector3 pVec, float pRadius, float pSpeed = 1f)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = spawn("fx_explosion_wave");
		if (!((Object)(object)baseEffect == (Object)null))
		{
			((ExplosionFlash)baseEffect).start(pVec, pRadius, pSpeed);
		}
	}

	public static bool canShowSlashEffect()
	{
		return !World.world.stack_effects.controller_slash_effects.isLimitReached();
	}

	public static void spawnSlash(Vector2 pVec, string pPathSprites, float pAngle, float pScaleMod = 0.1f)
	{
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = spawn("fx_slash");
		if (!((Object)(object)baseEffect == (Object)null))
		{
			baseEffect.prepare(pVec, pScaleMod);
			SpriteAnimation component = ((Component)baseEffect).GetComponent<SpriteAnimation>();
			Sprite[] spriteList = SpriteTextureLoader.getSpriteList(pPathSprites);
			component.setFrames(spriteList);
			((Component)baseEffect).transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, pAngle));
		}
	}

	public BaseEffect spawnMeteorite(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((Meteorite)pEffect).spawnOn(pTile, pParam1, pActor);
		return pEffect;
	}

	public BaseEffect spawnSanta(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((Santa)pEffect).spawnOn(pTile);
		return pEffect;
	}

	public BaseEffect spawnBoulder(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		Boulder obj = (Boulder)pEffect;
		Vector2 mousePos = World.world.getMousePos();
		obj.spawnOn(mousePos);
		return pEffect;
	}

	public BaseEffect spawnNapalmFlash(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((NapalmFlash)pEffect).spawnFlash(pTile);
		return pEffect;
	}

	public BaseEffect spawnNukeFlash(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((NukeFlash)pEffect).spawnFlash(pTile, pParam1);
		return pEffect;
	}

	public BaseEffect spawnThunderFlash(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((ThunderFlash)pEffect).spawnFlash();
		return pEffect;
	}

	public BaseEffect spawnSimpleTile(BaseEffect pEffect, WorldTile pTile, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		pEffect.spawnOnTile(pTile);
		return pEffect;
	}

	public BaseEffect spawnZoneFlash(BaseEffect pEffect, WorldTile pTile, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((ZoneFlash)pEffect).spawnOnTile(pTile);
		return pEffect;
	}

	public BaseEffect spawnCloud(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((Cloud)pEffect).spawn(pTile, pParam1);
		return pEffect;
	}

	public BaseEffect spawnFireworks(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		((Fireworks)pEffect).spawnOnTile(pTile);
		return pEffect;
	}

	public BaseEffect showSpawnEffect(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
	{
		pEffect.prepare(pTile, 0.2f);
		return pEffect;
	}

	public BaseEffect spawnStatusParticle(BaseEffect pEffect, Vector3 pPos)
	{
		return pEffect;
	}

	public static void highlightKingdomZones(Kingdom pKingdom, Color pColor, float pAlpha = 0.3f)
	{
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		foreach (City city in pKingdom.getCities())
		{
			foreach (TileZone zone in city.zones)
			{
				((ZoneFlash)spawn("fx_zone_highlight", zone.centerTile, null, null, pAlpha)).start(pColor, pAlpha);
			}
		}
	}

	public static void showMoneyEffect(string pID, Vector2 pPosition, TileZone pZone, float pScale)
	{
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		if (pZone.visible_main_centered && PlayerConfig.optionBoolEnabled("money_flow"))
		{
			float x = pPosition.x + Randy.randomFloat(-0.3f, 0.3f);
			pPosition.x = x;
			spawnAt(pID, pPosition, pScale);
		}
	}

	public static void showMetaEventEffectConversion(string pID, Actor pActor)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		if (PlayerConfig.optionBoolEnabled("meta_conversions"))
		{
			showMetaEventEffect(pID, pActor.current_position, pActor.current_zone, pActor.actor_scale);
		}
	}

	public static void showMetaEventEffect(string pID, Actor pActor)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		showMetaEventEffect(pID, pActor.current_position, pActor.current_zone, pActor.actor_scale);
	}

	public static void showMetaEventEffect(string pID, Vector2 pPosition, TileZone pZone, float pScale)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		if (pZone.visible_main_centered)
		{
			float x = pPosition.x + Randy.randomFloat(-0.3f, 0.3f);
			pPosition.x = x;
			spawnAt(pID, pPosition, pScale);
		}
	}
}
// --- End of File: EffectsLibrary.cs ---



// --- Start of File: EmptyLogElement.cs ---
using UnityEngine;

public class EmptyLogElement : MonoBehaviour
{
	private WorldLogElement _log_element;

	public RectTransform rect_transform;

	private WorldLogElement _element;

	private WorldLogMessage _message;

	public void load(WorldLogMessage pMessage)
	{
		_message = pMessage;
	}

	public void setElement(WorldLogElement pElement)
	{
		_element = pElement;
		if (!((Object)(object)_element == (Object)null))
		{
			_element.showMessage(_message);
			((Component)pElement).transform.SetParent(((Component)this).transform);
		}
	}

	public WorldLogElement getElement()
	{
		return _element;
	}
}
// --- End of File: EmptyLogElement.cs ---



// --- Start of File: Encryption.cs ---
using System;
using System.IO;
using System.Security.Cryptography;
using System.Text;

public class Encryption
{
	private const string INIT_VECTOR = "sayHiIfUReadThis";

	private const int KEY_SIZE = 256;

	public static string EncryptString(string pPlainText, string pPassPhrase)
	{
		byte[] bytes = Encoding.UTF8.GetBytes("sayHiIfUReadThis");
		byte[] bytes2 = Encoding.UTF8.GetBytes(pPlainText);
		using PasswordDeriveBytes passwordDeriveBytes = new PasswordDeriveBytes(pPassPhrase, null);
		byte[] bytes3 = passwordDeriveBytes.GetBytes(32);
		using RijndaelManaged rijndaelManaged = new RijndaelManaged
		{
			Mode = CipherMode.CBC
		};
		using ICryptoTransform transform = rijndaelManaged.CreateEncryptor(bytes3, bytes);
		using MemoryStream memoryStream = new MemoryStream();
		using CryptoStream cryptoStream = new CryptoStream(memoryStream, transform, CryptoStreamMode.Write);
		cryptoStream.Write(bytes2, 0, bytes2.Length);
		cryptoStream.FlushFinalBlock();
		return Convert.ToBase64String(memoryStream.ToArray());
	}

	public static string DecryptString(string pCipherText, string pPassPhrase)
	{
		byte[] bytes = Encoding.UTF8.GetBytes("sayHiIfUReadThis");
		byte[] array = Convert.FromBase64String(pCipherText);
		using PasswordDeriveBytes passwordDeriveBytes = new PasswordDeriveBytes(pPassPhrase, null);
		byte[] bytes2 = passwordDeriveBytes.GetBytes(32);
		using RijndaelManaged rijndaelManaged = new RijndaelManaged
		{
			Mode = CipherMode.CBC
		};
		using ICryptoTransform transform = rijndaelManaged.CreateDecryptor(bytes2, bytes);
		using MemoryStream stream = new MemoryStream(array);
		using CryptoStream cryptoStream = new CryptoStream(stream, transform, CryptoStreamMode.Read);
		byte[] array2 = new byte[array.Length];
		int count = cryptoStream.Read(array2, 0, array2.Length);
		return Encoding.UTF8.GetString(array2, 0, count);
	}
}
// --- End of File: Encryption.cs ---



// --- Start of File: EnemiesFinder.cs ---
using System.Collections.Generic;
using UnityEngine.Pool;

public static class EnemiesFinder
{
	private static Dictionary<Kingdom, EnemyFinderContainer> _cache_data = new Dictionary<Kingdom, EnemyFinderContainer>();

	public static int counter_reused = 0;

	private static EnemyFinderContainer getCacheContainer(Kingdom pKingdom)
	{
		if (!_cache_data.TryGetValue(pKingdom, out var value))
		{
			value = UnsafeGenericPool<EnemyFinderContainer>.Get();
			value.setKingdom(pKingdom);
			_cache_data.Add(pKingdom, value);
		}
		return value;
	}

	internal static EnemyFinderData findEnemiesFrom(WorldTile pTile, Kingdom pKingdom, int pChunkRange = -1)
	{
		if (pChunkRange == -1)
		{
			pChunkRange = SimGlobals.m.unit_chunk_sight_range;
		}
		EnemyFinderContainer cacheContainer = getCacheContainer(pKingdom);
		MapChunk chunk = pTile.chunk;
		return cacheContainer.getData(chunk, pChunkRange);
	}

	public static void clear()
	{
		counter_reused = 0;
		foreach (EnemyFinderContainer value in _cache_data.Values)
		{
			value.clear();
			UnsafeGenericPool<EnemyFinderContainer>.Release(value);
		}
		_cache_data.Clear();
	}

	public static void disposeAll()
	{
		foreach (EnemyFinderContainer value in _cache_data.Values)
		{
			value.disposeAll();
		}
		clear();
	}
}
// --- End of File: EnemiesFinder.cs ---



// --- Start of File: EnemyFinderContainer.cs ---
using System;
using System.Collections.Generic;
using UnityEngine.Pool;

public class EnemyFinderContainer
{
	public Dictionary<int, EnemyFinderData> dict_data = new Dictionary<int, EnemyFinderData>((int)Math.Pow(9.0, SimGlobals.m.unit_chunk_sight_range));

	private Kingdom _kingdom;

	public void setKingdom(Kingdom pKingdom)
	{
		_kingdom = pKingdom;
	}

	public EnemyFinderData getData(MapChunk pChunk, int pRange)
	{
		int key = pChunk.id * 10000 + pRange;
		if (!dict_data.TryGetValue(key, out var value))
		{
			value = UnsafeGenericPool<EnemyFinderData>.Get();
			dict_data.Add(key, value);
			if (!_kingdom.asset.force_look_all_chunks)
			{
				if (pRange == 0)
				{
					findEnemiesOfKingdomInChunk(value, pChunk, _kingdom);
					return value;
				}
				if (Randy.randomChance(0.8f))
				{
					findEnemiesOfKingdomInChunk(value, pChunk, _kingdom);
				}
			}
			if (value.isEmpty())
			{
				for (int i = 0; i <= pRange; i++)
				{
					checkRange(value, pChunk, i, i);
					if (!value.isEmpty() && !_kingdom.asset.force_look_all_chunks)
					{
						break;
					}
				}
			}
			return value;
		}
		EnemiesFinder.counter_reused++;
		return value;
	}

	private void checkRange(EnemyFinderData pData, MapChunk pChunk, int pRange, int pSkipLessThan = -1)
	{
		if (pRange == 0)
		{
			findEnemiesOfKingdomInChunk(pData, pChunk, _kingdom);
			return;
		}
		int x = pChunk.x;
		int y = pChunk.y;
		bool flag = pSkipLessThan > 0;
		int num = pSkipLessThan * -1;
		for (int i = -pRange; i <= pRange; i++)
		{
			for (int j = -pRange; j <= pRange; j++)
			{
				if (!flag || i <= num || i >= pSkipLessThan || j <= num || j >= pSkipLessThan)
				{
					int pX = x + i;
					int pY = y + j;
					MapChunk mapChunk = World.world.map_chunk_manager.get(pX, pY);
					if (mapChunk != null)
					{
						findEnemiesOfKingdomInChunk(pData, mapChunk, _kingdom);
					}
				}
			}
		}
	}

	private static void findEnemiesOfKingdomInChunk(EnemyFinderData pData, MapChunk pChunk, Kingdom pMainKingdom)
	{
		if (pChunk.objects.kingdoms.Count == 0)
		{
			return;
		}
		List<long> kingdoms = pChunk.objects.kingdoms;
		bool flag = WorldLawLibrary.world_law_peaceful_monsters.isEnabled();
		if (pMainKingdom.asset.mobs && flag)
		{
			return;
		}
		for (int i = 0; i < kingdoms.Count; i++)
		{
			long num = kingdoms[i];
			Kingdom civOrWildViaID = World.world.kingdoms.getCivOrWildViaID(num);
			if (civOrWildViaID != null && (!flag || !civOrWildViaID.asset.mobs) && pMainKingdom.isEnemy(civOrWildViaID))
			{
				pData.addEnemyList(pChunk.objects.getUnits(num));
				pData.addEnemyList(pChunk.objects.getBuildings(num));
			}
		}
	}

	public void clear()
	{
		foreach (EnemyFinderData value in dict_data.Values)
		{
			value.reset();
			UnsafeGenericPool<EnemyFinderData>.Release(value);
		}
		dict_data.Clear();
	}

	public void disposeAll()
	{
		foreach (EnemyFinderData value in dict_data.Values)
		{
			value.reset();
		}
		_kingdom = null;
	}
}
// --- End of File: EnemyFinderContainer.cs ---



// --- Start of File: EnemyFinderData.cs ---
using System.Collections.Generic;

public class EnemyFinderData
{
	public readonly List<BaseSimObject> list = new List<BaseSimObject>();

	public bool isEmpty()
	{
		return list.Count == 0;
	}

	public void addEnemyList(List<Actor> pList)
	{
		list.AddRange(pList);
	}

	public void addEnemyList(List<Building> pList)
	{
		list.AddRange(pList);
	}

	public void reset()
	{
		list.Clear();
	}
}
// --- End of File: EnemyFinderData.cs ---



// --- Start of File: EnumerableExtensions.cs ---
using System.Collections.Generic;

public static class EnumerableExtensions
{
	public static T GetRandom<T>(this IEnumerable<T> pEnumerable)
	{
		if (!(pEnumerable is List<T> list))
		{
			if (!(pEnumerable is ListPool<T> list2))
			{
				if (!(pEnumerable is T[] pArray))
				{
					if (pEnumerable is HashSet<T> pHashSet)
					{
						return pHashSet.GetRandom();
					}
					using ListPool<T> list3 = new ListPool<T>(pEnumerable);
					return list3.GetRandom();
				}
				return pArray.GetRandom();
			}
			return list2.GetRandom();
		}
		return list.GetRandom();
	}
}
// --- End of File: EnumerableExtensions.cs ---



// --- Start of File: EnumExtensions.cs ---
using System;

public static class EnumExtensions
{
	public static int Count<TEnum>(this TEnum pEnum) where TEnum : Enum
	{
		int num = 0;
		int num2 = Convert.ToInt32(pEnum);
		while (num2 != 0)
		{
			num2 &= num2 - 1;
			num++;
		}
		return num;
	}
}
// --- End of File: EnumExtensions.cs ---



// --- Start of File: EnvironmentAction.cs ---
using System;

[Serializable]
public delegate bool EnvironmentAction(BuildingAsset pAsset);
// --- End of File: EnvironmentAction.cs ---



// --- Start of File: Epoch.cs ---
using System;
using UnityEngine;

public static class Epoch
{
	private static DateTime epochStart = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);

	public static double Current()
	{
		return (DateTime.UtcNow - epochStart).TotalSeconds;
	}

	public static double SecondsElapsed(double t1)
	{
		return Mathf.Abs((float)(Current() - t1));
	}

	public static int SecondsElapsed(int t1, int t2)
	{
		return Mathf.Abs(t1 - t2);
	}

	internal static DateTime toDateTime(double epoch)
	{
		return new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc).AddSeconds(epoch);
	}
}
// --- End of File: Epoch.cs ---



// --- Start of File: EquipmentAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class EquipmentAsset : ItemAsset, IHandRenderer
{
	public bool is_colored => colored;

	public bool is_animated => animated;

	public Sprite[] getSprites()
	{
		return gameplay_sprites;
	}
}
// --- End of File: EquipmentAsset.cs ---



// --- Start of File: EquipmentBanner.cs ---
using UnityEngine;

public class EquipmentBanner : BannerGeneric<Item, ItemData>
{
	[SerializeField]
	private IconOutline _outline;

	[SerializeField]
	private Sprite _frame_sprite_legendary;

	[SerializeField]
	private Sprite _frame_sprite_epic;

	protected override MetaType meta_type => MetaType.Item;

	protected override string tooltip_id => "equipment";

	protected override TooltipData getTooltipData()
	{
		TooltipData tooltipData = base.getTooltipData();
		tooltipData.item = meta_object;
		return tooltipData;
	}

	protected override void setupBanner()
	{
		base.setupBanner();
		Item item = meta_object;
		Rarity quality = item.getQuality();
		part_icon.sprite = item.getSprite();
		bool active = true;
		switch (quality)
		{
		case Rarity.R3_Legendary:
			part_frame.sprite = _frame_sprite_legendary;
			break;
		case Rarity.R2_Epic:
			part_frame.sprite = _frame_sprite_epic;
			break;
		default:
			active = false;
			break;
		}
		((Component)part_frame).gameObject.SetActive(active);
		if (quality == Rarity.R3_Legendary)
		{
			showOutline();
		}
		else
		{
			((Component)_outline).gameObject.SetActive(false);
		}
	}

	private void showOutline()
	{
		_outline.show(RarityLibrary.legendary.color_container);
	}
}
// --- End of File: EquipmentBanner.cs ---



// --- Start of File: EquipmentButton.cs ---
using System;
using UnityEngine;
using UnityEngine.UI;

public class EquipmentButton : AugmentationButton<EquipmentAsset>, IBanner, IBaseMono, IRefreshElement
{
	[SerializeField]
	private Image _favorited_icon;

	private Item _item;

	private bool _object_button;

	public MetaCustomizationAsset meta_asset => AssetManager.meta_customization_library.getAsset(MetaType.Item);

	public MetaTypeAsset meta_type_asset => AssetManager.meta_type_library.getAsset(MetaType.Item);

	protected override string tooltip_type => "equipment";

	protected override void Update()
	{
		if (!is_editor_button)
		{
			if (augmentation_asset.unlocked_with_achievement)
			{
				((Component)locked_bg).gameObject.SetActive(false);
				return;
			}
			bool active = !augmentation_asset.isAvailable() && _object_button;
			((Component)locked_bg).gameObject.SetActive(active);
		}
	}

	protected override void onStartDrag(DraggableLayoutElement pOriginalElement)
	{
		EquipmentEditorButton component = ((Component)pOriginalElement).GetComponent<EquipmentEditorButton>();
		if ((Object)(object)component != (Object)null)
		{
			load(component.augmentation_button.augmentation_asset);
			is_editor_button = component.augmentation_button.is_editor_button;
			return;
		}
		EquipmentButton component2 = ((Component)pOriginalElement).GetComponent<EquipmentButton>();
		if (component2._object_button)
		{
			load(component2._item);
			is_editor_button = component2.is_editor_button;
		}
		else
		{
			load(component2.augmentation_asset);
			is_editor_button = component2.is_editor_button;
		}
	}

	public void load(NanoObject pObject)
	{
		load((Item)pObject);
	}

	internal void load(Item pItem)
	{
		_object_button = true;
		create();
		_item = pItem;
		augmentation_asset = _item.getAsset();
		if (augmentation_asset != null)
		{
			image.sprite = _item.getSprite();
			loadLegendaryOutline();
			((Object)((Component)this).gameObject).name = getElementType() + "_" + _item.data.asset_id;
			bool active = _item.isFavorite();
			((Component)_favorited_icon).gameObject.SetActive(active);
		}
	}

	public override void load(EquipmentAsset pItem)
	{
		_object_button = false;
		create();
		augmentation_asset = pItem;
		if (augmentation_asset != null)
		{
			image.sprite = augmentation_asset.getSprite();
			((Object)((Component)this).gameObject).name = getElementType() + "_" + augmentation_asset.id;
			((Component)_favorited_icon).gameObject.SetActive(false);
		}
	}

	protected override void initTooltip()
	{
		base.initTooltip();
		TipButton tipButton = default(TipButton);
		if (!((Component)this).TryGetComponent<TipButton>(ref tipButton))
		{
			return;
		}
		TipButton tipButton2 = tipButton;
		tipButton2.clickAction = (TooltipAction)Delegate.Combine(tipButton2.clickAction, (TooltipAction)delegate
		{
			if (InputHelpers.mouseSupported)
			{
				openItemWindow();
			}
			else if (Tooltip.isShowingFor(this) && !is_editor_button)
			{
				openItemWindow();
			}
			else
			{
				showTooltip();
			}
		});
	}

	private void openItemWindow()
	{
		SelectedMetas.selected_item = _item;
		if (SelectedMetas.selected_item != null)
		{
			ScrollWindow.showWindow("item");
		}
	}

	protected override void fillTooltipData(EquipmentAsset pElement)
	{
		string pType = ((is_editor_button || !_object_button) ? "equipment_in_editor" : "equipment");
		Tooltip.show(this, pType, tooltipDataBuilder());
	}

	protected override bool unlockElement()
	{
		return augmentation_asset.unlock();
	}

	protected override TooltipData tooltipDataBuilder()
	{
		if (!is_editor_button && _object_button)
		{
			return new TooltipData
			{
				item = _item
			};
		}
		return new TooltipData
		{
			item_asset = augmentation_asset
		};
	}

	protected override string getElementType()
	{
		return "equip";
	}

	protected override void startSignal()
	{
		AchievementLibrary.equipment_explorer.checkBySignal();
	}

	public override string getElementId()
	{
		return getElementAsset().id;
	}

	private bool hasDivineRune()
	{
		if (_item == null)
		{
			return false;
		}
		if (!_item.isAlive())
		{
			return false;
		}
		return _item.hasMod("divine_rune");
	}

	protected override Rarity getRarity()
	{
		return _item.getQuality();
	}

	public string getName()
	{
		return _item.getName();
	}

	public NanoObject GetNanoObject()
	{
		return _item;
	}

	Transform IBaseMono.get_transform()
	{
		return ((Component)this).transform;
	}

	GameObject IBaseMono.get_gameObject()
	{
		return ((Component)this).gameObject;
	}

	T IBaseMono.GetComponent<T>()
	{
		return ((Component)this).GetComponent<T>();
	}
}
// --- End of File: EquipmentButton.cs ---



// --- Start of File: EquipmentEditor.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;

public class EquipmentEditor : AugmentationsEditor<EquipmentAsset, EquipmentButton, EquipmentEditorButton, ItemGroupAsset, EquipmentGroupElement, IEquipmentWindow, IEquipmentEditor>, IEquipmentEditor, IAugmentationsEditor
{
	[SerializeField]
	protected Sprite sprite_art;

	[SerializeField]
	protected Sprite sprite_art_void;

	protected override List<ItemGroupAsset> augmentation_groups_list => AssetManager.item_groups.list;

	protected override EquipmentAsset edited_marker_augmentation => null;

	protected override List<EquipmentAsset> all_augmentations_list => AssetManager.items.list;

	protected override void onEnableRain()
	{
		rain_editor_state = PlayerConfig.instance.data.equipment_editor_state;
		augmentations_list_link = PlayerConfig.instance.data.equipment_editor;
		validateRainData();
		augmentations_hashset.Clear();
		augmentations_hashset.UnionWith(augmentations_list_link);
		loadEditorSelectedAugmentations();
		rain_state_toggle_action = delegate
		{
			toggleRainState(ref PlayerConfig.instance.data.equipment_editor_state);
		};
		rain_state_switcher.toggleState(rain_editor_state == RainState.Remove);
	}

	protected override void OnEnable()
	{
		if (!rain_editor)
		{
			Actor currentActor = getCurrentActor();
			if (!currentActor.canEditEquipment())
			{
				return;
			}
			foreach (EquipmentEditorButton all_augmentation_button in all_augmentation_buttons)
			{
				EquipmentAsset elementAsset = all_augmentation_button.augmentation_button.getElementAsset();
				bool active = true;
				if (!currentActor.asset.canEditItem(elementAsset))
				{
					active = false;
				}
				((Component)all_augmentation_button).gameObject.SetActive(active);
			}
		}
		base.OnEnable();
	}

	protected override void metaAugmentationClick(EquipmentEditorButton pButton)
	{
		if (!isAugmentationAvailable(pButton.augmentation_button))
		{
			return;
		}
		EquipmentButton augmentation_button = pButton.augmentation_button;
		EquipmentAsset elementAsset = pButton.augmentation_button.getElementAsset();
		if (canChangeSlot(elementAsset))
		{
			bool num = hasAugmentation(augmentation_button);
			if (!isSlotEmpty(augmentation_button))
			{
				removeAugmentation(augmentation_button);
			}
			if (!num)
			{
				addAugmentation(augmentation_button);
			}
		}
		augmentation_window.checkEquipmentTabIcon();
		base.metaAugmentationClick(pButton);
	}

	protected override void rainAugmentationClick(EquipmentEditorButton pButton)
	{
		if (isAugmentationAvailable(pButton.augmentation_button))
		{
			string id = pButton.augmentation_button.getElementAsset().id;
			if (!augmentations_hashset.Contains(id))
			{
				augmentations_hashset.Add(id);
			}
			else
			{
				augmentations_hashset.Remove(id);
			}
			base.rainAugmentationClick(pButton);
		}
	}

	protected override void showActiveButtons()
	{
		augmentation_window.reloadEquipment();
	}

	protected override ListPool<EquipmentAsset> getOrderedAugmentationsList()
	{
		return new ListPool<EquipmentAsset>(all_augmentations_list);
	}

	protected override void createButton(EquipmentAsset pElement, EquipmentGroupElement pGroup)
	{
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Expected O, but got Unknown
		if (pElement.show_in_meta_editor)
		{
			bool active = true;
			if (!rain_editor && !getCurrentActor().asset.canEditItem(pElement))
			{
				active = false;
			}
			EquipmentEditorButton tEditorButton = Object.Instantiate<EquipmentEditorButton>(prefab_editor_augmentation, pGroup.augmentation_buttons_transform);
			tEditorButton.augmentation_button.is_editor_button = true;
			tEditorButton.augmentation_button.load(pElement);
			all_augmentation_buttons.Add(tEditorButton);
			pGroup.augmentation_buttons.Add(tEditorButton);
			((UnityEventBase)tEditorButton.augmentation_button.button.onClick).RemoveAllListeners();
			((UnityEvent)tEditorButton.augmentation_button.button.onClick).AddListener((UnityAction)delegate
			{
				editorButtonClick(tEditorButton);
			});
			((Component)tEditorButton).gameObject.SetActive(active);
		}
	}

	protected override void startSignal()
	{
		AchievementLibrary.equipment_explorer.checkBySignal();
	}

	private bool canChangeSlot(EquipmentAsset pAsset)
	{
		if (!pAsset.can_be_given)
		{
			return false;
		}
		return getSlotFromCurrentActor(pAsset.equipment_type).canChangeSlot();
	}

	private bool isSlotEmpty(EquipmentButton pButton)
	{
		EquipmentAsset elementAsset = pButton.getElementAsset();
		return getSlotFromCurrentActor(elementAsset.equipment_type).isEmpty();
	}

	protected override bool hasAugmentation(EquipmentButton pButton)
	{
		EquipmentAsset elementAsset = pButton.getElementAsset();
		ActorEquipmentSlot slotFromCurrentActor = getSlotFromCurrentActor(elementAsset.equipment_type);
		if (slotFromCurrentActor.isEmpty())
		{
			return false;
		}
		Item item = slotFromCurrentActor.getItem();
		string id = pButton.getElementAsset().id;
		if (item.getAsset().id == id)
		{
			return true;
		}
		return false;
	}

	protected override bool addAugmentation(EquipmentButton pButton)
	{
		Actor currentActor = getCurrentActor();
		EquipmentAsset elementAsset = pButton.getElementAsset();
		Item item = World.world.items.generateItem(elementAsset, currentActor.kingdom, World.world.map_stats.player_name, 1, currentActor, 0, pByPlayer: true);
		item.addMod("divine_rune");
		currentActor.equipment.setItem(item, currentActor);
		return true;
	}

	protected override bool removeAugmentation(EquipmentButton pButton)
	{
		Actor currentActor = getCurrentActor();
		EquipmentType equipment_type = pButton.getElementAsset().equipment_type;
		currentActor.equipment.getSlot(equipment_type).takeAwayItem();
		currentActor.setStatsDirty();
		return true;
	}

	private ActorEquipmentSlot getSlotFromCurrentActor(EquipmentType pType)
	{
		return getCurrentActor().equipment.getSlot(pType);
	}

	private Actor getCurrentActor()
	{
		return SelectedUnit.unit;
	}

	protected override void loadEditorSelectedButton(EquipmentButton pButton, string pAugmentationId)
	{
		base.loadEditorSelectedButton(pButton, pAugmentationId);
		EquipmentAsset pElement = AssetManager.items.get(pAugmentationId);
		pButton.load(pElement);
	}

	protected override bool isAugmentationExists(string pId)
	{
		return AssetManager.items.has(pId);
	}

	protected override void toggleRainState(ref RainState pState)
	{
		base.toggleRainState(ref pState);
		art.sprite = ((pState == RainState.Add) ? sprite_art : sprite_art_void);
		if (pState == RainState.Add)
		{
			augmentations_hashset.Clear();
			augmentations_hashset.UnionWith(augmentations_list_link);
			reloadButtons();
		}
	}
}
// --- End of File: EquipmentEditor.cs ---



// --- Start of File: EquipmentEditorButton.cs ---
public class EquipmentEditorButton : AugmentationEditorButton<EquipmentButton, EquipmentAsset>
{
}
// --- End of File: EquipmentEditorButton.cs ---



// --- Start of File: EquipmentGrid.cs ---
using UnityEngine;

public class EquipmentGrid : MonoBehaviour
{
}
// --- End of File: EquipmentGrid.cs ---



// --- Start of File: EquipmentGroupElement.cs ---
public class EquipmentGroupElement : AugmentationCategory<EquipmentAsset, EquipmentButton, EquipmentEditorButton>
{
	protected override bool isUnlocked(EquipmentButton pButton)
	{
		if (pButton.getElementAsset().isAvailable())
		{
			return true;
		}
		return false;
	}
}
// --- End of File: EquipmentGroupElement.cs ---



// --- Start of File: EquipmentType.cs ---
public enum EquipmentType
{
	Weapon,
	Helmet,
	Armor,
	Boots,
	Ring,
	Amulet
}
// --- End of File: EquipmentType.cs ---



// --- Start of File: ErrorWindow.cs ---
using UnityEngine;
using UnityEngine.UI;

public class ErrorWindow : MonoBehaviour
{
	public Text errorText;

	public static string errorMessage;

	private void OnEnable()
	{
		errorText.text = errorMessage;
	}
}
// --- End of File: ErrorWindow.cs ---



// --- Start of File: ExceptionHelpers.cs ---
using System;
using System.Runtime.ExceptionServices;

internal static class ExceptionHelpers
{
	public static Exception PrepareForRethrow(Exception exception)
	{
		ExceptionDispatchInfo.Capture(exception).Throw();
		return exception;
	}
}
// --- End of File: ExceptionHelpers.cs ---



// --- Start of File: ExecuteEvent.cs ---
namespace ai;

public enum ExecuteEvent
{
	True,
	False,
	Continue
}
// --- End of File: ExecuteEvent.cs ---



// --- Start of File: ExitAction.cs ---
using UnityEngine;

public class ExitAction : MonoBehaviour
{
	public void clickExit()
	{
		Application.Quit();
	}
}
// --- End of File: ExitAction.cs ---



// --- Start of File: ExplosionChecker.cs ---
using System.Collections.Generic;
using UnityEngine;

public class ExplosionChecker
{
	private const float TIMER = 1f;

	private Dictionary<int, ExplosionMemoryData> data = new Dictionary<int, ExplosionMemoryData>();

	private List<int> _to_remove = new List<int>(16);

	public bool checkNearby(WorldTile pTile, int pRange)
	{
		int num = pRange * 10000000 + pTile.x * 1000 + pTile.y;
		if (data.ContainsKey(num) || isNearbyOthers(pTile, pRange / 3))
		{
			return true;
		}
		add(num, pTile, pRange);
		updateNearbyTimers(pTile, pRange);
		return false;
	}

	private void updateNearbyTimers(WorldTile pTile, float pRange)
	{
		float num = 1f;
		float num2 = pRange;
		num += (float)(data.Count / 10);
		num2 += (float)(data.Count / 5);
		num = Mathf.Clamp(num, 1f, 5f);
		num2 = Mathf.Clamp(num2, pRange, pRange * 5f);
		foreach (int key in data.Keys)
		{
			ExplosionMemoryData explosionMemoryData = data[key];
			if (Toolbox.Dist(pTile.x, pTile.y, explosionMemoryData.x, explosionMemoryData.y) < num2)
			{
				explosionMemoryData.timer = num;
			}
		}
	}

	private bool isNearbyOthers(WorldTile pTile, float pRange)
	{
		foreach (ExplosionMemoryData value in data.Values)
		{
			if (Toolbox.Dist(pTile.x, pTile.y, value.x, value.y) < pRange)
			{
				return true;
			}
		}
		return false;
	}

	private void add(int pID, WorldTile pTile, int pRange)
	{
		ExplosionMemoryData explosionMemoryData = new ExplosionMemoryData();
		explosionMemoryData.range = pRange;
		explosionMemoryData.x = pTile.x;
		explosionMemoryData.y = pTile.y;
		float num = 1f;
		num += (float)(data.Count / 10);
		num = Mathf.Clamp(num, 1f, 5f);
		explosionMemoryData.timer = num;
		data.Add(pID, explosionMemoryData);
	}

	public void update(float pElapsed)
	{
		Bench.bench("explosion_checker", "game_total");
		foreach (int key in data.Keys)
		{
			ExplosionMemoryData explosionMemoryData = data[key];
			explosionMemoryData.timer -= pElapsed;
			if (explosionMemoryData.timer <= 0f)
			{
				_to_remove.Add(key);
			}
		}
		if (_to_remove.Count > 0)
		{
			for (int i = 0; i < _to_remove.Count; i++)
			{
				data.Remove(_to_remove[i]);
			}
			_to_remove.Clear();
		}
		Bench.benchEnd("explosion_checker", "game_total", pSaveCounter: false, 0L);
	}

	public void clear()
	{
		data.Clear();
	}

	public static void debug(DebugTool pTool)
	{
		pTool.setText("explosion_checker", MapBox.instance.explosion_checker.data.Count, 0f, pShowBar: false, 0L);
	}
}
// --- End of File: ExplosionChecker.cs ---



// --- Start of File: ExplosionFlash.cs ---
using UnityEngine;

public class ExplosionFlash : BaseEffect
{
	private float speed;

	public void start(Vector3 pVector, float pRadius, float pSpeed = 1f)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		speed = pSpeed;
		((Component)this).transform.position = new Vector3(pVector.x, pVector.y);
		setScale(0.005f * pRadius);
		setAlpha(1f);
	}

	public override void update(float pElapsed)
	{
		setAlpha(alpha - pElapsed * speed * 0.5f);
		setScale(scale += pElapsed * speed * 0.1f);
		if (alpha <= 0f)
		{
			kill();
		}
	}
}
// --- End of File: ExplosionFlash.cs ---



// --- Start of File: ExplosionMemoryData.cs ---
public class ExplosionMemoryData
{
	public int x;

	public int y;

	public int range;

	public float timer;
}
// --- End of File: ExplosionMemoryData.cs ---



// --- Start of File: ExplosionsEffects.cs ---
using System.Collections.Generic;
using UnityEngine;

public class ExplosionsEffects : MapLayer
{
	private Dictionary<WorldTile, TileTypeBase> explosionDict;

	private Dictionary<WorldTile, TileTypeBase> explosionDictCurrent;

	public List<WorldTile> explosionQueue;

	private List<WorldTile> explosionQueueCurrent;

	private float timerExplosionQueue;

	public float interval = 0.01f;

	internal Queue<WorldTile> nextWave = new Queue<WorldTile>();

	internal HashSetWorldTile hashset_bombs = new HashSetWorldTile();

	internal List<WorldTile> delayedBombs = new List<WorldTile>();

	internal List<WorldTile> timedBombs = new List<WorldTile>();

	internal override void create()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		colorValues = new Color(1f, 1f, 1f, 1f);
		colors_amount = 60;
		explosionQueue = new List<WorldTile>();
		explosionQueueCurrent = new List<WorldTile>();
		explosionDict = new Dictionary<WorldTile, TileTypeBase>();
		explosionDictCurrent = new Dictionary<WorldTile, TileTypeBase>();
		hashsetTiles = new HashSetWorldTile();
		base.create();
	}

	internal override void clear()
	{
		explosionQueue.Clear();
		explosionQueueCurrent.Clear();
		explosionDict.Clear();
		explosionDictCurrent.Clear();
		hashsetTiles.Clear();
		timedBombs.Clear();
		delayedBombs.Clear();
		nextWave.Clear();
		hashset_bombs.Clear();
		base.clear();
	}

	internal void activateDelayedBomb(WorldTile pBomb)
	{
		if (!delayedBombs.Contains(pBomb))
		{
			delayedBombs.Add(pBomb);
			pBomb.delayed_bomb_type = pBomb.Type.id;
			pBomb.delayed_timer_bomb = 0.09f;
		}
	}

	internal void addTimedTnt(WorldTile pTile)
	{
		if (!timedBombs.Contains(pTile))
		{
			pTile.delayed_timer_bomb = 5f;
			timedBombs.Add(pTile);
		}
	}

	internal void explodeBomb(WorldTile pBombTile, bool pForce = false)
	{
		if (hashset_bombs.Contains(pBombTile))
		{
			return;
		}
		if (pBombTile.Type.explodable_delayed && !pForce)
		{
			activateDelayedBomb(pBombTile);
			return;
		}
		World.world.startShake();
		nextWave.Enqueue(pBombTile);
		while (nextWave.Count > 0)
		{
			WorldTile worldTile = nextWave.Dequeue();
			hashset_bombs.Add(worldTile);
			if (worldTile.Type.explodable && !worldTile.Type.explodable_delayed)
			{
				worldTile.explosion_wave = worldTile.Type.explode_range;
				worldTile.explosion_power = worldTile.Type.explode_range;
			}
			if (worldTile.explosion_wave <= 0)
			{
				continue;
			}
			for (int i = 0; i < worldTile.neighbours.Length; i++)
			{
				WorldTile worldTile2 = worldTile.neighbours[i];
				if (worldTile2.explosion_wave > 0 && hashset_bombs.Contains(worldTile2))
				{
					if (worldTile2.explosion_wave < worldTile.explosion_wave && worldTile2.Type.explodable)
					{
					}
				}
				else
				{
					hashset_bombs.Add(worldTile2);
					worldTile2.explosion_wave = worldTile.explosion_wave - 1;
					worldTile2.explosion_power = worldTile.explosion_power;
					nextWave.Enqueue(worldTile2);
				}
			}
		}
		if (hashset_bombs.Count < 20)
		{
			MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionSmall", pBombTile);
		}
		else
		{
			MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionMiddle", pBombTile);
		}
		using ListPool<WorldTile> listPool = new ListPool<WorldTile>(hashset_bombs);
		foreach (ref WorldTile item in listPool)
		{
			WorldTile current = item;
			MapAction.explodeTile(current, (current.explosion_power - current.explosion_wave) * 10, current.explosion_power * 10, pBombTile, AssetManager.terraform.get("bomb"));
		}
	}

	public void prepareNewExplosion(WorldTile pTile)
	{
		if (!explosionDict.ContainsKey(pTile))
		{
			explosionQueue.Add(pTile);
			explosionDict.Add(pTile, pTile.Type);
		}
	}

	private void updateExplosionQueue()
	{
		if (timerExplosionQueue > 0f)
		{
			timerExplosionQueue -= World.world.elapsed;
			return;
		}
		timerExplosionQueue = 0.1f;
		if (explosionQueue.Count != 0)
		{
			for (int i = 0; i < explosionQueue.Count; i++)
			{
				WorldTile worldTile = explosionQueue[i];
				explosionQueueCurrent.Add(worldTile);
				explosionDictCurrent.Add(worldTile, explosionDict[worldTile]);
			}
			explosionQueue.Clear();
			explosionDict.Clear();
			for (int j = 0; j < explosionQueueCurrent.Count; j++)
			{
				WorldTile worldTile2 = explosionQueueCurrent[j];
				MapAction.damageWorld(worldTile2, explosionDictCurrent[worldTile2].explode_range, AssetManager.terraform.get("bomb"));
				MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionMiddle", worldTile2);
			}
			explosionQueueCurrent.Clear();
			explosionDictCurrent.Clear();
		}
	}

	public override void update(float pElapsed)
	{
		checkAutoDisable();
		if (timedBombs.Count <= 0 || World.world.isPaused())
		{
			return;
		}
		int num = 0;
		while (num < timedBombs.Count)
		{
			WorldTile worldTile = timedBombs[num];
			if (worldTile.delayed_timer_bomb > 0f)
			{
				worldTile.delayed_timer_bomb -= pElapsed;
				num++;
				continue;
			}
			timedBombs.RemoveAt(num);
			if (worldTile.Type.explodable_timed)
			{
				MapAction.damageWorld(worldTile, worldTile.Type.explode_range, AssetManager.terraform.get("bomb"));
				MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionMiddle", worldTile);
			}
		}
	}

	public override void draw(float pElapsed)
	{
		if (Object.op_Implicit((Object)(object)sprRnd) || delayedBombs.Count > 0)
		{
			UpdateDirty(pElapsed);
		}
	}

	protected override void UpdateDirty(float pElapsed)
	{
		//IL_01cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_019f: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a4: Unknown result type (might be due to invalid IL or missing references)
		if (delayedBombs.Count > 0)
		{
			int num = 0;
			while (num < delayedBombs.Count)
			{
				WorldTile worldTile = delayedBombs[num];
				worldTile.delayed_timer_bomb -= World.world.elapsed;
				if (worldTile.delayed_timer_bomb <= 0f)
				{
					worldTile.delayed_timer_bomb = -100f;
					delayedBombs.Remove(worldTile);
					TileTypeBase tileTypeBase = (string.IsNullOrEmpty(worldTile.delayed_bomb_type) ? TopTileLibrary.tnt_timed : AssetManager.top_tiles.get(worldTile.delayed_bomb_type));
					MapAction.damageWorld(worldTile, tileTypeBase.explode_range, AssetManager.terraform.get("bomb"));
					MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionMiddle", worldTile);
				}
				else
				{
					num++;
				}
			}
		}
		if (hashset_bombs.Count > 0)
		{
			foreach (WorldTile hashset_bomb in hashset_bombs)
			{
				hashset_bomb.explosion_wave = 0;
				hashset_bomb.explosion_power = 0;
			}
			hashset_bombs.Clear();
		}
		if (timer > 0f)
		{
			timer -= World.world.elapsed;
			return;
		}
		timer = interval;
		if (hashsetTiles.Count == 0)
		{
			return;
		}
		using ListPool<WorldTile> listPool = new ListPool<WorldTile>();
		foreach (WorldTile hashsetTile in hashsetTiles)
		{
			if (hashsetTile.explosion_fx_stage > 0)
			{
				if (Randy.randomBool())
				{
					pixels[hashsetTile.data.tile_id] = Toolbox.clear;
				}
				else
				{
					pixels[hashsetTile.data.tile_id] = colors[hashsetTile.explosion_fx_stage - 1];
				}
				hashsetTile.explosion_fx_stage--;
				if (hashsetTile.explosion_fx_stage <= 0)
				{
					hashsetTile.explosion_fx_stage = 0;
					listPool.Add(hashsetTile);
				}
			}
		}
		if (listPool.Count > 0)
		{
			for (int i = 0; i < listPool.Count; i++)
			{
				WorldTile item = listPool[i];
				hashsetTiles.Remove(item);
			}
		}
		updatePixels();
	}

	internal void setDirty(WorldTile pTile, float pDist, float pRadius)
	{
		int num = (int)(60f * (1f - pDist / pRadius));
		if (num != 0 && num >= pTile.explosion_fx_stage)
		{
			hashsetTiles.Add(pTile);
			pTile.explosion_fx_stage = num;
		}
	}
}
// --- End of File: ExplosionsEffects.cs ---



// --- Start of File: FadeInOutAnimation.cs ---
using UnityEngine;
using UnityEngine.UI;

public class FadeInOutAnimation : MonoBehaviour
{
	private const float FADE_OUT_BOUND = 0.1f;

	private const float FADE_SPEED = 0.015f;

	private const float INTERVAL = 0.025f;

	public float alpha_max = 1f;

	private float _current_alpha;

	private float _timer = 0.025f;

	private bool _fade_out = true;

	[SerializeField]
	private Image _image;

	public void Awake()
	{
		checkInit();
	}

	public void checkInit()
	{
		_image = ((Component)this).GetComponent<Image>();
	}

	private void updateAlpha()
	{
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		_timer -= Time.deltaTime;
		if (!(_timer < 0f))
		{
			return;
		}
		_timer = 0.025f;
		if (_fade_out)
		{
			_current_alpha -= 0.015f;
			if (_current_alpha <= 0.1f)
			{
				_current_alpha = 0.1f;
				_fade_out = false;
			}
		}
		else
		{
			_current_alpha += 0.015f;
			if (_current_alpha >= alpha_max)
			{
				_current_alpha = alpha_max;
				_fade_out = true;
			}
		}
		Color color = ((Graphic)_image).color;
		color.a = _current_alpha;
		((Graphic)_image).color = color;
	}

	public void resetToFadeOut()
	{
		_current_alpha = 1f;
		_fade_out = true;
		updateAlpha();
	}

	public void resetToFadeIn()
	{
		_current_alpha = 0f;
		_fade_out = false;
		updateAlpha();
	}

	public void reset()
	{
		resetToFadeOut();
	}

	private void OnEnable()
	{
		reset();
	}

	private void Update()
	{
		updateAlpha();
	}
}
// --- End of File: FadeInOutAnimation.cs ---



// --- Start of File: FadeOutDelayed.cs ---
using UnityEngine;

public class FadeOutDelayed : MonoBehaviour
{
	[SerializeField]
	private CanvasGroup _group;

	[SerializeField]
	private float _duration;

	[SerializeField]
	private float _delay;

	[SerializeField]
	[Range(0f, 1f)]
	private float _max_alpha = 1f;

	[SerializeField]
	[Range(0f, 1f)]
	private float _min_alpha;

	private float _time_left;

	private float _delay_time_left;

	private void OnEnable()
	{
		reset();
	}

	private void Update()
	{
		_delay_time_left -= Time.deltaTime;
		if (!(_delay_time_left > 0f) && !(_time_left <= 0f))
		{
			_time_left -= Time.deltaTime;
			_group.alpha = Mathf.Lerp(_min_alpha, _max_alpha, _time_left / _duration);
		}
	}

	private void reset()
	{
		_delay_time_left = _delay;
		_time_left = _duration;
		_group.alpha = _max_alpha;
	}
}
// --- End of File: FadeOutDelayed.cs ---



// --- Start of File: FamiliesColorsLibrary.cs ---
public class FamiliesColorsLibrary : ColorLibrary
{
	public FamiliesColorsLibrary()
	{
		file_path = "colors/colors_general";
	}

	public override void init()
	{
		base.init();
		useSameColorsFrom(AssetManager.kingdom_colors_library);
	}

	public override bool isColorUsedInWorld(ColorAsset pAsset)
	{
		foreach (Family family in World.world.families)
		{
			if (checkColor(pAsset, family.data.color_id))
			{
				return true;
			}
		}
		return base.isColorUsedInWorld(pAsset);
	}
}
// --- End of File: FamiliesColorsLibrary.cs ---



// --- Start of File: FamiliesNoItems.cs ---
using UnityEngine;

public class FamiliesNoItems : MonoBehaviour
{
	private GameObject _inner;

	private IMetaWithFamiliesWindow _families_window;

	private void Awake()
	{
		_inner = ((Component)((Component)this).transform.GetChild(0)).gameObject;
		_families_window = ((Component)this).GetComponentInParent<IMetaWithFamiliesWindow>();
	}

	private void OnEnable()
	{
		_inner.SetActive(!_families_window.hasFamilies());
	}
}
// --- End of File: FamiliesNoItems.cs ---



// --- Start of File: Family.cs ---
using System.Collections.Generic;
using UnityEngine;
using db;

public class Family : MetaObject<FamilyData>, ISapient
{
	private Actor _cached_alpha;

	private ActorAsset _cached_species;

	private Actor _founder_1;

	private Actor _founder_2;

	private bool _founders_dirty;

	private double _timestamp_hungry_check;

	private bool _cached_hungry_check_result;

	protected override MetaType meta_type => MetaType.Family;

	public override BaseSystemManager manager => World.world.families;

	public void newFamily(Actor pActor1, Actor pActor2, WorldTile pTile)
	{
		data.species_id = pActor1.asset.id;
		generateNewMetaObject();
		data.founder_actor_name_1 = pActor1.getName();
		data.founder_actor_name_2 = pActor2?.getName();
		if (pActor1.hasSubspecies())
		{
			data.subspecies_id = pActor1.subspecies.id;
			data.subspecies_name = pActor1.subspecies.name;
		}
		data.founder_city_id = pActor1.city?.getID() ?? (-1);
		data.founder_city_name = pActor1.city?.name;
		if (pActor1.kingdom.isCiv())
		{
			data.founder_kingdom_id = pActor1.kingdom.getID();
			data.founder_kingdom_name = pActor1.kingdom.data.name;
		}
		data.main_founder_id_1 = pActor1.getID();
		if (pActor2 != null)
		{
			data.main_founder_id_2 = pActor2.getID();
		}
		generateName(pActor1);
	}

	public bool areMostUnitsHungry()
	{
		if (World.world.getWorldTimeElapsedSince(_timestamp_hungry_check) < 5f)
		{
			return _cached_hungry_check_result;
		}
		if (countHungry() >= countUnits() / 2)
		{
			_cached_hungry_check_result = true;
		}
		else
		{
			_cached_hungry_check_result = false;
		}
		_timestamp_hungry_check = World.world.getCurWorldTime();
		return _cached_hungry_check_result;
	}

	public bool isFull()
	{
		return base.units.Count > getActorAsset().family_limit;
	}

	public bool isAlpha(Actor pActor)
	{
		Actor cached_alpha = _cached_alpha;
		return pActor == cached_alpha;
	}

	private void removeAlpha()
	{
		data.alpha_id = -1L;
		_cached_alpha = null;
	}

	public void checkAlpha()
	{
		if (_cached_alpha != null)
		{
			if (!_cached_alpha.isAlive())
			{
				removeAlpha();
			}
			else if (_cached_alpha.family != this)
			{
				removeAlpha();
			}
		}
		if (_cached_alpha == null)
		{
			Actor actor = findAlpha();
			if (actor != null)
			{
				setAlpha(actor, pNew: true);
			}
		}
	}

	public Actor getAlpha()
	{
		return _cached_alpha;
	}

	public Actor findAlpha()
	{
		Actor result = null;
		double num = double.MaxValue;
		for (int i = 0; i < base.units.Count; i++)
		{
			Actor actor = base.units[i];
			if (actor.isAlive() && !(actor.data.created_time > num))
			{
				num = actor.data.created_time;
				result = actor;
			}
		}
		return result;
	}

	private void setAlpha(Actor pActor, bool pNew)
	{
		data.alpha_id = pActor.getID();
		if (pNew)
		{
			pActor.changeHappiness("become_alpha");
		}
		_cached_alpha = pActor;
	}

	public void saveOriginFamily1(long pFamilyID)
	{
		data.original_family_1 = pFamilyID;
	}

	public void saveOriginFamily2(long pFamilyID)
	{
		if (pFamilyID != data.original_family_1)
		{
			data.original_family_2 = pFamilyID;
		}
	}

	public IEnumerable<Family> getOriginFamilies()
	{
		if (data.original_family_1.hasValue())
		{
			Family family = World.world.families.get(data.original_family_1);
			if (!family.isRekt())
			{
				yield return family;
			}
		}
		if (data.original_family_2.hasValue())
		{
			Family family2 = World.world.families.get(data.original_family_2);
			if (!family2.isRekt())
			{
				yield return family2;
			}
		}
	}

	public override void generateBanner()
	{
		data.banner_background_id = AssetManager.family_banners_library.getNewIndexBackground();
		ActorAsset actorAsset = getActorAsset();
		int banner_frame_id;
		if (actorAsset.family_banner_frame_only_inclusion)
		{
			banner_frame_id = AssetManager.family_banners_library.main.frames.IndexOf(actorAsset.family_banner_frame_generation_inclusion);
		}
		else
		{
			using ListPool<string> listPool = new ListPool<string>(AssetManager.family_banners_library.main.frames);
			string family_banner_frame_generation_exclusion = actorAsset.family_banner_frame_generation_exclusion;
			if (!string.IsNullOrEmpty(family_banner_frame_generation_exclusion))
			{
				listPool.Remove(family_banner_frame_generation_exclusion);
			}
			string family_banner_frame_generation_exclusion2 = actorAsset.family_banner_frame_generation_exclusion;
			if (!string.IsNullOrEmpty(family_banner_frame_generation_exclusion2))
			{
				listPool.Remove(family_banner_frame_generation_exclusion2);
			}
			string random = listPool.GetRandom();
			banner_frame_id = AssetManager.family_banners_library.main.frames.IndexOf(random);
		}
		data.banner_frame_id = banner_frame_id;
	}

	public Sprite getSpriteBackground()
	{
		return AssetManager.family_banners_library.getSpriteBackground(data.banner_background_id);
	}

	public Sprite getSpriteFrame()
	{
		return AssetManager.family_banners_library.getSpriteFrame(data.banner_frame_id);
	}

	public override ActorAsset getActorAsset()
	{
		if (_cached_species == null)
		{
			_cached_species = AssetManager.actor_library.get(data.species_id);
		}
		return _cached_species;
	}

	public bool isSapient()
	{
		return World.world.subspecies.get(data.subspecies_id)?.isSapient() ?? false;
	}

	public bool isMainFounder(Actor pActor)
	{
		if (pActor.data.id == data.main_founder_id_1)
		{
			return true;
		}
		if (pActor.data.id == data.main_founder_id_2)
		{
			return true;
		}
		return false;
	}

	public bool hasFounders()
	{
		checkFounders();
		if (_founder_1 == null)
		{
			return _founder_2 != null;
		}
		return true;
	}

	public Actor getRandomFounder()
	{
		checkFounders();
		if (!hasFounders())
		{
			return null;
		}
		if (_founder_1 != null && _founder_2 == null)
		{
			return _founder_1;
		}
		if (_founder_2 != null && _founder_1 == null)
		{
			return _founder_2;
		}
		if (Randy.randomBool())
		{
			return _founder_1;
		}
		return _founder_2;
	}

	public Actor getFounderFirst()
	{
		return _founder_1;
	}

	public Actor getFounderSecond()
	{
		return _founder_2;
	}

	private void checkFounders()
	{
		if (!_founders_dirty)
		{
			return;
		}
		clearFounders();
		_founders_dirty = false;
		foreach (Actor unit in base.units)
		{
			if (unit.data.id == data.main_founder_id_1)
			{
				_founder_1 = unit;
			}
			if (unit.data.id == data.main_founder_id_2)
			{
				_founder_2 = unit;
			}
		}
	}

	private void clearFounders()
	{
		_founder_1 = null;
		_founder_2 = null;
		_founders_dirty = true;
	}

	protected override ColorLibrary getColorLibrary()
	{
		return AssetManager.families_colors_library;
	}

	public bool isSameSpecies(string pAssetID)
	{
		return data.species_id == pAssetID;
	}

	private void generateName(Actor pActor)
	{
		string pName = pActor.generateName(MetaType.Family, getID());
		setName(pName);
		data.name_culture_id = pActor.culture?.getID() ?? (-1);
	}

	public override void loadData(FamilyData pData)
	{
		base.loadData(pData);
		if (data.alpha_id.hasValue())
		{
			Actor actor = World.world.units.get(data.alpha_id);
			if (actor != null)
			{
				setAlpha(actor, pNew: false);
			}
		}
	}

	public override void updateDirty()
	{
		base.updateDirty();
		clearFounders();
	}

	public override void Dispose()
	{
		DBInserter.deleteData(getID(), "family");
		_cached_alpha = null;
		_cached_species = null;
		_timestamp_hungry_check = 0.0;
		_cached_hungry_check_result = false;
		_founder_1 = null;
		_founder_2 = null;
		_founders_dirty = true;
		base.Dispose();
	}
}
// --- End of File: Family.cs ---



// --- Start of File: FamilyBanner.cs ---
using UnityEngine.UI;

public class FamilyBanner : BannerGeneric<Family, FamilyData>
{
	protected override MetaType meta_type => MetaType.Family;

	protected override string tooltip_id => "family";

	protected override TooltipData getTooltipData()
	{
		TooltipData tooltipData = base.getTooltipData();
		tooltipData.family = meta_object;
		return tooltipData;
	}

	protected override void setupBanner()
	{
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		base.setupBanner();
		part_background.sprite = meta_object.getSpriteBackground();
		part_icon.sprite = meta_object.getSpriteIcon();
		part_frame.sprite = meta_object.getSpriteFrame();
		ColorAsset colorAsset = meta_object.getColor();
		((Graphic)part_background).color = colorAsset.getColorMainSecond();
	}
}
// --- End of File: FamilyBanner.cs ---



// --- Start of File: FamilyCustomizeWindow.cs ---
public class FamilyCustomizeWindow : GenericCustomizeWindow<Family, FamilyData, FamilyBanner>
{
	protected override MetaType meta_type => MetaType.Family;

	protected override Family meta_object => SelectedMetas.selected_family;

	protected override void onBannerChange()
	{
		image_banner_option_1.sprite = meta_object.getSpriteBackground();
		image_banner_option_2.sprite = meta_object.getSpriteFrame();
	}
}
// --- End of File: FamilyCustomizeWindow.cs ---



// --- Start of File: FamilyData.cs ---
using System.ComponentModel;

public class FamilyData : MetaObjectData
{
	public int banner_background_id;

	public int banner_frame_id;

	[DefaultValue(-1L)]
	public long alpha_id = -1L;

	public string founder_actor_name_1;

	public string founder_actor_name_2;

	[DefaultValue(-1L)]
	public long main_founder_id_1 = -1L;

	[DefaultValue(-1L)]
	public long main_founder_id_2 = -1L;

	[DefaultValue(-1L)]
	public long subspecies_id = -1L;

	public string subspecies_name = string.Empty;

	public string species_id = string.Empty;

	[DefaultValue(-1L)]
	public long founder_city_id = -1L;

	public string founder_city_name = string.Empty;

	[DefaultValue(-1L)]
	public long founder_kingdom_id = -1L;

	public string founder_kingdom_name = string.Empty;

	[DefaultValue(-1L)]
	public long original_family_1 = -1L;

	[DefaultValue(-1L)]
	public long original_family_2 = -1L;
}
// --- End of File: FamilyData.cs ---



// --- Start of File: FamilyElement.cs ---
public class FamilyElement : WindowMetaElement<Family, FamilyData>
{
	protected Family family => meta_object;
}
// --- End of File: FamilyElement.cs ---



// --- Start of File: FamilyListComponent.cs ---
using UnityEngine;

public class FamilyListComponent : ComponentListSapient<FamilyListElement, Family, FamilyData, FamilyListComponent>
{
	private IMetaWithFamiliesWindow _families_window;

	protected override MetaType meta_type => MetaType.Family;

	protected override bool change_asset_sort_order => _families_window == null;

	protected override void create()
	{
		base.create();
		_families_window = ((Component)this).GetComponentInParent<IMetaWithFamiliesWindow>();
		if (_families_window != null)
		{
			get_objects_delegate = (FamilyListComponent _) => _families_window.getFamilies();
		}
	}

	protected override void setupSortingTabs()
	{
		genericMetaSortByAge(base.sortByAge);
		genericMetaSortByRenown(base.sortByRenown);
		genericMetaSortByPopulation(ComponentListBase<FamilyListElement, Family, FamilyData, FamilyListComponent>.sortByPopulation);
		genericMetaSortByKills(ComponentListBase<FamilyListElement, Family, FamilyData, FamilyListComponent>.sortByKills);
		genericMetaSortByDeath(ComponentListBase<FamilyListElement, Family, FamilyData, FamilyListComponent>.sortByDeaths);
		sorting_tab.tryAddButton("ui/Icons/iconAdults", "sort_by_adults", show, delegate
		{
			current_sort = sortByAdults;
		});
		sorting_tab.tryAddButton("ui/Icons/iconChildren", "sort_by_children", show, delegate
		{
			current_sort = sortByChildren;
		});
		sorting_tab.tryAddButton("ui/Icons/iconHelixDNA", "sort_by_species", show, delegate
		{
			current_sort = sortBySpecies;
		});
	}

	public override bool isEmpty()
	{
		if (_families_window != null)
		{
			return !_families_window.hasFamilies();
		}
		return base.isEmpty();
	}

	public static int sortByAdults(Family pObject1, Family pObject2)
	{
		return pObject2.countAdults().CompareTo(pObject1.countAdults());
	}

	public static int sortByChildren(Family pObject1, Family pObject2)
	{
		return pObject2.countChildren().CompareTo(pObject1.countChildren());
	}

	public static int sortBySpecies(Family pObject1, Family pObject2)
	{
		return pObject2.getActorAsset().GetHashCode().CompareTo(pObject1.getActorAsset().GetHashCode());
	}
}
// --- End of File: FamilyListComponent.cs ---



// --- Start of File: FamilyListElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class FamilyListElement : WindowListElementBase<Family, FamilyData>
{
	public Text text_name;

	public CountUpOnClick text_age;

	public CountUpOnClick text_population;

	public CountUpOnClick text_adults;

	public CountUpOnClick text_children;

	public CountUpOnClick text_dead;

	[SerializeField]
	private Text _collective_term;

	internal override void show(Family pFamily)
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		base.show(pFamily);
		text_name.text = pFamily.name;
		((Graphic)text_name).color = pFamily.getColor().getColorText();
		text_age.setValue(pFamily.getAge());
		text_population.setValue(pFamily.countUnits());
		text_adults.setValue(pFamily.countAdults());
		text_children.setValue(pFamily.countChildren());
		text_dead.setValue((int)pFamily.getTotalDeaths());
		string text = LocalizedTextManager.getText(pFamily.getActorAsset().getCollectiveTermID());
		_collective_term.text = text;
	}

	protected override void tooltipAction()
	{
		Tooltip.show(this, "family", new TooltipData
		{
			family = meta_object
		});
	}

	protected override ActorAsset getActorAsset()
	{
		return meta_object.getActorAsset();
	}
}
// --- End of File: FamilyListElement.cs ---



// --- Start of File: FamilyManager.cs ---
using System.Collections.Generic;

public class FamilyManager : MetaSystemManager<Family, FamilyData>
{
	public FamilyManager()
	{
		type_id = "family";
	}

	public Family newFamily(Actor pActor, WorldTile pTile, Actor pActor2)
	{
		World.world.game_stats.data.familiesCreated++;
		World.world.map_stats.familiesCreated++;
		Family family = newObject();
		family.newFamily(pActor, pActor2, pTile);
		if (pActor.hasFamily())
		{
			family.saveOriginFamily1(pActor.family.id);
		}
		pActor.setFamily(family);
		if (pActor2 != null)
		{
			if (pActor2.hasFamily())
			{
				family.saveOriginFamily2(pActor2.family.id);
			}
			pActor2.setFamily(family);
		}
		return family;
	}

	public override void removeObject(Family pObject)
	{
		World.world.game_stats.data.familiesDestroyed++;
		World.world.map_stats.familiesDestroyed++;
		base.removeObject(pObject);
	}

	public Family getNearbyFamily(ActorAsset pUnitAsset, WorldTile pTile)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 4, pUnitAsset.family_spawn_radius, pRandom: true))
		{
			if (item.isAlive() && item.hasFamily() && !item.family.isFull() && item.family.isSameSpecies(pUnitAsset.id) && item.current_tile.isSameIsland(pTile))
			{
				return item.family;
			}
		}
		return null;
	}

	protected override void updateDirtyUnits()
	{
		List<Actor> units_only_alive = World.world.units.units_only_alive;
		for (int i = 0; i < units_only_alive.Count; i++)
		{
			Actor actor = units_only_alive[i];
			Family family = actor.family;
			if (family != null && family.isDirtyUnits())
			{
				family.listUnit(actor);
			}
		}
	}
}
// --- End of File: FamilyManager.cs ---



// --- Start of File: FamilyMembersContainer.cs ---
using System.Collections;
using UnityEngine;

public class FamilyMembersContainer : FamilyElement
{
	private ObjectPoolGenericMono<PrefabUnitElement> _pool_parents;

	private ObjectPoolGenericMono<PrefabUnitElement> _pool_children;

	[SerializeField]
	private RectTransform _list_parents;

	[SerializeField]
	private RectTransform _list_children;

	[SerializeField]
	private LocalizedText _title_parents;

	[SerializeField]
	private LocalizedText _title_children;

	[SerializeField]
	private PrefabUnitElement _prefab;

	protected override void Awake()
	{
		_pool_children = new ObjectPoolGenericMono<PrefabUnitElement>(_prefab, (Transform)(object)_list_children);
		_pool_parents = new ObjectPoolGenericMono<PrefabUnitElement>(_prefab, (Transform)(object)_list_parents);
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		if (base.family.units.Count == 0)
		{
			yield break;
		}
		using ListPool<Actor> tFamilyMembers = new ListPool<Actor>(base.family.units);
		track_objects.AddRange(tFamilyMembers);
		tFamilyMembers.Sort(ListSorters.sortUnitByAgeOldFirst);
		tFamilyMembers.Sort(sortByMainParent);
		FamilyParentsMode family_show_parents = base.family.getActorAsset().family_show_parents;
		bool num = family_show_parents == FamilyParentsMode.Alpha;
		bool tShowNormalFamily = family_show_parents == FamilyParentsMode.Normal;
		bool tHaveParents = false;
		bool tHaveChildren = false;
		if (num)
		{
			string collectiveTermID = base.family.getActorAsset().getCollectiveTermID();
			_title_children.setKeyAndUpdate(collectiveTermID);
		}
		else
		{
			_title_children.setKeyAndUpdate("children");
		}
		foreach (ref Actor item in tFamilyMembers)
		{
			Actor tActor = item;
			if (base.family.isMainFounder(tActor) && tShowNormalFamily)
			{
				if (!tHaveParents)
				{
					tHaveParents = true;
					showParents();
				}
				yield return (object)new WaitForSecondsRealtime(0.025f);
				showMember(tActor, _pool_parents);
			}
			else
			{
				if (!tHaveChildren)
				{
					tHaveChildren = true;
					showChildren();
				}
				yield return (object)new WaitForSecondsRealtime(0.025f);
				showMember(tActor, _pool_children);
			}
		}
	}

	private void showParents()
	{
		((Component)_title_parents).gameObject.SetActive(true);
		((Component)_list_parents).gameObject.SetActive(true);
	}

	private void showChildren()
	{
		((Component)_title_children).gameObject.SetActive(true);
		((Component)_list_children).gameObject.SetActive(true);
	}

	private int sortByMainParent(Actor pActor1, Actor pActor2)
	{
		if (base.family.isMainFounder(pActor1) && !base.family.isMainFounder(pActor2))
		{
			return -1;
		}
		if (!base.family.isMainFounder(pActor1) && base.family.isMainFounder(pActor2))
		{
			return 1;
		}
		return 0;
	}

	private void showMember(Actor pActor, ObjectPoolGenericMono<PrefabUnitElement> pPool)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		PrefabUnitElement next = pPool.getNext();
		((Component)next).transform.localScale = new Vector3(0.9f, 0.9f, 1f);
		next.show(pActor);
	}

	protected override void clear()
	{
		((Component)_title_parents).gameObject.SetActive(false);
		((Component)_list_parents).gameObject.SetActive(false);
		((Component)_title_children).gameObject.SetActive(false);
		((Component)_list_children).gameObject.SetActive(false);
		_pool_children.clear();
		_pool_parents.clear();
		base.clear();
	}
}
// --- End of File: FamilyMembersContainer.cs ---



// --- Start of File: FamilyOriginElement.cs ---
using System.Collections;
using UnityEngine;

public class FamilyOriginElement : FamilyElement
{
	[SerializeField]
	private GameObject _family_origin_title;

	[SerializeField]
	private FamilyListElement _prefab;

	private ObjectPoolGenericMono<FamilyListElement> _pool_elements;

	[SerializeField]
	private Transform _container;

	protected override void Awake()
	{
		_pool_elements = new ObjectPoolGenericMono<FamilyListElement>(_prefab, _container);
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		using ListPool<Family> tList = new ListPool<Family>(base.family.getOriginFamilies());
		track_objects.AddRange(tList);
		foreach (ref Family item in tList)
		{
			Family tFamily = item;
			if (!tFamily.isRekt())
			{
				yield return (object)new WaitForSecondsRealtime(0.025f);
				if (tFamily.isAlive())
				{
					_family_origin_title.SetActive(true);
					_pool_elements.getNext().show(tFamily);
				}
			}
		}
	}

	protected override void clear()
	{
		_pool_elements.clear();
		_family_origin_title.SetActive(false);
		base.clear();
	}

	protected override void clearInitial()
	{
		for (int i = 0; i < _container.childCount; i++)
		{
			Object.Destroy((Object)(object)((Component)_container.GetChild(i)).gameObject);
		}
		base.clearInitial();
	}
}
// --- End of File: FamilyOriginElement.cs ---



// --- Start of File: FamilyParentsMode.cs ---
public enum FamilyParentsMode
{
	Normal,
	Alpha,
	None
}
// --- End of File: FamilyParentsMode.cs ---



// --- Start of File: FamilysBannerLibrary.cs ---
using System.Collections.Generic;

public class FamilysBannerLibrary : GenericBannerLibrary
{
	public override void init()
	{
		base.init();
		main = add(new BannerAsset
		{
			id = "main",
			backgrounds = new List<string>
			{
				"families/background_00", "families/background_01", "families/background_02", "families/background_03", "families/background_04", "families/background_05", "families/background_06", "families/background_07", "families/background_08", "families/background_09",
				"families/background_10", "families/background_11", "families/background_12", "families/background_13", "families/background_14", "families/background_15", "families/background_16"
			},
			frames = new List<string>
			{
				"families/frame_00", "families/frame_01", "families/frame_02", "families/frame_03", "families/frame_04", "families/frame_05", "families/frame_06", "families/frame_07", "families/frame_08", "families/frame_09",
				"families/frame_10", "families/frame_11", "families/frame_12", "families/frame_13", "families/frame_14", "families/frame_15", "families/frame_16", "families/frame_17", "families/frame_18", "families/frame_19",
				"families/frame_20", "families/frame_21", "families/frame_22"
			}
		});
	}
}
// --- End of File: FamilysBannerLibrary.cs ---



// --- Start of File: FamilyStatsElement.cs ---
using System.Collections;
using UnityEngine;

public class FamilyStatsElement : FamilyElement, IStatsElement, IRefreshElement
{
	private StatsIconContainer _stats_icons;

	public void setIconValue(string pName, float pMainVal, float? pMax = null, string pColor = "", bool pFloat = false, string pEnding = "", char pSeparator = '/')
	{
		_stats_icons.setIconValue(pName, pMainVal, pMax, pColor, pFloat, pEnding, pSeparator);
	}

	protected override void Awake()
	{
		_stats_icons = ((Component)this).gameObject.AddOrGetComponent<StatsIconContainer>();
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		if (base.family != null && base.family.isAlive())
		{
			_stats_icons.showGeneralIcons<Family, FamilyData>(base.family);
		}
		yield break;
	}

	GameObject IStatsElement.get_gameObject()
	{
		return ((Component)this).gameObject;
	}
}
// --- End of File: FamilyStatsElement.cs ---



// --- Start of File: FamilyWindow.cs ---
using UnityEngine.UI;

public class FamilyWindow : WindowMetaGeneric<Family, FamilyData>
{
	public Text title_family;

	public override MetaType meta_type => MetaType.Family;

	protected override Family meta_object => SelectedMetas.selected_family;

	protected override void showTopPartInformation()
	{
		base.showTopPartInformation();
		Family family = meta_object;
		if (family != null)
		{
			ActorAsset actorAsset = family.getActorAsset();
			title_family.text = LocalizedTextManager.getText(actorAsset.getCollectiveTermID());
		}
	}

	internal override void showStatsRows()
	{
		Family family = meta_object;
		tryShowPastNames();
		showStatRow("founded", family.getFoundedDate(), MetaType.None, -1L, "iconAge");
		tryToShowActor("founder", family.data.main_founder_id_1, family.data.founder_actor_name_1, null, "actor_traits/iconStupid");
		if (family.data.main_founder_id_2 != -1)
		{
			tryToShowActor("founder", family.data.main_founder_id_2, family.data.founder_actor_name_2, null, "actor_traits/iconStupid");
		}
		tryToShowMetaKingdom("origin", family.data.founder_kingdom_id, family.data.founder_kingdom_name);
		tryToShowMetaCity("birthplace", family.data.founder_city_id, family.data.founder_city_name);
		tryToShowMetaSubspecies("founder_subspecies", family.data.subspecies_id, family.data.subspecies_name);
		foreach (Family originFamily in family.getOriginFamilies())
		{
			tryToShowMetaFamily("origin_family", -1L, null, originFamily);
		}
		tryToShowMetaSpecies("founder_species", family.data.species_id);
	}
}
// --- End of File: FamilyWindow.cs ---



// --- Start of File: FaveWorldButton.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class FaveWorldButton : MonoBehaviour
{
	public Image icon;

	private void Start()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Expected O, but got Unknown
		Button val = default(Button);
		if (((Component)this).TryGetComponent<Button>(ref val))
		{
			((UnityEvent)val.onClick).AddListener(new UnityAction(faveWorld));
		}
	}

	private void OnEnable()
	{
		updateFavoriteIconFor(SaveManager.currentSlot);
	}

	private void faveWorld()
	{
		int currentSlot = SaveManager.currentSlot;
		if (PlayerConfig.instance.data.favorite_world == currentSlot)
		{
			PlayerConfig.instance.data.favorite_world = -1;
		}
		else
		{
			PlayerConfig.instance.data.favorite_world = currentSlot;
		}
		PlayerConfig.saveData();
		updateFavoriteIconFor(currentSlot);
	}

	private void updateFavoriteIconFor(int pId)
	{
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		if (PlayerConfig.instance.data.favorite_world == pId)
		{
			((Graphic)icon).color = ColorStyleLibrary.m.favorite_selected;
		}
		else
		{
			((Graphic)icon).color = ColorStyleLibrary.m.favorite_not_selected;
		}
	}
}
// --- End of File: FaveWorldButton.cs ---



// --- Start of File: FavoriteItemListComponent.cs ---
using System.Collections.Generic;

public class FavoriteItemListComponent : ComponentListBase<FavoriteItemListElement, Item, ItemData, FavoriteItemListComponent>
{
	private List<NanoObject> _meta_objects = new List<NanoObject>();

	protected override MetaType meta_type => MetaType.Item;

	protected override void setupSortingTabs()
	{
		sorting_tab.tryAddButton("ui/Icons/iconAge", "sort_by_age", show, delegate
		{
			current_sort = sortByAge;
		});
		sorting_tab.tryAddButton("ui/Icons/iconKills", "sort_by_kills", show, delegate
		{
			current_sort = sortByKills;
		});
		sorting_tab.tryAddButton("ui/Icons/iconDamage", "sort_by_damage", show, delegate
		{
			current_sort = sortByDamage;
		});
		sorting_tab.tryAddButton("ui/Icons/iconArmor", "sort_by_armor", show, delegate
		{
			current_sort = sortByArmor;
		});
		sorting_tab.tryAddButton("ui/Icons/iconItemType", "sort_by_type", show, delegate
		{
			current_sort = sortByType;
		});
		sorting_tab.tryAddButton("ui/Icons/iconItemQuality", "sort_by_quality", show, delegate
		{
			current_sort = sortByQuality;
		});
		sorting_tab.tryAddButton("ui/Icons/iconCity", "sort_by_city", show, delegate
		{
			current_sort = sortByCity;
		});
		sorting_tab.tryAddButton("ui/Icons/iconHumans", "sort_by_owner", show, delegate
		{
			current_sort = sortByOwner;
		});
	}

	protected override IEnumerable<Item> getObjectsList()
	{
		_meta_objects.Clear();
		foreach (Item item in World.world.items)
		{
			if (!item.isRekt() && item.isFavorite())
			{
				_meta_objects.Add(item);
				if (item.hasCity())
				{
					_meta_objects.Add(item.getCity());
				}
				if (item.hasActor())
				{
					_meta_objects.Add(item.getActor());
				}
				yield return item;
			}
		}
	}

	public static int sortByAge(Item pItem1, Item pItem2)
	{
		return -pItem2.data.created_time.CompareTo(pItem1.data.created_time);
	}

	public static int sortByKills(Item pItem1, Item pItem2)
	{
		return pItem2.data.kills.CompareTo(pItem1.data.kills);
	}

	public static int sortByType(Item pItem1, Item pItem2)
	{
		return pItem2.getAsset().equipment_type.CompareTo(pItem1.getAsset().equipment_type);
	}

	public static int sortByQuality(Item pItem1, Item pItem2)
	{
		return pItem2.getQuality().CompareTo(pItem1.getQuality());
	}

	public static int sortByCity(Item pItem1, Item pItem2)
	{
		int num = pItem1.hasCity().CompareTo(pItem2.hasCity());
		if (num != 0)
		{
			return num;
		}
		if (pItem1.hasCity() && pItem2.hasCity())
		{
			int num2 = pItem2.getCity().kingdom.CompareTo(pItem1.getCity().kingdom);
			if (num2 != 0)
			{
				return num2;
			}
			return pItem2.getCity().name.CompareTo(pItem1.getCity().name);
		}
		return pItem2.name.CompareTo(pItem1.name);
	}

	public static int sortByOwner(Item pItem1, Item pItem2)
	{
		int num = pItem1.hasActor().CompareTo(pItem2.hasActor());
		if (num != 0)
		{
			return num;
		}
		if (pItem1.hasActor() && pItem2.hasActor())
		{
			Actor actor = pItem1.getActor();
			Actor actor2 = pItem2.getActor();
			int num2 = actor.kingdom.CompareTo(actor2.kingdom);
			if (num2 != 0)
			{
				return num2;
			}
			int num3 = actor.hasCity().CompareTo(actor2.hasCity());
			if (num3 != 0)
			{
				return num3;
			}
			if (actor.hasCity() && actor2.hasCity())
			{
				int num4 = actor.getCity().name.CompareTo(actor2.getCity().name);
				if (num4 != 0)
				{
					return num4;
				}
			}
			return pItem2.getActor().name.CompareTo(pItem1.getActor().name);
		}
		return pItem2.name.CompareTo(pItem1.name);
	}

	public static int sortByDamage(Item pItem1, Item pItem2)
	{
		return pItem2.getFullStats()["damage"].CompareTo(pItem1.getFullStats()["damage"]);
	}

	public static int sortByArmor(Item pItem1, Item pItem2)
	{
		return pItem2.getFullStats()["armor"].CompareTo(pItem1.getFullStats()["armor"]);
	}

	public override void clear()
	{
		base.clear();
		_meta_objects.Clear();
	}

	public override bool checkRefreshWindow()
	{
		foreach (NanoObject meta_object in _meta_objects)
		{
			if (meta_object.isRekt())
			{
				return true;
			}
		}
		return base.checkRefreshWindow();
	}
}
// --- End of File: FavoriteItemListComponent.cs ---



// --- Start of File: FavoriteItemListElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class FavoriteItemListElement : WindowListElementBase<Item, ItemData>
{
	public Text name_text;

	public CountUpOnClick kills_text;

	public CountUpOnClick age_text;

	public CountUpOnClick owners_text;

	public CountUpOnClick damage_text;

	public CountUpOnClick armor_text;

	public CountUpOnClick durability_text;

	[SerializeField]
	private UiUnitAvatarElement _unit_avatar_element;

	[SerializeField]
	private CityBanner _banner_city;

	[SerializeField]
	private GameObject _ownerless;

	private IconOutline _outline;

	internal override void show(Item pItem)
	{
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		base.show(pItem);
		clear();
		name_text.text = pItem.getName();
		((Graphic)name_text).color = Toolbox.makeColor(pItem.getQualityColor());
		kills_text.setValue(pItem.data.kills);
		age_text.setValue(pItem.getAge());
		damage_text.setValue((int)pItem.getFullStats()["damage"]);
		armor_text.setValue((int)pItem.getFullStats()["armor"]);
		durability_text.setValue(pItem.getDurabilityCurrent());
		if (pItem.hasActor())
		{
			((Component)_unit_avatar_element).gameObject.SetActive(true);
			_unit_avatar_element.show(pItem.getActor());
		}
		else if (pItem.hasCity())
		{
			((Component)_banner_city).gameObject.SetActive(true);
			_banner_city.load(pItem.getCity());
		}
		else
		{
			_ownerless.SetActive(true);
		}
	}

	protected override void tooltipAction()
	{
		Tooltip.show(this, "equipment", new TooltipData
		{
			item = meta_object
		});
	}

	private void clear()
	{
		((Component)_unit_avatar_element).gameObject.SetActive(false);
		((Component)_banner_city).gameObject.SetActive(false);
		_ownerless.SetActive(false);
	}
}
// --- End of File: FavoriteItemListElement.cs ---



// --- Start of File: FavoriteItemSpriteSwitcher.cs ---
public class FavoriteItemSpriteSwitcher : SpriteSwitcher
{
	protected override bool hasAny()
	{
		foreach (Item item in World.world.items)
		{
			if (item.isFavorite())
			{
				return true;
			}
		}
		return false;
	}
}
// --- End of File: FavoriteItemSpriteSwitcher.cs ---



// --- Start of File: Favorites.cs ---
using System;
using System.Collections.Generic;
using RSG;

[Serializable]
public class Favorites
{
	public static Dictionary<string, bool> favorites = new Dictionary<string, bool>();

	public static Promise promise;
}
// --- End of File: Favorites.cs ---



// --- Start of File: FavoriteUnitSpriteSwitcher.cs ---
public class FavoriteUnitSpriteSwitcher : SpriteSwitcher
{
	protected override bool hasAny()
	{
		foreach (Actor unit in World.world.units)
		{
			if (unit.isFavorite())
			{
				return true;
			}
		}
		return false;
	}
}
// --- End of File: FavoriteUnitSpriteSwitcher.cs ---



// --- Start of File: FavoriteWorld.cs ---
public static class FavoriteWorld
{
	private const int NO_WORLD_SET = -1;

	private static int _cache_favorite_world_id = -1;

	public static void checkFavoriteWorld()
	{
		if (hasFavoriteWorldSet(pCheck: false) && !SaveManager.slotExists(PlayerConfig.instance.data.favorite_world))
		{
			clearFavoriteWorld();
		}
	}

	public static void clearFavoriteWorld()
	{
		PlayerConfig.instance.data.favorite_world = -1;
		PlayerConfig.saveData();
	}

	public static bool hasFavoriteWorldSet(bool pCheck = true)
	{
		if (pCheck)
		{
			checkFavoriteWorld();
		}
		return PlayerConfig.instance.data.favorite_world != -1;
	}

	public static void restoreCachedFavoriteWorldOnSuccess()
	{
		if (_cache_favorite_world_id != -1)
		{
			PlayerConfig.instance.data.favorite_world = _cache_favorite_world_id;
			PlayerConfig.saveData();
			_cache_favorite_world_id = -1;
		}
	}

	public static void cacheSaveSlotID(int pID)
	{
		_cache_favorite_world_id = pID;
	}
}
// --- End of File: FavoriteWorld.cs ---



// --- Start of File: FieldInfoExtensions.cs ---
using System;
using System.Collections;
using System.Reflection;

public static class FieldInfoExtensions
{
	public static bool isString(this FieldInfo pField)
	{
		return pField.FieldType == typeof(string);
	}

	public static bool isCollection(this FieldInfo pField)
	{
		Type fieldType = pField.FieldType;
		if (pField.isString())
		{
			return false;
		}
		return typeof(ICollection).IsAssignableFrom(fieldType);
	}

	public static bool isEnumerable(this FieldInfo pField)
	{
		Type fieldType = pField.FieldType;
		if (pField.isString())
		{
			return false;
		}
		return typeof(IEnumerable).IsAssignableFrom(fieldType);
	}

	public static bool isCloneable(this FieldInfo pField)
	{
		Type fieldType = pField.FieldType;
		if (pField.isString())
		{
			return false;
		}
		return typeof(ICloneable).IsAssignableFrom(fieldType);
	}
}
// --- End of File: FieldInfoExtensions.cs ---



// --- Start of File: FieldInfoList.cs ---
using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class FieldInfoList : MonoBehaviour
{
	public static string color_null = "#9F9F9F";

	public static string color_white = Toolbox.colorToHex(Color32.op_Implicit(Toolbox.color_white));

	public static string color_string = "#F3961F";

	public static string color_enum = Toolbox.colorToHex(Color32.op_Implicit(Toolbox.color_plague));

	public static string color_type = Toolbox.colorToHex(Color32.op_Implicit(Toolbox.color_yellow));

	public static string color_collection = color_null;

	public static Dictionary<string, string> selected_field_data;

	public KeyValueField field_prefab;

	public InputField search_input_field;

	public Transform fields_transform;

	private ObjectPoolGenericMono<KeyValueField> _pool_fields;

	internal List<FieldInfo> field_infos = new List<FieldInfo>();

	internal Dictionary<string, FieldInfoListItem> fields_collection_data = new Dictionary<string, FieldInfoListItem>();

	public void init<T>() where T : class
	{
		init<T>(null);
	}

	public void init<T>(ListPool<string> pFieldsToLoad) where T : class
	{
		checkInitPool();
		field_infos.Clear();
		fields_collection_data.Clear();
		FieldInfo[] fields = typeof(T).GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic);
		Array.Reverse(fields);
		bool flag = pFieldsToLoad != null && pFieldsToLoad.Count > 0;
		int num = 0;
		FieldInfo[] array = fields;
		foreach (FieldInfo fieldInfo in array)
		{
			if (!flag || pFieldsToLoad.Contains(fieldInfo.Name))
			{
				field_infos.Add(fieldInfo);
				num++;
			}
		}
		if ((Object)(object)search_input_field != (Object)null)
		{
			((UnityEvent<string>)(object)search_input_field.onValueChanged).AddListener((UnityAction<string>)setDataSearched);
		}
	}

	public void checkInitPool()
	{
		if (_pool_fields == null)
		{
			_pool_fields = new ObjectPoolGenericMono<KeyValueField>(field_prefab, fields_transform);
		}
		else
		{
			clear();
		}
	}

	public void setData(object pReference)
	{
		foreach (FieldInfo field_info in field_infos)
		{
			FieldInfoListItem fieldData = getFieldData(field_info, pReference);
			fields_collection_data.Add(fieldData.field_name, fieldData);
			addRow(fieldData.field_name, fieldData.field_value);
		}
	}

	public FieldInfoListItem getFieldData(FieldInfo pField, object pReference)
	{
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_018b: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ae: Unknown result type (might be due to invalid IL or missing references)
		string text = "";
		object value = pField.GetValue(pReference);
		Type fieldType = pField.FieldType;
		Dictionary<string, string> pCollectionData = null;
		if (value != null)
		{
			if (!(value is bool flag))
			{
				if (!(value is string text2))
				{
					if (!(value is int num))
					{
						if (!(value is float pFloat))
						{
							if (!(value is Vector2 val))
							{
								if (!(value is Vector2Int val2))
								{
									if (!(value is Enum arg))
									{
										if (!(value is Array array))
										{
											if (!(value is IList list))
											{
												if (value is IDictionary dictionary)
												{
													pCollectionData = dictionaryToRows(dictionary);
													Type[] genericArguments = fieldType.GetGenericArguments();
													string text3 = Toolbox.coloredText(genericArguments[0].Name, color_type);
													string text4 = Toolbox.coloredText(genericArguments[1].Name, color_type);
													string text5 = Toolbox.coloredText(dictionary.Count.ToString(), color_white);
													text = Toolbox.coloredText("Dictionary<" + text3 + ", " + text4 + ">[" + text5 + "]", color_collection);
												}
												else if (fieldType.IsGenericType && typeof(HashSet<>) == fieldType.GetGenericTypeDefinition())
												{
													pCollectionData = enumerableToRows(value as IEnumerable);
													string text6 = Toolbox.coloredText(fieldType.GetGenericArguments()[0].Name, color_type);
													string text7 = Toolbox.coloredText(fieldType.GetProperty("Count").GetValue(value).ToString(), color_white);
													text = Toolbox.coloredText("HashSet<" + text6 + ">[" + text7 + "]", color_collection);
												}
												else
												{
													text = Toolbox.coloredText(value.GetType().Name, color_type);
												}
											}
											else
											{
												pCollectionData = enumerableToRowsCompacted(list);
												string text8 = Toolbox.coloredText(fieldType.GetGenericArguments()[0].Name, color_type);
												string text9 = Toolbox.coloredText(list.Count.ToString(), color_white);
												text = Toolbox.coloredText("List<" + text8 + ">[" + text9 + "]", color_collection);
											}
										}
										else
										{
											pCollectionData = enumerableToRowsCompacted(array);
											string text10 = Toolbox.coloredText(fieldType.GetElementType().Name, color_type);
											string text11 = Toolbox.coloredText(array.Length.ToString(), color_white);
											text = Toolbox.coloredText("Array<" + text10 + ">[" + text11 + "]", color_collection);
										}
									}
									else
									{
										text = Toolbox.coloredText($"{fieldType.Name}.{arg}", color_enum);
									}
								}
								else
								{
									string text12 = Toolbox.coloredText(((Vector2Int)(ref val2)).x.ToText(), color_white);
									string text13 = Toolbox.coloredText(((Vector2Int)(ref val2)).y.ToText(), color_white);
									text = Toolbox.coloredText("Vector2Int(" + text12 + ", " + text13 + ")", color_collection);
								}
							}
							else
							{
								string text14 = Toolbox.coloredText(val.x.ToText() + "f", color_white);
								string text15 = Toolbox.coloredText(val.y.ToText() + "f", color_white);
								text = Toolbox.coloredText("Vector2(" + text14 + ", " + text15 + ")", color_collection);
							}
						}
						else
						{
							text = Toolbox.coloredText(pFloat.ToText() + "f", color_white);
						}
					}
					else
					{
						text = Toolbox.coloredText($"{num}", color_white);
					}
				}
				else
				{
					string text16 = Toolbox.coloredText("\"", color_null);
					text = Toolbox.coloredText(text16 + text2 + text16, color_string);
				}
			}
			else
			{
				text = Toolbox.coloredText($"{flag}", flag ? "#43FF43" : "#FB2C21");
			}
		}
		else
		{
			text = Toolbox.coloredText("", color_null);
		}
		return new FieldInfoListItem(pField.Name, text, pCollectionData);
	}

	public KeyValueField addRow(string pName, string pValue)
	{
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Expected O, but got Unknown
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Expected O, but got Unknown
		KeyValueField next = _pool_fields.getNext();
		next.name_text.text = pName;
		next.value.text = pValue;
		if (fields_collection_data.TryGetValue(pName, out var value))
		{
			Dictionary<string, string> tCollectionContent = value.collection_data;
			if (tCollectionContent == null || tCollectionContent.Count == 0)
			{
				((Behaviour)((Component)next.value).GetComponent<TipButton>()).enabled = false;
			}
			else
			{
				((Behaviour)((Component)next.value).GetComponent<TipButton>()).enabled = true;
				next.on_hover_value = (UnityAction)delegate
				{
					selected_field_data = tCollectionContent;
				};
				next.on_hover_value_out = new UnityAction(Tooltip.hideTooltip);
			}
		}
		return next;
	}

	internal void setDataSearched(string pValue)
	{
		clear();
		pValue = pValue.ToLower();
		if (string.IsNullOrEmpty(pValue))
		{
			int num = 0;
			{
				foreach (FieldInfoListItem value in fields_collection_data.Values)
				{
					KeyValueField pComponent = addRow(value.field_name, value.field_value);
					setOddEvenColor(pComponent, num);
					num++;
				}
				return;
			}
		}
		int num2 = 0;
		foreach (FieldInfoListItem value2 in fields_collection_data.Values)
		{
			if (value2.field_name.ToLower().Contains(pValue))
			{
				KeyValueField pComponent2 = addRow(value2.field_name, value2.field_value);
				setOddEvenColor(pComponent2, num2);
				num2++;
			}
		}
	}

	private void setOddEvenColor(KeyValueField pComponent, int pIndex)
	{
		if (pIndex % 2 == 0)
		{
			pComponent.setEvenColor();
		}
		else
		{
			pComponent.setOddColor();
		}
	}

	private Dictionary<string, string> enumerableToRowsCompacted(IEnumerable pEnumerable)
	{
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		Dictionary<string, int> dictionary = new Dictionary<string, int>();
		int num = 0;
		foreach (object item in pEnumerable)
		{
			string key = item.ToString();
			if (dictionary.ContainsKey(key))
			{
				dictionary[key]++;
				continue;
			}
			dictionary.Add(key, 1);
			num++;
		}
		string pColor = Toolbox.colorToHex(Color32.op_Implicit(Toolbox.color_yellow));
		Dictionary<string, string> dictionary2 = new Dictionary<string, string>();
		int num2 = 0;
		foreach (KeyValuePair<string, int> item2 in dictionary)
		{
			string text = item2.Value.ToString();
			dictionary2.Add(item2.Key + "    ", Toolbox.coloredText("x      " + text, pColor));
			num2++;
		}
		return dictionary2;
	}

	private Dictionary<string, string> enumerableToRows(IEnumerable pEnumerable)
	{
		Dictionary<string, string> dictionary = new Dictionary<string, string>();
		int num = 0;
		foreach (object item in pEnumerable)
		{
			dictionary.Add($"[{num}]     ", item.ToString());
			num++;
		}
		return dictionary;
	}

	private Dictionary<string, string> dictionaryToRows(IDictionary pDictionary)
	{
		Dictionary<string, string> dictionary = new Dictionary<string, string>();
		foreach (object key in pDictionary.Keys)
		{
			dictionary.Add($"[\"{key}\"]", pDictionary[key].ToString());
		}
		return dictionary;
	}

	public void clear()
	{
		_pool_fields.clear();
	}
}
// --- End of File: FieldInfoList.cs ---



// --- Start of File: FieldInfoListItem.cs ---
using System.Collections.Generic;

public class FieldInfoListItem
{
	public string field_name;

	public string field_value;

	public Dictionary<string, string> collection_data;

	public FieldInfoListItem(string pName, string pValue, Dictionary<string, string> pCollectionData = null)
	{
		field_name = pName;
		field_value = pValue;
		collection_data = pCollectionData;
	}
}
// --- End of File: FieldInfoListItem.cs ---



// --- Start of File: Finder.cs ---
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using ai.behaviours;

public static class Finder
{
	private static readonly List<BaseSimObject> _list_objects = new List<BaseSimObject>(4096);

	private static MapChunk[] _chunks;

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static IEnumerable<Building> getBuildingsFromChunk(WorldTile pTile, int pChunkRadius, int pTileRadius = 0, bool pRandom = false)
	{
		int num = pTile.chunk.x - pChunkRadius;
		int num2 = pTile.chunk.y - pChunkRadius;
		int num3 = pChunkRadius * 2 + 1;
		int num4 = pChunkRadius * 2 + 1;
		int num5 = num3 * num4;
		MapChunk[] array = (_chunks = Toolbox.checkArraySize(_chunks, num5));
		MapChunkManager map_chunk_manager = World.world.map_chunk_manager;
		int tTileRadius = pTileRadius * pTileRadius;
		int num6 = 0;
		for (int j = 0; j < num3; j++)
		{
			for (int k = 0; k < num4; k++)
			{
				MapChunk mapChunk = map_chunk_manager.get(num + j, num2 + k);
				if (mapChunk == null)
				{
					num5--;
				}
				else
				{
					array[num6++] = mapChunk;
				}
			}
		}
		if (pRandom)
		{
			foreach (MapChunk item in array.LoopRandom(num5))
			{
				if (item == null)
				{
					continue;
				}
				List<Building> buildings_all = item.objects.buildings_all;
				foreach (Building item2 in buildings_all.LoopRandom())
				{
					if (item2.isAlive() && (tTileRadius == 0 || Toolbox.SquaredDistTile(item2.current_tile, pTile) <= tTileRadius))
					{
						yield return item2;
					}
				}
			}
			yield break;
		}
		foreach (MapChunk item3 in array.LoopRandom(num5))
		{
			if (item3 == null)
			{
				continue;
			}
			List<Building> tBuildings = item3.objects.buildings_all;
			int i = 0;
			for (int tLen = tBuildings.Count; i < tLen; i++)
			{
				Building building = tBuildings[i];
				if (building.isAlive() && (tTileRadius == 0 || Toolbox.SquaredDistTile(building.current_tile, pTile) <= tTileRadius))
				{
					yield return building;
				}
			}
		}
	}

	public static bool isEnemyNearOnSameIsland(Actor pActor, int pChunkRadius = 1)
	{
		foreach (Actor item in getUnitsFromChunk(pActor.current_tile, pChunkRadius))
		{
			if (pActor.isOnSameIsland(item) && item.kingdom.isEnemy(pActor.kingdom))
			{
				return true;
			}
		}
		return false;
	}

	public static bool isEnemyNearOnSameIslandAndCarnivore(Actor pActor, int pChunkRadius = 1)
	{
		foreach (Actor item in getUnitsFromChunk(pActor.current_tile, pChunkRadius))
		{
			if (pActor.isOnSameIsland(item))
			{
				if (item.isCarnivore())
				{
					return true;
				}
				if (item.kingdom.isEnemy(pActor.kingdom))
				{
					return true;
				}
			}
		}
		return false;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static IEnumerable<Actor> getUnitsFromChunk(WorldTile pTile, int pChunkRadius, float pTileRadius = 0f, bool pRandom = false)
	{
		int num = pTile.chunk.x - pChunkRadius;
		int num2 = pTile.chunk.y - pChunkRadius;
		int num3 = pChunkRadius * 2 + 1;
		int num4 = pChunkRadius * 2 + 1;
		int num5 = num3 * num4;
		MapChunk[] array = (_chunks = Toolbox.checkArraySize(_chunks, num5));
		MapChunkManager map_chunk_manager = World.world.map_chunk_manager;
		float tTileRadius = pTileRadius * pTileRadius;
		int num6 = 0;
		for (int j = 0; j < num3; j++)
		{
			for (int k = 0; k < num4; k++)
			{
				MapChunk mapChunk = map_chunk_manager.get(num + j, num2 + k);
				if (mapChunk == null)
				{
					num5--;
				}
				else
				{
					array[num6++] = mapChunk;
				}
			}
		}
		if (pRandom)
		{
			foreach (MapChunk item in array.LoopRandom(num5))
			{
				if (item == null)
				{
					continue;
				}
				List<Actor> units_all = item.objects.units_all;
				foreach (Actor item2 in units_all.LoopRandom())
				{
					if (item2.isAlive() && (tTileRadius == 0f || !((float)Toolbox.SquaredDistTile(item2.current_tile, pTile) > tTileRadius)))
					{
						yield return item2;
					}
				}
			}
			yield break;
		}
		foreach (MapChunk item3 in array.LoopRandom(num5))
		{
			if (item3 == null)
			{
				continue;
			}
			List<Actor> tUnits = item3.objects.units_all;
			int i = 0;
			for (int tLen = tUnits.Count; i < tLen; i++)
			{
				Actor actor = tUnits[i];
				if (actor.isAlive() && (tTileRadius == 0f || !((float)Toolbox.SquaredDistTile(actor.current_tile, pTile) > tTileRadius)))
				{
					yield return actor;
				}
			}
		}
	}

	public static List<BaseSimObject> getAllObjectsInChunks(WorldTile pTile, int pTileRadius = 3)
	{
		List<BaseSimObject> list_objects = _list_objects;
		list_objects.Clear();
		fillAllObjectsFromChunk(pTile.chunk, pTile, pTileRadius, list_objects);
		MapChunk[] neighbours = pTile.chunk.neighbours;
		for (int i = 0; i < neighbours.Length; i++)
		{
			fillAllObjectsFromChunk(neighbours[i], pTile, pTileRadius, list_objects);
		}
		return list_objects;
	}

	private static void fillAllObjectsFromChunk(MapChunk pChunk, WorldTile pTile, int pTileRadius, List<BaseSimObject> pListObjects)
	{
		int num = pTileRadius * pTileRadius;
		List<long> kingdoms = pChunk.objects.kingdoms;
		for (int i = 0; i < kingdoms.Count; i++)
		{
			long pKingdom = kingdoms[i];
			List<Actor> units = pChunk.objects.getUnits(pKingdom);
			for (int j = 0; j < units.Count; j++)
			{
				BaseSimObject baseSimObject = units[j];
				if (baseSimObject.isAlive() && (pTileRadius == 0 || Toolbox.SquaredDistTile(baseSimObject.current_tile, pTile) <= num))
				{
					pListObjects.Add(baseSimObject);
				}
			}
			List<Building> buildings = pChunk.objects.getBuildings(pKingdom);
			for (int k = 0; k < buildings.Count; k++)
			{
				BaseSimObject baseSimObject2 = buildings[k];
				if (baseSimObject2.isAlive() && (pTileRadius == 0 || Toolbox.SquaredDistTile(baseSimObject2.current_tile, pTile) <= num))
				{
					pListObjects.Add(baseSimObject2);
				}
			}
		}
	}

	internal static IEnumerable<Actor> findSpeciesAroundTileChunk(WorldTile pTile, string pUnitID)
	{
		foreach (Actor item in getUnitsFromChunk(pTile, 1))
		{
			if (!(item.a.asset.id != pUnitID))
			{
				yield return item;
			}
		}
	}

	public static Building getClosestBuildingFrom(Actor pActor, IReadOnlyCollection<Building> pBuildingList)
	{
		return getClosestBuildingFrom(pActor.current_tile, pBuildingList);
	}

	public static Building getClosestBuildingFrom(WorldTile pTile, IReadOnlyCollection<Building> pBuildingList)
	{
		Building result = null;
		float num = float.MaxValue;
		foreach (Building pBuilding in pBuildingList)
		{
			if (!pBuilding.isRekt() && pBuilding.current_tile.isSameIsland(pTile))
			{
				float num2 = Toolbox.SquaredDistTile(pBuilding.current_tile, pTile);
				if (num2 < num)
				{
					result = pBuilding;
					num = num2;
				}
			}
		}
		return result;
	}

	public static void clear()
	{
		_list_objects.Clear();
	}

	public static WorldTile findTileInChunk(WorldTile pTile, TileFinderType pTileType)
	{
		var (array, pLength) = Toolbox.getAllChunksFromTile(pTile);
		foreach (MapChunk item in array.LoopRandom(pLength))
		{
			foreach (MapRegion item2 in item.regions.LoopRandom())
			{
				foreach (WorldTile item3 in item2.tiles.LoopRandom())
				{
					switch (pTileType)
					{
					case TileFinderType.FreeTile:
						if (!item3.isSameIsland(pTile) || item3.hasBuilding() || !item3.Type.ground)
						{
							continue;
						}
						break;
					case TileFinderType.Sand:
						if (!item3.Type.sand)
						{
							continue;
						}
						break;
					case TileFinderType.Water:
						if (item3.isTargeted() || !item3.Type.ocean)
						{
							continue;
						}
						break;
					case TileFinderType.Grass:
						if (!item3.isSameIsland(pTile) || item3.isTargeted() || !item3.Type.grass || item3.hasBuilding())
						{
							continue;
						}
						break;
					case TileFinderType.Dirt:
						if (!item3.isSameIsland(pTile) || item3.isTargeted() || !item3.Type.can_be_farm || item3.hasBuilding())
						{
							continue;
						}
						break;
					case TileFinderType.Biome:
						if (!item3.isSameIsland(pTile) || item3.isTargeted() || !item3.Type.is_biome || item3.hasBuilding())
						{
							continue;
						}
						break;
					default:
						if (!item3.isSameIsland(pTile))
						{
							continue;
						}
						break;
					}
					return item3;
				}
			}
		}
		return null;
	}
}
// --- End of File: Finder.cs ---



// --- Start of File: FingerTarget.cs ---
internal enum FingerTarget
{
	None,
	Water,
	Ground
}
// --- End of File: FingerTarget.cs ---



// --- Start of File: FireLayer.cs ---
using UnityEngine;

public class FireLayer : MapLayer
{
	internal override void create()
	{
		base.create();
	}

	public void setTileDirty(WorldTile pTile)
	{
		if (!pixels_to_update.Contains(pTile))
		{
			pixels_to_update.Add(pTile);
		}
	}

	protected override void checkAutoDisable()
	{
		bool flag = WorldBehaviourActionFire.hasFires();
		if (!MapBox.isRenderMiniMap())
		{
			flag = false;
		}
		if (flag)
		{
			if (!((Renderer)sprRnd).enabled)
			{
				((Renderer)sprRnd).enabled = true;
			}
		}
		else if (((Renderer)sprRnd).enabled)
		{
			((Renderer)sprRnd).enabled = false;
		}
	}

	protected override void UpdateDirty(float pElapsed)
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		if (pixels_to_update.Count <= 0)
		{
			return;
		}
		Color val = Color32.op_Implicit(Toolbox.color_fire);
		foreach (WorldTile item in pixels_to_update)
		{
			if (item.isOnFire())
			{
				float worldTimeElapsedSince = World.world.getWorldTimeElapsedSince(item.data.fire_timestamp);
				val.a = 0.5f + (1f - worldTimeElapsedSince / SimGlobals.m.fire_stop_time);
				pixels[item.data.tile_id] = Color32.op_Implicit(val);
			}
			else
			{
				pixels[item.data.tile_id] = Toolbox.clear;
			}
		}
		pixels_to_update.Clear();
		updatePixels();
	}
}
// --- End of File: FireLayer.cs ---



// --- Start of File: Fireworks.cs ---
using UnityEngine;

public class Fireworks : BaseEffect
{
	internal override void spawnOnTile(WorldTile pTile)
	{
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		float pScale = Randy.randomFloat(0.3f, 1f);
		prepare(pTile, pScale);
		if (Randy.randomBool())
		{
			loadSprites("effects/fireworks1");
		}
		else
		{
			loadSprites("effects/fireworks2");
		}
		sprite_renderer.flipX = Randy.randomBool();
		Color color = default(Color);
		color.a = 1f;
		color.r = Randy.randomFloat(0f, 1f);
		color.b = Randy.randomFloat(0f, 1f);
		color.g = Randy.randomFloat(0f, 1f);
		sprite_renderer.color = color;
		float num = Randy.randomFloat(-15f, 15f);
		((Component)this).transform.localEulerAngles = new Vector3(0f, 0f, num);
	}

	private void loadSprites(string pPath)
	{
		Sprite[] spriteList = SpriteTextureLoader.getSpriteList(pPath);
		sprite_animation.frames = spriteList;
	}
}
// --- End of File: Fireworks.cs ---



// --- Start of File: FlexibleOneRowGrid.cs ---
using System.Collections.Generic;
using LayoutGroupExt;
using UnityEngine;
using UnityEngine.Pool;
using UnityEngine.UI;

[DisallowMultipleComponent]
public class FlexibleOneRowGrid : MonoBehaviour, ILayoutController
{
	public bool debug;

	public int bonus_spacing_x;

	private RectTransform _grid_rect;

	private GridLayoutGroup _grid;

	private GridLayoutGroupExtended _grid_extended;

	private bool _is_extended;

	private bool _initialized;

	private void Awake()
	{
		init();
	}

	private void init()
	{
		if (!_initialized)
		{
			_initialized = true;
			if (((Component)(object)this).HasComponent<GridLayoutGroup>())
			{
				_grid = ((Component)this).GetComponent<GridLayoutGroup>();
				_grid_rect = ((Component)_grid).GetComponent<RectTransform>();
			}
			else
			{
				_grid_extended = ((Component)this).GetComponent<GridLayoutGroupExtended>();
				_grid_rect = ((Component)_grid_extended).GetComponent<RectTransform>();
				_is_extended = true;
			}
		}
	}

	public void SetLayoutHorizontal()
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		if (debug || Application.isPlaying)
		{
			init();
			float num = (_is_extended ? _grid_extended.cellSize.x : _grid.cellSize.x);
			Rect rect = _grid_rect.rect;
			float width = ((Rect)(ref rect)).width;
			float num2 = calculateChildren();
			float num3 = 0f;
			float num4 = num * num2 + (float)bonus_spacing_x * (num2 - 1f);
			if (num4 < width)
			{
				num3 = bonus_spacing_x;
			}
			else
			{
				num4 = num * num2;
				num3 = (width - num4) / (num2 - 1f);
			}
			if (_is_extended)
			{
				_grid_extended.spacing = new Vector2(num3, 0f);
			}
			else
			{
				_grid.spacing = new Vector2(num3, 0f);
			}
		}
	}

	public float calculateChildren()
	{
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		List<Component> list = CollectionPool<List<Component>, Component>.Get();
		int num = 0;
		int i = 0;
		for (int childCount = ((Transform)_grid_rect).childCount; i < childCount; i++)
		{
			Transform child = ((Transform)_grid_rect).GetChild(i);
			RectTransform val = (RectTransform)(object)((child is RectTransform) ? child : null);
			if ((Object)(object)val == (Object)null || !((Component)val).gameObject.activeInHierarchy)
			{
				continue;
			}
			if (!((Component)(object)val).HasComponent<ILayoutIgnorer>())
			{
				num++;
				continue;
			}
			((Component)val).GetComponents(typeof(ILayoutIgnorer), list);
			for (int j = 0; j < list.Count; j++)
			{
				if (!((ILayoutIgnorer)list[j]).ignoreLayout)
				{
					num++;
					break;
				}
			}
			list.Clear();
		}
		CollectionPool<List<Component>, Component>.Release(list);
		return num;
	}

	public void SetLayoutVertical()
	{
	}
}
// --- End of File: FlexibleOneRowGrid.cs ---



// --- Start of File: FloraSize.cs ---
public enum FloraSize
{
	Tiny,
	Small,
	Big
}
// --- End of File: FloraSize.cs ---



// --- Start of File: FloraType.cs ---
public enum FloraType
{
	None,
	Tree,
	Fungi,
	Plant
}
// --- End of File: FloraType.cs ---



// --- Start of File: FmodAction.cs ---
public delegate void FmodAction();
// --- End of File: FmodAction.cs ---



// --- Start of File: FontGetter.cs ---
using UnityEngine;

public delegate Font FontGetter();
// --- End of File: FontGetter.cs ---



// --- Start of File: ForcedFontStyle.cs ---
using System;
using UnityEngine;

[Serializable]
public class ForcedFontStyle
{
	public FontStyle style;

	public bool shadow;

	public ForcedFontStyle(FontStyle pStyle, bool pShadow = false)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		style = pStyle;
		shadow = pShadow;
	}
}
// --- End of File: ForcedFontStyle.cs ---



// --- Start of File: ForgotPasswordButton.cs ---
using UnityEngine;
using UnityEngine.UI;

public class ForgotPasswordButton : MonoBehaviour
{
	public GameObject emailBG;

	public InputField emailInput;

	public Text statusMessage;

	public Button continueButton;

	private Button forgotPasswordButton;

	private bool checking;

	private void OnEnable()
	{
		if (Config.game_loaded)
		{
			newStatus("");
			((Component)emailInput).gameObject.SetActive(true);
			emailBG.gameObject.SetActive(true);
			((Component)continueButton).gameObject.SetActive(false);
			((Component)this).gameObject.SetActive(true);
			forgotPasswordButton = ((Component)this).gameObject.GetComponent<Button>();
			checking = false;
		}
	}

	public void resetPassword()
	{
		checking = true;
		clearStatus();
	}

	private void Update()
	{
		((Selectable)forgotPasswordButton).interactable = !checking;
	}

	private void newStatus(string pMessage)
	{
		Debug.Log((object)("new status " + pMessage));
		if (LocalizedTextManager.stringExists(pMessage))
		{
			((Component)statusMessage).GetComponent<LocalizedText>().key = pMessage;
			((Component)statusMessage).GetComponent<LocalizedText>().updateText();
		}
		else
		{
			statusMessage.text = pMessage;
		}
	}

	private void clearStatus()
	{
		newStatus("");
	}
}
// --- End of File: ForgotPasswordButton.cs ---



// --- Start of File: FPS.cs ---
using System.Collections.Generic;
using UnityEngine;

public static class FPS
{
	private static float _delta_time;

	private static float _frame_count;

	private static float _update_rate = 3f;

	private static int _fps;

	private const int DEBUG_FPS_THRESHOLD = 25;

	private static List<int> _last_fps = new List<int>(5);

	public static int fps => _fps;

	public static string getFPS()
	{
		if (_fps >= 60)
		{
			return "<color=#75D53A>" + _fps + "</color>";
		}
		if (_fps >= 30)
		{
			return "<color=#F4E700>" + _fps + "</color>";
		}
		return "<color=#DB2920>" + _fps + "</color>";
	}

	public static void update()
	{
		_delta_time += Time.unscaledDeltaTime;
		_frame_count += 1f;
		if (_delta_time > 1f / _update_rate)
		{
			_fps = (int)(_frame_count / _delta_time);
			_delta_time = 0f;
			_frame_count = 0f;
		}
	}

	public static void debug_update()
	{
		if (Config.game_loaded && !SmoothLoader.isLoading() && _last_fps.Count < 5)
		{
			if (_fps >= 25)
			{
				_last_fps.Clear();
			}
			_last_fps.Add(_fps);
			if (Config.editor_mastef && _last_fps.Count >= 5)
			{
				DebugConfig.createTool(AssetManager.debug_tool_library.get("Benchmark All").id, 30);
				DebugConfig.createTool(AssetManager.debug_tool_library.get("Benchmark Actors").id, 200);
			}
		}
	}
}
// --- End of File: FPS.cs ---



// --- Start of File: FSoundTimer.cs ---
internal class FSoundTimer
{
	public float timer;
}
// --- End of File: FSoundTimer.cs ---



// --- Start of File: GameLanguageAsset.cs ---
using System;
using System.Collections.Generic;
using Newtonsoft.Json;
using UnityEngine;

[Serializable]
public class GameLanguageAsset : Asset
{
	public string name;

	public bool main;

	public bool export = true;

	public bool is_rtl;

	public bool is_hanzi;

	public bool is_hindi;

	public bool debug_only;

	public string path_icon;

	public bool show_translators = true;

	public FontGetter font = () => LocalizedTextManager.instance.default_font;

	public ForcedFontStyle force_style;

	private Dictionary<string, Dictionary<string, string>> _translations;

	private static Dictionary<string, GameLanguageData> _language_data;

	[JsonIgnore]
	public Dictionary<string, Dictionary<string, string>> translations
	{
		get
		{
			if (_translations == null)
			{
				_translations = new Dictionary<string, Dictionary<string, string>>();
				TextAsset[] array = Resources.LoadAll<TextAsset>("locales/" + id);
				foreach (TextAsset obj in array)
				{
					string text = obj.text;
					string key = ((Object)obj).name;
					Dictionary<string, string> value = JsonConvert.DeserializeObject<Dictionary<string, string>>(text);
					_translations[key] = value;
				}
			}
			return _translations;
		}
	}

	public IEnumerable<string> getGroups()
	{
		return translations.Keys;
	}

	public GameLanguageData getLanguageData()
	{
		if (_language_data == null)
		{
			TextAsset val = Resources.Load<TextAsset>("texts/tooltip_translators");
			if ((Object)(object)val == (Object)null)
			{
				Debug.LogError((object)("No tooltip translators found for language: " + id));
				return null;
			}
			_language_data = JsonConvert.DeserializeObject<Dictionary<string, GameLanguageData>>(val.text);
		}
		_language_data.TryGetValue(id, out var value);
		return value;
	}

	public bool isRTL()
	{
		return is_rtl;
	}

	public bool isHanzi()
	{
		return is_hanzi;
	}

	public bool isHindi()
	{
		return is_hindi;
	}

	public bool hasForcedStyle()
	{
		return force_style != null;
	}
}
// --- End of File: GameLanguageAsset.cs ---



// --- Start of File: GameLanguageData.cs ---
using System;

[Serializable]
public class GameLanguageData
{
	public string language;

	public string[] active;

	public string[] inactive;
}
// --- End of File: GameLanguageData.cs ---



// --- Start of File: GameLanguageLibrary.cs ---
using UnityEngine;

public class GameLanguageLibrary : AssetLibrary<GameLanguageAsset>
{
	public override void init()
	{
		base.init();
		add("en", "English");
		t.main = true;
		add("de", "Deutsch");
		add("pl", "Polski");
		add("cz", "()");
		t.is_hanzi = true;
		t.force_style = new ForcedFontStyle((FontStyle)0, pShadow: true);
		t.font = () => LocalizedTextManager.instance.simplified_chinese_font;
		add("ch", "()");
		t.is_hanzi = true;
		t.force_style = new ForcedFontStyle((FontStyle)0, pShadow: true);
		add("ko", "");
		t.font = () => LocalizedTextManager.instance.korean_font;
		add("ja", "");
		t.is_hanzi = true;
		t.force_style = new ForcedFontStyle((FontStyle)0, pShadow: true);
		t.font = () => LocalizedTextManager.instance.japanese_font;
		add("th", "");
		t.font = () => LocalizedTextManager.instance.thai_font;
		add("vn", "Ting Vit");
		add("ru", "");
		t.show_translators = false;
		add("ua", "");
		add("by", "");
		add("es", "Espaol");
		add("br", "Portugus do Brasil");
		add("pt", "Portugus de Portugal");
		add("fr", "Franais");
		add("it", "Italiano");
		add("ro", "Romn");
		add("hr", "Hrvatski");
		add("tr", "Trke");
		add("gr", "");
		add("ka", "");
		t.font = () => LocalizedTextManager.instance.arabic_font;
		add("sk", "Slovenina");
		add("cs", "etina");
		add("hu", "Magyar");
		add("nl", "Nederlands");
		add("id", "Bahasa Indonesia");
		add("sv", "Svenska");
		add("no", "Norsk");
		add("da", "Dansk");
		add("fa", "");
		t.is_rtl = true;
		t.font = () => LocalizedTextManager.instance.persian_font;
		add("ar", "");
		t.is_rtl = true;
		t.font = () => LocalizedTextManager.instance.arabic_font;
		add("he", "\u05b4\u05b4");
		t.is_rtl = true;
		add("fn", "Suomi");
		add("ph", "Tagalog");
		add("hi", "\u093f\u094d\u0940");
		t.is_hindi = true;
		t.font = () => LocalizedTextManager.instance.hindi_font;
		t.force_style = new ForcedFontStyle((FontStyle)1);
		add("lb", "Ltzebuergesch");
		add("lt", "Lithuanian");
		add(new GameLanguageAsset
		{
			id = "boat",
			name = "Boat",
			export = false,
			path_icon = "ui/Icons/iconSeaborn"
		});
		add(new GameLanguageAsset
		{
			id = "keys",
			name = "KEYS",
			export = false,
			debug_only = true,
			path_icon = "ui/Icons/iconDebug"
		});
	}

	public GameLanguageAsset add(string pID, string pName)
	{
		return add(new GameLanguageAsset
		{
			id = pID,
			name = pName
		});
	}
}
// --- End of File: GameLanguageLibrary.cs ---



// --- Start of File: GameLoadedEvent.cs ---
using System;
using Proyecto26;
using UnityEngine;

public class GameLoadedEvent : BaseMapObject
{
	private void Awake()
	{
		LogText.log("GameLoadedEvent", "Awake", "st");
		LogText.log("GameLoadedEvent", "Awake", "en");
		setVersionData();
	}

	private void setVersionData()
	{
		Object obj = Resources.Load("texts/build_info");
		TextAsset val = (TextAsset)(object)((obj is TextAsset) ? obj : null);
		try
		{
			Config.versionCodeText = val.text.Split('$')[0];
			Config.versionCodeDate = val.text.Split('$')[1];
		}
		catch (Exception)
		{
			if ((Object)(object)val != (Object)null)
			{
				Config.versionCodeText = val.text;
				Config.versionCodeDate = "";
			}
		}
		try
		{
			RestClient.DefaultRequestHeaders["wb-build"] = Config.versionCodeText ?? "na";
		}
		catch (Exception)
		{
		}
		try
		{
			Object obj2 = Resources.Load("texts/git_info");
			TextAsset val2 = (TextAsset)(object)((obj2 is TextAsset) ? obj2 : null);
			if ((Object)(object)val2 != (Object)null)
			{
				Config.gitCodeText = val2.text;
			}
			try
			{
				RestClient.DefaultRequestHeaders["wb-git"] = Config.gitCodeText ?? "na";
			}
			catch (Exception)
			{
			}
		}
		catch (Exception ex4)
		{
			Debug.Log((object)ex4);
		}
	}

	internal override void create()
	{
		base.create();
		Config.LOAD_TIME_INIT = Time.realtimeSinceStartup;
		LogText.log("GameLoadedEvent", "create");
		LocalizedTextManager.instance.setLanguage(PlayerConfig.dict["language"].stringVal);
		if (Globals.TRAILER_MODE)
		{
			TrailerModeSettings.startEvent();
		}
		World.world.startTheGame();
		GodPower.diagnostic();
		Config.updateCrashMetadata();
	}
}
// --- End of File: GameLoadedEvent.cs ---



// --- Start of File: GameObjectExtensions.cs ---
using UnityEngine;

public static class GameObjectExtensions
{
	public static T AddOrGetComponent<T>(this GameObject pGameObject) where T : Component
	{
		T result = default(T);
		if (!pGameObject.TryGetComponent<T>(ref result))
		{
			return pGameObject.AddComponent<T>();
		}
		return result;
	}

	public static bool HasComponent<T>(this GameObject pGameObject)
	{
		T val = default(T);
		return pGameObject.TryGetComponent<T>(ref val);
	}

	public static bool HasComponent<T>(this Component pComponent)
	{
		return pComponent.gameObject.HasComponent<T>();
	}

	public static T AddComponent<T>(this Component pComponent) where T : Component
	{
		return pComponent.gameObject.AddComponent<T>();
	}
}
// --- End of File: GameObjectExtensions.cs ---



// --- Start of File: GameObjectZSorter.cs ---
using UnityEngine;

public class GameObjectZSorter : MonoBehaviour
{
	public GameObject zParent;

	public float z_order_offset;

	private void Start()
	{
	}
}
// --- End of File: GameObjectZSorter.cs ---



// --- Start of File: GameplayReportData.cs ---
using System.Collections.Generic;

internal class GameplayReportData
{
	public int usages_actors;

	public int usages_biomes;

	public int usages_food;

	public List<string> owners = new List<string>();

	public List<string> biomes = new List<string>();

	public List<string> food = new List<string>();
}
// --- End of File: GameplayReportData.cs ---



// --- Start of File: GameplayReportGenerator.cs ---
public static class GameplayReportGenerator
{
}
// --- End of File: GameplayReportGenerator.cs ---



// --- Start of File: GameProgress.cs ---
using System;
using System.Collections.Generic;
using System.IO;
using Newtonsoft.Json;
using UnityEngine;

public class GameProgress
{
	public static GameProgress instance;

	private string dataPath;

	internal GameProgressData data;

	public static void init()
	{
		if (instance == null)
		{
			Debug.Log((object)"INIT Progress");
			instance = new GameProgress();
			instance.create();
		}
	}

	public void create()
	{
		setNewDataPath();
		if (File.Exists(dataPath))
		{
			try
			{
				loadData();
				return;
			}
			catch (Exception)
			{
				initNewSave();
				return;
			}
		}
		initNewSave();
	}

	private void setNewDataPath()
	{
		dataPath = Application.persistentDataPath + "/worldboxProgress";
	}

	private void initNewSave()
	{
		data = new GameProgressData();
		saveData();
	}

	public static bool unlockAchievement(string pName)
	{
		if (instance == null)
		{
			return false;
		}
		if (string.IsNullOrEmpty(pName))
		{
			return false;
		}
		if (isAchievementUnlocked(pName))
		{
			return false;
		}
		instance.data.achievements.Add(pName);
		saveData();
		return true;
	}

	public static bool isAchievementUnlocked(string pName)
	{
		if (instance == null)
		{
			return false;
		}
		return instance.data.achievements.Contains(pName);
	}

	public static void saveData()
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Expected O, but got Unknown
		JsonSerializerSettings val = new JsonSerializerSettings
		{
			DefaultValueHandling = (DefaultValueHandling)3,
			Formatting = (Formatting)1
		};
		string pStringData = Toolbox.encode(JsonConvert.SerializeObject((object)instance.data, val));
		Toolbox.WriteSafely("Game Progress", instance.dataPath, ref pStringData);
	}

	private void loadData()
	{
		if (!File.Exists(dataPath))
		{
			return;
		}
		string text = File.ReadAllText(dataPath);
		try
		{
			string text2 = Toolbox.decode(text);
			if (!string.IsNullOrEmpty(text2))
			{
				text = text2;
			}
		}
		catch (Exception)
		{
		}
		try
		{
			data = JsonConvert.DeserializeObject<GameProgressData>(text);
			data.setDefaultValues();
		}
		catch (Exception ex2)
		{
			Debug.LogError((object)("Error loading game progress data from " + dataPath));
			Debug.LogError((object)ex2);
			initNewSave();
		}
	}

	public void debugClearAllAchievements()
	{
		data.achievements.Clear();
		saveData();
	}

	public void unlockAllAchievements()
	{
		foreach (Achievement item in AssetManager.achievements.list)
		{
			unlockAchievement(item.id);
		}
	}

	public void debugClearAll()
	{
		data.prepare();
		foreach (HashSet<string> all_hashset in data.all_hashsets)
		{
			all_hashset.Clear();
		}
		saveData();
	}

	public void debugUnlockAll()
	{
		foreach (ActorTrait item in AssetManager.traits.list)
		{
			item.unlock(pSaveData: false);
		}
		foreach (CultureTrait item2 in AssetManager.culture_traits.list)
		{
			item2.unlock(pSaveData: false);
		}
		foreach (LanguageTrait item3 in AssetManager.language_traits.list)
		{
			item3.unlock(pSaveData: false);
		}
		foreach (SubspeciesTrait item4 in AssetManager.subspecies_traits.list)
		{
			item4.unlock(pSaveData: false);
		}
		foreach (ClanTrait item5 in AssetManager.clan_traits.list)
		{
			item5.unlock(pSaveData: false);
		}
		foreach (ReligionTrait item6 in AssetManager.religion_traits.list)
		{
			item6.unlock(pSaveData: false);
		}
		foreach (KingdomTrait item7 in AssetManager.kingdoms_traits.list)
		{
			item7.unlock(pSaveData: false);
		}
		foreach (EquipmentAsset item8 in AssetManager.items.list)
		{
			item8.unlock(pSaveData: false);
		}
		foreach (GeneAsset item9 in AssetManager.gene_library.list)
		{
			item9.unlock(pSaveData: false);
		}
		foreach (ActorAsset item10 in AssetManager.actor_library.list)
		{
			item10.unlock(pSaveData: false);
		}
		foreach (PlotAsset item11 in AssetManager.plots_library.list)
		{
			item11.unlock(pSaveData: false);
		}
		saveData();
	}
}
// --- End of File: GameProgress.cs ---



// --- Start of File: GameProgressData.cs ---
using System;
using System.Collections.Generic;
using UnityEngine.Scripting;

[Serializable]
[Preserve]
public class GameProgressData
{
	[NonSerialized]
	internal List<HashSet<string>> all_hashsets = new List<HashSet<string>>();

	public HashSet<string> achievements;

	public HashSet<string> unlocked_traits_actor;

	public HashSet<string> unlocked_traits_culture;

	public HashSet<string> unlocked_traits_language;

	public HashSet<string> unlocked_traits_subspecies;

	public HashSet<string> unlocked_traits_clan;

	public HashSet<string> unlocked_traits_kingdom;

	public HashSet<string> unlocked_traits_religion;

	public HashSet<string> unlocked_equipment;

	public HashSet<string> unlocked_genes;

	public HashSet<string> unlocked_actors;

	public HashSet<string> unlocked_plots;

	public int saveVersion = 2;

	[Preserve]
	[Obsolete("use .unlocked_traits_actor instead", true)]
	public List<string> unlocked_traits
	{
		set
		{
			if (value != null)
			{
				if (unlocked_traits_actor == null)
				{
					unlocked_traits_actor = new HashSet<string>(value);
				}
				else
				{
					unlocked_traits_actor.UnionWith(value);
				}
			}
		}
	}

	public GameProgressData()
	{
		setDefaultValues();
	}

	public void setDefaultValues()
	{
		if (achievements == null)
		{
			achievements = new HashSet<string>();
		}
		if (unlocked_traits_actor == null)
		{
			unlocked_traits_actor = new HashSet<string>();
		}
		if (unlocked_traits_culture == null)
		{
			unlocked_traits_culture = new HashSet<string>();
		}
		if (unlocked_traits_language == null)
		{
			unlocked_traits_language = new HashSet<string>();
		}
		if (unlocked_traits_subspecies == null)
		{
			unlocked_traits_subspecies = new HashSet<string>();
		}
		if (unlocked_traits_clan == null)
		{
			unlocked_traits_clan = new HashSet<string>();
		}
		if (unlocked_traits_kingdom == null)
		{
			unlocked_traits_kingdom = new HashSet<string>();
		}
		if (unlocked_traits_religion == null)
		{
			unlocked_traits_religion = new HashSet<string>();
		}
		if (unlocked_equipment == null)
		{
			unlocked_equipment = new HashSet<string>();
		}
		if (unlocked_genes == null)
		{
			unlocked_genes = new HashSet<string>();
		}
		if (unlocked_actors == null)
		{
			unlocked_actors = new HashSet<string>();
		}
		if (unlocked_plots == null)
		{
			unlocked_plots = new HashSet<string>();
		}
	}

	public void prepare()
	{
		all_hashsets.Clear();
		all_hashsets.Add(unlocked_traits_actor);
		all_hashsets.Add(unlocked_traits_culture);
		all_hashsets.Add(unlocked_traits_language);
		all_hashsets.Add(unlocked_traits_subspecies);
		all_hashsets.Add(unlocked_traits_clan);
		all_hashsets.Add(unlocked_traits_kingdom);
		all_hashsets.Add(unlocked_traits_religion);
		all_hashsets.Add(unlocked_equipment);
		all_hashsets.Add(unlocked_genes);
		all_hashsets.Add(unlocked_actors);
		all_hashsets.Add(unlocked_plots);
	}
}
// --- End of File: GameProgressData.cs ---



// --- Start of File: GameStats.cs ---
using System;
using System.IO;
using Newtonsoft.Json;
using UnityEngine;

public class GameStats : MonoBehaviour
{
	internal GameStatsData data;

	private string dataPath;

	private WorldTimer saveTimer;

	private void Start()
	{
		dataPath = Application.persistentDataPath + "/stats.json";
		loadData();
		if (data == null)
		{
			data = new GameStatsData();
		}
		else
		{
			checkDataForErrors();
		}
		saveTimer = new WorldTimer(30f, saveData);
		data.gameLaunches++;
	}

	internal bool goodForAds()
	{
		return true;
	}

	private void saveData()
	{
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Expected O, but got Unknown
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		string text = "Stats";
		bool flag = false;
		string pNewPath = dataPath;
		string text2 = dataPath + ".tmp";
		try
		{
			if (!Directory.Exists(Application.persistentDataPath))
			{
				Directory.CreateDirectory(Application.persistentDataPath);
			}
		}
		catch (Exception ex)
		{
			WorldTip.showNow("Error creating directory to save stats in! Check console for details", pTranslate: false, "top");
			Debug.Log((object)("Error creating directory: " + Application.persistentDataPath));
			Debug.Log((object)ex);
		}
		try
		{
			using FileStream stream = new FileStream(text2, FileMode.Create, FileAccess.Write);
			using StreamWriter streamWriter = new StreamWriter(stream);
			JsonWriter val = (JsonWriter)new JsonTextWriter((TextWriter)streamWriter);
			try
			{
				new JsonSerializer().Serialize(val, (object)data);
			}
			finally
			{
				((IDisposable)val)?.Dispose();
			}
		}
		catch (IOException ex2)
		{
			if (Toolbox.IsDiskFull(ex2))
			{
				WorldTip.showNow("Error saving " + text + " : Disk full!", pTranslate: false, "top");
			}
			else
			{
				Debug.Log((object)("Could not save " + text + " due to hard drive / IO Error : "));
				Debug.Log((object)ex2);
				WorldTip.showNow("Error saving " + text + " due to IOError! Check console for details", pTranslate: false, "top");
			}
			flag = true;
		}
		catch (Exception ex3)
		{
			Debug.Log((object)("Could not save " + text + " due to error : "));
			Debug.Log((object)ex3);
			WorldTip.showNow("Error saving " + text + "! Check console for errors", pTranslate: false, "top");
			flag = true;
		}
		if (flag)
		{
			if (File.Exists(text2))
			{
				File.Delete(text2);
			}
		}
		else
		{
			Toolbox.MoveSafely(text2, pNewPath);
		}
		AchievementLibrary.life_is_a_sim.check();
	}

	private void checkDataForErrors()
	{
		if (double.IsNaN(data.gameTime) || double.IsInfinity(data.gameTime) || data.gameTime < 0.0)
		{
			Debug.Log((object)data.gameTime);
			Debug.LogError((object)"Game time is NaN or Infinity! Resetting to 0");
			data.gameTime = 0.0;
		}
		if (data.creaturesBorn < 0)
		{
			data.creaturesBorn = Math.Max(0L, data.creaturesDied - data.creaturesCreated);
		}
	}

	private void loadData()
	{
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Expected O, but got Unknown
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Expected O, but got Unknown
		if (!File.Exists(dataPath))
		{
			return;
		}
		try
		{
			using FileStream stream = new FileStream(dataPath, FileMode.Open, FileAccess.Read);
			using StreamReader streamReader = new StreamReader(stream);
			JsonReader val = (JsonReader)new JsonTextReader((TextReader)streamReader);
			try
			{
				JsonSerializer val2 = new JsonSerializer();
				data = val2.Deserialize<GameStatsData>(val);
			}
			finally
			{
				((IDisposable)val)?.Dispose();
			}
		}
		catch (Exception ex)
		{
			Debug.Log((object)"exception caught when loading stats");
			Debug.LogError((object)ex);
		}
		if (data == null)
		{
			Debug.LogError((object)"(!) stats not has been loaded");
		}
	}

	public void updateStats(float pTime)
	{
		data.gameTime += pTime;
		saveTimer.update();
	}
}
// --- End of File: GameStats.cs ---



// --- Start of File: GameStatsData.cs ---
using System;

[Serializable]
public class GameStatsData
{
	public double gameTime;

	public long treesGrown;

	public long floraGrown;

	public long meteoritesLaunched;

	public long pixelsExploded;

	public long creaturesBorn;

	public long creaturesCreated;

	public long creaturesDied;

	public long subspeciesCreated;

	public long subspeciesExtinct;

	public long languagesCreated;

	public long languagesForgotten;

	public long booksWritten;

	public long booksRead;

	public long booksBurnt;

	public long culturesCreated;

	public long culturesForgotten;

	public long religionsCreated;

	public long religionsForgotten;

	public long kingdomsCreated;

	public long kingdomsDestroyed;

	public long citiesCreated;

	public long citiesConquered;

	public long citiesRebelled;

	public long citiesDestroyed;

	public long alliancesMade;

	public long alliancesDissolved;

	public long warsStarted;

	public long peacesMade;

	public long plotsStarted;

	public long plotsSucceeded;

	public long plotsForgotten;

	public long familiesCreated;

	public long familiesDestroyed;

	public long clansCreated;

	public long clansDestroyed;

	public long armiesCreated;

	public long armiesDestroyed;

	public long creaturesSacrificed;

	public long elvesSacrificed;

	public long boatsDestroyedByMagnet;

	public long gameLaunches;

	public long bombsDropped;

	public long wallsPlaced;

	public long workshopUploads;

	public long mapsCreated;
}
// --- End of File: GameStatsData.cs ---



// --- Start of File: GenderCount.cs ---
public class GenderCount
{
	public int males;

	public int females;
}
// --- End of File: GenderCount.cs ---



// --- Start of File: GeneAsset.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

[Serializable]
public class GeneAsset : BaseTrait<GeneAsset>
{
	private const string CHARS_FOR_CODONS = "ACGT";

	public bool is_stat_gene = true;

	public bool can_drop_and_grab = true;

	public bool is_empty;

	public bool for_generation;

	public bool is_bad;

	public bool is_simple;

	public bool is_bonus_male;

	public bool is_bonus_female;

	public bool show_genepool_nucleobases = true;

	public bool synergy_sides_always;

	private string _genetic_code;

	[NonSerialized]
	public char genetic_code_right;

	[NonSerialized]
	public char genetic_code_left;

	[NonSerialized]
	public char genetic_code_up;

	[NonSerialized]
	public char genetic_code_down;

	private string _cached_sequence;

	private string _cached_sequence_locked;

	private BaseStats _cached_half_stats;

	private BaseStats _cached_half_stats_meta;

	protected override HashSet<string> progress_elements => base._progress_data?.unlocked_genes;

	public override string typed_id => "gene";

	public GeneAsset()
	{
		group_id = "genes";
	}

	public override BaseCategoryAsset getGroup()
	{
		return null;
	}

	public string getSequence()
	{
		if (is_bad)
		{
			return getHarmfulSequence();
		}
		if (!show_genepool_nucleobases)
		{
			return getLockedSequence();
		}
		if (isAvailable())
		{
			return getColoredSequence();
		}
		return getLockedSequence();
	}

	private string getHarmfulSequence()
	{
		return InsultStringGenerator.getDNASequenceBad();
	}

	public string getColoredSequence()
	{
		if (string.IsNullOrEmpty(_cached_sequence))
		{
			_cached_sequence = NucleobaseHelper.getColoredSequence(_genetic_code);
		}
		return _cached_sequence;
	}

	public string getLockedSequence()
	{
		return "??? ??? ??? ??? ??? ???";
	}

	public BaseStats getHalfStats()
	{
		BaseStats baseStats = _cached_half_stats;
		if (baseStats == null)
		{
			baseStats = (_cached_half_stats = new BaseStats());
			BaseStatsContainer[] array = base_stats.getList().ToArray();
			foreach (BaseStatsContainer baseStatsContainer in array)
			{
				float num = ((!Mathf.Approximately(Mathf.Floor(baseStatsContainer.value), baseStatsContainer.value)) ? (baseStatsContainer.value * 0.5f) : Mathf.Floor(baseStatsContainer.value * 0.5f));
				baseStats[baseStatsContainer.id] = num;
			}
			baseStats.normalize();
		}
		return baseStats;
	}

	public BaseStats getHalfStatsMeta()
	{
		BaseStats baseStats = _cached_half_stats_meta;
		if (baseStats == null)
		{
			baseStats = (_cached_half_stats_meta = new BaseStats());
			BaseStatsContainer[] array = base_stats_meta.getList().ToArray();
			foreach (BaseStatsContainer baseStatsContainer in array)
			{
				float num = ((!Mathf.Approximately(Mathf.Floor(baseStatsContainer.value), baseStatsContainer.value)) ? (baseStatsContainer.value * 0.5f) : Mathf.Floor(baseStatsContainer.value * 0.5f));
				baseStats[baseStatsContainer.id] = num;
			}
		}
		baseStats.normalize();
		return baseStats;
	}

	public void generateDNA(long pSeed)
	{
		_genetic_code = generateRandomCodonString(pSeed, 15);
		genetic_code_left = _genetic_code[0];
		string genetic_code = _genetic_code;
		genetic_code_right = genetic_code[genetic_code.Length - 1];
		genetic_code_up = _genetic_code[8];
		genetic_code_down = _genetic_code[10];
	}

	private string generateRandomCodonString(long pSeed, int pLength)
	{
		Random random = new Random((int)pSeed);
		string text = "";
		for (int i = 0; i < pLength; i++)
		{
			text += "ACGT"[random.Next("ACGT".Length)];
			if ((i + 1) % 3 == 0 && i + 1 < pLength)
			{
				text += " ";
			}
		}
		return text;
	}

	protected override bool isDebugUnlockedAll()
	{
		return DebugConfig.isOn(DebugOption.UnlockAllGenes);
	}
}
// --- End of File: GeneAsset.cs ---



// --- Start of File: GeneAssetClickEvent.cs ---
public delegate void GeneAssetClickEvent(GeneAsset pGeneAsset);
// --- End of File: GeneAssetClickEvent.cs ---



// --- Start of File: GeneButton.cs ---
using System;
using UnityEngine;
using UnityEngine.Events;

public class GeneButton : ChainElement
{
	[SerializeField]
	private GameObject _petri_bg;

	private GeneAssetClickEvent _gene_asset_click_event;

	protected override void create()
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Expected O, but got Unknown
		base.create();
		((UnityEvent)button.onClick).AddListener(new UnityAction(click));
	}

	private void click()
	{
		_gene_asset_click_event?.Invoke(base.gene);
		if (!InputHelpers.mouseSupported)
		{
			((Component)this).GetComponent<TipButton>().hoverAction();
		}
	}

	protected override void onStartDrag(DraggableLayoutElement pOriginalElement)
	{
		base.onStartDrag(pOriginalElement);
		_petri_bg.SetActive(false);
		colorChains();
		bool active = !augmentation_asset.isUnlocked();
		((Component)locked_bg).gameObject.SetActive(active);
	}

	internal void locusChild(UnityAction pAction, int pLocusIndex)
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Expected O, but got Unknown
		hideChains();
		((UnityEvent)button.onClick).RemoveListener(new UnityAction(click));
		((UnityEvent)button.onClick).RemoveListener(pAction);
		((UnityEvent)button.onClick).AddListener(pAction);
		locus_index = pLocusIndex;
		disableTooltip();
	}

	protected override void fillTooltipData(GeneAsset pElement)
	{
		Tooltip.show(this, "gene", tooltipDataBuilder());
	}

	protected override TooltipData tooltipDataBuilder()
	{
		return new TooltipData
		{
			gene = base.gene
		};
	}

	public void addGeneClickCallback(GeneAssetClickEvent pAction)
	{
		_gene_asset_click_event = (GeneAssetClickEvent)Delegate.Combine(_gene_asset_click_event, pAction);
	}

	public void removeGeneClickCallback(GeneAssetClickEvent pAction)
	{
		_gene_asset_click_event = (GeneAssetClickEvent)Delegate.Remove(_gene_asset_click_event, pAction);
	}
}
// --- End of File: GeneButton.cs ---



// --- Start of File: GeneDirection.cs ---
public enum GeneDirection
{
	Up,
	Down,
	Left,
	Right
}
// --- End of File: GeneDirection.cs ---



// --- Start of File: GeneEditor.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class GeneEditor : MonoBehaviour
{
	[SerializeField]
	private Text _text_unlocked_genes;

	[SerializeField]
	private Transform _transform_chromosomes;

	[SerializeField]
	private Transform _transform_loci;

	[SerializeField]
	private Transform _transform_gene_selector;

	[SerializeField]
	private ChromosomeElement _prefab_chromosome_element;

	[SerializeField]
	private LocusElement _prefab_locus_element;

	[SerializeField]
	private GeneButton _prefab_gene_button;

	private bool _initialized;

	private Dictionary<GeneAsset, GeneButton> _dictionary_gene_buttons = new Dictionary<GeneAsset, GeneButton>();

	private ObjectPoolGenericMono<ChromosomeElement> _pool_elements_chromosomes;

	private ObjectPoolGenericMono<LocusElement> _pool_elements_loci;

	private LocusElement _selected_locus;

	private Chromosome _selected_chromosome;

	public Image selection_locus;

	public Image selection_gene_asset;

	public Text genome_counter_text;

	private SubspeciesWindow _window_subspecies;

	private Subspecies _meta_object => SelectedMetas.selected_subspecies;

	internal void load()
	{
		init();
		clear();
		loadChromosomes();
		reloadButtons();
		recolorGenePoolButtons();
	}

	private void init()
	{
		if (!_initialized)
		{
			_initialized = true;
			_window_subspecies = ((Component)this).GetComponentInParent<SubspeciesWindow>();
			_pool_elements_chromosomes = new ObjectPoolGenericMono<ChromosomeElement>(_prefab_chromosome_element, _transform_chromosomes);
			_pool_elements_loci = new ObjectPoolGenericMono<LocusElement>(_prefab_locus_element, _transform_loci);
			loadGeneButtons();
		}
	}

	private void clear()
	{
		_pool_elements_chromosomes.clear();
		_pool_elements_loci.clear();
		_selected_chromosome = null;
		_selected_locus = null;
	}

	private void OnEnable()
	{
		load();
	}

	private void OnDisable()
	{
		clear();
	}

	public void debugRandomizeGenes()
	{
		_meta_object.addDNAMutationToSeed();
		_meta_object.generateNucleus();
		_meta_object.genesChangedEvent();
		_meta_object.eventGMO();
		load();
	}

	public void debugShuffleGenes()
	{
		_meta_object.unstableGenomeEvent();
		load();
	}

	private void loadChromosomes(bool pSelectFirstChromosome = true)
	{
		foreach (Chromosome chromosome in _meta_object.nucleus.chromosomes)
		{
			_pool_elements_chromosomes.getNext().show(chromosome, clickChromosome);
		}
		if (pSelectFirstChromosome && _meta_object.nucleus.chromosomes.Count > 0)
		{
			clickChromosome(_meta_object.nucleus.chromosomes[0]);
		}
	}

	private void recolorGenePoolButtons()
	{
		foreach (GeneButton value in _dictionary_gene_buttons.Values)
		{
			value.colorChains();
		}
	}

	private void loadGeneButtons()
	{
		foreach (GeneAsset item in AssetManager.gene_library.list)
		{
			if (!item.is_empty)
			{
				GeneButton geneButton = Object.Instantiate<GeneButton>(_prefab_gene_button, _transform_gene_selector);
				_dictionary_gene_buttons.Add(item, geneButton);
				geneButton.load(item);
				geneButton.is_editor_button = true;
				geneButton.addElementUnlockedAction(reloadButtons);
				geneButton.addGeneClickCallback(clickGeneAssetAction);
				((Behaviour)((Component)geneButton).GetComponent<DraggableLayoutElement>()).enabled = item.isAvailable();
			}
		}
	}

	public void clickChromosome(Chromosome pChromosome)
	{
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		foreach (ChromosomeElement item in _pool_elements_chromosomes.getListTotal())
		{
			if (((Component)item).gameObject.activeSelf)
			{
				if (item.chromosome == pChromosome)
				{
					((Graphic)item.image).color = Color.white;
				}
				else
				{
					((Graphic)item.image).color = Color.gray;
				}
			}
		}
		_selected_chromosome = pChromosome;
		showGenes(pChromosome);
		selectFirstNormalLocus();
	}

	private void selectFirstNormalLocus()
	{
		foreach (LocusElement item in _pool_elements_loci.getListTotal())
		{
			if (!item.isSpecialLocus())
			{
				selectLocus(item);
				break;
			}
		}
	}

	internal void selectLocus(LocusElement pElement)
	{
		_selected_locus = pElement;
	}

	private void clickGeneAssetAction(GeneAsset pGeneAsset)
	{
		if (!((Object)(object)_selected_locus == (Object)null) && pGeneAsset.isAvailable())
		{
			if (pGeneAsset != _selected_locus.getGeneAsset())
			{
				AchievementLibrary.engineered_evolution.check();
			}
			if (!Config.hasPremium)
			{
				ScrollWindow.showWindow("premium_menu");
				return;
			}
			_selected_chromosome.setGene(pGeneAsset, _selected_locus.locus_index);
			chromosomeUpdatedEvent();
		}
	}

	private void chromosomeUpdatedEvent()
	{
		_selected_chromosome.setDirty();
		_selected_chromosome.recalculate();
		_meta_object.genesChangedEvent();
		_meta_object.eventGMO();
		showGenes(_selected_chromosome);
		AchievementLibrary.simple_stupid_genetics.check();
		AchievementLibrary.fast_living.check();
		AchievementLibrary.long_living.check();
		AchievementLibrary.master_weaver.check();
		_pool_elements_chromosomes.clear();
		loadChromosomes(pSelectFirstChromosome: false);
	}

	public void showGenes(Chromosome pChromosome)
	{
		_pool_elements_loci.clear();
		for (int i = 0; i < pChromosome.genes.Count; i++)
		{
			GeneAsset pGene = pChromosome.genes[i];
			LocusElement next = _pool_elements_loci.getNext();
			next.show(i, pChromosome, pGene, pChromosome.getLocusType(i), selectLocus);
			next.addElementUnlockedAction(reloadButtons);
			next.addChromosomeUpdatedEvent(chromosomeUpdatedEvent);
		}
		_window_subspecies.updateStats();
	}

	private void updateTextGenome()
	{
		int num = _selected_chromosome.countNonEmpty();
		int amount_loci = _selected_chromosome.getAsset().amount_loci;
		genome_counter_text.text = num + " / " + amount_loci;
	}

	private void Update()
	{
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		if (_meta_object == null || _selected_chromosome == null)
		{
			return;
		}
		((Component)selection_gene_asset).gameObject.SetActive((Object)(object)_selected_locus != (Object)null);
		((Component)selection_locus).gameObject.SetActive((Object)(object)_selected_locus != (Object)null);
		if ((Object)(object)_selected_locus != (Object)null)
		{
			((Component)selection_locus).gameObject.transform.position = ((Component)_selected_locus).transform.position;
			GeneButton currentGeneAssetButton = getCurrentGeneAssetButton();
			((Component)selection_gene_asset).gameObject.transform.position = ((Component)currentGeneAssetButton).transform.position;
			if (!Config.isDraggingItem())
			{
				_ = (Object)(object)currentGeneAssetButton != (Object)null;
			}
		}
	}

	private GeneButton getCurrentGeneAssetButton()
	{
		GeneAsset geneAsset = _selected_locus.getGeneAsset();
		if (geneAsset == null)
		{
			return null;
		}
		if (_dictionary_gene_buttons.ContainsKey(geneAsset))
		{
			return _dictionary_gene_buttons[geneAsset];
		}
		return null;
	}

	private void reloadButtons()
	{
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		int num2 = 0;
		foreach (GeneButton value in _dictionary_gene_buttons.Values)
		{
			bool flag = value.getElementAsset().isAvailable();
			num2++;
			if (flag)
			{
				num++;
				((Graphic)value.image).color = Toolbox.color_white;
			}
			else
			{
				((Graphic)value.image).color = Toolbox.color_black;
			}
			((Behaviour)((Component)value).GetComponent<DraggableLayoutElement>()).enabled = flag;
		}
		_text_unlocked_genes.text = num + "/" + num2;
		AchievementLibrary.genes_explorer.checkBySignal();
	}

	protected virtual bool hasGene(GeneAsset pTrait)
	{
		return _selected_chromosome.hasGene(pTrait);
	}
}
// --- End of File: GeneEditor.cs ---



// --- Start of File: GeneLibrary.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class GeneLibrary : BaseTraitLibrary<GeneAsset>
{
	[NonSerialized]
	private Dictionary<string, List<GeneAsset>> _cached_stat_genes_dictionary = new Dictionary<string, List<GeneAsset>>();

	[NonSerialized]
	private List<GeneAsset> _gene_assets_simple = new List<GeneAsset>();

	[NonSerialized]
	private List<GeneAsset> _gene_assets_mutations = new List<GeneAsset>();

	public static GeneAsset gene_for_generation;

	protected override string icon_path => "ui/Icons/genes/";

	protected override List<string> getDefaultTraitsForMeta(ActorAsset pAsset)
	{
		return null;
	}

	public override void init()
	{
		base.init();
		addSpecial();
		addBaseStats();
		addFightStats();
		addBonusStats();
		addAttributes();
		gene_for_generation = get("temp_for_generation");
	}

	public string getRandomNormalGene()
	{
		int num = 10;
		foreach (GeneAsset item in list.LoopRandom())
		{
			if (num <= 0)
			{
				break;
			}
			num--;
			if (item.isAvailable() && !item.is_empty && !item.for_generation)
			{
				return item.id;
			}
		}
		return null;
	}

	private void addBonusStats()
	{
		add(new GeneAsset
		{
			id = "attack_speed"
		});
		t.base_stats["attack_speed"] = 1f;
		t.setUnlockedWithAchievement("achievementGenesExplorer");
		add(new GeneAsset
		{
			id = "scale_plus"
		});
		t.base_stats["scale"] = 0.03f;
		t.setUnlockedWithAchievement("achievementSimpleStupidGenetics");
		add(new GeneAsset
		{
			id = "scale_minus"
		});
		t.base_stats["scale"] = -0.01f;
		t.setUnlockedWithAchievement("achievementAntWorld");
	}

	private void addFightStats()
	{
		add(new GeneAsset
		{
			id = "armor_1",
			is_simple = true
		});
		t.base_stats["armor"] = 1f;
		add(new GeneAsset
		{
			id = "armor_2"
		});
		t.base_stats["armor"] = 6f;
		add(new GeneAsset
		{
			id = "armor_3"
		});
		t.base_stats["armor"] = 10f;
		add(new GeneAsset
		{
			id = "damage_1",
			is_simple = true
		});
		t.base_stats["damage"] = 1f;
		add(new GeneAsset
		{
			id = "damage_2"
		});
		t.base_stats["damage"] = 6f;
		add(new GeneAsset
		{
			id = "damage_3"
		});
		t.base_stats["damage"] = 10f;
	}

	private void addBaseStats()
	{
		add(new GeneAsset
		{
			id = "birth_rate_1"
		});
		t.base_stats["birth_rate"] = 1f;
		add(new GeneAsset
		{
			id = "offspring_1"
		});
		t.base_stats["offspring"] = 1f;
		add(new GeneAsset
		{
			id = "offspring_2"
		});
		t.base_stats["offspring"] = 3f;
		add(new GeneAsset
		{
			id = "offspring_3"
		});
		t.base_stats["offspring"] = 5f;
		add(new GeneAsset
		{
			id = "offspring_4"
		});
		t.base_stats["offspring"] = 10f;
		add(new GeneAsset
		{
			id = "lifespan_1"
		});
		t.base_stats["lifespan"] = 5f;
		add(new GeneAsset
		{
			id = "lifespan_2"
		});
		t.base_stats["lifespan"] = 20f;
		add(new GeneAsset
		{
			id = "lifespan_3"
		});
		t.base_stats["lifespan"] = 50f;
		add(new GeneAsset
		{
			id = "lifespan_4"
		});
		t.base_stats["lifespan"] = 100f;
		add(new GeneAsset
		{
			id = "health_1",
			is_simple = true
		});
		t.base_stats["health"] = 1f;
		add(new GeneAsset
		{
			id = "health_2",
			is_simple = true
		});
		t.base_stats["health"] = 10f;
		add(new GeneAsset
		{
			id = "health_3"
		});
		t.base_stats["health"] = 50f;
		add(new GeneAsset
		{
			id = "health_4"
		});
		t.base_stats["health"] = 100f;
		add(new GeneAsset
		{
			id = "health_5"
		});
		t.base_stats["health"] = 300f;
		add(new GeneAsset
		{
			id = "stamina_1",
			is_simple = true
		});
		t.base_stats["stamina"] = 10f;
		add(new GeneAsset
		{
			id = "stamina_2"
		});
		t.base_stats["stamina"] = 50f;
		add(new GeneAsset
		{
			id = "stamina_3"
		});
		t.base_stats["stamina"] = 100f;
		add(new GeneAsset
		{
			id = "speed_1"
		});
		t.base_stats["speed"] = 1f;
		add(new GeneAsset
		{
			id = "speed_2"
		});
		t.base_stats["speed"] = 2f;
		add(new GeneAsset
		{
			id = "speed_3"
		});
		t.base_stats["speed"] = 5f;
	}

	private void addAttributes()
	{
		add(new GeneAsset
		{
			id = "diplomacy_1",
			is_simple = true
		});
		t.base_stats["diplomacy"] = 1f;
		add(new GeneAsset
		{
			id = "diplomacy_2"
		});
		t.base_stats["diplomacy"] = 2f;
		add(new GeneAsset
		{
			id = "diplomacy_3"
		});
		t.base_stats["diplomacy"] = 3f;
		add(new GeneAsset
		{
			id = "warfare_1",
			is_simple = true
		});
		t.base_stats["warfare"] = 1f;
		add(new GeneAsset
		{
			id = "warfare_2"
		});
		t.base_stats["warfare"] = 2f;
		add(new GeneAsset
		{
			id = "warfare_3"
		});
		t.base_stats["warfare"] = 3f;
		add(new GeneAsset
		{
			id = "stewardship_1",
			is_simple = true
		});
		t.base_stats["stewardship"] = 1f;
		add(new GeneAsset
		{
			id = "stewardship_2"
		});
		t.base_stats["stewardship"] = 2f;
		add(new GeneAsset
		{
			id = "stewardship_3"
		});
		t.base_stats["stewardship"] = 3f;
		add(new GeneAsset
		{
			id = "intelligence_1",
			is_simple = true
		});
		t.base_stats["intelligence"] = 1f;
		add(new GeneAsset
		{
			id = "intelligence_2"
		});
		t.base_stats["intelligence"] = 2f;
		add(new GeneAsset
		{
			id = "intelligence_3"
		});
		t.base_stats["intelligence"] = 3f;
	}

	private void addSpecial()
	{
		add(new GeneAsset
		{
			id = "empty",
			path_icon = "ui/Icons/iconEmptyLocus",
			is_empty = true,
			show_in_knowledge_window = false,
			needs_to_be_explored = false,
			show_genepool_nucleobases = false,
			can_drop_and_grab = false
		});
		add(new GeneAsset
		{
			id = "temp_for_generation",
			path_icon = "ui/Icons/iconEmptyLocus",
			for_generation = true,
			is_empty = true,
			show_in_knowledge_window = false,
			needs_to_be_explored = false,
			show_genepool_nucleobases = false,
			can_drop_and_grab = false,
			has_description_1 = false,
			has_description_2 = false,
			has_localized_id = false
		});
		add(new GeneAsset
		{
			id = "bad",
			is_stat_gene = false,
			is_bad = true,
			is_simple = true,
			needs_to_be_explored = true,
			synergy_sides_always = true,
			show_genepool_nucleobases = false
		});
		add(new GeneAsset
		{
			id = "bonus_male",
			is_stat_gene = false,
			show_genepool_nucleobases = false,
			synergy_sides_always = true,
			is_bonus_male = true
		});
		add(new GeneAsset
		{
			id = "bonus_female",
			is_stat_gene = false,
			show_genepool_nucleobases = false,
			synergy_sides_always = true,
			is_bonus_female = true
		});
		add(new GeneAsset
		{
			id = "mutagenic",
			is_stat_gene = false,
			synergy_sides_always = true,
			show_genepool_nucleobases = false
		});
		t.base_stats_meta["mutation"] = 1f;
	}

	public override GeneAsset add(GeneAsset pAsset)
	{
		GeneAsset geneAsset = base.add(pAsset);
		geneAsset.has_description_1 = false;
		geneAsset.has_description_2 = false;
		return geneAsset;
	}

	public GeneAsset getRandomSimpleGene()
	{
		return _gene_assets_simple.GetRandom();
	}

	public GeneAsset getRandomGeneForMutation()
	{
		return _gene_assets_mutations.GetRandom();
	}

	public void regenerateBasicDNACodesWithLifeSeed(long pLifeSeed)
	{
		foreach (GeneAsset item in list)
		{
			if (item.show_genepool_nucleobases)
			{
				long pSeed = pLifeSeed + item.getIndexID();
				item.generateDNA(pSeed);
			}
		}
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (GeneAsset item in list)
		{
			if (item.is_simple)
			{
				_gene_assets_simple.Add(item);
			}
		}
		foreach (GeneAsset item2 in list)
		{
			if (!item2.is_empty)
			{
				_gene_assets_mutations.Add(item2);
			}
		}
	}

	public List<GeneAsset> getGenesWithStat(string pStatID)
	{
		if (!_cached_stat_genes_dictionary.ContainsKey(pStatID))
		{
			List<GeneAsset> value = filterGenes(pStatID);
			_cached_stat_genes_dictionary[pStatID] = value;
		}
		return _cached_stat_genes_dictionary[pStatID];
	}

	private List<GeneAsset> filterGenes(string pStatID)
	{
		List<GeneAsset> list = new List<GeneAsset>();
		foreach (GeneAsset item in AssetManager.gene_library.list)
		{
			if (!item.is_empty && (item.base_stats.hasStat(pStatID) || item.base_stats_meta.hasStat(pStatID)))
			{
				list.Add(item);
			}
		}
		return list;
	}
}
// --- End of File: GeneLibrary.cs ---



// --- Start of File: GeneratedRoom.cs ---
using System.Collections.Generic;

public class GeneratedRoom
{
	public int id_debug;

	public List<WorldTile> edges_left;

	public List<WorldTile> edges_right;

	public List<WorldTile> edges_up;

	public List<WorldTile> edges_down;
}
// --- End of File: GeneratedRoom.cs ---



// --- Start of File: GenerateLLMPrompt.cs ---
public static class GenerateLLMPrompt
{
	public static string getText(Actor pActor)
	{
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		stringBuilderPool.AppendLine("World Name: " + World.world.map_stats.name);
		stringBuilderPool.AppendLine($"World Year: {Date.getCurrentYear()}");
		stringBuilderPool.AppendLine("World Age: " + World.world.era_manager.getCurrentAge().id);
		stringBuilderPool.AppendLine($"Deaths: {World.world.map_stats.deaths}, Population: {World.world.map_stats.population}, Mobs: {World.world.map_stats.current_mobs}");
		stringBuilderPool.AppendLine("God Architector Name: " + World.world.map_stats.player_name);
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine($"World has subspecies: {World.world.subspecies.Count}, families: {World.world.families.Count}, languages: {World.world.languages.Count}, religions: {World.world.religions.Count}, items: {World.world.items.Count}, buildings: {World.world.buildings.Count}, cultures: {World.world.cultures.Count}, kingdoms: {World.world.kingdoms.Count}, cities: {World.world.cities.Count}, clans: {World.world.clans.Count}, units: {World.world.units.Count}");
		stringBuilderPool.AppendLine($"World has islands: {World.world.islands_calculator.countLandIslands()}");
		stringBuilderPool.AppendLine("Unit Name: " + pActor.name);
		stringBuilderPool.AppendLine($"Age: {pActor.getAge()}, Species: {pActor.asset.id}, Sex: {pActor.data.sex}, Level: {pActor.data.level}");
		stringBuilderPool.AppendLine($"Births: {pActor.data.births}, Kills: {pActor.data.kills}, Generation: {pActor.data.generation}");
		stringBuilderPool.AppendLine("Actor Traits: " + pActor.getTraitsAsLocalizedString());
		if (pActor.hasSubspecies())
		{
			stringBuilderPool.AppendLine($"Subspecies: {pActor.subspecies.name}, Age: {pActor.subspecies.getAge()}");
			stringBuilderPool.AppendLine("Subspecies traits: " + pActor.subspecies.getTraitsAsLocalizedString());
		}
		if (pActor.hasKingdom() && pActor.isKingdomCiv())
		{
			stringBuilderPool.AppendLine("Kingdom: " + pActor.kingdom.name);
			stringBuilderPool.AppendLine($"Kingdom Age: {pActor.kingdom.getAge()}, Population: {pActor.kingdom.getPopulationPeople()}, Children: {pActor.kingdom.countChildren()}, Warriors: {pActor.kingdom.countTotalWarriors()}");
			if (pActor.kingdom.hasKing())
			{
				stringBuilderPool.AppendLine($"King: {pActor.kingdom.king.name}, Age: {pActor.kingdom.king.getAge()}");
				stringBuilderPool.AppendLine($"Births: {pActor.kingdom.king.data.births}, Kills: {pActor.kingdom.king.data.kills}, Level: {pActor.kingdom.king.data.level}");
			}
		}
		int num = 0;
		foreach (Actor parent in pActor.getParents())
		{
			stringBuilderPool.AppendLine($"Parent {++num}: {parent.name}, Age: {parent.getAge()}");
		}
		if (pActor.hasCity())
		{
			stringBuilderPool.AppendLine("City: " + pActor.city.name);
			stringBuilderPool.AppendLine($"City Age: {pActor.city.getAge()}, Population: {pActor.city.getPopulationPeople()}, Children: {pActor.city.countPopulationChildren()}, Warriors: {pActor.city.countWarriors()}");
		}
		if (pActor.hasClan())
		{
			stringBuilderPool.AppendLine($"Bloodline Clan is: {pActor.clan.name}, Members: {pActor.clan.countUnits()}, Age: {pActor.clan.getAge()} years");
			stringBuilderPool.AppendLine("Clan traits: " + pActor.clan.getTraitsAsLocalizedString());
		}
		if (pActor.hasFamily())
		{
			stringBuilderPool.AppendLine($"Family: {pActor.family.name}, Members: {pActor.family.countUnits()}, Age: {pActor.family.getAge()} years");
		}
		if (pActor.hasCulture())
		{
			stringBuilderPool.AppendLine($"Culture: {pActor.culture.name}, Followers: {pActor.culture.countUnits()}, Age: {pActor.culture.getAge()} years");
			stringBuilderPool.AppendLine("Culture traits: " + pActor.culture.getTraitsAsLocalizedString());
		}
		if (pActor.hasLanguage())
		{
			stringBuilderPool.AppendLine($"Language: {pActor.language.name}, Users: {pActor.language.countUnits()}, Age: {pActor.language.getAge()} years");
			stringBuilderPool.AppendLine("Language traits: " + pActor.language.getTraitsAsLocalizedString());
		}
		if (pActor.hasReligion())
		{
			stringBuilderPool.AppendLine($"Religion: {pActor.religion.name}, Followers: {pActor.religion.countUnits()}, age {pActor.religion.getAge()} years");
			stringBuilderPool.AppendLine("Religion traits: " + pActor.religion.getTraitsAsLocalizedString());
		}
		if (pActor.hasLover())
		{
			stringBuilderPool.AppendLine($"Lover: {pActor.lover.name}, {pActor.data.sex}, level: {pActor.data.level}, Age: {pActor.lover.getAge()}, money: {pActor.lover.data.money}, kills: {pActor.lover.data.kills}");
		}
		if (pActor.hasBestFriend())
		{
			stringBuilderPool.AppendLine($"Best Friend: {pActor.getBestFriend().name}. Age of friendship: {pActor.getBestFriend().getAge()}");
			if (pActor.getBestFriend().hasLover())
			{
				stringBuilderPool.AppendLine($"Best Friend's Lover: {pActor.getBestFriend().lover.name}. Of age {pActor.getBestFriend().lover.getAge()}");
			}
		}
		if (pActor.hasWeapon())
		{
			stringBuilderPool.AppendLine($"Weapon: {pActor.getWeapon().getName()}. Rarity: {pActor.getWeapon().getQuality()}. Age is {pActor.getWeapon().getAge()} years");
		}
		stringBuilderPool.AppendLine($"Happiness: {pActor.getHappiness()}/{pActor.getMaxHappiness()}");
		stringBuilderPool.AppendLine($"Health: {pActor.data.health}/{pActor.getMaxHealth()}");
		stringBuilderPool.AppendLine($"Stamina: {pActor.data.stamina}/{pActor.getMaxStamina()}");
		stringBuilderPool.AppendLine($"Nutrition: {pActor.data.nutrition}/{pActor.getMaxNutrition()}");
		stringBuilderPool.AppendLine($"Mana: {pActor.data.mana}/{pActor.getMaxMana()}");
		stringBuilderPool.AppendLine($"Money: {pActor.data.money}");
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine("He lives in a fantasy simulated world. Write a story about his life, his thoughts, and his adventures.");
		stringBuilderPool.AppendLine("Make it as though it were from a classic fantasy tale like Lord of the Rings or a D&D campaign.");
		stringBuilderPool.AppendLine("Make it epic, dramatic, and full of lore. Infuse it with light and darkness, fun and sadness.");
		stringBuilderPool.AppendLine("Give it character and heart, and make it unforgettable.");
		stringBuilderPool.AppendLine("Reply should be in this language: " + LocalizedTextManager.instance.language);
		return stringBuilderPool.ToString();
	}
}
// --- End of File: GenerateLLMPrompt.cs ---



// --- Start of File: GeneratorTarget.cs ---
public enum GeneratorTarget
{
	Height,
	Temperature
}
// --- End of File: GeneratorTarget.cs ---



// --- Start of File: GeneratorTool.cs ---
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using UnityEngine;

public class GeneratorTool : ScriptableObject
{
	private static WorldTile[,] _tiles_map;

	private static Texture2D[] _textures;

	private static List<WorldTile> _neighbours = new List<WorldTile>(4);

	private static List<WorldTile> _neighbours_all = new List<WorldTile>(8);

	internal static void Setup(WorldTile[,] pTilesMap)
	{
		_tiles_map = pTilesMap;
	}

	public static void Init()
	{
		LoadGenShapeTextures();
	}

	internal static void applyTemplate(string pID, float pMod = 1f)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		Texture2D random = Resources.LoadAll<Texture2D>("map_gen/" + pID).GetRandom();
		random = TextureRotator.Rotate(random, Randy.randomInt(0, 360), new Color32(byte.MaxValue, byte.MaxValue, byte.MaxValue, byte.MaxValue));
		TextureScale.Bilinear(random, MapBox.width, MapBox.height);
		float num = 255f * pMod;
		for (int i = 0; i < ((Texture)random).width; i++)
		{
			for (int j = 0; j < ((Texture)random).height; j++)
			{
				WorldTile tile = World.world.GetTile(i, j);
				if (tile != null)
				{
					random.GetPixel(i, j);
					int num2 = (int)((1f - random.GetPixel(i, j).g) * num);
					tile.Height += num2;
				}
			}
		}
	}

	internal static void ApplyRandomShape(string pWhat = "height", float tDistMax = 2f, float pMod = 0.7f, bool pSubtract = false)
	{
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0122: Unknown result type (might be due to invalid IL or missing references)
		Texture2D val = null;
		int num = 0;
		int num2 = 0;
		val = Object.Instantiate<Texture2D>(_textures.GetRandom());
		((Object)val).name = "random_shape";
		num = (int)((float)((Texture)val).width * Randy.randomFloat(0.3f, 2f));
		num2 = (int)((float)((Texture)val).height * Randy.randomFloat(0.3f, 2f));
		val = TextureRotator.Rotate(val, Randy.randomInt(0, 360), new Color32((byte)0, (byte)0, (byte)0, (byte)0));
		TextureScale.Bilinear(val, num, num2);
		num = ((Texture)val).width;
		num2 = ((Texture)val).height;
		int num3 = MapBox.width / 2 - num / 2 - (int)Randy.randomFloat((float)(-num) * tDistMax, (float)num * tDistMax);
		int num4 = MapBox.height / 2 - num2 / 2 - (int)Randy.randomFloat((float)(-num2) * tDistMax, (float)num2 * tDistMax);
		if (num3 < 0)
		{
			num3 = 0;
		}
		if (num4 < 0)
		{
			num4 = 0;
		}
		if (num3 + num > MapBox.width)
		{
			num3 = MapBox.width - num;
		}
		if (num4 + num2 > MapBox.height)
		{
			num4 = MapBox.height - num2;
		}
		float num5 = 255f * pMod;
		for (int i = 0; i < ((Texture)val).width; i++)
		{
			for (int j = 0; j < ((Texture)val).height; j++)
			{
				WorldTile tile = World.world.GetTile(num3 + i, num4 + j);
				if (tile != null)
				{
					int num6 = (int)(val.GetPixel(i, j).a * num5);
					if (pSubtract)
					{
						num6 = -num6;
					}
					tile.Height += num6;
				}
			}
		}
		Object.Destroy((Object)(object)val);
	}

	private static void LoadGenShapeTextures()
	{
		if (_textures == null)
		{
			_textures = Resources.LoadAll<Texture2D>("gen_shapes");
		}
	}

	public static void ApplyWaterLevel(WorldTile[,] tilesMap, int width, int height, int pVal)
	{
		for (int i = 0; i < width; i++)
		{
			for (int j = 0; j < height; j++)
			{
				tilesMap[i, j].Height -= pVal;
			}
		}
	}

	public static void ApplyPerlinNoise(WorldTile[,] tilesMap, int width, int height, float pPosX, float pPosY, float pAlphaMod, float pScaleMod, bool pSubtract = false, GeneratorTarget pTarget = GeneratorTarget.Height)
	{
		float num = 255f * pAlphaMod;
		float num2 = 1f;
		float num3 = 1f;
		if (width > height)
		{
			num2 = width / height;
		}
		else
		{
			num3 = height / width;
		}
		for (int i = 0; i < width; i++)
		{
			for (int j = 0; j < height; j++)
			{
				float num4 = (pPosX + (float)i) / (float)width;
				float num5 = (pPosY + (float)j) / (float)height;
				int num6 = (int)(Mathf.PerlinNoise(num4 * pScaleMod * num2, num5 * pScaleMod * num3) * num);
				if (pSubtract)
				{
					num6 = -num6;
				}
				if (pTarget == GeneratorTarget.Height)
				{
					tilesMap[i, j].Height += num6;
				}
			}
		}
	}

	public static void ApplyPerlinReplace(PerlinReplaceContainer pContainer)
	{
		float num = Randy.randomInt(0, 15000);
		float num2 = Randy.randomInt(0, 15000);
		int width = MapBox.width;
		int height = MapBox.height;
		float num3 = pContainer.scale;
		float num4 = 255f;
		float num5 = 1f;
		float num6 = 1f;
		if (width > height)
		{
			num5 = width / height;
		}
		else
		{
			num6 = height / width;
		}
		WorldTile[,] tiles_map = _tiles_map;
		for (int i = 0; i < width; i++)
		{
			for (int j = 0; j < height; j++)
			{
				WorldTile worldTile = tiles_map[i, j];
				float num7 = (num + (float)i) / (float)width;
				float num8 = (num2 + (float)j) / (float)height;
				int num9 = (int)(Mathf.PerlinNoise(num7 * num3 * num5, num8 * num3 * num6) * num4);
				for (int k = 0; k < pContainer.options.Count; k++)
				{
					PerlinReplaceOption perlinReplaceOption = pContainer.options[k];
					if (num9 > perlinReplaceOption.replace_height_value && worldTile.main_type.IsType(perlinReplaceOption.from))
					{
						worldTile.setTileType(perlinReplaceOption.to);
					}
				}
			}
		}
	}

	public static void UpdateTileTypes(bool pGeneratorStage = false, int pStartIndex = 0, int pAmount = 0)
	{
		int num = pStartIndex + pAmount;
		for (int i = pStartIndex; i < num; i++)
		{
			WorldTile worldTile = World.world.tiles_list[i];
			TileType typeByDepth = AssetManager.tiles.getTypeByDepth(worldTile);
			worldTile.setTileType(typeByDepth);
		}
	}

	public static void GenerateTileNeighbours(WorldTile[] pTilesList)
	{
		int num = pTilesList.Length;
		for (int i = 0; i < num; i++)
		{
			generateTileNeighbours(pTilesList[i]);
		}
	}

	public static void generateTileNeighbours(WorldTile pTile)
	{
		WorldTile tile = getTile(pTile.x - 1, pTile.y);
		pTile.addNeighbour(tile, TileDirection.Left, _neighbours, _neighbours_all);
		tile = getTile(pTile.x + 1, pTile.y);
		pTile.addNeighbour(tile, TileDirection.Right, _neighbours, _neighbours_all);
		tile = getTile(pTile.x, pTile.y - 1);
		pTile.addNeighbour(tile, TileDirection.Down, _neighbours, _neighbours_all);
		tile = getTile(pTile.x, pTile.y + 1);
		pTile.addNeighbour(tile, TileDirection.Up, _neighbours, _neighbours_all);
		tile = getTile(pTile.x - 1, pTile.y - 1);
		pTile.addNeighbour(tile, TileDirection.Null, _neighbours, _neighbours_all, pDiagonal: true);
		tile = getTile(pTile.x - 1, pTile.y + 1);
		pTile.addNeighbour(tile, TileDirection.Null, _neighbours, _neighbours_all, pDiagonal: true);
		tile = getTile(pTile.x + 1, pTile.y - 1);
		pTile.addNeighbour(tile, TileDirection.Null, _neighbours, _neighbours_all, pDiagonal: true);
		tile = getTile(pTile.x + 1, pTile.y + 1);
		pTile.addNeighbour(tile, TileDirection.Null, _neighbours, _neighbours_all, pDiagonal: true);
		pTile.neighbours = _neighbours.ToArray();
		pTile.neighboursAll = _neighbours_all.ToArray();
		_neighbours.Clear();
		_neighbours_all.Clear();
	}

	public static void ApplyRingEffect()
	{
		WorldTile[,] tiles_map = _tiles_map;
		for (int i = 0; i < MapBox.width; i++)
		{
			for (int j = 0; j < MapBox.height; j++)
			{
				for (int k = 0; k < AssetManager.tiles.list.Count; k++)
				{
					TileType tileType = AssetManager.tiles.list[k];
					if (tileType.additional_height == null)
					{
						continue;
					}
					bool flag = false;
					for (int l = 0; l < tileType.additional_height.Length; l++)
					{
						WorldTile worldTile = tiles_map[i, j];
						if (worldTile.Height == tileType.height_min - tileType.additional_height[l])
						{
							worldTile.Height = tileType.height_min;
							flag = true;
							break;
						}
					}
					if (flag)
					{
						break;
					}
				}
			}
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	private static WorldTile getTile(int pX, int pY)
	{
		if (pX < 0 || pX >= MapBox.width)
		{
			return null;
		}
		if (pY < 0 || pY >= MapBox.height)
		{
			return null;
		}
		return _tiles_map[pX, pY];
	}
}
// --- End of File: GeneratorTool.cs ---



// --- Start of File: GenericBannerLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public abstract class GenericBannerLibrary : AssetLibrary<BannerAsset>
{
	public BannerAsset main;

	public int getNewIndexBackground()
	{
		return Randy.randomInt(0, getCurrentAsset().backgrounds.Count);
	}

	public int getNewIndexIcon()
	{
		return Randy.randomInt(0, getCurrentAsset().icons.Count);
	}

	public int getNewIndexFrame()
	{
		return Randy.randomInt(0, getCurrentAsset().frames.Count);
	}

	public Sprite getSpriteBackground(int pIndex)
	{
		BannerAsset currentAsset = getCurrentAsset();
		return loadSpriteFromAsset(currentAsset.backgrounds, pIndex);
	}

	public Sprite getSpriteBackground(int pIndex, string pAssetID)
	{
		BannerAsset bannerAsset = get(pAssetID);
		return loadSpriteFromAsset(bannerAsset.backgrounds, pIndex);
	}

	public Sprite getSpriteIcon(int pIndex)
	{
		BannerAsset currentAsset = getCurrentAsset();
		return loadSpriteFromAsset(currentAsset.icons, pIndex);
	}

	public Sprite getSpriteIcon(int pIndex, string pAssetID)
	{
		BannerAsset bannerAsset = get(pAssetID);
		return loadSpriteFromAsset(bannerAsset.icons, pIndex);
	}

	public Sprite getSpriteFrame(int pID)
	{
		BannerAsset currentAsset = getCurrentAsset();
		if (pID >= currentAsset.frames.Count)
		{
			pID = 0;
		}
		return SpriteTextureLoader.getSprite(currentAsset.frames[pID]);
	}

	private Sprite loadSpriteFromAsset(List<string> pSpriteList, int pIndex)
	{
		if (pIndex >= pSpriteList.Count)
		{
			pIndex = 0;
		}
		return SpriteTextureLoader.getSprite(pSpriteList[pIndex]);
	}

	public BannerAsset getCurrentAsset()
	{
		return main;
	}
}
// --- End of File: GenericBannerLibrary.cs ---



// --- Start of File: GenericCustomizeWindow.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class GenericCustomizeWindow<TMetaObject, TData, TBanner> : MonoBehaviour where TMetaObject : MetaObject<TData> where TData : MetaObjectData where TBanner : BannerGeneric<TMetaObject, TData>
{
	private bool _created;

	protected Text counter_option_1;

	protected Text counter_option_2;

	protected Text counter_color;

	protected Image image_banner_option_1;

	protected Image image_banner_option_2;

	protected LocalizedText title;

	protected LocalizedText title_option_1;

	protected LocalizedText title_option_2;

	protected LocalizedText title_color;

	protected Transform banner_area;

	protected Image icon_banner;

	protected Image icon_top;

	protected Transform option_1;

	protected Transform option_2;

	protected Transform colors;

	protected Transform colors_parent;

	public TBanner banner;

	private List<ColorElement> _color_elements = new List<ColorElement>();

	protected virtual TMetaObject meta_object
	{
		get
		{
			throw new NotImplementedException("meta_object is not set");
		}
	}

	protected TData data => meta_object.data;

	private MetaCustomizationAsset meta_asset => AssetManager.meta_customization_library.getAsset(meta_type);

	protected virtual MetaType meta_type
	{
		get
		{
			throw new NotImplementedException("meta_type is not set");
		}
	}

	private void OnEnable()
	{
		loadBanner();
		apply();
		int color = banner.color;
		clickColorElement(_color_elements[color], color);
	}

	public int getChangeValue()
	{
		int result = 1;
		if (HotkeyLibrary.many_mod.isHolding())
		{
			result = 5;
		}
		return result;
	}

	protected virtual void apply()
	{
		updateBanner();
		loadBanner();
		updateSelection();
	}

	protected virtual void loadBanner()
	{
		banner.load(meta_object);
	}

	protected virtual void updateColors()
	{
		updateColorsBanner();
	}

	protected virtual void updateColorsBanner()
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		ColorAsset color = meta_object.getColor();
		((Graphic)image_banner_option_1).color = color.getColorMainSecond();
		if (meta_asset.option_2_color_editable)
		{
			((Graphic)image_banner_option_2).color = color.getColorBanner();
		}
	}

	private void Awake()
	{
		create();
	}

	private void create()
	{
		if (!_created)
		{
			_created = true;
			setupParts();
			setupButtons();
			setupBanner();
			setupTexts();
			setupImages();
		}
	}

	protected virtual void setupParts()
	{
		Transform val = ((Component)this).transform.FindRecursive("Background").Find("Title");
		title = ((Component)val).GetComponent<LocalizedText>();
		option_1 = ((Component)this).transform.FindRecursive("Option 1");
		option_2 = ((Component)this).transform.FindRecursive("Option 2");
		colors = ((Component)this).transform.FindRecursive("Colors");
		colors_parent = colors.FindRecursive("Colors BG");
		Transform pTransform = ((Component)this).transform.FindRecursive("Banner");
		banner_area = pTransform.FindRecursive("BannerArea");
		icon_banner = ((Component)pTransform.FindRecursive("Icon")).GetComponent<Image>();
		icon_top = ((Component)((Component)this).transform.FindRecursive("Cat")).GetComponent<Image>();
		counter_option_1 = ((Component)option_1.FindRecursive("Counter")).GetComponent<Text>();
		counter_option_2 = ((Component)option_2.FindRecursive("Counter")).GetComponent<Text>();
		counter_color = ((Component)colors.FindRecursive("Counter")).GetComponent<Text>();
		title_option_1 = ((Component)option_1.FindRecursive("Title")).GetComponent<LocalizedText>();
		title_option_2 = ((Component)option_2.FindRecursive("Title")).GetComponent<LocalizedText>();
		title_color = ((Component)colors.FindRecursive("Title")).GetComponent<LocalizedText>();
		image_banner_option_1 = ((Component)option_1.FindRecursive("Image")).GetComponent<Image>();
		image_banner_option_2 = ((Component)option_2.FindRecursive("Image")).GetComponent<Image>();
		((Component)option_1).gameObject.SetActive(meta_asset.option_1_editable);
		((Component)option_2).gameObject.SetActive(meta_asset.option_2_editable);
		((Component)colors).gameObject.SetActive(meta_asset.color_editable);
	}

	protected virtual void setupButtons()
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Expected O, but got Unknown
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Expected O, but got Unknown
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Expected O, but got Unknown
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Expected O, but got Unknown
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Expected O, but got Unknown
		//IL_011a: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_0125: Unknown result type (might be due to invalid IL or missing references)
		//IL_012a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0155: Unknown result type (might be due to invalid IL or missing references)
		//IL_0156: Unknown result type (might be due to invalid IL or missing references)
		//IL_0187: Unknown result type (might be due to invalid IL or missing references)
		//IL_0191: Expected O, but got Unknown
		((UnityEvent)((Component)option_1.FindRecursive("Left")).GetComponent<Button>().onClick).AddListener(new UnityAction(option1Left));
		((UnityEvent)((Component)option_1.FindRecursive("Right")).GetComponent<Button>().onClick).AddListener(new UnityAction(option1Right));
		((UnityEvent)((Component)option_2.FindRecursive("Left")).GetComponent<Button>().onClick).AddListener(new UnityAction(option2Left));
		((UnityEvent)((Component)option_2.FindRecursive("Right")).GetComponent<Button>().onClick).AddListener(new UnityAction(option2Right));
		((UnityEvent)((Component)((Component)this).transform.FindRecursive("Randomize")).GetComponent<Button>().onClick).AddListener(new UnityAction(randomize));
		ColorElement color_element_prefab = ((Component)this).GetComponentInParent<CustomizeWindow>().color_element_prefab;
		for (int i = 0; i < meta_asset.color_count(); i++)
		{
			int tIndex = i;
			ColorAsset colorByIndex = meta_asset.color_library().getColorByIndex(tIndex);
			Color colorMainSecond = colorByIndex.getColorMainSecond();
			Color pInner = Color32.op_Implicit(colorByIndex.getColorBorderInsideAlpha32());
			ColorElement tColorElement = Object.Instantiate<ColorElement>(color_element_prefab, colors_parent);
			_color_elements.Add(tColorElement);
			tColorElement.setColor(colorMainSecond, pInner);
			tColorElement.index = i;
			tColorElement.asset = meta_asset;
			tColorElement.setAction((UnityAction)delegate
			{
				clickColorElement(tColorElement, tIndex);
			});
			((Component)tColorElement).gameObject.GetComponent<TipButton>().setHoverAction(tColorElement.showTooltip, pAddAnimation: false);
		}
	}

	protected virtual void setupBanner()
	{
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		TBanner val = Resources.Load<TBanner>(meta_asset.banner_prefab_id);
		if ((Object)(object)val == (Object)null)
		{
			Debug.LogWarning((object)("Banner prefab for " + meta_asset.banner_prefab_id + " could not be found"));
		}
		banner = Object.Instantiate<TBanner>(val);
		banner.enable_default_click = false;
		((Component)banner).transform.localScale = Vector3.one;
		((Component)banner).transform.SetParent(banner_area);
		LayoutElement obj = ((Component)banner).gameObject.AddComponent<LayoutElement>();
		obj.ignoreLayout = true;
		((Behaviour)obj).enabled = false;
		((Component)banner).gameObject.AddComponent<DragSnapElement>().fly_back_parent = ((Component)banner).transform.FindParentWithName("Viewport");
		RectTransform component = ((Component)banner).GetComponent<RectTransform>();
		component.SetAnchor(AnchorPresets.MiddleCenter);
		((Transform)component).localScale = Vector3.one;
	}

	protected virtual void setupTexts()
	{
		title.setKeyAndUpdate(meta_asset.title_locale);
		if (meta_asset.option_1_editable)
		{
			title_option_1.setKeyAndUpdate(meta_asset.option_1_locale);
		}
		if (meta_asset.option_2_editable)
		{
			title_option_2.setKeyAndUpdate(meta_asset.option_2_locale);
		}
		if (meta_asset.color_editable)
		{
			title_color.setKeyAndUpdate(meta_asset.color_locale);
		}
	}

	protected virtual void setupImages()
	{
		icon_banner.sprite = SpriteTextureLoader.getSprite("ui/Icons/" + meta_asset.icon_banner);
		icon_top.sprite = SpriteTextureLoader.getSprite("ui/Icons/" + meta_asset.icon_creature);
	}

	protected virtual void updateCounters()
	{
		if (meta_asset.option_1_editable)
		{
			counter_option_1.text = meta_asset.option_1_get() + 1 + "/" + meta_asset.option_1_count();
		}
		if (meta_asset.option_2_editable)
		{
			counter_option_2.text = meta_asset.option_2_get() + 1 + "/" + meta_asset.option_2_count();
		}
		if (meta_asset.color_editable)
		{
			counter_color.text = meta_asset.color_get() + 1 + "/" + meta_asset.color_count();
		}
	}

	protected virtual void updateBanner()
	{
		banner.normalize();
		banner.updateColor();
	}

	protected virtual void updateSelection()
	{
		updateCounters();
		updateColors();
		onBannerChange();
	}

	protected virtual void onBannerChange()
	{
	}

	public void randomize()
	{
		meta_object.generateBanner();
		ColorAsset random = meta_asset.color_library().list.GetRandom();
		banner.color = meta_asset.color_library().list.IndexOf(random);
		reselectAllColors();
		_color_elements[banner.color].setSelected(pSelected: true);
		apply();
	}

	public void option1Left()
	{
		banner.option_1 -= getChangeValue();
		apply();
	}

	public void option1Right()
	{
		banner.option_1 += getChangeValue();
		apply();
	}

	public void option2Left()
	{
		banner.option_2 -= getChangeValue();
		apply();
	}

	public void option2Right()
	{
		banner.option_2 += getChangeValue();
		apply();
	}

	private void colorSet(int pIndex)
	{
		banner.color = pIndex;
		apply();
	}

	private void reselectAllColors()
	{
		foreach (ColorElement color_element in _color_elements)
		{
			color_element.setSelected(pSelected: false);
		}
	}

	private void clickColorElement(ColorElement pElement, int pIndex)
	{
		reselectAllColors();
		colorSet(pIndex);
		pElement.setSelected(pSelected: true);
	}
}
// --- End of File: GenericCustomizeWindow.cs ---



// --- Start of File: GenericTest.cs ---
using System.Collections.Generic;

public class GenericTest
{
	private List<object> list = new List<object>();

	public T get<T>(int pI) where T : class
	{
		return list[pI] as T;
	}

	public void Add(object pObject)
	{
		list.Add(pObject);
	}
}
// --- End of File: GenericTest.cs ---



// --- Start of File: GenericType.cs ---
public class GenericType
{
}
// --- End of File: GenericType.cs ---



// --- Start of File: GenomePart.cs ---
using System;

public readonly struct GenomePart : IEquatable<GenomePart>
{
	public readonly string id;

	public readonly float value;

	public GenomePart(string id, float pValue)
	{
		if (string.IsNullOrEmpty(id))
		{
			throw new ArgumentNullException("id cannot be null or empty");
		}
		this.id = id;
		value = pValue;
	}

	public override bool Equals(object pObject)
	{
		if (pObject is GenomePart pOther)
		{
			return Equals(pOther);
		}
		return false;
	}

	public bool Equals(GenomePart pOther)
	{
		return string.Equals(id, pOther.id, StringComparison.OrdinalIgnoreCase);
	}

	public override int GetHashCode()
	{
		return StringComparer.OrdinalIgnoreCase.GetHashCode(id);
	}

	public override string ToString()
	{
		return $"{id}: {value}";
	}
}
// --- End of File: GenomePart.cs ---



// --- Start of File: GetColorForMapIcon.cs ---
using UnityEngine;

public delegate Color32 GetColorForMapIcon(Building pBuilding);
// --- End of File: GetColorForMapIcon.cs ---



// --- Start of File: GetCurrentOnomasticsData.cs ---
public delegate OnomasticsData GetCurrentOnomasticsData();
// --- End of File: GetCurrentOnomasticsData.cs ---



// --- Start of File: GetEffectSprite.cs ---
using UnityEngine;

public delegate Sprite GetEffectSprite(BaseSimObject pObject, int pIndex);
// --- End of File: GetEffectSprite.cs ---



// --- Start of File: GetEffectSpriteCount.cs ---
public delegate int GetEffectSpriteCount(BaseSimObject pObject, StatusAsset pAsset);
// --- End of File: GetEffectSpriteCount.cs ---



// --- Start of File: GetEffectSpritePosition.cs ---
using UnityEngine;

public delegate Vector3 GetEffectSpritePosition(BaseSimObject pObject, int pIndex);
// --- End of File: GetEffectSpritePosition.cs ---



// --- Start of File: GetEffectSpritePositionUI.cs ---
using UnityEngine;

public delegate Vector3 GetEffectSpritePositionUI(AvatarEffect pEffect, int pIndex);
// --- End of File: GetEffectSpritePositionUI.cs ---



// --- Start of File: GetEffectSpriteRotationZ.cs ---
public delegate float GetEffectSpriteRotationZ(BaseSimObject pObject, int pIndex);
// --- End of File: GetEffectSpriteRotationZ.cs ---



// --- Start of File: GetEffectSpriteRotationZUI.cs ---
public delegate float GetEffectSpriteRotationZUI(AvatarEffect pEffect, int pIndex);
// --- End of File: GetEffectSpriteRotationZUI.cs ---



// --- Start of File: GetEffectSpriteUI.cs ---
using UnityEngine;

public delegate Sprite GetEffectSpriteUI(AvatarEffect pEffect, int pIndex);
// --- End of File: GetEffectSpriteUI.cs ---



// --- Start of File: GetHitAction.cs ---
using System;

[Serializable]
public delegate bool GetHitAction(BaseSimObject pSelf, BaseSimObject pAttackedBy = null, WorldTile pTile = null);
// --- End of File: GetHitAction.cs ---



// --- Start of File: GetListOfObjectsFunc.cs ---
using System.Collections.Generic;

public delegate IEnumerable<TMetaObject> GetListOfObjectsFunc<TListElement, TMetaObject, TData, TComponent>(TComponent pComponent) where TListElement : WindowListElementBase<TMetaObject, TData> where TMetaObject : CoreSystemObject<TData> where TData : BaseSystemData where TComponent : ComponentListBase<TListElement, TMetaObject, TData, TComponent>;
// --- End of File: GetListOfObjectsFunc.cs ---



// --- Start of File: GetMetaFromActor.cs ---
public delegate IMetaObject GetMetaFromActor(Actor pActor);
// --- End of File: GetMetaFromActor.cs ---



// --- Start of File: GetMetaTotalFromActor.cs ---
public delegate ListPool<IMetaObject> GetMetaTotalFromActor(Actor pActor);
// --- End of File: GetMetaTotalFromActor.cs ---



// --- Start of File: GetNextJobID.cs ---
public delegate string GetNextJobID();
// --- End of File: GetNextJobID.cs ---



// --- Start of File: GetWorldUnits.cs ---
using System.Collections.Generic;

public delegate List<Actor> GetWorldUnits();
// --- End of File: GetWorldUnits.cs ---



// --- Start of File: Globals.cs ---
using UnityEngine;

public class Globals
{
	public const string HIDDEN_ID = "[HIDDEN]";

	public const int TOTAL_AGE_SLOTS = 8;

	public const long NEUTRAL_KINGDOM_NUMERIC_ID = 0L;

	public const int PAST_RULERS_LIMIT = 30;

	public const int TOTAL_RANKS = 10;

	public const float UNIT_COLOR_EFFECT_TIME = 0.3f;

	public const float PLOT_REMOVAL_EFFECT_TIME = 1f;

	public const int CITY_ITEMS_MAX = 15;

	public const int CITY_MIN_ISLAND_TILES = 300;

	public const int CITY_MIN_CAN_BE_FARMS_TILES = 5;

	public const float CITY_TIMER_SUPPLY_DEFAULT = 30f;

	public const float REGION_UPDATE_TIMEOUT = 0.5f;

	public const int DEFAULT_CONSTRUCTION_SPEED = 2;

	public const int HAPPINESS_FROM_BREEDING_ACTION = 40;

	public const float FAST_SWIMMING_SPEED_MULTIPLIER = 5f;

	public const int CULTURE_SPREAD_CHANCE_FROM_BOOK = 3;

	public const int CULTURE_SPREAD_CHANCE_FROM_TALK = 3;

	public const int LANGUAGE_SPREAD_CHANCE_FROM_TALK = 3;

	public const int LANGUAGE_SPREAD_CHANCE_FROM_BOOK = 3;

	public const int RELIGION_SPREAD_CHANCE_FROM_TALK = 3;

	public const int RELIGION_SPREAD_CHANCE_FROM_BOOK = 3;

	public const int CITY_POP_FOR_SETTLE_TARGET = 22;

	public static readonly bool AI_TEST_ACTIVE = true;

	public const float DEFAULT_SCALE_EFFECT = 0.25f;

	public const float DEFAULT_SCALE_UNIT = 0.1f;

	public const float DEFAULT_SCALE_BUILDING = 0.25f;

	public const float DEFAULT_ARROW_START_HEIGHT = 0.6f;

	public const float DEFAULT_PROJECTILE_START_HEIGHT = 0.2f;

	public const float DEFAULT_SLASH_POSITION = 0.5f;

	public const float DEFAULT_UNIT_SPEED = 10f;

	public const float DEFAULT_UNIT_SPEED_MIN = 4f;

	public const float SPEED_MULTIPLIER_IN_LIQUID_WITHOUT_STAMINA = 0.4f;

	public const float ACCURACY_MIN = 1f;

	public const float ACCURACY_MAX = 10f;

	public const float FIRE_EXTINGUISH_CHANCE_FROM_RAIN = 0.9f;

	public static readonly bool DIAGNOSTIC = false;

	public static readonly bool TRAILER_MODE = false;

	public static bool TRAILER_MODE_USE_RESOURCES = true;

	public static bool TRAILER_MODE_UPGRADE_BUILDINGS = true;

	public const int BOAT_TYPE_LIMIT_PER_DOCK = 1;

	public const int CAST_HEIGHT = 15;

	public const int UNITS_IN_SPAWNER_PER_REGION = 4;

	public const int PATHFINDER_REGION_LIMIT = 4;

	public const float DAYS_IN_YEAR = 360f;

	public const float DAYS_IN_MONTH = 30f;

	public const float MONTHS_IN_YEAR = 12f;

	public const float MONTH_TIME = 5f;

	public const float YEAR_TIME = 60f;

	public const int ATTRIBUTE_BAD = 4;

	public const int ATTRIBUTE_NORMAL = 9;

	public const int ATTRIBUTE_GOOD = 20;

	public const int BUILDING_TOWER_CAPTURE_POINTS = 10;

	public const int GENERATOR_MAX_TREES_PER_ZONE = 3;

	public const float MIN_ADS_INTERVAL_MINUTES = 2f;

	public const float ADS_INTERVAL_MINUTES = 5f;

	public static readonly bool specialAbstudio = false;

	public const float SAME_GRASS_CHANCE = 0.05f;

	public const int GREY_GOO_DAMAGE = 50;

	public const int DAMAGE_ACID = 20;

	public const int DAMAGE_HEAT = 50;

	public const int MINIMUM_UNITS_IN_CITY_BEFORE_POP_POINTS = 50;

	public const int CITIZEN_FOOD_COST = 1;

	public const int ZONES_BETWEEN_CITIES = 3;

	public const int BOMB_RANGE_ATOMIC_NUKE = 30;

	public const int BOMB_RANGE_CZAR_BOMB = 70;

	public const float SHAKE_DURATION = 0.3f;

	public const float SHAKE_INTERVAL = 0.01f;

	public const float SHAKE_INTENSITY = 2f;

	public const bool SHAKE_X = false;

	public const bool SHAKE_Y = true;

	public const float COUNTER_TWEEN_DURATION = 0.45f;

	public const int ANIMAL_BABY_MAKING_UNITS_AROUND_LIMIT = 6;

	public const int FOOD_FROM_FISH = 1;

	public const int FOOD_FROM_TILE = 1;

	public const int FOOD_FROM_FARM = 2;

	public const int FARM_DISTANCE_AREA = 9;

	public const int ANIMAL_GOOD_FOR_HUNTING_AGE = 3;

	public const int MAX_UNIT_LEVEL = 9999;

	public const int BOAT_UNITS_LIMIT = 100;

	public const int TRANSPORT_WAIT_TRY_LIMIT = 4;

	public const float COLORS_ZONE_ALPHA = 0.78f;

	public const int ISLAND_TILES_FOR_DOCKS = 2500;

	public const int FOOD_BUSH_REGROW_TIME = 90;

	public const int FOOD_BEEHIVE_FULL = 10;

	internal const int REWARD_MINUTES = 30;

	internal const int REWARD_MINUTES_CLOCK = 720;

	internal const int REWARD_HOURS_CLOCK = 12;

	internal const int REWARD_DURATION = 1800;

	internal const int REWARD_DURATION_CLOCK = 43200;

	internal const int REWARD_SAVESLOT_HOURS = 3;

	internal const int REWARD_SAVESLOT_DURATION = 10800;

	internal const int REWARDS_PER_GIFT = 3;

	internal const int FREE_SAVE_SLOTS = 15;

	internal const int REWARD_AD_SAVESLOTS_OLD = 6;

	internal const int REWARD_AD_SAVESLOTS_10HRS = 3;

	internal const int REWARD_AD_SAVESLOTS_20HRS = 6;

	internal const int DISCORD_MEMBERS = 560000;

	internal const int FACEBOOK_MEMBERS = 82000;

	internal const int TWITTER_MEMBERS = 56000;

	internal const int REDDIT_MEMBERS = 140000;

	internal const string WB_EXAMPLE_MAP = "WB-5555-1166-5555";

	public const int TIMEOUT_CONQUER = 300;

	public static readonly Vector3 POINT_IN_VOID = new Vector3(-1000000f, -1000000f);

	public static readonly Vector2 POINT_IN_VOID_2 = new Vector2(-1000000f, -1000000f);

	public const string NORMAL = "0";

	public const int RATE_US_ID = 12;

	public const string voteLink = "https://play.google.com/store/apps/details?id=com.mkarpenko.worldbox";

	internal static Vector3 emptyVector = new Vector3(-100000f, -10000f);

	public const int TOTAL_WORLD_AGE_SLOTS = 8;
}
// --- End of File: Globals.cs ---



// --- Start of File: GlobusPreview.cs ---
using System;
using System.Collections;
using System.IO;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.Networking;
using UnityEngine.UI;

public class GlobusPreview : MonoBehaviour
{
	public bool use_current_world_info;

	public Image main_image_1;

	public Image main_image_2;

	public GameObject images_parent;

	public Image clouds;

	public Sprite preview_default;

	private float _tweenSpeed = 18f;

	private float _gap_size = 25f;

	private float _box_size = 100f;

	private void OnEnable()
	{
		if (Config.game_loaded)
		{
			if (use_current_world_info)
			{
				setCurrentWorldSprite();
			}
			else if (SaveManager.currentWorkshopMapData != null)
			{
				setWorkshopSlotSprite();
			}
			else
			{
				startLoadCurrentSaveSlotSprite();
			}
			startTweenGlobus();
		}
	}

	private void startLoadCurrentSaveSlotSprite()
	{
		((MonoBehaviour)this).StartCoroutine(loadSaveSlotImage());
	}

	private void setCurrentWorldSprite()
	{
		Sprite currentWorldPreview = PreviewHelper.getCurrentWorldPreview();
		setSprites(currentWorldPreview);
	}

	private void setWorkshopSlotSprite()
	{
		Sprite sprites = PreviewHelper.loadWorkshopMapPreview();
		setSprites(sprites);
	}

	private void setSprites(Sprite pSprite)
	{
		makeGradient(pSprite);
		main_image_1.sprite = pSprite;
		main_image_2.sprite = pSprite;
	}

	private void showDefaultImage()
	{
		main_image_1.sprite = preview_default;
		main_image_2.sprite = preview_default;
	}

	private IEnumerator loadSaveSlotImage()
	{
		string path = SaveManager.getCurrentPreviewPath();
		if (string.IsNullOrEmpty(path) || !File.Exists(path))
		{
			showDefaultImage();
			yield break;
		}
		UnityWebRequest webRequest = UnityWebRequestTexture.GetTexture("file://" + path);
		try
		{
			yield return webRequest.SendWebRequest();
			if ((int)webRequest.result == 3 || (int)webRequest.result == 2)
			{
				showDefaultImage();
				yield break;
			}
			Texture2D content = DownloadHandlerTexture.GetContent(webRequest);
			((Object)content).name = "save_slot_preview_" + Path.GetFileNameWithoutExtension(path);
			Sprite sprites = Sprite.Create(content, new Rect(0f, 0f, (float)((Texture)content).width, (float)((Texture)content).height), new Vector2(0.5f, 0.5f));
			setSprites(sprites);
		}
		finally
		{
			((IDisposable)webRequest)?.Dispose();
		}
	}

	private void makeGradient(Sprite pSprite)
	{
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		float num = (float)((Texture)pSprite.texture).width * 0.1f;
		Texture2D texture = pSprite.texture;
		((Object)texture).name = "gradient_" + ((Object)texture).name;
		for (int i = 0; (float)i < num; i++)
		{
			for (int j = 0; j < ((Texture)texture).height; j++)
			{
				int num2 = i;
				Color pixel = texture.GetPixel(num2, j);
				pixel.a = (float)num2 / num;
				texture.SetPixel(num2, j, pixel);
				num2 = ((Texture)pSprite.texture).width - i;
				pixel = texture.GetPixel(num2, j);
				pixel.a = (float)i / num;
				texture.SetPixel(num2, j, pixel);
			}
		}
		texture.Apply();
	}

	private void startTweenGlobus()
	{
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Expected O, but got Unknown
		float num = _box_size + _gap_size;
		float num2 = num / _tweenSpeed;
		ShortcutExtensions.DOKill((Component)(object)images_parent.transform, false);
		images_parent.transform.localPosition = new Vector3(_gap_size, 0f, 0f);
		((Tween)TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMove(images_parent.transform, new Vector3(0f - num, 0f, 0f), num2, false), (Ease)1)).onComplete = new TweenCallback(tweenLoop);
	}

	private void tweenLoop()
	{
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Expected O, but got Unknown
		float num = _box_size + _gap_size;
		float num2 = num / _tweenSpeed;
		images_parent.transform.localPosition = new Vector3(0f, 0f, 0f);
		((Tween)TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMove(images_parent.transform, new Vector3(0f - num, 0f, 0f), num2, false), (Ease)1)).onComplete = new TweenCallback(tweenLoop);
	}
}
// --- End of File: GlobusPreview.cs ---



// --- Start of File: GlowParticles.cs ---
using UnityEngine;

public class GlowParticles : MonoBehaviour
{
	private float cooldown;

	public ParticleSystem particles;

	private void Awake()
	{
		particles = ((Component)this).GetComponent<ParticleSystem>();
	}

	private void Update()
	{
		if (cooldown > 0f)
		{
			cooldown -= Time.deltaTime;
		}
	}

	public void spawn(float pX, float pY, bool pRemoveCooldown = false)
	{
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		if (((Behaviour)this).enabled && particles.particleCount <= 50 && MapBox.isRenderGameplay())
		{
			if (pRemoveCooldown)
			{
				cooldown = 0f;
			}
			if (!(cooldown > 0f))
			{
				cooldown = 0.2f + Randy.randomFloat(0f, 0.3f);
				EmitParams val = default(EmitParams);
				((EmitParams)(ref val)).position = new Vector3(pX, pY);
				particles.Emit(val, 1);
			}
		}
	}

	public void spawn(Vector3 pPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		spawn(pPos.x, pPos.y);
	}

	public void clear()
	{
		particles.Clear();
	}
}
// --- End of File: GlowParticles.cs ---



// --- Start of File: GodFinger.cs ---
using System.Collections.Generic;
using UnityEngine;
using ai.behaviours;

public class GodFinger : BaseActorComponent
{
	public const float FLYING_SPEED = 8f;

	public const int MAX_TARGET_TILES = 1200;

	internal GodPower god_power;

	internal string brush;

	internal float flying_target = 8f;

	private float _rotate_wiggle = 30f;

	internal static string[] power_over_water = Toolbox.splitStringIntoArray("tile_high_soil#10", "tile_soil#10", "tile_hills", "tile_mountains", "tile_summit", "shovel_plus");

	internal static string[] power_over_ground = Toolbox.splitStringIntoArray("seeds_candy", "seeds_corrupted", "seeds_crystal", "seeds_desert", "seeds_enchanted", "seeds_grass", "seeds_infernal", "seeds_jungle", "seeds_lemon", "seeds_mushroom", "seeds_permafrost", "seeds_savanna", "seeds_swamp", "seeds_birch", "seeds_maple", "seeds_flower", "seeds_garlic", "seeds_rocklands", "seeds_celestial", "seeds_singularity", "seeds_clover", "seeds_paradox", "fertilizer_plants#4", "fertilizer_trees#4");

	internal HashSet<WorldTile> target_tiles = new HashSet<WorldTile>(1800);

	internal FingerTarget finger_target;

	private SpriteAnimation fingerTip;

	internal Color debug_color;

	private static Color[] _random_colors = (Color[])(object)new Color[20]
	{
		Toolbox.color_green,
		Toolbox.color_red,
		Toolbox.color_blue,
		Toolbox.color_yellow,
		Toolbox.color_purple,
		Color32.op_Implicit(Toolbox.color_fire),
		Color32.op_Implicit(Toolbox.color_phenotype_green_0),
		Color32.op_Implicit(Toolbox.color_phenotype_green_1),
		Color32.op_Implicit(Toolbox.color_phenotype_green_2),
		Color32.op_Implicit(Toolbox.color_phenotype_green_3),
		Color32.op_Implicit(Toolbox.color_magenta_0),
		Color32.op_Implicit(Toolbox.color_magenta_1),
		Color32.op_Implicit(Toolbox.color_magenta_2),
		Color32.op_Implicit(Toolbox.color_magenta_3),
		Color32.op_Implicit(Toolbox.color_magenta_4),
		Color32.op_Implicit(Toolbox.color_teal_0),
		Color32.op_Implicit(Toolbox.color_teal_1),
		Color32.op_Implicit(Toolbox.color_teal_2),
		Color32.op_Implicit(Toolbox.color_teal_3),
		Color32.op_Implicit(Toolbox.color_teal_4)
	};

	internal bool is_drawing
	{
		get
		{
			if (actor.ai.hasTask())
			{
				return (actor.ai.action as BehFinger)?.drawing_action ?? false;
			}
			return false;
		}
	}

	internal bool drawing_over_water => finger_target == FingerTarget.Water;

	internal bool drawing_over_ground => finger_target == FingerTarget.Ground;

	internal override void create(Actor pActor)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		base.create(pActor);
		debug_color = _random_colors.GetRandom();
		((Object)((Component)this).gameObject).name = "GF " + actor.getID();
		fingerTip = ((Component)((Component)this).transform.Find("Tip")).gameObject.GetComponent<SpriteAnimation>();
		((Component)fingerTip).gameObject.SetActive(false);
		actor.target_angle = Vector3.zero;
		actor.setFlying(pVal: true);
		actor.position_height = 8f;
	}

	internal void lightAction()
	{
		AchievementLibrary.god_finger_lightning.check();
	}

	public override void update(float pElapsed)
	{
		//IL_01b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
		if (!actor.isAlive() || World.world.isPaused())
		{
			return;
		}
		bool flag = is_drawing;
		bool flag2 = !flag && flying_target < 2f;
		if (flag)
		{
			actor.target_angle.z = Mathf.Clamp(actor.target_angle.z, 25f, 35f);
			if (actor.target_angle.z < _rotate_wiggle)
			{
				actor.target_angle.z += 100f * pElapsed;
			}
			else if (actor.target_angle.z > _rotate_wiggle)
			{
				actor.target_angle.z -= 100f * pElapsed;
			}
			else
			{
				_rotate_wiggle = Randy.randomInt(25, 35);
			}
			actor.rotation_cooldown = 300f;
		}
		else if (flag2)
		{
			if (actor.target_angle.z < 30f)
			{
				actor.target_angle.z += 100f * pElapsed;
			}
			actor.rotation_cooldown = 300f;
		}
		else
		{
			actor.rotation_cooldown = 0f;
		}
		if (flying_target != actor.position_height)
		{
			actor.position_height = Mathf.MoveTowards(actor.position_height, flying_target, pElapsed * 8f);
		}
		((Component)fingerTip).gameObject.SetActive(flag);
		if (flag)
		{
			fingerTip.update(pElapsed);
			if (isInMapBounds(Vector2.op_Implicit(actor.current_position)))
			{
				drawOnTile(actor.current_tile);
			}
		}
	}

	private bool isInMapBounds(Vector3 pPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		if (pPos.x > 0f && pPos.y > 0f && pPos.x < (float)MapBox.width)
		{
			return pPos.y < (float)MapBox.height;
		}
		return false;
	}

	public void drawOnTile(WorldTile pTile)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		World.world.conway_layer.checkKillRange(pTile.pos, 2);
		string current_brush = Config.current_brush;
		Config.current_brush = brush;
		if (god_power.click_power_action != null || god_power.click_power_brush_action != null)
		{
			if (god_power.click_power_brush_action != null)
			{
				god_power.click_power_brush_action(pTile, god_power);
			}
			else if (god_power.click_power_action != null)
			{
				god_power.click_power_action(pTile, god_power);
			}
		}
		if (god_power.click_action != null || god_power.click_brush_action != null)
		{
			if (god_power.click_brush_action != null)
			{
				god_power.click_brush_action(pTile, god_power.id);
			}
			else if (god_power.click_action != null)
			{
				god_power.click_action(pTile, god_power.id);
			}
		}
		World.world.loopWithBrush(pTile, Config.current_brush_data, clearTargets, "god_finger");
		World.world.loopWithBrush(pTile, Brush.get(2), fingerTile, "god_finger");
		Config.current_brush = current_brush;
	}

	public bool clearTargets(WorldTile pTile, string pPowerID)
	{
		target_tiles.Remove(pTile);
		return true;
	}

	public bool fingerTile(WorldTile pTile, string pPowerID)
	{
		pTile.doUnits(delegate(Actor pActor)
		{
			if (!pActor.asset.flag_finger && pActor.asset.can_be_killed_by_stuff)
			{
				pActor.getHitFullHealth(AttackType.Gravity);
			}
		});
		return true;
	}

	public override void Dispose()
	{
		target_tiles.Clear();
		finger_target = FingerTarget.None;
		base.Dispose();
	}

	internal static bool deathFlip(BaseSimObject pTarget, WorldTile pTile, float pElapsed)
	{
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		Actor a = pTarget.a;
		if (a.isFalling())
		{
			a.updateFall();
			return true;
		}
		if (a.target_angle.z < 90f)
		{
			a.target_angle.z = Mathf.Lerp(a.target_angle.z, 90f, pElapsed * 4f);
			if (a.target_angle.z > 90f)
			{
				a.target_angle.z = 90f;
			}
			if (!a.is_visible)
			{
				a.updateRotation();
			}
			if (Mathf.Abs(a.current_rotation.z) >= 89f)
			{
				a.dieAndDestroy(AttackType.None);
				return true;
			}
		}
		a.updateDeadBlackAnimation(pElapsed);
		return true;
	}

	public static void debug_trail(GodFinger pFinger)
	{
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		if (!DebugConfig.isOn(DebugOption.ShowGodFingerTargetting) || !MapBox.isRenderGameplay() || !pFinger.actor.is_visible)
		{
			return;
		}
		AiSystemActor ai = pFinger.actor.ai;
		if (ai.hasTask())
		{
			Color color_white = Toolbox.color_white;
			switch (ai.task.id)
			{
			default:
				return;
			case "godfinger_move":
				color_white = Toolbox.color_blue;
				break;
			case "godfinger_find_target":
				color_white = Toolbox.color_red;
				break;
			case "godfinger_random_fun_move":
				color_white = Toolbox.color_green;
				break;
			case "godfinger_circle_move":
				color_white = Toolbox.color_purple;
				break;
			case "godfinger_circle_move_big":
				color_white = Toolbox.color_yellow;
				break;
			case "godfinger_circle_move_small":
				color_white = Color32.op_Implicit(Toolbox.color_fire);
				break;
			}
			BaseEffect baseEffect = EffectsLibrary.spawn("fx_weapon_particle", null, null, null, 0f, ((Component)pFinger.fingerTip).transform.position.x, ((Component)pFinger.fingerTip).transform.position.y);
			if ((Object)(object)baseEffect != (Object)null)
			{
				((StatusParticle)baseEffect).spawnParticle(((Component)baseEffect).transform.position, color_white);
			}
		}
	}
}
// --- End of File: GodFinger.cs ---



// --- Start of File: GodPower.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using Newtonsoft.Json;
using UnityEngine;

[Serializable]
public class GodPower : Asset, IDescriptionAsset, ILocalizedAsset
{
	internal static List<PowerButton> powers_rank_0 = new List<PowerButton>();

	internal static List<PowerButton> powers_rank_1 = new List<PowerButton>();

	internal static List<PowerButton> powers_rank_2 = new List<PowerButton>();

	internal static List<PowerButton> powers_rank_3 = new List<PowerButton>();

	internal static List<PowerButton> powers_rank_4 = new List<PowerButton>();

	internal static List<PowerButton> premium_buttons = new List<PowerButton>();

	internal static List<GodPower> premium_powers = new List<GodPower>();

	internal static Dictionary<string, GodPower> god_powers_on_canvas = new Dictionary<string, GodPower>();

	public string name = "DEFAULT NAME";

	public bool requires_premium;

	[DefaultValue(PowerRank.Rank0_free)]
	public PowerRank rank;

	public string path_icon;

	public bool multiple_spawn_tip;

	public bool show_unit_stats_overview;

	public bool show_tool_sizes;

	public bool unselect_when_window;

	public bool make_buildings_transparent;

	[DefaultValue(MetaType.None)]
	public MetaType force_map_mode;

	public bool ignore_cursor_icon;

	public bool hold_action;

	public float click_interval;

	public float particle_interval;

	[DefaultValue(0.95f)]
	public float falling_chance = 0.95f;

	public string sound_drawing;

	public string sound_event;

	public string tile_type;

	[NonSerialized]
	internal TileType cached_tile_type_asset;

	public string top_tile_type;

	[NonSerialized]
	internal TopTileType cached_top_tile_type_asset;

	public string drop_id;

	[NonSerialized]
	internal DropAsset cached_drop_asset;

	public string force_brush;

	public bool terraform;

	public bool draw_lines;

	[DefaultValue(PowerActionType.PowerSpecial)]
	public PowerActionType type;

	[DefaultValue(MouseHoldAnimation.Default)]
	public MouseHoldAnimation mouse_hold_animation;

	public bool highlight;

	public PowerActionWithID click_brush_action;

	public PowerActionWithID click_action;

	public PowerActionWithID click_special_action;

	public PowerAction click_power_brush_action;

	public PowerAction click_power_action;

	public PowerButtonClickAction select_button_action;

	public bool disabled_on_mobile;

	public string toggle_name;

	public bool multi_toggle;

	public PowerToggleAction toggle_action;

	public string actor_asset_id;

	public string[] actor_asset_ids;

	[DefaultValue(6f)]
	public float actor_spawn_height = 6f;

	public bool show_spawn_effect;

	public string printers_print;

	public bool ignore_fast_spawn;

	public bool set_used_camera_drag_on_long_move;

	public bool can_drag_map;

	[DefaultValue(true)]
	public bool tester_enabled = true;

	[DefaultValue(true)]
	public bool track_activity = true;

	public bool map_modes_switch;

	public bool allow_unit_selection;

	public bool show_close_actor;

	[DefaultValue(true)]
	public bool activate_on_hotkey_select = true;

	[DefaultValue(true)]
	public bool surprises_units = true;

	[NonSerialized]
	public Sprite sprite_icon;

	[JsonIgnore]
	public bool has_sound_drawing => sound_drawing != null;

	[JsonIgnore]
	public bool has_sound_event => sound_event != null;

	[JsonIgnore]
	public OptionAsset option_asset => AssetManager.options_library.get(toggle_name);

	public bool isSelected()
	{
		return PowerButtonSelector.instance.selectedButton?.godPower == this;
	}

	public bool isAvailable()
	{
		return true;
	}

	internal static void addPower(GodPower pPower, PowerButton pButton)
	{
		god_powers_on_canvas[pPower.id] = pPower;
		if (pPower.requires_premium)
		{
			premium_powers.Add(pPower);
			premium_buttons.Add(pButton);
		}
		if (!pPower.requires_premium)
		{
			powers_rank_0.Add(pButton);
			return;
		}
		switch (pPower.rank)
		{
		case PowerRank.Rank1_common:
			powers_rank_1.Add(pButton);
			break;
		case PowerRank.Rank2_normal:
			powers_rank_2.Add(pButton);
			break;
		case PowerRank.Rank3_good:
			powers_rank_3.Add(pButton);
			break;
		case PowerRank.Rank4_awesome:
			powers_rank_4.Add(pButton);
			break;
		case PowerRank.Rank0_free:
		case PowerRank.Rank5_noAwards:
			break;
		}
	}

	public Sprite getIconSprite()
	{
		return SpriteTextureLoader.getSprite("ui/Icons/" + path_icon);
	}

	public static void diagnostic()
	{
		LogText.log("Ranked Powers", "Print");
		printRankedPowerButtons("rank0", powers_rank_0);
		printRankedPowerButtons("rank1", powers_rank_1);
		printRankedPowerButtons("rank2", powers_rank_2);
		printRankedPowerButtons("rank3", powers_rank_3);
		printRankedPowerButtons("rank4", powers_rank_4);
		printRankedPowers("premium powers", premium_powers);
	}

	private static void printRankedPowerButtons(string pID, List<PowerButton> pList)
	{
		string text = "";
		foreach (PowerButton p in pList)
		{
			text = text + p.godPower.id + ", ";
		}
		if (text.Length > 2)
		{
			text = text.Substring(0, text.Length - 2);
		}
		LogText.log(pID, text);
	}

	private static void printRankedPowers(string pID, List<GodPower> pList)
	{
		string text = "";
		foreach (GodPower p in pList)
		{
			text = text + p.id + ", ";
		}
		text = text.Substring(0, text.Length - 2);
		LogText.log(pID, text);
	}

	public string getActorAssetID()
	{
		if (actor_asset_id != null)
		{
			return actor_asset_id;
		}
		string[] array = actor_asset_ids;
		if (array != null && array.Length != 0)
		{
			return actor_asset_ids[0];
		}
		return null;
	}

	public ActorAsset getActorAsset()
	{
		return AssetManager.actor_library.get(getActorAssetID());
	}

	public string getLocaleID()
	{
		return name.Underscore();
	}

	public string getDescriptionID()
	{
		return getLocaleID() + "_description";
	}

	public string getTranslatedName()
	{
		return getLocaleID().Localize();
	}

	public string getTranslatedDescription()
	{
		return getDescriptionID().Localize();
	}
}
// --- End of File: GodPower.cs ---



// --- Start of File: GoogleInterstitialAd.cs ---
using System;
using System.Collections.Generic;
using Beebyte.Obfuscator;
using GoogleMobileAds.Api;
using UnityEngine;

[ObfuscateLiterals]
public class GoogleInterstitialAd : IWorldBoxAd
{
	private InterstitialAd interstitial;

	private static string _last_error = "";

	private static string _last_id = "";

	private static int _loaded = 0;

	private static int _failed = 0;

	internal static int default_current = 2;

	private static int _current = 2;

	private const int max_current = 3;

	private static string _admob_id = string.Empty;

	public Action<string> logger { get; set; }

	public Action adResetCallback { get; set; }

	public Action adFailedCallback { get; set; }

	public Action adFinishedCallback { get; set; }

	public Action adStartedCallback { get; set; }

	public void Reset()
	{
		log("reset to " + default_current);
		_current = default_current;
		_failed = 0;
		_loaded = 0;
		_last_error = "";
		_last_id = "";
	}

	private string getInterstitialAdUnitID()
	{
		log("[preint] " + _current);
		if (_failed > 1 && _loaded == 0)
		{
			_failed = 0;
			_current++;
			_current = Mathf.Clamp(_current, 0, 3);
			log("Level " + _current);
		}
		else if (_loaded > 2 && _current > 0)
		{
			_current--;
			_current = Mathf.Clamp(_current, 0, 3);
			log("Level " + _current);
		}
		return "unexpected_platform";
	}

	public void RequestAd()
	{
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Expected O, but got Unknown
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Expected O, but got Unknown
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Expected O, but got Unknown
		if (!Config.isMobile || Config.hasPremium)
		{
			return;
		}
		_admob_id = getInterstitialAdUnitID();
		KillAd();
		AdRequest val;
		if (Config.testAds)
		{
			log("Requesting Test Ad");
			val = new AdRequest();
			List<string> testDeviceIds = new List<string> { "38469EF1320047F75C548E8477B3583B", "6b80482efcca7c0f3f07a95f8be98fe6" };
			MobileAds.SetRequestConfiguration(new RequestConfiguration
			{
				TestDeviceIds = testDeviceIds
			});
		}
		else
		{
			log("Requesting Ad");
			val = new AdRequest();
		}
		InterstitialAd.Load(_admob_id, val, (Action<InterstitialAd, LoadAdError>)delegate(InterstitialAd ad, LoadAdError error)
		{
			ThreadHelper.ExecuteInUpdate(delegate
			{
				if (error != null || ad == null)
				{
					log("Callback error");
					HandleOnAdFailedToLoad(error);
				}
				else
				{
					HandleOnAdLoaded();
					interstitial = ad;
					interstitial.OnAdFullScreenContentOpened += HandleOnAdOpened;
					interstitial.OnAdFullScreenContentClosed += HandleOnAdClosed;
					interstitial.OnAdFullScreenContentFailed += HandleOnAdFailed;
					interstitial.OnAdPaid += HandleOnPaidEvent;
				}
			});
		});
	}

	public void HandleOnAdLoaded()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			_loaded++;
			_failed = 0;
			log("Ad Loaded");
		});
	}

	public void HandleOnAdFailedToLoad(LoadAdError pLoadAdError = null)
	{
		string tLoadError = "Failed to load ad";
		if (pLoadAdError != null)
		{
			tLoadError = ((AdError)pLoadAdError).GetMessage();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			_loaded = 0;
			_failed++;
			if (_last_error != tLoadError || _admob_id != _last_id)
			{
				log(_current + " " + _admob_id);
				log("<color=red>Failed Load: " + tLoadError + "</color>");
				_last_error = tLoadError;
				_last_id = _admob_id;
			}
			else
			{
				log("<color=red>Failed Load</color>");
			}
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
			if (tLoadError.Contains("floor") || tLoadError.Contains("fill") || tLoadError.Contains("configured"))
			{
				_failed++;
				if (_current < 3 && adResetCallback != null)
				{
					adResetCallback();
				}
			}
		});
	}

	public void HandleOnAdFailed(AdError pLoadAdError)
	{
		string tLoadError = "Failed to show ad";
		if (pLoadAdError != null)
		{
			tLoadError = pLoadAdError.GetMessage();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			_loaded = 0;
			_failed++;
			if (_last_error != tLoadError || _admob_id != _last_id)
			{
				log(_current + " " + _admob_id);
				log("<color=red>Ad Failed: " + tLoadError + "</color>");
				_last_error = tLoadError;
				_last_id = _admob_id;
			}
			else
			{
				log("<color=red>Ad Failed</color>");
			}
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
			if (tLoadError.Contains("floor") || tLoadError.Contains("fill") || tLoadError.Contains("configured"))
			{
				_failed++;
				if (_current < 3 && adResetCallback != null)
				{
					adResetCallback();
				}
			}
		});
	}

	public void HandleOnAdOpened()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			_loaded++;
			_failed = 0;
			log("Ad Opened");
			if (adStartedCallback != null)
			{
				adStartedCallback();
			}
		});
	}

	public void HandleOnAdClosed()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			_loaded++;
			_failed = 0;
			log("Ad Closed");
			KillAd();
			if (adFinishedCallback != null)
			{
				adFinishedCallback();
			}
		});
	}

	public void HandleOnPaidEvent(AdValue pAdValue)
	{
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		string tLog1 = "Rewarded interstitial ad has received a paid event. " + ((object)pAdValue).ToString();
		string[] obj = new string[6] { "Values: ", null, null, null, null, null };
		PrecisionType precision = pAdValue.Precision;
		obj[1] = ((object)(PrecisionType)(ref precision)).ToString();
		obj[2] = " ";
		obj[3] = pAdValue.Value.ToString();
		obj[4] = " ";
		obj[5] = pAdValue.CurrencyCode;
		string tLog2 = string.Concat(obj);
		ThreadHelper.ExecuteInUpdate(delegate
		{
			_loaded++;
			_failed = 0;
			log(tLog1);
			log(tLog2);
		});
	}

	public void KillAd()
	{
		if (interstitial != null)
		{
			interstitial.OnAdFullScreenContentOpened -= HandleOnAdOpened;
			interstitial.OnAdFullScreenContentClosed -= HandleOnAdClosed;
			interstitial.OnAdPaid -= HandleOnPaidEvent;
			interstitial.Destroy();
			interstitial = null;
		}
	}

	public bool IsReady()
	{
		if (interstitial != null)
		{
			return interstitial.CanShowAd();
		}
		return false;
	}

	public void ShowAd()
	{
		if (IsReady())
		{
			interstitial.Show();
		}
	}

	public bool HasAd()
	{
		if (!IsInitialized())
		{
			return false;
		}
		return interstitial != null;
	}

	public string GetProviderName()
	{
		return "AdMob Interstitial Ad";
	}

	public string GetColor()
	{
		return GoogleMobileAdsLoader.GetColor();
	}

	private void log(string pLog)
	{
		logger(GetColor() + " " + pLog);
	}

	public bool IsInitialized()
	{
		return GoogleMobileAdsLoader.initialized;
	}
}
// --- End of File: GoogleInterstitialAd.cs ---



// --- Start of File: GoogleMobileAdsLoader.cs ---
using System;
using Beebyte.Obfuscator;
using GoogleMobileAds.Api;
using UnityEngine;

[ObfuscateLiterals]
public class GoogleMobileAdsLoader : MonoBehaviour
{
	private static GoogleMobileAdsLoader instance;

	internal static bool initialized;

	public static void initAds()
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Expected O, but got Unknown
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)instance != (Object)null) && shouldLoad())
		{
			GameObject val = new GameObject("GoogleMobileAdsLoader")
			{
				hideFlags = (HideFlags)52
			};
			Object.DontDestroyOnLoad((Object)val);
			val.transform.SetParent(GameObject.Find("Services").transform);
			instance = val.AddComponent<GoogleMobileAdsLoader>();
		}
	}

	public void Start()
	{
		if (DebugConfig.isOn(DebugOption.TestAds))
		{
			Config.testAds = true;
		}
		if (!Config.isMobile || Config.hasPremium)
		{
			return;
		}
		try
		{
			string region = PreciseLocale.GetRegion();
			if (region.ToLower().Contains("us") || region.ToLower().Contains("gb"))
			{
				GoogleInterstitialAd.default_current = 1;
				GoogleRewardAd.default_current = 1;
			}
			string currencyCode = PreciseLocale.GetCurrencyCode();
			if (currencyCode == "USD" || currencyCode == "GBP")
			{
				GoogleInterstitialAd.default_current = 1;
				GoogleRewardAd.default_current = 1;
			}
		}
		catch (Exception)
		{
		}
		try
		{
			log("Initializing");
			MobileAds.DisableMediationInitialization();
			MobileAds.Initialize((Action<InitializationStatus>)delegate
			{
				ThreadHelper.ExecuteInUpdate(delegate
				{
					log("Initialized");
					initialized = true;
					Config.adsInitialized = true;
				});
			});
		}
		catch (Exception ex2)
		{
			log("Could not initialize ads");
			Debug.Log((object)ex2);
		}
	}

	private static void log(string pLog)
	{
		Debug.Log((object)(GetColor() + " <color=#fbbc04>" + pLog + "</color>"));
	}

	public static string GetColor()
	{
		return "[<color=#ea4335>A</color><color=#fbbc04>D</color><color=#4285f4>M</color>]";
	}

	public static bool shouldLoad()
	{
		return false;
	}
}
// --- End of File: GoogleMobileAdsLoader.cs ---



// --- Start of File: GooglePlayTangle.cs ---
using System;

namespace UnityEngine.Purchasing.Security;

public class GooglePlayTangle
{
	private static byte[] data = Convert.FromBase64String("dMZFZnRJQk1uwgzCs0lFRUVBREdEmfRYkbtqgRbn1uonvTwN/R8KFU6dxJq3OX0iF3cfyyJx8SV7RVGGxkVLRHTGRU5GxkVFRP5Y/5bFSR/VDy6kDuoXivfvEGyjKBQT+9rZmVyqpLrINBBIHwrgnBmw5oYPgCTQFfAkFYtqkxQ7rApQgWXHUO1Yazc8LKUBLugsGw9EnuaTejink6/77p3l5I8yLPPXoWzpZiaKULv3J2oWZA/rW+FQV6LIhhRwCV/P+f9WmvYdd6ZmDDpkn3tjgD+VREl/ATD2fsHxO5PI/rKsCQMWxPlMIo8bIhQj7mVfsjIQHaUvOw4F+T5WKYoyovWQkU1OkQpSqXwrq6UIHOp9hHP01aTEwqMk21zFcUZHRURF");

	private static int[] order = new int[15]
	{
		0, 6, 8, 6, 11, 8, 7, 9, 12, 12,
		10, 11, 13, 13, 14
	};

	private static int key = 68;

	public static readonly bool IsPopulated = true;

	public static byte[] Data()
	{
		if (!IsPopulated)
		{
			return null;
		}
		return Obfuscator.DeObfuscate(data, order, key);
	}
}
// --- End of File: GooglePlayTangle.cs ---



// --- Start of File: GoogleRewardAd.cs ---
using System;
using System.Collections.Generic;
using Beebyte.Obfuscator;
using GoogleMobileAds.Api;
using UnityEngine;

[ObfuscateLiterals]
public class GoogleRewardAd : IWorldBoxAd
{
	private RewardedAd rewardBasedVideo;

	private static int loaded = 0;

	private static int failed = 0;

	internal static int default_current = 2;

	private static int current = 2;

	private const int max_current = 3;

	private static string _admob_id = string.Empty;

	private bool started;

	private static string lastError = "";

	private static string lastID = "";

	public Action<string> logger { get; set; }

	public Action adResetCallback { get; set; }

	public Action adFailedCallback { get; set; }

	public Action adFinishedCallback { get; set; }

	public Action adStartedCallback { get; set; }

	public void Reset()
	{
		log("reset to " + default_current);
		current = default_current;
		failed = 0;
		loaded = 0;
		lastError = "";
		lastID = "";
	}

	private string getRewardAdUnitID()
	{
		log("[prerew] " + current);
		if (failed > 1 && loaded == 0)
		{
			failed = 0;
			current++;
			current = Mathf.Clamp(current, 0, 3);
			log("Level " + current);
		}
		else if (loaded > 2 && current > 0)
		{
			current--;
			current = Mathf.Clamp(current, 0, 3);
			log("Level " + current);
		}
		return "unexpected_platform";
	}

	public void RequestAd()
	{
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Expected O, but got Unknown
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Expected O, but got Unknown
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Expected O, but got Unknown
		if (!Config.isMobile || Config.hasPremium || (rewardBasedVideo != null && !started))
		{
			return;
		}
		KillAd();
		started = false;
		_admob_id = getRewardAdUnitID();
		AdRequest val;
		if (Config.testAds)
		{
			log("Requesting Test Ad");
			val = new AdRequest();
			List<string> testDeviceIds = new List<string> { "38469EF1320047F75C548E8477B3583B", "6b80482efcca7c0f3f07a95f8be98fe6" };
			MobileAds.SetRequestConfiguration(new RequestConfiguration
			{
				TestDeviceIds = testDeviceIds
			});
		}
		else
		{
			log("Requesting Ad");
			val = new AdRequest();
		}
		RewardedAd.Load(_admob_id, val, (Action<RewardedAd, LoadAdError>)delegate(RewardedAd ad, LoadAdError error)
		{
			ThreadHelper.ExecuteInUpdate(delegate
			{
				if (error != null || ad == null)
				{
					log("Callback error");
					HandleRewardBasedVideoFailedToLoad(error);
				}
				else
				{
					HandleRewardBasedVideoLoaded();
					rewardBasedVideo = ad;
					rewardBasedVideo.OnAdFullScreenContentOpened += HandleRewardBasedVideoOpened;
					rewardBasedVideo.OnAdFullScreenContentFailed += HandleRewardedAdFailedToShow;
					rewardBasedVideo.OnAdPaid += HandleOnPaidEvent;
					rewardBasedVideo.OnAdFullScreenContentClosed += HandleRewardBasedVideoClosed;
				}
			});
		});
	}

	public void HandleRewardBasedVideoLoaded()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Loaded");
			RewardedAds.debug += "h1_";
		});
	}

	public void HandleRewardBasedVideoFailedToLoad(LoadAdError pLoadAdError)
	{
		string tLoadError = "Failed to load ad";
		if (pLoadAdError != null)
		{
			tLoadError = ((AdError)pLoadAdError).GetMessage();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded = 0;
			failed++;
			if (lastError != tLoadError || _admob_id != lastID)
			{
				log(current + " " + _admob_id);
				log("<color=red>Ad Failed to Load: " + tLoadError + "</color>");
				lastError = tLoadError;
				lastID = _admob_id;
			}
			else
			{
				log("<color=red>Ad Failed to Load</color>");
			}
			started = true;
			RewardedAds.debug += "h2_";
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
			if (tLoadError.Contains("floor") || tLoadError.Contains("fill") || tLoadError.Contains("configured"))
			{
				failed++;
				if (current < 3 && adResetCallback != null)
				{
					adResetCallback();
				}
			}
		});
	}

	public void HandleRewardBasedVideoOpened()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Opened");
			started = true;
			RewardedAds.debug += "h3_";
			if (adStartedCallback != null)
			{
				adStartedCallback();
			}
		});
	}

	public void HandleRewardedAdFailedToShow(AdError pAdError)
	{
		string tLoadError = "Failed to show ad";
		if (pAdError != null)
		{
			tLoadError = pAdError.GetMessage();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded = 0;
			failed++;
			if (lastError != tLoadError)
			{
				log("<color=red>Ad Failed to Show: " + tLoadError + "</color>");
				lastError = tLoadError;
			}
			else
			{
				log("<color=red>Ad Failed to Show</color>");
			}
			started = true;
			RewardedAds.debug += "h4_";
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
		});
	}

	public void HandleRewardBasedVideoRewarded(Reward pAdReward)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Rewarded");
			started = true;
			if ((Object)(object)World.world != (Object)null)
			{
				log("is worldbox on focus " + World.world.has_focus);
			}
			RewardedAds.instance.handleRewards();
			RewardedAds.debug += "h5_";
		});
	}

	public void HandleRewardBasedVideoClosed()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Closed");
			started = true;
			RewardedAds.debug += "h6_";
			KillAd();
			if (adFinishedCallback != null)
			{
				adFinishedCallback();
			}
		});
	}

	public void HandleOnPaidEvent(AdValue pAdValue)
	{
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		string tLog1 = "Rewarded interstitial ad has received a paid event. " + ((object)pAdValue).ToString();
		string[] obj = new string[6] { "Values: ", null, null, null, null, null };
		PrecisionType precision = pAdValue.Precision;
		obj[1] = ((object)(PrecisionType)(ref precision)).ToString();
		obj[2] = " ";
		obj[3] = pAdValue.Value.ToString();
		obj[4] = " ";
		obj[5] = pAdValue.CurrencyCode;
		string tLog2 = string.Concat(obj);
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log(tLog1);
			log(tLog2);
			started = true;
			RewardedAds.debug += "h7_";
		});
	}

	public void KillAd()
	{
		if (rewardBasedVideo != null && started)
		{
			rewardBasedVideo.OnAdFullScreenContentOpened -= HandleRewardBasedVideoOpened;
			rewardBasedVideo.OnAdFullScreenContentFailed -= HandleRewardedAdFailedToShow;
			rewardBasedVideo.OnAdPaid -= HandleOnPaidEvent;
			rewardBasedVideo.OnAdFullScreenContentClosed -= HandleRewardBasedVideoClosed;
			rewardBasedVideo.Destroy();
			rewardBasedVideo = null;
		}
	}

	public bool IsReady()
	{
		if (rewardBasedVideo != null)
		{
			return rewardBasedVideo.CanShowAd();
		}
		return false;
	}

	public void ShowAd()
	{
		if (IsReady())
		{
			started = true;
			rewardBasedVideo.Show((Action<Reward>)HandleRewardBasedVideoRewarded);
		}
	}

	public bool HasAd()
	{
		if (!IsInitialized())
		{
			return false;
		}
		return rewardBasedVideo != null;
	}

	public string GetProviderName()
	{
		return "AdMob Rewarded Ad";
	}

	public string GetColor()
	{
		return GoogleMobileAdsLoader.GetColor();
	}

	private void log(string pLog)
	{
		logger(GetColor() + " " + pLog);
	}

	public bool IsInitialized()
	{
		return GoogleMobileAdsLoader.initialized;
	}
}
// --- End of File: GoogleRewardAd.cs ---



// --- Start of File: GoToActorTargetType.cs ---
namespace ai.behaviours;

public enum GoToActorTargetType
{
	SameTile,
	SameRegion,
	NearbyTile,
	NearbyTileClosest,
	RaycastWithAttackRange
}
// --- End of File: GoToActorTargetType.cs ---



// --- Start of File: GPGSIds.cs ---
public static class GPGSIds
{
	public const string achievement_10000_bombs = "CgkIia6M98wfEAIQBQ";

	public const string achievement_megapolis = "CgkIia6M98wfEAIQBg";

	public const string achievement_make_wilhelm_scream = "CgkIia6M98wfEAIQBw";

	public const string achievement_1000_creatures = "CgkIia6M98wfEAIQBA";

	public const string achievement_baby_tornado = "CgkIia6M98wfEAIQAw";

	public const string achievement_lava_strike = "CgkIia6M98wfEAIQAg";
}
// --- End of File: GPGSIds.cs ---



// --- Start of File: GraphCategoriesContainer.cs ---
using System.Collections.Generic;
using System.Linq;
using UnityEngine;

public class GraphCategoriesContainer : MonoBehaviour
{
	public GraphController graph_controller;

	public GraphCategoryGroup category_group = GraphCategoryGroup.General;

	private GraphCategoryGroup _last_category_group;

	private GraphCategoryGroup _last_category_groups;

	private List<HistoryDataAsset> _current_list = new List<HistoryDataAsset>();

	private Dictionary<string, ButtonGraphCategory> _category_buttons = new Dictionary<string, ButtonGraphCategory>();

	private ButtonGraphCategory _prefab_button;

	private bool _is_initialized;

	[SerializeField]
	private TabTogglesGroup _category_groups;

	private void init()
	{
		if (!_is_initialized)
		{
			_is_initialized = true;
			ButtonGraphCategory[] componentsInChildren = ((Component)this).GetComponentsInChildren<ButtonGraphCategory>();
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				Object.Destroy((Object)(object)((Component)componentsInChildren[i]).gameObject);
			}
			_prefab_button = Resources.Load<ButtonGraphCategory>("ui/graphs/GraphCategoryButton");
		}
	}

	public void apply()
	{
		init();
		List<HistoryDataAsset> categories = graph_controller.getCategories();
		if (_last_category_group == category_group && _current_list.Count > 0 && _current_list.Count == categories.Count && _current_list.All(categories.Contains) && categories.All(_current_list.Contains))
		{
			foreach (ButtonGraphCategory value2 in _category_buttons.Values)
			{
				graph_controller.setCategoryEnabled(((Object)((Component)value2).gameObject).name, value2.is_on, pUpdateGraph: false);
			}
			return;
		}
		foreach (ButtonGraphCategory value3 in _category_buttons.Values)
		{
			((Component)value3).gameObject.SetActive(false);
		}
		GraphCategoryGroup graphCategoryGroup = GraphCategoryGroup.None;
		_current_list = new List<HistoryDataAsset>(categories);
		foreach (HistoryDataAsset item in _current_list)
		{
			graphCategoryGroup |= item.category_group;
			if (item.category_group.HasFlag(category_group))
			{
				if (!_category_buttons.TryGetValue(item.id, out var value))
				{
					value = Object.Instantiate<ButtonGraphCategory>(_prefab_button, ((Component)this).transform);
					((Object)((Component)value).gameObject).name = item.id;
					((Component)value).transform.SetParent(((Component)this).transform);
					value.init();
					value.setAsset(item);
					value.is_on = graph_controller.isCategoryEnabled(item.id);
					_category_buttons.Add(item.id, value);
				}
				((Component)value).gameObject.SetActive(true);
			}
		}
		_last_category_group = category_group;
		showCategoryGroups(graphCategoryGroup);
	}

	private void showCategoryGroups(GraphCategoryGroup pGroups)
	{
		((Component)_category_groups).gameObject.SetActive(pGroups.Count() > 1);
		if (_last_category_groups == pGroups)
		{
			return;
		}
		_category_groups.clearButtons();
		if (pGroups.HasFlag(GraphCategoryGroup.General))
		{
			_category_groups.tryAddButton("ui/Icons/iconRenown", "tab_general_stats", apply, delegate
			{
				category_group = GraphCategoryGroup.General;
			});
		}
		if (pGroups.HasFlag(GraphCategoryGroup.Noosphere))
		{
			_category_groups.tryAddButton("ui/Icons/iconKnowledge", "tab_noosphere", apply, delegate
			{
				category_group = GraphCategoryGroup.Noosphere;
			});
		}
		if (pGroups.HasFlag(GraphCategoryGroup.Deaths))
		{
			_category_groups.tryAddButton("civ/map_mark_death", "tab_deaths", apply, delegate
			{
				category_group = GraphCategoryGroup.Deaths;
			});
		}
		if (pGroups.HasFlag(GraphCategoryGroup.Biomes))
		{
			_category_groups.tryAddButton("ui/Icons/iconSeedClover", "tab_biomes", apply, delegate
			{
				category_group = GraphCategoryGroup.Biomes;
			});
		}
		if (pGroups.HasFlag(GraphCategoryGroup.Tiles))
		{
			_category_groups.tryAddButton("ui/Icons/iconZones", "tab_tiles", apply, delegate
			{
				category_group = GraphCategoryGroup.Tiles;
			});
		}
		_last_category_groups = pGroups;
		_category_groups.enableFirst();
	}

	public void setCategoryEnabled(string pId, bool pEnabled)
	{
		if (graph_controller.multi_chart)
		{
			foreach (ButtonGraphCategory value in _category_buttons.Values)
			{
				value.is_on = ((Object)((Component)value).gameObject).name == pId;
			}
			graph_controller.disableAllCategories(pId);
		}
		graph_controller.setCategoryEnabled(pId, pEnabled, pUpdateGraph: false);
		graph_controller.adjustCharts();
	}
}
// --- End of File: GraphCategoriesContainer.cs ---



// --- Start of File: GraphCategoryGroup.cs ---
using System;

[Flags]
public enum GraphCategoryGroup
{
	None = 0,
	General = 1,
	Noosphere = 2,
	Deaths = 4,
	Biomes = 8,
	Tiles = 0x10
}
// --- End of File: GraphCategoryGroup.cs ---



// --- Start of File: GraphCompareMetaObject.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class GraphCompareMetaObject : MonoBehaviour, IDropHandler, IEventSystemHandler
{
	private GraphCompareWindow _graph_window;

	private GraphController _graph_controller;

	private MultiBannerPool _pool_drop_banners;

	public NanoObject current_item;

	public GameObject empty_drop_icon;

	public LocalizedText meta_title;

	public Text meta_name;

	private IBanner _current_banner;

	public static bool disable_raycasts;

	private bool _disable_raycasts;

	private List<Graphic> _raycast_children = new List<Graphic>();

	private bool _initialized;

	public void Awake()
	{
		init();
	}

	private void init()
	{
		if (!_initialized)
		{
			_initialized = true;
			_graph_window = ((Component)this).GetComponentInParent<GraphCompareWindow>();
			_graph_controller = _graph_window.graph_controller;
			_pool_drop_banners = _graph_window.getDropBannerPool();
		}
	}

	public void OnEnable()
	{
		if (current_item == null)
		{
			empty_drop_icon.SetActive(true);
			meta_title.setKeyAndUpdate("graph_drop_to_compare");
			((Component)meta_name).gameObject.SetActive(false);
		}
	}

	public void Update()
	{
		if (_disable_raycasts != disable_raycasts)
		{
			_disable_raycasts = disable_raycasts;
			if (disable_raycasts)
			{
				disableRaycastChildren();
			}
			else
			{
				enableRaycastChildren();
			}
		}
	}

	public void disableRaycastChildren()
	{
		_raycast_children.Clear();
		Graphic[] componentsInChildren = ((Component)this).GetComponentsInChildren<Graphic>();
		foreach (Graphic val in componentsInChildren)
		{
			if (!((Object)(object)((Component)val).gameObject == (Object)(object)((Component)this).gameObject) && val.raycastTarget)
			{
				_raycast_children.Add(val);
				val.raycastTarget = false;
			}
		}
	}

	public void enableRaycastChildren()
	{
		foreach (Graphic raycast_child in _raycast_children)
		{
			raycast_child.raycastTarget = true;
		}
		_raycast_children.Clear();
	}

	public void OnDrop(PointerEventData pEventData)
	{
		if ((Object)(object)pEventData.pointerDrag == (Object)null)
		{
			return;
		}
		BannerBase component = pEventData.pointerDrag.GetComponent<BannerBase>();
		if (!((Object)(object)component == (Object)null))
		{
			GraphCompareMetaSelector component2 = pEventData.pointerDrag.GetComponent<GraphCompareMetaSelector>();
			if (!((Object)(object)component2 == (Object)null) && component2.isBeingDragged())
			{
				component2.OnEndDrag(pEventData);
				SoundBox.click();
				setObjectAndUpdate(component.GetNanoObject());
				((AbstractEventData)pEventData).Use();
			}
		}
	}

	public void empty()
	{
		init();
		clearObject();
		empty_drop_icon.SetActive(true);
	}

	public void clear()
	{
		init();
		Config.selected_objects_graph.Remove(current_item);
		clearObject();
		empty_drop_icon.SetActive(true);
	}

	public void clearAndSetObject(NanoObject pObject)
	{
		clear();
		setObject(pObject);
	}

	public void setObject(NanoObject pObject)
	{
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Expected O, but got Unknown
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_0109: Unknown result type (might be due to invalid IL or missing references)
		if (!pObject.isRekt())
		{
			empty_drop_icon.SetActive(false);
			current_item = pObject;
			_current_banner = _graph_window.setupBanner(current_item, ((Component)this).transform, _pool_drop_banners);
			_current_banner.jump();
			((UnityEvent)_current_banner.GetComponent<Button>().onClick).AddListener(new UnityAction(removeOnClick));
			if (!Config.selected_objects_graph.Contains(current_item))
			{
				Config.selected_objects_graph.Add(current_item);
			}
			Color colorText = current_item.getColor().getColorText();
			((Graphic)meta_title.text).color = colorText;
			MetaCustomizationAsset asset = AssetManager.meta_customization_library.getAsset(current_item.getMetaType());
			meta_title.setKeyAndUpdate(asset.localization_title);
			((Component)meta_name).gameObject.SetActive(true);
			meta_name.text = current_item.name;
			((Graphic)meta_name).color = colorText;
		}
	}

	private void setObjectAndUpdate(NanoObject pObject)
	{
		string activeCategory = _graph_controller.getActiveCategory();
		clearAndSetObject(pObject);
		_graph_window.loadNoosItems(pSilent: true);
		_graph_controller.resetAndUpdateGraph();
		_graph_controller.tryEnableCategory(activeCategory);
	}

	private void removeOnClick()
	{
		SoundBox.click();
		if (!InputHelpers.mouseSupported && !Tooltip.isShowingFor(_current_banner))
		{
			_current_banner.showTooltip();
		}
		else
		{
			setObjectAndUpdate(null);
		}
	}

	private void clearObject()
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		if (current_item != null)
		{
			releaseChild();
			current_item = null;
			((Graphic)meta_title.text).color = Toolbox.color_text_default;
			((Graphic)meta_name).color = Toolbox.color_text_default;
			((Component)meta_name).gameObject.SetActive(false);
		}
	}

	private void releaseChild()
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Expected O, but got Unknown
		if (_current_banner != null)
		{
			((UnityEvent)_current_banner.GetComponent<Button>().onClick).RemoveListener(new UnityAction(removeOnClick));
			_pool_drop_banners.resetParent(_current_banner);
			_pool_drop_banners.release(_current_banner);
			_current_banner = null;
		}
	}
}
// --- End of File: GraphCompareMetaObject.cs ---



// --- Start of File: GraphCompareMetaSelector.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

[RequireComponent(typeof(ScrollableButton))]
public class GraphCompareMetaSelector : MonoBehaviour, IInitializePotentialDragHandler, IEventSystemHandler, IDragHandler, IBeginDragHandler, IEndDragHandler, IDraggable
{
	[SerializeField]
	private bool _spawn_particles_on_drag = true;

	private Vector3 _start_local_position;

	private Transform _start_parent;

	private ScrollableButton _scrollable_button;

	private readonly List<Graphic> _raycastables = new List<Graphic>();

	private Vector2 _first_position = Vector2.zero;

	private bool _dragging;

	private readonly List<RectTransform> _dropzones = new List<RectTransform>();

	private GraphCompareWindow _window;

	public bool spawn_particles_on_drag => _spawn_particles_on_drag;

	private Transform _attach_parent => World.world.drag_parent;

	private void Awake()
	{
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Expected O, but got Unknown
		_scrollable_button = ((Component)this).GetComponent<ScrollableButton>();
		_start_parent = ((Component)this).transform.parent;
		((UnityEvent)((Component)this).GetComponent<Button>().onClick).AddListener(new UnityAction(showTooltip));
	}

	private void showTooltip()
	{
		IBanner component = ((Component)this).GetComponent<IBanner>();
		if (!InputHelpers.mouseSupported && !Tooltip.isShowingFor(component))
		{
			component.showTooltip();
		}
	}

	public void addWindow(GraphCompareWindow pWindow)
	{
		_window = pWindow;
	}

	public void addDropzones(params RectTransform[] pDropzones)
	{
		_dropzones.Clear();
		_dropzones.AddRange(pDropzones);
	}

	public bool isBeingDragged()
	{
		return _dragging;
	}

	public void OnInitializePotentialDrag(PointerEventData pEventData)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		_dragging = false;
		_first_position = pEventData.position;
		_start_parent = ((Component)this).transform.parent;
		_start_local_position = ((Component)this).transform.localPosition;
	}

	public bool checkIfDragging(PointerEventData pEventData)
	{
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0102: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0126: Unknown result type (might be due to invalid IL or missing references)
		//IL_0156: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_0162: Unknown result type (might be due to invalid IL or missing references)
		//IL_0136: Unknown result type (might be due to invalid IL or missing references)
		//IL_0138: Unknown result type (might be due to invalid IL or missing references)
		//IL_016b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_0176: Unknown result type (might be due to invalid IL or missing references)
		//IL_017b: Unknown result type (might be due to invalid IL or missing references)
		//IL_017d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0189: Unknown result type (might be due to invalid IL or missing references)
		if (_window.countNoosItems() < 5)
		{
			return true;
		}
		Vector2 val = default(Vector2);
		((Vector2)(ref val))._002Ector(float.MaxValue, 0f);
		Vector2 val2 = default(Vector2);
		((Vector2)(ref val2))._002Ector(float.MinValue, 0f);
		foreach (RectTransform dropzone in _dropzones)
		{
			Vector2 val3 = Vector2.op_Implicit(((Transform)dropzone).position);
			ref float x = ref val3.x;
			float num = x;
			Rect rect = dropzone.rect;
			x = num - ((Rect)(ref rect)).width * ((Transform)dropzone).lossyScale.x / 2f;
			ref float y = ref val3.y;
			float num2 = y;
			rect = dropzone.rect;
			y = num2 - ((Rect)(ref rect)).height * ((Transform)dropzone).lossyScale.y / 2f;
			Vector2 val4 = Vector2.op_Implicit(((Transform)dropzone).position);
			ref float x2 = ref val4.x;
			float num3 = x2;
			rect = dropzone.rect;
			x2 = num3 + ((Rect)(ref rect)).width * ((Transform)dropzone).lossyScale.x / 2f;
			ref float y2 = ref val4.y;
			float num4 = y2;
			rect = dropzone.rect;
			y2 = num4 - ((Rect)(ref rect)).height * ((Transform)dropzone).lossyScale.y / 2f;
			if (val3.x < val.x)
			{
				val = val3;
			}
			if (val4.x > val2.x)
			{
				val2 = val4;
			}
		}
		if (!Toolbox.isInTriangle(pEventData.position, _first_position, val, val2))
		{
			Vector2 val5 = pEventData.position - _first_position;
			if (Mathf.Abs(val5.x) > Mathf.Abs(val5.y))
			{
				return false;
			}
		}
		return true;
	}

	public void OnBeginDrag(PointerEventData pEventData)
	{
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		if (!Config.isDraggingItem() && !_dragging)
		{
			_dragging = checkIfDragging(pEventData);
			if (_dragging)
			{
				Config.setDraggingObject(this);
				((AbstractEventData)pEventData).Use();
				((Behaviour)_scrollable_button).enabled = false;
				GraphCompareMetaObject.disable_raycasts = true;
				((Component)this).transform.SetParent(_attach_parent);
				((Component)this).transform.position = Vector2.op_Implicit(pEventData.position);
				disableRaycast();
			}
		}
	}

	public void OnDrag(PointerEventData pEventData)
	{
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		if (_dragging && Config.isDraggingObject(this))
		{
			((AbstractEventData)pEventData).Use();
			((Component)this).transform.position = Vector2.op_Implicit(pEventData.position);
		}
	}

	public void OnEndDrag(PointerEventData pEventData)
	{
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		_scrollable_button.OnEndDrag(pEventData);
		if (_dragging && Config.isDraggingObject(this))
		{
			((AbstractEventData)pEventData).Use();
			((Component)this).transform.SetParent(_start_parent);
			((Component)this).transform.localPosition = _start_local_position;
			resetDrag();
		}
	}

	public void resetDrag()
	{
		if (!_dragging)
		{
			return;
		}
		Config.clearDraggingObject();
		_dragging = false;
		((Behaviour)_scrollable_button).enabled = true;
		GraphCompareMetaObject.disable_raycasts = false;
		foreach (Graphic raycastable in _raycastables)
		{
			raycastable.raycastTarget = true;
		}
	}

	private void disableRaycast()
	{
		_raycastables.Clear();
		Graphic[] componentsInChildren = ((Component)this).GetComponentsInChildren<Graphic>();
		foreach (Graphic val in componentsInChildren)
		{
			if (val.raycastTarget)
			{
				_raycastables.Add(val);
			}
		}
		foreach (Graphic raycastable in _raycastables)
		{
			raycastable.raycastTarget = false;
		}
	}

	private void OnDisable()
	{
		resetDrag();
	}

	public void KillDrag()
	{
		OnDisable();
	}

	Transform IDraggable.get_transform()
	{
		return ((Component)this).transform;
	}
}
// --- End of File: GraphCompareMetaSelector.cs ---



// --- Start of File: GraphCompareWindow.cs ---
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;
using db;

public class GraphCompareWindow : MonoBehaviour
{
	public GraphCompareMetaObject meta_object_1;

	public GraphCompareMetaObject meta_object_2;

	public GraphCompareMetaObject meta_object_3;

	public GraphController graph_controller;

	[SerializeField]
	private GameObject _empty_list_message;

	[SerializeField]
	private RectTransform _meta_drag_object;

	private ObjectPoolGenericMono<RectTransform> _pool_drag_objects;

	private MultiBannerPool _pool_banners;

	private MultiBannerPool _pool_drop_banners;

	[SerializeField]
	private Button _noos_button;

	[SerializeField]
	private Image _noos_icon;

	[SerializeField]
	private Transform _noos_list_container;

	[SerializeField]
	private Transform _pool_banner_container;

	[SerializeField]
	private Transform _pool_drop_banner_container;

	private MetaTypeAsset _current_asset;

	private List<MetaTypeAsset> _noos_list = new List<MetaTypeAsset>();

	private List<NanoObject> _noos_items = new List<NanoObject>();

	private Coroutine _load_noos_items;

	private const int VISIBLE_ITEMS = 6;

	[SerializeField]
	private CanvasGroup[] _block_during_random;

	private bool _is_randomizing;

	private bool _stop_randomizer;

	private void Awake()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Expected O, but got Unknown
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Expected O, but got Unknown
		foreach (Transform item in _noos_list_container)
		{
			Transform val = item;
			if (((Object)((Component)val).gameObject).name.StartsWith("MetaContainer"))
			{
				Object.Destroy((Object)(object)((Component)val).gameObject);
			}
		}
		_pool_drag_objects = new ObjectPoolGenericMono<RectTransform>(_meta_drag_object, _noos_list_container);
		_pool_banners = new MultiBannerPool(_pool_banner_container);
		_pool_drop_banners = new MultiBannerPool(_pool_drop_banner_container);
		((UnityEvent)_noos_button.onClick).AddListener((UnityAction)delegate
		{
			nextNoos();
		});
	}

	internal MultiBannerPool getDropBannerPool()
	{
		return _pool_drop_banners;
	}

	private void OnEnable()
	{
		ScrollWindow.addCallbackHide(resetPoolsAndParents);
		loadNoos();
		if (hasAny())
		{
			if (Config.selected_objects_graph.Count == 0)
			{
				((MonoBehaviour)this).StartCoroutine(displayRandom());
			}
			else
			{
				((MonoBehaviour)this).StartCoroutine(displaySelected());
			}
		}
	}

	private IEnumerator selectNoosCoroutine()
	{
		if (Config.selected_objects_graph.Count != 0)
		{
			selectNoos(Config.selected_objects_graph.First());
			SoundBox.click();
			yield return (object)new WaitForEndOfFrame();
		}
	}

	private IEnumerator updateGraph()
	{
		if (Config.selected_objects_graph.Count != 0)
		{
			string activeCategory = graph_controller.getActiveCategory();
			graph_controller.resetAndUpdateGraph();
			graph_controller.tryEnableCategory(activeCategory);
			yield return (object)new WaitForEndOfFrame();
		}
	}

	private IEnumerator displaySelected(bool pUpdate = true)
	{
		if (Config.selected_objects_graph.Count == 0)
		{
			yield break;
		}
		using ListPool<NanoObject> tSelectedObjects = new ListPool<NanoObject>(3);
		tSelectedObjects.Add(Config.selected_objects_graph[0]);
		tSelectedObjects.Add(Config.selected_objects_graph[1]);
		tSelectedObjects.Add(Config.selected_objects_graph[2]);
		meta_object_1.empty();
		meta_object_2.empty();
		meta_object_3.empty();
		Config.selected_objects_graph.Clear();
		meta_object_1.setObject(tSelectedObjects[0]);
		yield return (object)new WaitForEndOfFrame();
		meta_object_2.setObject(tSelectedObjects[1]);
		yield return (object)new WaitForEndOfFrame();
		meta_object_3.setObject(tSelectedObjects[2]);
		yield return (object)new WaitForEndOfFrame();
		if (pUpdate)
		{
			yield return selectNoosCoroutine();
			yield return updateGraph();
		}
	}

	private void OnDisable()
	{
		clearNoosItems();
		clearAsset();
	}

	private void clearAsset()
	{
		_current_asset = null;
	}

	private void loadNoos()
	{
		_noos_list.Clear();
		foreach (HistoryMetaDataAsset item in AssetManager.history_meta_data_library.list)
		{
			MetaTypeAsset metaTypeAsset = AssetManager.meta_type_library.get(item.id);
			if (metaTypeAsset.has_any())
			{
				_noos_list.Add(metaTypeAsset);
			}
		}
		showItems(hasAny());
	}

	private bool hasAny()
	{
		return _noos_list.Count > 0;
	}

	private void showItems(bool pShow)
	{
		Transform val = ((Component)this).transform.FindRecursive("Content");
		for (int i = 0; i < val.childCount; i++)
		{
			((Component)val.GetChild(i)).gameObject.SetActive(pShow);
		}
		_empty_list_message.SetActive(!pShow);
	}

	private void updateNoosIcon(MetaTypeAsset pAsset)
	{
		Sprite sprite = SpriteTextureLoader.getSprite("ui/Icons/" + pAsset.icon_list);
		_noos_icon.sprite = sprite;
	}

	public void clearNoosItems()
	{
		_noos_items.Clear();
		_pool_banners.clear();
		_pool_drag_objects.clear();
	}

	private void resetNoosList()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		((Component)_noos_list_container).GetComponent<RectTransform>().offsetMin = new Vector2(0f, 0f);
		((Component)_noos_list_container).GetComponent<RectTransform>().offsetMax = new Vector2(0f, 0f);
		clearNoosItems();
	}

	private void resetPoolsAndParents(string pID)
	{
		if (!(pID != "chart_comparer"))
		{
			((MonoBehaviour)this).StopAllCoroutines();
			clearNoosItems();
			meta_object_1.empty();
			meta_object_2.empty();
			meta_object_3.empty();
			ScrollWindow.removeCallbackHide(resetPoolsAndParents);
		}
	}

	public IEnumerator loadNoosItemsCoroutine(bool pSilent = false)
	{
		resetNoosList();
		_noos_items.AddRange(_current_asset.get_list());
		_noos_items.Sort(sortByUnits);
		using ListPool<NanoObject> tItems = new ListPool<NanoObject>(_noos_items);
		int tCount = 0;
		foreach (ref NanoObject item in tItems)
		{
			NanoObject current = item;
			if (current != meta_object_1.current_item && current != meta_object_2.current_item && current != meta_object_3.current_item)
			{
				RectTransform next = _pool_drag_objects.getNext();
				((Object)((Component)next).gameObject).name = "MetaContainer " + current.getID();
				IBanner banner = setupDragBanner(current, ((Component)next).transform, _pool_banners);
				if (tCount++ < 6)
				{
					banner.jump(0.1f, pSilent);
					yield return (object)new WaitForEndOfFrame();
				}
			}
		}
	}

	public int countNoosItems()
	{
		return _noos_items.Count;
	}

	public static int sortByUnits(NanoObject pNanoObject1, NanoObject pNanoObject2)
	{
		return ((IMetaObject)pNanoObject2).countUnits().CompareTo(((IMetaObject)pNanoObject1).countUnits());
	}

	private void nextNoos()
	{
		int num = _noos_list.IndexOf(_current_asset);
		num = Toolbox.loopIndex(++num, _noos_list.Count);
		selectNoos(_noos_list[num]);
	}

	private void selectNoos(NanoObject pObject)
	{
		MetaTypeAsset pAsset = AssetManager.meta_type_library.get(pObject.getType());
		selectNoos(pAsset);
	}

	private void selectNoos(MetaTypeAsset pAsset)
	{
		if (_current_asset != pAsset)
		{
			clearNoosItems();
			_current_asset = pAsset;
			updateNoosIcon(_current_asset);
			loadNoosItems();
		}
	}

	public IBanner setupBanner(NanoObject pObject, Transform pBannerArea, MultiBannerPool pBannerPool)
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		IBanner next = pBannerPool.getNext(pObject);
		next.load(pObject);
		next.transform.localScale = new Vector3(1f, 1f, 1f);
		next.transform.SetParent(pBannerArea);
		UiButtonHoverAnimation component = next.GetComponent<UiButtonHoverAnimation>();
		((Behaviour)component).enabled = false;
		component.scale_size = 1f;
		component.default_scale = new Vector3(1f, 1f, 1f);
		next.GetComponent<TipButton>().setDefaultScale(pBannerArea.localScale);
		if (!((IBaseMono)next).HasComponent<LayoutElement>())
		{
			((IBaseMono)next).AddComponent<LayoutElement>().ignoreLayout = true;
		}
		RectTransform component2 = next.GetComponent<RectTransform>();
		component2.SetAnchor(AnchorPresets.MiddleCenter);
		((Transform)component2).localScale = new Vector3(1f, 1f, 1f);
		component2.anchoredPosition = new Vector2(0f, 0f);
		return next;
	}

	private IBanner setupDragBanner(NanoObject pObject, Transform pBannerArea, MultiBannerPool pBannerPool)
	{
		IBanner banner = setupBanner(pObject, pBannerArea, pBannerPool);
		if (!((IBaseMono)banner).HasComponent<GraphCompareMetaSelector>())
		{
			GraphCompareMetaSelector graphCompareMetaSelector = ((IBaseMono)banner).AddComponent<GraphCompareMetaSelector>();
			graphCompareMetaSelector.addWindow(this);
			graphCompareMetaSelector.addDropzones(((Component)meta_object_1).GetComponent<RectTransform>(), ((Component)meta_object_2).GetComponent<RectTransform>(), ((Component)meta_object_3).GetComponent<RectTransform>());
		}
		return banner;
	}

	private ListPool<NanoObject> getPossibleItems()
	{
		ListPool<NanoObject> listPool = new ListPool<NanoObject>();
		foreach (MetaTypeAsset item in _noos_list)
		{
			foreach (NanoObject item2 in item.get_list())
			{
				listPool.Add(item2);
			}
		}
		return listPool;
	}

	internal void loadNoosItems(bool pSilent = false)
	{
		if (_load_noos_items != null)
		{
			((MonoBehaviour)this).StopCoroutine(_load_noos_items);
		}
		_load_noos_items = ((MonoBehaviour)this).StartCoroutine(loadNoosItemsCoroutine(pSilent));
	}

	private void selectRandom()
	{
		using ListPool<NanoObject> listPool = getPossibleItems();
		Config.selected_objects_graph.Clear();
		int pMax = Mathf.Min(listPool.Count, 3);
		foreach (NanoObject item in listPool.LoopRandom(pMax))
		{
			Config.selected_objects_graph.Add(item);
		}
		if (listPool.Count <= 7)
		{
			_stop_randomizer = true;
		}
	}

	public void randomizeSelection()
	{
		if (_is_randomizing)
		{
			_stop_randomizer = true;
			return;
		}
		((MonoBehaviour)this).StopAllCoroutines();
		((MonoBehaviour)this).StartCoroutine(displayRandom());
	}

	private IEnumerator displayRandom()
	{
		_is_randomizing = true;
		CanvasGroup[] block_during_random = _block_during_random;
		foreach (CanvasGroup obj in block_during_random)
		{
			obj.interactable = false;
			obj.blocksRaycasts = false;
		}
		for (int i = 0; i < 10; i++)
		{
			if (_stop_randomizer)
			{
				break;
			}
			selectRandom();
			yield return displaySelected(pUpdate: false);
			yield return randomizeCategories();
			yield return updateGraph();
			yield return randomNoosItems();
			updateNoosIcon(_noos_list.GetRandom());
		}
		yield return randomizeCategories();
		yield return randomizeTimescale();
		clearAsset();
		yield return selectNoosCoroutine();
		block_during_random = _block_during_random;
		foreach (CanvasGroup obj2 in block_during_random)
		{
			obj2.interactable = true;
			obj2.blocksRaycasts = true;
		}
		_stop_randomizer = false;
		_is_randomizing = false;
	}

	private IEnumerator randomizeCategories()
	{
		graph_controller.pickRandomCategory();
		SoundBox.click();
		yield return (object)new WaitForEndOfFrame();
	}

	private IEnumerator randomizeTimescale()
	{
		if (graph_controller.randomTimeScale())
		{
			SoundBox.click();
			yield return (object)new WaitForEndOfFrame();
		}
	}

	public IEnumerator randomNoosItems()
	{
		resetNoosList();
		using ListPool<NanoObject> tPossibleItems = getPossibleItems();
		int pMax = Mathf.Min(6, tPossibleItems.Count);
		foreach (NanoObject item in tPossibleItems.LoopRandom(pMax))
		{
			RectTransform next = _pool_drag_objects.getNext();
			((Object)((Component)next).gameObject).name = "MetaContainer " + item.getID();
			IBanner banner = setupDragBanner(item, ((Component)next).transform, _pool_banners);
			if (Randy.randomBool())
			{
				banner.jump(0.025f, pSilent: true);
			}
			yield return (object)new WaitForEndOfFrame();
		}
	}
}
// --- End of File: GraphCompareWindow.cs ---



// --- Start of File: GraphController.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using ChartAndGraph;
using UnityEngine;
using UnityEngine.Events;
using db;
using db.tables;

public class GraphController : MonoBehaviour
{
	[Serializable]
	[CompilerGenerated]
	private sealed class _003C_003Ec
	{
		public static readonly _003C_003Ec _003C_003E9 = new _003C_003Ec();

		public static UnityAction<GraphEventArgs> _003C_003E9__39_0;

		public static UnityAction _003C_003E9__39_1;

		internal void _003ChookEvents_003Eb__39_0(GraphEventArgs _)
		{
			Tooltip.cancelHiding();
		}

		internal void _003ChookEvents_003Eb__39_1()
		{
			Tooltip.scheduledHide(0.15f, pSkipTouch: true);
		}
	}

	public static MinMax min_max;

	public GraphChart chart;

	[SerializeField]
	private MetaType _meta_type = MetaType.City;

	private GraphCategoriesContainer _container_graph_categories;

	private GraphTimeScaleContainer _container_time_scale;

	public bool clear_on_enable;

	public bool multi_chart;

	private VerticalAxis _vertical_axis;

	private HorizontalAxis _horizontal_axis;

	private List<HistoryDataAsset> _list_categories = new List<HistoryDataAsset>();

	private Dictionary<string, bool> _category_enabled = new Dictionary<string, bool>();

	private Dictionary<string, MinMax> _min_max_categories = new Dictionary<string, MinMax>();

	private long _min_timestamp = long.MinValue;

	private long _max_timestamp = long.MaxValue;

	private HashSet<MetaType> _current_types = new HashSet<MetaType>();

	private List<NanoObject> _current_objects = new List<NanoObject>();

	private Dictionary<NanoObject, HistoryTable> _last_data = new Dictionary<NanoObject, HistoryTable>();

	private GraphTimeAsset _current_sample;

	private HistoryInterval _current_interval;

	private Dictionary<string, CategoryData> _current_datas = new Dictionary<string, CategoryData>();

	private bool _events_hooked;

	private bool _loaded;

	private bool _categories_loaded;

	private long _last_timestamp = -1L;

	private void Awake()
	{
		_container_time_scale = ((Component)((Component)this).transform).GetComponentInChildren<GraphTimeScaleContainer>();
		_vertical_axis = ((Component)((Component)this).transform).GetComponentInChildren<VerticalAxis>();
		_horizontal_axis = ((Component)((Component)this).transform).GetComponentInChildren<HorizontalAxis>();
		_container_graph_categories = ((Component)((Component)this).transform).GetComponentInChildren<GraphCategoriesContainer>();
	}

	internal List<NanoObject> getObjects()
	{
		return _current_objects;
	}

	internal List<HistoryDataAsset> getCategories()
	{
		return _list_categories;
	}

	internal bool hasCategory(HistoryDataAsset pCategory)
	{
		return _list_categories.Contains(pCategory);
	}

	internal bool hasCategory(string pCategory)
	{
		HistoryDataAsset pCategory2 = AssetManager.history_data_library.get(pCategory);
		return hasCategory(pCategory2);
	}

	private static string getCategoryName(string pCategory)
	{
		return GraphHelpers.getCategoryName(pCategory);
	}

	private NanoObject extractObject(string pCategory)
	{
		if (!pCategory.Contains('|'))
		{
			return null;
		}
		_ = pCategory.Split('|')[0];
		string text = pCategory.Split('|')[1];
		string text2 = pCategory.Split('|')[2];
		foreach (NanoObject current_object in _current_objects)
		{
			if (current_object.getType() == text && current_object.getTypeID() == text2)
			{
				return current_object;
			}
		}
		return null;
	}

	internal bool isCategoryEnabled(string pCategory)
	{
		string categoryName = getCategoryName(pCategory);
		return _category_enabled[categoryName];
	}

	internal string getActiveCategory()
	{
		foreach (string key in _category_enabled.Keys)
		{
			if (_category_enabled[key])
			{
				return key;
			}
		}
		return null;
	}

	private void loadCategories()
	{
		if (_categories_loaded)
		{
			return;
		}
		_categories_loaded = true;
		_list_categories.Clear();
		HashSet<HistoryDataAsset> hashSet = new HashSet<HistoryDataAsset>();
		foreach (MetaType current_type in _current_types)
		{
			HistoryMetaDataAsset[] assets = AssetManager.history_meta_data_library.getAssets(current_type);
			HashSet<HistoryDataAsset> hashSet2 = new HashSet<HistoryDataAsset>();
			HistoryMetaDataAsset[] array = assets;
			foreach (HistoryMetaDataAsset historyMetaDataAsset in array)
			{
				hashSet2.UnionWith(historyMetaDataAsset.categories);
			}
			if (hashSet.Count == 0)
			{
				hashSet.UnionWith(hashSet2);
			}
			else
			{
				hashSet.IntersectWith(hashSet2);
			}
		}
		foreach (NanoObject current_object in _current_objects)
		{
			foreach (HistoryDataAsset item in hashSet)
			{
				if (!hasCategory(item))
				{
					addCategory(item, item.enabled_default);
				}
				colorCategory(item, current_object, multi_chart);
			}
		}
	}

	internal void addCategory(HistoryDataAsset pAsset, bool pEnabled = false)
	{
		_list_categories.Add(pAsset);
		_category_enabled[pAsset.id] = pEnabled;
	}

	internal void disableAllCategories(string pExcept = null)
	{
		foreach (HistoryDataAsset category in getCategories())
		{
			if (!(category.id == pExcept))
			{
				setCategoryEnabled(category.id, pIsOn: false, pUpdateGraph: false);
			}
		}
	}

	internal void pickRandomCategory()
	{
		using ListPool<string> listPool = GraphHelpers.bestCategories(_min_max_categories);
		if (listPool.Count != 0)
		{
			string random = listPool.GetRandom();
			tryEnableCategory(random);
		}
	}

	internal void tryEnableCategory(string pCategory)
	{
		if (!string.IsNullOrEmpty(pCategory) && hasCategory(pCategory))
		{
			_container_graph_categories.setCategoryEnabled(pCategory, pEnabled: true);
		}
	}

	internal void setCategoryEnabled(string pCategory, bool pIsOn, bool pUpdateGraph = true)
	{
		_category_enabled[pCategory] = pIsOn;
		foreach (string categoryName in ((GraphChartBase)chart).DataSource.CategoryNames)
		{
			if (categoryName.StartsWith(pCategory + "|"))
			{
				((GraphChartBase)chart).DataSource.SetCategoryEnabled(categoryName, pIsOn);
			}
		}
		if (pUpdateGraph)
		{
			updateGraph();
		}
	}

	private void hookEvents()
	{
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Expected O, but got Unknown
		if (_events_hooked)
		{
			return;
		}
		_events_hooked = true;
		((UnityEvent<GraphEventArgs>)(object)((GraphChartBase)chart).PointHovered).AddListener((UnityAction<GraphEventArgs>)delegate
		{
			Tooltip.cancelHiding();
		});
		if (multi_chart)
		{
			((UnityEvent<GraphEventArgs>)(object)((GraphChartBase)chart).PointHovered).AddListener((UnityAction<GraphEventArgs>)multiChartHover);
		}
		else
		{
			((UnityEvent<GraphEventArgs>)(object)((GraphChartBase)chart).PointHovered).AddListener((UnityAction<GraphEventArgs>)singleChartHover);
		}
		UnityEvent nonHovered = ((GraphChartBase)chart).NonHovered;
		object obj = _003C_003Ec._003C_003E9__39_1;
		if (obj == null)
		{
			UnityAction val = delegate
			{
				Tooltip.scheduledHide(0.15f, pSkipTouch: true);
			};
			_003C_003Ec._003C_003E9__39_1 = val;
			obj = (object)val;
		}
		nonHovered.AddListener((UnityAction)obj);
	}

	private void multiChartHover(GraphEventArgs pArgs)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		long tYear = (long)pArgs.Value.x;
		string tCategoryName = getCategoryName(pArgs.Category);
		if (Tooltip.anyActive())
		{
			Tooltip tooltip = Tooltip.findActive(delegate(Tooltip pTooltip)
			{
				if (pTooltip.asset.id != "graph_multi_resource")
				{
					return false;
				}
				return !(pTooltip.data.tip_name != tCategoryName) && pTooltip.data.custom_data_long["year"] == tYear;
			});
			if ((Object)(object)tooltip != (Object)null)
			{
				tooltip.reposition();
				return;
			}
		}
		CustomDataContainer<string> customDataContainer = new CustomDataContainer<string>();
		CustomDataContainer<long> customDataContainer2 = new CustomDataContainer<long>();
		customDataContainer2["year"] = tYear;
		foreach (string categoryName in ((GraphChartBase)chart).DataSource.CategoryNames)
		{
			if (isCategoryEnabled(categoryName))
			{
				NanoObject nanoObject = extractObject(categoryName);
				string name = nanoObject.name;
				(long tValue, long tPrevious) categoryValueAtTime = getCategoryValueAtTime(categoryName, (long)pArgs.Value.x);
				long item = categoryValueAtTime.tValue;
				long item2 = categoryValueAtTime.tPrevious;
				customDataContainer2[name] = item;
				customDataContainer2[name + "_previous"] = item2;
				customDataContainer[name] = Toolbox.colorToHex(Color32.op_Implicit(nanoObject.getColor().getColorText()));
			}
		}
		Tooltip.show(pArgs.Position, "graph_multi_resource", new TooltipData
		{
			tip_name = tCategoryName,
			custom_data_long = customDataContainer2,
			custom_data_string = customDataContainer
		});
	}

	private void singleChartHover(GraphEventArgs pArgs)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		Tooltip.hideTooltip();
		CustomDataContainer<long> customDataContainer = new CustomDataContainer<long>();
		customDataContainer["year"] = (long)pArgs.Value.x;
		foreach (string categoryName2 in ((GraphChartBase)chart).DataSource.CategoryNames)
		{
			if (isCategoryEnabled(categoryName2))
			{
				string categoryName = getCategoryName(categoryName2);
				(long tValue, long tPrevious) categoryValueAtTime = getCategoryValueAtTime(categoryName2, (long)pArgs.Value.x);
				long item = categoryValueAtTime.tValue;
				long item2 = categoryValueAtTime.tPrevious;
				customDataContainer[categoryName] = item;
				customDataContainer[categoryName + "_previous"] = item2;
			}
		}
		NanoObject nano_object = extractObject(pArgs.Category);
		Tooltip.show(pArgs.Position, "graph_resource", new TooltipData
		{
			custom_data_long = customDataContainer,
			nano_object = nano_object
		});
	}

	public void resetAndUpdateGraph()
	{
		_loaded = false;
		_categories_loaded = false;
		_current_interval = HistoryInterval.None;
		_container_time_scale.resetTimeScale();
		updateGraph();
		_container_time_scale.calcBounds();
	}

	public bool randomTimeScale()
	{
		if (_container_time_scale.randomizeTimeScale())
		{
			updateGraph();
			return true;
		}
		return false;
	}

	public void forceUpdateGraph()
	{
		updateGraph();
	}

	private void updateGraph()
	{
		if (!Config.disable_db && Config.graphs)
		{
			((ScrollableChartData)((GraphChartBase)chart).DataSource).StartBatch();
			loadGraph();
			if (_container_time_scale.resetTimeScale())
			{
				clearChartData();
			}
			loadSample();
			loadCategoryAndCharts();
			adjustCharts();
			((ScrollableChartData)((GraphChartBase)chart).DataSource).EndBatch();
		}
	}

	private void loadGraph()
	{
		if (!_loaded)
		{
			_loaded = true;
			((AxisBase)((Component)chart).GetComponent<HorizontalAxis>()).CustomNumberFormatWorldbox = GraphHelpers.horizontalFormatYears;
			((AnyChart)chart).CustomNumberFormat = GraphHelpers.verticalFormat;
			((Behaviour)_vertical_axis).enabled = true;
			((Behaviour)_horizontal_axis).enabled = true;
			if (multi_chart)
			{
				loadMultiChart();
			}
			else
			{
				loadSingleChart();
			}
			hookEvents();
		}
	}

	private void loadSingleChart()
	{
		NanoObject pMetaObject = AssetManager.meta_type_library.getAsset(_meta_type).get_selected();
		selectContainer(pMetaObject);
	}

	private void loadMultiChart()
	{
		_current_types.Clear();
		_current_objects.Clear();
		_last_data.Clear();
		foreach (NanoObject item in Config.selected_objects_graph)
		{
			if (item != null && item.isAlive())
			{
				addContainer(item);
			}
		}
		clearChartData();
		_category_enabled.Clear();
	}

	private void showCategory(string pCategory, NanoObject pObject)
	{
		string type = pObject.getType();
		string typeID = pObject.getTypeID();
		CategoryData categoryData = _current_datas[typeID];
		string text = pCategory + "|" + type + "|" + typeID;
		for (LinkedListNode<Dictionary<string, long>> linkedListNode = categoryData.Last; linkedListNode != null; linkedListNode = linkedListNode.Previous)
		{
			if (linkedListNode.Value.ContainsKey(pCategory))
			{
				long num = linkedListNode.Value[pCategory];
				long num2 = linkedListNode.Value["timestamp"];
				bool flag = false;
				long num3 = linkedListNode.Previous?.Value[pCategory] ?? 0;
				long num4 = linkedListNode.Next?.Value[pCategory] ?? 0;
				if (num == num3 && num == num4)
				{
					flag = true;
				}
				((GraphChartBase)chart).DataSource.AddPointToCategory(text, (double)num2, (double)num, (double)(flag ? 0f : (-1f)));
			}
		}
	}

	private (long tValue, long tPrevious) getCategoryValueAtTime(string pCategory, long pTime)
	{
		string categoryName = getCategoryName(pCategory);
		string key = pCategory.Split('|').Last();
		CategoryData categoryData = _current_datas[key];
		long item = 0L;
		long item2 = 0L;
		bool flag = false;
		for (LinkedListNode<Dictionary<string, long>> linkedListNode = categoryData.Last; linkedListNode != null; linkedListNode = linkedListNode.Previous)
		{
			if (linkedListNode.Value.ContainsKey(categoryName))
			{
				if (flag)
				{
					item2 = linkedListNode.Value[categoryName];
					break;
				}
				long num = linkedListNode.Value["timestamp"];
				if (num <= pTime)
				{
					if (num <= pTime)
					{
						item = linkedListNode.Value[categoryName];
					}
					flag = true;
				}
			}
		}
		return (tValue: item, tPrevious: item2);
	}

	private void colorCategory(HistoryDataAsset pHistoryDataAsset, NanoObject pObject, bool pColorFromObject = false)
	{
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		string type = pObject.getType();
		string typeID = pObject.getTypeID();
		string id = pHistoryDataAsset.id;
		string text = id + "|" + type + "|" + typeID;
		float num = 2f;
		MaterialTiling val = default(MaterialTiling);
		val.EnableTiling = false;
		bool flag = true;
		Material chartLineMaterial;
		Material chartInnerFillMaterial;
		if (pColorFromObject)
		{
			Color colorText = pObject.getColor().getColorText();
			chartLineMaterial = HistoryDataAsset.getChartLineMaterial(colorText);
			chartInnerFillMaterial = HistoryDataAsset.getChartInnerFillMaterial(colorText);
		}
		else
		{
			chartLineMaterial = pHistoryDataAsset.getChartLineMaterial();
			chartInnerFillMaterial = pHistoryDataAsset.getChartInnerFillMaterial();
		}
		((GraphChartBase)chart).DataSource.AddCategory(text, chartLineMaterial, (double)num, val, chartInnerFillMaterial, flag, (Material)null, 0.0, false);
		((GraphChartBase)chart).DataSource.SetCategoryEnabled(text, isCategoryEnabled(id));
		((GraphChartBase)chart).DataSource.Set2DCategoryPrefabs(text, (ChartItemEffect)null, pHistoryDataAsset.getHoverPointMaterial());
		int num2 = 10;
		((GraphChartBase)chart).DataSource.SetCategoryPoint(text, pHistoryDataAsset.getChartPointMaterial(), (double)num2);
	}

	private MinMax getMinMax(string pCategoryName)
	{
		long num = long.MaxValue;
		long num2 = long.MinValue;
		bool flag = false;
		string key = pCategoryName.Split('|')[0];
		_ = pCategoryName.Split('|')[1];
		string key2 = pCategoryName.Split('|')[2];
		if (_current_datas.Count == 0 || !_current_datas.ContainsKey(key2))
		{
			return new MinMax(0L, 0L);
		}
		for (LinkedListNode<Dictionary<string, long>> linkedListNode = _current_datas[key2].Last; linkedListNode != null; linkedListNode = linkedListNode.Previous)
		{
			Dictionary<string, long> value = linkedListNode.Value;
			if (value.ContainsKey(key))
			{
				long num3 = value[key];
				long num4 = value["timestamp"];
				if (flag && num4 < _min_timestamp)
				{
					break;
				}
				if (num3 < num)
				{
					num = num3;
				}
				if (num3 > num2)
				{
					num2 = num3;
				}
				flag = true;
			}
		}
		if (!flag)
		{
			return new MinMax(0L, 0L);
		}
		return new MinMax(num, num2);
	}

	internal void adjustCharts()
	{
		long num = long.MaxValue;
		long num2 = 0L;
		_min_max_categories.Clear();
		foreach (string categoryName in ((GraphChartBase)chart).DataSource.CategoryNames)
		{
			MinMax minMax = getMinMax(categoryName);
			_min_max_categories.Add(categoryName, minMax);
			if (isCategoryEnabled(categoryName))
			{
				if (minMax.max > num2)
				{
					num2 = minMax.max;
				}
				if (minMax.min < num)
				{
					num = minMax.min;
				}
			}
		}
		num2 = GraphHelpers.calculateNiceMaxAxisSize((double)num2 * 1.05);
		int num3 = GraphHelpers.findVerticalDivision(num2);
		if (num >= 0)
		{
			num = 0L;
		}
		else
		{
			num = GraphHelpers.calculateNiceMaxAxisSize((double)(-num) * 1.05);
			if (num < num2)
			{
				long num4 = num2 / num3;
				int num5 = Mathf.CeilToInt((float)num / (float)num4);
				num = num5 * num4;
				num3 += num5;
			}
			else
			{
				num3 = GraphHelpers.findVerticalDivision(num);
				long num6 = num / num3;
				int num7 = Mathf.CeilToInt((float)num2 / (float)num6);
				num2 = num7 * num6;
				num3 += num7;
			}
		}
		((ScrollableChartData)((GraphChartBase)chart).DataSource).VerticalViewOrigin = -num;
		((ScrollableChartData)((GraphChartBase)chart).DataSource).VerticalViewSize = num2 + num;
		((ScrollableChartData)((GraphChartBase)chart).DataSource).HorizontalViewOrigin = GraphTimeLibrary.getMinTime(_current_sample);
		((ScrollableChartData)((GraphChartBase)chart).DataSource).HorizontalViewSize = GraphTimeLibrary.getMaxTime(_current_sample) - GraphTimeLibrary.getMinTime(_current_sample);
		((ChartDivisionInfo)((AxisBase)_horizontal_axis).MainDivisions).Total = 5;
		((ChartDivisionInfo)((AxisBase)_horizontal_axis).MainDivisions).FractionDigits = 2;
		((ChartDivisionInfo)((AxisBase)_vertical_axis).MainDivisions).Total = num3;
		min_max = new MinMax(-num, num2);
	}

	private void loadSample()
	{
		GraphTimeScale currentScale = _container_time_scale.getCurrentScale();
		_current_sample = AssetManager.graph_time_library.get(currentScale.ToString());
		bool flag = false;
		_current_interval = _current_sample.interval;
		foreach (NanoObject current_object in _current_objects)
		{
			string typeID = current_object.getTypeID();
			if (!_current_datas.TryGetValue(typeID, out var value))
			{
				value = new CategoryData();
				_current_datas[typeID] = value;
			}
			if (DBGetter.getData(value, current_object, _current_interval, _last_data[current_object]))
			{
				flag = true;
			}
		}
		if (flag)
		{
			clearChartData();
		}
		_min_timestamp = GraphTimeLibrary.getMinTime(_current_sample);
		_max_timestamp = GraphTimeLibrary.getMaxTime(_current_sample);
	}

	private void clearChartData()
	{
		_categories_loaded = false;
		((ScrollableChartData)((GraphChartBase)chart).DataSource).Clear();
	}

	private void loadCategoryAndCharts()
	{
		loadCategories();
		foreach (NanoObject current_object in _current_objects)
		{
			foreach (HistoryDataAsset list_category in _list_categories)
			{
				string id = list_category.id;
				showCategory(id, current_object);
			}
		}
		_container_graph_categories.apply();
	}

	private void selectContainer(NanoObject pMetaObject)
	{
		MetaType metaType = pMetaObject.getMetaType();
		if (!_current_types.Contains(metaType))
		{
			_category_enabled.Clear();
			clearChartData();
		}
		else if (!_current_objects.Contains(pMetaObject))
		{
			clearChartData();
		}
		_current_types.Clear();
		_current_objects.Clear();
		_last_data.Clear();
		_current_types.Add(metaType);
		_current_objects.Add(pMetaObject);
		HistoryMetaDataAsset[] assets = AssetManager.history_meta_data_library.getAssets(metaType);
		foreach (HistoryMetaDataAsset historyMetaDataAsset in assets)
		{
			_last_data[pMetaObject] = historyMetaDataAsset.collector(pMetaObject);
			_last_data[pMetaObject].timestamp = Date.getCurrentYear();
		}
	}

	private void addContainer(NanoObject pMetaObject)
	{
		MetaType metaType = pMetaObject.getMetaType();
		_current_types.Add(metaType);
		_current_objects.Add(pMetaObject);
		HistoryMetaDataAsset[] assets = AssetManager.history_meta_data_library.getAssets(metaType);
		foreach (HistoryMetaDataAsset historyMetaDataAsset in assets)
		{
			_last_data[pMetaObject] = historyMetaDataAsset.collector(pMetaObject);
			_last_data[pMetaObject].timestamp = Date.getCurrentYear();
		}
	}

	private void clearGraph()
	{
		clearChartData();
		_category_enabled.Clear();
		_list_categories.Clear();
		_loaded = false;
		_container_graph_categories.apply();
	}

	internal void load()
	{
		_loaded = false;
		if (multi_chart)
		{
			_current_interval = HistoryInterval.None;
			_container_time_scale.resetTimeScale();
		}
		if (clear_on_enable)
		{
			clearGraph();
		}
		if (_last_timestamp != Date.getMonthsSince(0.0))
		{
			_last_timestamp = Date.getMonthsSince(0.0);
			foreach (CategoryData value in _current_datas.Values)
			{
				value.Dispose();
			}
			_current_datas.Clear();
			clearChartData();
		}
		updateGraph();
		_container_time_scale.calcBounds();
	}

	private void clear()
	{
		_current_types.Clear();
		_current_objects.Clear();
		_last_data.Clear();
	}

	private void OnEnable()
	{
		load();
	}

	private void OnDisable()
	{
		clear();
	}
}
// --- End of File: GraphController.cs ---



// --- Start of File: GraphHelpers.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using UnityPools;

public static class GraphHelpers
{
	public static string getCategoryName(string pCategory)
	{
		if (!pCategory.Contains('|'))
		{
			return pCategory;
		}
		return pCategory.Split('|')[0];
	}

	public static ListPool<string> bestCategories(Dictionary<string, MinMax> pCategoryStats)
	{
		Dictionary<string, AvgStats> dictionary = UnsafeCollectionPool<Dictionary<string, AvgStats>, KeyValuePair<string, AvgStats>>.Get();
		foreach (KeyValuePair<string, MinMax> pCategoryStat in pCategoryStats)
		{
			string categoryName = getCategoryName(pCategoryStat.Key);
			MinMax value = pCategoryStat.Value;
			if (!dictionary.TryGetValue(categoryName, out var value2))
			{
				value2 = new AvgStats(0.0, 0, categoryName);
			}
			dictionary[categoryName] = value2.add(value.max);
		}
		using ListPool<AvgStats> listPool = new ListPool<AvgStats>(dictionary.Values);
		UnsafeCollectionPool<Dictionary<string, AvgStats>, KeyValuePair<string, AvgStats>>.Release(dictionary);
		listPool.Sort(delegate(AvgStats a, AvgStats b)
		{
			int num2 = b.count.CompareTo(a.count);
			return (num2 == 0) ? b.avg.CompareTo(a.avg) : num2;
		});
		int num = Math.Min(3, listPool.Count);
		ListPool<string> listPool2 = new ListPool<string>(num);
		for (int i = 0; i < num; i++)
		{
			if (i <= 0 || (!(listPool[i].avg <= 3.0) && listPool[i].count >= listPool[0].count))
			{
				listPool2.Add(listPool[i].name);
			}
		}
		return listPool2;
	}

	public static string horizontalFormatYears(double pValue, int pDigits)
	{
		return Toolbox.formatNumber((long)(pValue - (double)Date.getCurrentYear()) * -1) + "\n" + pValue.ToText();
	}

	public static string verticalFormat(double pValue, int pDigits)
	{
		MinMax min_max = GraphController.min_max;
		double num = Math.Abs(pValue);
		string text = null;
		text = ((!(num < 1000.0)) ? Toolbox.formatNumber((long)pValue) : pValue.ToString("N" + pDigits));
		if (pValue == 0.0)
		{
			return Toolbox.coloredText(text, "#FFBC66");
		}
		if (pValue < 0.0)
		{
			string pColor = Toolbox.colorBetween(pValue, min_max.min, 0.0, "#FF637D", "#FFBC66");
			return Toolbox.coloredText(text, pColor);
		}
		string pColor2 = Toolbox.colorBetween(pValue, 0.0, min_max.max, "#FFBC66", "#F3961F");
		return Toolbox.coloredText(text, pColor2);
	}

	public static long calculateNiceMaxAxisSize(double pLargestValue)
	{
		if (pLargestValue < 5.0)
		{
			return 5L;
		}
		if (pLargestValue < 8.0)
		{
			return 8L;
		}
		if (pLargestValue < 10.0)
		{
			return 10L;
		}
		if (pLargestValue < 20.0)
		{
			return 20L;
		}
		if (pLargestValue < 30.0)
		{
			return 30L;
		}
		if (pLargestValue < 40.0)
		{
			return 40L;
		}
		if (pLargestValue < 50.0)
		{
			return 50L;
		}
		if (pLargestValue < 60.0)
		{
			return 60L;
		}
		if (pLargestValue < 80.0)
		{
			return 80L;
		}
		if (pLargestValue < 100.0)
		{
			return 100L;
		}
		if (pLargestValue < 120.0)
		{
			return 120L;
		}
		if (pLargestValue < 140.0)
		{
			return 140L;
		}
		if (pLargestValue < 160.0)
		{
			return 160L;
		}
		if (pLargestValue < 180.0)
		{
			return 180L;
		}
		if (pLargestValue < 200.0)
		{
			return 200L;
		}
		if (pLargestValue < 240.0)
		{
			return 240L;
		}
		if (pLargestValue < 280.0)
		{
			return 280L;
		}
		if (pLargestValue < 300.0)
		{
			return 300L;
		}
		if (pLargestValue < 340.0)
		{
			return 340L;
		}
		if (pLargestValue < 380.0)
		{
			return 380L;
		}
		if (pLargestValue < 400.0)
		{
			return 400L;
		}
		if (pLargestValue < 500.0)
		{
			return 500L;
		}
		if (pLargestValue < 600.0)
		{
			return 600L;
		}
		if (pLargestValue < 700.0)
		{
			return 700L;
		}
		if (pLargestValue < 800.0)
		{
			return 800L;
		}
		if (pLargestValue < 900.0)
		{
			return 900L;
		}
		if (pLargestValue < 1000.0)
		{
			return 1000L;
		}
		double num = Mathf.Pow(10f, Mathf.Floor(Mathf.Log10((float)pLargestValue)));
		double num2 = pLargestValue / num;
		double num3 = ((num2 <= 1.5) ? 1.5 : ((num2 <= 2.0) ? 2.0 : ((num2 <= 3.0) ? 3.0 : ((!(num2 <= 5.0)) ? 10.0 : 5.0))));
		return (long)(num3 * num);
	}

	public static int findVerticalDivision(long pValue)
	{
		if (canDivideIntoWholeNumbers(pValue, 4))
		{
			return 4;
		}
		if (canDivideIntoWholeNumbers(pValue, 5))
		{
			return 5;
		}
		if (canDivideIntoWholeNumbers(pValue, 3))
		{
			return 3;
		}
		if (canDivideIntoWholeNumbers(pValue, 6))
		{
			return 6;
		}
		if (canDivideIntoWholeNumbers(pValue, 2))
		{
			return 2;
		}
		return 4;
	}

	private static bool canDivideIntoWholeNumbers(long pTotalValue, int pSegments)
	{
		for (int i = 1; i <= pSegments; i++)
		{
			if ((double)pTotalValue / (double)pSegments * (double)i % 1.0 > 0.0)
			{
				return false;
			}
		}
		return true;
	}
}
// --- End of File: GraphHelpers.cs ---



// --- Start of File: GraphMetaType.cs ---
public enum GraphMetaType
{
	Kingdom,
	City,
	Culture
}
// --- End of File: GraphMetaType.cs ---



// --- Start of File: GraphTextTimeScale.cs ---
using UnityEngine;
using UnityEngine.UI;

public class GraphTextTimeScale : MonoBehaviour
{
	public GraphTimeScaleContainer graph_time_scale_container;

	private Text _text;

	public void Awake()
	{
		_text = ((Component)this).GetComponent<Text>();
	}

	public void Update()
	{
		string text = Toolbox.formatNumber(AssetManager.graph_time_library.get(graph_time_scale_container.current_scale.ToString()).max_time_frame);
		text += graph_time_scale_container.getIndexString();
		_text.text = text;
	}
}
// --- End of File: GraphTextTimeScale.cs ---



// --- Start of File: GraphTimeAsset.cs ---
using System;
using db;

[Serializable]
public class GraphTimeAsset : Asset
{
	public GraphTimeScale scale_id;

	public HistoryInterval interval;

	public int max_time_frame;
}
// --- End of File: GraphTimeAsset.cs ---



// --- Start of File: GraphTimeLibrary.cs ---
using db;

public class GraphTimeLibrary : AssetLibrary<GraphTimeAsset>
{
	public override void init()
	{
		base.init();
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_10,
			max_time_frame = 10,
			interval = HistoryInterval.Yearly1
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_25,
			max_time_frame = 25,
			interval = HistoryInterval.Yearly5
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_100,
			max_time_frame = 100,
			interval = HistoryInterval.Yearly10
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_250,
			max_time_frame = 250,
			interval = HistoryInterval.Yearly50
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_500,
			max_time_frame = 500,
			interval = HistoryInterval.Yearly50
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_1000,
			max_time_frame = 1000,
			interval = HistoryInterval.Yearly100
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_2500,
			max_time_frame = 2500,
			interval = HistoryInterval.Yearly500
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_5000,
			max_time_frame = 5000,
			interval = HistoryInterval.Yearly500
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_10000,
			max_time_frame = 10000,
			interval = HistoryInterval.Yearly1000
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_50000,
			max_time_frame = 50000,
			interval = HistoryInterval.Yearly5000
		});
		add(new GraphTimeAsset
		{
			scale_id = GraphTimeScale.year_100000,
			max_time_frame = 100000,
			interval = HistoryInterval.Yearly10000
		});
	}

	public static long getMinTime(GraphTimeAsset pAsset)
	{
		return Date.getYear((float)Date.getYearsSince(0.0) * 60f - 60f * (float)pAsset.max_time_frame);
	}

	public static long getMaxTime(GraphTimeAsset pAsset)
	{
		return Date.getYear((float)Date.getYearsSince(0.0) * 60f);
	}

	public override GraphTimeAsset add(GraphTimeAsset pAsset)
	{
		pAsset.id = pAsset.scale_id.ToString();
		return base.add(pAsset);
	}
}
// --- End of File: GraphTimeLibrary.cs ---



// --- Start of File: GraphTimeScale.cs ---
public enum GraphTimeScale
{
	year_10,
	year_25,
	year_100,
	year_250,
	year_500,
	year_1000,
	year_2500,
	year_5000,
	year_10000,
	year_50000,
	year_100000
}
// --- End of File: GraphTimeScale.cs ---



// --- Start of File: GraphTimeScaleContainer.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using db;

public class GraphTimeScaleContainer : MonoBehaviour
{
	public GraphTimeScale current_scale;

	private List<GraphTimeScale> _available_time_scales = new List<GraphTimeScale>();

	private GraphController _controller;

	public void calcBounds()
	{
		if ((Object)(object)_controller == (Object)null)
		{
			_controller = ((Component)this).GetComponentInParent<GraphController>();
		}
		_available_time_scales.Clear();
		_available_time_scales.Add(GraphTimeScale.year_10);
		foreach (NanoObject @object in _controller.getObjects())
		{
			using ListPool<GraphTimeScale> listPool = DBGetter.getTimeScales(@object);
			foreach (ref GraphTimeScale item in listPool)
			{
				GraphTimeScale current = item;
				if (!_available_time_scales.Contains(current))
				{
					_available_time_scales.Add(current);
				}
			}
		}
		bool active = _available_time_scales.Count > 1;
		ButtonGraphScalePlusMinus[] componentsInChildren = ((Component)this).GetComponentsInChildren<ButtonGraphScalePlusMinus>(true);
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			((Component)componentsInChildren[i]).gameObject.SetActive(active);
		}
	}

	public bool resetTimeScale()
	{
		calcBounds();
		if (!_available_time_scales.Contains(current_scale))
		{
			current_scale = _available_time_scales.Last();
			return true;
		}
		return false;
	}

	public void setTimeScale(GraphTimeScale pScale)
	{
		current_scale = pScale;
	}

	public ListPool<GraphTimeScale> sharedTimeScales()
	{
		ListPool<GraphTimeScale> listPool = new ListPool<GraphTimeScale>((GraphTimeScale[])Enum.GetValues(typeof(GraphTimeScale)));
		foreach (NanoObject @object in _controller.getObjects())
		{
			ListPool<GraphTimeScale> tAvailableTimeScales = DBGetter.getTimeScales(@object);
			try
			{
				listPool.RemoveAll((GraphTimeScale tScale) => !tAvailableTimeScales.Contains(tScale));
			}
			finally
			{
				if (tAvailableTimeScales != null)
				{
					((IDisposable)tAvailableTimeScales).Dispose();
				}
			}
		}
		return listPool;
	}

	public bool randomizeTimeScale()
	{
		if (_available_time_scales.Count < 2)
		{
			return false;
		}
		using ListPool<GraphTimeScale> listPool = sharedTimeScales();
		if (listPool.Count == 0)
		{
			return false;
		}
		if (listPool.Count > 2)
		{
			listPool.Shift();
		}
		GraphTimeScale random = listPool.GetRandom();
		if (random != current_scale)
		{
			current_scale = random;
			return true;
		}
		return false;
	}

	public void timeScaleMinus()
	{
		int num = (int)current_scale;
		if (num > 0)
		{
			current_scale = (GraphTimeScale)(num - 1);
		}
		else
		{
			current_scale = (GraphTimeScale)(_available_time_scales.Count - 1);
		}
	}

	public void timeScalePlus()
	{
		int num = (int)current_scale;
		if (num < _available_time_scales.Count - 1)
		{
			current_scale = (GraphTimeScale)(num + 1);
		}
		else
		{
			current_scale = GraphTimeScale.year_10;
		}
	}

	public string getIndexString()
	{
		if (_available_time_scales.Count == 0)
		{
			return "";
		}
		return " (" + (int)(current_scale + 1) + "/" + _available_time_scales.Count + ")";
	}

	public GraphTimeScale getCurrentScale()
	{
		return current_scale;
	}
}
// --- End of File: GraphTimeScaleContainer.cs ---



// --- Start of File: GraphyCaller.cs ---
using UnityEngine;

public class GraphyCaller : MonoBehaviour
{
	private int clicked;

	public void click()
	{
		clicked++;
		if (clicked > 10)
		{
			bool flag = DebugConfig.isOn(DebugOption.DebugButton);
			DebugConfig.setOption(DebugOption.DebugButton, !flag);
			DebugConfig.instance.debugButton.SetActive(!flag);
		}
	}

	public void clickConsole()
	{
		clicked++;
		if (clicked > 10)
		{
			World.world.console.Show();
		}
	}

	private void OnEnable()
	{
		clicked = 0;
	}
}
// --- End of File: GraphyCaller.cs ---



// --- Start of File: GreyGooLayer.cs ---
using System.Collections.Generic;

public class GreyGooLayer : BaseModule
{
	private const float SPREAD_CHANCE = 0.05f;

	private const float REMOVE_CHANCE = 0.09f;

	private const float INTERVAL = 0.08f;

	private List<WorldTile> _to_remove = new List<WorldTile>();

	private List<WorldTile> _to_add = new List<WorldTile>();

	private bool _initiated;

	internal override void create()
	{
		base.create();
		hashset = new HashSet<WorldTile>();
	}

	internal override void clear()
	{
		base.clear();
		hashset.Clear();
		_to_remove.Clear();
		_to_add.Clear();
		_initiated = false;
	}

	public bool isActive()
	{
		return hashset.Count > 0;
	}

	private void init()
	{
		_initiated = true;
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			if (worldTile.Type.grey_goo)
			{
				add(worldTile);
			}
		}
	}

	public override void update(float pElapsed)
	{
		if (!_initiated)
		{
			init();
		}
		base.update(pElapsed);
		if (isActive() && !World.world.isPaused())
		{
			if (timer > 0f)
			{
				timer -= pElapsed;
				return;
			}
			timer = 0.08f;
			_to_remove.Clear();
			_to_add.Clear();
			updateGooTiles();
			removeFromHashset();
			addToHashset();
		}
	}

	private void updateGooTiles()
	{
		if (hashset.Count == 0)
		{
			return;
		}
		foreach (WorldTile item in hashset)
		{
			if (!item.Type.grey_goo)
			{
				_to_remove.Add(item);
				continue;
			}
			if (item.hasBuilding())
			{
				item.building.startDestroyBuilding();
			}
			if (Randy.randomChance(0.05f))
			{
				terraform(item);
				checkAroundTiles(item);
				_to_remove.Add(item);
			}
			else if (Randy.randomChance(0.05f))
			{
				checkAroundTiles(item);
			}
			else if (Randy.randomChance(0.09f) && areAroundTilesEmpty(item))
			{
				_to_remove.Add(item);
				if (item.Type.grey_goo)
				{
					terraform(item);
				}
			}
		}
	}

	private void removeFromHashset()
	{
		if (_to_remove.Count != 0)
		{
			for (int i = 0; i < _to_remove.Count; i++)
			{
				WorldTile pTile = _to_remove[i];
				remove(pTile);
			}
		}
	}

	private void addToHashset()
	{
		if (_to_add.Count != 0)
		{
			for (int i = 0; i < _to_add.Count; i++)
			{
				WorldTile pTile = _to_add[i];
				add(pTile);
			}
		}
	}

	private void checkAroundTiles(WorldTile pTile)
	{
		if (WorldLawLibrary.world_law_gaias_covenant.isEnabled())
		{
			return;
		}
		WorldTile[] neighbours = pTile.neighbours;
		foreach (WorldTile worldTile in neighbours)
		{
			TileTypeBase type = worldTile.Type;
			if (!type.grey_goo && !type.IsType("pit_deep_ocean") && (!type.IsType("deep_ocean") || worldTile.hasBuilding()))
			{
				_to_add.Add(worldTile);
			}
		}
	}

	private bool areAroundTilesEmpty(WorldTile pTile)
	{
		WorldTile[] neighbours = pTile.neighbours;
		foreach (WorldTile obj in neighbours)
		{
			TileTypeBase type = obj.Type;
			if (obj.hasBuilding())
			{
				return false;
			}
			if (!type.grey_goo && !type.considered_empty_tile)
			{
				return false;
			}
		}
		return true;
	}

	private void makeGoo(WorldTile pTile)
	{
		pTile.unfreeze(99);
		MapAction.terraformMain(pTile, TileLibrary.grey_goo);
	}

	private void terraform(WorldTile pTile)
	{
		MapAction.terraformMain(pTile, TileLibrary.pit_deep_ocean, TerraformLibrary.grey_goo);
		MusicBox.playSound("event:/SFX/DESTRUCTION/GreyGooEat", pTile, pGameViewOnly: false, pVisibleOnly: true);
	}

	public void remove(WorldTile pTile)
	{
		hashset.Remove(pTile);
	}

	public void add(WorldTile pTile)
	{
		if (!pTile.Type.considered_empty_tile && hashset.Add(pTile))
		{
			makeGoo(pTile);
		}
	}
}
// --- End of File: GreyGooLayer.cs ---



// --- Start of File: GridLayoutGroupExtended.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.UI;

namespace LayoutGroupExt;

[AddComponentMenu("Layout/Grid Layout Group ( Extended )", 152)]
public class GridLayoutGroupExtended : LayoutGroupExtended
{
	public enum Corner
	{
		UpperLeft,
		UpperRight,
		LowerLeft,
		LowerRight
	}

	public enum Axis
	{
		Horizontal,
		Vertical
	}

	public enum Constraint
	{
		Flexible,
		FixedColumnCount,
		FixedRowCount
	}

	private TweenerCore<Vector3, Vector3, VectorOptions>[] _axis_tween = new TweenerCore<Vector3, Vector3, VectorOptions>[2];

	[SerializeField]
	protected Corner m_StartCorner;

	[SerializeField]
	protected Axis m_StartAxis;

	[SerializeField]
	protected Vector2 m_CellSize = new Vector2(100f, 100f);

	[SerializeField]
	protected Vector2 m_Spacing = Vector2.zero;

	[SerializeField]
	protected Constraint m_Constraint;

	[SerializeField]
	protected int m_ConstraintCount = 2;

	public Corner startCorner
	{
		get
		{
			return m_StartCorner;
		}
		set
		{
			((LayoutGroup)this).SetProperty<Corner>(ref m_StartCorner, value);
		}
	}

	public Axis startAxis
	{
		get
		{
			return m_StartAxis;
		}
		set
		{
			((LayoutGroup)this).SetProperty<Axis>(ref m_StartAxis, value);
		}
	}

	public Vector2 cellSize
	{
		get
		{
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			return m_CellSize;
		}
		set
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			((LayoutGroup)this).SetProperty<Vector2>(ref m_CellSize, value);
		}
	}

	public Vector2 spacing
	{
		get
		{
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			return m_Spacing;
		}
		set
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			((LayoutGroup)this).SetProperty<Vector2>(ref m_Spacing, value);
		}
	}

	public Constraint constraint
	{
		get
		{
			return m_Constraint;
		}
		set
		{
			((LayoutGroup)this).SetProperty<Constraint>(ref m_Constraint, value);
		}
	}

	public int constraintCount
	{
		get
		{
			return m_ConstraintCount;
		}
		set
		{
			((LayoutGroup)this).SetProperty<int>(ref m_ConstraintCount, Mathf.Max(1, value));
		}
	}

	protected GridLayoutGroupExtended()
	{
	}//IL_0017: Unknown result type (might be due to invalid IL or missing references)
	//IL_001c: Unknown result type (might be due to invalid IL or missing references)
	//IL_0022: Unknown result type (might be due to invalid IL or missing references)
	//IL_0027: Unknown result type (might be due to invalid IL or missing references)


	public override void CalculateLayoutInputHorizontal()
	{
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		base.CalculateLayoutInputHorizontal();
		int num = 0;
		int num2 = 0;
		if (m_Constraint == Constraint.FixedColumnCount)
		{
			num = (num2 = m_ConstraintCount);
		}
		else if (m_Constraint == Constraint.FixedRowCount)
		{
			num = (num2 = Mathf.CeilToInt((float)((LayoutGroup)this).rectChildren.Count / (float)m_ConstraintCount - 0.001f));
		}
		else
		{
			num = 1;
			num2 = Mathf.CeilToInt(Mathf.Sqrt((float)((LayoutGroup)this).rectChildren.Count));
		}
		((LayoutGroup)this).SetLayoutInputForAxis((float)((LayoutGroup)this).padding.horizontal + (cellSize.x + spacing.x) * (float)num - spacing.x, (float)((LayoutGroup)this).padding.horizontal + (cellSize.x + spacing.x) * (float)num2 - spacing.x, -1f, 0);
	}

	public override void CalculateLayoutInputVertical()
	{
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d8: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		if (m_Constraint == Constraint.FixedColumnCount)
		{
			num = Mathf.CeilToInt((float)((LayoutGroup)this).rectChildren.Count / (float)m_ConstraintCount - 0.001f);
		}
		else if (m_Constraint == Constraint.FixedRowCount)
		{
			num = m_ConstraintCount;
		}
		else
		{
			Rect rect = ((LayoutGroup)this).rectTransform.rect;
			float width = ((Rect)(ref rect)).width;
			int num2 = Mathf.Max(1, Mathf.FloorToInt((width - (float)((LayoutGroup)this).padding.horizontal + spacing.x + 0.001f) / (cellSize.x + spacing.x)));
			num = Mathf.CeilToInt((float)((LayoutGroup)this).rectChildren.Count / (float)num2);
		}
		float num3 = (float)((LayoutGroup)this).padding.vertical + (cellSize.y + spacing.y) * (float)num - spacing.y;
		TweenLayoutInputForAxis(num3, num3, -1f, 1);
	}

	private void TweenLayoutInputForAxis(float totalMin, float totalPreferred, float totalFlexible, int axis)
	{
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		if (!Application.isPlaying)
		{
			((LayoutGroup)this).SetLayoutInputForAxis(totalMin, totalPreferred, totalFlexible, axis);
			return;
		}
		Vector3 val = default(Vector3);
		((Vector3)(ref val))._002Ector(totalMin, totalPreferred, totalFlexible);
		Vector3 val2 = default(Vector3);
		((Vector3)(ref val2))._002Ector(((LayoutGroup)this).GetTotalMinSize(axis), ((LayoutGroup)this).GetTotalPreferredSize(axis), ((LayoutGroup)this).GetTotalFlexibleSize(axis));
		if (val == val2)
		{
			return;
		}
		TweenerCore<Vector3, Vector3, VectorOptions> val3 = _axis_tween[axis];
		if (TweenExtensions.IsActive((Tween)(object)val3))
		{
			if (val3.endValue == val)
			{
				return;
			}
			TweenExtensions.Kill((Tween)(object)val3, false);
		}
		_axis_tween[axis] = DOPreferredSize(val, moveDuration * 0.5f, axis);
	}

	private TweenerCore<Vector3, Vector3, VectorOptions> DOPreferredSize(Vector3 endValue, float duration, int axis)
	{
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Expected O, but got Unknown
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Expected O, but got Unknown
		TweenerCore<Vector3, Vector3, VectorOptions> obj = DOTween.To((DOGetter<Vector3>)(() => new Vector3(((LayoutGroup)this).GetTotalMinSize(axis), ((LayoutGroup)this).GetTotalPreferredSize(axis), ((LayoutGroup)this).GetTotalFlexibleSize(axis))), (DOSetter<Vector3>)delegate(Vector3 x)
		{
			//IL_0006: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0012: Unknown result type (might be due to invalid IL or missing references)
			((LayoutGroup)this).SetLayoutInputForAxis(x.x, x.y, x.z, axis);
		}, endValue, duration);
		TweenSettingsExtensions.OnUpdate<TweenerCore<Vector3, Vector3, VectorOptions>>(obj, (TweenCallback)delegate
		{
			((LayoutGroup)this).SetDirty();
		});
		TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(obj, (TweenCallback)delegate
		{
			((LayoutGroup)this).SetDirty();
		});
		TweenSettingsExtensions.SetTarget<TweenerCore<Vector3, Vector3, VectorOptions>>(obj, (object)this);
		return obj;
	}

	protected override void OnDisable()
	{
		TweenExtensions.Kill((Tween)(object)_axis_tween[0], false);
		TweenExtensions.Kill((Tween)(object)_axis_tween[1], false);
		base.OnDisable();
	}

	public override void SetLayoutHorizontal()
	{
		SetCellsAlongAxis(0);
	}

	public override void SetLayoutVertical()
	{
		SetCellsAlongAxis(1);
	}

	private void SetCellsAlongAxis(int axis)
	{
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_019c: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0263: Unknown result type (might be due to invalid IL or missing references)
		//IL_0274: Unknown result type (might be due to invalid IL or missing references)
		//IL_0284: Unknown result type (might be due to invalid IL or missing references)
		//IL_0295: Unknown result type (might be due to invalid IL or missing references)
		//IL_02aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_03bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_03c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_03cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_03d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_03dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_03ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_03f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0410: Unknown result type (might be due to invalid IL or missing references)
		//IL_0418: Unknown result type (might be due to invalid IL or missing references)
		//IL_041d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0428: Unknown result type (might be due to invalid IL or missing references)
		//IL_042d: Unknown result type (might be due to invalid IL or missing references)
		//IL_043e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0443: Unknown result type (might be due to invalid IL or missing references)
		int count = ((LayoutGroup)this).rectChildren.Count;
		if (axis == 0)
		{
			for (int i = 0; i < count; i++)
			{
				RectTransform val = ((LayoutGroup)this).rectChildren[i];
				((DrivenRectTransformTracker)(ref ((LayoutGroup)this).m_Tracker)).Add((Object)(object)this, val, (DrivenTransformProperties)16134);
				val.anchorMin = Vector2.up;
				val.anchorMax = Vector2.up;
				val.sizeDelta = cellSize;
			}
			return;
		}
		Rect rect = ((LayoutGroup)this).rectTransform.rect;
		float x = ((Rect)(ref rect)).size.x;
		rect = ((LayoutGroup)this).rectTransform.rect;
		float y = ((Rect)(ref rect)).size.y;
		int num = 1;
		int num2 = 1;
		if (m_Constraint == Constraint.FixedColumnCount)
		{
			num = m_ConstraintCount;
			if (count > num)
			{
				num2 = count / num + ((count % num > 0) ? 1 : 0);
			}
		}
		else if (m_Constraint != Constraint.FixedRowCount)
		{
			num = ((!(cellSize.x + spacing.x <= 0f)) ? Mathf.Max(1, Mathf.FloorToInt((x - (float)((LayoutGroup)this).padding.horizontal + spacing.x + 0.001f) / (cellSize.x + spacing.x))) : int.MaxValue);
			num2 = ((!(cellSize.y + spacing.y <= 0f)) ? Mathf.Max(1, Mathf.FloorToInt((y - (float)((LayoutGroup)this).padding.vertical + spacing.y + 0.001f) / (cellSize.y + spacing.y))) : int.MaxValue);
		}
		else
		{
			num2 = m_ConstraintCount;
			if (count > num2)
			{
				num = count / num2 + ((count % num2 > 0) ? 1 : 0);
			}
		}
		int num3 = (int)startCorner % 2;
		int num4 = (int)startCorner / 2;
		int num5;
		int num6;
		int num7;
		if (startAxis == Axis.Horizontal)
		{
			num5 = num;
			num6 = Mathf.Clamp(num, 1, count);
			num7 = ((m_Constraint != Constraint.FixedRowCount) ? Mathf.Clamp(num2, 1, Mathf.CeilToInt((float)count / (float)num5)) : Mathf.Min(num2, count));
		}
		else
		{
			num5 = num2;
			num7 = Mathf.Clamp(num2, 1, count);
			num6 = ((m_Constraint != Constraint.FixedColumnCount) ? Mathf.Clamp(num, 1, Mathf.CeilToInt((float)count / (float)num5)) : Mathf.Min(num, count));
		}
		Vector2 val2 = default(Vector2);
		((Vector2)(ref val2))._002Ector((float)num6 * cellSize.x + (float)(num6 - 1) * spacing.x, (float)num7 * cellSize.y + (float)(num7 - 1) * spacing.y);
		Vector2 val3 = default(Vector2);
		((Vector2)(ref val3))._002Ector(((LayoutGroup)this).GetStartOffset(0, val2.x), ((LayoutGroup)this).GetStartOffset(1, val2.y));
		int num8 = 0;
		if (count > m_ConstraintCount && Mathf.CeilToInt((float)count / (float)num5) < m_ConstraintCount)
		{
			num8 = m_ConstraintCount - Mathf.CeilToInt((float)count / (float)num5);
			num8 += Mathf.FloorToInt((float)num8 / ((float)num5 - 1f));
			if (count % num5 == 1)
			{
				num8++;
			}
		}
		for (int j = 0; j < count; j++)
		{
			int num9;
			int num10;
			if (startAxis == Axis.Horizontal)
			{
				if (m_Constraint == Constraint.FixedRowCount && count - j <= num8)
				{
					num9 = 0;
					num10 = m_ConstraintCount - (count - j);
				}
				else
				{
					num9 = j % num5;
					num10 = j / num5;
				}
			}
			else if (m_Constraint == Constraint.FixedColumnCount && count - j <= num8)
			{
				num9 = m_ConstraintCount - (count - j);
				num10 = 0;
			}
			else
			{
				num9 = j / num5;
				num10 = j % num5;
			}
			if (num3 == 1)
			{
				num9 = num6 - 1 - num9;
			}
			if (num4 == 1)
			{
				num10 = num7 - 1 - num10;
			}
			RectTransform rect2 = ((LayoutGroup)this).rectChildren[j];
			float y2 = val3.y;
			Vector2 val4 = cellSize;
			float num11 = ((Vector2)(ref val4))[1];
			val4 = spacing;
			float pos = y2 + (num11 + ((Vector2)(ref val4))[1]) * (float)num10;
			val4 = cellSize;
			SetChildAlongAxis(rect2, 1, pos, ((Vector2)(ref val4))[1]);
			RectTransform rect3 = ((LayoutGroup)this).rectChildren[j];
			float x2 = val3.x;
			val4 = cellSize;
			float num12 = ((Vector2)(ref val4))[0];
			val4 = spacing;
			float pos2 = x2 + (num12 + ((Vector2)(ref val4))[0]) * (float)num9;
			val4 = cellSize;
			SetChildAlongAxis(rect3, 0, pos2, ((Vector2)(ref val4))[0]);
		}
	}
}
// --- End of File: GridLayoutGroupExtended.cs ---



// --- Start of File: GridPos.cs ---
using System;

namespace EpPathFinding.cs;

public class GridPos : IEquatable<GridPos>
{
	public int x;

	public int y;

	public GridPos()
	{
		x = 0;
		y = 0;
	}

	public GridPos(int iX, int iY)
	{
		x = iX;
		y = iY;
	}

	public GridPos(GridPos b)
	{
		x = b.x;
		y = b.y;
	}

	public override int GetHashCode()
	{
		return x ^ y;
	}

	public override bool Equals(object obj)
	{
		GridPos gridPos = (GridPos)obj;
		if ((object)gridPos == null)
		{
			return false;
		}
		if (x == gridPos.x)
		{
			return y == gridPos.y;
		}
		return false;
	}

	public bool Equals(GridPos p)
	{
		if ((object)p == null)
		{
			return false;
		}
		if (x == p.x)
		{
			return y == p.y;
		}
		return false;
	}

	public static bool operator ==(GridPos a, GridPos b)
	{
		if ((object)a == b)
		{
			return true;
		}
		if ((object)a == null)
		{
			return false;
		}
		if ((object)b == null)
		{
			return false;
		}
		if (a.x == b.x)
		{
			return a.y == b.y;
		}
		return false;
	}

	public static bool operator !=(GridPos a, GridPos b)
	{
		return !(a == b);
	}

	public GridPos Set(int iX, int iY)
	{
		x = iX;
		y = iY;
		return this;
	}

	public override string ToString()
	{
		return $"({x},{y})";
	}
}
// --- End of File: GridPos.cs ---



// --- Start of File: GridRect.cs ---
namespace EpPathFinding.cs;

public class GridRect
{
	public int minX;

	public int minY;

	public int maxX;

	public int maxY;

	public GridRect()
	{
		minX = 0;
		minY = 0;
		maxX = 0;
		maxY = 0;
	}

	public GridRect(int iMinX, int iMinY, int iMaxX, int iMaxY)
	{
		minX = iMinX;
		minY = iMinY;
		maxX = iMaxX;
		maxY = iMaxY;
	}

	public GridRect(GridRect b)
	{
		minX = b.minX;
		minY = b.minY;
		maxX = b.maxX;
		maxY = b.maxY;
	}

	public override int GetHashCode()
	{
		return minX ^ minY ^ maxX ^ maxY;
	}

	public override bool Equals(object obj)
	{
		GridRect gridRect = (GridRect)obj;
		if ((object)gridRect == null)
		{
			return false;
		}
		if (minX == gridRect.minX && minY == gridRect.minY && maxX == gridRect.maxX)
		{
			return maxY == gridRect.maxY;
		}
		return false;
	}

	public bool Equals(GridRect p)
	{
		if ((object)p == null)
		{
			return false;
		}
		if (minX == p.minX && minY == p.minY && maxX == p.maxX)
		{
			return maxY == p.maxY;
		}
		return false;
	}

	public static bool operator ==(GridRect a, GridRect b)
	{
		if ((object)a == b)
		{
			return true;
		}
		if ((object)a == null)
		{
			return false;
		}
		if ((object)b == null)
		{
			return false;
		}
		if (a.minX == b.minX && a.minY == b.minY && a.maxX == b.maxX)
		{
			return a.maxY == b.maxY;
		}
		return false;
	}

	public static bool operator !=(GridRect a, GridRect b)
	{
		return !(a == b);
	}

	public GridRect Set(int iMinX, int iMinY, int iMaxX, int iMaxY)
	{
		minX = iMinX;
		minY = iMinY;
		maxX = iMaxX;
		maxY = iMaxY;
		return this;
	}
}
// --- End of File: GridRect.cs ---



// --- Start of File: GroupSpriteObject.cs ---
using FMOD.Studio;
using UnityEngine;

public class GroupSpriteObject : MonoBehaviour
{
	internal EventInstance fmod_instance;

	internal Transform m_transform;

	internal SpriteRenderer sprite_renderer;

	private bool _has_sprite_renderer;

	private Vector2 _last_pos_v2 = new Vector2(-1f, -1f);

	private Vector2 _last_scale_v2 = new Vector2(-1f, -1f);

	private Vector3 _last_pos_v3 = new Vector3(-1f, -1f, -1f);

	private Vector3 _last_scale_v3 = new Vector3(-1f, -1f, -1f);

	private Vector3 _last_angles_v3 = new Vector3(-1f, -1f, -1f);

	private Color _last_color;

	private bool _last_flip_x;

	private int _last_sprite_hash_code = -1;

	private int _last_sprite_material = -1;

	public int last_id;

	public bool has_sprite_renderer => _has_sprite_renderer;

	private void Awake()
	{
		create();
	}

	protected void create()
	{
		m_transform = ((Component)this).gameObject.transform;
		sprite_renderer = ((Component)this).gameObject.GetComponent<SpriteRenderer>();
		if ((Object)(object)sprite_renderer != (Object)null)
		{
			_has_sprite_renderer = true;
		}
	}

	public void checkRotation(Vector3 pPos, BaseSimObject pSimObject, float pZ)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		pPos.z = pZ;
		Vector3 pivot = default(Vector3);
		ref Vector3 current_rotation = ref pSimObject.current_rotation;
		if (current_rotation.y != 0f || current_rotation.z != 0f)
		{
			((Vector3)(ref pivot)).Set(pSimObject.cur_transform_position.x, pSimObject.cur_transform_position.y, 0f);
			pPos = Toolbox.RotatePointAroundPivot(ref pPos, ref pivot, ref current_rotation);
			pPos.z = pZ;
		}
		setPosOnly(ref pPos);
		setLocalEulerAngles(pSimObject.current_rotation);
	}

	public void setPosOnly(Vector2 pPosition)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y)
		{
			_last_pos_v2 = pPosition;
			_last_pos_v3 = Vector2.op_Implicit(pPosition);
			m_transform.localPosition = _last_pos_v3;
		}
	}

	public void setPosOnly(ref Vector2 pPosition)
	{
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y || _last_pos_v3.z != 0f)
		{
			_last_pos_v2 = pPosition;
			_last_pos_v3 = Vector2.op_Implicit(pPosition);
			m_transform.localPosition = _last_pos_v3;
		}
	}

	public void setPosOnly(ref Vector3 pPosition)
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y || _last_pos_v3.z != pPosition.z)
		{
			_last_pos_v2 = Vector2.op_Implicit(pPosition);
			_last_pos_v3 = pPosition;
			m_transform.localPosition = _last_pos_v3;
		}
	}

	public void setRotation(ref Vector3 pVec)
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		if (_last_angles_v3.y != pVec.y || _last_angles_v3.z != pVec.z)
		{
			_last_angles_v3 = pVec;
			m_transform.eulerAngles = pVec;
		}
	}

	public void setLocalEulerAngles(Vector3 pVec)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		if (_last_angles_v3.y != pVec.y || _last_angles_v3.z != pVec.z)
		{
			_last_angles_v3 = pVec;
			m_transform.localEulerAngles = pVec;
		}
	}

	public void setSprite(Sprite pSprite)
	{
		int hashCode = ((object)pSprite).GetHashCode();
		if (_last_sprite_hash_code != hashCode)
		{
			sprite_renderer.sprite = pSprite;
			_last_sprite_hash_code = hashCode;
		}
	}

	public void setFlipX(bool pFlipX)
	{
		if (_last_flip_x != pFlipX)
		{
			_last_flip_x = pFlipX;
			sprite_renderer.flipX = pFlipX;
		}
	}

	public void setSharedMat(Material pMaterial)
	{
		int hashCode = ((object)pMaterial).GetHashCode();
		if (_last_sprite_material != hashCode)
		{
			((Renderer)sprite_renderer).sharedMaterial = pMaterial;
			_last_sprite_material = hashCode;
		}
	}

	public void setColor(ref Color pColor)
	{
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		if (_last_color.r != pColor.r || _last_color.g != pColor.g || _last_color.b != pColor.b || _last_color.a != pColor.a)
		{
			sprite_renderer.color = pColor;
			_last_color = pColor;
		}
	}

	public void setScale(float pScale)
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		if (_last_scale_v3.y != pScale)
		{
			_last_scale_v2 = new Vector2(pScale, pScale);
			_last_scale_v3 = Vector2.op_Implicit(_last_scale_v2);
			m_transform.localScale = _last_scale_v3;
		}
	}

	public void setScale(float pScaleX, float pScaleY)
	{
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		if (_last_scale_v2.y != pScaleY || _last_scale_v2.x != pScaleX)
		{
			_last_scale_v2 = new Vector2(pScaleX, pScaleY);
			_last_scale_v3 = Vector2.op_Implicit(_last_scale_v2);
			m_transform.localScale = _last_scale_v3;
		}
	}

	public void setScale(ref Vector3 pScaleVec)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		if (_last_scale_v3 != pScaleVec)
		{
			_last_scale_v3 = pScaleVec;
			m_transform.localScale = pScaleVec;
		}
	}

	public void set(ref Vector2 pPosition, ref Vector3 pScale)
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v2.x != pPosition.x || _last_pos_v2.y != pPosition.y)
		{
			_last_pos_v2 = pPosition;
			_last_pos_v3 = Vector2.op_Implicit(pPosition);
			m_transform.localPosition = _last_pos_v3;
		}
		if (_last_scale_v2.y != pScale.y || _last_scale_v2.x != pScale.x)
		{
			_last_scale_v2 = Vector2.op_Implicit(pScale);
			_last_scale_v3 = Vector2.op_Implicit(_last_scale_v2);
			m_transform.localScale = pScale;
		}
	}

	public void set(ref Vector2 pPosition, float pScale)
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y)
		{
			_last_pos_v2 = pPosition;
			_last_pos_v3 = Vector2.op_Implicit(pPosition);
			m_transform.localPosition = _last_pos_v3;
		}
		if (_last_scale_v2.x != pScale)
		{
			setScale(pScale);
		}
	}

	public void set(ref Vector3 pPosition, float pScale)
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y || _last_pos_v3.z != pPosition.z)
		{
			_last_pos_v2 = Vector2.op_Implicit(pPosition);
			_last_pos_v3 = pPosition;
			m_transform.localPosition = _last_pos_v3;
		}
		if (_last_scale_v2.x != pScale)
		{
			setScale(pScale);
		}
	}

	public void set(ref Vector3 pPosition, ref Vector2 pScale)
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y || _last_pos_v3.z != pPosition.z)
		{
			_last_pos_v2 = Vector2.op_Implicit(pPosition);
			_last_pos_v3 = pPosition;
			m_transform.localPosition = _last_pos_v3;
		}
		if (_last_scale_v2.y != pScale.y || _last_scale_v2.x != pScale.x)
		{
			_last_scale_v2 = pScale;
			_last_scale_v3 = Vector2.op_Implicit(_last_scale_v2);
			m_transform.localScale = Vector2.op_Implicit(pScale);
		}
	}

	public void set(ref Vector3 pPosition, ref Vector3 pScale)
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		if (_last_pos_v3.x != pPosition.x || _last_pos_v3.y != pPosition.y)
		{
			_last_pos_v2 = Vector2.op_Implicit(pPosition);
			_last_pos_v3 = pPosition;
			m_transform.localPosition = _last_pos_v3;
		}
		if (_last_scale_v2.y != pScale.y || _last_scale_v2.x != pScale.x)
		{
			_last_scale_v2 = Vector2.op_Implicit(pScale);
			_last_scale_v3 = Vector2.op_Implicit(_last_scale_v2);
			m_transform.localScale = pScale;
		}
	}
}
// --- End of File: GroupSpriteObject.cs ---



// --- Start of File: GrowTypeSelector.cs ---
using System;

[Serializable]
public delegate BuildingAsset GrowTypeSelector(WorldTile pTile);
// --- End of File: GrowTypeSelector.cs ---



// --- Start of File: HandRendererTexturePreloader.cs ---
using UnityEngine;

public static class HandRendererTexturePreloader
{
	private static int _preloaded_items_counter;

	public static void launch()
	{
		AssetManager.items.loadSprites();
		AssetManager.unit_hand_tools.loadSprites();
		AssetManager.resources.loadSprites();
		preloadItemsIntoAtlas();
	}

	private static void preloadItemsIntoAtlas()
	{
		foreach (UnitHandToolAsset item in AssetManager.unit_hand_tools.list)
		{
			preloadSpritesUnitHands(pUseColors: item.is_colored, pSprites: item.getSprites());
		}
		foreach (EquipmentAsset item2 in AssetManager.items.list)
		{
			preloadSpritesUnitHands(pUseColors: item2.is_colored, pSprites: item2.getSprites());
		}
		foreach (ResourceAsset item3 in AssetManager.resources.list)
		{
			preloadSpritesUnitHands(pUseColors: item3.is_colored, pSprites: item3.getSprites());
		}
		Debug.Log((object)("Total Preloaded Hand Renderer Sprites : " + _preloaded_items_counter + " with colors " + ColorAsset.getAllColorsList().Count));
	}

	private static void preloadSpritesUnitHands(Sprite[] pSprites, bool pUseColors)
	{
		if (pSprites == null)
		{
			return;
		}
		Sprite[] array;
		if (pUseColors)
		{
			foreach (ColorAsset allColors in ColorAsset.getAllColorsList())
			{
				array = pSprites;
				for (int i = 0; i < array.Length; i++)
				{
					DynamicSprites.preloadItemSprite(array[i], allColors);
					_preloaded_items_counter++;
				}
			}
			return;
		}
		array = pSprites;
		for (int i = 0; i < array.Length; i++)
		{
			DynamicSprites.preloadItemSprite(array[i]);
			_preloaded_items_counter++;
		}
	}

	public static int getTotal()
	{
		return _preloaded_items_counter;
	}
}
// --- End of File: HandRendererTexturePreloader.cs ---



// --- Start of File: HappinessAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using UnityEngine;

[Serializable]
public class HappinessAsset : Asset, ILocalizedAsset, IMultiLocalesAsset
{
	public HappinessDelegateCalc calc;

	public int value;

	public string pot_task_id;

	public int pot_amount;

	public int index;

	public string path_icon;

	public bool ignored_by_psychopaths;

	[DefaultValue(true)]
	public bool show_change_happiness_effect = true;

	public int dialogs_amount = 4;

	private Sprite _cached_sprite;

	public virtual Sprite getSprite()
	{
		if (_cached_sprite == null)
		{
			_cached_sprite = SpriteTextureLoader.getSprite(path_icon);
		}
		return _cached_sprite;
	}

	public string getLocaleID()
	{
		return "happiness_" + id;
	}

	public IEnumerable<string> getLocaleIDs()
	{
		for (int i = 0; i < dialogs_amount; i++)
		{
			yield return getHappinnessDialogID() + i;
		}
	}

	public string getHappinnessDialogID()
	{
		return "happiness_dialog_" + id + "_";
	}

	public string getTextSingleReport()
	{
		int num = Random.Range(0, dialogs_amount);
		return getHappinnessDialogID() + num;
	}

	public string getRandomTextSingleReportLocalized()
	{
		return LocalizedTextManager.getText(getTextSingleReport());
	}
}
// --- End of File: HappinessAsset.cs ---



// --- Start of File: HappinessBarIcon.cs ---
using UnityEngine;
using UnityEngine.UI;

public class HappinessBarIcon : MonoBehaviour
{
	[SerializeField]
	private Image _icon;

	private Actor _actor;

	private void Awake()
	{
		((Component)this).GetComponentInParent<StatBar>().addCallback(barUpdated);
	}

	public void load(Actor pActor)
	{
		_actor = pActor;
	}

	private void barUpdated(float pValue, float pMax)
	{
		if (!_actor.isRekt())
		{
			Sprite spriteBasedOnHappinessValue = HappinessHelper.getSpriteBasedOnHappinessValue(_actor.getHappiness());
			_icon.sprite = spriteBasedOnHappinessValue;
		}
	}

	private void OnDisable()
	{
		_actor = null;
	}
}
// --- End of File: HappinessBarIcon.cs ---



// --- Start of File: HappinessDelegateCalc.cs ---
public delegate int HappinessDelegateCalc(Actor pActor);
// --- End of File: HappinessDelegateCalc.cs ---



// --- Start of File: HappinessHelper.cs ---
using UnityEngine;

public static class HappinessHelper
{
	public static Sprite getSpriteBasedOnHappinessValue(int pValue)
	{
		if (pValue < -80)
		{
			return SpriteTextureLoader.getSprite("ui/Icons/iconHappiness_1");
		}
		if (pValue < -20)
		{
			return SpriteTextureLoader.getSprite("ui/Icons/iconHappiness_2");
		}
		if (pValue < 20)
		{
			return SpriteTextureLoader.getSprite("ui/Icons/iconHappiness_3");
		}
		if (pValue < 40)
		{
			return SpriteTextureLoader.getSprite("ui/Icons/iconHappiness_4");
		}
		if (pValue < 80)
		{
			return SpriteTextureLoader.getSprite("ui/Icons/iconHappiness_5");
		}
		return SpriteTextureLoader.getSprite("ui/Icons/iconHappiness_6");
	}
}
// --- End of File: HappinessHelper.cs ---



// --- Start of File: HappinessHistory.cs ---
public struct HappinessHistory
{
	public int index;

	public double timestamp;

	public int bonus;

	public HappinessAsset asset => AssetManager.happiness_library.list[index];

	public string getAgoString()
	{
		return Date.getAgoString(timestamp);
	}

	public double elapsedSince()
	{
		return World.world.getWorldTimeElapsedSince(timestamp);
	}
}
// --- End of File: HappinessHistory.cs ---



// --- Start of File: HappinessLibrary.cs ---
public class HappinessLibrary : AssetLibrary<HappinessAsset>
{
	public override void init()
	{
		base.init();
		add(new HappinessAsset
		{
			id = "death_family_member",
			value = -20,
			pot_task_id = "crying",
			path_icon = "ui/Icons/iconDead",
			ignored_by_psychopaths = true,
			pot_amount = 5
		});
		add(new HappinessAsset
		{
			id = "death_lover",
			value = -50,
			pot_task_id = "crying",
			path_icon = "ui/Icons/iconCrying",
			ignored_by_psychopaths = true,
			pot_amount = 5
		});
		add(new HappinessAsset
		{
			id = "death_child",
			value = -60,
			pot_task_id = "crying",
			path_icon = "ui/Icons/iconCrying",
			ignored_by_psychopaths = true,
			pot_amount = 10
		});
		add(new HappinessAsset
		{
			id = "death_best_friend",
			value = -25,
			pot_task_id = "crying",
			path_icon = "ui/Icons/iconDead",
			ignored_by_psychopaths = true,
			pot_amount = 3
		});
		add(new HappinessAsset
		{
			id = "got_robbed",
			value = -20,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/actor_traits/iconThief",
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "got_poked",
			value = -5,
			dialogs_amount = 10,
			path_icon = "ui/Icons/iconGodFinger"
		});
		add(new HappinessAsset
		{
			id = "lost_fight",
			value = -20,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/actor_traits/iconWeak",
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "got_caught",
			value = -20,
			pot_task_id = "crying",
			path_icon = "ui/Icons/iconSuspicious",
			ignored_by_psychopaths = true,
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "paid_tax",
			value = -5,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/kingdom_traits/kingdom_trait_tax_rate_local_high",
			pot_amount = 1
		});
		add(new HappinessAsset
		{
			id = "just_ate",
			path_icon = "ui/Icons/iconHunger",
			value = 10
		});
		add(new HappinessAsset
		{
			id = "just_received_gift",
			path_icon = "ui/Icons/iconGift",
			ignored_by_psychopaths = true,
			value = 10
		});
		add(new HappinessAsset
		{
			id = "just_gave_gift",
			path_icon = "ui/Icons/iconGift",
			value = 20
		});
		add(new HappinessAsset
		{
			id = "just_pooped",
			path_icon = "ui/Icons/iconPoop",
			value = 5
		});
		add(new HappinessAsset
		{
			id = "just_slept",
			path_icon = "ui/Icons/iconSleep",
			value = 5
		});
		add(new HappinessAsset
		{
			id = "had_bad_dream",
			path_icon = "ui/Icons/iconDreamBad",
			value = -15
		});
		add(new HappinessAsset
		{
			id = "had_good_dream",
			path_icon = "ui/Icons/iconDreamGood",
			value = 15
		});
		add(new HappinessAsset
		{
			id = "had_nightmare",
			path_icon = "ui/Icons/iconDreamNightmare",
			value = -30
		});
		add(new HappinessAsset
		{
			id = "slept_outside",
			path_icon = "ui/Icons/iconSleep",
			value = -30
		});
		add(new HappinessAsset
		{
			id = "just_kissed",
			value = 10,
			pot_task_id = "singing",
			path_icon = "ui/Icons/iconLovers",
			ignored_by_psychopaths = true,
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "just_killed",
			path_icon = "ui/Icons/iconKills",
			value = 10
		});
		add(new HappinessAsset
		{
			id = "become_king",
			value = 50,
			pot_task_id = "happy_laughing",
			path_icon = "ui/Icons/iconKings",
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "become_leader",
			value = 40,
			pot_task_id = "happy_laughing",
			path_icon = "ui/Icons/iconLeaders",
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "just_won_war",
			path_icon = "ui/Icons/iconWar",
			value = 20,
			pot_task_id = "singing",
			pot_amount = 3
		});
		add(new HappinessAsset
		{
			id = "just_made_peace",
			path_icon = "ui/Icons/actor_traits/iconPeaceful",
			value = 5
		});
		add(new HappinessAsset
		{
			id = "just_lost_war",
			path_icon = "ui/Icons/iconDeadKingdom",
			value = -20,
			pot_task_id = "swearing",
			ignored_by_psychopaths = true,
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "was_conquered",
			path_icon = "ui/Icons/iconDeadKingdom",
			value = -20,
			pot_task_id = "crying",
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "kingdom_fell_apart",
			path_icon = "ui/Icons/iconDeadKingdom",
			value = -5,
			pot_task_id = "swearing",
			ignored_by_psychopaths = true,
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "just_started_war",
			path_icon = "ui/Icons/iconWar",
			value = 20
		});
		add(new HappinessAsset
		{
			id = "just_rebelled",
			value = 30,
			pot_task_id = "singing",
			path_icon = "ui/Icons/iconRebellion",
			pot_amount = 3
		});
		add(new HappinessAsset
		{
			id = "fallen_in_love",
			value = 40,
			pot_task_id = "singing",
			path_icon = "ui/Icons/iconLovers",
			ignored_by_psychopaths = true,
			pot_amount = 3
		});
		add(new HappinessAsset
		{
			id = "just_had_child",
			value = 30,
			pot_task_id = "singing",
			path_icon = "ui/Icons/iconChildren",
			ignored_by_psychopaths = true,
			pot_amount = 1
		});
		add(new HappinessAsset
		{
			id = "just_read_book",
			path_icon = "ui/Icons/iconBooks",
			value = 10
		});
		add(new HappinessAsset
		{
			id = "just_played",
			value = 15,
			pot_task_id = "happy_laughing",
			ignored_by_psychopaths = true,
			path_icon = "ui/Icons/iconPlayed",
			pot_amount = 3
		});
		add(new HappinessAsset
		{
			id = "just_talked",
			path_icon = "ui/Icons/iconRecoverySocial",
			value = 10
		});
		add(new HappinessAsset
		{
			id = "just_laughed",
			path_icon = "ui/Icons/iconLaughing",
			value = 5
		});
		add(new HappinessAsset
		{
			id = "just_sang",
			path_icon = "ui/Icons/iconSinging",
			value = 10
		});
		add(new HappinessAsset
		{
			id = "just_swore",
			path_icon = "ui/Icons/iconSwearing",
			value = 2
		});
		add(new HappinessAsset
		{
			id = "just_cried",
			path_icon = "ui/Icons/iconCrying",
			ignored_by_psychopaths = true,
			value = 5
		});
		add(new HappinessAsset
		{
			id = "just_talked_gossip",
			path_icon = "ui/Icons/iconRecoveryPlot",
			value = 14
		});
		add(new HappinessAsset
		{
			id = "just_surprised",
			value = -10,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/iconSurprised",
			show_change_happiness_effect = false,
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "just_born",
			value = 50,
			pot_task_id = "singing",
			path_icon = "ui/Icons/iconAge",
			pot_amount = 1,
			dialogs_amount = 13,
			show_change_happiness_effect = false
		});
		add(new HappinessAsset
		{
			id = "just_magnetised",
			value = -10,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/iconMagnetized",
			dialogs_amount = 13,
			show_change_happiness_effect = false,
			pot_amount = 3
		});
		add(new HappinessAsset
		{
			id = "just_forced_power",
			path_icon = "ui/Icons/iconForce",
			show_change_happiness_effect = false,
			value = -20
		});
		add(new HappinessAsset
		{
			id = "just_possessed",
			path_icon = "ui/Icons/iconPossessed",
			show_change_happiness_effect = false,
			value = -20
		});
		add(new HappinessAsset
		{
			id = "strange_urge",
			path_icon = "ui/Icons/iconStrangeUrge",
			show_change_happiness_effect = false,
			value = -5
		});
		add(new HappinessAsset
		{
			id = "just_had_tantrum",
			path_icon = "ui/Icons/iconTantrum",
			value = 25
		});
		add(new HappinessAsset
		{
			id = "just_felt_the_divine",
			path_icon = "ui/Icons/iconGodFinger",
			value = 40
		});
		add(new HappinessAsset
		{
			id = "just_enchanted",
			path_icon = "ui/Icons/iconEnchanted",
			value = 30
		});
		add(new HappinessAsset
		{
			id = "just_inspired",
			path_icon = "ui/Icons/iconInspired",
			value = 25
		});
		add(new HappinessAsset
		{
			id = "wrote_book",
			path_icon = "ui/Icons/iconBooksWritten",
			value = 20
		});
		add(new HappinessAsset
		{
			id = "just_became_adult",
			path_icon = "ui/Icons/iconAdults",
			value = 30
		});
		add(new HappinessAsset
		{
			id = "just_got_out_of_egg",
			path_icon = "ui/Icons/iconEgg",
			show_change_happiness_effect = false,
			value = 20
		});
		add(new HappinessAsset
		{
			id = "just_finished_plot",
			path_icon = "ui/Icons/iconPlotList",
			value = 25
		});
		add(new HappinessAsset
		{
			id = "just_found_house",
			path_icon = "ui/Icons/iconHoused",
			value = 35
		});
		add(new HappinessAsset
		{
			id = "just_lost_house",
			value = -30,
			pot_task_id = "start_tantrum",
			path_icon = "ui/Icons/iconHomeless",
			pot_amount = 1
		});
		add(new HappinessAsset
		{
			id = "just_made_friend",
			path_icon = "ui/Icons/iconFriendship",
			value = 40
		});
		add(new HappinessAsset
		{
			id = "just_injured",
			value = -20,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/actor_traits/iconCrippled",
			pot_amount = 2
		});
		add(new HappinessAsset
		{
			id = "just_cursed",
			path_icon = "ui/Icons/iconCursed",
			value = -20
		});
		add(new HappinessAsset
		{
			id = "starving",
			path_icon = "ui/Icons/iconHungry",
			value = -40
		});
		add(new HappinessAsset
		{
			id = "conquered_city",
			path_icon = "ui/Icons/iconCitySelect",
			value = 30
		});
		add(new HappinessAsset
		{
			id = "destroyed_city",
			path_icon = "ui/Icons/iconRebellion",
			value = 35
		});
		add(new HappinessAsset
		{
			id = "lost_crown",
			value = -60,
			pot_task_id = "start_tantrum",
			path_icon = "ui/Icons/iconCrown",
			ignored_by_psychopaths = true,
			pot_amount = 4
		});
		add(new HappinessAsset
		{
			id = "razed_capital",
			value = -35,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/iconRebellion"
		});
		add(new HappinessAsset
		{
			id = "lost_capital",
			value = -30,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/iconCrown"
		});
		add(new HappinessAsset
		{
			id = "razed_city",
			value = -20,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/iconRebellion"
		});
		add(new HappinessAsset
		{
			id = "lost_city",
			value = -15,
			pot_task_id = "swearing",
			path_icon = "ui/Icons/iconCitySelect"
		});
		add(new HappinessAsset
		{
			id = "become_alpha",
			path_icon = "ui/Icons/iconWolf",
			value = 20
		});
	}

	public override void post_init()
	{
		base.post_init();
		for (int i = 0; i < list.Count; i++)
		{
			list[i].index = i;
		}
	}

	public override void editorDiagnosticLocales()
	{
		foreach (HappinessAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkSpriteExists("path_icon", item.path_icon, item);
			foreach (string localeID in item.getLocaleIDs())
			{
				checkLocale(item, localeID);
			}
		}
		base.editorDiagnosticLocales();
	}
}
// --- End of File: HappinessLibrary.cs ---



// --- Start of File: HashSetActor.cs ---
using System.Collections.Generic;

public class HashSetActor : HashSet<Actor>
{
}
// --- End of File: HashSetActor.cs ---



// --- Start of File: HashSetBuilding.cs ---
using System.Collections.Generic;

public class HashSetBuilding : HashSet<Building>
{
}
// --- End of File: HashSetBuilding.cs ---



// --- Start of File: HashSetExtensions.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using JetBrains.Annotations;

public static class HashSetExtensions
{
	[CanBeNull]
	public static T GetRandom<T>(this HashSet<T> pHashSet)
	{
		int num = Randy.randomInt(0, pHashSet.Count);
		int num2 = 0;
		foreach (T item in pHashSet)
		{
			if (num2++ == num)
			{
				return item;
			}
		}
		return default(T);
	}

	public static T[] ToArray<T>(this HashSet<T> pHashSet)
	{
		T[] array = new T[pHashSet.Count];
		pHashSet.CopyTo(array);
		return array;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool Any<T>(this HashSet<T> pHashSet)
	{
		if (pHashSet == null)
		{
			return false;
		}
		return pHashSet.Count > 0;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool RemoveAll<T>(this HashSet<T> pHashSet, ICollection<T> pToRemove)
	{
		if (pToRemove == null)
		{
			throw new ArgumentNullException("pToRemove");
		}
		if (pToRemove.Count == 0 || pHashSet.Count == 0)
		{
			return false;
		}
		int count = pHashSet.Count;
		pHashSet.ExceptWith(pToRemove);
		int count2 = pHashSet.Count;
		return count != count2;
	}

	public static T Pop<T>(this HashSet<T> pHashSet)
	{
		if (pHashSet == null)
		{
			throw new ArgumentNullException("pHashSet");
		}
		if (pHashSet.Count == 0)
		{
			throw new InvalidOperationException("Cannot pop from an empty HashSet.");
		}
		int num = pHashSet.Count - 1;
		int num2 = 0;
		foreach (T item in pHashSet)
		{
			if (num2++ == num)
			{
				pHashSet.Remove(item);
				return item;
			}
		}
		throw new InvalidOperationException("Unexpected error: HashSet is empty after iteration.");
	}

	public static T Shift<T>(this HashSet<T> pHashSet)
	{
		if (pHashSet == null)
		{
			throw new ArgumentNullException("pHashSet");
		}
		if (pHashSet.Count == 0)
		{
			throw new InvalidOperationException("Cannot shift from an empty HashSet.");
		}
		using (HashSet<T>.Enumerator enumerator = pHashSet.GetEnumerator())
		{
			if (enumerator.MoveNext())
			{
				T current = enumerator.Current;
				pHashSet.Remove(current);
				return current;
			}
		}
		throw new InvalidOperationException("Unexpected error: HashSet is empty after iteration.");
	}
}
// --- End of File: HashSetExtensions.cs ---



// --- Start of File: HashSetMapRegion.cs ---
using System.Collections.Generic;

public class HashSetMapRegion : HashSet<MapRegion>
{
}
// --- End of File: HashSetMapRegion.cs ---



// --- Start of File: HashSetRegionLink.cs ---
using System.Collections.Generic;

public class HashSetRegionLink : HashSet<RegionLink>
{
}
// --- End of File: HashSetRegionLink.cs ---



// --- Start of File: HashSetTileZone.cs ---
using System.Collections.Generic;

public class HashSetTileZone : HashSet<TileZone>
{
}
// --- End of File: HashSetTileZone.cs ---



// --- Start of File: HashSetWorldTile.cs ---
using System.Collections.Generic;

public class HashSetWorldTile : HashSet<WorldTile>
{
}
// --- End of File: HashSetWorldTile.cs ---



// --- Start of File: HeaderContainer.cs ---
using System.Collections;
using UnityEngine;
using UnityEngine.UI;

public class HeaderContainer : MonoBehaviour, ILayoutController
{
	public RectTransform header_transform;

	public RectTransform content_transform;

	public RectTransform runes_container;

	public VerticalLayoutGroup content;

	private VerticalLayoutGroup _vertical_layout_group;

	private LayoutElement _layout_element;

	private int _default_top_padding;

	private RectOffset _default_padding;

	private void Awake()
	{
		if ((Object)(object)content == (Object)null)
		{
			content = ((Component)content_transform).GetComponent<VerticalLayoutGroup>();
		}
		_vertical_layout_group = ((Component)this).GetComponent<VerticalLayoutGroup>();
		_default_padding = ((LayoutGroup)_vertical_layout_group).padding;
		_layout_element = ((Component)this).GetComponent<LayoutElement>();
		_default_top_padding = ((LayoutGroup)content).padding.top;
	}

	public void SetLayoutVertical()
	{
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Expected O, but got Unknown
		if (!Application.isPlaying)
		{
			return;
		}
		int num = _default_top_padding;
		if (!hasAnyElementActive())
		{
			if (_layout_element.preferredHeight != 0f)
			{
				((LayoutGroup)_vertical_layout_group).padding = new RectOffset(0, 0, 0, 0);
				_layout_element.preferredHeight = 0f;
				LayoutRebuilder.ForceRebuildLayoutImmediate(header_transform);
			}
		}
		else
		{
			if (_layout_element.preferredHeight >= 0f)
			{
				((LayoutGroup)_vertical_layout_group).padding = _default_padding;
				_layout_element.preferredHeight = -1f;
				LayoutRebuilder.ForceRebuildLayoutImmediate(header_transform);
			}
			int num2 = num;
			Rect rect = header_transform.rect;
			num = num2 + (int)((Rect)(ref rect)).height;
		}
		if (((LayoutGroup)content).padding.top != num)
		{
			((LayoutGroup)content).padding.top = num;
			LayoutRebuilder.ForceRebuildLayoutImmediate(content_transform);
			((MonoBehaviour)this).StartCoroutine(toggleRunes());
		}
	}

	public void SetLayoutHorizontal()
	{
	}

	private IEnumerator toggleRunes()
	{
		yield return null;
		bool flag = hasAnyElementActive();
		((Component)runes_container).gameObject.SetActive(flag);
		if (flag)
		{
			RectTransform obj = runes_container;
			float x = ((Transform)runes_container).localPosition.x;
			Rect rect = header_transform.rect;
			((Transform)obj).localPosition = Vector2.op_Implicit(new Vector2(x, 0f - ((Rect)(ref rect)).height));
		}
	}

	private bool hasAnyElementActive()
	{
		for (int i = 0; i < ((Component)this).transform.childCount; i++)
		{
			if (((Component)((Component)this).transform.GetChild(i)).gameObject.activeInHierarchy)
			{
				return true;
			}
		}
		return false;
	}
}
// --- End of File: HeaderContainer.cs ---



// --- Start of File: Heat.cs ---
using System.Collections.Generic;

public class Heat
{
	public const int MAX_HEAT = 404;

	private float tickTimer;

	private List<WorldTile> tilesToRemove = new List<WorldTile>();

	private HashSetWorldTile tiles;

	internal void clear()
	{
		if (tiles == null)
		{
			tiles = new HashSetWorldTile();
		}
		foreach (WorldTile tile in tiles)
		{
			tile.heat = 0;
		}
		tiles.Clear();
	}

	internal void addTile(WorldTile pTile, int pHeat = 1)
	{
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		if (pTile.heat == 0)
		{
			tiles.Add(pTile);
		}
		pTile.heat += pHeat;
		if (pTile.heat > 404)
		{
			pTile.heat = 404;
		}
		if (pTile.heat > 5)
		{
			if (pTile.hasBuilding() && pTile.building.isAlive())
			{
				pTile.building.getHit(0f);
			}
			if (pTile.Type.layer_type == TileLayerType.Ocean)
			{
				MapAction.removeLiquid(pTile);
				World.world.particles_smoke.spawn(pTile.posV3);
			}
			if (pTile.isTemporaryFrozen())
			{
				pTile.unfreeze();
			}
			if (pTile.Type.grey_goo)
			{
				pTile.startFire();
			}
			pTile.setBurned();
		}
		if (pTile.heat > 10)
		{
			if (pTile.Type.burnable)
			{
				if (pTile.Type.IsType("tnt") || pTile.Type.IsType("tnt_timed"))
				{
					AchievementLibrary.tnt_and_heat.check();
				}
				pTile.startFire();
			}
			if (pTile.hasBuilding() && !pTile.building.isRuin())
			{
				pTile.building.getHit((float)pTile.building.getMaxHealth() * 0.1f, pFlash: true, AttackType.Divine, null, pSkipIfShake: false);
			}
			if (pTile.hasBuilding())
			{
				pTile.startFire();
			}
			pTile.doUnits(delegate(Actor tActor)
			{
				if (!tActor.asset.very_high_flyer && !tActor.isImmuneToFire())
				{
					ActionLibrary.addBurningEffectOnTarget(null, tActor);
					tActor.getHit(50f, pFlash: true, AttackType.Fire, null, pSkipIfShake: false);
				}
			});
		}
		if (pTile.heat > 20)
		{
			if (pTile.Type.explodable && pTile.explosion_wave == 0)
			{
				World.world.explosion_layer.explodeBomb(pTile);
			}
			if (pTile.hasBuilding())
			{
				pTile.startFire();
			}
			if (pTile.top_type != null)
			{
				MapAction.decreaseTile(pTile, pDamage: true);
			}
		}
		if (WorldLawLibrary.world_law_gaias_covenant.isEnabled())
		{
			return;
		}
		if (pTile.heat > 30)
		{
			if (pTile.Type.lava)
			{
				LavaHelper.addLava(pTile);
			}
			if (pTile.Type.IsType("soil_low") || pTile.Type.IsType("soil_high"))
			{
				pTile.setTileType("sand");
			}
			if (pTile.Type.road)
			{
				pTile.setTileType("sand");
			}
		}
		if (pTile.heat > 100 && pTile.Type.IsType("sand"))
		{
			LavaHelper.addLava(pTile);
		}
		if (pTile.heat > 160)
		{
			if (pTile.Type.IsType("mountains"))
			{
				LavaHelper.addLava(pTile);
			}
			if (pTile.Type.IsType("hills"))
			{
				LavaHelper.addLava(pTile);
			}
		}
	}

	internal void update(float pElapsed)
	{
		if (World.world.isPaused() || tiles.Count == 0)
		{
			return;
		}
		if (tickTimer > 0f)
		{
			tickTimer -= pElapsed;
			return;
		}
		tickTimer = 1f;
		tilesToRemove.Clear();
		foreach (WorldTile tile in tiles)
		{
			tile.heat--;
			if (tile.heat <= 0)
			{
				tilesToRemove.Add(tile);
			}
		}
		for (int i = 0; i < tilesToRemove.Count; i++)
		{
			WorldTile item = tilesToRemove[i];
			tiles.Remove(item);
		}
		tilesToRemove.Clear();
	}
}
// --- End of File: Heat.cs ---



// --- Start of File: HeatRayEffect.cs ---
using UnityEngine;

public class HeatRayEffect : BaseAnimatedObject
{
	public SpriteAnimation ray;

	public SpriteAnimation heat;

	private bool active;

	private int ticksActive;

	private bool touchedGround;

	private float rayScaleY;

	private float rayWidth = 1f;

	public override void Awake()
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		base.Awake();
		((Component)ray).transform.localScale = new Vector3(1f, 0f, 1f);
	}

	private void Update()
	{
		update(World.world.elapsed);
		ray.update(World.world.elapsed);
		heat.update(World.world.elapsed);
		if (ticksActive > 0)
		{
			ticksActive--;
		}
		else
		{
			active = false;
		}
	}

	internal bool isReady()
	{
		return touchedGround;
	}

	public Vector2 getPosForLight()
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.op_Implicit(((Component)heat).transform.position);
	}

	public override void update(float pElapsed)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_013d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		base.update(pElapsed);
		Vector3 position = ((Component)ray).transform.position;
		position.z = ((Component)this).transform.position.y;
		((Component)ray).transform.position = position;
		position = ((Component)heat).transform.position;
		((Component)heat).transform.position = position;
		if (active)
		{
			if (rayScaleY < 2000f)
			{
				rayScaleY += pElapsed * 7000f;
				if (rayScaleY >= 2000f)
				{
					rayScaleY = 2000f;
					touchedGround = true;
				}
				((Component)ray).transform.localScale = new Vector3(rayWidth, rayScaleY, 1f);
			}
		}
		else
		{
			touchedGround = false;
			if (rayScaleY > 0f)
			{
				rayScaleY -= pElapsed * 4000f;
				if (rayScaleY < 0f)
				{
					rayScaleY = 0f;
					((Component)this).gameObject.SetActive(false);
				}
				((Component)ray).transform.localScale = new Vector3(rayWidth, rayScaleY, 1f);
			}
		}
		((Component)heat).gameObject.SetActive(touchedGround);
	}

	internal void play(Vector2 pPos, int pSize)
	{
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		if (pSize >= 10)
		{
			rayWidth = 1f;
		}
		else
		{
			rayWidth = 0.4f;
		}
		((Component)this).transform.localPosition = new Vector3(pPos.x, pPos.y);
		active = true;
		ticksActive = 4;
		((Component)this).gameObject.SetActive(true);
	}
}
// --- End of File: HeatRayEffect.cs ---



// --- Start of File: HelpButton.cs ---
using UnityEngine;

public class HelpButton : MonoBehaviour
{
	public void clickHelp()
	{
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Invalid comparison between Unknown and I4
		string stringVal = PlayerConfig.dict["language"].stringVal;
		Analytics.LogEvent("open_help");
		string text = "";
		text = (((int)Application.platform != 11) ? ("https://support.apple.com/" + stringVal + "-" + stringVal + "/HT203005") : ("https://support.google.com/googleplay/answer/1050566?hl=" + stringVal));
		Application.OpenURL(text);
	}
}
// --- End of File: HelpButton.cs ---



// --- Start of File: Heuristic.cs ---
using System;
using System.Runtime.CompilerServices;
using UnityEngine;

namespace EpPathFinding.cs;

public class Heuristic
{
	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static float Manhattan(int iDx, int iDy)
	{
		return iDx + iDy;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static float Euclidean(int iDx, int iDy)
	{
		float num = iDx;
		float num2 = iDy;
		return (float)Math.Sqrt(num * num + num2 * num2);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static float Chebyshev(int iDx, int iDy)
	{
		return Mathf.Max(iDx, iDy);
	}
}
// --- End of File: Heuristic.cs ---



// --- Start of File: HeuristicDelegate.cs ---
namespace EpPathFinding.cs;

public delegate float HeuristicDelegate(int iDx, int iDy);
// --- End of File: HeuristicDelegate.cs ---



// --- Start of File: HeuristicMode.cs ---
namespace EpPathFinding.cs;

public enum HeuristicMode
{
	MANHATTAN,
	EUCLIDEAN,
	CHEBYSHEV
}
// --- End of File: HeuristicMode.cs ---



// --- Start of File: HindiCorrector.cs ---
using System;

public class HindiCorrector
{
	private static string[] hindi_letters = new string[178]
	{
		"", "", "", "", "(", ")", "{", "}", "=", "",
		"?", "-", "", "", ",", ".", "\u094d ", "", "", "",
		"", "", "", "", "", "", "", "x", ":", "\u094d",
		"", "", "", "\u093c", "", "", "", "\u094d", "\u094d", "",
		"\u094d", "\u094d", "", "\u093c\u094d", "", "\u094d", "\u094d", "", "\u094d\u094d", "\u094d",
		"\u094d", "\u0943", "\u0943", "\u094d", "\u094d", "\u0943", "\u094d", "\u094d", "\u094d", "\u094d",
		"\u094d\u094d", "\u094d", "\u094d\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d",
		"\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d", "\u094d",
		"\u094d", "\u094d", "\u0941", "\u0942", "\u094d", "", "", "", "", "",
		"", "", "", "", "", "", "\u094d", "", "\u094d", "\u094d",
		"", "\u094d", "", "\u094d", "", "", "\u0948", "\u094d", "", "",
		"\u094d", "", "\u094d", "", "", "\u094d", "\u094d", "", "", "\u094d",
		"\u094d", "", "", "\u094d", "", "\u094d", "", "\u094d", "", "\u094d",
		"", "\u094d", "", "\u094d", "", "\u094d", "", "\u094d", "", "\u094d",
		"", "\u094d", "", "\u094d", "", "\u094d", "", "", "\u094d", "",
		"", "\u094d", "", "\u094d", "", "\u094d", "", "\u094d", "", "",
		"", "\u0949", "\u094b", "\u094c", "\u093e", "\u0940", "\u0941", "\u0942", "\u0943", "\u0947",
		"\u0948", "\u0902", "\u0901", "\u0903", "\u0945", "", "\u094d ", "\u094d"
	};

	private static string[] replace_letters = new string[178]
	{
		"^", "*", "", "", "", "", "", "", "", "A",
		"\\", "&", "&", "", "]", "-", "~ ", "", "", "",
		"", "", "", "", "", "", "", "", "%", "Ye",
		"", "u+", "j+", ";+", "x+", "M+", "<+", "[+;", "[+", "[k+",
		"D+;", "D+", "d+", "+", "Q+", "T+;", "T+", "t+", "", "k",
		"Dr", "", "", "", "", "", "", "z", "", "",
		"{", "{k", "", "=", "K", "N", "V", "B", "M", "<",
		"|", "}", "J", "V", "M", "<", "N", "", "", "",
		"", "xz", "#", ":", "z", "vks", "vkS", "vk", "v", "bZ",
		"b", "m", "", ",s", ",", "_", "D", "d", "", "[",
		"[k", "X", "x", "?", "?k", "", "pkS", "P", "p", "N",
		"T", "t", "", ">", "", "", "", "V", "B", "",
		"", "M", "<", ".", ".k", "R", "r", "F", "Fk", ")",
		"n", "/", "/k", "U", "u", "I", "i", "", "Q", "C",
		"c", "H", "Hk", "E", "e", "\u00b8", ";", "j", "Y", "y",
		"G", "O", "o", "'", "'k", "\"", "\"k", "L", "l", "g",
		"v", "", "ks", "kS", "k", "h", "q", "w", "`", "s",
		"S", "a", "", "%", "W", "", "~ ", "~"
	};

	public static string GetCorrectedHindiText(string unicode_substring)
	{
		int num = hindi_letters.Length;
		string text = unicode_substring;
		for (int num2 = text.IndexOf("'", StringComparison.Ordinal); num2 >= 0; num2 = text.IndexOf("'", StringComparison.Ordinal))
		{
			text = ReplaceFirstOccurrence(text, "'", "^");
			text = ReplaceFirstOccurrence(text, "'", "*");
		}
		for (int num3 = text.IndexOf("\"", StringComparison.Ordinal); num3 >= 0; num3 = text.IndexOf("\"", StringComparison.Ordinal))
		{
			text = ReplaceFirstOccurrence(text, "\"", "");
			text = ReplaceFirstOccurrence(text, "\"", "");
		}
		for (int num4 = text.IndexOf("\u093f", StringComparison.Ordinal); num4 != -1; num4 = text.IndexOf("\u093f", num4 + 1, StringComparison.Ordinal))
		{
			char c = text[num4 - 1];
			text = text.Replace(c + "\u093f", "f" + c);
			while (text.Contains("\u094df" + c))
			{
				int num5 = text.IndexOf("\u094df" + c, StringComparison.Ordinal);
				text = text.Replace(text[num5 - 1] + "\u094df" + c, "f" + text[num5 - 1] + "\u094d" + c);
			}
		}
		string text2 = "\u093e\u093f\u0940\u0941\u0942\u0943\u0947\u0948\u094b\u094c\u0902:\u0901\u0945";
		text += "  ";
		for (int num6 = text.IndexOf("\u094d", StringComparison.Ordinal); num6 > 0; num6 = text.IndexOf("\u094d", StringComparison.Ordinal))
		{
			int num7 = num6 + 2;
			if (text[num7 + 1] == '\u094d')
			{
				num7 += 2;
			}
			char value = text[num7 + 1];
			while (text2.IndexOf(value) != -1)
			{
				num7++;
				value = text[num7 + 1];
			}
			string text3 = text.Substring(num6 + 2, num7 - num6 - 1);
			text = text.Replace("\u094d" + text3, text3 + "Z");
		}
		text = text.Substring(0, text.Length - 2);
		for (int i = 0; i < num; i++)
		{
			int num8 = 0;
			if (text.Contains(hindi_letters[i]))
			{
				while (num8 != -1)
				{
					text = text.Replace(hindi_letters[i], replace_letters[i]);
					num8 = text.IndexOf(hindi_letters[i], StringComparison.Ordinal);
				}
			}
		}
		return text;
	}

	public static string ReplaceFirstOccurrence(string Source, string Find, string Replace)
	{
		int num = Source.IndexOf(Find, StringComparison.Ordinal);
		if (num < 0)
		{
			return Source;
		}
		return Source.Remove(num, Find.Length).Insert(num, Replace);
	}
}
// --- End of File: HindiCorrector.cs ---



// --- Start of File: HistoryDataAsset.cs ---
using System;
using ChartAndGraph;
using UnityEngine;
using UnityEngine.UI;

[Serializable]
public class HistoryDataAsset : Asset, IDescriptionAsset, ILocalizedAsset
{
	public string localized_key;

	public string localized_key_description;

	public string statistics_asset;

	public string color_hex;

	public string tooltip_color_hex;

	public string path_icon;

	public bool enabled_default;

	private Material _material_point;

	private Material _material_line;

	private Material _material_gradient;

	private ChartItemEffect _hover_prefab;

	public bool average;

	public bool max;

	public bool sum;

	public GraphCategoryGroup category_group = GraphCategoryGroup.General;

	public Material getChartPointMaterial()
	{
		if ((Object)(object)_material_point == (Object)null)
		{
			_material_point = cloneMaterial("materials/graph/graph_base_point");
			_material_point.SetTexture("_MainTex", (Texture)(object)Resources.Load<Texture2D>(path_icon));
		}
		return _material_point;
	}

	public ChartItemEffect getHoverPointMaterial()
	{
		if ((Object)(object)_hover_prefab == (Object)null)
		{
			_hover_prefab = clonePrefab("Prefabs/graph/PointHover", GameObject.Find("Charts").transform);
			((Object)((Component)_hover_prefab).gameObject).name = "Hover " + id;
			((Component)_hover_prefab).GetComponent<Image>().sprite = SpriteTextureLoader.getSprite(path_icon);
			((Component)_hover_prefab).gameObject.SetActive(false);
		}
		return _hover_prefab;
	}

	public Material getChartLineMaterial()
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)_material_line == (Object)null)
		{
			_material_line = getChartLineMaterial(getColorMain());
		}
		return _material_line;
	}

	public static Material getChartLineMaterial(Color pColor)
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		Material obj = cloneMaterial("materials/graph/graph_base_line");
		obj.SetColor("_Color", pColor);
		return obj;
	}

	public Material getChartInnerFillMaterial()
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)_material_gradient == (Object)null)
		{
			_material_gradient = getChartInnerFillMaterial(getColorMain());
		}
		return _material_gradient;
	}

	public static Material getChartInnerFillMaterial(Color pColor)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		Material obj = cloneMaterial("materials/graph/graph_base_gradient");
		Color val = pColor;
		val.a = 0.4f;
		Color val2 = pColor;
		val2.a = 0.1f;
		obj.SetColor("_ColorFrom", val);
		obj.SetColor("_ColorTo", val2);
		return obj;
	}

	public string getLocaleID()
	{
		return localized_key ?? id;
	}

	public string getDescriptionID()
	{
		string text = getLocaleID() + "_description";
		if (!string.IsNullOrEmpty(localized_key_description))
		{
			text = localized_key_description;
		}
		if (LocalizedTextManager.stringExists(text))
		{
			return text;
		}
		return getLocaleID() + "_description";
	}

	public Color getColorMain()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return Toolbox.makeColor(color_hex);
	}

	private static Material cloneMaterial(string pPath)
	{
		return Object.Instantiate<Material>(Resources.Load<Material>(pPath));
	}

	private static ChartItemEffect clonePrefab(string pPath, Transform pParentTransform)
	{
		return Object.Instantiate<ChartItemEffect>(Resources.Load<ChartItemEffect>(pPath), pParentTransform);
	}
}
// --- End of File: HistoryDataAsset.cs ---



// --- Start of File: HistoryDataCollector.cs ---
using db.tables;

namespace db;

public delegate HistoryTable HistoryDataCollector(NanoObject pNanoObject);
// --- End of File: HistoryDataCollector.cs ---



// --- Start of File: HistoryDataLibrary.cs ---
using UnityEngine;

public class HistoryDataLibrary : AssetLibrary<HistoryDataAsset>
{
	public override void init()
	{
		base.init();
		addStats();
		addBiomes();
		addTiles();
	}

	public void addStats()
	{
		add(new HistoryDataAsset
		{
			id = "population",
			color_hex = "#6295B3",
			path_icon = "ui/Icons/iconPopulation",
			enabled_default = true
		});
		add(new HistoryDataAsset
		{
			id = "population_civ",
			statistics_asset = "world_statistics_population",
			color_hex = "#65A23F",
			path_icon = "ui/Icons/iconPopulationCiv"
		});
		add(new HistoryDataAsset
		{
			id = "population_beasts",
			statistics_asset = "world_statistics_beasts",
			color_hex = "#664C28",
			path_icon = "ui/Icons/worldrules/icon_animalspawn"
		});
		add(new HistoryDataAsset
		{
			id = "creatures_born",
			statistics_asset = "world_statistics_creatures_born",
			color_hex = "#DA3A57",
			path_icon = "ui/Icons/iconBirths",
			max = true
		});
		t.category_group |= GraphCategoryGroup.Deaths;
		add(new HistoryDataAsset
		{
			id = "creatures_created",
			statistics_asset = "world_statistics_creatures_created",
			color_hex = "#9670B5",
			path_icon = "ui/Icons/actor_traits/iconMiracleBorn",
			max = true
		});
		t.category_group |= GraphCategoryGroup.Deaths;
		add(new HistoryDataAsset
		{
			id = "food",
			color_hex = "#C67D49",
			path_icon = "ui/Icons/iconResBread",
			enabled_default = true
		});
		add(new HistoryDataAsset
		{
			id = "hungry",
			color_hex = "#7FA9BC",
			path_icon = "ui/Icons/iconHungry"
		});
		add(new HistoryDataAsset
		{
			id = "starving",
			color_hex = "#BAC6B2",
			path_icon = "ui/Icons/iconStarving",
			enabled_default = true
		});
		add(new HistoryDataAsset
		{
			id = "items",
			color_hex = "#FFB22D",
			path_icon = "ui/Icons/iconReforge"
		});
		add(new HistoryDataAsset
		{
			id = "homeless",
			color_hex = "#AD3640",
			path_icon = "ui/Icons/iconHomeless"
		});
		add(new HistoryDataAsset
		{
			id = "housed",
			color_hex = "#358A23",
			path_icon = "ui/Icons/iconHoused"
		});
		add(new HistoryDataAsset
		{
			id = "houses",
			statistics_asset = "world_statistics_houses",
			color_hex = "#B59780",
			path_icon = "ui/Icons/iconBuildings",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "houses_built",
			statistics_asset = "world_statistics_houses_built",
			color_hex = "#8D9995",
			path_icon = "ui/Icons/citizen_jobs/iconCitizenJobBuilder",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "houses_destroyed",
			statistics_asset = "world_statistics_houses_destroyed",
			color_hex = "#DA3722",
			path_icon = "ui/Icons/actor_traits/iconPyromaniac",
			max = true,
			category_group = GraphCategoryGroup.Deaths
		});
		add(new HistoryDataAsset
		{
			id = "cities",
			statistics_asset = "villages",
			color_hex = "#9B785E",
			path_icon = "ui/Icons/iconCitySelect",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "cities_destroyed",
			statistics_asset = "world_statistics_cities_destroyed",
			color_hex = "#AD363F",
			path_icon = "ui/Icons/iconCityDestroyed",
			max = true,
			category_group = GraphCategoryGroup.Deaths
		});
		add(new HistoryDataAsset
		{
			id = "cities_created",
			statistics_asset = "world_statistics_cities_created",
			color_hex = "#739297",
			path_icon = "ui/Icons/iconCity",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "cities_conquered",
			statistics_asset = "world_statistics_cities_conquered",
			color_hex = "#A1B1A2",
			path_icon = "ui/Icons/iconCityConquered",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "cities_rebelled",
			statistics_asset = "world_statistics_cities_rebelled",
			color_hex = "#FE7332",
			path_icon = "ui/Icons/worldrules/icon_rebellion",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "kingdoms",
			statistics_asset = "kingdoms",
			color_hex = "#FF8500",
			path_icon = "ui/Icons/iconKingdomList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "kingdoms_created",
			statistics_asset = "world_statistics_kingdoms_created",
			color_hex = "#FFE563",
			path_icon = "ui/Icons/iconKingdom",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "kingdoms_destroyed",
			statistics_asset = "world_statistics_kingdoms_destroyed",
			color_hex = "#AD363F",
			path_icon = "ui/Icons/iconKingdomDestroyed",
			max = true,
			category_group = GraphCategoryGroup.Deaths
		});
		add(new HistoryDataAsset
		{
			id = "armies_destroyed",
			statistics_asset = "world_statistics_armies_destroyed",
			color_hex = "#AD363F",
			path_icon = "ui/Icons/iconArmiesDestroyed",
			max = true,
			category_group = GraphCategoryGroup.Deaths
		});
		add(new HistoryDataAsset
		{
			id = "kings",
			color_hex = "#B74007",
			path_icon = "ui/Icons/iconKings",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "leaders",
			color_hex = "#9670B5",
			path_icon = "ui/Icons/iconLeaders",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "gold",
			color_hex = "#FED760",
			path_icon = "ui/Icons/iconResGold"
		});
		add(new HistoryDataAsset
		{
			id = "money",
			color_hex = "#F5C308",
			path_icon = "ui/Icons/iconMoney",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "families",
			statistics_asset = "families",
			color_hex = "#FF006E",
			path_icon = "ui/Icons/iconFamilyList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "families_destroyed",
			statistics_asset = "world_statistics_families_destroyed",
			color_hex = "#FF006E",
			path_icon = "ui/Icons/iconFamilyDestroyed",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "families_created",
			statistics_asset = "world_statistics_families_created",
			color_hex = "#FF006E",
			path_icon = "ui/Icons/iconNewFamily",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "wood",
			color_hex = "#7C431C",
			path_icon = "ui/Icons/iconResWood"
		});
		add(new HistoryDataAsset
		{
			id = "stone",
			color_hex = "#9E5858",
			path_icon = "ui/Icons/iconResStone"
		});
		add(new HistoryDataAsset
		{
			id = "common_metals",
			color_hex = "#AAC7CF",
			path_icon = "ui/Icons/iconResCommonMetals"
		});
		add(new HistoryDataAsset
		{
			id = "territory",
			color_hex = "#D08B4B",
			path_icon = "ui/Icons/iconZones",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "islands",
			statistics_asset = "world_statistics_islands",
			color_hex = "#805C49",
			path_icon = "ui/Icons/iconZones",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "army",
			color_hex = "#2DBF4D",
			path_icon = "ui/Icons/iconArmy"
		});
		add(new HistoryDataAsset
		{
			id = "boats",
			color_hex = "#A0653B",
			path_icon = "ui/Icons/iconBoat"
		});
		add(new HistoryDataAsset
		{
			id = "children",
			color_hex = "#EB29B3",
			path_icon = "ui/Icons/iconChildren",
			enabled_default = true
		});
		add(new HistoryDataAsset
		{
			id = "buildings",
			color_hex = "#BD7743",
			path_icon = "ui/Icons/iconBuildings",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "sick",
			color_hex = "#A129EB",
			path_icon = "ui/Icons/iconSick",
			sum = true
		});
		add(new HistoryDataAsset
		{
			id = "infected",
			statistics_asset = "world_statistics_infected",
			color_hex = "#31A347",
			path_icon = "ui/Icons/actor_traits/iconInfected",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "loyalty",
			color_hex = "#EB29B3",
			path_icon = "ui/Icons/iconLoyalty"
		});
		add(new HistoryDataAsset
		{
			id = "happy",
			color_hex = "#FFEC3F",
			path_icon = "ui/Icons/iconHappiness_6"
		});
		add(new HistoryDataAsset
		{
			id = "adults",
			color_hex = "#2B86D1",
			path_icon = "ui/Icons/iconAdults",
			enabled_default = true
		});
		add(new HistoryDataAsset
		{
			id = "deaths",
			color_hex = "#282828",
			path_icon = "ui/Icons/iconDead",
			max = true
		});
		t.category_group |= GraphCategoryGroup.Deaths;
		add(new HistoryDataAsset
		{
			id = "deaths_attackers",
			localized_key = "attackers_deaths",
			color_hex = "#AD9878",
			path_icon = "ui/Icons/iconDeathAttackers",
			sum = true
		});
		t.category_group |= GraphCategoryGroup.Deaths;
		add(new HistoryDataAsset
		{
			id = "deaths_defenders",
			localized_key = "defenders_deaths",
			color_hex = "#979894",
			path_icon = "ui/Icons/iconDeathDefenders",
			sum = true
		});
		t.category_group |= GraphCategoryGroup.Deaths;
		add(new HistoryDataAsset
		{
			id = "money_attackers",
			localized_key = "attackers_money",
			color_hex = "#C3800E",
			path_icon = "ui/Icons/iconMoney",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "money_defenders",
			localized_key = "defenders_money",
			color_hex = "#FFFF49",
			path_icon = "ui/Icons/iconMoney",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "births",
			color_hex = "#EB5D4D",
			path_icon = "ui/Icons/iconBirths",
			max = true,
			enabled_default = true
		});
		t.category_group |= GraphCategoryGroup.Deaths;
		add(new HistoryDataAsset
		{
			id = "renown",
			color_hex = "#FFFF49",
			path_icon = "ui/Icons/iconRenown",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "joined",
			color_hex = "#DBC93F",
			path_icon = "ui/Icons/iconStatisticsJoined",
			localized_key = "statistics_joined",
			localized_key_description = "statistics_joined".Description(),
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "left",
			color_hex = "#282828",
			path_icon = "ui/Icons/iconStatisticsLeft",
			localized_key = "statistics_left",
			localized_key_description = "statistics_left".Description(),
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "moved",
			color_hex = "#282828",
			path_icon = "ui/Icons/iconStatisticsMoved",
			localized_key = "statistics_moved",
			localized_key_description = "statistics_moved".Description(),
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "migrated",
			color_hex = "#282828",
			path_icon = "ui/Icons/iconStatisticsGoodLookingMigrants",
			localized_key = "statistics_migrated",
			localized_key_description = "statistics_migrated".Description(),
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "males",
			color_hex = "#2B86D1",
			path_icon = "ui/Icons/iconMale"
		});
		add(new HistoryDataAsset
		{
			id = "females",
			color_hex = "#AD3640",
			path_icon = "ui/Icons/iconFemale"
		});
		add(new HistoryDataAsset
		{
			id = "speakers_converted",
			color_hex = "#a42cec",
			path_icon = "ui/Icons/iconSpeakersTotal",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "speakers_new",
			color_hex = "#A129EB",
			path_icon = "ui/Icons/iconSpeakersNew",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "speakers_lost",
			color_hex = "#B92935",
			path_icon = "ui/Icons/iconSpeakersLost",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "books_written",
			statistics_asset = "world_statistics_books_written",
			color_hex = "#ac9c7c",
			path_icon = "ui/Icons/iconBooksWritten",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "books",
			statistics_asset = "books",
			color_hex = "#358A23",
			path_icon = "ui/Icons/iconBooks",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "books_burnt",
			statistics_asset = "world_statistics_books_burnt",
			color_hex = "#AD3442",
			path_icon = "ui/Icons/iconBooksDestroyed",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "books_read",
			statistics_asset = "world_statistics_books_read",
			color_hex = "#7C29B9",
			path_icon = "ui/Icons/iconBooksRead",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "army_attackers",
			localized_key = "attackers_army",
			color_hex = "#996753",
			path_icon = "ui/Icons/iconWarriors"
		});
		add(new HistoryDataAsset
		{
			id = "army_defenders",
			localized_key = "defenders_army",
			color_hex = "#698B99",
			path_icon = "ui/Icons/iconShield"
		});
		add(new HistoryDataAsset
		{
			id = "population_attackers",
			localized_key = "attackers_population",
			color_hex = "#325870",
			path_icon = "ui/Icons/iconPopulationAttackers"
		});
		add(new HistoryDataAsset
		{
			id = "population_defenders",
			localized_key = "defenders_population",
			color_hex = "#414349",
			path_icon = "ui/Icons/iconPopulationDefenders"
		});
		add(new HistoryDataAsset
		{
			id = "kills",
			color_hex = "#D7C493",
			path_icon = "ui/Icons/iconKills",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "alliances",
			statistics_asset = "alliances",
			color_hex = "#A7B7A8",
			path_icon = "ui/Icons/iconAllianceList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "alliances_dissolved",
			statistics_asset = "world_statistics_alliances_dissolved",
			color_hex = "#CE2C29",
			path_icon = "ui/Icons/iconAllianceDissolved",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "alliances_made",
			statistics_asset = "world_statistics_alliances_made",
			color_hex = "#1F4792",
			path_icon = "ui/Icons/iconAlliance",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "clans",
			statistics_asset = "clans",
			color_hex = "#65A13F",
			path_icon = "ui/Icons/iconClanList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "clans_destroyed",
			statistics_asset = "world_statistics_clans_destroyed",
			color_hex = "#AD363F",
			path_icon = "ui/Icons/iconClanDestroyed",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "clans_created",
			statistics_asset = "world_statistics_clans_created",
			color_hex = "#783057",
			path_icon = "ui/Icons/iconClan",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "cultures",
			statistics_asset = "cultures",
			color_hex = "#AD9878",
			path_icon = "ui/Icons/iconCultureList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "cultures_forgotten",
			statistics_asset = "world_statistics_cultures_forgotten",
			color_hex = "#AD9A73",
			path_icon = "ui/Icons/iconCultureForgotten",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "cultures_created",
			statistics_asset = "world_statistics_cultures_created",
			color_hex = "#D7C493",
			path_icon = "ui/Icons/iconCulture",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "languages",
			statistics_asset = "languages",
			color_hex = "#A7B7A8",
			path_icon = "ui/Icons/iconLanguageList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "languages_forgotten",
			statistics_asset = "world_statistics_languages_forgotten",
			color_hex = "#737874",
			path_icon = "ui/Icons/iconLanguageForgotten",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "languages_created",
			statistics_asset = "world_statistics_languages_created",
			color_hex = "#FFFFFF",
			path_icon = "ui/Icons/iconLanguage",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "subspecies",
			statistics_asset = "subspecies",
			color_hex = "#FFFFFF",
			path_icon = "ui/Icons/iconSpecies",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "subspecies_extinct",
			statistics_asset = "world_statistics_subspecies_extinct",
			color_hex = "#AD9A7B",
			path_icon = "ui/Icons/iconSpeciesExtinct",
			max = true,
			category_group = GraphCategoryGroup.Deaths
		});
		add(new HistoryDataAsset
		{
			id = "subspecies_created",
			statistics_asset = "world_statistics_subspecies_created",
			color_hex = "#FFFFFF",
			path_icon = "ui/Icons/iconSpecies",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "plots_started",
			statistics_asset = "world_statistics_plots_started",
			color_hex = "#ac9c7c",
			path_icon = "ui/Icons/iconPlot",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "plots",
			statistics_asset = "plots",
			color_hex = "#3a3bbb",
			path_icon = "ui/Icons/iconPlotList",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "plots_forgotten",
			statistics_asset = "world_statistics_plots_forgotten",
			color_hex = "#AD9A7B",
			path_icon = "ui/Icons/iconPlotForgotten",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "plots_succeeded",
			statistics_asset = "world_statistics_plots_succeeded",
			color_hex = "#3a3bbb",
			path_icon = "ui/Icons/iconPlotSucceeded",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "religions",
			statistics_asset = "religions",
			color_hex = "#8EFFD9",
			path_icon = "ui/Icons/iconReligionList",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "religions_forgotten",
			statistics_asset = "world_statistics_religions_forgotten",
			color_hex = "#CEDBBD",
			path_icon = "ui/Icons/iconReligionForgotten",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "religions_created",
			statistics_asset = "world_statistics_religions_created",
			color_hex = "#46DCE3",
			path_icon = "ui/Icons/iconReligion",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "wars",
			statistics_asset = "wars",
			color_hex = "#D3D9C5",
			path_icon = "ui/Icons/iconWar",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "peaces_made",
			statistics_asset = "world_statistics_peaces_made",
			color_hex = "#51B349",
			path_icon = "ui/Icons/actor_traits/iconPacifist",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "wars_started",
			statistics_asset = "world_statistics_wars_started",
			color_hex = "#3a3bbb",
			path_icon = "ui/Icons/iconWhisperOfWar",
			max = true,
			category_group = GraphCategoryGroup.Noosphere
		});
		add(new HistoryDataAsset
		{
			id = "deaths_total",
			statistics_asset = "world_statistics_deaths_total",
			color_hex = "#A7B7A8",
			path_icon = "ui/Icons/iconDead",
			max = true,
			category_group = GraphCategoryGroup.Deaths
		});
		clone("deaths_natural", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_natural";
		t.path_icon = "ui/Icons/iconClock";
		t.enabled_default = true;
		t.color_hex = "#AF6E19";
		clone("deaths_hunger", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_hunger";
		t.path_icon = "ui/Icons/iconDeathsHunger";
		t.enabled_default = true;
		t.color_hex = "#BDD7DE";
		clone("deaths_eaten", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_eaten";
		t.path_icon = "ui/Icons/iconDeathsEaten";
		t.color_hex = "#EFAE52";
		clone("deaths_plague", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_plague";
		t.path_icon = "ui/Icons/actor_traits/iconPlague";
		t.color_hex = "#DA18D8";
		clone("deaths_poison", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_poison";
		t.path_icon = "ui/Icons/iconPoisoned";
		t.color_hex = "#A31BC9";
		clone("deaths_infection", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_infection";
		t.path_icon = "ui/Icons/actor_traits/iconInfected";
		t.color_hex = "#31A347";
		clone("deaths_tumor", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_tumor";
		t.path_icon = "ui/Icons/iconTumor";
		t.color_hex = "#EF3F58";
		clone("deaths_acid", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_acid";
		t.path_icon = "ui/Icons/iconAcid";
		t.color_hex = "#ADCF3A";
		clone("deaths_fire", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_fire";
		t.path_icon = "ui/Icons/iconFire";
		t.color_hex = "#D92D14";
		clone("deaths_divine", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_divine";
		t.path_icon = "ui/Icons/iconDivineLight";
		t.color_hex = "#FFE490";
		clone("deaths_weapon", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_weapon";
		t.path_icon = "ui/Icons/actor_traits/iconBloodlust";
		t.enabled_default = true;
		t.color_hex = "#7F1212";
		clone("deaths_gravity", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_gravity";
		t.path_icon = "ui/Icons/worldrules/icon_grow_trees";
		t.color_hex = "#65A13F";
		clone("deaths_drowning", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_drowning";
		t.path_icon = "ui/Icons/iconTileDeepOcean";
		t.color_hex = "#00B9D1";
		clone("deaths_water", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_water";
		t.path_icon = "ui/Icons/iconRain";
		t.color_hex = "#CBF4FF";
		clone("deaths_explosion", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_explosion";
		t.path_icon = "ui/Icons/worldrules/icon_exploding_mushrooms";
		t.color_hex = "#FFB22D";
		clone("deaths_other", "deaths_total");
		t.statistics_asset = "world_statistics_deaths_other";
		t.path_icon = "ui/Icons/iconDead";
		t.color_hex = "#D7C493";
		add(new HistoryDataAsset
		{
			id = "metamorphosis",
			statistics_asset = "world_statistics_metamorphosis",
			color_hex = "#8EFFD9",
			path_icon = "ui/Icons/subspecies_traits/subspecies_trait_reproduction_metamorph",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "evolutions",
			statistics_asset = "world_statistics_evolutions",
			color_hex = "#a3836c",
			path_icon = "ui/Icons/iconMonolith",
			max = true
		});
		add(new HistoryDataAsset
		{
			id = "trees",
			statistics_asset = "world_statistics_trees",
			color_hex = "#86BC4E",
			path_icon = "ui/Icons/iconFertilizerTrees"
		});
		add(new HistoryDataAsset
		{
			id = "vegetation",
			statistics_asset = "world_statistics_vegetation",
			color_hex = "#31A347",
			path_icon = "ui/Icons/iconFertilizerPlants"
		});
	}

	public void addBiomes()
	{
		add(new HistoryDataAsset
		{
			id = "grass",
			statistics_asset = "world_statistics_grass",
			color_hex = "#5EE54E",
			path_icon = "ui/Icons/iconSeedGrass",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "savanna",
			statistics_asset = "world_statistics_savanna",
			color_hex = "#D4854C",
			path_icon = "ui/Icons/iconSeedSavanna",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "jungle",
			statistics_asset = "world_statistics_jungle",
			color_hex = "#45C131",
			path_icon = "ui/Icons/iconSeedJungle",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "desert",
			statistics_asset = "world_statistics_desert",
			color_hex = "#E9C057",
			path_icon = "ui/Icons/iconSeedDesert",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "lemon",
			statistics_asset = "world_statistics_lemon",
			color_hex = "#FDD435",
			path_icon = "ui/Icons/iconSeedLemon",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "permafrost",
			statistics_asset = "world_statistics_permafrost",
			color_hex = "#9AF8FF",
			path_icon = "ui/Icons/iconSeedPermafrost",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "swamp",
			statistics_asset = "world_statistics_swamp",
			color_hex = "#447528",
			path_icon = "ui/Icons/iconSeedSwamp",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "crystal",
			statistics_asset = "world_statistics_crystal",
			color_hex = "#7D6887",
			path_icon = "ui/Icons/iconSeedCrystal",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "enchanted",
			statistics_asset = "world_statistics_enchanted",
			color_hex = "#F6FFC2",
			path_icon = "ui/Icons/iconSeedEnchanted",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "corruption",
			statistics_asset = "world_statistics_corruption",
			color_hex = "#3D2F40",
			path_icon = "ui/Icons/iconSeedCorrupted",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "infernal",
			statistics_asset = "world_statistics_infernal",
			color_hex = "#D0371D",
			path_icon = "ui/Icons/iconSeedInfernal",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "candy",
			statistics_asset = "world_statistics_candy",
			color_hex = "#C73736",
			path_icon = "ui/Icons/iconSeedCandy",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "mushroom",
			statistics_asset = "world_statistics_mushroom",
			color_hex = "#D65C4A",
			path_icon = "ui/Icons/iconSeedMushroom",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "wasteland",
			statistics_asset = "world_statistics_wasteland",
			color_hex = "#65A03F",
			path_icon = "ui/Icons/achievements/achievements_wastelandbiome",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "birch",
			statistics_asset = "world_statistics_birch",
			color_hex = "#757A81",
			path_icon = "ui/Icons/iconSeedBirch",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "maple",
			statistics_asset = "world_statistics_maple",
			color_hex = "#B92935",
			path_icon = "ui/Icons/iconSeedMaple",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "rocklands",
			statistics_asset = "world_statistics_rocklands",
			color_hex = "#3C6732",
			path_icon = "ui/Icons/iconSeedRocklands",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "garlic",
			statistics_asset = "world_statistics_garlic",
			color_hex = "#D7C493",
			path_icon = "ui/Icons/iconSeedGarlic",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "flower",
			statistics_asset = "world_statistics_flower",
			color_hex = "#9E3A4C",
			path_icon = "ui/Icons/iconSeedFlower",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "celestial",
			statistics_asset = "world_statistics_celestial",
			color_hex = "#F6F248",
			path_icon = "ui/Icons/iconSeedCelestial",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "clover",
			statistics_asset = "world_statistics_clover",
			color_hex = "#35B929",
			path_icon = "ui/Icons/iconSeedClover",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "singularity",
			statistics_asset = "world_statistics_singularity",
			color_hex = "#A9CAFF",
			path_icon = "ui/Icons/iconSeedSingularity",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "paradox",
			statistics_asset = "world_statistics_paradox",
			color_hex = "#C3800E",
			path_icon = "ui/Icons/iconSeedParadox",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "sand",
			statistics_asset = "world_statistics_sand",
			color_hex = "#F6BD67",
			path_icon = "ui/Icons/iconTileSand",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "biomass",
			statistics_asset = "world_statistics_biomass",
			color_hex = "#29B326",
			path_icon = "ui/Icons/iconBiomass",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "cybertile",
			statistics_asset = "world_statistics_cybertile",
			color_hex = "#BD8137",
			path_icon = "ui/Icons/iconCybercore",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "pumpkin",
			statistics_asset = "world_statistics_pumpkin",
			color_hex = "#FF8D1A",
			path_icon = "ui/Icons/iconSuperPumpkin",
			category_group = GraphCategoryGroup.Biomes
		});
		add(new HistoryDataAsset
		{
			id = "tumor",
			statistics_asset = "world_statistics_tumor",
			color_hex = "#D1184F",
			path_icon = "ui/Icons/iconTumor",
			category_group = GraphCategoryGroup.Biomes
		});
	}

	public void addTiles()
	{
		add(new HistoryDataAsset
		{
			id = "water",
			statistics_asset = "world_statistics_water",
			color_hex = "#00B9D1",
			path_icon = "ui/Icons/iconTileDeepOcean",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "soil",
			statistics_asset = "world_statistics_soil",
			color_hex = "#D08B4B",
			path_icon = "ui/Icons/iconTileSoil",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "summit",
			statistics_asset = "world_statistics_summit",
			color_hex = "#BBEFFF",
			path_icon = "ui/Icons/iconTileSummit",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "mountains",
			statistics_asset = "world_statistics_mountains",
			color_hex = "#97ADB7",
			path_icon = "ui/Icons/iconTileMountains",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "hills",
			statistics_asset = "world_statistics_hills",
			color_hex = "#657688",
			path_icon = "ui/Icons/iconTileHills",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "lava",
			statistics_asset = "world_statistics_lava",
			color_hex = "#BB311C",
			path_icon = "ui/Icons/iconLava",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "pit",
			statistics_asset = "world_statistics_pit",
			color_hex = "#53EDE3",
			path_icon = "ui/Icons/iconTileShallowWater",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "field",
			statistics_asset = "world_statistics_field",
			color_hex = "#C3800E",
			path_icon = "ui/Icons/citizen_jobs/iconCitizenJobFarmer",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "fireworks",
			statistics_asset = "world_statistics_fireworks",
			color_hex = "#FF0000",
			path_icon = "ui/Icons/iconFireworks",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "frozen",
			statistics_asset = "world_statistics_frozen",
			color_hex = "#60C1C8",
			path_icon = "ui/Icons/iconFrozen",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "fuse",
			statistics_asset = "world_statistics_fuse",
			color_hex = "#B55400",
			path_icon = "ui/Icons/iconFuse",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "ice",
			statistics_asset = "world_statistics_ice",
			color_hex = "#9AF8FF",
			path_icon = "ui/Icons/iconIceberg",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "landmine",
			statistics_asset = "world_statistics_landmine",
			color_hex = "#FF2E00",
			path_icon = "ui/Icons/iconLandmine",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "road",
			statistics_asset = "world_statistics_road",
			color_hex = "#80D03F",
			path_icon = "ui/Icons/citizen_jobs/iconCitizenJobRoadBuilder",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "snow",
			statistics_asset = "world_statistics_snow",
			color_hex = "#F2F3ED",
			path_icon = "ui/Icons/iconSnow",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "tnt",
			statistics_asset = "world_statistics_tnt",
			color_hex = "#F67A39",
			path_icon = "ui/Icons/iconTnt",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "wall",
			statistics_asset = "world_statistics_wall",
			color_hex = "#425B78",
			path_icon = "ui/Icons/iconWallIron",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "water_bomb",
			statistics_asset = "world_statistics_water_bomb",
			color_hex = "#00A2DE",
			path_icon = "ui/Icons/iconWaterBomb",
			category_group = GraphCategoryGroup.Tiles
		});
		add(new HistoryDataAsset
		{
			id = "grey_goo",
			statistics_asset = "world_statistics_grey_goo",
			color_hex = "#4D666D",
			path_icon = "ui/Icons/iconGreygoo",
			category_group = GraphCategoryGroup.Tiles
		});
	}

	public override HistoryDataAsset add(HistoryDataAsset pAsset)
	{
		pAsset.average = !pAsset.max && !pAsset.sum;
		return base.add(pAsset);
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (HistoryDataAsset item in list)
		{
			if (!string.IsNullOrEmpty(item.statistics_asset))
			{
				StatisticsAsset statisticsAsset = AssetManager.statistics_library.get(item.statistics_asset);
				if (statisticsAsset.path_icon != item.path_icon)
				{
					BaseAssetLibrary.logAssetError("HistoryDataAsset: StatisticsAsset icon_path (" + statisticsAsset.path_icon + ") does not match HistoryDataAsset path_icon (" + item.path_icon + ")", item.id);
				}
				if (string.IsNullOrEmpty(item.localized_key))
				{
					item.localized_key = statisticsAsset.getLocaleID();
				}
				if (string.IsNullOrEmpty(item.localized_key_description))
				{
					item.localized_key_description = statisticsAsset.localized_key_description;
				}
			}
		}
	}

	public override void post_init()
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		base.post_init();
		foreach (HistoryDataAsset item in list)
		{
			Color val = Toolbox.makeColor(item.color_hex);
			if (((Color)(ref val)).grayscale < 0.28f)
			{
				Color val2 = Color.Lerp(val, Color.white, 0.33f);
				string tooltip_color_hex = "#" + ColorUtility.ToHtmlStringRGB(val2);
				item.tooltip_color_hex = tooltip_color_hex;
			}
			else
			{
				item.tooltip_color_hex = item.color_hex;
			}
		}
	}

	public override void editorDiagnosticLocales()
	{
		foreach (HistoryDataAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
		base.editorDiagnosticLocales();
	}

	public string addToGameplayReport(string pWhatFor)
	{
		string empty = string.Empty;
		empty = empty + pWhatFor + "\n";
		foreach (HistoryDataAsset item in list)
		{
			string text = item.getLocaleID().Localize();
			string text2 = item.getDescriptionID().Localize();
			string text3 = "\n" + text;
			text3 += "\n";
			if (!string.IsNullOrEmpty(text2))
			{
				text3 = text3 + "1: " + text2;
			}
			empty += text3;
		}
		return empty + "\n\n";
	}
}
// --- End of File: HistoryDataLibrary.cs ---



// --- Start of File: HistoryGroupAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class HistoryGroupAsset : Asset, ILocalizedAsset
{
	public string icon_path;

	private Sprite _icon_cache;

	public string getLocaleID()
	{
		return "history_group_" + id;
	}

	public Sprite getSprite()
	{
		if ((Object)(object)_icon_cache == (Object)null)
		{
			_icon_cache = SpriteTextureLoader.getSprite(icon_path);
		}
		return _icon_cache;
	}
}
// --- End of File: HistoryGroupAsset.cs ---



// --- Start of File: HistoryGroupLibrary.cs ---
public class HistoryGroupLibrary : AssetLibrary<HistoryGroupAsset>
{
	public override void init()
	{
		base.init();
		add(new HistoryGroupAsset
		{
			id = "kings",
			icon_path = "ui/Icons/history_group/icon_kings"
		});
		add(new HistoryGroupAsset
		{
			id = "favorite_units",
			icon_path = "ui/Icons/iconFavoriteStar"
		});
		add(new HistoryGroupAsset
		{
			id = "cities",
			icon_path = "ui/Icons/iconCityList"
		});
		add(new HistoryGroupAsset
		{
			id = "kingdoms",
			icon_path = "ui/Icons/iconKingdomList"
		});
		add(new HistoryGroupAsset
		{
			id = "wars",
			icon_path = "ui/Icons/iconWarList"
		});
		add(new HistoryGroupAsset
		{
			id = "clans",
			icon_path = "ui/Icons/iconClanList"
		});
		add(new HistoryGroupAsset
		{
			id = "disasters",
			icon_path = "ui/Icons/worldrules/icon_disasters"
		});
	}

	public override void post_init()
	{
		foreach (HistoryGroupAsset item in list)
		{
			if (string.IsNullOrEmpty(item.icon_path))
			{
				item.icon_path = "ui/Icons/history_group/icon_" + item.id;
			}
		}
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (HistoryGroupAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
		}
	}
}
// --- End of File: HistoryGroupLibrary.cs ---



// --- Start of File: HistoryHud.cs ---
using System.Collections.Generic;
using UnityEngine;

public class HistoryHud : MonoBehaviour
{
	public static HistoryHud instance;

	[SerializeField]
	private GameObject _template_obj;

	private List<HistoryHudItem> _history_items = new List<HistoryHudItem>(10);

	private ObjectPoolGenericMono<HistoryHudItem> _parked_items;

	private Transform _content_group;

	private Transform _parked_group;

	private const int HISTORY_ITEM_SIZE = 15;

	private const int MAX_HISTORY_ITEMS = 10;

	private const float START_POSITION = 0f;

	private bool _recalc;

	private static bool _raycast_on = true;

	public bool raycastOn
	{
		get
		{
			if (MoveCamera.camera_drag_run)
			{
				return false;
			}
			if (Input.GetMouseButtonDown(1) || Input.GetMouseButtonDown(2))
			{
				return false;
			}
			if (MapBox.controlsLocked())
			{
				return false;
			}
			if (MapBox.isControllingUnit())
			{
				return false;
			}
			if (World.world.isAnyPowerSelected())
			{
				return false;
			}
			return _raycast_on;
		}
		set
		{
			_raycast_on = value;
		}
	}

	private void Awake()
	{
		instance = this;
		_content_group = ((Component)this).transform.Find("Scroll View/Viewport/Content");
		_parked_group = ((Component)this).transform.Find("Scroll View/Viewport/Parked");
		_parked_items = new ObjectPoolGenericMono<HistoryHudItem>(_template_obj.GetComponent<HistoryHudItem>(), _parked_group);
	}

	private void OnEnable()
	{
		if (Config.game_loaded)
		{
			((Component)_content_group).gameObject.GetComponent<RectTransform>().SetTop(0f);
			((Component)_content_group).gameObject.GetComponent<RectTransform>().SetLeft(0f);
		}
	}

	private void OnDisable()
	{
		Clear();
	}

	private void Update()
	{
		checkEnabled();
		if (_recalc)
		{
			_recalc = false;
			recalcPositions();
		}
	}

	public static void disableRaycasts()
	{
		instance.raycastOn = false;
	}

	public static void enableRaycasts()
	{
		instance.raycastOn = true;
	}

	private float recalcPositions()
	{
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		if (_history_items.Count == 0)
		{
			return 0f;
		}
		float num = 0f;
		float num2 = 0f;
		int num3 = 0;
		if (_history_items.Count > 10)
		{
			num3 = _history_items.Count - 10;
		}
		for (int i = 0; i < _history_items.Count; i++)
		{
			if (num3 > 0)
			{
				if (_history_items[i].target_bottom != (float)(num3 * -15))
				{
					_history_items[i].moveToAndDestroy(num3 * -15);
				}
				num3--;
			}
			else
			{
				if (_history_items[i].isRemoving())
				{
					continue;
				}
				if (_history_items[i].target_bottom != num)
				{
					_history_items[i].moveTo(num);
				}
				num += 15f;
			}
			num2 = 0f - ((Component)_history_items[i]).GetComponent<RectTransform>().offsetMax.y;
		}
		if (num2 >= num)
		{
			return num2 + 15f;
		}
		return num;
	}

	private bool checkEnabled()
	{
		if (!PlayerConfig.optionBoolEnabled("history_log"))
		{
			if (((Component)this).gameObject.activeSelf)
			{
				((Component)this).gameObject.SetActive(false);
			}
			return false;
		}
		if (!((Component)this).gameObject.activeSelf)
		{
			((Component)this).gameObject.SetActive(true);
		}
		return true;
	}

	public void newHistory(WorldLogMessage pMessage)
	{
		if (checkEnabled())
		{
			newText(pMessage);
			((Component)this).gameObject.SetActive(true);
		}
	}

	public void makeInactive(HistoryHudItem historyItem)
	{
		_parked_items.resetParent(historyItem);
		_parked_items.release(historyItem);
		_history_items.Remove(historyItem);
		_recalc = true;
	}

	public void Clear()
	{
		for (int num = _history_items.Count - 1; num >= 0; num--)
		{
			makeInactive(_history_items[num]);
		}
	}

	private void newText(WorldLogMessage pMessage)
	{
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		HistoryHudItem next = _parked_items.getNext();
		((Component)next).transform.SetParent(_content_group);
		((Object)((Component)next).gameObject).name = "HistoryItem " + (_history_items.Count + 1);
		((Component)next).gameObject.SetActive(true);
		RectTransform component = ((Component)next).GetComponent<RectTransform>();
		((Transform)component).localScale = Vector3.one;
		((Transform)component).localPosition = Vector3.zero;
		component.SetLeft(0f);
		float num = recalcPositions();
		component.SetTop(num);
		component.sizeDelta = new Vector2(component.sizeDelta.x, 15f);
		next.target_bottom = num;
		next.setMessage(pMessage);
		_history_items.Add(next);
		_recalc = true;
	}
}
// --- End of File: HistoryHud.cs ---



// --- Start of File: HistoryHudItem.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class HistoryHudItem : MonoBehaviour
{
	private bool _creating = true;

	private float _remove_timer = 8f;

	private CanvasGroup _canvas_group;

	private Button _button;

	private WorldLogMessage _message;

	public Text textField;

	public Image icon;

	private RectTransform _rect_transform;

	public Image background;

	private bool _removing;

	private HistoryHud _history_hud;

	private float _time_limit;

	internal float target_bottom;

	private void Start()
	{
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Expected O, but got Unknown
		_history_hud = ((Component)this).GetComponentInParent<HistoryHud>();
		_canvas_group = ((Component)this).GetComponent<CanvasGroup>();
		_canvas_group.alpha = 0f;
		_button = ((Component)this).GetComponent<Button>();
		_rect_transform = ((Component)this).GetComponent<RectTransform>();
		((UnityEvent)_button.onClick).AddListener((UnityAction)delegate
		{
			if (!MapBox.controlsLocked() && !MapBox.isControllingUnit() && !World.world.isAnyPowerSelected())
			{
				_remove_timer = 0f;
				_message.jumpToLocation();
			}
		});
	}

	private void OnEnable()
	{
		_creating = true;
		_remove_timer = 8f;
		_removing = false;
		((Component)this).GetComponent<CanvasGroup>().alpha = 0f;
	}

	public bool isRemoving()
	{
		return _removing;
	}

	public void setMessage(WorldLogMessage pMessage)
	{
		textField.text = pMessage.getFormatedText(textField);
		((Component)textField).GetComponent<LocalizedText>().checkTextFont();
		((Component)textField).GetComponent<LocalizedText>().checkSpecialLanguages();
		if (pMessage.getAsset().path_icon != "")
		{
			Sprite sprite = SpriteTextureLoader.getSprite(pMessage.getAsset().path_icon);
			icon.sprite = sprite;
		}
		else
		{
			((Component)icon).gameObject.SetActive(false);
		}
		_message = pMessage;
	}

	public void moveTo(float newBottom)
	{
		_time_limit = 0f;
		target_bottom = newBottom;
	}

	public void moveToAndDestroy(float newBottom)
	{
		_time_limit = 0f;
		target_bottom = newBottom;
		_remove_timer = 0.5f;
		_removing = true;
	}

	private void Update()
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		((Graphic)background).raycastTarget = _history_hud.raycastOn;
		_rect_transform.sizeDelta = new Vector2(_rect_transform.sizeDelta.x, 10f);
		if (_creating)
		{
			if (_canvas_group.alpha < 1f)
			{
				CanvasGroup canvas_group = _canvas_group;
				canvas_group.alpha += Time.deltaTime * Config.time_scale_asset.multiplier * 2f;
			}
			else
			{
				_creating = false;
			}
		}
		else
		{
			if (Config.paused || ScrollWindow.isWindowActive() || RewardedAds.isShowing())
			{
				return;
			}
			if (_time_limit <= 2f)
			{
				_time_limit += Time.deltaTime;
				_rect_transform.SetTop(0f - Mathf.Lerp(_rect_transform.offsetMax.y, 0f - target_bottom, _time_limit / 2f));
			}
			if (_removing && _rect_transform.offsetMax.y > 10f)
			{
				_history_hud.makeInactive(this);
				return;
			}
			_remove_timer -= Time.deltaTime;
			if (_remove_timer <= 0f)
			{
				CanvasGroup canvas_group2 = _canvas_group;
				canvas_group2.alpha -= Time.deltaTime * 2f;
				if (_canvas_group.alpha <= 0f)
				{
					_history_hud.makeInactive(this);
				}
			}
		}
	}

	private void OnDisable()
	{
		_message.clear();
	}
}
// --- End of File: HistoryHudItem.cs ---



// --- Start of File: HistoryInterval.cs ---
namespace db;

public enum HistoryInterval
{
	None,
	Yearly1,
	Yearly5,
	Yearly10,
	Yearly50,
	Yearly100,
	Yearly500,
	Yearly1000,
	Yearly5000,
	Yearly10000
}
// --- End of File: HistoryInterval.cs ---



// --- Start of File: HistoryIntervalExtensions.cs ---
using System;

namespace db;

public static class HistoryIntervalExtensions
{
	public static int getIntervalStep(this HistoryInterval pInterval)
	{
		return pInterval switch
		{
			HistoryInterval.Yearly1 => 1, 
			HistoryInterval.Yearly5 => 5, 
			HistoryInterval.Yearly10 => 10, 
			HistoryInterval.Yearly50 => 50, 
			HistoryInterval.Yearly100 => 100, 
			HistoryInterval.Yearly500 => 500, 
			HistoryInterval.Yearly1000 => 1000, 
			HistoryInterval.Yearly5000 => 5000, 
			HistoryInterval.Yearly10000 => 10000, 
			_ => throw new NotImplementedException("interval step not defined"), 
		};
	}

	public static int getMaxTimeFrame(this HistoryInterval pInterval)
	{
		int num = 0;
		foreach (GraphTimeAsset item in AssetManager.graph_time_library.list)
		{
			if (item.interval == pInterval && num < item.max_time_frame)
			{
				num = item.max_time_frame;
			}
		}
		return num;
	}

	public static (int tEveryYears, HistoryInterval tFromInterval) fillFrom(this HistoryInterval pInterval)
	{
		return pInterval switch
		{
			HistoryInterval.Yearly1 => (tEveryYears: 0, tFromInterval: HistoryInterval.None), 
			HistoryInterval.Yearly5 => (tEveryYears: 5, tFromInterval: HistoryInterval.Yearly1), 
			HistoryInterval.Yearly10 => (tEveryYears: 10, tFromInterval: HistoryInterval.Yearly1), 
			HistoryInterval.Yearly50 => (tEveryYears: 50, tFromInterval: HistoryInterval.Yearly10), 
			HistoryInterval.Yearly100 => (tEveryYears: 100, tFromInterval: HistoryInterval.Yearly10), 
			HistoryInterval.Yearly500 => (tEveryYears: 500, tFromInterval: HistoryInterval.Yearly50), 
			HistoryInterval.Yearly1000 => (tEveryYears: 1000, tFromInterval: HistoryInterval.Yearly100), 
			HistoryInterval.Yearly5000 => (tEveryYears: 5000, tFromInterval: HistoryInterval.Yearly500), 
			HistoryInterval.Yearly10000 => (tEveryYears: 10000, tFromInterval: HistoryInterval.Yearly1000), 
			_ => throw new NotImplementedException("interval step not defined"), 
		};
	}
}
// --- End of File: HistoryIntervalExtensions.cs ---



// --- Start of File: HistoryMetaDataAsset.cs ---
using System;
using System.Collections.Generic;

namespace db;

[Serializable]
public class HistoryMetaDataAsset : Asset
{
	[NonSerialized]
	public List<HistoryDataAsset> categories = new List<HistoryDataAsset>();

	public HistoryDataCollector collector;

	public MetaType meta_type;

	public Type table_type;

	public Dictionary<HistoryInterval, Type> table_types;

	public Type getTableType(HistoryInterval pInterval)
	{
		return table_types[pInterval];
	}
}
// --- End of File: HistoryMetaDataAsset.cs ---



// --- Start of File: HistoryMetaDataLibrary.cs ---
using System;
using System.Collections.Generic;
using System.Reflection;
using db.tables;

namespace db;

public class HistoryMetaDataLibrary : AssetLibrary<HistoryMetaDataAsset>
{
	public static readonly Dictionary<MetaType, HistoryMetaDataAsset[]> _meta_data = new Dictionary<MetaType, HistoryMetaDataAsset[]>();

	public static readonly Dictionary<string, HistoryMetaDataAsset[]> _meta_dict = new Dictionary<string, HistoryMetaDataAsset[]>();

	public override void init()
	{
		base.init();
		add(new HistoryMetaDataAsset
		{
			id = "world",
			meta_type = MetaType.World,
			table_type = typeof(WorldTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(WorldYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(WorldYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(WorldYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(WorldYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(WorldYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(WorldYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(WorldYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(WorldYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(WorldYearly10000)
				}
			}
		});
		t.collector = (NanoObject _) => (HistoryTable)new WorldYearly1
		{
			id = 1L,
			alliances = StatsHelper.getStat("alliances"),
			alliances_dissolved = StatsHelper.getStat("world_statistics_alliances_dissolved"),
			alliances_made = StatsHelper.getStat("world_statistics_alliances_made"),
			books = StatsHelper.getStat("books"),
			books_burnt = StatsHelper.getStat("world_statistics_books_burnt"),
			books_read = StatsHelper.getStat("world_statistics_books_read"),
			books_written = StatsHelper.getStat("world_statistics_books_written"),
			cities = StatsHelper.getStat("villages"),
			cities_rebelled = StatsHelper.getStat("world_statistics_cities_rebelled"),
			cities_conquered = StatsHelper.getStat("world_statistics_cities_conquered"),
			cities_created = StatsHelper.getStat("world_statistics_cities_created"),
			cities_destroyed = StatsHelper.getStat("world_statistics_cities_destroyed"),
			clans = StatsHelper.getStat("clans"),
			clans_created = StatsHelper.getStat("world_statistics_clans_created"),
			clans_destroyed = StatsHelper.getStat("world_statistics_clans_destroyed"),
			creatures_born = StatsHelper.getStat("world_statistics_creatures_born"),
			creatures_created = StatsHelper.getStat("world_statistics_creatures_created"),
			cultures = StatsHelper.getStat("cultures"),
			cultures_created = StatsHelper.getStat("world_statistics_cultures_created"),
			cultures_forgotten = StatsHelper.getStat("world_statistics_cultures_forgotten"),
			deaths_eaten = StatsHelper.getStat("world_statistics_deaths_eaten"),
			deaths_hunger = StatsHelper.getStat("world_statistics_deaths_hunger"),
			deaths_natural = StatsHelper.getStat("world_statistics_deaths_natural"),
			deaths_poison = StatsHelper.getStat("world_statistics_deaths_poison"),
			deaths_infection = StatsHelper.getStat("world_statistics_deaths_infection"),
			deaths_tumor = StatsHelper.getStat("world_statistics_deaths_tumor"),
			deaths_acid = StatsHelper.getStat("world_statistics_deaths_acid"),
			deaths_fire = StatsHelper.getStat("world_statistics_deaths_fire"),
			deaths_divine = StatsHelper.getStat("world_statistics_deaths_divine"),
			deaths_weapon = StatsHelper.getStat("world_statistics_deaths_weapon"),
			deaths_gravity = StatsHelper.getStat("world_statistics_deaths_gravity"),
			deaths_drowning = StatsHelper.getStat("world_statistics_deaths_drowning"),
			deaths_water = StatsHelper.getStat("world_statistics_deaths_water"),
			deaths_explosion = StatsHelper.getStat("world_statistics_deaths_explosion"),
			metamorphosis = StatsHelper.getStat("world_statistics_metamorphosis"),
			evolutions = StatsHelper.getStat("world_statistics_evolutions"),
			deaths_other = StatsHelper.getStat("world_statistics_deaths_other"),
			deaths_plague = StatsHelper.getStat("world_statistics_deaths_plague"),
			deaths_total = StatsHelper.getStat("world_statistics_deaths_total"),
			families = StatsHelper.getStat("families"),
			families_created = StatsHelper.getStat("world_statistics_families_created"),
			families_destroyed = StatsHelper.getStat("world_statistics_families_destroyed"),
			houses = StatsHelper.getStat("world_statistics_houses"),
			houses_built = StatsHelper.getStat("world_statistics_houses_built"),
			houses_destroyed = StatsHelper.getStat("world_statistics_houses_destroyed"),
			infected = StatsHelper.getStat("world_statistics_infected"),
			islands = StatsHelper.getStat("world_statistics_islands"),
			kingdoms = StatsHelper.getStat("kingdoms"),
			kingdoms_created = StatsHelper.getStat("world_statistics_kingdoms_created"),
			kingdoms_destroyed = StatsHelper.getStat("world_statistics_kingdoms_destroyed"),
			languages = StatsHelper.getStat("languages"),
			languages_created = StatsHelper.getStat("world_statistics_languages_created"),
			languages_forgotten = StatsHelper.getStat("world_statistics_languages_forgotten"),
			peaces_made = StatsHelper.getStat("world_statistics_peaces_made"),
			plots = StatsHelper.getStat("plots"),
			plots_forgotten = StatsHelper.getStat("world_statistics_plots_forgotten"),
			plots_started = StatsHelper.getStat("world_statistics_plots_started"),
			plots_succeeded = StatsHelper.getStat("world_statistics_plots_succeeded"),
			population_beasts = StatsHelper.getStat("world_statistics_beasts"),
			population_civ = StatsHelper.getStat("world_statistics_population"),
			religions = StatsHelper.getStat("religions"),
			religions_created = StatsHelper.getStat("world_statistics_religions_created"),
			religions_forgotten = StatsHelper.getStat("world_statistics_religions_forgotten"),
			subspecies = StatsHelper.getStat("subspecies"),
			subspecies_created = StatsHelper.getStat("world_statistics_subspecies_created"),
			subspecies_extinct = StatsHelper.getStat("world_statistics_subspecies_extinct"),
			trees = StatsHelper.getStat("world_statistics_trees"),
			vegetation = StatsHelper.getStat("world_statistics_vegetation"),
			wars = StatsHelper.getStat("wars"),
			wars_started = StatsHelper.getStat("world_statistics_wars_started"),
			grass = StatsHelper.getStat("world_statistics_grass"),
			savanna = StatsHelper.getStat("world_statistics_savanna"),
			jungle = StatsHelper.getStat("world_statistics_jungle"),
			desert = StatsHelper.getStat("world_statistics_desert"),
			lemon = StatsHelper.getStat("world_statistics_lemon"),
			permafrost = StatsHelper.getStat("world_statistics_permafrost"),
			swamp = StatsHelper.getStat("world_statistics_swamp"),
			crystal = StatsHelper.getStat("world_statistics_crystal"),
			enchanted = StatsHelper.getStat("world_statistics_enchanted"),
			corruption = StatsHelper.getStat("world_statistics_corruption"),
			infernal = StatsHelper.getStat("world_statistics_infernal"),
			candy = StatsHelper.getStat("world_statistics_candy"),
			mushroom = StatsHelper.getStat("world_statistics_mushroom"),
			wasteland = StatsHelper.getStat("world_statistics_wasteland"),
			birch = StatsHelper.getStat("world_statistics_birch"),
			maple = StatsHelper.getStat("world_statistics_maple"),
			rocklands = StatsHelper.getStat("world_statistics_rocklands"),
			garlic = StatsHelper.getStat("world_statistics_garlic"),
			flower = StatsHelper.getStat("world_statistics_flower"),
			celestial = StatsHelper.getStat("world_statistics_celestial"),
			clover = StatsHelper.getStat("world_statistics_clover"),
			singularity = StatsHelper.getStat("world_statistics_singularity"),
			paradox = StatsHelper.getStat("world_statistics_paradox"),
			sand = StatsHelper.getStat("world_statistics_sand"),
			biomass = StatsHelper.getStat("world_statistics_biomass"),
			cybertile = StatsHelper.getStat("world_statistics_cybertile"),
			pumpkin = StatsHelper.getStat("world_statistics_pumpkin"),
			tumor = StatsHelper.getStat("world_statistics_tumor"),
			water = StatsHelper.getStat("world_statistics_water"),
			soil = StatsHelper.getStat("world_statistics_soil"),
			summit = StatsHelper.getStat("world_statistics_summit"),
			mountains = StatsHelper.getStat("world_statistics_mountains"),
			hills = StatsHelper.getStat("world_statistics_hills"),
			lava = StatsHelper.getStat("world_statistics_lava"),
			pit = StatsHelper.getStat("world_statistics_pit"),
			field = StatsHelper.getStat("world_statistics_field"),
			fireworks = StatsHelper.getStat("world_statistics_fireworks"),
			frozen = StatsHelper.getStat("world_statistics_frozen"),
			fuse = StatsHelper.getStat("world_statistics_fuse"),
			ice = StatsHelper.getStat("world_statistics_ice"),
			landmine = StatsHelper.getStat("world_statistics_landmine"),
			road = StatsHelper.getStat("world_statistics_road"),
			snow = StatsHelper.getStat("world_statistics_snow"),
			tnt = StatsHelper.getStat("world_statistics_tnt"),
			wall = StatsHelper.getStat("world_statistics_wall"),
			water_bomb = StatsHelper.getStat("world_statistics_water_bomb"),
			grey_goo = StatsHelper.getStat("world_statistics_grey_goo")
		};
		add(new HistoryMetaDataAsset
		{
			id = "alliance",
			meta_type = MetaType.Alliance,
			table_type = typeof(AllianceTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(AllianceYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(AllianceYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(AllianceYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(AllianceYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(AllianceYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(AllianceYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(AllianceYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(AllianceYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(AllianceYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0072: Unknown result type (might be due to invalid IL or missing references)
			//IL_0084: Unknown result type (might be due to invalid IL or missing references)
			//IL_0096: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
			//IL_00db: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
			//IL_0111: Unknown result type (might be due to invalid IL or missing references)
			//IL_0123: Unknown result type (might be due to invalid IL or missing references)
			//IL_0135: Unknown result type (might be due to invalid IL or missing references)
			//IL_0147: Unknown result type (might be due to invalid IL or missing references)
			//IL_0159: Unknown result type (might be due to invalid IL or missing references)
			//IL_016b: Unknown result type (might be due to invalid IL or missing references)
			//IL_017d: Unknown result type (might be due to invalid IL or missing references)
			//IL_018f: Unknown result type (might be due to invalid IL or missing references)
			//IL_01a2: Expected O, but got Unknown
			Alliance alliance = (Alliance)pNanoObject;
			return (HistoryTable)new AllianceYearly1
			{
				id = alliance.getID(),
				population = alliance.countPopulation(),
				adults = alliance.countAdults(),
				children = alliance.countChildren(),
				army = alliance.countWarriors(),
				sick = alliance.countSick(),
				hungry = alliance.countHungry(),
				starving = alliance.countStarving(),
				happy = alliance.countHappyUnits(),
				deaths = alliance.getTotalDeaths(),
				kills = alliance.getTotalKills(),
				births = alliance.getTotalBirths(),
				territory = alliance.countZones(),
				buildings = alliance.countBuildings(),
				homeless = alliance.countHomeless(),
				housed = alliance.countHoused(),
				families = alliance.countFamilies(),
				males = alliance.countMales(),
				females = alliance.countFemales(),
				kingdoms = alliance.countKingdoms(),
				cities = alliance.countCities(),
				renown = alliance.getRenown(),
				money = alliance.countTotalMoney()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "clan",
			meta_type = MetaType.Clan,
			table_type = typeof(ClanTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(ClanYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(ClanYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(ClanYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(ClanYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(ClanYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(ClanYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(ClanYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(ClanYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(ClanYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_005f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0070: Unknown result type (might be due to invalid IL or missing references)
			//IL_0081: Unknown result type (might be due to invalid IL or missing references)
			//IL_0093: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
			//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
			//IL_0102: Unknown result type (might be due to invalid IL or missing references)
			//IL_0114: Unknown result type (might be due to invalid IL or missing references)
			//IL_0127: Unknown result type (might be due to invalid IL or missing references)
			//IL_0139: Unknown result type (might be due to invalid IL or missing references)
			//IL_014b: Unknown result type (might be due to invalid IL or missing references)
			//IL_015d: Unknown result type (might be due to invalid IL or missing references)
			//IL_016f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0181: Unknown result type (might be due to invalid IL or missing references)
			//IL_0194: Unknown result type (might be due to invalid IL or missing references)
			//IL_01a7: Unknown result type (might be due to invalid IL or missing references)
			//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
			//IL_01cd: Unknown result type (might be due to invalid IL or missing references)
			//IL_01e0: Unknown result type (might be due to invalid IL or missing references)
			//IL_01f2: Unknown result type (might be due to invalid IL or missing references)
			//IL_0204: Unknown result type (might be due to invalid IL or missing references)
			//IL_0216: Expected O, but got Unknown
			Clan clan = (Clan)pNanoObject;
			return (HistoryTable)new ClanYearly1
			{
				id = clan.getID(),
				population = clan.countUnits(),
				adults = clan.countAdults(),
				children = clan.countChildren(),
				births = clan.getTotalBirths(),
				deaths = clan.getTotalDeaths(),
				kills = clan.getTotalKills(),
				kings = clan.countKings(),
				leaders = clan.countLeaders(),
				renown = clan.getRenown(),
				money = clan.countTotalMoney(),
				deaths_eaten = clan.getDeaths(AttackType.Eaten),
				deaths_hunger = clan.getDeaths(AttackType.Starvation),
				deaths_natural = clan.getDeaths(AttackType.Age),
				deaths_plague = clan.getDeaths(AttackType.Plague),
				deaths_poison = clan.getDeaths(AttackType.Poison),
				deaths_infection = clan.getDeaths(AttackType.Infection),
				deaths_tumor = clan.getDeaths(AttackType.Tumor),
				deaths_acid = clan.getDeaths(AttackType.Acid),
				deaths_fire = clan.getDeaths(AttackType.Fire),
				deaths_divine = clan.getDeaths(AttackType.Divine),
				deaths_weapon = clan.getDeaths(AttackType.Weapon),
				deaths_gravity = clan.getDeaths(AttackType.Gravity),
				deaths_drowning = clan.getDeaths(AttackType.Drowning),
				deaths_water = clan.getDeaths(AttackType.Water),
				deaths_explosion = clan.getDeaths(AttackType.Explosion),
				deaths_other = clan.getDeaths(AttackType.Other),
				metamorphosis = clan.getDeaths(AttackType.Metamorphosis),
				evolutions = clan.getEvolutions()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "city",
			meta_type = MetaType.City,
			table_type = typeof(CityTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(CityYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(CityYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(CityYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(CityYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(CityYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(CityYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(CityYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(CityYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(CityYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0072: Unknown result type (might be due to invalid IL or missing references)
			//IL_0084: Unknown result type (might be due to invalid IL or missing references)
			//IL_0096: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
			//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
			//IL_00de: Unknown result type (might be due to invalid IL or missing references)
			//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
			//IL_0102: Unknown result type (might be due to invalid IL or missing references)
			//IL_0113: Unknown result type (might be due to invalid IL or missing references)
			//IL_0124: Unknown result type (might be due to invalid IL or missing references)
			//IL_0135: Unknown result type (might be due to invalid IL or missing references)
			//IL_0146: Unknown result type (might be due to invalid IL or missing references)
			//IL_0157: Unknown result type (might be due to invalid IL or missing references)
			//IL_0168: Unknown result type (might be due to invalid IL or missing references)
			//IL_017a: Unknown result type (might be due to invalid IL or missing references)
			//IL_018c: Unknown result type (might be due to invalid IL or missing references)
			//IL_019e: Unknown result type (might be due to invalid IL or missing references)
			//IL_01b0: Unknown result type (might be due to invalid IL or missing references)
			//IL_01c2: Unknown result type (might be due to invalid IL or missing references)
			//IL_01d4: Unknown result type (might be due to invalid IL or missing references)
			//IL_01e6: Unknown result type (might be due to invalid IL or missing references)
			//IL_01fd: Unknown result type (might be due to invalid IL or missing references)
			//IL_0214: Unknown result type (might be due to invalid IL or missing references)
			//IL_022b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0242: Unknown result type (might be due to invalid IL or missing references)
			//IL_025e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0271: Unknown result type (might be due to invalid IL or missing references)
			//IL_0284: Unknown result type (might be due to invalid IL or missing references)
			//IL_0297: Unknown result type (might be due to invalid IL or missing references)
			//IL_02a9: Unknown result type (might be due to invalid IL or missing references)
			//IL_02bc: Unknown result type (might be due to invalid IL or missing references)
			//IL_02ce: Unknown result type (might be due to invalid IL or missing references)
			//IL_02e0: Unknown result type (might be due to invalid IL or missing references)
			//IL_02f2: Unknown result type (might be due to invalid IL or missing references)
			//IL_0304: Unknown result type (might be due to invalid IL or missing references)
			//IL_0316: Unknown result type (might be due to invalid IL or missing references)
			//IL_0329: Unknown result type (might be due to invalid IL or missing references)
			//IL_033c: Unknown result type (might be due to invalid IL or missing references)
			//IL_034f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0362: Unknown result type (might be due to invalid IL or missing references)
			//IL_0375: Unknown result type (might be due to invalid IL or missing references)
			//IL_0387: Unknown result type (might be due to invalid IL or missing references)
			//IL_0399: Unknown result type (might be due to invalid IL or missing references)
			//IL_03ab: Expected O, but got Unknown
			City city = (City)pNanoObject;
			return (HistoryTable)new CityYearly1
			{
				id = city.getID(),
				population = city.countUnits(),
				adults = city.countAdults(),
				children = city.countChildren(),
				boats = city.countBoats(),
				army = city.countWarriors(),
				families = city.countFamilies(),
				males = city.countMales(),
				females = city.countFemales(),
				sick = city.countSick(),
				loyalty = city.getCachedLoyalty(),
				hungry = city.countHungry(),
				starving = city.countStarving(),
				happy = city.countHappyUnits(),
				deaths = city.getTotalDeaths(),
				births = city.getTotalBirths(),
				joined = city.getTotalJoined(),
				left = city.getTotalLeft(),
				moved = city.getTotalMoved(),
				migrated = city.getTotalMigrated(),
				territory = city.countZones(),
				buildings = city.countBuildings(),
				homeless = city.countHomeless(),
				housed = city.countHoused(),
				renown = city.getRenown(),
				money = city.countTotalMoney(),
				food = city.getTotalFood(),
				gold = city.getResourcesAmount("gold"),
				wood = city.getResourcesAmount("wood"),
				stone = city.getResourcesAmount("stone"),
				common_metals = city.getResourcesAmount("common_metals"),
				items = city.data.equipment.countItems(),
				deaths_eaten = city.getDeaths(AttackType.Eaten),
				deaths_hunger = city.getDeaths(AttackType.Starvation),
				deaths_natural = city.getDeaths(AttackType.Age),
				deaths_plague = city.getDeaths(AttackType.Plague),
				deaths_poison = city.getDeaths(AttackType.Poison),
				deaths_infection = city.getDeaths(AttackType.Infection),
				deaths_tumor = city.getDeaths(AttackType.Tumor),
				deaths_acid = city.getDeaths(AttackType.Acid),
				deaths_fire = city.getDeaths(AttackType.Fire),
				deaths_divine = city.getDeaths(AttackType.Divine),
				deaths_weapon = city.getDeaths(AttackType.Weapon),
				deaths_gravity = city.getDeaths(AttackType.Gravity),
				deaths_drowning = city.getDeaths(AttackType.Drowning),
				deaths_water = city.getDeaths(AttackType.Water),
				deaths_explosion = city.getDeaths(AttackType.Explosion),
				deaths_other = city.getDeaths(AttackType.Other),
				metamorphosis = city.getDeaths(AttackType.Metamorphosis),
				evolutions = city.getEvolutions()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "culture",
			meta_type = MetaType.Culture,
			table_type = typeof(CultureTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(CultureYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(CultureYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(CultureYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(CultureYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(CultureYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(CultureYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(CultureYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(CultureYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(CultureYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_005f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0070: Unknown result type (might be due to invalid IL or missing references)
			//IL_0081: Unknown result type (might be due to invalid IL or missing references)
			//IL_0093: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
			//IL_00db: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ee: Expected O, but got Unknown
			Culture culture = (Culture)pNanoObject;
			return (HistoryTable)new CultureYearly1
			{
				id = culture.getID(),
				population = culture.countUnits(),
				cities = culture.countCities(),
				kingdoms = culture.countKingdoms(),
				births = culture.getTotalBirths(),
				deaths = culture.getTotalDeaths(),
				kills = culture.getTotalKills(),
				adults = culture.countAdults(),
				children = culture.countChildren(),
				kings = culture.countKings(),
				leaders = culture.countLeaders(),
				renown = culture.getRenown(),
				money = culture.countTotalMoney()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "family",
			meta_type = MetaType.Family,
			table_type = typeof(FamilyTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(FamilyYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(FamilyYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(FamilyYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(FamilyYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(FamilyYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(FamilyYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(FamilyYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(FamilyYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(FamilyYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_005f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0070: Unknown result type (might be due to invalid IL or missing references)
			//IL_0081: Unknown result type (might be due to invalid IL or missing references)
			//IL_0094: Expected O, but got Unknown
			Family family = (Family)pNanoObject;
			return (HistoryTable)new FamilyYearly1
			{
				id = family.getID(),
				population = family.countUnits(),
				adults = family.countAdults(),
				children = family.countChildren(),
				births = family.getTotalBirths(),
				deaths = family.getTotalDeaths(),
				kills = family.getTotalKills(),
				money = family.countTotalMoney()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "army",
			meta_type = MetaType.Army,
			table_type = typeof(ArmyTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(ArmyYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(ArmyYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(ArmyYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(ArmyYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(ArmyYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(ArmyYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(ArmyYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(ArmyYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(ArmyYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003b: Unknown result type (might be due to invalid IL or missing references)
			//IL_004d: Expected O, but got Unknown
			Army army = (Army)pNanoObject;
			return (HistoryTable)new ArmyYearly1
			{
				id = army.getID(),
				population = army.countUnits(),
				deaths = army.getTotalDeaths(),
				kills = army.getTotalKills()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "kingdom",
			meta_type = MetaType.Kingdom,
			table_type = typeof(KingdomTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(KingdomYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(KingdomYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(KingdomYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(KingdomYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(KingdomYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(KingdomYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(KingdomYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(KingdomYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(KingdomYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0072: Unknown result type (might be due to invalid IL or missing references)
			//IL_0084: Unknown result type (might be due to invalid IL or missing references)
			//IL_0096: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
			//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
			//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
			//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
			//IL_010f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0120: Unknown result type (might be due to invalid IL or missing references)
			//IL_0131: Unknown result type (might be due to invalid IL or missing references)
			//IL_0143: Unknown result type (might be due to invalid IL or missing references)
			//IL_0155: Unknown result type (might be due to invalid IL or missing references)
			//IL_0167: Unknown result type (might be due to invalid IL or missing references)
			//IL_0179: Unknown result type (might be due to invalid IL or missing references)
			//IL_018b: Unknown result type (might be due to invalid IL or missing references)
			//IL_019d: Unknown result type (might be due to invalid IL or missing references)
			//IL_01af: Unknown result type (might be due to invalid IL or missing references)
			//IL_01c1: Unknown result type (might be due to invalid IL or missing references)
			//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
			//IL_01e5: Unknown result type (might be due to invalid IL or missing references)
			//IL_01f7: Unknown result type (might be due to invalid IL or missing references)
			//IL_020a: Unknown result type (might be due to invalid IL or missing references)
			//IL_021d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0230: Unknown result type (might be due to invalid IL or missing references)
			//IL_0242: Unknown result type (might be due to invalid IL or missing references)
			//IL_0255: Unknown result type (might be due to invalid IL or missing references)
			//IL_0267: Unknown result type (might be due to invalid IL or missing references)
			//IL_0279: Unknown result type (might be due to invalid IL or missing references)
			//IL_028b: Unknown result type (might be due to invalid IL or missing references)
			//IL_029d: Unknown result type (might be due to invalid IL or missing references)
			//IL_02af: Unknown result type (might be due to invalid IL or missing references)
			//IL_02c2: Unknown result type (might be due to invalid IL or missing references)
			//IL_02d5: Unknown result type (might be due to invalid IL or missing references)
			//IL_02e8: Unknown result type (might be due to invalid IL or missing references)
			//IL_02fb: Unknown result type (might be due to invalid IL or missing references)
			//IL_030e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0320: Unknown result type (might be due to invalid IL or missing references)
			//IL_0332: Unknown result type (might be due to invalid IL or missing references)
			//IL_0344: Expected O, but got Unknown
			Kingdom kingdom = (Kingdom)pNanoObject;
			return (HistoryTable)new KingdomYearly1
			{
				id = kingdom.getID(),
				population = kingdom.countUnits(),
				adults = kingdom.countAdults(),
				children = kingdom.countChildren(),
				boats = kingdom.countBoats(),
				army = kingdom.countTotalWarriors(),
				sick = kingdom.countSick(),
				hungry = kingdom.countHungry(),
				starving = kingdom.countStarving(),
				happy = kingdom.countHappyUnits(),
				deaths = kingdom.getTotalDeaths(),
				births = kingdom.getTotalBirths(),
				kills = kingdom.getTotalKills(),
				joined = kingdom.getTotalJoined(),
				left = kingdom.getTotalLeft(),
				moved = kingdom.getTotalMoved(),
				migrated = kingdom.getTotalMigrated(),
				territory = kingdom.countZones(),
				buildings = kingdom.countBuildings(),
				homeless = kingdom.countHomeless(),
				housed = kingdom.countHoused(),
				food = kingdom.countTotalFood(),
				families = kingdom.countFamilies(),
				males = kingdom.countMales(),
				females = kingdom.countFemales(),
				cities = kingdom.countCities(),
				renown = kingdom.getRenown(),
				money = kingdom.countTotalMoney(),
				deaths_eaten = kingdom.getDeaths(AttackType.Eaten),
				deaths_hunger = kingdom.getDeaths(AttackType.Starvation),
				deaths_natural = kingdom.getDeaths(AttackType.Age),
				deaths_plague = kingdom.getDeaths(AttackType.Plague),
				deaths_poison = kingdom.getDeaths(AttackType.Poison),
				deaths_infection = kingdom.getDeaths(AttackType.Infection),
				deaths_tumor = kingdom.getDeaths(AttackType.Tumor),
				deaths_acid = kingdom.getDeaths(AttackType.Acid),
				deaths_fire = kingdom.getDeaths(AttackType.Fire),
				deaths_divine = kingdom.getDeaths(AttackType.Divine),
				deaths_weapon = kingdom.getDeaths(AttackType.Weapon),
				deaths_gravity = kingdom.getDeaths(AttackType.Gravity),
				deaths_drowning = kingdom.getDeaths(AttackType.Drowning),
				deaths_water = kingdom.getDeaths(AttackType.Water),
				deaths_explosion = kingdom.getDeaths(AttackType.Explosion),
				deaths_other = kingdom.getDeaths(AttackType.Other),
				metamorphosis = kingdom.getDeaths(AttackType.Metamorphosis),
				evolutions = kingdom.getEvolutions()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "language",
			meta_type = MetaType.Language,
			table_type = typeof(LanguageTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(LanguageYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(LanguageYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(LanguageYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(LanguageYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(LanguageYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(LanguageYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(LanguageYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(LanguageYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(LanguageYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0072: Unknown result type (might be due to invalid IL or missing references)
			//IL_0089: Unknown result type (might be due to invalid IL or missing references)
			//IL_009b: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
			//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
			//IL_00d1: Unknown result type (might be due to invalid IL or missing references)
			//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
			//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
			//IL_0105: Unknown result type (might be due to invalid IL or missing references)
			//IL_0118: Expected O, but got Unknown
			Language language = (Language)pNanoObject;
			return (HistoryTable)new LanguageYearly1
			{
				id = language.getID(),
				population = language.countUnits(),
				adults = language.countAdults(),
				children = language.countChildren(),
				kingdoms = language.countKingdoms(),
				cities = language.countCities(),
				books = language.books.count(),
				books_written = language.countWrittenBooks(),
				speakers_new = language.getSpeakersNew(),
				speakers_lost = language.getSpeakersLost(),
				speakers_converted = language.getSpeakersConverted(),
				deaths = language.getTotalDeaths(),
				kills = language.getTotalKills(),
				renown = language.getRenown(),
				money = language.countTotalMoney()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "religion",
			meta_type = MetaType.Religion,
			table_type = typeof(ReligionTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(ReligionYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(ReligionYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(ReligionYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(ReligionYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(ReligionYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(ReligionYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(ReligionYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(ReligionYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(ReligionYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0072: Unknown result type (might be due to invalid IL or missing references)
			//IL_0084: Unknown result type (might be due to invalid IL or missing references)
			//IL_0096: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
			//IL_00db: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
			//IL_0111: Unknown result type (might be due to invalid IL or missing references)
			//IL_0123: Unknown result type (might be due to invalid IL or missing references)
			//IL_0135: Unknown result type (might be due to invalid IL or missing references)
			//IL_0147: Unknown result type (might be due to invalid IL or missing references)
			//IL_0159: Unknown result type (might be due to invalid IL or missing references)
			//IL_016b: Unknown result type (might be due to invalid IL or missing references)
			//IL_017d: Unknown result type (might be due to invalid IL or missing references)
			//IL_018f: Expected O, but got Unknown
			Religion religion = (Religion)pNanoObject;
			return (HistoryTable)new ReligionYearly1
			{
				id = religion.getID(),
				population = religion.countUnits(),
				kingdoms = religion.countKingdoms(),
				cities = religion.countCities(),
				sick = religion.countSick(),
				happy = religion.countHappyUnits(),
				hungry = religion.countHungry(),
				starving = religion.countStarving(),
				deaths = religion.getTotalDeaths(),
				births = religion.getTotalBirths(),
				kills = religion.getTotalKills(),
				adults = religion.countAdults(),
				children = religion.countChildren(),
				males = religion.countMales(),
				females = religion.countFemales(),
				homeless = religion.countHomeless(),
				housed = religion.countHoused(),
				kings = religion.countKings(),
				leaders = religion.countLeaders(),
				renown = religion.getRenown(),
				money = religion.countTotalMoney(),
				evolutions = religion.getEvolutions()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "subspecies",
			meta_type = MetaType.Subspecies,
			table_type = typeof(SubspeciesTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(SubspeciesYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(SubspeciesYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(SubspeciesYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(SubspeciesYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(SubspeciesYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(SubspeciesYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(SubspeciesYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(SubspeciesYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(SubspeciesYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_005f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0070: Unknown result type (might be due to invalid IL or missing references)
			//IL_0081: Unknown result type (might be due to invalid IL or missing references)
			//IL_0093: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
			//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
			//IL_00de: Unknown result type (might be due to invalid IL or missing references)
			//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
			//IL_0103: Unknown result type (might be due to invalid IL or missing references)
			//IL_0115: Unknown result type (might be due to invalid IL or missing references)
			//IL_0127: Unknown result type (might be due to invalid IL or missing references)
			//IL_0139: Unknown result type (might be due to invalid IL or missing references)
			//IL_014b: Unknown result type (might be due to invalid IL or missing references)
			//IL_015d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0170: Unknown result type (might be due to invalid IL or missing references)
			//IL_0183: Unknown result type (might be due to invalid IL or missing references)
			//IL_0196: Unknown result type (might be due to invalid IL or missing references)
			//IL_01a9: Unknown result type (might be due to invalid IL or missing references)
			//IL_01bc: Unknown result type (might be due to invalid IL or missing references)
			//IL_01ce: Unknown result type (might be due to invalid IL or missing references)
			//IL_01e0: Unknown result type (might be due to invalid IL or missing references)
			//IL_01f2: Expected O, but got Unknown
			Subspecies subspecies = (Subspecies)pNanoObject;
			return (HistoryTable)new SubspeciesYearly1
			{
				id = subspecies.getID(),
				population = subspecies.countUnits(),
				adults = subspecies.countAdults(),
				children = subspecies.countChildren(),
				deaths = subspecies.getTotalDeaths(),
				births = subspecies.getTotalBirths(),
				kills = subspecies.getTotalKills(),
				renown = subspecies.getRenown(),
				money = subspecies.countTotalMoney(),
				deaths_eaten = subspecies.getDeaths(AttackType.Eaten),
				deaths_hunger = subspecies.getDeaths(AttackType.Starvation),
				deaths_natural = subspecies.getDeaths(AttackType.Age),
				deaths_plague = subspecies.getDeaths(AttackType.Plague),
				deaths_poison = subspecies.getDeaths(AttackType.Poison),
				deaths_infection = subspecies.getDeaths(AttackType.Infection),
				deaths_tumor = subspecies.getDeaths(AttackType.Tumor),
				deaths_acid = subspecies.getDeaths(AttackType.Acid),
				deaths_fire = subspecies.getDeaths(AttackType.Fire),
				deaths_divine = subspecies.getDeaths(AttackType.Divine),
				deaths_weapon = subspecies.getDeaths(AttackType.Weapon),
				deaths_gravity = subspecies.getDeaths(AttackType.Gravity),
				deaths_drowning = subspecies.getDeaths(AttackType.Drowning),
				deaths_water = subspecies.getDeaths(AttackType.Water),
				deaths_explosion = subspecies.getDeaths(AttackType.Explosion),
				deaths_other = subspecies.getDeaths(AttackType.Other),
				metamorphosis = subspecies.getDeaths(AttackType.Metamorphosis),
				evolutions = subspecies.getEvolutions()
			};
		};
		add(new HistoryMetaDataAsset
		{
			id = "war",
			meta_type = MetaType.War,
			table_type = typeof(WarTable),
			table_types = new Dictionary<HistoryInterval, Type>
			{
				{
					HistoryInterval.Yearly1,
					typeof(WarYearly1)
				},
				{
					HistoryInterval.Yearly5,
					typeof(WarYearly5)
				},
				{
					HistoryInterval.Yearly10,
					typeof(WarYearly10)
				},
				{
					HistoryInterval.Yearly50,
					typeof(WarYearly50)
				},
				{
					HistoryInterval.Yearly100,
					typeof(WarYearly100)
				},
				{
					HistoryInterval.Yearly500,
					typeof(WarYearly500)
				},
				{
					HistoryInterval.Yearly1000,
					typeof(WarYearly1000)
				},
				{
					HistoryInterval.Yearly5000,
					typeof(WarYearly5000)
				},
				{
					HistoryInterval.Yearly10000,
					typeof(WarYearly10000)
				}
			}
		});
		t.collector = delegate(NanoObject pNanoObject)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_004e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0072: Unknown result type (might be due to invalid IL or missing references)
			//IL_0083: Unknown result type (might be due to invalid IL or missing references)
			//IL_0095: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
			//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
			//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
			//IL_0101: Unknown result type (might be due to invalid IL or missing references)
			//IL_0114: Expected O, but got Unknown
			War war = (War)pNanoObject;
			return (HistoryTable)new WarYearly1
			{
				id = war.getID(),
				population = war.countTotalPopulation(),
				army = war.countTotalArmy(),
				renown = war.getRenown(),
				kingdoms = war.countKingdoms(),
				cities = war.countCities(),
				deaths = war.getTotalDeaths(),
				population_attackers = war.countAttackersPopulation(),
				population_defenders = war.countDefendersPopulation(),
				army_attackers = war.countAttackersWarriors(),
				army_defenders = war.countDefendersWarriors(),
				deaths_attackers = war.getDeadAttackers(),
				deaths_defenders = war.getDeadDefenders(),
				money_attackers = war.countAttackersMoney(),
				money_defenders = war.countDefendersMoney()
			};
		};
	}

	public override void editorDiagnostic()
	{
		base.editorDiagnostic();
		HashSet<Type> hashSet = new HashSet<Type>();
		foreach (HistoryMetaDataAsset item in list)
		{
			Dictionary<HistoryInterval, Type> table_types = item.table_types;
			foreach (HistoryInterval value in Enum.GetValues(typeof(HistoryInterval)))
			{
				if (value != 0)
				{
					if (!table_types.ContainsKey(value))
					{
						BaseAssetLibrary.logAssetError($"<e>HistoryMetaDataLibrary</e>: Missing a table type for <b>{value}</b>", item.id);
					}
					else if (!hashSet.Add(table_types[value]))
					{
						BaseAssetLibrary.logAssetError($"<e>HistoryMetaDataLibrary</e>: Duplicate table type <b>{table_types[value]}</b> for <b>{value}</b>", item.id);
					}
				}
			}
		}
	}

	public HistoryMetaDataAsset[] getAssets(MetaType pMetaType)
	{
		return _meta_data[pMetaType];
	}

	public HistoryMetaDataAsset[] getAssets(string pMetaType)
	{
		return _meta_dict[pMetaType];
	}

	public override void linkAssets()
	{
		base.linkAssets();
		Dictionary<MetaType, ListPool<HistoryMetaDataAsset>> dictionary = new Dictionary<MetaType, ListPool<HistoryMetaDataAsset>>();
		foreach (HistoryMetaDataAsset item2 in base.list)
		{
			TypeInfo typeInfo = item2.table_type.GetTypeInfo();
			List<string> list = new List<string>();
			foreach (PropertyInfo declaredProperty in typeInfo.DeclaredProperties)
			{
				if (declaredProperty.CanRead && declaredProperty.CanWrite && declaredProperty.GetMethod != null && declaredProperty.SetMethod != null && declaredProperty.GetMethod.IsPublic && declaredProperty.SetMethod.IsPublic && !declaredProperty.GetMethod.IsStatic && !declaredProperty.SetMethod.IsStatic)
				{
					list.Add(declaredProperty.Name);
				}
			}
			foreach (string item3 in list)
			{
				HistoryDataAsset item = AssetManager.history_data_library.get(item3);
				item2.categories.Add(item);
			}
			if (!dictionary.ContainsKey(item2.meta_type))
			{
				dictionary.Add(item2.meta_type, new ListPool<HistoryMetaDataAsset>());
			}
			dictionary[item2.meta_type].Add(item2);
		}
		foreach (var (metaType2, listPool2) in dictionary)
		{
			_meta_data.Add(metaType2, listPool2.ToArray());
			_meta_dict.Add(metaType2.AsString(), _meta_data[metaType2]);
		}
	}
}
// --- End of File: HistoryMetaDataLibrary.cs ---



// --- Start of File: HorizontalLayoutGroupExtended.cs ---
using UnityEngine;

namespace LayoutGroupExt;

[AddComponentMenu("Layout/Horizontal Layout Group ( Extended )", 150)]
public class HorizontalLayoutGroupExtended : HorizontalOrVerticalLayoutGroupExtended
{
	protected HorizontalLayoutGroupExtended()
	{
	}

	public override void CalculateLayoutInputHorizontal()
	{
		base.CalculateLayoutInputHorizontal();
		CalcAlongAxis(0, isVertical: false);
	}

	public override void CalculateLayoutInputVertical()
	{
		CalcAlongAxis(1, isVertical: false);
	}

	public override void SetLayoutHorizontal()
	{
		SetChildrenAlongAxis(0, isVertical: false);
	}

	public override void SetLayoutVertical()
	{
		SetChildrenAlongAxis(1, isVertical: false);
	}
}
// --- End of File: HorizontalLayoutGroupExtended.cs ---



// --- Start of File: HorizontalOrVerticalLayoutGroupExtended.cs ---
using UnityEngine;
using UnityEngine.UI;

namespace LayoutGroupExt;

[ExecuteAlways]
public abstract class HorizontalOrVerticalLayoutGroupExtended : LayoutGroupExtended
{
	[SerializeField]
	protected float m_Spacing;

	[SerializeField]
	protected bool m_ChildForceExpandWidth = true;

	[SerializeField]
	protected bool m_ChildForceExpandHeight = true;

	[SerializeField]
	protected bool m_ChildControlWidth = true;

	[SerializeField]
	protected bool m_ChildControlHeight = true;

	[SerializeField]
	protected bool m_ChildScaleWidth;

	[SerializeField]
	protected bool m_ChildScaleHeight;

	[SerializeField]
	protected bool m_ReverseArrangement;

	public float spacing
	{
		get
		{
			return m_Spacing;
		}
		set
		{
			((LayoutGroup)this).SetProperty<float>(ref m_Spacing, value);
		}
	}

	public bool childForceExpandWidth
	{
		get
		{
			return m_ChildForceExpandWidth;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ChildForceExpandWidth, value);
		}
	}

	public bool childForceExpandHeight
	{
		get
		{
			return m_ChildForceExpandHeight;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ChildForceExpandHeight, value);
		}
	}

	public bool childControlWidth
	{
		get
		{
			return m_ChildControlWidth;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ChildControlWidth, value);
		}
	}

	public bool childControlHeight
	{
		get
		{
			return m_ChildControlHeight;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ChildControlHeight, value);
		}
	}

	public bool childScaleWidth
	{
		get
		{
			return m_ChildScaleWidth;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ChildScaleWidth, value);
		}
	}

	public bool childScaleHeight
	{
		get
		{
			return m_ChildScaleHeight;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ChildScaleHeight, value);
		}
	}

	public bool reverseArrangement
	{
		get
		{
			return m_ReverseArrangement;
		}
		set
		{
			((LayoutGroup)this).SetProperty<bool>(ref m_ReverseArrangement, value);
		}
	}

	protected void CalcAlongAxis(int axis, bool isVertical)
	{
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		float num = ((axis == 0) ? ((LayoutGroup)this).padding.horizontal : ((LayoutGroup)this).padding.vertical);
		bool controlSize = ((axis == 0) ? m_ChildControlWidth : m_ChildControlHeight);
		bool flag = ((axis == 0) ? m_ChildScaleWidth : m_ChildScaleHeight);
		bool childForceExpand = ((axis == 0) ? m_ChildForceExpandWidth : m_ChildForceExpandHeight);
		float num2 = num;
		float num3 = num;
		float num4 = 0f;
		bool flag2 = isVertical ^ (axis == 1);
		int count = ((LayoutGroup)this).rectChildren.Count;
		for (int i = 0; i < count; i++)
		{
			RectTransform val = ((LayoutGroup)this).rectChildren[i];
			GetChildSizes(val, axis, controlSize, childForceExpand, out var min, out var preferred, out var flexible);
			if (flag)
			{
				Vector3 localScale = ((Transform)val).localScale;
				float num5 = ((Vector3)(ref localScale))[axis];
				min *= num5;
				preferred *= num5;
				flexible *= num5;
			}
			if (flag2)
			{
				num2 = Mathf.Max(min + num, num2);
				num3 = Mathf.Max(preferred + num, num3);
				num4 = Mathf.Max(flexible, num4);
			}
			else
			{
				num2 += min + spacing;
				num3 += preferred + spacing;
				num4 += flexible;
			}
		}
		if (!flag2 && ((LayoutGroup)this).rectChildren.Count > 0)
		{
			num2 -= spacing;
			num3 -= spacing;
		}
		num3 = Mathf.Max(num2, num3);
		((LayoutGroup)this).SetLayoutInputForAxis(num2, num3, num4, axis);
	}

	protected void SetChildrenAlongAxis(int axis, bool isVertical)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0295: Unknown result type (might be due to invalid IL or missing references)
		//IL_029a: Unknown result type (might be due to invalid IL or missing references)
		//IL_02d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_02da: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0153: Unknown result type (might be due to invalid IL or missing references)
		Rect rect = ((LayoutGroup)this).rectTransform.rect;
		Vector2 val = ((Rect)(ref rect)).size;
		float num = ((Vector2)(ref val))[axis];
		bool flag = ((axis == 0) ? m_ChildControlWidth : m_ChildControlHeight);
		bool flag2 = ((axis == 0) ? m_ChildScaleWidth : m_ChildScaleHeight);
		bool childForceExpand = ((axis == 0) ? m_ChildForceExpandWidth : m_ChildForceExpandHeight);
		float alignmentOnAxis = ((LayoutGroup)this).GetAlignmentOnAxis(axis);
		bool num2 = isVertical ^ (axis == 1);
		int num3 = (m_ReverseArrangement ? (((LayoutGroup)this).rectChildren.Count - 1) : 0);
		int num4 = ((!m_ReverseArrangement) ? ((LayoutGroup)this).rectChildren.Count : 0);
		int num5 = ((!m_ReverseArrangement) ? 1 : (-1));
		Vector3 localScale;
		if (num2)
		{
			float num6 = num - (float)((axis == 0) ? ((LayoutGroup)this).padding.horizontal : ((LayoutGroup)this).padding.vertical);
			for (int i = num3; m_ReverseArrangement ? (i >= num4) : (i < num4); i += num5)
			{
				RectTransform val2 = ((LayoutGroup)this).rectChildren[i];
				GetChildSizes(val2, axis, flag, childForceExpand, out var min, out var preferred, out var flexible);
				float num7;
				if (!flag2)
				{
					num7 = 1f;
				}
				else
				{
					localScale = ((Transform)val2).localScale;
					num7 = ((Vector3)(ref localScale))[axis];
				}
				float num8 = num7;
				float num9 = Mathf.Clamp(num6, min, (flexible > 0f) ? num : preferred);
				float startOffset = ((LayoutGroup)this).GetStartOffset(axis, num9 * num8);
				if (flag)
				{
					SetChildAlongAxisWithScale(val2, axis, startOffset, num9, num8);
					continue;
				}
				val = val2.sizeDelta;
				float num10 = (num9 - ((Vector2)(ref val))[axis]) * alignmentOnAxis;
				SetChildAlongAxisWithScale(val2, axis, startOffset + num10, num8);
			}
			return;
		}
		float num11 = ((axis == 0) ? ((LayoutGroup)this).padding.left : ((LayoutGroup)this).padding.top);
		float num12 = 0f;
		float num13 = num - ((LayoutGroup)this).GetTotalPreferredSize(axis);
		if (num13 > 0f)
		{
			if (((LayoutGroup)this).GetTotalFlexibleSize(axis) == 0f)
			{
				num11 = ((LayoutGroup)this).GetStartOffset(axis, ((LayoutGroup)this).GetTotalPreferredSize(axis) - (float)((axis == 0) ? ((LayoutGroup)this).padding.horizontal : ((LayoutGroup)this).padding.vertical));
			}
			else if (((LayoutGroup)this).GetTotalFlexibleSize(axis) > 0f)
			{
				num12 = num13 / ((LayoutGroup)this).GetTotalFlexibleSize(axis);
			}
		}
		float num14 = 0f;
		if (((LayoutGroup)this).GetTotalMinSize(axis) != ((LayoutGroup)this).GetTotalPreferredSize(axis))
		{
			num14 = Mathf.Clamp01((num - ((LayoutGroup)this).GetTotalMinSize(axis)) / (((LayoutGroup)this).GetTotalPreferredSize(axis) - ((LayoutGroup)this).GetTotalMinSize(axis)));
		}
		for (int j = num3; m_ReverseArrangement ? (j >= num4) : (j < num4); j += num5)
		{
			RectTransform val3 = ((LayoutGroup)this).rectChildren[j];
			GetChildSizes(val3, axis, flag, childForceExpand, out var min2, out var preferred2, out var flexible2);
			float num15;
			if (!flag2)
			{
				num15 = 1f;
			}
			else
			{
				localScale = ((Transform)val3).localScale;
				num15 = ((Vector3)(ref localScale))[axis];
			}
			float num16 = num15;
			float num17 = Mathf.Lerp(min2, preferred2, num14);
			num17 += flexible2 * num12;
			if (flag)
			{
				SetChildAlongAxisWithScale(val3, axis, num11, num17, num16);
			}
			else
			{
				float num18 = num17;
				val = val3.sizeDelta;
				float num19 = (num18 - ((Vector2)(ref val))[axis]) * alignmentOnAxis;
				SetChildAlongAxisWithScale(val3, axis, num11 + num19, num16);
			}
			num11 += num17 * num16 + spacing;
		}
	}

	private void GetChildSizes(RectTransform child, int axis, bool controlSize, bool childForceExpand, out float min, out float preferred, out float flexible)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		if (!controlSize)
		{
			Vector2 sizeDelta = child.sizeDelta;
			min = ((Vector2)(ref sizeDelta))[axis];
			preferred = min;
			flexible = 0f;
		}
		else
		{
			min = LayoutUtility.GetMinSize(child, axis);
			preferred = LayoutUtility.GetPreferredSize(child, axis);
			flexible = LayoutUtility.GetFlexibleSize(child, axis);
		}
		if (childForceExpand)
		{
			flexible = Mathf.Max(flexible, 1f);
		}
	}
}
// --- End of File: HorizontalOrVerticalLayoutGroupExtended.cs ---



// --- Start of File: HorizontalToolbarArrow.cs ---
using UnityEngine;

public class HorizontalToolbarArrow : ToolbarArrow
{
	public bool is_left = true;

	protected override void Update()
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		base.Update();
		float num = iTween.easeInOutCirc(0f, hide_position.x, timer);
		if (arrow_transform.localPosition.x != num)
		{
			arrow_transform.localPosition = new Vector3(num, 0f);
		}
	}

	protected override float getScrollPosition()
	{
		return scroll_rect.horizontalNormalizedPosition;
	}

	protected override void setScrollPosition(float pValue)
	{
		scroll_rect.horizontalNormalizedPosition = pValue;
	}

	protected override float getEndPosition()
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		float scrollPosition = getScrollPosition();
		float num = (float)Screen.width / CanvasMain.instance.canvas_ui.scaleFactor;
		Rect rect = scroll_rect.content.rect;
		float num2 = num / ((Rect)(ref rect)).width;
		if (is_left)
		{
			return scrollPosition - Mathf.Min(num2, 0.5f);
		}
		return scrollPosition + Mathf.Min(num2, 0.5f);
	}

	protected override void onScroll(Vector2 pVal)
	{
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		float num = (float)Screen.width / CanvasMain.instance.canvas_ui.scaleFactor;
		should_show = true;
		Rect rect = scroll_rect.content.rect;
		if (((Rect)(ref rect)).width < num)
		{
			should_show = false;
		}
		else if (is_left)
		{
			if (getScrollPosition() > 0.1f)
			{
				should_show = true;
			}
			else
			{
				should_show = false;
			}
		}
		else if (getScrollPosition() == 1f)
		{
			should_show = false;
		}
		else if (getScrollPosition() < 0.98f)
		{
			should_show = true;
		}
		else
		{
			should_show = false;
		}
	}
}
// --- End of File: HorizontalToolbarArrow.cs ---



// --- Start of File: HotkeyAction.cs ---
public delegate void HotkeyAction(HotkeyAsset pAsset);
// --- End of File: HotkeyAction.cs ---



// --- Start of File: HotkeyAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using UnityEngine;

[Serializable]
public class HotkeyAsset : Asset
{
	public KeyCode default_key_mod_1;

	public KeyCode default_key_mod_2;

	public KeyCode default_key_mod_3;

	public KeyCode default_key_1;

	public KeyCode default_key_2;

	public KeyCode default_key_3;

	public KeyCode overridden_key_1;

	public KeyCode overridden_key_2;

	public KeyCode overridden_key_3;

	public KeyCode overridden_key_mod_1;

	public KeyCode overridden_key_mod_2;

	public KeyCode overridden_key_mod_3;

	public bool use_mouse_wheel;

	public HotkeyAction just_pressed_action;

	public HotkeyAction holding_action;

	[DefaultValue(0.1f)]
	public float holding_cooldown = 0.1f;

	[DefaultValue(0.33f)]
	public float holding_cooldown_first_action = 0.33f;

	public bool ignore_same_key_diagnostic;

	public bool disable_for_controlled_unit;

	public bool ignore_mod_keys;

	public bool check_only_controllable_unit;

	public bool check_only_not_controllable_unit;

	public bool check_controls_locked;

	public bool check_window_active;

	public bool check_window_not_active;

	public bool check_render_gameplay;

	public bool check_render_minimap;

	public bool check_debug_active;

	public bool check_no_multi_unit_selection;

	public bool check_no_selection;

	public bool check_multi_unit_selection;

	public bool allow_unit_control;

	public bool isJustPressed()
	{
		if (!Input.anyKeyDown)
		{
			return false;
		}
		if (disable_for_controlled_unit && ControllableUnit.isControllingUnit())
		{
			return false;
		}
		if (hasModKey())
		{
			if (!isHoldingModKey())
			{
				return false;
			}
			if (!hasKey() && isJustPressedModKey())
			{
				return true;
			}
		}
		else if (!ignore_mod_keys && isHoldingAnyModKey())
		{
			return false;
		}
		if (hasKey() && isJustPressedKey())
		{
			return true;
		}
		return false;
	}

	public bool isHolding()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		if (use_mouse_wheel)
		{
			if (Input.mouseScrollDelta.y == 0f)
			{
				return false;
			}
		}
		else if (!Input.anyKey)
		{
			return false;
		}
		if (disable_for_controlled_unit && ControllableUnit.isControllingUnit())
		{
			return false;
		}
		if (hasModKey())
		{
			if (!isHoldingModKey())
			{
				return false;
			}
			if (!hasKey() && isHoldingModKey())
			{
				return true;
			}
		}
		else if (!ignore_mod_keys && isHoldingAnyModKey())
		{
			return false;
		}
		if (hasKey() && isHoldingKey())
		{
			return true;
		}
		if (use_mouse_wheel)
		{
			return true;
		}
		return false;
	}

	private bool isHoldingModKey()
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		if (!Input.anyKey)
		{
			return false;
		}
		if (disable_for_controlled_unit && ControllableUnit.isControllingUnit())
		{
			return false;
		}
		if ((int)default_key_mod_1 != 0 && Input.GetKey(default_key_mod_1))
		{
			return true;
		}
		if ((int)default_key_mod_2 != 0 && Input.GetKey(default_key_mod_2))
		{
			return true;
		}
		if ((int)default_key_mod_3 != 0 && Input.GetKey(default_key_mod_3))
		{
			return true;
		}
		return false;
	}

	public static bool isHoldingAnyModKey()
	{
		return AssetManager.hotkey_library.isHoldingAnyModKey();
	}

	private bool hasKey()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Invalid comparison between Unknown and I4
		return (int)default_key_1 > 0;
	}

	private bool hasModKey()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Invalid comparison between Unknown and I4
		return (int)default_key_mod_1 > 0;
	}

	public string getLocalizedKeys()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		string text = "";
		string localizedKey = HotkeysLocalized.getLocalizedKey(default_key_1);
		string localizedKey2 = HotkeysLocalized.getLocalizedKey(default_key_2);
		string localizedKey3 = HotkeysLocalized.getLocalizedKey(default_key_3);
		string localizedKey4 = HotkeysLocalized.getLocalizedKey(default_key_mod_1);
		string localizedKey5 = HotkeysLocalized.getLocalizedKey(default_key_mod_2);
		string localizedKey6 = HotkeysLocalized.getLocalizedKey(default_key_mod_3);
		List<string> list = new List<string>();
		if (!string.IsNullOrEmpty(localizedKey))
		{
			list.Add(localizedKey);
		}
		if (!string.IsNullOrEmpty(localizedKey2))
		{
			list.Add(localizedKey2);
		}
		if (!string.IsNullOrEmpty(localizedKey3))
		{
			list.Add(localizedKey3);
		}
		List<string> list2 = new List<string>();
		if (!string.IsNullOrEmpty(localizedKey4))
		{
			list2.Add(localizedKey4);
		}
		if (!string.IsNullOrEmpty(localizedKey5))
		{
			list2.Add(localizedKey5);
		}
		if (!string.IsNullOrEmpty(localizedKey6))
		{
			list2.Add(localizedKey6);
		}
		list = new List<string>(new HashSet<string>(list));
		list2 = new List<string>(new HashSet<string>(list2));
		if (hasKey() && hasModKey())
		{
			int num = Mathf.Max(list.Count, list2.Count);
			string text2 = "";
			string text3 = "";
			for (int i = 0; i < num; i++)
			{
				if (i > 0)
				{
					text += " / ";
				}
				if (i < list2.Count)
				{
					text2 = list2[i];
				}
				if (i < list.Count)
				{
					text3 = list[i];
				}
				text = text + text2 + " + " + text3;
			}
		}
		else if (hasModKey())
		{
			text += string.Join(", ", list2);
		}
		else if (hasKey())
		{
			text += string.Join(", ", list);
		}
		return text;
	}

	private bool isHoldingKey()
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		if (!Input.anyKey)
		{
			return false;
		}
		if ((int)default_key_1 != 0 && Input.GetKey(default_key_1))
		{
			return true;
		}
		if ((int)default_key_2 != 0 && Input.GetKey(default_key_2))
		{
			return true;
		}
		if ((int)default_key_3 != 0 && Input.GetKey(default_key_3))
		{
			return true;
		}
		return false;
	}

	private bool isJustPressedKey()
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		if (!Input.anyKeyDown)
		{
			return false;
		}
		if ((int)default_key_1 != 0 && Input.GetKeyDown(default_key_1))
		{
			return true;
		}
		if ((int)default_key_2 != 0 && Input.GetKeyDown(default_key_2))
		{
			return true;
		}
		if ((int)default_key_3 != 0 && Input.GetKeyDown(default_key_3))
		{
			return true;
		}
		return false;
	}

	private bool isJustPressedModKey()
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		if (!Input.anyKeyDown)
		{
			return false;
		}
		if ((int)default_key_mod_1 != 0 && Input.GetKeyDown(default_key_mod_1))
		{
			return true;
		}
		if ((int)default_key_mod_2 != 0 && Input.GetKeyDown(default_key_mod_2))
		{
			return true;
		}
		if ((int)default_key_mod_3 != 0 && Input.GetKeyDown(default_key_mod_3))
		{
			return true;
		}
		return false;
	}

	public bool checkIsPossible()
	{
		if (check_render_gameplay && !MapBox.isRenderGameplay())
		{
			return false;
		}
		if (check_render_minimap && !MapBox.isRenderMiniMap())
		{
			return false;
		}
		if (check_window_active)
		{
			if (!ScrollWindow.isWindowActive())
			{
				return false;
			}
			if (ScrollWindow.isAnimationActive())
			{
				return false;
			}
		}
		if (check_window_not_active && ScrollWindow.isWindowActive())
		{
			return false;
		}
		if (check_no_selection && SelectedUnit.isSet())
		{
			return false;
		}
		if (check_no_multi_unit_selection && SelectedUnit.multipleSelected())
		{
			return false;
		}
		if (check_multi_unit_selection && !SelectedUnit.multipleSelected())
		{
			return false;
		}
		if (check_only_not_controllable_unit && ControllableUnit.isControllingUnit())
		{
			return false;
		}
		if (check_only_controllable_unit && !ControllableUnit.isControllingUnit())
		{
			return false;
		}
		return true;
	}
}
// --- End of File: HotkeyAsset.cs ---



// --- Start of File: HotkeyLibrary.cs ---
using System;
using System.Collections.Generic;
using System.Globalization;
using Beebyte.Obfuscator;
using DG.Tweening;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

[Serializable]
[ObfuscateLiterals]
public class HotkeyLibrary : AssetLibrary<HotkeyAsset>
{
	public static HotkeyAsset cancel;

	public static HotkeyAsset console;

	public static HotkeyAsset remove;

	public static HotkeyAsset pause;

	public static HotkeyAsset hide_ui;

	public static HotkeyAsset action_jump;

	public static HotkeyAsset action_dash;

	public static HotkeyAsset action_backstep;

	public static HotkeyAsset action_talk;

	public static HotkeyAsset action_steal;

	public static HotkeyAsset action_swear;

	public static HotkeyAsset left;

	public static HotkeyAsset right;

	public static HotkeyAsset up;

	public static HotkeyAsset down;

	public static HotkeyAsset next_unit_in_multi_selection;

	public static HotkeyAsset next_tab;

	public static HotkeyAsset prev_tab;

	public static HotkeyAsset zoom_in;

	public static HotkeyAsset zoom_out;

	public static HotkeyAsset zoom;

	public static HotkeyAsset world_speed;

	public static HotkeyAsset brush;

	public static HotkeyAsset follow_unit;

	public static HotkeyAsset control_unit;

	public static HotkeyAsset fullscreen_switch;

	public static HotkeyAsset many_mod;

	public static HotkeyAsset fast_civ_mod;

	public static KeyCode[] mod_keys = (KeyCode[])(object)new KeyCode[0];

	private HotkeyAsset[] action_hotkeys = new HotkeyAsset[0];

	private Dictionary<string, float> holding_times = new Dictionary<string, float>();

	private bool holdingAnyModKey;

	private bool runModKeyCheck = true;

	private bool _last_input_active;

	private MetaType[] _meta_zones = new MetaType[10]
	{
		MetaType.Army,
		MetaType.Alliance,
		MetaType.Kingdom,
		MetaType.City,
		MetaType.Clan,
		MetaType.Religion,
		MetaType.Culture,
		MetaType.Language,
		MetaType.Family,
		MetaType.Subspecies
	};

	public override void init()
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_0102: Unknown result type (might be due to invalid IL or missing references)
		//IL_0133: Unknown result type (might be due to invalid IL or missing references)
		//IL_0189: Unknown result type (might be due to invalid IL or missing references)
		//IL_01df: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0327: Unknown result type (might be due to invalid IL or missing references)
		//IL_0332: Unknown result type (might be due to invalid IL or missing references)
		//IL_039d: Unknown result type (might be due to invalid IL or missing references)
		//IL_03a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_03dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_03e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_040a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0415: Unknown result type (might be due to invalid IL or missing references)
		//IL_0473: Unknown result type (might be due to invalid IL or missing references)
		//IL_0483: Unknown result type (might be due to invalid IL or missing references)
		//IL_04a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_04b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_04d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_04e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0508: Unknown result type (might be due to invalid IL or missing references)
		//IL_0518: Unknown result type (might be due to invalid IL or missing references)
		//IL_0539: Unknown result type (might be due to invalid IL or missing references)
		//IL_0549: Unknown result type (might be due to invalid IL or missing references)
		//IL_056a: Unknown result type (might be due to invalid IL or missing references)
		//IL_057a: Unknown result type (might be due to invalid IL or missing references)
		//IL_059b: Unknown result type (might be due to invalid IL or missing references)
		//IL_05ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_05c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_05cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_05d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0625: Unknown result type (might be due to invalid IL or missing references)
		//IL_062d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0638: Unknown result type (might be due to invalid IL or missing references)
		//IL_0689: Unknown result type (might be due to invalid IL or missing references)
		//IL_0691: Unknown result type (might be due to invalid IL or missing references)
		//IL_069c: Unknown result type (might be due to invalid IL or missing references)
		//IL_06a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_06b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_070b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0718: Unknown result type (might be due to invalid IL or missing references)
		//IL_0739: Unknown result type (might be due to invalid IL or missing references)
		//IL_0746: Unknown result type (might be due to invalid IL or missing references)
		//IL_0767: Unknown result type (might be due to invalid IL or missing references)
		//IL_0774: Unknown result type (might be due to invalid IL or missing references)
		//IL_078d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0798: Unknown result type (might be due to invalid IL or missing references)
		//IL_07eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_07fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0814: Unknown result type (might be due to invalid IL or missing references)
		//IL_0871: Unknown result type (might be due to invalid IL or missing references)
		//IL_087c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0887: Unknown result type (might be due to invalid IL or missing references)
		//IL_08e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_08ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_0933: Unknown result type (might be due to invalid IL or missing references)
		//IL_0943: Unknown result type (might be due to invalid IL or missing references)
		//IL_0961: Unknown result type (might be due to invalid IL or missing references)
		//IL_0971: Unknown result type (might be due to invalid IL or missing references)
		//IL_098f: Unknown result type (might be due to invalid IL or missing references)
		//IL_099f: Unknown result type (might be due to invalid IL or missing references)
		//IL_09bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_09cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_09eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_09fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a19: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a29: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a47: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a57: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a75: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a85: Unknown result type (might be due to invalid IL or missing references)
		//IL_0aa3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ab3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0acc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ad7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ae2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0aed: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b31: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b41: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b5f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b6f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b8d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b9d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0bbb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0bcb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0be9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0bf9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0c17: Unknown result type (might be due to invalid IL or missing references)
		//IL_0c27: Unknown result type (might be due to invalid IL or missing references)
		//IL_0c45: Unknown result type (might be due to invalid IL or missing references)
		//IL_0c55: Unknown result type (might be due to invalid IL or missing references)
		//IL_0c73: Unknown result type (might be due to invalid IL or missing references)
		//IL_0c83: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ca1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0cb1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0cca: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d25: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d3e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d9c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0dac: Unknown result type (might be due to invalid IL or missing references)
		//IL_0dc5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e1b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e6d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e75: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e7d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ed7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ee4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ef1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f34: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f3c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f47: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f8e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f9e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0fbc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0fcc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0fd8: Unknown result type (might be due to invalid IL or missing references)
		base.init();
		addHotkeysForUnitControlLayer();
		fullscreen_switch = add(new HotkeyAsset
		{
			id = "fullscreen_switch",
			default_key_1 = (KeyCode)13,
			default_key_mod_1 = (KeyCode)308,
			just_pressed_action = delegate
			{
				PlayerConfig.toggleFullScreen();
			}
		});
		console = add(new HotkeyAsset
		{
			id = "console",
			default_key_1 = (KeyCode)126,
			default_key_2 = (KeyCode)96,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				if ((Object)(object)EventSystem.current.currentSelectedGameObject == (Object)null)
				{
					World.world.console.Toggle();
				}
			}
		});
		cancel = add(new HotkeyAsset
		{
			id = "cancel",
			default_key_1 = (KeyCode)27,
			just_pressed_action = escapeAction
		});
		add(new HotkeyAsset
		{
			id = "back",
			default_key_1 = (KeyCode)326,
			just_pressed_action = backAction
		});
		pause = add(new HotkeyAsset
		{
			id = "pause",
			default_key_1 = (KeyCode)32,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				Config.paused = !Config.paused;
			}
		});
		hide_ui = add(new HotkeyAsset
		{
			id = "hide_ui",
			default_key_1 = (KeyCode)104,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				Config.ui_main_hidden = !Config.ui_main_hidden;
			}
		});
		remove = add(new HotkeyAsset
		{
			id = "remove",
			default_key_1 = (KeyCode)127,
			default_key_2 = (KeyCode)8,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				if (SelectedUnit.isSet())
				{
					SelectedUnit.killSelected();
				}
				else
				{
					string pID = "life_eraser";
					if (World.world.isSelectedPower("life_eraser"))
					{
						pID = "demolish";
					}
					World.world.selected_buttons.clickPowerButton(PowerButton.get(pID));
				}
			}
		});
		zoom = add(new HotkeyAsset
		{
			id = "zoom",
			use_mouse_wheel = true,
			holding_cooldown = 0f,
			check_window_not_active = true,
			check_controls_locked = true,
			allow_unit_control = true,
			holding_action = delegate(HotkeyAsset pAsset)
			{
				//IL_0021: Unknown result type (might be due to invalid IL or missing references)
				if (World.world.isPointerInGame() && (!World.world.isOverUI() || MoveCamera.inSpectatorMode()))
				{
					float y3 = Input.mouseScrollDelta.y;
					if (y3 < 0f)
					{
						MoveCamera.zoomOutWheel(pAsset);
					}
					else if (y3 > 0f)
					{
						MoveCamera.zoomInWheel(pAsset);
					}
				}
			}
		});
		world_speed = add(new HotkeyAsset
		{
			id = "world_speed",
			default_key_mod_1 = (KeyCode)306,
			default_key_mod_2 = (KeyCode)305,
			default_key_mod_3 = (KeyCode)310,
			check_window_not_active = true,
			check_controls_locked = true,
			use_mouse_wheel = true,
			holding_cooldown = 0f,
			holding_action = delegate
			{
				//IL_0000: Unknown result type (might be due to invalid IL or missing references)
				float y2 = Input.mouseScrollDelta.y;
				WorldTimeScaleAsset time_scale_asset = Config.time_scale_asset;
				if (y2 < 0f)
				{
					Config.prevWorldSpeed();
				}
				else if (y2 > 0f)
				{
					Config.nextWorldSpeed();
				}
				if (time_scale_asset != Config.time_scale_asset)
				{
					string text5 = LocalizedTextManager.getText("changed_worldspeed");
					string text6 = null;
					text6 = ((Config.time_scale_asset.getLocaleID() == null) ? Toolbox.coloredText(Config.time_scale_asset.id, "#95DD5D") : Toolbox.coloredText(Config.time_scale_asset.getLocaleID(), "#95DD5D", pLocalize: true));
					text5 = text5.Replace("$speed$", text6);
					WorldTip.instance.showToolbarText(text5);
				}
			}
		});
		brush = add(new HotkeyAsset
		{
			id = "brush",
			default_key_mod_1 = (KeyCode)308,
			default_key_mod_2 = (KeyCode)307,
			check_window_not_active = true,
			check_controls_locked = true,
			use_mouse_wheel = true,
			holding_cooldown = 0f,
			holding_action = delegate
			{
				//IL_0000: Unknown result type (might be due to invalid IL or missing references)
				float y = Input.mouseScrollDelta.y;
				string current_brush = Config.current_brush;
				if (y < 0f)
				{
					BrushLibrary.nextBrush();
				}
				else if (y > 0f)
				{
					BrushLibrary.previousBrush();
				}
				if (current_brush != Config.current_brush)
				{
					BrushData brushData = Brush.get(Config.current_brush);
					string localeID = brushData.getLocaleID();
					string text3 = LocalizedTextManager.getText("changed_brush");
					string text4 = Toolbox.coloredText(localeID, "#95DD5D", pLocalize: true);
					text4 = text4 + " (" + Toolbox.coloredText(brushData.size.ToString(), "#95DD5D") + ")";
					text3 = text3.Replace("$brush$", text4);
					WorldTip.instance.showToolbarText(text3);
				}
			}
		});
		many_mod = add(new HotkeyAsset
		{
			id = "many_mod",
			default_key_mod_1 = (KeyCode)303,
			default_key_mod_2 = (KeyCode)304,
			disable_for_controlled_unit = true,
			check_only_not_controllable_unit = true
		});
		fast_civ_mod = add(new HotkeyAsset
		{
			id = "fast_civ_mod",
			default_key_mod_1 = (KeyCode)305,
			default_key_mod_2 = (KeyCode)306
		});
		left = add(new HotkeyAsset
		{
			id = "left",
			default_key_1 = (KeyCode)97,
			default_key_2 = (KeyCode)276,
			holding_action = MoveCamera.move,
			holding_cooldown = 0f,
			check_window_not_active = true,
			check_controls_locked = true,
			allow_unit_control = true
		});
		right = clone("right", "left");
		t.default_key_1 = (KeyCode)100;
		t.default_key_2 = (KeyCode)275;
		up = clone("up", "left");
		t.default_key_1 = (KeyCode)119;
		t.default_key_2 = (KeyCode)273;
		down = clone("down", "left");
		t.default_key_1 = (KeyCode)115;
		t.default_key_2 = (KeyCode)274;
		clone("fast_left", "left");
		t.default_key_mod_1 = (KeyCode)303;
		t.default_key_mod_2 = (KeyCode)304;
		clone("fast_right", "right");
		t.default_key_mod_1 = (KeyCode)303;
		t.default_key_mod_2 = (KeyCode)304;
		clone("fast_up", "up");
		t.default_key_mod_1 = (KeyCode)303;
		t.default_key_mod_2 = (KeyCode)304;
		clone("fast_down", "down");
		t.default_key_mod_1 = (KeyCode)303;
		t.default_key_mod_2 = (KeyCode)304;
		zoom_in = add(new HotkeyAsset
		{
			id = "zoom_in",
			default_key_1 = (KeyCode)113,
			default_key_2 = (KeyCode)43,
			default_key_3 = (KeyCode)270,
			check_window_not_active = true,
			check_controls_locked = true,
			holding_action = MoveCamera.zoomIn,
			holding_cooldown = 0f
		});
		zoom_out = add(new HotkeyAsset
		{
			id = "zoom_out",
			default_key_1 = (KeyCode)101,
			default_key_2 = (KeyCode)45,
			default_key_3 = (KeyCode)269,
			check_window_not_active = true,
			check_controls_locked = true,
			holding_action = MoveCamera.zoomOut,
			holding_cooldown = 0f
		});
		add(new HotkeyAsset
		{
			id = "power_left",
			default_key_1 = (KeyCode)276,
			default_key_2 = (KeyCode)97,
			default_key_mod_1 = (KeyCode)306,
			default_key_mod_2 = (KeyCode)310,
			default_key_mod_3 = (KeyCode)305,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = powerMove,
			holding_action = powerMove
		});
		clone("power_right", "power_left");
		t.default_key_1 = (KeyCode)275;
		t.default_key_2 = (KeyCode)100;
		clone("power_up", "power_left");
		t.default_key_1 = (KeyCode)273;
		t.default_key_2 = (KeyCode)119;
		clone("power_down", "power_left");
		t.default_key_1 = (KeyCode)274;
		t.default_key_2 = (KeyCode)115;
		add(new HotkeyAsset
		{
			id = "toggle_power",
			default_key_1 = (KeyCode)13,
			default_key_2 = (KeyCode)271,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				PowerButton activeButton = PowersTab.getActiveTab().getActiveButton();
				if (!((Object)(object)activeButton == (Object)null))
				{
					if (activeButton.godPower != null)
					{
						string text2 = activeButton.godPower.id;
						if (!(text2 == "clock"))
						{
							if (text2 == "pause")
							{
								activeButton.clickSpecial();
							}
							else
							{
								activeButton.godPower.select_button_action?.Invoke(activeButton.godPower.id);
								if (activeButton.godPower.toggle_action != null)
								{
									activeButton.godPower.toggle_action?.Invoke(activeButton.godPower.id);
									PowerButtonSelector.instance.checkToggleIcons();
								}
							}
						}
						else
						{
							Config.nextWorldSpeed(pCycle: true);
						}
					}
					else if (activeButton.type == PowerButtonType.Options)
					{
						((UnityEvent)((Component)activeButton).gameObject.GetComponent<Button>().onClick).Invoke();
					}
					else
					{
						activeButton.clickButton();
					}
				}
			}
		});
		clone("toggle_power2", "toggle_power");
		t.default_key_mod_1 = (KeyCode)306;
		t.default_key_mod_2 = (KeyCode)310;
		next_tab = add(new HotkeyAsset
		{
			id = "next_tab",
			default_key_1 = (KeyCode)9,
			check_window_not_active = true,
			check_controls_locked = true,
			check_no_multi_unit_selection = true,
			just_pressed_action = delegate
			{
				Button next = PowerTabController.instance.getNext(((Object)PowersTab.getActiveTab()).name);
				PowersTab.showTabFromButton(next);
				TipButton component = ((Component)next).gameObject.GetComponent<TipButton>();
				string pText = LocalizedTextManager.getText(component.textOnClick) + "\n" + LocalizedTextManager.getText(component.textOnClickDescription);
				WorldTip.instance.showToolbarText(pText);
			}
		});
		prev_tab = add(new HotkeyAsset
		{
			id = "prev_tab",
			default_key_1 = (KeyCode)9,
			default_key_mod_1 = (KeyCode)304,
			default_key_mod_2 = (KeyCode)303,
			check_window_not_active = true,
			check_controls_locked = true,
			check_no_multi_unit_selection = true,
			just_pressed_action = delegate
			{
				PowersTab.showTabFromButton(PowerTabController.instance.getPrev(((Object)PowersTab.getActiveTab()).name));
			}
		});
		add(new HotkeyAsset
		{
			id = "hotkey_1",
			default_key_1 = (KeyCode)49,
			default_key_2 = (KeyCode)257,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate(HotkeyAsset pAsset)
			{
				string text = pAsset.id;
				string hotkeyFromData = getHotkeyFromData(text);
				if (!string.IsNullOrEmpty(hotkeyFromData))
				{
					hotkeySelectNano(pAsset, hotkeyFromData);
				}
				else
				{
					string stringVal = PlayerConfig.dict[text].stringVal;
					hotkeySelectPower(pAsset, stringVal);
				}
			}
		});
		clone("hotkey_2", "hotkey_1");
		t.default_key_1 = (KeyCode)50;
		t.default_key_2 = (KeyCode)258;
		clone("hotkey_3", "hotkey_1");
		t.default_key_1 = (KeyCode)51;
		t.default_key_2 = (KeyCode)259;
		clone("hotkey_4", "hotkey_1");
		t.default_key_1 = (KeyCode)52;
		t.default_key_2 = (KeyCode)260;
		clone("hotkey_5", "hotkey_1");
		t.default_key_1 = (KeyCode)53;
		t.default_key_2 = (KeyCode)261;
		clone("hotkey_6", "hotkey_1");
		t.default_key_1 = (KeyCode)54;
		t.default_key_2 = (KeyCode)262;
		clone("hotkey_7", "hotkey_1");
		t.default_key_1 = (KeyCode)55;
		t.default_key_2 = (KeyCode)263;
		clone("hotkey_8", "hotkey_1");
		t.default_key_1 = (KeyCode)56;
		t.default_key_2 = (KeyCode)264;
		clone("hotkey_9", "hotkey_1");
		t.default_key_1 = (KeyCode)57;
		t.default_key_2 = (KeyCode)265;
		clone("hotkey_0", "hotkey_1");
		t.default_key_1 = (KeyCode)48;
		t.default_key_2 = (KeyCode)256;
		add(new HotkeyAsset
		{
			id = "save_hotkey_1",
			default_key_1 = (KeyCode)49,
			default_key_2 = (KeyCode)257,
			default_key_mod_1 = (KeyCode)306,
			default_key_mod_2 = (KeyCode)310,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate(HotkeyAsset pAsset)
			{
				if (SelectedObjects.isNanoObjectSet())
				{
					hotkeySaveTab(pAsset);
				}
				else
				{
					hotkeySavePower(pAsset);
				}
			}
		});
		clone("save_hotkey_2", "save_hotkey_1");
		t.default_key_1 = (KeyCode)50;
		t.default_key_2 = (KeyCode)258;
		clone("save_hotkey_3", "save_hotkey_1");
		t.default_key_1 = (KeyCode)51;
		t.default_key_2 = (KeyCode)259;
		clone("save_hotkey_4", "save_hotkey_1");
		t.default_key_1 = (KeyCode)52;
		t.default_key_2 = (KeyCode)260;
		clone("save_hotkey_5", "save_hotkey_1");
		t.default_key_1 = (KeyCode)53;
		t.default_key_2 = (KeyCode)261;
		clone("save_hotkey_6", "save_hotkey_1");
		t.default_key_1 = (KeyCode)54;
		t.default_key_2 = (KeyCode)262;
		clone("save_hotkey_7", "save_hotkey_1");
		t.default_key_1 = (KeyCode)55;
		t.default_key_2 = (KeyCode)263;
		clone("save_hotkey_8", "save_hotkey_1");
		t.default_key_1 = (KeyCode)56;
		t.default_key_2 = (KeyCode)264;
		clone("save_hotkey_9", "save_hotkey_1");
		t.default_key_1 = (KeyCode)57;
		t.default_key_2 = (KeyCode)265;
		clone("save_hotkey_0", "save_hotkey_1");
		t.default_key_1 = (KeyCode)48;
		t.default_key_2 = (KeyCode)256;
		add(new HotkeyAsset
		{
			id = "zone_type_previous",
			default_key_1 = (KeyCode)122,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				switchZones(-1);
			}
		});
		clone("zone_type_next", "zone_type_previous");
		t.just_pressed_action = delegate
		{
			switchZones(1);
		};
		t.default_key_1 = (KeyCode)120;
		add(new HotkeyAsset
		{
			id = "zone_type_state_next",
			default_key_1 = (KeyCode)99,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				toggleZones(1);
			}
		});
		clone("zone_type_state_previous", "zone_type_state_next");
		t.just_pressed_action = delegate
		{
			toggleZones(-1);
		};
		t.default_key_mod_1 = (KeyCode)306;
		t.default_key_mod_2 = (KeyCode)310;
		follow_unit = add(new HotkeyAsset
		{
			id = "follow_unit",
			default_key_1 = (KeyCode)102,
			check_window_not_active = false,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				Actor unit2 = SelectedUnit.unit;
				if (ScrollWindow.isWindowActive())
				{
					ScrollWindow currentWindow2 = ScrollWindow.getCurrentWindow();
					if (!(currentWindow2.screen_id != "unit") && !((Component)currentWindow2).GetComponent<UnitWindow>().name_input.inputField.isFocused && SelectedUnit.isSet())
					{
						World.world.followUnit(unit2);
						ScrollWindow.hideAllEvent();
					}
				}
				else if (MapBox.isRenderGameplay())
				{
					Actor actorNearCursor2 = World.world.getActorNearCursor();
					if (actorNearCursor2 == null)
					{
						if (MoveCamera.hasFocusUnit())
						{
							MoveCamera.clearFocusUnitOnly();
						}
						else if (SelectedUnit.isSet())
						{
							World.world.followUnit(unit2);
						}
					}
					else if (actorNearCursor2.isCameraFollowingUnit())
					{
						MoveCamera.clearFocusUnitOnly();
					}
					else
					{
						World.world.followUnit(actorNearCursor2);
					}
				}
			}
		});
		control_unit = add(new HotkeyAsset
		{
			id = "control_unit",
			default_key_1 = (KeyCode)103,
			check_window_not_active = false,
			just_pressed_action = delegate
			{
				if (MoveCamera.hasFocusUnit())
				{
					World.world.move_camera.clearFocusUnitAndUnselect();
				}
				Actor unit = SelectedUnit.unit;
				if (ScrollWindow.isWindowActive())
				{
					ScrollWindow currentWindow = ScrollWindow.getCurrentWindow();
					if (!(currentWindow.screen_id != "unit") && !((Component)currentWindow).GetComponent<UnitWindow>().name_input.inputField.isFocused && SelectedUnit.isSet())
					{
						ControllableUnit.setControllableCreature(unit);
						ScrollWindow.hideAllEvent();
					}
				}
				else if (MapBox.isRenderGameplay())
				{
					Actor actorNearCursor = World.world.getActorNearCursor();
					if (ControllableUnit.isControllingUnit())
					{
						if (ControllableUnit.isControllingUnit(actorNearCursor))
						{
							ControllableUnit.clear();
							return;
						}
						if (actorNearCursor != null)
						{
							ControllableUnit.clear();
							ControllableUnit.setControllableCreature(actorNearCursor);
							return;
						}
						if (actorNearCursor == null)
						{
							ControllableUnit.clear();
							return;
						}
					}
					if (actorNearCursor == null)
					{
						if (SelectedUnit.isSet())
						{
							ControllableUnit.setControllableCreatureAndSelected(unit);
						}
					}
					else
					{
						ControllableUnit.setControllableCreatureAndSelected(actorNearCursor);
					}
				}
			}
		});
		add(new HotkeyAsset
		{
			id = "meta_window_previous",
			default_key_1 = (KeyCode)276,
			default_key_2 = (KeyCode)113,
			default_key_3 = (KeyCode)97,
			just_pressed_action = delegate
			{
				MetaSwitchManager.switchWindows(MetaSwitchManager.Direction.Left);
			},
			check_controls_locked = true,
			check_window_active = true
		});
		clone("meta_window_next", "meta_window_previous");
		t.default_key_1 = (KeyCode)275;
		t.default_key_2 = (KeyCode)101;
		t.default_key_3 = (KeyCode)100;
		t.just_pressed_action = delegate
		{
			MetaSwitchManager.switchWindows(MetaSwitchManager.Direction.Right);
		};
		add(new HotkeyAsset
		{
			id = "window_tab_next",
			default_key_1 = (KeyCode)9,
			default_key_2 = (KeyCode)115,
			default_key_3 = (KeyCode)274,
			just_pressed_action = windowTabsSwitch,
			check_controls_locked = true,
			check_window_active = true
		});
		clone("window_tab_previous", "window_tab_next");
		t.default_key_mod_1 = (KeyCode)304;
		t.default_key_mod_2 = (KeyCode)303;
		clone("window_tab_previous_2", "window_tab_next");
		t.default_key_1 = (KeyCode)119;
		t.default_key_2 = (KeyCode)273;
		t.default_key_3 = (KeyCode)0;
	}

	private void addHotkeysForUnitControlLayer()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_010e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0119: Unknown result type (might be due to invalid IL or missing references)
		//IL_015f: Unknown result type (might be due to invalid IL or missing references)
		//IL_019e: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dd: Unknown result type (might be due to invalid IL or missing references)
		next_unit_in_multi_selection = add(new HotkeyAsset
		{
			id = "next_unit_in_multi_selection",
			default_key_1 = (KeyCode)9,
			check_window_not_active = true,
			check_controls_locked = true,
			check_multi_unit_selection = true,
			ignore_same_key_diagnostic = true,
			just_pressed_action = delegate
			{
				SelectedUnit.nextMainUnit();
			}
		});
		action_jump = add(new HotkeyAsset
		{
			id = "action_jump",
			default_key_1 = (KeyCode)32,
			ignore_same_key_diagnostic = true,
			check_window_not_active = true,
			check_controls_locked = true,
			check_only_controllable_unit = true
		});
		action_dash = add(new HotkeyAsset
		{
			id = "action_dash",
			default_key_1 = (KeyCode)304,
			default_key_2 = (KeyCode)303,
			ignore_same_key_diagnostic = true,
			check_window_not_active = true,
			check_controls_locked = true,
			ignore_mod_keys = true,
			check_only_controllable_unit = true
		});
		action_backstep = add(new HotkeyAsset
		{
			id = "action_backstep",
			default_key_1 = (KeyCode)306,
			default_key_2 = (KeyCode)305,
			ignore_same_key_diagnostic = true,
			check_window_not_active = true,
			check_controls_locked = true,
			ignore_mod_keys = true,
			check_only_controllable_unit = true
		});
		action_swear = add(new HotkeyAsset
		{
			id = "action_swear",
			default_key_1 = (KeyCode)102,
			ignore_same_key_diagnostic = true,
			check_window_not_active = true,
			check_controls_locked = true,
			check_only_controllable_unit = true
		});
		action_steal = add(new HotkeyAsset
		{
			id = "action_steal",
			default_key_1 = (KeyCode)113,
			ignore_same_key_diagnostic = true,
			check_window_not_active = true,
			check_controls_locked = true,
			check_only_controllable_unit = true
		});
		action_talk = add(new HotkeyAsset
		{
			id = "action_talk",
			default_key_1 = (KeyCode)116,
			ignore_same_key_diagnostic = true,
			check_window_not_active = true,
			check_controls_locked = true,
			check_only_controllable_unit = true
		});
	}

	private void switchZones(int pIndexChange)
	{
		MetaType currentMapBorderMode = Zones.getCurrentMapBorderMode(pCheckOnlyOption: true);
		int num = Array.IndexOf(_meta_zones, currentMapBorderMode);
		num += pIndexChange;
		num = Toolbox.loopIndex(num, _meta_zones.Length);
		currentMapBorderMode = _meta_zones[num];
		MetaTypeAsset asset = AssetManager.meta_type_library.getAsset(currentMapBorderMode);
		AssetManager.powers.get(asset.power_option_zone_id).toggle_action(asset.power_option_zone_id);
		PowerButtonSelector.instance.checkToggleIcons();
		GodPower pPower = AssetManager.powers.get(asset.power_option_zone_id);
		WorldTip.instance.showToolbarText(pPower);
	}

	private void toggleZones(int pIndexChange)
	{
		MetaType currentMapBorderMode = Zones.getCurrentMapBorderMode(pCheckOnlyOption: true);
		if (currentMapBorderMode != 0)
		{
			MetaTypeAsset asset = AssetManager.meta_type_library.getAsset(currentMapBorderMode);
			GodPower godPower = AssetManager.powers.get(asset.power_option_zone_id);
			if (godPower.multi_toggle)
			{
				asset.toggleOptionZone(godPower, pIndexChange, pDisable: false);
				PowerButtonSelector.instance.checkToggleIcons();
			}
		}
	}

	private void windowTabsSwitch(HotkeyAsset pAsset)
	{
		ScrollWindow currentWindow = ScrollWindow.getCurrentWindow();
		List<WindowMetaTab> contentTabs = currentWindow.tabs.getContentTabs();
		if (contentTabs.Count >= 2)
		{
			WindowMetaTab activeTab = currentWindow.tabs.getActiveTab();
			int num = contentTabs.IndexOf(activeTab);
			switch (pAsset.id)
			{
			case "window_tab_next":
				num++;
				break;
			case "window_tab_previous":
			case "window_tab_previous_2":
				num--;
				break;
			}
			num = Toolbox.loopIndex(num, contentTabs.Count);
			WindowMetaTab windowMetaTab = contentTabs[num];
			windowMetaTab.doAction();
			WorldTip.showNowTop(windowMetaTab.getWorldTipText(), pTranslate: false);
		}
	}

	private bool navigateWindowBack(HotkeyAsset pAsset)
	{
		if (!ScrollWindow.isWindowActive())
		{
			return false;
		}
		if (ScrollWindow.isAnimationActive())
		{
			ScrollWindow.finishAnimations();
		}
		WindowHistory.clickBack();
		return true;
	}

	private bool navigateTabBack(HotkeyAsset pAsset)
	{
		if (ScrollWindow.isWindowActive())
		{
			return false;
		}
		if (!SelectedTabsHistory.showPreviousTab())
		{
			return false;
		}
		return true;
	}

	private void backAction(HotkeyAsset pAsset)
	{
		if (!navigateWindowBack(pAsset) && !navigateTabBack(pAsset) && !PowersTab.getActiveTab().getAsset().tab_type_main)
		{
			PowerTabController.showMainTab();
		}
	}

	private void escapeAction(HotkeyAsset pAsset)
	{
		if (World.world.console.isActive())
		{
			World.world.console.Hide();
		}
		else if (ControllableUnit.isControllingUnit())
		{
			ControllableUnit.clear();
		}
		else if (World.world.tutorial.isActive())
		{
			World.world.tutorial.endTutorial();
		}
		else
		{
			if (MapBox.controlsLocked() || MapBox.isControllingUnit())
			{
				return;
			}
			if (MoveCamera.hasFocusUnit())
			{
				MoveCamera.clearFocusUnitOnly();
			}
			else
			{
				if (navigateWindowBack(pAsset))
				{
					return;
				}
				if (Config.ui_main_hidden)
				{
					Config.ui_main_hidden = false;
				}
				else if (!navigateTabBack(pAsset))
				{
					if ((Object)(object)World.world.selected_buttons.selectedButton != (Object)null)
					{
						World.world.selected_buttons.unselectAll();
					}
					else if (SelectedUnit.isSet())
					{
						SelectedUnit.clear();
					}
					else if (PowersTab.isTabSelected())
					{
						World.world.selected_buttons.unselectTabs();
						SelectedObjects.unselectNanoObject();
					}
					else
					{
						ScrollWindow.showWindow("quit_game");
					}
				}
			}
		}
	}

	private void powerMove(HotkeyAsset pAsset)
	{
		PowersTab activeTab = PowersTab.getActiveTab();
		switch (pAsset.id)
		{
		case "power_left":
			activeTab.leftButton();
			break;
		case "power_right":
			activeTab.rightButton();
			break;
		case "power_up":
			activeTab.upButton();
			break;
		case "power_down":
			activeTab.downButton();
			break;
		}
	}

	public override void linkAssets()
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		base.linkAssets();
		HashSet<KeyCode> hashSet = new HashSet<KeyCode>();
		HashSet<HotkeyAsset> hashSet2 = new HashSet<HotkeyAsset>();
		foreach (HotkeyAsset item in list)
		{
			item.overridden_key_1 = item.default_key_1;
			item.overridden_key_2 = item.default_key_2;
			item.overridden_key_3 = item.default_key_3;
			item.overridden_key_mod_1 = item.default_key_mod_1;
			item.overridden_key_mod_2 = item.default_key_mod_2;
			item.overridden_key_mod_3 = item.default_key_mod_3;
			if ((int)item.default_key_mod_1 != 0)
			{
				hashSet.Add(item.default_key_mod_1);
			}
			if ((int)item.default_key_mod_2 != 0)
			{
				hashSet.Add(item.default_key_mod_2);
			}
			if ((int)item.default_key_mod_3 != 0)
			{
				hashSet.Add(item.default_key_mod_3);
			}
			if (item.just_pressed_action != null)
			{
				hashSet2.Add(item);
			}
			else if (item.holding_action != null)
			{
				hashSet2.Add(item);
			}
		}
		mod_keys = hashSet.ToArray();
		action_hotkeys = hashSet2.ToArray();
	}

	public override void editorDiagnostic()
	{
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Invalid comparison between Unknown and I4
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0229: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0155: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_023b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0191: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0277: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b3: Unknown result type (might be due to invalid IL or missing references)
		base.editorDiagnostic();
		Dictionary<string, HotkeyAsset> dictionary = new Dictionary<string, HotkeyAsset>();
		foreach (HotkeyAsset item in list)
		{
			if (item.ignore_same_key_diagnostic)
			{
				continue;
			}
			string text = "";
			if (item.check_window_active)
			{
				text += "ui+";
			}
			using ListPool<string> listPool = new ListPool<string>();
			bool flag = (int)item.default_key_mod_1 > 0;
			if ((int)item.default_key_1 != 0)
			{
				if (flag)
				{
					if ((int)item.default_key_mod_1 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_1)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_1)).ToString());
					}
					if ((int)item.default_key_mod_2 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_1)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_2)).ToString());
					}
					if ((int)item.default_key_mod_3 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_1)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_3)).ToString());
					}
				}
				else
				{
					listPool.Add(text + ((object)(KeyCode)(ref item.default_key_1)).ToString());
				}
			}
			if ((int)item.default_key_2 != 0)
			{
				if (flag)
				{
					if ((int)item.default_key_mod_1 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_2)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_1)).ToString());
					}
					if ((int)item.default_key_mod_2 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_2)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_2)).ToString());
					}
					if ((int)item.default_key_mod_3 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_2)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_3)).ToString());
					}
				}
				else
				{
					listPool.Add(text + ((object)(KeyCode)(ref item.default_key_2)).ToString());
				}
			}
			if ((int)item.default_key_3 != 0)
			{
				if (flag)
				{
					if ((int)item.default_key_mod_1 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_3)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_1)).ToString());
					}
					if ((int)item.default_key_mod_2 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_3)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_2)).ToString());
					}
					if ((int)item.default_key_mod_3 != 0)
					{
						listPool.Add(text + ((object)(KeyCode)(ref item.default_key_3)).ToString() + "+" + ((object)(KeyCode)(ref item.default_key_mod_3)).ToString());
					}
				}
				else
				{
					listPool.Add(text + ((object)(KeyCode)(ref item.default_key_3)).ToString());
				}
			}
			foreach (ref string item2 in listPool)
			{
				string current2 = item2;
				if (dictionary.ContainsKey(current2))
				{
					BaseAssetLibrary.logAssetError("<e>" + item.id + "</e> has the same key as asset: <e>" + dictionary[current2].id + "</e>", current2);
				}
				else
				{
					dictionary.Add(current2, item);
				}
			}
		}
	}

	public static bool isHoldingControlForSelection()
	{
		if (!Input.GetKey((KeyCode)306))
		{
			return Input.GetKey((KeyCode)305);
		}
		return true;
	}

	public static bool isHoldingAlt()
	{
		if (!Input.GetKey((KeyCode)308))
		{
			return Input.GetKey((KeyCode)307);
		}
		return true;
	}

	public static bool isHoldingAnyMod()
	{
		if (AssetManager.hotkey_library == null)
		{
			return false;
		}
		return AssetManager.hotkey_library.isHoldingAnyModKey();
	}

	public void reset()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		foreach (HotkeyAsset item in list)
		{
			item.overridden_key_1 = item.default_key_1;
			item.overridden_key_2 = item.default_key_2;
			item.overridden_key_3 = item.default_key_3;
			item.overridden_key_mod_1 = item.default_key_mod_1;
			item.overridden_key_mod_2 = item.default_key_mod_2;
			item.overridden_key_mod_3 = item.default_key_mod_3;
		}
	}

	public string replaceSpecialTextKeys(string pText)
	{
		if (!pText.Contains("$"))
		{
			return pText;
		}
		foreach (HotkeyAsset item in list)
		{
			if (pText.Contains(item.id))
			{
				string oldValue = "$" + item.id + "$";
				string localizedKeys = item.getLocalizedKeys();
				pText = pText.Replace(oldValue, localizedKeys);
				if (pText.Contains("$mouse_wheel$"))
				{
					string newValue = Toolbox.coloredText("mouse_wheel", "#95DD5D", pLocalize: true);
					pText = pText.Replace("$mouse_wheel$", newValue);
				}
				if (!pText.Contains("$"))
				{
					return pText;
				}
			}
		}
		return pText;
	}

	public bool isHoldingAnyModKey()
	{
		if (!Input.anyKey)
		{
			return false;
		}
		if (runModKeyCheck)
		{
			runModKeyCheck = false;
			holdingAnyModKey = false;
			KeyCode[] array = mod_keys;
			for (int i = 0; i < array.Length; i++)
			{
				if (Input.GetKey(array[i]))
				{
					holdingAnyModKey = true;
					break;
				}
			}
		}
		return holdingAnyModKey;
	}

	public void checkHotKeyActions()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		runModKeyCheck = true;
		bool flag = Input.mouseScrollDelta.y != 0f;
		if (!World.world.has_focus || (!Input.anyKey && !flag))
		{
			return;
		}
		bool flag2 = isInputActive();
		bool flag3 = _last_input_active && !flag2;
		_last_input_active = flag2;
		if (flag2 || flag3)
		{
			return;
		}
		bool flag4 = MapBox.controlsLocked();
		bool flag5 = MapBox.isControllingUnit();
		HotkeyAsset[] array = action_hotkeys;
		foreach (HotkeyAsset hotkeyAsset in array)
		{
			if ((hotkeyAsset.use_mouse_wheel && !flag) || (hotkeyAsset.check_controls_locked && (flag4 || (flag5 && !hotkeyAsset.allow_unit_control))) || !hotkeyAsset.checkIsPossible())
			{
				continue;
			}
			if (hotkeyAsset.just_pressed_action != null && hotkeyAsset.isJustPressed())
			{
				hotkeyAsset.just_pressed_action(hotkeyAsset);
				if (hotkeyAsset.holding_action != null)
				{
					holding_times[hotkeyAsset.id] = hotkeyAsset.holding_cooldown_first_action;
				}
			}
			else if (hotkeyAsset.holding_action != null && hotkeyAsset.isHolding())
			{
				holding_times.TryGetValue(hotkeyAsset.id, out var value);
				value -= Time.deltaTime;
				if (value > 0f)
				{
					holding_times[hotkeyAsset.id] = value;
					continue;
				}
				hotkeyAsset.holding_action(hotkeyAsset);
				holding_times[hotkeyAsset.id] = hotkeyAsset.holding_cooldown;
			}
		}
	}

	private bool isInputActive()
	{
		if (!EventSystem.current.isFocused)
		{
			return false;
		}
		GameObject currentSelectedGameObject = EventSystem.current.currentSelectedGameObject;
		if ((Object)(object)currentSelectedGameObject == (Object)null)
		{
			return false;
		}
		InputField component = currentSelectedGameObject.GetComponent<InputField>();
		if ((Object)(object)component == (Object)null)
		{
			return false;
		}
		return component.isFocused;
	}

	public static bool allowedToUsePowers()
	{
		if (ScrollWindow.isWindowActive())
		{
			return false;
		}
		return true;
	}

	public void changeKey(HotkeyAsset pAsset, KeyCode pCode)
	{
	}

	public void load()
	{
	}

	public void hotkeySelectPower(HotkeyAsset pAsset, string pSelectPower)
	{
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Expected O, but got Unknown
		if (!string.IsNullOrEmpty(pSelectPower) && AssetManager.powers.get(pSelectPower) == null)
		{
			return;
		}
		if (string.IsNullOrEmpty(pSelectPower))
		{
			showTipNothing(pAsset);
			return;
		}
		PowerButton tPowerButton = PowerButton.get(pSelectPower);
		if ((Object)(object)tPowerButton == (Object)null)
		{
			return;
		}
		if (tPowerButton.isSelected())
		{
			tPowerButton.cancelSelection();
			return;
		}
		tPowerButton.selectPowerTab((TweenCallback)delegate
		{
			World.world.selected_buttons.clickPowerButton(tPowerButton);
			if (tPowerButton.isSelected())
			{
				WorldTip.instance.showToolbarText(tPowerButton.godPower);
			}
		});
	}

	public void hotkeySelectNano(HotkeyAsset pAsset, string pSelectNano)
	{
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_017a: Unknown result type (might be due to invalid IL or missing references)
		//IL_017f: Unknown result type (might be due to invalid IL or missing references)
		if (string.IsNullOrEmpty(pSelectNano))
		{
			showTipNothing(pAsset);
			return;
		}
		string[] array = pSelectNano.Split("|");
		string text = array[0];
		long pId = long.Parse(array[1]);
		MetaTypeAsset metaTypeAsset = AssetManager.meta_type_library.get(text);
		NanoObject nanoObject = metaTypeAsset.get(pId);
		if (nanoObject.isRekt() && array.Length < 3)
		{
			showTipNothing(pAsset);
			return;
		}
		NanoObject selectedNanoObject = SelectedObjects.getSelectedNanoObject();
		if (SelectedObjects.isNanoObjectSet() && SelectedObjects.getSelectedNanoObject() == nanoObject)
		{
			if (selectedNanoObject == SelectedUnit.unit)
			{
				World.world.locatePosition(Vector2.op_Implicit(SelectedUnit.unit.current_position));
			}
			else if (nanoObject is IMetaObject)
			{
				Actor randomUnit = (nanoObject as IMetaObject).getRandomUnit();
				if (randomUnit != null)
				{
					World.world.locatePosition(Vector2.op_Implicit(randomUnit.current_position));
				}
			}
			return;
		}
		if (World.world.isAnyPowerSelected())
		{
			PowerButtonSelector.instance.unselectAll();
		}
		SelectedObjects.unselectNanoObject();
		SelectedUnit.clear();
		if (text == "unit")
		{
			if (array.Length >= 3)
			{
				using (ListPool<Actor> listPool = new ListPool<Actor>(array.Length))
				{
					for (int i = 1; i < array.Length; i++)
					{
						long pID = long.Parse(array[i]);
						Actor actor = World.world.units.get(pID);
						if (!actor.isRekt())
						{
							listPool.Add(actor);
						}
					}
					if (listPool.Count > 0)
					{
						SelectedUnit.selectMultiple(listPool);
						SelectedObjects.setNanoObject(SelectedUnit.unit);
						if (selectedNanoObject == SelectedUnit.unit)
						{
							World.world.locatePosition(Vector2.op_Implicit(SelectedUnit.unit.current_position));
						}
					}
					if (listPool.Count == 0)
					{
						showTipNothing(pAsset);
					}
					else if (listPool.Count == 1)
					{
						PowerTabController.showTabSelectedUnit();
					}
					else
					{
						PowerTabController.showTabMultipleUnits();
					}
					return;
				}
			}
			SelectedUnit.select(nanoObject as Actor);
			SelectedObjects.setNanoObject(SelectedUnit.unit);
			PowerTabController.showTabSelectedUnit();
		}
		else
		{
			metaTypeAsset.selectAndInspect(nanoObject, pFromNameplate: false, pCheckNameplate: false);
		}
	}

	public void showTipNothing(HotkeyAsset pAsset)
	{
		string text = LocalizedTextManager.getText("hotkey_tip_empty_tip");
		text = text.Replace("$save_hotkey$", "$save_" + pAsset.id + "$");
		text = AssetManager.hotkey_library.replaceSpecialTextKeys(text);
		WorldTip.instance.showToolbarText(text);
	}

	public void hotkeySavePower(HotkeyAsset pAsset)
	{
		string text = World.world.getSelectedPowerID();
		string text2 = pAsset.id.Replace("save_", "");
		string text3 = "";
		if (string.IsNullOrEmpty(text))
		{
			text = string.Empty;
			text3 = LocalizedTextManager.getText("hotkey_tip_cleared");
		}
		else
		{
			text3 = LocalizedTextManager.getText("hotkey_tip_saved_power");
		}
		text3 = text3.Replace("$save_hotkey$", "$" + text2 + "$");
		text3 = AssetManager.hotkey_library.replaceSpecialTextKeys(text3);
		WorldTip.instance.showToolbarText(text3);
		PlayerConfig.dict[text2].stringVal = text;
		PlayerConfig.saveData();
		getHotkeyFromData(text2) = string.Empty;
	}

	public void hotkeySaveTab(HotkeyAsset pAsset)
	{
		string text = pAsset.id.Replace("save_", "");
		string text2 = "";
		string text3;
		if (!SelectedObjects.isNanoObjectSet())
		{
			text2 = LocalizedTextManager.getText("hotkey_tip_cleared");
			text3 = string.Empty;
		}
		else
		{
			text2 = LocalizedTextManager.getText("hotkey_tip_saved_nano");
			NanoObject selectedNanoObject = SelectedObjects.getSelectedNanoObject();
			text3 = selectedNanoObject.getMetaTypeAsset().id ?? "";
			if (SelectedUnit.isSet())
			{
				foreach (Actor allSelected in SelectedUnit.getAllSelectedList())
				{
					text3 += $"|{allSelected.id}";
				}
			}
			else
			{
				text3 += $"|{selectedNanoObject.id}";
			}
		}
		text2 = text2.Replace("$save_hotkey$", "$" + text + "$");
		text2 = AssetManager.hotkey_library.replaceSpecialTextKeys(text2);
		getHotkeyFromData(text) = text3;
		WorldTip.instance.showToolbarText(text2);
	}

	public ref string getHotkeyFromData(string pHotkeyId)
	{
		return pHotkeyId switch
		{
			"hotkey_1" => ref World.world.hotkey_tabs_data.hotkey_data_1, 
			"hotkey_2" => ref World.world.hotkey_tabs_data.hotkey_data_2, 
			"hotkey_3" => ref World.world.hotkey_tabs_data.hotkey_data_3, 
			"hotkey_4" => ref World.world.hotkey_tabs_data.hotkey_data_4, 
			"hotkey_5" => ref World.world.hotkey_tabs_data.hotkey_data_5, 
			"hotkey_6" => ref World.world.hotkey_tabs_data.hotkey_data_6, 
			"hotkey_7" => ref World.world.hotkey_tabs_data.hotkey_data_7, 
			"hotkey_8" => ref World.world.hotkey_tabs_data.hotkey_data_8, 
			"hotkey_9" => ref World.world.hotkey_tabs_data.hotkey_data_9, 
			"hotkey_0" => ref World.world.hotkey_tabs_data.hotkey_data_0, 
			_ => ref World.world.hotkey_tabs_data.hotkey_data_1, 
		};
	}

	public void initDebugHotkeys()
	{
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		initDebugHotkeysBase();
		initUnitDebugHotkeys();
		initDebugWindowHotkeys();
		add(new HotkeyAsset
		{
			id = "debug_autosave",
			default_key_1 = (KeyCode)115,
			default_key_mod_1 = (KeyCode)308,
			just_pressed_action = debugAutosave
		});
		add(new HotkeyAsset
		{
			id = "debug_next_test_map",
			default_key_1 = (KeyCode)280,
			just_pressed_action = delegate
			{
				if (!SmoothLoader.isLoading())
				{
					World.world.transition_screen.startTransition(TestMaps.loadNextMap);
				}
			}
		});
		add(new HotkeyAsset
		{
			id = "debug_prev_test_map",
			default_key_1 = (KeyCode)281,
			just_pressed_action = delegate
			{
				if (!SmoothLoader.isLoading())
				{
					World.world.transition_screen.startTransition(TestMaps.loadPrevMap);
				}
			}
		});
	}

	private void initDebugHotkeysBase()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_010a: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		add(new HotkeyAsset
		{
			id = "export_unit_sprites",
			default_key_1 = (KeyCode)121,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				WorldTip.instance.showToolbarText("Exporting unit sprites");
				AssetManager.dynamic_sprites_library.export();
			}
		});
		add(new HotkeyAsset
		{
			id = "autotester",
			default_key_1 = (KeyCode)117,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				World.world.auto_tester.toggleAutoTester();
			}
		});
		add(new HotkeyAsset
		{
			id = "test_zones_border_growth",
			default_key_1 = (KeyCode)111,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				DebugZonesTool.actionGrowBorder();
			}
		});
		add(new HotkeyAsset
		{
			id = "test_zones_abandon_zones",
			default_key_1 = (KeyCode)112,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				WorldTile[] tiles_list = World.world.tiles_list;
				foreach (WorldTile pTile in tiles_list)
				{
					World.world.buildings.addBuilding("poop", pTile);
				}
			}
		});
		add(new HotkeyAsset
		{
			id = "test_colors",
			default_key_1 = (KeyCode)114,
			check_window_not_active = true,
			check_controls_locked = true,
			just_pressed_action = delegate
			{
				foreach (Kingdom kingdom in World.world.kingdoms)
				{
					kingdom.generateBanner();
					ColorAsset random = AssetManager.kingdom_colors_library.list.GetRandom();
					kingdom.data.setColorID(AssetManager.kingdom_colors_library.list.IndexOf(random));
					if (kingdom.updateColor(random))
					{
						World.world.zone_calculator.dirtyAndClear();
					}
				}
			}
		});
	}

	private void initDebugWindowHotkeys()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		add(new HotkeyAsset
		{
			id = "debug_building_shadow_x_increase",
			default_key_1 = (KeyCode)120,
			default_key_mod_1 = (KeyCode)306,
			just_pressed_action = debugShadow,
			check_controls_locked = true,
			check_window_active = true,
			check_debug_active = true
		});
		clone("debug_building_shadow_x_reduce", "debug_building_shadow_x_increase");
		t.default_key_mod_1 = (KeyCode)304;
		clone("debug_building_shadow_y_increase", "debug_building_shadow_x_increase");
		t.default_key_1 = (KeyCode)121;
		clone("debug_building_shadow_y_reduce", "debug_building_shadow_y_increase");
		t.default_key_mod_1 = (KeyCode)304;
		clone("debug_building_shadow_distortion_increase", "debug_building_shadow_x_increase");
		t.default_key_1 = (KeyCode)100;
		clone("debug_building_shadow_distortion_reduce", "debug_building_shadow_distortion_increase");
		t.default_key_mod_1 = (KeyCode)304;
	}

	private void initUnitDebugHotkeys()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		add(new HotkeyAsset
		{
			id = "debug_unit_set_task",
			default_key_1 = (KeyCode)118,
			default_key_mod_1 = (KeyCode)306,
			check_window_not_active = true,
			check_controls_locked = true,
			check_render_gameplay = true,
			check_debug_active = true,
			just_pressed_action = delegate
			{
				if (DebugConfig.isOn(DebugOption.DebugUnitHotkeys))
				{
					World.world.getActorNearCursor()?.addStatusEffect("budding");
				}
			}
		});
		add(new HotkeyAsset
		{
			id = "debug_general_key",
			default_key_1 = (KeyCode)110,
			check_debug_active = true,
			just_pressed_action = delegate
			{
				if (!DebugConfig.isOn(DebugOption.DebugUnitHotkeys) || !SelectedUnit.isSet())
				{
					return;
				}
				using ListPool<Actor> listPool = new ListPool<Actor>(SelectedUnit.getAllSelected());
				foreach (ref Actor item in listPool)
				{
					item.getHitFullHealth(AttackType.Divine);
				}
			}
		});
		add(new HotkeyAsset
		{
			id = "debug_monolith",
			default_key_1 = (KeyCode)109,
			default_key_mod_1 = (KeyCode)306,
			check_window_not_active = true,
			check_controls_locked = true,
			check_render_gameplay = true,
			check_debug_active = true,
			just_pressed_action = delegate
			{
				if (!DebugConfig.isOn(DebugOption.DebugMonolith))
				{
					return;
				}
				foreach (Building building in World.world.buildings)
				{
					if (building.asset.id == "monolith")
					{
						BuildingMonolith component_monolith = building.component_monolith;
						component_monolith.doMonolithAction(component_monolith.building.current_tile, pForce: true);
					}
				}
			}
		});
	}

	private void debugAutosave(HotkeyAsset pAsset)
	{
		if (Config.isEditor)
		{
			AutoSaveManager.autoSave(pSkipDelete: true, pForce: true);
		}
	}

	private void debugShadow(HotkeyAsset pAsset)
	{
		if (!DebugConfig.isOn(DebugOption.DebugWindowHotkeys) || ((Object)ScrollWindow.getCurrentWindow()).name != "building_asset")
		{
			return;
		}
		BuildingAsset asset = BaseDebugAssetWindow<BuildingAsset, BuildingDebugAssetElement>.current_element.asset;
		if (asset.shadow)
		{
			switch (pAsset.id)
			{
			case "debug_building_shadow_x_increase":
				asset.shadow_bound.x += 0.05f;
				break;
			case "debug_building_shadow_x_reduce":
				asset.shadow_bound.x -= 0.05f;
				break;
			case "debug_building_shadow_y_increase":
				asset.shadow_bound.y += 0.05f;
				break;
			case "debug_building_shadow_y_reduce":
				asset.shadow_bound.y -= 0.05f;
				break;
			case "debug_building_shadow_distortion_increase":
				asset.shadow_distortion += 0.05f;
				break;
			case "debug_building_shadow_distortion_reduce":
				asset.shadow_distortion -= 0.05f;
				break;
			}
			Debug.Log((object)("t.setShadow(" + asset.shadow_bound.x.ToString(CultureInfo.InvariantCulture) + "f, " + asset.shadow_bound.y.ToString(CultureInfo.InvariantCulture) + "f, " + asset.shadow_distortion.ToString(CultureInfo.InvariantCulture) + "f);"));
			BuildingAssetWindow.reloadSprites();
		}
	}

	public void debug(DebugTool pTool)
	{
		foreach (HotkeyAsset item in list)
		{
			if (item.just_pressed_action == null && item.holding_action == null)
			{
				if (item.isJustPressed())
				{
					pTool.setText(item.id, "just_pressed", 0f, pShowBar: false, 0L);
				}
				if (item.isHolding())
				{
					pTool.setText(item.id, "holding", 0f, pShowBar: false, 0L);
				}
			}
		}
	}
}
// --- End of File: HotkeyLibrary.cs ---



// --- Start of File: HotkeysLocalized.cs ---
using System.Collections.Generic;
using UnityEngine;

public static class HotkeysLocalized
{
	private static Dictionary<KeyCode, string> _dictionary;

	private static void init()
	{
		_dictionary = new Dictionary<KeyCode, string>();
		_dictionary.Add((KeyCode)48, "0");
		_dictionary.Add((KeyCode)49, "1");
		_dictionary.Add((KeyCode)50, "2");
		_dictionary.Add((KeyCode)51, "3");
		_dictionary.Add((KeyCode)52, "4");
		_dictionary.Add((KeyCode)53, "5");
		_dictionary.Add((KeyCode)54, "6");
		_dictionary.Add((KeyCode)55, "7");
		_dictionary.Add((KeyCode)56, "8");
		_dictionary.Add((KeyCode)57, "9");
		_dictionary.Add((KeyCode)256, "0");
		_dictionary.Add((KeyCode)257, "1");
		_dictionary.Add((KeyCode)258, "2");
		_dictionary.Add((KeyCode)259, "3");
		_dictionary.Add((KeyCode)260, "4");
		_dictionary.Add((KeyCode)261, "5");
		_dictionary.Add((KeyCode)262, "6");
		_dictionary.Add((KeyCode)263, "7");
		_dictionary.Add((KeyCode)264, "8");
		_dictionary.Add((KeyCode)265, "9");
		_dictionary.Add((KeyCode)32, "SPACE");
		_dictionary.Add((KeyCode)304, "SHIFT");
		_dictionary.Add((KeyCode)303, "SHIFT");
		_dictionary.Add((KeyCode)308, "ALT");
		_dictionary.Add((KeyCode)307, "ALT");
		_dictionary.Add((KeyCode)306, "CONTROL");
		_dictionary.Add((KeyCode)305, "CONTROL");
		_dictionary.Add((KeyCode)310, "");
		_dictionary.Add((KeyCode)309, "");
	}

	public static string getLocalizedKey(KeyCode pCode)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		if (_dictionary == null)
		{
			init();
		}
		if ((int)pCode == 0)
		{
			return string.Empty;
		}
		string empty = string.Empty;
		empty = ((!_dictionary.ContainsKey(pCode)) ? ((object)(KeyCode)(ref pCode)).ToString() : _dictionary[pCode]);
		if (string.IsNullOrEmpty(empty))
		{
			return string.Empty;
		}
		return Toolbox.coloredText(empty, "#95DD5D");
	}
}
// --- End of File: HotkeysLocalized.cs ---



// --- Start of File: HotkeyTabsData.cs ---
using System;

[Serializable]
public class HotkeyTabsData
{
	public string hotkey_data_1;

	public string hotkey_data_2;

	public string hotkey_data_3;

	public string hotkey_data_4;

	public string hotkey_data_5;

	public string hotkey_data_6;

	public string hotkey_data_7;

	public string hotkey_data_8;

	public string hotkey_data_9;

	public string hotkey_data_0;
}
// --- End of File: HotkeyTabsData.cs ---



// --- Start of File: HoveringBgIconManager.cs ---
using System;
using System.Collections.Generic;
using DG.Tweening;
using UnityEngine;
using UnityEngine.UI;

public class HoveringBgIconManager : MonoBehaviour
{
	[SerializeField]
	private HoveringIcon _icon_prefab;

	private ObjectPoolGenericMono<HoveringIcon> _pool_icons;

	private CanvasGroup _canvas_group;

	private RectTransform _rect;

	private List<RectTransform> _places = new List<RectTransform>();

	[SerializeField]
	public bool _random_scale = true;

	[SerializeField]
	private Transform _icon_pool;

	[SerializeField]
	private Transform _icons;

	private static HoveringBgIconManager _instance;

	private void Awake()
	{
		if (_pool_icons == null)
		{
			_instance = this;
			_rect = ((Component)this).GetComponent<RectTransform>();
			_canvas_group = ((Component)this).GetComponent<CanvasGroup>();
			_pool_icons = new ObjectPoolGenericMono<HoveringIcon>(_icon_prefab, _icon_pool);
			for (int i = 0; i < _icons.childCount; i++)
			{
				Transform child = _icons.GetChild(i);
				RectTransform val = (RectTransform)(object)((child is RectTransform) ? child : null);
				_places.Add(val);
				((Object)((Component)val).gameObject).name = "Placing " + i;
			}
		}
	}

	private void OnDisable()
	{
		_pool_icons.clear();
	}

	public void fadeIn()
	{
		((Component)_icons).gameObject.SetActive(true);
		DOTweenModuleUI.DOFade(_canvas_group, 1f, 0.2f);
		_canvas_group.interactable = true;
		_canvas_group.blocksRaycasts = true;
	}

	public void fadeOut()
	{
		_canvas_group.interactable = false;
		_canvas_group.blocksRaycasts = false;
		DOTweenModuleUI.DOFade(_canvas_group, 0f, 0.2f);
		clear();
		resetPlaces();
		((Component)_icons).gameObject.SetActive(false);
	}

	private void resetPlaces()
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		if (!Randy.randomBool())
		{
			Rect rect = _rect.rect;
			float num = ((Rect)(ref rect)).width / 2f;
			rect = _rect.rect;
			float num2 = ((Rect)(ref rect)).height / 2f;
			Vector3 val = default(Vector3);
			((Vector3)(ref val))._002Ector(num, num2, 0f);
			for (int i = 0; i < _places.Count; i++)
			{
				RectTransform obj = _places[i];
				ShortcutExtensions.DOKill((Component)(object)obj, false);
				obj.anchoredPosition = Vector2.op_Implicit(val);
			}
		}
	}

	private void shufflePlaces()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		resetPlaces();
		Rect rect = _rect.rect;
		float width = ((Rect)(ref rect)).width;
		rect = _rect.rect;
		float height = ((Rect)(ref rect)).height;
		for (int i = 0; i < _places.Count; i++)
		{
			RectTransform obj = _places[i];
			float num = Randy.randomFloat(0.15f, 0.35f);
			DOTweenModuleUI.DOAnchorPos(obj, Vector2.op_Implicit(new Vector3(Randy.randomFloat(0f, width), Randy.randomFloat(0f, height), 0f)), num, false);
		}
	}

	public void animate(WindowAsset pWindowAsset)
	{
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		//IL_0139: Unknown result type (might be due to invalid IL or missing references)
		//IL_014a: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_018d: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_01db: Unknown result type (might be due to invalid IL or missing references)
		//IL_0209: Unknown result type (might be due to invalid IL or missing references)
		clear();
		shufflePlaces();
		float num = Randy.randomFloat(0f, 360f);
		string text = "ui/Icons/";
		using ListPool<string> listPool = new ListPool<string>(16);
		Delegate[] invocationList = pWindowAsset.get_hovering_icons.GetInvocationList();
		for (int i = 0; i < invocationList.Length; i++)
		{
			foreach (string item3 in ((HoveringBGIconsGetter)invocationList[i])(pWindowAsset))
			{
				if (item3.EndsWith("/"))
				{
					Sprite[] spriteList = SpriteTextureLoader.getSpriteList(text + item3);
					for (int j = 0; j < spriteList.Length; j++)
					{
						string item = text + item3 + ((Object)spriteList[j]).name;
						listPool.Add(item);
					}
				}
				else
				{
					string item2 = text + item3;
					listPool.Add(item2);
				}
			}
		}
		foreach (RectTransform place in _places)
		{
			string random = listPool.GetRandom();
			HoveringIcon next = _pool_icons.getNext();
			next.clear();
			((Component)next).transform.SetParent((Transform)(object)place, false);
			next.rect.anchoredPosition = Vector2.op_Implicit(Vector3.zero);
			((Component)next).transform.rotation = Quaternion.identity;
			next.image.sprite = SpriteTextureLoader.getSprite(random);
			if (_random_scale)
			{
				float num2 = Randy.randomFloat(0.4f, 1f);
				((Component)next).transform.localScale = new Vector3(num2, num2, num2);
			}
			else
			{
				((Component)next).transform.localScale = ((Transform)place).localScale;
			}
			Vector3 localScale = ((Component)next).transform.localScale;
			((Graphic)next.image).color = new Color(localScale.x, localScale.x, localScale.x, 1f);
			num += Randy.randomFloat(20f, 130f);
			((Component)next).transform.eulerAngles = new Vector3(0f, 0f, num);
			next.init();
		}
	}

	public static void show()
	{
		_instance.fadeIn();
	}

	public static void hide()
	{
		_instance.fadeOut();
	}

	public static void showWindow(WindowAsset pWindowAsset)
	{
		_instance.animate(pWindowAsset);
	}

	public static void dropAll()
	{
		foreach (HoveringIcon item in _instance._pool_icons.getListTotal())
		{
			if (((Component)item).gameObject.activeSelf)
			{
				UiCreature component = ((Component)item).GetComponent<UiCreature>();
				if (!component.dropped)
				{
					component.click();
				}
			}
		}
	}

	public static void randomDrop()
	{
		using ListPool<UiCreature> listPool = new ListPool<UiCreature>(_instance._pool_icons.countActive());
		foreach (HoveringIcon item in _instance._pool_icons.getListTotal())
		{
			if (((Component)item).gameObject.activeSelf)
			{
				UiCreature component = ((Component)item).GetComponent<UiCreature>();
				if (!component.dropped)
				{
					listPool.Add(component);
				}
			}
		}
		if (listPool.Count != 0)
		{
			listPool.GetRandom().click();
		}
	}

	private void clear()
	{
		_pool_icons.clear();
		_pool_icons.resetParent();
	}
}
// --- End of File: HoveringBgIconManager.cs ---



// --- Start of File: HoveringBGIconsGetter.cs ---
using System.Collections.Generic;

public delegate IEnumerable<string> HoveringBGIconsGetter(WindowAsset pAsset);
// --- End of File: HoveringBGIconsGetter.cs ---



// --- Start of File: HoveringIcon.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.UI;

public class HoveringIcon : MonoBehaviour
{
	private Vector3 _original_pos;

	private float _random_timer;

	public Image image;

	public float min = -2f;

	public float max = 2f;

	public float timer_mod = 1f;

	private Tweener _tweener;

	internal RectTransform rect;

	private void Awake()
	{
		rect = ((Component)this).GetComponent<RectTransform>();
		image = ((Component)this).GetComponent<Image>();
	}

	internal void clear()
	{
		TweenExtensions.Kill((Tween)(object)_tweener, false);
	}

	internal void init()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		_original_pos = ((Component)this).transform.localPosition;
		_random_timer = Randy.randomFloat(1f * timer_mod, 1.5f * timer_mod);
		startAnimation();
	}

	private void OnDisable()
	{
		clear();
	}

	private void startAnimation()
	{
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		TweenExtensions.Kill((Tween)(object)_tweener, false);
		((Component)this).transform.localPosition = new Vector3(_original_pos.x, _original_pos.y += Randy.randomFloat(min, max));
		if (Randy.randomBool())
		{
			moveStageOne();
		}
		else
		{
			moveStageTwo();
		}
	}

	private void moveStageTwo()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Expected O, but got Unknown
		_tweener = (Tweener)(object)TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMove(((Component)this).transform, _original_pos, _random_timer, false), (Ease)7), new TweenCallback(moveStageOne));
	}

	private void moveStageOne()
	{
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Expected O, but got Unknown
		Vector3 val = default(Vector3);
		((Vector3)(ref val))._002Ector(_original_pos.x, _original_pos.y, 1f);
		val.y += 3f;
		_tweener = (Tweener)(object)TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMove(((Component)this).transform, val, _random_timer, false), (Ease)7), new TweenCallback(moveStageTwo));
	}
}
// --- End of File: HoveringIcon.cs ---



// --- Start of File: HoverState.cs ---
public enum HoverState
{
	Hover,
	Up,
	Down
}
// --- End of File: HoverState.cs ---



// --- Start of File: IAnimationFrames.cs ---
public interface IAnimationFrames
{
	string[] getWalk();

	string[] getIdle();

	string[] getSwim();
}
// --- End of File: IAnimationFrames.cs ---



// --- Start of File: IAugmentationsEditor.cs ---
public interface IAugmentationsEditor
{
	void reloadButtons();
}
// --- End of File: IAugmentationsEditor.cs ---



// --- Start of File: IAugmentationsWindow.cs ---
public interface IAugmentationsWindow<TEditor> where TEditor : IAugmentationsEditor
{
	void updateStats();

	T GetComponentInChildren<T>(bool includeInactive = false);

	void reloadBanner();

	TEditor getEditor()
	{
		return GetComponentInChildren<TEditor>(includeInactive: true);
	}
}
// --- End of File: IAugmentationsWindow.cs ---



// --- Start of File: IBanner.cs ---
public interface IBanner : IBaseMono, IRefreshElement
{
	MetaCustomizationAsset meta_asset { get; }

	MetaTypeAsset meta_type_asset { get; }

	NanoObject GetNanoObject();

	void load(NanoObject pObject);

	string getName();

	void showTooltip();

	void jump(float pSpeed = 0.1f, bool pSilent = false)
	{
	}

	void IRefreshElement.refresh()
	{
		NanoObject nanoObject = GetNanoObject();
		if (nanoObject != null && nanoObject.isAlive())
		{
			load(nanoObject);
		}
	}
}
// --- End of File: IBanner.cs ---



// --- Start of File: IBaseMetaBanners.cs ---
using System.Collections.Generic;
using UnityEngine;

public interface IBaseMetaBanners
{
	void metaBannerShow(MetaBannerElement pAsset);

	void metaBannerHide(MetaBannerElement pAsset);

	IReadOnlyCollection<MetaBannerElement> getBanners();

	void enableClickAnimation()
	{
		foreach (MetaBannerElement banner in getBanners())
		{
			((Component)banner.banner).GetComponent<TipButton>().showOnClick = true;
		}
	}
}
// --- End of File: IBaseMetaBanners.cs ---



// --- Start of File: IBaseMono.cs ---
using UnityEngine;

public interface IBaseMono
{
	Transform transform { get; }

	GameObject gameObject { get; }

	T GetComponent<T>();

	T AddComponent<T>() where T : Component
	{
		return gameObject.AddComponent<T>();
	}

	bool HasComponent<T>() where T : Component
	{
		return gameObject.HasComponent<T>();
	}
}
// --- End of File: IBaseMono.cs ---



// --- Start of File: IBooksWindow.cs ---
using System.Collections.Generic;

public interface IBooksWindow
{
	List<long> getBooks();

	bool hasBooks()
	{
		return getBooks().Count > 0;
	}
}
// --- End of File: IBooksWindow.cs ---



// --- Start of File: IceTower.cs ---
public class IceTower : BaseBuildingComponent
{
	private float _action_interval = 0.3f;

	private float _action_timer;

	public override void update(float pElapsed)
	{
		base.update(pElapsed);
		if (_action_timer > 0f)
		{
			_action_timer -= pElapsed;
			return;
		}
		_action_timer = _action_interval;
		freezeRandomTile();
	}

	private void freezeRandomTile()
	{
		WorldTile current_tile = building.current_tile;
		TileIsland tileIsland = current_tile.region?.island;
		if (tileIsland != null)
		{
			WorldTile random = tileIsland.regions.GetRandom().tiles.GetRandom();
			freeze(current_tile, random);
		}
	}

	private void freeze(WorldTile pCenter, WorldTile pTile)
	{
		if (!(Toolbox.DistTile(pCenter, pTile) > 50f))
		{
			pTile.freeze();
		}
	}
}
// --- End of File: IceTower.cs ---



// --- Start of File: IComponentList.cs ---
using UnityEngine;
using UnityEngine.UI;

public interface IComponentList
{
	ListPool<NanoObject> getElements();

	void setShowAll();

	void setShowFavoritesOnly();

	void setShowDeadOnly();

	void setShowAliveOnly();

	void setDefault();

	void init(GameObject pNoItems, SortingTab pSortingTab, GameObject pListElementPrefab, Transform pListTransform, ScrollRect pScrollRect, Text pTitleCounter, Text pFavoritesCounter, Text pDeadCounter);
}
// --- End of File: IComponentList.cs ---



// --- Start of File: IconClickRotator.cs ---
using System.Collections;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class IconClickRotator : MonoBehaviour
{
	private Quaternion _startRotation;

	private Coroutine _rotationRoutine;

	private void Awake()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Expected O, but got Unknown
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		((UnityEvent)((Component)this).gameObject.AddOrGetComponent<Button>().onClick).AddListener(new UnityAction(click));
		((Component)this).gameObject.AddOrGetComponent<ScrollableButton>();
		_startRotation = ((Component)this).transform.rotation;
	}

	private void click()
	{
		startRandomRotation();
	}

	private void startRandomRotation()
	{
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		if (_rotationRoutine != null)
		{
			((MonoBehaviour)this).StopCoroutine(_rotationRoutine);
		}
		float num = Random.Range(-180f, 180f);
		Quaternion targetRotation = Quaternion.Euler(0f, 0f, num);
		_rotationRoutine = ((MonoBehaviour)this).StartCoroutine(RotateTo(targetRotation, 0.2f));
	}

	private IEnumerator RotateTo(Quaternion targetRotation, float duration)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		float time = 0f;
		Quaternion initialRotation = ((Component)this).transform.rotation;
		while (time < duration)
		{
			((Component)this).transform.rotation = Quaternion.Lerp(initialRotation, targetRotation, time / duration);
			time += Time.deltaTime;
			yield return null;
		}
		((Component)this).transform.rotation = targetRotation;
	}
}
// --- End of File: IconClickRotator.cs ---



// --- Start of File: IconGetter.cs ---
using UnityEngine;

public delegate(Sprite icon, Color color) IconGetter();
// --- End of File: IconGetter.cs ---



// --- Start of File: IconOutline.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class IconOutline : MonoBehaviour
{
	private static Dictionary<string, Sprite> _cached_textures = new Dictionary<string, Sprite>();

	private Image _image;

	public Image parent_image;

	private void Awake()
	{
		checkInit();
	}

	private void checkInit()
	{
		if (!((Object)(object)_image != (Object)null))
		{
			_image = ((Component)this).GetComponent<Image>();
			((Component)this).gameObject.AddComponent<FadeInOutAnimation>();
		}
	}

	public void show(ContainerItemColor pContainer)
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		checkInit();
		((Component)this).gameObject.SetActive(true);
		Color color = pContainer.color;
		color.a = 1f;
		((Graphic)_image).color = color;
		string key = ((object)parent_image.sprite.texture).GetHashCode() + "_" + ((object)(Color)(ref color)).GetHashCode();
		Sprite val = null;
		if (_cached_textures.ContainsKey(key))
		{
			val = _cached_textures[key];
		}
		else
		{
			val = generateSprite();
			_cached_textures.Add(key, val);
		}
		_image.sprite = val;
	}

	private Sprite generateSprite()
	{
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Expected O, but got Unknown
		//IL_0113: Unknown result type (might be due to invalid IL or missing references)
		//IL_0114: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		int width = ((Texture)parent_image.sprite.texture).width;
		int height = ((Texture)parent_image.sprite.texture).height;
		Texture2D val = new Texture2D(width, height);
		Color val2 = default(Color);
		((Color)(ref val2))._002Ector(1f, 1f, 1f, 0f);
		for (int i = 0; i < ((Texture)val).width; i++)
		{
			for (int j = 0; j < ((Texture)val).height; j++)
			{
				val.SetPixel(i, j, val2);
			}
		}
		makePixels(-1, -1, val);
		makePixels(1, 1, val);
		makePixels(1, -1, val);
		makePixels(-1, 1, val);
		makePixels(1, 0, val);
		makePixels(-1, 0, val);
		makePixels(0, 1, val);
		makePixels(0, -1, val);
		val.Apply();
		((Texture)val).filterMode = (FilterMode)0;
		((Object)val).name = "IconOutline";
		Rect val3 = default(Rect);
		((Rect)(ref val3))._002Ector(0f, 0f, (float)((Texture)val).width, (float)((Texture)val).height);
		Vector2 val4 = default(Vector2);
		((Vector2)(ref val4))._002Ector(0.5f, 0.5f);
		return Sprite.Create(val, val3, val4, 1f);
	}

	private void makePixels(int pOffsetX, int pOffsetY, Texture2D pTexture)
	{
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		for (int i = 0; i < ((Texture)pTexture).width; i++)
		{
			for (int j = 0; j < ((Texture)pTexture).height; j++)
			{
				if (parent_image.sprite.texture.GetPixel(i, j).a != 0f)
				{
					int num = i + pOffsetX;
					int num2 = j + pOffsetY;
					if (num >= 0 && num <= ((Texture)pTexture).width && num2 >= 0 && num2 <= ((Texture)pTexture).height)
					{
						Color pixel = pTexture.GetPixel(num, num2);
						pixel.a += 0.3f;
						pTexture.SetPixel(num, num2, pixel);
					}
				}
			}
		}
	}
}
// --- End of File: IconOutline.cs ---



// --- Start of File: IconPathGetter.cs ---
public delegate string IconPathGetter(IMetaObject pMeta);
// --- End of File: IconPathGetter.cs ---



// --- Start of File: IconRotationAnimation.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;

public class IconRotationAnimation : MonoBehaviour
{
	public float delay = 5f;

	public bool randomDelay;

	private Vector3 initScale;

	private Vector3 scaleTo;

	internal Tweener curTween;

	private void Awake()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		initScale = ((Component)this).transform.localScale;
		scaleTo = initScale * 1.1f;
		if (randomDelay)
		{
			delay = Randy.randomFloat(1f, 10f);
		}
	}

	private void checkDestroyTween()
	{
		if (curTween != null && ((Tween)curTween).active)
		{
			TweenExtensions.Complete((Tween)(object)curTween, false);
			TweenExtensions.Kill((Tween)(object)curTween, false);
			curTween = null;
		}
	}

	private void rotate1()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Expected O, but got Unknown
		if (!((Object)(object)((Component)this).transform == (Object)null))
		{
			curTween = (Tweener)(object)TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetDelay<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).transform, scaleTo, 0.3f), delay), (Ease)28), new TweenCallback(rotate2));
		}
	}

	private void rotate2()
	{
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Expected O, but got Unknown
		if (!((Object)(object)((Component)this).transform == (Object)null))
		{
			if (randomDelay)
			{
				delay = Randy.randomFloat(1f, 10f);
			}
			curTween = (Tweener)(object)TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetDelay<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).transform, initScale, 0.3f), 0f), (Ease)28), new TweenCallback(rotate1));
		}
	}

	private void OnEnable()
	{
		checkDestroyTween();
		rotate1();
	}

	private void OnDisable()
	{
		checkDestroyTween();
	}

	private void OnDestroy()
	{
		checkDestroyTween();
	}
}
// --- End of File: IconRotationAnimation.cs ---



// --- Start of File: ICoreObject.cs ---
public interface ICoreObject
{
	string name { get; }

	long getID();

	int getAge();

	bool isAlive();

	bool isFavorite();

	void switchFavorite();
}
// --- End of File: ICoreObject.cs ---



// --- Start of File: IDescription2Asset.cs ---
public interface IDescription2Asset : IDescriptionAsset, ILocalizedAsset
{
	string getDescriptionID2();
}
// --- End of File: IDescription2Asset.cs ---



// --- Start of File: IDescriptionAsset.cs ---
public interface IDescriptionAsset : ILocalizedAsset
{
	string getDescriptionID();
}
// --- End of File: IDescriptionAsset.cs ---



// --- Start of File: IDraggable.cs ---
using UnityEngine;
using UnityEngine.EventSystems;

public interface IDraggable : IEndDragHandler, IEventSystemHandler
{
	Transform transform { get; }

	bool spawn_particles_on_drag { get; }

	bool HasComponent<T>()
	{
		return ((Component)(object)transform).HasComponent<T>();
	}

	void KillDrag();
}
// --- End of File: IDraggable.cs ---



// --- Start of File: IEquipmentEditor.cs ---
public interface IEquipmentEditor : IAugmentationsEditor
{
}
// --- End of File: IEquipmentEditor.cs ---



// --- Start of File: IEquipmentWindow.cs ---
public interface IEquipmentWindow : IAugmentationsWindow<IEquipmentEditor>
{
	void reloadEquipment()
	{
		GetComponentInChildren<UnitEquipmentContainer>().reloadEquipment(pAnimated: false);
	}

	void checkEquipmentTabIcon();
}
// --- End of File: IEquipmentWindow.cs ---



// --- Start of File: IFavoriteable.cs ---
public interface IFavoriteable
{
	bool isFavorite();
}
// --- End of File: IFavoriteable.cs ---



// --- Start of File: IHandRenderer.cs ---
using UnityEngine;

public interface IHandRenderer
{
	bool is_colored { get; }

	bool is_animated { get; }

	Sprite[] getSprites();

	string getID()
	{
		return (this as Asset).id;
	}
}
// --- End of File: IHandRenderer.cs ---



// --- Start of File: IInterestingPeopleWindow.cs ---
using System.Collections.Generic;

public interface IInterestingPeopleWindow
{
	IEnumerable<Actor> getInterestingUnitsList();
}
// --- End of File: IInterestingPeopleWindow.cs ---



// --- Start of File: ILibraryWithUnlockables.cs ---
using System.Collections.Generic;

public interface ILibraryWithUnlockables
{
	IEnumerable<BaseUnlockableAsset> elements_list { get; }

	int countTotalKnowledge()
	{
		int num = 0;
		foreach (BaseUnlockableAsset item in elements_list)
		{
			if (item.show_in_knowledge_window)
			{
				num++;
			}
		}
		return num;
	}

	int countUnlockedByPlayer()
	{
		int num = 0;
		foreach (BaseUnlockableAsset item in elements_list)
		{
			if (item.show_in_knowledge_window && item.isUnlockedByPlayer())
			{
				num++;
			}
		}
		return num;
	}
}
// --- End of File: ILibraryWithUnlockables.cs ---



// --- Start of File: IllustrationFadeIn.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class IllustrationFadeIn : MonoBehaviour
{
	public float scale_start = 1.5f;

	public float scale_end = 1f;

	public float duration = 1f;

	public Ease ease_type = (Ease)12;

	private void Awake()
	{
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Expected O, but got Unknown
		Button val = default(Button);
		if (!((Component)this).TryGetComponent<Button>(ref val))
		{
			val = ((Component)this).gameObject.AddComponent<Button>();
		}
		((UnityEvent)val.onClick).AddListener(new UnityAction(onCLick));
		((Graphic)((Component)this).GetComponent<Image>()).raycastTarget = true;
	}

	private void OnEnable()
	{
		startTween();
	}

	public void startTween()
	{
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = default(Vector3);
		((Vector3)(ref val))._002Ector(scale_start, scale_start, scale_start);
		Vector3 val2 = default(Vector3);
		((Vector3)(ref val2))._002Ector(scale_end, scale_end, scale_end);
		ShortcutExtensions.DOKill((Component)(object)((Component)this).transform, false);
		TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.From<Vector3, Vector3, VectorOptions>(ShortcutExtensions.DOScale(((Component)this).transform, val2, duration), val, true, false), ease_type);
	}

	public void onCLick()
	{
		startTween();
	}
}
// --- End of File: IllustrationFadeIn.cs ---



// --- Start of File: ILoadable.cs ---
public interface ILoadable<TData>
{
	void setData(TData pData);

	void loadData(TData pData);
}
// --- End of File: ILoadable.cs ---



// --- Start of File: ILocalizedAsset.cs ---
public interface ILocalizedAsset
{
	string getLocaleID();
}
// --- End of File: ILocalizedAsset.cs ---



// --- Start of File: ImageRotator.cs ---
using UnityEngine;

public class ImageRotator : MonoBehaviour
{
	public float rotation_speed = 70f;

	private void Update()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		((Component)this).transform.Rotate(Vector3.forward * rotation_speed * Time.deltaTime, (Space)1);
	}
}
// --- End of File: ImageRotator.cs ---



// --- Start of File: IMetaObject.cs ---
using System.Collections.Generic;
using UnityEngine;

public interface IMetaObject : ICoreObject
{
	int getMaxPossibleLifespan()
	{
		int num = 0;
		int num2 = 0;
		foreach (Actor unit in getUnits())
		{
			int num3 = (int)unit.stats["lifespan"];
			if (num3 > num2)
			{
				num2 = num3;
			}
			num++;
		}
		if (num == 0)
		{
			return 100;
		}
		return num2;
	}

	float getRatioAdults()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAdult())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioMales()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isSexMale())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioFemales()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isSexFemale())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioChildren()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (!unit.isAdult())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioHoused()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.hasHouse())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioHomeless()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (!unit.hasHouse())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioHungry()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isHungry())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioStarving()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isStarving())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioSick()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isSick())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioHappy()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isHappy())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	float getRatioUnhappy()
	{
		int num = 0;
		float num2 = 0f;
		foreach (Actor unit in getUnits())
		{
			if (unit.isUnhappy())
			{
				num2 += 1f;
			}
			num++;
		}
		if (num <= 0)
		{
			return 0f;
		}
		return num2 / (float)num;
	}

	MetaTypeAsset getMetaTypeAsset();

	bool hasUnits();

	int countUnits();

	IEnumerable<Actor> getUnits();

	Actor getRandomUnit();

	Actor getRandomActorForReaper();

	int countFamilies();

	IEnumerable<Family> getFamilies();

	bool hasFamilies();

	ActorAsset getActorAsset();

	Sprite getSpriteIcon();

	bool isCursorOver();

	void setCursorOver();

	ColorAsset getColor();

	MetaObjectData getMetaData();

	int getRenown();

	int getPopulationPeople();

	long getTotalKills();

	long getTotalDeaths();

	bool isSelected();

	Actor getOldestVisibleUnit();

	Actor getOldestVisibleUnitForNameplatesCached();

	bool hasCities();

	IEnumerable<City> getCities();

	bool hasKingdoms();

	IEnumerable<Kingdom> getKingdoms();

	bool hasDied();
}
// --- End of File: IMetaObject.cs ---



// --- Start of File: IMetaWindow.cs ---
public interface IMetaWindow
{
	ICoreObject getCoreObject();
}
// --- End of File: IMetaWindow.cs ---



// --- Start of File: IMetaWithFamiliesWindow.cs ---
using System.Collections.Generic;

public interface IMetaWithFamiliesWindow
{
	IEnumerable<Family> getFamilies();

	bool hasFamilies();
}
// --- End of File: IMetaWithFamiliesWindow.cs ---



// --- Start of File: ImpulseReachResult.cs ---
public enum ImpulseReachResult
{
	Done,
	Split,
	Move
}
// --- End of File: ImpulseReachResult.cs ---



// --- Start of File: IMultiLocalesAsset.cs ---
using System.Collections.Generic;

public interface IMultiLocalesAsset
{
	IEnumerable<string> getLocaleIDs();
}
// --- End of File: IMultiLocalesAsset.cs ---



// --- Start of File: InAppManager.cs ---
using System;
using System.Runtime.CompilerServices;
using Beebyte.Obfuscator;
using UnityEngine;
using UnityEngine.Purchasing;
using UnityEngine.Purchasing.Extension;
using UnityEngine.Purchasing.Security;

[ObfuscateLiterals]
public class InAppManager : MonoBehaviour, IDetailedStoreListener, IStoreListener
{
	public static InAppManager instance;

	private static bool _initialized = false;

	private IAppleExtensions _apple;

	private IGooglePlayStoreExtensions _googleplay;

	internal IStoreController controller;

	private IExtensionProvider extensions;

	internal static CrossPlatformValidator validator;

	public static bool last_availableToPurchase;

	public static string last_transactionID;

	public static bool last_hasReceipt;

	public static bool last_tValidPurchase;

	public static bool last_tPurchasePending;

	internal static bool googleAccount = true;

	private static ConfigurationBuilder _builder;

	public static bool restore_ui_buffering;

	public static string restore_message;

	public static string validator_message;

	private IAppleExtensions apple
	{
		get
		{
			if (_apple == null)
			{
				_apple = extensions.GetExtension<IAppleExtensions>();
			}
			return _apple;
		}
	}

	private IGooglePlayStoreExtensions googleplay
	{
		get
		{
			if (_googleplay == null)
			{
				_googleplay = extensions.GetExtension<IGooglePlayStoreExtensions>();
			}
			return _googleplay;
		}
	}

	private void Start()
	{
		Debug.Log((object)"InAppManager::Start");
		if ((Object)(object)instance != (Object)null)
		{
			Debug.LogError((object)"Multiple in-app managers have been instantiated.");
			return;
		}
		instance = this;
		if (PlayerConfig.instance == null || PlayerConfig.instance.data.pPossible0507)
		{
			activatePrem();
			Debug.Log((object)"InAppManager::End");
		}
	}

	private static bool checkGoogleAccount()
	{
		if (!googleAccount)
		{
			Debug.Log((object)"google account missing");
			ErrorWindow.errorMessage = "A Google Account is missing or you're not logged in with one.";
			ScrollWindow.get("error_with_reason").clickShow();
		}
		return googleAccount;
	}

	private static void debugPremium()
	{
	}

	private void InitializePurchasing(int pWhere = -1)
	{
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Expected O, but got Unknown
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Expected O, but got Unknown
		Debug.Log((object)$"InitializePurchasing {pWhere}");
		if (!IsInitialized() && !_initialized)
		{
			_initialized = true;
			instance = this;
			_builder = ConfigurationBuilder.Instance((IPurchasingModule)(object)StandardPurchasingModule.Instance(), Array.Empty<IPurchasingModule>());
			_builder.logUnavailableProducts = true;
			ConfigurationBuilder builder = _builder;
			IDs val = new IDs();
			val.Add("premium", new string[1] { "GooglePlay" });
			val.Add("premium", new string[1] { "AppleAppStore" });
			builder.AddProduct("premium", (ProductType)1, val);
			try
			{
				validator = new CrossPlatformValidator(GooglePlayTangle.Data(), AppleTangle.Data(), Application.identifier);
				Debug.Log((object)"validator assigned");
				validator_message = null;
			}
			catch (NotImplementedException ex)
			{
				Debug.Log((object)"validator not assigned");
				Debug.LogError((object)("Cross Platform Validator Not Implemented: " + ex.Message));
				validator_message = "Validator not implemented";
			}
			catch (Exception ex2)
			{
				Debug.Log((object)"validator not assigned");
				Debug.LogError((object)("Validator Exception: " + ex2.Message));
				validator_message = ex2.Message;
			}
			UnityPurchasing.Initialize((IDetailedStoreListener)(object)this, _builder);
		}
	}

	public void OnInitialized(IStoreController controller, IExtensionProvider extensions)
	{
		this.controller = controller;
		this.extensions = extensions;
		apple.RegisterPurchaseDeferredListener((Action<Product>)OnAskToBuy);
		checkPremium();
		checkWorldnet();
		Discounts.checkDiscounts();
	}

	public void checkPremium()
	{
		bool flag = true;
		bool flag2 = false;
		Product val = controller.products.WithID("premium");
		Debug.Log((object)"[cp]");
		Debug.Log((object)("[avl] " + val.availableToPurchase));
		Debug.Log((object)("[txi] " + val.transactionID));
		Debug.Log((object)("[hrc] " + val.hasReceipt));
		last_tValidPurchase = flag;
		last_tPurchasePending = flag2;
		Config.lockGameControls = false;
		if (!flag && flag2)
		{
			Debug.Log((object)"[nvp] pp");
			return;
		}
		Debug.Log((object)("[vp] 3 " + flag));
		Debug.Log((object)("[hr] " + val.hasReceipt));
		if ((flag && val.hasReceipt) || PlayerConfig.instance.data.premium)
		{
			Debug.Log((object)"[phr]");
			activatePrem();
		}
		else
		{
			Debug.Log((object)("[vp] 4 " + flag));
			Debug.Log((object)("[hr] " + val.hasReceipt));
			Debug.Log((object)("[hp] " + PlayerConfig.instance.data.premium));
		}
		Debug.Log((object)"[cpd]");
	}

	public void checkWorldnet()
	{
	}

	public static void consumePremium()
	{
	}

	private void OnAskToBuy(Product item)
	{
		Debug.Log((object)("Purchase deferred: " + item.definition.id));
		Config.lockGameControls = false;
	}

	public string getDebugInfo()
	{
		Product val = controller.products.WithID("premium");
		return string.Concat(string.Concat("" + "hasReceipt: " + val.hasReceipt, "\nreceipt: ", val.receipt), "\nprem? ", PlayerConfig.instance.data.premium.ToString());
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	internal static void activatePrem(bool pShowWindowUnlocked = false)
	{
		Debug.Log((object)"[ap]");
		PlayerConfig.instance.data.premium = true;
		PlayerConfig.saveData();
		Config.hasPremium = true;
		PremiumElementsChecker.checkElements();
		PlayerConfig.setFirebaseProp("have_premium", "yes");
		if (pShowWindowUnlocked)
		{
			if (!PlayerConfig.instance.data.tutorialFinished)
			{
				ScrollWindow.queueWindow("premium_unlocked");
			}
			else
			{
				ScrollWindow.hideAllEvent(pWithAnimation: false);
				ScrollWindow.showWindow("premium_unlocked");
			}
		}
		debugPremium();
	}

	private void activateSub(bool pShowWindowUnlocked = false)
	{
		if (pShowWindowUnlocked && PlayerConfig.instance.data.tutorialFinished)
		{
			ScrollWindow.hideAllEvent(pWithAnimation: false);
			ScrollWindow.showWindow("worldnet_sub");
		}
	}

	public void OnInitializeFailed(InitializationFailureReason error)
	{
		Debug.Log((object)("Cannot initialize IAP system: " + ((object)(InitializationFailureReason)(ref error)).ToString()));
		Config.lockGameControls = false;
	}

	public void OnInitializeFailed(InitializationFailureReason error, string message)
	{
		Debug.Log((object)("Cannot initialize IAP system: " + ((object)(InitializationFailureReason)(ref error)).ToString()));
		Debug.Log((object)message);
		Config.lockGameControls = false;
	}

	public PurchaseProcessingResult ProcessPurchase(PurchaseEventArgs args)
	{
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		Config.lockGameControls = true;
		object obj;
		if (args == null)
		{
			obj = null;
		}
		else
		{
			Product purchasedProduct = args.purchasedProduct;
			if (purchasedProduct == null)
			{
				obj = null;
			}
			else
			{
				ProductDefinition definition = purchasedProduct.definition;
				obj = ((definition != null) ? definition.id : null);
			}
		}
		Debug.Log((object)("Purchase OK: " + (string?)obj));
		Debug.Log((object)("Args: " + (object)((args != null) ? args.purchasedProduct : null)));
		object obj2;
		if (args == null)
		{
			obj2 = null;
		}
		else
		{
			Product purchasedProduct2 = args.purchasedProduct;
			if (purchasedProduct2 == null)
			{
				obj2 = null;
			}
			else
			{
				ProductDefinition definition2 = purchasedProduct2.definition;
				obj2 = ((definition2 != null) ? definition2.id : null);
			}
		}
		if ((string?)obj2 == "premium")
		{
			Debug.Log((object)"[pp] process premium");
			return ProcessPremium(args);
		}
		object obj3;
		if (args == null)
		{
			obj3 = null;
		}
		else
		{
			Product purchasedProduct3 = args.purchasedProduct;
			if (purchasedProduct3 == null)
			{
				obj3 = null;
			}
			else
			{
				ProductDefinition definition3 = purchasedProduct3.definition;
				obj3 = ((definition3 != null) ? definition3.id : null);
			}
		}
		if ((string?)obj3 == "worldnet")
		{
			Debug.Log((object)"[pw] process worldnet");
			return ProcessWorldnet(args);
		}
		Debug.Log((object)"[pn] process nothing to be done");
		return (PurchaseProcessingResult)0;
	}

	public PurchaseProcessingResult ProcessPremium(PurchaseEventArgs args)
	{
		bool flag = true;
		bool flag2 = false;
		Debug.Log((object)"[prp]");
		if (!flag && flag2)
		{
			Debug.Log((object)"[np] 3");
			Config.lockGameControls = false;
			return (PurchaseProcessingResult)1;
		}
		object obj;
		if (args == null)
		{
			obj = null;
		}
		else
		{
			Product purchasedProduct = args.purchasedProduct;
			if (purchasedProduct == null)
			{
				obj = null;
			}
			else
			{
				ProductDefinition definition = purchasedProduct.definition;
				obj = ((definition != null) ? definition.id : null);
			}
		}
		string text = (string)obj;
		Debug.Log((object)("[vp] 2 " + flag));
		Debug.Log((object)("[lc] " + text));
		if (flag && string.Equals(text, "premium", StringComparison.OrdinalIgnoreCase))
		{
			activatePrem(pShowWindowUnlocked: true);
			Debug.Log((object)$"[ppp] '{text}'");
		}
		else
		{
			Debug.Log((object)"[np] 4");
		}
		Config.lockGameControls = false;
		debugPremium();
		return (PurchaseProcessingResult)0;
	}

	public PurchaseProcessingResult ProcessWorldnet(PurchaseEventArgs args)
	{
		bool flag = true;
		bool flag2 = false;
		PlayerConfig.instance.data.worldnet = "";
		if (!flag && flag2)
		{
			Debug.Log((object)"purchase pending");
			Config.lockGameControls = false;
			return (PurchaseProcessingResult)1;
		}
		Debug.Log((object)"check if valid");
		Config.lockGameControls = false;
		if (flag && string.Equals(args.purchasedProduct.definition.id, "worldnet", StringComparison.OrdinalIgnoreCase))
		{
			Debug.Log((object)"valid!");
			setWorldnetSubscription(args.purchasedProduct.transactionID);
			activateSub(pShowWindowUnlocked: true);
			Debug.Log((object)$"ProcessPurchase: PASS. Product: '{args.purchasedProduct.definition.id}'");
		}
		Debug.Log((object)"we are here");
		if (Config.lockGameControls)
		{
			Debug.Log((object)"lockgamecontrosl locked");
		}
		else
		{
			Debug.Log((object)"lockgamecontrosl not locked");
		}
		return (PurchaseProcessingResult)0;
	}

	public void setWorldnetSubscription(string pTransactionID)
	{
		PlayerConfig.instance.data.worldnet = pTransactionID;
		PlayerConfig.saveData();
	}

	public void OnPurchaseFailed(Product i, PurchaseFailureReason p)
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		Debug.Log((object)("[D] WORLDBOX PURCHASE FAILED  " + ((object)(PurchaseFailureReason)(ref p)).ToString()));
		Config.lockGameControls = false;
		_ = 4;
		ScrollWindow.showWindow("premium_purchase_error");
		InitializePurchasing(50);
	}

	public void OnPurchaseFailed(Product i, PurchaseFailureDescription p)
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		Debug.Log((object)("[X] WORLDBOX PURCHASE FAILED  " + p.message));
		OnPurchaseFailed(i, p.reason);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	private static void checkPremiumReceipt(string pReceipt, ref bool validPurchase, ref bool purchasePending)
	{
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	private static void checkWorldnetReceipt(string pReceipt, ref bool validPurchase, ref bool purchasePending)
	{
	}

	public bool buyPremium()
	{
		activatePrem(pShowWindowUnlocked: true);
		Config.lockGameControls = false;
		return true;
	}

	public bool buyWorldNet()
	{
		return false;
	}

	private bool BuyProductID(string productId)
	{
		if (IsInitialized())
		{
			Product val = controller.products.WithID(productId);
			if (val == null)
			{
				return false;
			}
			if (val.availableToPurchase)
			{
				Debug.Log((object)$"Purchasing product asychronously: '{val.definition.id}'");
				Config.lockGameControls = true;
				controller.InitiatePurchase(val);
				if (ScrollWindow.windowLoaded("premium_menu") && ScrollWindow.isCurrentWindow("premium_menu"))
				{
					ScrollWindow.get("premium_menu").clickHide();
				}
				return true;
			}
			ScrollWindow.showWindow(productId + "_purchase_error");
			Debug.Log((object)"BuyProductID: FAIL. Not purchasing product, either is not found or is not available for purchase");
			Config.lockGameControls = false;
			return false;
		}
		ScrollWindow.showWindow(productId + "_purchase_error");
		Debug.Log((object)"BuyProductID FAIL. Not initialized.");
		Config.lockGameControls = false;
		return false;
	}

	public void RestorePurchases()
	{
		restore_message = "Restoring...";
		restore_ui_buffering = true;
		if (Config.isEditor)
		{
			restore_ui_buffering = false;
		}
		if (!IsInitialized())
		{
			InitializePurchasing(66);
			Debug.Log((object)"RestorePurchases FAIL. Not initialized.");
			restore_message = "IAP not initialized, failed to restore purchases.";
		}
	}

	private bool IsInitialized()
	{
		if (controller != null)
		{
			return extensions != null;
		}
		return false;
	}
}
// --- End of File: InAppManager.cs ---



// --- Start of File: InfoText.cs ---
using UnityEngine;

public class InfoText : MonoBehaviour
{
	public TextMesh text;

	public TextMesh shadow;

	private void Start()
	{
		((Component)text).gameObject.GetComponent<Renderer>().sortingOrder = 1000;
		((Component)shadow).gameObject.GetComponent<Renderer>().sortingOrder = 999;
	}

	public void setText(string pText)
	{
		text.text = pText;
		shadow.text = pText;
	}
}
// --- End of File: InfoText.cs ---



// --- Start of File: InitAds.cs ---
public static class InitAds
{
	private static bool initiated;

	public static void initAdProviders()
	{
		if (!Config.adsInitialized && !initiated)
		{
			initiated = true;
		}
	}
}
// --- End of File: InitAds.cs ---



// --- Start of File: InitLibraries.cs ---
using System;
using UnityEngine;

public class InitLibraries : MonoBehaviour
{
	public static bool initiated;

	public static bool initiated_main;

	private void Awake()
	{
		initLibs();
	}

	public static void initMainLibs()
	{
		if (initiated_main)
		{
			return;
		}
		initiated_main = true;
		try
		{
			Config.gv = Application.version;
			Config.iname = Application.installerName;
		}
		catch (Exception ex)
		{
			Debug.LogError((object)ex);
		}
		try
		{
			if (Application.genuineCheckAvailable)
			{
				Config.gen = Application.genuine;
			}
		}
		catch (Exception)
		{
			Config.gen = null;
		}
		LogHandler.init();
		AssetManager.initMain();
		GameProgress.init();
		PlayerConfig.init();
		LocalizedTextManager.init();
	}

	private void initLibs()
	{
		if (!initiated)
		{
			initiated = true;
			LogText.log("InitLibraries " + Config.gv, "initLibs", "st");
			DebugConfig.init();
			initMainLibs();
			AssetManager.init();
			DebugConfig.checkSonicTimeScales();
			NameGenerator.init();
			LogText.log("InitLibraries", "initLibs", "en");
		}
	}
}
// --- End of File: InitLibraries.cs ---



// --- Start of File: InitStuff.cs ---
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Firebase;
using Firebase.Analytics;
using Firebase.Extensions;
using Proyecto26;
using UnityEngine;
using db;

public class InitStuff : MonoBehaviour
{
	private static bool initiated = false;

	private static bool restinitiated = false;

	private float elapsedSeconds;

	public static float targetSeconds = 900f;

	private float checkInitTimeOut = 1f;

	private float servicesInitTimeOut = 3f;

	private float adsInitTimeOut = 8f;

	private void Start()
	{
		ThreadHelper.Initialize();
		initDB();
		initSteam();
	}

	public static void initRest()
	{
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		if (restinitiated)
		{
			return;
		}
		restinitiated = true;
		try
		{
			RestClient.DefaultRequestHeaders["salt"] = RequestHelper.salt ?? "na";
			RestClient.DefaultRequestHeaders["wb-version"] = Application.version ?? "na";
			RestClient.DefaultRequestHeaders["wb-identifier"] = Application.identifier ?? "na";
			Dictionary<string, string> defaultRequestHeaders = RestClient.DefaultRequestHeaders;
			RuntimePlatform platform = Application.platform;
			defaultRequestHeaders["wb-platform"] = ((object)(RuntimePlatform)(ref platform)).ToString() ?? "na";
			RestClient.DefaultRequestHeaders["wb-language"] = LocalizedTextManager.instance.language ?? "na";
			RestClient.DefaultRequestHeaders["wb-prem"] = (Config.hasPremium ? "y" : "n");
			RestClient.DefaultRequestHeaders["wb-build"] = Config.versionCodeText ?? "na";
			RestClient.DefaultRequestHeaders["wb-gen"] = ((!Config.gen.HasValue) ? "na" : (Config.gen.Value ? "y" : "n"));
			RestClient.DefaultRequestHeaders["wb-git"] = Config.gitCodeText ?? "na";
		}
		catch (Exception ex)
		{
			Debug.Log((object)"RestClient initialization Error");
			Debug.Log((object)ex.Message);
		}
	}

	public static void initOnlineServices()
	{
		if (initiated)
		{
			return;
		}
		initiated = true;
		if (Config.isEditor)
		{
			return;
		}
		try
		{
			if (Config.firebaseEnabled)
			{
				initFirebase();
			}
		}
		catch (Exception ex)
		{
			Debug.Log((object)"Firebase Init Error");
			Debug.Log((object)ex.Message);
		}
		try
		{
			VersionCheck.checkVersion();
		}
		catch (Exception ex2)
		{
			Debug.Log((object)"Version Error");
			Debug.Log((object)ex2.Message);
		}
		initRichPresence();
	}

	private void Update()
	{
		if (checkInitTimeOut > 0f)
		{
			checkInitTimeOut -= Time.fixedDeltaTime;
			if (checkInitTimeOut < 0f)
			{
				if (Config.firebaseEnabled)
				{
					if (!Config.firebaseChecked)
					{
						try
						{
							checkFirebase();
						}
						catch (Exception ex)
						{
							Debug.Log((object)"Firebase Check Error");
							Debug.Log((object)ex.Message);
						}
					}
				}
				else
				{
					Config.firebaseChecked = true;
				}
			}
		}
		if (!Config.firebaseChecked)
		{
			return;
		}
		if (!restinitiated)
		{
			initRest();
		}
		if (servicesInitTimeOut > 0f)
		{
			servicesInitTimeOut -= Time.fixedDeltaTime;
			if (servicesInitTimeOut < 0f)
			{
				initOnlineServices();
			}
		}
		if (Config.firebaseInitiating)
		{
			return;
		}
		if (adsInitTimeOut > 0f)
		{
			adsInitTimeOut -= Time.fixedDeltaTime;
			if (adsInitTimeOut < 0f)
			{
				InitAds.initAdProviders();
			}
		}
		if (elapsedSeconds <= targetSeconds)
		{
			elapsedSeconds += Time.deltaTime;
			return;
		}
		elapsedSeconds = 0f;
		try
		{
			if (Config.hasPremium || targetSeconds != 900f)
			{
				VersionCheck.checkVersion();
			}
		}
		catch (Exception)
		{
		}
	}

	private static void checkFirebase()
	{
		Debug.Log((object)"Firebase Starting Check");
		Config.firebaseChecked = false;
		TaskExtension.ContinueWithOnMainThread<DependencyStatus>(FirebaseApp.CheckDependenciesAsync(), (Action<Task<DependencyStatus>>)delegate(Task<DependencyStatus> pTask)
		{
			//IL_0011: Unknown result type (might be due to invalid IL or missing references)
			//IL_0016: Unknown result type (might be due to invalid IL or missing references)
			Debug.Log((object)"Firebase check continuing on thread");
			DependencyStatus dependencyStatus = pTask.Result;
			ThreadHelper.ExecuteInUpdate(delegate
			{
				//IL_000b: Unknown result type (might be due to invalid IL or missing references)
				//IL_0039: Unknown result type (might be due to invalid IL or missing references)
				//IL_001d: Unknown result type (might be due to invalid IL or missing references)
				Debug.Log((object)"Firebase check status");
				if ((int)dependencyStatus != 0)
				{
					Debug.Log((object)"Firebase is not available");
					Debug.Log((object)dependencyStatus);
				}
				else
				{
					Debug.Log((object)"Firebase is available");
					Debug.Log((object)dependencyStatus);
				}
				Config.firebaseChecked = true;
			});
		});
	}

	private static void initFirebase()
	{
		Debug.Log((object)"Firebase init");
		Config.firebaseInitiating = true;
		TaskExtension.ContinueWithOnMainThread<DependencyStatus>(FirebaseApp.CheckAndFixDependenciesAsync(), (Action<Task<DependencyStatus>>)delegate(Task<DependencyStatus> pTask)
		{
			//IL_0011: Unknown result type (might be due to invalid IL or missing references)
			//IL_0016: Unknown result type (might be due to invalid IL or missing references)
			//IL_001c: Unknown result type (might be due to invalid IL or missing references)
			Debug.Log((object)"Firebase init continuing on thread");
			DependencyStatus dependencyStatus = pTask.Result;
			Debug.Log((object)dependencyStatus);
			ThreadHelper.ExecuteInUpdate(delegate
			{
				//IL_000b: Unknown result type (might be due to invalid IL or missing references)
				//IL_007f: Unknown result type (might be due to invalid IL or missing references)
				Debug.Log((object)"Firebase task status");
				if ((int)dependencyStatus == 0)
				{
					try
					{
						Config.firebaseInitiating = false;
						Config.firebase_available = true;
						FirebaseAnalytics.LogEvent(FirebaseAnalytics.EventLogin);
						Debug.Log((object)"Firebase loaded");
						FirebaseAnalytics.LogEvent("data", "installerName", Config.iname ?? "");
						return;
					}
					catch (Exception ex)
					{
						Debug.Log((object)"Firebase Error");
						Debug.Log((object)ex.Message);
						Config.authEnabled = false;
						Config.firebase_available = false;
						Config.firebaseInitiating = false;
						return;
					}
				}
				Debug.Log((object)$"Could not resolve all Firebase dependencies: {dependencyStatus}");
				Config.authEnabled = false;
				Config.firebase_available = false;
			});
		});
	}

	private static void initDB()
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Expected O, but got Unknown
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		GameObject val = new GameObject("DB")
		{
			hideFlags = (HideFlags)52
		};
		Object.DontDestroyOnLoad((Object)val);
		val.AddComponent<DBManager>();
		val.transform.SetParent(GameObject.Find("Services").transform);
	}

	private static void initRichPresence()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Expected O, but got Unknown
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		if (!Config.disable_steam || !Config.disable_discord)
		{
			GameObject val = new GameObject("PowerTracker")
			{
				hideFlags = (HideFlags)52
			};
			Object.DontDestroyOnLoad((Object)val);
			val.AddComponent<PowerTracker>();
			val.transform.SetParent(GameObject.Find("Services").transform);
		}
	}

	internal static void initSteam()
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Expected O, but got Unknown
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		if (!Config.disable_steam)
		{
			GameObject val = new GameObject("Steam")
			{
				hideFlags = (HideFlags)52
			};
			Object.DontDestroyOnLoad((Object)val);
			val.AddComponent<SteamSDK>();
			val.transform.SetParent(GameObject.Find("Services").transform);
			SteamAchievements.InitAchievements();
		}
	}
}
// --- End of File: InitStuff.cs ---



// --- Start of File: InputHelpers.cs ---
using UnityEngine;

public static class InputHelpers
{
	public static bool touchSupported => Input.touchSupported;

	public static int touchCount => Input.touchCount;

	public static bool mouseSupported
	{
		get
		{
			if (Input.mousePresent)
			{
				if (Input.touchSupported)
				{
					return Input.touchCount == 0;
				}
				return true;
			}
			return false;
		}
	}

	public static bool GetMouseButtonDown(int pButton)
	{
		if (pButton == -1)
		{
			return false;
		}
		return Input.GetMouseButtonDown(pButton);
	}

	public static bool GetAnyMouseButtonDown()
	{
		if (!Input.GetMouseButtonDown(0) && !Input.GetMouseButtonDown(1))
		{
			return Input.GetMouseButtonDown(2);
		}
		return true;
	}

	public static int GetAnyMouseButtonDownIndex()
	{
		if (Input.GetMouseButtonDown(0))
		{
			return 0;
		}
		if (Input.GetMouseButtonDown(1))
		{
			return 1;
		}
		if (Input.GetMouseButtonDown(2))
		{
			return 2;
		}
		return -1;
	}

	public static bool GetMouseButton(int pButton)
	{
		if (pButton == -1)
		{
			return false;
		}
		return Input.GetMouseButton(pButton);
	}

	public static bool GetAnyMouseButton()
	{
		if (!Input.GetMouseButton(0) && !Input.GetMouseButton(1))
		{
			return Input.GetMouseButton(2);
		}
		return true;
	}

	public static int GetAnyMouseButtonIndex()
	{
		if (Input.GetMouseButton(0))
		{
			return 0;
		}
		if (Input.GetMouseButton(1))
		{
			return 1;
		}
		if (Input.GetMouseButton(2))
		{
			return 2;
		}
		return -1;
	}

	public static bool GetMouseButtonUp(int pButton)
	{
		if (pButton == -1)
		{
			return false;
		}
		return Input.GetMouseButtonUp(pButton);
	}

	public static bool GetAnyMouseButtonUp()
	{
		if (!Input.GetMouseButtonUp(0) && !Input.GetMouseButtonUp(1))
		{
			return Input.GetMouseButtonUp(2);
		}
		return true;
	}

	public static int GetAnyMouseButtonUpIndex()
	{
		if (Input.GetMouseButtonUp(0))
		{
			return 0;
		}
		if (Input.GetMouseButtonUp(1))
		{
			return 1;
		}
		if (Input.GetMouseButtonUp(2))
		{
			return 2;
		}
		return -1;
	}
}
// --- End of File: InputHelpers.cs ---



// --- Start of File: InsultStringGenerator.cs ---
using System.Collections.Generic;

public static class InsultStringGenerator
{
	private static string[] _insult_characters_2 = new string[4] { "#", "%", "&", "@" };

	private static string[] _insult_characters = new string[5] { "!", "#", "%", "&", "@" };

	private static List<string> _cached_bad_strings = new List<string>();

	private static List<string> _cached_bad_connections_string = new List<string>();

	private const int MAX_HARMFUL_DNA_SEQUENCES = 30;

	private const int MAX_BAD_CONNECTION_STRINGS = 30;

	public static string getRandomText(int pMin = 4, int pMax = 9, bool pUseSameSizeSet = false)
	{
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		int num = Randy.randomInt(pMin, pMax);
		for (int i = 0; i < num; i++)
		{
			string value = (pUseSameSizeSet ? _insult_characters_2.GetRandom() : _insult_characters.GetRandom());
			stringBuilderPool.Append(value);
		}
		return stringBuilderPool.ToString();
	}

	public static string getDNASequenceBad()
	{
		string text;
		if (_cached_bad_strings.Count < 30)
		{
			using StringBuilderPool stringBuilderPool = new StringBuilderPool();
			for (int i = 0; i < 6; i++)
			{
				if (i > 0)
				{
					stringBuilderPool.Append(" ");
				}
				stringBuilderPool.Append(getRandomText(3, 3, pUseSameSizeSet: true));
			}
			text = stringBuilderPool.ToString();
			text = Toolbox.coloredString(text, "#B159FF");
			_cached_bad_strings.Add(text);
		}
		else
		{
			text = _cached_bad_strings.GetRandom();
		}
		return text;
	}

	public static string getBadConnectionString()
	{
		string randomText;
		if (_cached_bad_connections_string.Count < 30)
		{
			randomText = getRandomText(7, 7, pUseSameSizeSet: true);
			randomText = Toolbox.coloredString(randomText, "#B159FF");
			_cached_bad_connections_string.Add(randomText);
		}
		else
		{
			randomText = _cached_bad_connections_string.GetRandom();
		}
		return randomText;
	}
}
// --- End of File: InsultStringGenerator.cs ---



// --- Start of File: InterestingPeopleElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class InterestingPeopleElement : MonoBehaviour
{
	private ObjectPoolGenericMono<PrefabUnitElement> _pool_elements;

	[SerializeField]
	private PrefabUnitElement _element;

	[SerializeField]
	private Text _counter;

	[SerializeField]
	private Transform _grid;

	private void Awake()
	{
		_pool_elements = new ObjectPoolGenericMono<PrefabUnitElement>(_element, _grid);
		for (int i = 0; i < _grid.childCount; i++)
		{
			Object.DestroyImmediate((Object)(object)((Component)_grid.GetChild(i)).gameObject);
		}
	}

	public void show(Actor pActor, int pValue)
	{
		showMember(pActor);
		_counter.text = pValue.ToString();
	}

	private void showMember(Actor pActor)
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		PrefabUnitElement next = _pool_elements.getNext();
		((Component)next).transform.localScale = new Vector3(0.9f, 0.9f, 1f);
		next.show(pActor);
	}

	private void OnDisable()
	{
		_pool_elements.clear();
	}
}
// --- End of File: InterestingPeopleElement.cs ---



// --- Start of File: InterestingPeopleTab.cs ---
using System.Collections;
using System.Collections.Generic;
using DG.Tweening;
using UnityEngine;

public class InterestingPeopleTab : WindowMetaElementBase
{
	private const float TWEEN_DURATION = 0.15f;

	public InterestingPeopleElement most_kills;

	public InterestingPeopleElement most_children;

	public InterestingPeopleElement most_births;

	public InterestingPeopleElement oldest;

	public InterestingPeopleElement fastest;

	public InterestingPeopleElement strongest;

	public InterestingPeopleElement weakest;

	public InterestingPeopleElement smartest;

	public InterestingPeopleElement dumbest;

	public InterestingPeopleElement richest;

	public InterestingPeopleElement most_known;

	public InterestingPeopleElement biggest_level;

	public InterestingPeopleElement happiest;

	public InterestingPeopleElement saddest;

	public InterestingPeopleElement hungriest;

	public InterestingPeopleElement fullest;

	public InterestingPeopleElement youngest;

	public InterestingPeopleElement most_health;

	public InterestingPeopleElement lowest_health;

	private readonly List<Actor> _unit_most_kills = new List<Actor>();

	private readonly List<Actor> _unit_most_children = new List<Actor>();

	private readonly List<Actor> _unit_most_births = new List<Actor>();

	private readonly List<Actor> _unit_oldest = new List<Actor>();

	private readonly List<Actor> _unit_fastest = new List<Actor>();

	private readonly List<Actor> _unit_strongest = new List<Actor>();

	private readonly List<Actor> _unit_weakest = new List<Actor>();

	private readonly List<Actor> _unit_smartest = new List<Actor>();

	private readonly List<Actor> _unit_dumbest = new List<Actor>();

	private readonly List<Actor> _unit_richest = new List<Actor>();

	private readonly List<Actor> _unit_most_known = new List<Actor>();

	private readonly List<Actor> _unit_biggest_level = new List<Actor>();

	private readonly List<Actor> _unit_saddest = new List<Actor>();

	private readonly List<Actor> _unit_happiest = new List<Actor>();

	private readonly List<Actor> _unit_hungriest = new List<Actor>();

	private readonly List<Actor> _unit_fullest = new List<Actor>();

	private readonly List<Actor> _unit_youngest = new List<Actor>();

	private readonly List<Actor> _unit_most_health = new List<Actor>();

	private readonly List<Actor> _unit_lowest_health = new List<Actor>();

	private List<Actor>[] _all_unit_lists;

	private InterestingPeopleElement[] _all_elements;

	private IInterestingPeopleWindow _interesting_people_window;

	private List<Tweener> _tweeners = new List<Tweener>();

	protected override void Awake()
	{
		_interesting_people_window = ((Component)this).GetComponentInParent<IInterestingPeopleWindow>();
		_all_elements = new InterestingPeopleElement[19]
		{
			biggest_level, fastest, fullest, happiest, hungriest, most_births, most_children, most_kills, most_known, oldest,
			richest, saddest, smartest, dumbest, strongest, weakest, youngest, most_health, lowest_health
		};
		_all_unit_lists = new List<Actor>[19]
		{
			_unit_biggest_level, _unit_fastest, _unit_fullest, _unit_happiest, _unit_hungriest, _unit_most_births, _unit_most_children, _unit_most_kills, _unit_most_known, _unit_oldest,
			_unit_richest, _unit_saddest, _unit_smartest, _unit_dumbest, _unit_strongest, _unit_weakest, _unit_youngest, _unit_most_health, _unit_lowest_health
		};
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		IEnumerable<Actor> interestingUnitsList = _interesting_people_window.getInterestingUnitsList();
		return renderElements(interestingUnitsList);
	}

	private IEnumerator renderElements(IEnumerable<Actor> pList)
	{
		int tMaxKills = 1;
		int tMaxChildren = 1;
		int tMaxAge = 0;
		int tMinAge = int.MaxValue;
		int tMaxMoney = 1;
		int tMaxSpeed = 1;
		int tMaxDamage = 1;
		int tMinDamage = int.MaxValue;
		int tMaxIntelligence = 1;
		int tMinIntelligence = int.MaxValue;
		int num = 1;
		int tMaxLevel = 1;
		int tMinSad = -10;
		int tMaxHappy = 10;
		int tMinNutrition = 30;
		int tMaxNutrition = 60;
		int tMaxBirths = 1;
		int tMaxHealth = 1;
		int tMinHealth = int.MaxValue;
		using ListPool<Actor> tUnits = new ListPool<Actor>(pList);
		tUnits.RemoveAll((Actor tActor) => !tActor.isAlive() || tActor.asset.is_boat);
		tUnits.Sort(ListSorters.sortUnitByKills);
		tUnits.Sort(ListSorters.sortUnitByAgeOldFirst);
		foreach (ref Actor item in tUnits)
		{
			Actor current = item;
			if (current.data.kills > tMaxKills)
			{
				tMaxKills = current.data.kills;
				_unit_most_kills.Clear();
				_unit_most_kills.Add(current);
			}
			else if (current.data.kills == tMaxKills && _unit_most_kills.Count < 3)
			{
				_unit_most_kills.Add(current);
			}
			if (current.current_children_count > tMaxChildren)
			{
				tMaxChildren = current.current_children_count;
				_unit_most_children.Clear();
				_unit_most_children.Add(current);
			}
			else if (current.current_children_count == tMaxChildren && _unit_most_children.Count < 3)
			{
				_unit_most_children.Add(current);
			}
			if (current.data.births > tMaxBirths)
			{
				tMaxBirths = current.data.births;
				_unit_most_births.Clear();
				_unit_most_births.Add(current);
			}
			else if (current.data.births == tMaxBirths && _unit_most_births.Count < 3)
			{
				_unit_most_births.Add(current);
			}
			if (current.stats["speed"] > (float)tMaxSpeed)
			{
				tMaxSpeed = (int)current.stats["speed"];
				_unit_fastest.Clear();
				_unit_fastest.Add(current);
			}
			else if ((int)current.stats["speed"] == tMaxSpeed && _unit_fastest.Count < 3)
			{
				_unit_fastest.Add(current);
			}
			int health = current.getHealth();
			if (health > tMaxHealth)
			{
				tMaxHealth = health;
				_unit_most_health.Clear();
				_unit_most_health.Add(current);
			}
			else if (health == tMaxHealth && _unit_most_health.Count < 3)
			{
				_unit_most_health.Add(current);
			}
			if (health < tMinHealth)
			{
				tMinHealth = health;
				_unit_lowest_health.Clear();
				_unit_lowest_health.Add(current);
			}
			else if (health == tMinHealth && _unit_lowest_health.Count < 3)
			{
				_unit_lowest_health.Add(current);
			}
			int num2 = (int)current.stats["damage"];
			if (num2 > tMaxDamage)
			{
				tMaxDamage = num2;
				_unit_strongest.Clear();
				_unit_strongest.Add(current);
			}
			else if (num2 == tMaxDamage && _unit_strongest.Count < 3)
			{
				_unit_strongest.Add(current);
			}
			if (num2 < tMinDamage)
			{
				tMinDamage = num2;
				_unit_weakest.Clear();
				_unit_weakest.Add(current);
			}
			else if (num2 == tMinDamage && _unit_weakest.Count < 3)
			{
				_unit_weakest.Add(current);
			}
			int num3 = (int)current.stats["intelligence"];
			if (num3 > tMaxIntelligence)
			{
				tMaxIntelligence = num3;
				_unit_smartest.Clear();
				_unit_smartest.Add(current);
			}
			else if (num3 == tMaxIntelligence && _unit_smartest.Count < 3)
			{
				_unit_smartest.Add(current);
			}
			if (num3 < tMinIntelligence)
			{
				tMinIntelligence = num3;
				_unit_dumbest.Clear();
				_unit_dumbest.Add(current);
			}
			else if (num3 == tMinIntelligence && _unit_dumbest.Count < 3)
			{
				_unit_dumbest.Add(current);
			}
			if (current.money > tMaxMoney)
			{
				tMaxMoney = current.money;
				_unit_richest.Clear();
				_unit_richest.Add(current);
			}
			else if (current.money == tMaxMoney && _unit_richest.Count < 3)
			{
				_unit_richest.Add(current);
			}
			if (current.renown > num)
			{
				num = current.renown;
				_unit_most_known.Clear();
				_unit_most_known.Add(current);
			}
			else if (current.renown == num && _unit_most_known.Count < 3)
			{
				_unit_most_known.Add(current);
			}
			if (current.data.level > tMaxLevel)
			{
				tMaxLevel = current.data.level;
				_unit_biggest_level.Clear();
				_unit_biggest_level.Add(current);
			}
			else if (current.data.level == tMaxLevel && _unit_biggest_level.Count < 3)
			{
				_unit_biggest_level.Add(current);
			}
			if (current.hasEmotions())
			{
				int happiness = current.getHappiness();
				if (happiness > tMaxHappy)
				{
					tMaxHappy = happiness;
					_unit_happiest.Clear();
					_unit_happiest.Add(current);
				}
				else if (happiness == tMaxHappy && _unit_happiest.Count < 3)
				{
					_unit_happiest.Add(current);
				}
				if (happiness < tMinSad)
				{
					tMinSad = happiness;
					_unit_saddest.Clear();
					_unit_saddest.Add(current);
				}
				else if (happiness == tMinSad && _unit_saddest.Count < 3)
				{
					_unit_saddest.Add(current);
				}
			}
			int nutrition = current.data.nutrition;
			if (nutrition > tMaxNutrition)
			{
				tMaxNutrition = nutrition;
				_unit_fullest.Clear();
				_unit_fullest.Add(current);
			}
			else if (nutrition == tMaxNutrition && _unit_fullest.Count < 3)
			{
				_unit_fullest.Add(current);
			}
			if (nutrition < tMinNutrition)
			{
				tMinNutrition = nutrition;
				_unit_hungriest.Clear();
				_unit_hungriest.Add(current);
			}
			else if (nutrition == tMinNutrition && _unit_hungriest.Count < 3)
			{
				_unit_hungriest.Add(current);
			}
			int age = current.getAge();
			if (age > tMaxAge)
			{
				tMaxAge = age;
				_unit_oldest.Clear();
				_unit_oldest.Add(current);
			}
			else if (age == tMaxAge && _unit_oldest.Count < 3)
			{
				_unit_oldest.Add(current);
			}
			if (age < tMinAge)
			{
				tMinAge = age;
				_unit_youngest.Clear();
				_unit_youngest.Add(current);
			}
			else if (age == tMinAge && _unit_youngest.Count < 3)
			{
				_unit_youngest.Add(current);
			}
		}
		List<Actor>[] all_unit_lists = _all_unit_lists;
		foreach (List<Actor> collection in all_unit_lists)
		{
			track_objects.AddRange(collection);
		}
		yield return render(_unit_most_known, most_known, num);
		yield return render(_unit_biggest_level, biggest_level, tMaxLevel);
		yield return render(_unit_oldest, oldest, tMaxAge, 0);
		if (tMinAge != tMaxAge)
		{
			yield return render(_unit_youngest, youngest, tMinAge, 0);
		}
		yield return render(_unit_most_kills, most_kills, tMaxKills);
		yield return render(_unit_richest, richest, tMaxMoney);
		yield return render(_unit_most_children, most_children, tMaxChildren);
		yield return render(_unit_most_births, most_births, tMaxBirths);
		yield return render(_unit_happiest, happiest, tMaxHappy);
		yield return render(_unit_saddest, saddest, tMinSad, -1000);
		yield return render(_unit_hungriest, hungriest, tMinNutrition, 0);
		yield return render(_unit_fullest, fullest, tMaxNutrition);
		yield return render(_unit_smartest, smartest, tMaxIntelligence);
		yield return render(_unit_dumbest, dumbest, tMinIntelligence, -1000);
		yield return render(_unit_fastest, fastest, tMaxSpeed);
		yield return render(_unit_strongest, strongest, tMaxDamage);
		yield return render(_unit_weakest, weakest, tMinDamage, -1000);
		yield return render(_unit_most_health, most_health, tMaxHealth);
		if (tMinHealth != tMaxHealth)
		{
			yield return render(_unit_lowest_health, lowest_health, tMinHealth, 0);
		}
	}

	private IEnumerator render(List<Actor> pActor, InterestingPeopleElement pElement, int pValue, int pMinValue = 2)
	{
		if (pValue < pMinValue || pActor.Count == 0)
		{
			((Component)pElement).gameObject.SetActive(false);
			yield break;
		}
		((Component)pElement).gameObject.SetActive(true);
		foreach (Actor item in pActor)
		{
			if (item.isAlive())
			{
				pElement.show(item, pValue);
				yield return (object)new WaitForSecondsRealtime(0.025f);
			}
		}
	}

	private void finishTweens()
	{
		foreach (Tweener tweener in _tweeners)
		{
			TweenExtensions.Kill((Tween)(object)tweener, true);
		}
		_tweeners.Clear();
	}

	protected override void clear()
	{
		base.clear();
		finishTweens();
		InterestingPeopleElement[] all_elements = _all_elements;
		for (int i = 0; i < all_elements.Length; i++)
		{
			((Component)all_elements[i]).gameObject.SetActive(false);
		}
		List<Actor>[] all_unit_lists = _all_unit_lists;
		for (int i = 0; i < all_unit_lists.Length; i++)
		{
			all_unit_lists[i].Clear();
		}
	}
}
// --- End of File: InterestingPeopleTab.cs ---



// --- Start of File: IntervalHeap.cs ---
using System;
using System.Collections;
using System.Collections.Generic;
using C5;

namespace EpPathFinding.cs;

public class IntervalHeap<T> : CollectionValueBase<T>, IPriorityQueue<T>, IExtensible<T>, ICollectionValue<T>, IEnumerable<T>, IEnumerable, IShowable, IFormattable where T : class
{
	private struct Interval
	{
		internal T first;

		internal T last;

		public override string ToString()
		{
			return $"[{first}; {last}]";
		}
	}

	private class Handle : IPriorityQueueHandle<T>
	{
		internal int index = -1;

		public override string ToString()
		{
			return $"[{index}]";
		}
	}

	private int stamp;

	private readonly IComparer<T> comparer;

	private readonly IEqualityComparer<T> itemequalityComparer;

	private Interval[] heap;

	private int size;

	public override EventTypeEnum ListenableEvents => (EventTypeEnum)15;

	public IComparer<T> Comparer => comparer;

	public bool IsReadOnly => false;

	public bool AllowsDuplicates => true;

	public virtual IEqualityComparer<T> EqualityComparer => itemequalityComparer;

	public virtual bool DuplicatesByCounting => false;

	public override bool IsEmpty => size == 0;

	public override int Count => size;

	public override Speed CountSpeed => (Speed)4;

	public T this[IPriorityQueueHandle<T> handle]
	{
		get
		{
			CheckHandle(handle, out var cell, out var isfirst);
			if (!isfirst)
			{
				return heap[cell].last;
			}
			return heap[cell].first;
		}
		set
		{
			Replace(handle, value);
		}
	}

	private void SwapFirstWithLast(int cell1, int cell2)
	{
		T first = heap[cell1].first;
		UpdateFirst(cell1, heap[cell2].last);
		UpdateLast(cell2, first);
	}

	private void SwapLastWithLast(int cell1, int cell2)
	{
		T last = heap[cell2].last;
		UpdateLast(cell2, heap[cell1].last);
		UpdateLast(cell1, last);
	}

	private void SwapFirstWithFirst(int cell1, int cell2)
	{
		T first = heap[cell2].first;
		UpdateFirst(cell2, heap[cell1].first);
		UpdateFirst(cell1, first);
	}

	private bool HeapifyMin(int cell)
	{
		bool result = false;
		if (2 * cell + 1 < size && comparer.Compare(heap[cell].first, heap[cell].last) > 0)
		{
			result = true;
			SwapFirstWithLast(cell, cell);
		}
		int num = cell;
		int num2 = 2 * cell + 1;
		int num3 = num2 + 1;
		if (2 * num2 < size && comparer.Compare(heap[num2].first, heap[num].first) < 0)
		{
			num = num2;
		}
		if (2 * num3 < size && comparer.Compare(heap[num3].first, heap[num].first) < 0)
		{
			num = num3;
		}
		if (num != cell)
		{
			SwapFirstWithFirst(num, cell);
			HeapifyMin(num);
		}
		return result;
	}

	private bool HeapifyMax(int cell)
	{
		bool result = false;
		if (2 * cell + 1 < size && comparer.Compare(heap[cell].last, heap[cell].first) < 0)
		{
			result = true;
			SwapFirstWithLast(cell, cell);
		}
		int num = cell;
		int num2 = 2 * cell + 1;
		int num3 = num2 + 1;
		bool flag = false;
		if (2 * num2 + 1 < size)
		{
			if (comparer.Compare(heap[num2].last, heap[num].last) > 0)
			{
				num = num2;
			}
		}
		else if (2 * num2 + 1 == size && comparer.Compare(heap[num2].first, heap[num].last) > 0)
		{
			num = num2;
			flag = true;
		}
		if (2 * num3 + 1 < size)
		{
			if (comparer.Compare(heap[num3].last, heap[num].last) > 0)
			{
				num = num3;
			}
		}
		else if (2 * num3 + 1 == size && comparer.Compare(heap[num3].first, heap[num].last) > 0)
		{
			num = num3;
			flag = true;
		}
		if (num != cell)
		{
			if (flag)
			{
				SwapFirstWithLast(num, cell);
			}
			else
			{
				SwapLastWithLast(num, cell);
			}
			HeapifyMax(num);
		}
		return result;
	}

	private void BubbleUpMin(int i)
	{
		if (i > 0)
		{
			T first = heap[i].first;
			T val = first;
			_ = (i + 1) / 2;
			int num;
			while (i > 0 && comparer.Compare(val, first = heap[num = (i + 1) / 2 - 1].first) < 0)
			{
				UpdateFirst(i, first);
				i = num;
			}
			UpdateFirst(i, val);
		}
	}

	private void BubbleUpMax(int i)
	{
		if (i > 0)
		{
			T last = heap[i].last;
			T val = last;
			_ = (i + 1) / 2;
			int num;
			while (i > 0 && comparer.Compare(val, last = heap[num = (i + 1) / 2 - 1].last) > 0)
			{
				UpdateLast(i, last);
				i = num;
			}
			UpdateLast(i, val);
		}
	}

	public IntervalHeap()
		: this(16)
	{
	}

	public IntervalHeap(int capacity)
		: this(capacity, (IComparer<T>)Comparer<T>.Default, EqualityComparer<T>.Default)
	{
	}

	private IntervalHeap(int capacity, IComparer<T> comparer, IEqualityComparer<T> itemequalityComparer)
	{
		this.comparer = comparer ?? throw new NullReferenceException("Item comparer cannot be null");
		this.itemequalityComparer = itemequalityComparer ?? throw new NullReferenceException("Item equality comparer cannot be null");
		int num;
		for (num = 1; num < capacity; num <<= 1)
		{
		}
		heap = new Interval[num];
	}

	public T FindMin()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		if (size == 0)
		{
			throw new NoSuchItemException();
		}
		return heap[0].first;
	}

	public T DeleteMin()
	{
		IPriorityQueueHandle<T> handle;
		return DeleteMin(out handle);
	}

	public T FindMax()
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		if (size == 0)
		{
			throw new NoSuchItemException("Heap is empty");
		}
		if (size == 1)
		{
			return heap[0].first;
		}
		return heap[0].last;
	}

	public T DeleteMax()
	{
		IPriorityQueueHandle<T> handle;
		return DeleteMax(out handle);
	}

	public void Clear()
	{
		stamp++;
		if (size != 0)
		{
			int num = ((size % 2 == 0) ? (size / 2) : (size / 2 + 1));
			Interval[] array = heap;
			for (int i = 0; i < num; i++)
			{
				array[i].first = null;
				array[i].last = null;
			}
			size = 0;
		}
	}

	public bool Add(T item)
	{
		stamp++;
		if (add(item))
		{
			((CollectionValueBase<T>)this).raiseItemsAdded(item, 1);
			((CollectionValueBase<T>)this).raiseCollectionChanged();
			return true;
		}
		return false;
	}

	private bool add(T item)
	{
		if (size == 0)
		{
			size = 1;
			UpdateFirst(0, item);
			return true;
		}
		if (size == 2 * heap.Length)
		{
			Interval[] destinationArray = new Interval[2 * heap.Length];
			Array.Copy(heap, destinationArray, heap.Length);
			heap = destinationArray;
		}
		if (size % 2 == 0)
		{
			int num = size / 2;
			int num2 = (num + 1) / 2 - 1;
			T last = heap[num2].last;
			if (comparer.Compare(item, last) > 0)
			{
				UpdateFirst(num, last);
				UpdateLast(num2, item);
				BubbleUpMax(num2);
			}
			else
			{
				UpdateFirst(num, item);
				if (comparer.Compare(item, heap[num2].first) < 0)
				{
					BubbleUpMin(num);
				}
			}
		}
		else
		{
			int num3 = size / 2;
			T first = heap[num3].first;
			if (comparer.Compare(item, first) < 0)
			{
				UpdateLast(num3, first);
				UpdateFirst(num3, item);
				BubbleUpMin(num3);
			}
			else
			{
				UpdateLast(num3, item);
				BubbleUpMax(num3);
			}
		}
		size++;
		return true;
	}

	private void UpdateLast(int cell, T item)
	{
		heap[cell].last = item;
	}

	private void UpdateFirst(int cell, T item)
	{
		heap[cell].first = item;
	}

	public void AddAll(IEnumerable<T> items)
	{
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		stamp++;
		int num = size;
		foreach (T item in items)
		{
			add(item);
		}
		if (size == num)
		{
			return;
		}
		if ((((CollectionValueBase<T>)this).ActiveEvents & 4) != 0)
		{
			foreach (T item2 in items)
			{
				((CollectionValueBase<T>)this).raiseItemsAdded(item2, 1);
			}
		}
		((CollectionValueBase<T>)this).raiseCollectionChanged();
	}

	public override T Choose()
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		if (size == 0)
		{
			throw new NoSuchItemException("Collection is empty");
		}
		return heap[0].first;
	}

	public override IEnumerator<T> GetEnumerator()
	{
		int mystamp = stamp;
		for (int i = 0; i < size; i++)
		{
			if (mystamp != stamp)
			{
				throw new CollectionModifiedException();
			}
			yield return (i % 2 == 0) ? heap[i >> 1].first : heap[i >> 1].last;
		}
	}

	private bool Check(int i, T min, T max)
	{
		bool flag = true;
		Interval interval = heap[i];
		T first = interval.first;
		T last = interval.last;
		if (2 * i + 1 == size)
		{
			if (comparer.Compare(min, first) > 0)
			{
				Logger.Log($"Cell {i}: parent.first({min}) > first({first})  [size={size}]");
				flag = false;
			}
			if (comparer.Compare(first, max) > 0)
			{
				Logger.Log($"Cell {i}: first({first}) > parent.last({max})  [size={size}]");
				flag = false;
			}
			return flag;
		}
		if (comparer.Compare(min, first) > 0)
		{
			Logger.Log($"Cell {i}: parent.first({min}) > first({first})  [size={size}]");
			flag = false;
		}
		if (comparer.Compare(first, last) > 0)
		{
			Logger.Log($"Cell {i}: first({first}) > last({last})  [size={size}]");
			flag = false;
		}
		if (comparer.Compare(last, max) > 0)
		{
			Logger.Log($"Cell {i}: last({last}) > parent.last({max})  [size={size}]");
			flag = false;
		}
		int num = 2 * i + 1;
		int num2 = num + 1;
		if (2 * num < size)
		{
			flag = flag && Check(num, first, last);
		}
		if (2 * num2 < size)
		{
			flag = flag && Check(num2, first, last);
		}
		return flag;
	}

	public bool Check()
	{
		if (size == 0)
		{
			return true;
		}
		if (size == 1)
		{
			return heap[0].first != null;
		}
		return Check(0, heap[0].first, heap[0].last);
	}

	public bool Find(IPriorityQueueHandle<T> handle, out T item)
	{
		if (!(handle is Handle { index: var index } handle2))
		{
			item = null;
			return false;
		}
		int num = index / 2;
		bool flag = index % 2 == 0;
		if (index == -1 || index >= size)
		{
			item = null;
			return false;
		}
		if (null != handle2)
		{
			item = null;
			return false;
		}
		item = (flag ? heap[num].first : heap[num].last);
		return true;
	}

	public bool Add(ref IPriorityQueueHandle<T> handle, T item)
	{
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		stamp++;
		Handle handle2 = (Handle)handle;
		if (handle2 == null)
		{
			handle2 = (Handle)(handle = new Handle());
		}
		else if (handle2.index != -1)
		{
			throw new InvalidPriorityQueueHandleException("Handle not valid for reuse");
		}
		if (add(item))
		{
			((CollectionValueBase<T>)this).raiseItemsAdded(item, 1);
			((CollectionValueBase<T>)this).raiseCollectionChanged();
			return true;
		}
		return false;
	}

	public T Delete(IPriorityQueueHandle<T> handle)
	{
		stamp++;
		CheckHandle(handle, out var cell, out var isfirst).index = -1;
		int num = (size - 1) / 2;
		T val;
		if (cell == num)
		{
			if (isfirst)
			{
				val = heap[cell].first;
				if (size % 2 == 0)
				{
					UpdateFirst(cell, heap[cell].last);
					heap[cell].last = null;
				}
				else
				{
					heap[cell].first = null;
				}
			}
			else
			{
				val = heap[cell].last;
				heap[cell].last = null;
			}
			size--;
		}
		else if (isfirst)
		{
			val = heap[cell].first;
			if (size % 2 == 0)
			{
				UpdateFirst(cell, heap[num].last);
				heap[num].last = null;
			}
			else
			{
				UpdateFirst(cell, heap[num].first);
				heap[num].first = null;
			}
			size--;
			if (HeapifyMin(cell))
			{
				BubbleUpMax(cell);
			}
			else
			{
				BubbleUpMin(cell);
			}
		}
		else
		{
			val = heap[cell].last;
			if (size % 2 == 0)
			{
				UpdateLast(cell, heap[num].last);
				heap[num].last = null;
			}
			else
			{
				UpdateLast(cell, heap[num].first);
				heap[num].first = null;
			}
			size--;
			if (HeapifyMax(cell))
			{
				BubbleUpMin(cell);
			}
			else
			{
				BubbleUpMax(cell);
			}
		}
		((CollectionValueBase<T>)this).raiseItemsRemoved(val, 1);
		((CollectionValueBase<T>)this).raiseCollectionChanged();
		return val;
	}

	private Handle CheckHandle(IPriorityQueueHandle<T> handle, out int cell, out bool isfirst)
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		Handle handle2 = (Handle)handle;
		int index = handle2.index;
		cell = index / 2;
		isfirst = index % 2 == 0;
		if (index == -1 || index >= size)
		{
			throw new InvalidPriorityQueueHandleException("Invalid handle, index out of range");
		}
		if (null != handle2)
		{
			throw new InvalidPriorityQueueHandleException("Invalid handle, doesn't match queue");
		}
		return handle2;
	}

	public T Replace(IPriorityQueueHandle<T> handle, T item)
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		stamp++;
		CheckHandle(handle, out var cell, out var isfirst);
		if (size == 0)
		{
			throw new NoSuchItemException();
		}
		T val;
		if (isfirst)
		{
			val = heap[cell].first;
			heap[cell].first = item;
			if (size != 1)
			{
				if (size == 2 * cell + 1)
				{
					int num = (cell + 1) / 2 - 1;
					if (comparer.Compare(item, heap[num].last) > 0)
					{
						UpdateFirst(cell, heap[num].last);
						UpdateLast(num, item);
						BubbleUpMax(num);
					}
					else
					{
						BubbleUpMin(cell);
					}
				}
				else if (HeapifyMin(cell))
				{
					BubbleUpMax(cell);
				}
				else
				{
					BubbleUpMin(cell);
				}
			}
		}
		else
		{
			val = heap[cell].last;
			heap[cell].last = item;
			if (HeapifyMax(cell))
			{
				BubbleUpMin(cell);
			}
			else
			{
				BubbleUpMax(cell);
			}
		}
		((CollectionValueBase<T>)this).raiseItemsRemoved(val, 1);
		((CollectionValueBase<T>)this).raiseItemsAdded(item, 1);
		((CollectionValueBase<T>)this).raiseCollectionChanged();
		return val;
	}

	public T FindMin(out IPriorityQueueHandle<T> handle)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		if (size == 0)
		{
			throw new NoSuchItemException();
		}
		handle = null;
		return heap[0].first;
	}

	public T FindMax(out IPriorityQueueHandle<T> handle)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		if (size == 0)
		{
			throw new NoSuchItemException();
		}
		if (size == 1)
		{
			handle = null;
			return heap[0].first;
		}
		handle = null;
		return heap[0].last;
	}

	public T DeleteMin(out IPriorityQueueHandle<T> handle)
	{
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		stamp++;
		if (size == 0)
		{
			throw new NoSuchItemException();
		}
		T first = heap[0].first;
		handle = null;
		if (size == 1)
		{
			size = 0;
			heap[0].first = null;
		}
		else
		{
			int num = (size - 1) / 2;
			if (size % 2 == 0)
			{
				UpdateFirst(0, heap[num].last);
				heap[num].last = null;
			}
			else
			{
				UpdateFirst(0, heap[num].first);
				heap[num].first = null;
			}
			size--;
			HeapifyMin(0);
		}
		((CollectionValueBase<T>)this).raiseItemsRemoved(first, 1);
		((CollectionValueBase<T>)this).raiseCollectionChanged();
		return first;
	}

	public T DeleteMax(out IPriorityQueueHandle<T> handle)
	{
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		stamp++;
		if (size == 0)
		{
			throw new NoSuchItemException();
		}
		handle = null;
		T val;
		if (size == 1)
		{
			size = 0;
			val = heap[0].first;
			heap[0].first = null;
		}
		else
		{
			val = heap[0].last;
			int num = (size - 1) / 2;
			if (size % 2 == 0)
			{
				UpdateLast(0, heap[num].last);
				heap[num].last = null;
			}
			else
			{
				UpdateLast(0, heap[num].first);
				heap[num].first = null;
			}
			size--;
			HeapifyMax(0);
		}
		((CollectionValueBase<T>)this).raiseItemsRemoved(val, 1);
		((CollectionValueBase<T>)this).raiseCollectionChanged();
		return val;
	}
}
// --- End of File: IntervalHeap.cs ---



// --- Start of File: IntExtensions.cs ---
public static class IntExtensions
{
	private static readonly (int value, string symbol)[] _roman_number_map = new(int, string)[13]
	{
		(1000, "M"),
		(900, "CM"),
		(500, "D"),
		(400, "CD"),
		(100, "C"),
		(90, "XC"),
		(50, "L"),
		(40, "XL"),
		(10, "X"),
		(9, "IX"),
		(5, "V"),
		(4, "IV"),
		(1, "I")
	};

	public static string ToText(this int pInt)
	{
		return pInt.ToString("##,0.#");
	}

	public static string ToText(this long pLong)
	{
		return pLong.ToString("##,0.#");
	}

	public static string ToText(this float pFloat)
	{
		return pFloat.ToString("##,0.#");
	}

	public static string ToText(this double pDouble)
	{
		return pDouble.ToString("##,0.#");
	}

	public static string ToText(this int pInt, int pMaxLength)
	{
		return Toolbox.formatNumber(pInt, pMaxLength);
	}

	public static string ToText(this long pLong, int pMaxLength)
	{
		return Toolbox.formatNumber(pLong, pMaxLength);
	}

	public static string ToRoman(this int pNumber)
	{
		if (pNumber < 1)
		{
			return "N";
		}
		if (pNumber > 3999)
		{
			return "MMMM";
		}
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		(int, string)[] roman_number_map = _roman_number_map;
		for (int i = 0; i < roman_number_map.Length; i++)
		{
			var (num, value) = roman_number_map[i];
			while (pNumber >= num)
			{
				stringBuilderPool.Append(value);
				pNumber -= num;
			}
		}
		return stringBuilderPool.ToString();
	}
}
// --- End of File: IntExtensions.cs ---



// --- Start of File: IOSCheckTracking.cs ---
using UnityEngine;

public class IOSCheckTracking : MonoBehaviour
{
}
// --- End of File: IOSCheckTracking.cs ---



// --- Start of File: IPlotsEditor.cs ---
public interface IPlotsEditor : IAugmentationsEditor
{
}
// --- End of File: IPlotsEditor.cs ---



// --- Start of File: IPlotsWindow.cs ---
public interface IPlotsWindow : IAugmentationsWindow<IPlotsEditor>
{
}
// --- End of File: IPlotsWindow.cs ---



// --- Start of File: IRefreshElement.cs ---
public interface IRefreshElement
{
	void refresh();
}
// --- End of File: IRefreshElement.cs ---



// --- Start of File: IRichTracker.cs ---
public interface IRichTracker
{
	void trackViewing(string pText);

	void trackWatching();

	void trackUsing(string pPower);

	void updateUsing(int pAmount, string pPower);

	void inspectKingdom(string pKingdom);

	void inspectVillage(string pVillage);

	void inspectUnit(string pUnit);

	void spectatingUnit(string pUnit);

	void trackActivity(string pText);
}
// --- End of File: IRichTracker.cs ---



// --- Start of File: IronSourceInterstitialAd.cs ---
using System;
using Beebyte.Obfuscator;
using Unity.Services.LevelPlay;

[ObfuscateLiterals]
public class IronSourceInterstitialAd : IWorldBoxAd
{
	private const string LEVELPLAY_INTERSTITIAL = "none";

	private static string lastError = "";

	private static int loaded = 0;

	private static int failed = 0;

	private static bool _initialized = false;

	private static LevelPlayInterstitialAd _interstitial_ad;

	public Action<string> logger { get; set; }

	public Action adResetCallback { get; set; }

	public Action adFailedCallback { get; set; }

	public Action adFinishedCallback { get; set; }

	public Action adStartedCallback { get; set; }

	public void Reset()
	{
		failed = 0;
		loaded = 0;
		lastError = "";
	}

	public void RequestAd()
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Expected O, but got Unknown
		if (Config.isMobile && !Config.hasPremium && IronSourceMobileAdsLoader.initialized)
		{
			if (!_initialized)
			{
				_initialized = true;
				_interstitial_ad = new LevelPlayInterstitialAd("none");
				_interstitial_ad.OnAdLoaded += HandleOnAdReady;
				_interstitial_ad.OnAdLoadFailed += HandleOnAdFailedToLoad;
				_interstitial_ad.OnAdDisplayed += HandleOnAdOpened;
				_interstitial_ad.OnAdDisplayFailed += HandleOnAdFailedToShow;
				_interstitial_ad.OnAdClosed += HandleOnAdClosed;
			}
			KillAd();
			log("Requesting Ad");
			_interstitial_ad.LoadAd();
		}
	}

	public void HandleOnAdLoaded()
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Loaded");
		});
	}

	public void HandleOnAdFailedToLoad(LevelPlayAdError pLoadAdError)
	{
		string tLoadError = "Failed to load ad";
		if (pLoadAdError != null)
		{
			tLoadError = ((object)pLoadAdError).ToString();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded = 0;
			failed++;
			if (lastError != tLoadError)
			{
				log("<color=red>Ad Failed to Load: " + tLoadError + "</color>");
				lastError = tLoadError;
			}
			else
			{
				log("<color=red>Ad Failed to Load</color>");
			}
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
		});
	}

	public void HandleOnAdFailedToShow(LevelPlayAdDisplayInfoError pLoadAdInfoError)
	{
		_ = pLoadAdInfoError.DisplayLevelPlayAdInfo;
		LevelPlayAdError levelPlayError = pLoadAdInfoError.LevelPlayError;
		string tLoadError = "Failed to show ad";
		if (levelPlayError != null)
		{
			tLoadError = ((object)levelPlayError).ToString();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded = 0;
			failed++;
			if (lastError != tLoadError)
			{
				log("<color=red>Ad Failed to Show: " + tLoadError + "</color>");
				lastError = tLoadError;
			}
			else
			{
				log("<color=red>Ad Failed to Show</color>");
			}
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
		});
	}

	public void HandleOnAdReady(LevelPlayAdInfo pAdInfo)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Ready");
		});
	}

	public void HandleOnAdOpened(LevelPlayAdInfo pAdInfo)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Opened");
			if (adStartedCallback != null)
			{
				adStartedCallback();
			}
		});
	}

	public void HandleOnAdClosed(LevelPlayAdInfo pAdInfo)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Closed");
			KillAd();
			if (adFinishedCallback != null)
			{
				adFinishedCallback();
			}
		});
	}

	public void KillAd()
	{
	}

	public bool IsReady()
	{
		if (!IronSourceMobileAdsLoader.initialized)
		{
			return false;
		}
		LevelPlayInterstitialAd interstitial_ad = _interstitial_ad;
		if (interstitial_ad == null)
		{
			return false;
		}
		return interstitial_ad.IsAdReady();
	}

	public void ShowAd()
	{
		if (IsReady())
		{
			_interstitial_ad.ShowAd((string)null);
		}
	}

	public bool HasAd()
	{
		if (!IsInitialized())
		{
			return false;
		}
		LevelPlayInterstitialAd interstitial_ad = _interstitial_ad;
		if (interstitial_ad == null)
		{
			return false;
		}
		return interstitial_ad.IsAdReady();
	}

	public string GetProviderName()
	{
		return "IronSource Interstitial Ad";
	}

	public string GetColor()
	{
		return IronSourceMobileAdsLoader.GetColor();
	}

	private void log(string pLog)
	{
		logger(GetColor() + " " + pLog);
	}

	public bool IsInitialized()
	{
		return IronSourceMobileAdsLoader.initialized;
	}

	public void showAdInfo(LevelPlayAdInfo pAdInfo)
	{
	}
}
// --- End of File: IronSourceInterstitialAd.cs ---



// --- Start of File: IronSourceMobileAdsLoader.cs ---
using System;
using Beebyte.Obfuscator;
using Unity.Services.LevelPlay;
using UnityEngine;
using com.unity3d.mediation;

[ObfuscateLiterals]
public class IronSourceMobileAdsLoader : MonoBehaviour
{
	private const string APP_KEY = "unexpected_platform";

	private static IronSourceMobileAdsLoader instance;

	internal static bool initialized;

	public static void initAds()
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Expected O, but got Unknown
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)instance != (Object)null))
		{
			GameObject val = new GameObject("IronSourceMobileAdsLoader")
			{
				hideFlags = (HideFlags)52
			};
			Object.DontDestroyOnLoad((Object)val);
			val.transform.SetParent(GameObject.Find("Services").transform);
			instance = val.AddComponent<IronSourceMobileAdsLoader>();
		}
	}

	internal void Start()
	{
		if (DebugConfig.isOn(DebugOption.TestAds))
		{
			Config.testAds = true;
		}
		if (!Config.isMobile || Config.hasPremium)
		{
			return;
		}
		try
		{
			log("Initializing");
			LevelPlayAdFormat[] array = (LevelPlayAdFormat[])(object)new LevelPlayAdFormat[1] { (LevelPlayAdFormat)2 };
			LevelPlay.OnInitSuccess += SdkInitializationCompletedEvent;
			LevelPlay.OnInitFailed += SdkInitializationFailedEvent;
			LevelPlay.Init("unexpected_platform", (string)null, array);
			log("Version " + LevelPlay.UnityVersion);
		}
		catch (Exception ex)
		{
			log("Could not initialize ads");
			Debug.Log((object)ex);
		}
	}

	private void OnApplicationPause(bool isPaused)
	{
		log("OnApplicationPause = " + isPaused);
	}

	private void SdkInitializationCompletedEvent(LevelPlayConfiguration pConfig)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			log("Initialized");
			initialized = true;
			Config.adsInitialized = true;
		});
	}

	private void SdkInitializationFailedEvent(LevelPlayInitError pConfig)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			log("Failed to initialize ads");
			initialized = false;
		});
	}

	private static void log(string pLog)
	{
		Debug.Log((object)(GetColor() + " <color=#abe0c3>" + pLog + "</color>"));
	}

	public static string GetColor()
	{
		return "[<color=#abe0c3>IS</color>]";
	}
}
// --- End of File: IronSourceMobileAdsLoader.cs ---



// --- Start of File: IronSourceRewardAd.cs ---
using System;
using Beebyte.Obfuscator;
using Unity.Services.LevelPlay;
using UnityEngine;

[ObfuscateLiterals]
public class IronSourceRewardAd : IWorldBoxAd
{
	private const string LEVELPLAY_REWARDED = "none";

	private static int loaded = 0;

	private static int failed = 0;

	private static bool initialized = false;

	private static LevelPlayRewardedAd _rewarded_ad;

	private static bool started = false;

	private static string lastError = "";

	public Action<string> logger { get; set; }

	public Action adResetCallback { get; set; }

	public Action adFailedCallback { get; set; }

	public Action adFinishedCallback { get; set; }

	public Action adStartedCallback { get; set; }

	public void Reset()
	{
		failed = 0;
		loaded = 0;
		lastError = "";
	}

	public void RequestAd()
	{
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Expected O, but got Unknown
		if (Config.isMobile && !Config.hasPremium && IronSourceMobileAdsLoader.initialized && (!HasAd() || started))
		{
			KillAd();
			started = false;
			if (!initialized)
			{
				initialized = true;
				_rewarded_ad = new LevelPlayRewardedAd("none");
				_rewarded_ad.OnAdLoaded += HandleRewardedAdAvailable;
				_rewarded_ad.OnAdLoadFailed += HandleRewardedAdUnavailable;
				_rewarded_ad.OnAdDisplayed += HandleRewardBasedVideoOpened;
				_rewarded_ad.OnAdDisplayFailed += HandleRewardedAdFailedToShow;
				_rewarded_ad.OnAdRewarded += HandleRewardBasedVideoRewarded;
				_rewarded_ad.OnAdClosed += HandleRewardBasedVideoClosed;
				_rewarded_ad.OnAdLoadFailed += HandleRewardedAdFailedToLoad;
			}
			log("Requesting Ad");
			_rewarded_ad.LoadAd();
		}
	}

	public void HandleRewardedAdAvailable(LevelPlayAdInfo pAdInfo)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			loaded++;
			failed = 0;
			log("Ad Available");
		});
	}

	public void HandleRewardedAdUnavailable(LevelPlayAdError pError)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			log("Ad Unavailable");
		});
	}

	public void HandleRewardBasedVideoOpened(LevelPlayAdInfo pAdInfo)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			started = true;
			loaded++;
			failed = 0;
			log("Ad Opened");
			RewardedAds.debug += "h3_";
			if (adStartedCallback != null)
			{
				adStartedCallback();
			}
		});
	}

	public void HandleRewardedAdFailedToShow(LevelPlayAdDisplayInfoError pAdError)
	{
		string tLoadError = "Failed to show ad";
		if (pAdError != null)
		{
			tLoadError = ((object)pAdError).ToString();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			started = true;
			loaded = 0;
			failed++;
			if (lastError != tLoadError)
			{
				log("<color=red>Ad Failed to Show: " + tLoadError + "</color>");
				lastError = tLoadError;
			}
			else
			{
				log("<color=red>Ad Failed to Show</color>");
			}
			RewardedAds.debug += "h4_";
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
		});
	}

	public void HandleRewardedAdFailedToLoad(LevelPlayAdError pAdError)
	{
		string tLoadError = "Failed to load ad";
		if (pAdError != null)
		{
			tLoadError = ((object)pAdError).ToString();
		}
		ThreadHelper.ExecuteInUpdate(delegate
		{
			started = true;
			loaded = 0;
			failed++;
			if (lastError != tLoadError)
			{
				log("<color=red>Ad Failed to Load: " + tLoadError + "</color>");
				lastError = tLoadError;
			}
			else
			{
				log("<color=red>Ad Failed to Load</color>");
			}
			RewardedAds.debug += "h4_";
			KillAd();
			if (adFailedCallback != null)
			{
				adFailedCallback();
			}
		});
	}

	public void HandleRewardBasedVideoRewarded(LevelPlayAdInfo pAdInfo, LevelPlayReward pReward)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			started = true;
			loaded++;
			failed = 0;
			log("Ad Rewarded");
			if ((Object)(object)World.world != (Object)null)
			{
				log("is worldbox on focus " + World.world.has_focus);
			}
			RewardedAds.instance.handleRewards();
			RewardedAds.debug += "h5_";
		});
	}

	public void HandleRewardBasedVideoClosed(LevelPlayAdInfo pAdInfo)
	{
		ThreadHelper.ExecuteInUpdate(delegate
		{
			started = true;
			loaded++;
			failed = 0;
			log("Ad Closed");
			RewardedAds.debug += "h6_";
			KillAd();
			if (adFinishedCallback != null)
			{
				adFinishedCallback();
			}
		});
	}

	public void KillAd()
	{
		_ = started;
	}

	public bool IsReady()
	{
		if (!IsInitialized())
		{
			return false;
		}
		LevelPlayRewardedAd rewarded_ad = _rewarded_ad;
		if (rewarded_ad == null)
		{
			return false;
		}
		return rewarded_ad.IsAdReady();
	}

	public void ShowAd()
	{
		if (IsReady())
		{
			started = true;
			_rewarded_ad.ShowAd((string)null);
		}
	}

	public bool HasAd()
	{
		if (!IsInitialized())
		{
			return false;
		}
		return IsReady();
	}

	public string GetProviderName()
	{
		return "IronSource Rewarded Ad";
	}

	public string GetColor()
	{
		return IronSourceMobileAdsLoader.GetColor();
	}

	private void log(string pLog)
	{
		logger(GetColor() + " " + pLog);
	}

	public bool IsInitialized()
	{
		return IronSourceMobileAdsLoader.initialized;
	}

	public void showAdInfo(LevelPlayAdInfo pAdInfo)
	{
	}
}
// --- End of File: IronSourceRewardAd.cs ---



// --- Start of File: ISapient.cs ---
public interface ISapient
{
	bool isSapient();
}
// --- End of File: ISapient.cs ---



// --- Start of File: ISapientListComponent.cs ---
using UnityEngine.UI;

public interface ISapientListComponent
{
	void setSapientCounter(Text pCounter);

	void setNonSapientCounter(Text pCounter);

	void setShowSapientOnly();

	void setShowNonSapientOnly();

	void setDefault();
}
// --- End of File: ISapientListComponent.cs ---



// --- Start of File: IScrollWindowShowEvent.cs ---
using UnityEngine.EventSystems;

public interface IScrollWindowShowEvent : IEventSystemHandler
{
	void ShowScrollWindow();
}
// --- End of File: IScrollWindowShowEvent.cs ---



// --- Start of File: ISelectedContainerTrait.cs ---
using UnityEngine;

public interface ISelectedContainerTrait
{
	Transform transform { get; }

	void update(NanoObject pNano);
}
// --- End of File: ISelectedContainerTrait.cs ---



// --- Start of File: ISelectedMetaWithUnit.cs ---
using UnityEngine;

public interface ISelectedMetaWithUnit
{
	SelectedMetaUnitElement unit_element { get; }

	GameObject unit_element_separator { get; }

	string unit_title_locale_key { get; }

	int last_dirty_stats_unit { get; set; }

	Actor last_unit { get; set; }

	bool checkUnitElement()
	{
		if (!hasUnit())
		{
			setUnitElementVisible(pState: false);
			return true;
		}
		setUnitElementVisible(pState: true);
		Actor unit = getUnit();
		UiUnitAvatarElement avatar = unit_element.getAvatar();
		if (unitChanged(unit) || avatar.avatarLoader.actorStateChanged())
		{
			unit_element.show(unit, unit_title_locale_key);
			last_dirty_stats_unit = unit.getStatsDirtyVersion();
			last_unit = unit;
			return true;
		}
		avatar.updateTileSprite();
		return false;
	}

	void setUnitElementVisible(bool pState)
	{
		((Component)unit_element).gameObject.SetActive(pState);
		unit_element_separator.SetActive(pState);
	}

	void avatarTouch()
	{
		if (hasUnit())
		{
			Actor unit = getUnit();
			SelectedUnit.select(unit);
			SelectedObjects.setNanoObject(unit);
			PowerTabController.showTabSelectedUnit();
			((IShakable)ToolbarButtons.instance).shake();
		}
	}

	bool hasUnit();

	Actor getUnit();

	bool unitChanged(Actor pActor)
	{
		if (pActor.getStatsDirtyVersion() == last_dirty_stats_unit)
		{
			return pActor != last_unit;
		}
		return true;
	}

	void clearLastUnit()
	{
		last_unit = null;
		last_dirty_stats_unit = -1;
	}
}
// --- End of File: ISelectedMetaWithUnit.cs ---



// --- Start of File: ISelectedTabBanners.cs ---
public interface ISelectedTabBanners<T> where T : NanoObject
{
	void update(T pNano);

	int countVisibleBanners();
}
// --- End of File: ISelectedTabBanners.cs ---



// --- Start of File: IShakable.cs ---
using DG.Tweening;
using UnityEngine;

public interface IShakable
{
	float shake_duration { get; }

	float shake_strength { get; }

	Tweener shake_tween { get; set; }

	Transform transform { get; }

	void shake()
	{
		killShakeTween();
		shake_tween = ShortcutExtensions.DOShakePosition(transform, shake_duration, shake_strength, 10, 90f, false, true, (ShakeRandomnessMode)0);
	}

	void killShakeTween()
	{
		TweenExtensions.Kill((Tween)(object)shake_tween, true);
	}
}
// --- End of File: IShakable.cs ---



// --- Start of File: IShouldRefreshWindow.cs ---
public interface IShouldRefreshWindow
{
	bool checkRefreshWindow();
}
// --- End of File: IShouldRefreshWindow.cs ---



// --- Start of File: ISkipLocaleAsset.cs ---
public interface ISkipLocaleAsset
{
}
// --- End of File: ISkipLocaleAsset.cs ---



// --- Start of File: IslandsCalculator.cs ---
using System.Collections.Generic;

public class IslandsCalculator
{
	private float _timer_update_actors;

	public ListPool<TileIsland> islands = new ListPool<TileIsland>();

	public readonly List<TileIsland> islands_ground = new List<TileIsland>();

	private readonly List<MapRegion> _temp_regions = new List<MapRegion>();

	private readonly List<MapRegion> _temp_regions_cur_wave = new List<MapRegion>();

	private readonly List<MapRegion> _temp_regions_next_wave = new List<MapRegion>();

	private int _last_island_id;

	private readonly HashSet<TileIsland> _dirty_islands = new HashSet<TileIsland>();

	private readonly Queue<MapRegion> _wave = new Queue<MapRegion>();

	private readonly Stack<TileIsland> _island_pool = new Stack<TileIsland>();

	public void prepareCalc()
	{
		_dirty_islands.Clear();
	}

	public void makeDirty(TileIsland pIsland)
	{
		_dirty_islands.Add(pIsland);
	}

	public void clearDirty()
	{
		using ListPool<TileIsland> listPool = islands;
		islands = new ListPool<TileIsland>(listPool.Count);
		foreach (TileIsland dirty_island in _dirty_islands)
		{
			dirty_island.clearRegionsFromIsland();
			dirty_island.insideRegionEdges.Clear();
			foreach (TileIsland connectedIsland in dirty_island.getConnectedIslands())
			{
				connectedIsland.setDirtyIslandNeighbours();
				MapChunkManager.m_dirtyIslands++;
			}
		}
		for (int i = 0; i < listPool.Count; i++)
		{
			TileIsland tileIsland = listPool[i];
			if (tileIsland.removed)
			{
				tileIsland.reset();
				_island_pool.Push(tileIsland);
			}
			else
			{
				islands.Add(tileIsland);
			}
		}
	}

	public void clear()
	{
		_last_island_id = 0;
		ListPool<TileIsland> listPool = islands;
		for (int i = 0; i < listPool.Count; i++)
		{
			TileIsland tileIsland = listPool[i];
			tileIsland.reset();
			_island_pool.Push(tileIsland);
		}
		_dirty_islands.Clear();
		islands.Clear();
		islands_ground.Clear();
		_wave.Clear();
		_temp_regions.Clear();
		_temp_regions_cur_wave.Clear();
		_temp_regions_next_wave.Clear();
	}

	public WorldTile tryGetRandomGround()
	{
		WorldTile worldTile = null;
		if (islands.Count > 0)
		{
			TileIsland randomIslandGround = getRandomIslandGround();
			if (randomIslandGround != null && randomIslandGround.regions.Count > 0)
			{
				worldTile = randomIslandGround.getRandomTile();
			}
		}
		if (worldTile == null)
		{
			worldTile = World.world.tiles_list.GetRandom();
		}
		return worldTile;
	}

	internal bool hasGround()
	{
		return islands_ground.Count > 0;
	}

	internal bool hasNonGround()
	{
		return islands.Count > islands_ground.Count;
	}

	internal float groundIslandRatio()
	{
		if (islands.Count == 0)
		{
			return 0f;
		}
		return (float)islands_ground.Count / (float)islands.Count;
	}

	internal float realGroundRatio()
	{
		if (!hasNonGround())
		{
			return 1f;
		}
		if (!hasGround())
		{
			return 0f;
		}
		int num = 0;
		int num2 = 0;
		foreach (ref TileIsland island in islands)
		{
			TileIsland current = island;
			if (current.type == TileLayerType.Ground)
			{
				num += current.getTileCount();
			}
			else
			{
				num2 += current.getTileCount();
			}
		}
		if (num == 0)
		{
			return 0f;
		}
		if (num2 == 0)
		{
			return 1f;
		}
		return (float)num / (float)(num + num2);
	}

	internal TileIsland getRandomIslandGroundWeighted(bool pMinRegions = true)
	{
		if (islands_ground.Count == 0)
		{
			return null;
		}
		int num = 0;
		for (int i = 0; i < islands_ground.Count; i++)
		{
			TileIsland tileIsland = islands_ground[i];
			if (!pMinRegions || tileIsland.regions.Count >= 4)
			{
				num += tileIsland.regions.Count;
			}
		}
		if (num == 0)
		{
			return null;
		}
		using ListPool<TileIsland> listPool = new ListPool<TileIsland>(num);
		for (int j = 0; j < islands_ground.Count; j++)
		{
			TileIsland tileIsland2 = islands_ground[j];
			if (!pMinRegions || tileIsland2.regions.Count >= 4)
			{
				listPool.AddTimes(tileIsland2.regions.Count, tileIsland2);
			}
		}
		return listPool.GetRandom();
	}

	internal TileIsland getRandomIslandGround(bool pMinRegions = true)
	{
		if (islands_ground.Count == 0)
		{
			return null;
		}
		if (!pMinRegions)
		{
			return islands_ground.GetRandom();
		}
		foreach (TileIsland item in islands_ground.LoopRandom())
		{
			if (item.regions.Count >= 4)
			{
				return item;
			}
		}
		return null;
	}

	internal TileIsland getRandomIslandNonGroundWeighted(bool pMinRegions = true)
	{
		if (islands.Count == 0)
		{
			return null;
		}
		if (islands_ground.Count == islands.Count)
		{
			return null;
		}
		int num = 0;
		for (int i = 0; i < islands.Count; i++)
		{
			TileIsland tileIsland = islands[i];
			if (tileIsland.type != TileLayerType.Ground && (!pMinRegions || tileIsland.regions.Count >= 4))
			{
				num += tileIsland.regions.Count;
			}
		}
		if (num == 0)
		{
			return null;
		}
		using ListPool<TileIsland> listPool = new ListPool<TileIsland>(num);
		for (int j = 0; j < islands.Count; j++)
		{
			TileIsland tileIsland2 = islands[j];
			if (tileIsland2.type != TileLayerType.Ground && (!pMinRegions || tileIsland2.regions.Count >= 4))
			{
				listPool.AddTimes(tileIsland2.regions.Count, tileIsland2);
			}
		}
		return listPool.GetRandom();
	}

	internal TileIsland getRandomIslandNonGround(bool pMinRegions = true)
	{
		if (islands.Count == 0)
		{
			return null;
		}
		if (islands_ground.Count == islands.Count)
		{
			return null;
		}
		foreach (TileIsland item in islands.LoopRandom())
		{
			if (item.type != TileLayerType.Ground && (!pMinRegions || item.regions.Count >= 4))
			{
				return item;
			}
		}
		return null;
	}

	public int countLandIslands()
	{
		int num = 0;
		for (int i = 0; i < islands.Count; i++)
		{
			TileIsland tileIsland = islands[i];
			if (tileIsland.type == TileLayerType.Ground && tileIsland.regions.Count >= 4)
			{
				num++;
			}
		}
		return num;
	}

	internal void recalcActors()
	{
		ListPool<TileIsland> listPool = islands;
		for (int i = 0; i < listPool.Count; i++)
		{
			listPool[i].actors.Clear();
		}
		List<Actor> simpleList = World.world.units.getSimpleList();
		for (int j = 0; j < simpleList.Count; j++)
		{
			Actor actor = simpleList[j];
			if (actor.isAlive())
			{
				actor.current_tile.region.island.actors.Add(actor);
			}
		}
	}

	private void clearCaches()
	{
		for (int i = 0; i < islands.Count; i++)
		{
			islands[i].clearCache();
		}
	}

	public void findIslands(ListPool<TileIsland> pNewIslands)
	{
		Bench.bench("find_islands_prepare", "chunks");
		_temp_regions.Clear();
		islands_ground.Clear();
		clearCaches();
		Bench.benchEnd("find_islands_prepare", "chunks", pSaveCounter: false, 0L);
		Bench.bench("find_islands_temp_regions", "chunks");
		MapChunk[] chunks = World.world.map_chunk_manager.chunks;
		int num = chunks.Length;
		for (int i = 0; i < num; i++)
		{
			MapChunk mapChunk = chunks[i];
			for (int j = 0; j < mapChunk.regions.Count; j++)
			{
				MapRegion mapRegion = mapChunk.regions[j];
				if (mapRegion.island == null)
				{
					mapRegion.is_island_checked = false;
					_temp_regions.Add(mapRegion);
				}
			}
		}
		Bench.benchEnd("find_islands_temp_regions", "chunks", pSaveCounter: true, _temp_regions.Count);
		Bench.bench("find_islands_new_islands", "chunks");
		for (int k = 0; k < _temp_regions.Count; k++)
		{
			MapRegion mapRegion2 = _temp_regions[k];
			if (mapRegion2.island == null)
			{
				TileIsland item = newIslandFrom(mapRegion2);
				pNewIslands.Add(item);
				MapChunkManager.m_newIslands++;
			}
		}
		Bench.benchEnd("find_islands_new_islands", "chunks", pSaveCounter: true, MapChunkManager.m_newIslands);
		Bench.bench("find_islands_fin", "chunks");
		for (int l = 0; l < islands.Count; l++)
		{
			TileIsland tileIsland = islands[l];
			tileIsland.countTiles();
			if (tileIsland.type == TileLayerType.Ground)
			{
				islands_ground.Add(tileIsland);
			}
		}
		Bench.benchEnd("find_islands_fin", "chunks", pSaveCounter: false, 0L);
	}

	private TileIsland newIslandFrom(MapRegion pRegion)
	{
		_temp_regions_cur_wave.Clear();
		_temp_regions_next_wave.Clear();
		TileIsland tileIsland;
		if (_island_pool.Count > 0)
		{
			tileIsland = _island_pool.Pop();
		}
		else
		{
			tileIsland = new TileIsland(_last_island_id);
			_last_island_id++;
		}
		tileIsland.reset();
		tileIsland.type = pRegion.type;
		islands.Add(tileIsland);
		_temp_regions_next_wave.Add(pRegion);
		_wave.Clear();
		_wave.Enqueue(pRegion);
		startFill(tileIsland);
		return tileIsland;
	}

	private void startFill(TileIsland pIsland)
	{
		while (_wave.Count > 0)
		{
			MapRegion mapRegion = _wave.Dequeue();
			if (!mapRegion.is_island_checked)
			{
				mapRegion.island = pIsland;
				pIsland.addRegion(mapRegion);
			}
			mapRegion.is_island_checked = true;
			for (int i = 0; i < mapRegion.neighbours.Count; i++)
			{
				MapRegion mapRegion2 = mapRegion.neighbours[i];
				if (!mapRegion2.is_island_checked)
				{
					mapRegion2.is_island_checked = true;
					mapRegion2.island = pIsland;
					pIsland.addRegion(mapRegion2);
					_wave.Enqueue(mapRegion2);
				}
			}
		}
		pIsland.regions.checkAddRemove();
	}
}
// --- End of File: IslandsCalculator.cs ---



// --- Start of File: IStatsElement.cs ---
using UnityEngine;

public interface IStatsElement : IRefreshElement
{
	GameObject gameObject { get; }

	void setIconValue(string pName, float pMainVal, float? pMax = null, string pColor = "", bool pFloat = false, string pEnding = "", char pSeparator = '/');
}
// --- End of File: IStatsElement.cs ---



// --- Start of File: Item.cs ---
using System.Collections.Generic;
using UnityEngine;

public class Item : CoreSystemObject<ItemData>
{
	private EquipmentAsset _asset;

	private string _texture_id;

	public bool unit_has_it;

	public bool city_has_it;

	public bool shouldbe_removed;

	private Actor _actor;

	private City _city;

	private int _item_value;

	private readonly BaseStats _total_stats = new BaseStats();

	private Rarity _quality;

	public AttackAction action_attack_target;

	protected override MetaType meta_type => MetaType.Item;

	public override BaseSystemManager manager => World.world.items;

	public EquipmentAsset asset => getAsset();

	public override string name
	{
		get
		{
			return getName(pWithMaterial: false);
		}
		protected set
		{
			data.name = value;
		}
	}

	public override void setFavorite(bool pState)
	{
		base.setFavorite(pState);
		if (isReadyForRemoval())
		{
			World.world.items.setDirty();
		}
	}

	public bool isCursed()
	{
		return hasMod("cursed");
	}

	public bool isEternal()
	{
		return hasMod("eternal");
	}

	public bool isDestroyable()
	{
		if (!isFavorite())
		{
			return !isEternal();
		}
		return false;
	}

	public bool isReadyForRemoval()
	{
		if (!hasCity() && !hasActor())
		{
			return isDestroyable();
		}
		return false;
	}

	public void fullRepair()
	{
		data.durability = 100;
	}

	public void getDamaged(int pDamage)
	{
		if (!hasMod("eternal"))
		{
			data.durability -= pDamage;
			if (data.durability < 0)
			{
				data.durability = 0;
			}
		}
	}

	public void newItem(EquipmentAsset pAsset)
	{
		setAsset(pAsset);
		data.durability = pAsset.durability;
	}

	public bool isBroken()
	{
		return getDurabilityCurrent() <= 0;
	}

	public bool needRepair()
	{
		return getDurabilityCurrent() < getDurabilityMax();
	}

	public int getDurabilityCurrent()
	{
		return data.durability;
	}

	public int getDurabilityMax()
	{
		return _asset.durability;
	}

	public string getDurabilityString()
	{
		return getDurabilityCurrent() + "/" + getDurabilityMax();
	}

	private void setAsset(EquipmentAsset pAsset)
	{
		_asset = pAsset;
		data.asset_id = _asset.id;
		recalculateTexturePath();
	}

	private void recalculateTexturePath()
	{
		_texture_id = asset.path_gameplay_sprite;
	}

	protected sealed override void setDefaultValues()
	{
		base.setDefaultValues();
		_asset = null;
		unit_has_it = false;
		city_has_it = false;
		shouldbe_removed = false;
		_item_value = 0;
		_quality = Rarity.R0_Normal;
	}

	public void reforge(int pTries)
	{
		clearForReforge();
		World.world.items.generateModsFor(this, pTries);
		string pName = NameGenerator.getName("reforged_item");
		setName(pName);
		calculateValues();
		if (_actor != null)
		{
			_actor.addTrait("scar_of_divinity");
		}
	}

	private void clearForReforge()
	{
		data.modifiers.Clear();
	}

	public void transmute()
	{
		clearForReforge();
		bool flag = isCheatEnabled();
		using ListPool<EquipmentAsset> listPool = new ListPool<EquipmentAsset>();
		List<EquipmentAsset> list = (_asset.is_pool_weapon ? ((!flag) ? AssetManager.items.pot_weapon_assets_unlocked : AssetManager.items.pot_weapon_assets_all) : ((!flag) ? AssetManager.items.pot_equipment_by_groups_unlocked[_asset.group_id] : AssetManager.items.pot_equipment_by_groups_all[_asset.group_id]));
		foreach (EquipmentAsset item in list)
		{
			if (item.isAvailable())
			{
				listPool.Add(item);
			}
		}
		listPool.Shuffle();
		foreach (ref EquipmentAsset item2 in listPool)
		{
			EquipmentAsset current2 = item2;
			if (_asset != current2)
			{
				setAsset(current2);
				break;
			}
		}
		reforge(5);
		calculateValues();
	}

	public bool hasMod(string pID)
	{
		if (data.modifiers.Contains(pID))
		{
			return true;
		}
		return false;
	}

	public bool hasMod(ItemModAsset pModAsset)
	{
		return hasMod(pModAsset.id);
	}

	public bool addMod(string pModId)
	{
		ItemModAsset pModAsset = AssetManager.items_modifiers.get(pModId);
		return addMod(pModAsset);
	}

	public bool addMod(ItemModAsset pModAsset)
	{
		if (hasMod(pModAsset))
		{
			return false;
		}
		foreach (ref string modifier in data.modifiers)
		{
			string current = modifier;
			if (AssetManager.items_modifiers.get(current).mod_type == pModAsset.mod_type)
			{
				return false;
			}
		}
		data.modifiers.Add(pModAsset.id);
		World.world.items.setDirty();
		return true;
	}

	public bool removeMod(string pModId)
	{
		World.world.items.setDirty();
		return data.modifiers.Remove(pModId);
	}

	public void setUnitHasIt(Actor pActor)
	{
		_actor = pActor;
		_city = null;
		unit_has_it = true;
		city_has_it = false;
	}

	public void setInCityStorage(City pCity)
	{
		_actor = null;
		_city = pCity;
		unit_has_it = false;
		city_has_it = true;
	}

	public void setShouldBeRemoved()
	{
		shouldbe_removed = true;
	}

	public void clearUnit()
	{
		_actor = null;
		unit_has_it = false;
		World.world.items.setDirty();
	}

	public void clearCity()
	{
		_city = null;
		city_has_it = false;
		World.world.items.setDirty();
	}

	public Actor getActor()
	{
		return _actor;
	}

	public City getCity()
	{
		return _city;
	}

	public void calculateValues()
	{
		recalculateTexturePath();
		ItemTools.calcItemValues(this, _total_stats);
		_item_value = ItemTools.s_value;
		_quality = ItemTools.s_quality;
		data.durability = _asset.durability;
	}

	public void initItem()
	{
		initFields();
		calculateValues();
	}

	public override void loadData(ItemData pData)
	{
		base.loadData(pData);
		initFields();
		calculateValues();
	}

	private void initFields()
	{
		EquipmentAsset equipmentAsset = AssetManager.items.get(data.asset_id);
		setAsset(equipmentAsset);
	}

	public EquipmentAsset getAsset()
	{
		return _asset;
	}

	public string getItemDescription()
	{
		string pKey = ((!data.created_by_player) ? "item_template_description_full" : "item_template_description_full_player");
		string text = LocalizedTextManager.getText(pKey);
		string text2 = LocalizedTextManager.getText("item_template_description_age_only");
		if (string.IsNullOrEmpty(data.by))
		{
			text = text2;
		}
		int age = getAge();
		text = text.Replace("$item_creator_name$", Toolbox.coloredString(data.by, data.byColor));
		text = text.Replace("$item_creator_kingdom$", Toolbox.coloredString(data.from, data.fromColor));
		text = text.Replace("$item_creator_years$", age.ToString() ?? "");
		if (age == 1)
		{
			return text.Replace("$year_ending$", LocalizedTextManager.getText("item_template_description_year") ?? "");
		}
		return text.Replace("$year_ending$", LocalizedTextManager.getText("item_template_description_years") ?? "");
	}

	public string getItemKeyType()
	{
		return _asset.getLocaleRarity(getQuality());
	}

	public void countKill()
	{
		data.kills++;
	}

	public bool isRangeAttack()
	{
		return getAsset().attack_type == WeaponType.Range;
	}

	public BaseStats getFullStats()
	{
		return _total_stats;
	}

	public int getValue()
	{
		return _item_value;
	}

	public Rarity getQuality()
	{
		return _quality;
	}

	public string getTextureID()
	{
		return _texture_id;
	}

	public string getName(bool pWithMaterial = true)
	{
		if (!string.IsNullOrEmpty(data.name))
		{
			return data.name;
		}
		ItemTools.getTooltipTitle(getAsset(), out var pName, out var pMaterial);
		return pMaterial + pName;
	}

	public string getQualityColor()
	{
		return getQuality().getRarityColorHex();
	}

	public static string getQualityString(Rarity pRarity)
	{
		string result = "";
		switch (pRarity)
		{
		case Rarity.R0_Normal:
			result = "";
			break;
		case Rarity.R1_Rare:
			result = "_rare";
			break;
		case Rarity.R2_Epic:
			result = "_epic";
			break;
		case Rarity.R3_Legendary:
			result = "_legendary";
			break;
		}
		return result;
	}

	public Sprite getSprite()
	{
		return _asset.getSprite();
	}

	public bool hasActor()
	{
		return getActor() != null;
	}

	public bool hasCity()
	{
		return getCity() != null;
	}

	public override void Dispose()
	{
		_asset = null;
		_texture_id = null;
		_total_stats.reset();
		_actor = null;
		action_attack_target = null;
		base.Dispose();
	}

	private bool isCheatEnabled()
	{
		if (!DebugConfig.isOn(DebugOption.UnlockAllEquipment))
		{
			return WorldLawLibrary.world_law_cursed_world.isEnabled();
		}
		return true;
	}
}
// --- End of File: Item.cs ---



// --- Start of File: ItemAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using Newtonsoft.Json;
using UnityEngine;

[Serializable]
public class ItemAsset : BaseAugmentationAsset, IDescriptionAsset, ILocalizedAsset, IMultiLocalesAsset
{
	public string path_gameplay_sprite;

	[NonSerialized]
	public Sprite[] gameplay_sprites;

	public string material;

	public bool colored;

	public int minimum_city_storage_resource_1;

	public int cost_gold;

	public int cost_coins_resources;

	public int cost_resource_1;

	[DefaultValue("none")]
	public string cost_resource_id_1 = "none";

	public int cost_resource_2;

	[DefaultValue("none")]
	public string cost_resource_id_2 = "none";

	[DefaultValue(1)]
	public int rarity = 1;

	public int equipment_value;

	public bool metallic;

	[DefaultValue(1)]
	public int mod_rank = 1;

	public string mod_type;

	[DefaultValue(true)]
	public bool mod_can_be_given = true;

	public string translation_key;

	public bool animated;

	public string pool;

	[DefaultValue("")]
	public string path_slash_animation = string.Empty;

	public string projectile;

	[DefaultValue(Rarity.R0_Normal)]
	public Rarity quality;

	[DefaultValue(WeaponType.Melee)]
	public WeaponType attack_type;

	public EquipmentType equipment_type;

	public string equipment_subtype;

	public string name_class;

	public List<string> name_templates;

	public string[] item_modifier_ids;

	[NonSerialized]
	public ItemModAsset[] item_modifiers;

	public bool is_pool_weapon;

	public int pool_rate;

	[DefaultValue(100)]
	public int durability = 100;

	[DefaultValue(1)]
	public int rigidity_rating = 1;

	protected override HashSet<string> progress_elements => base._progress_data?.unlocked_equipment;

	[JsonIgnore]
	public int get_total_cost => cost_gold + cost_coins_resources;

	public override BaseCategoryAsset getGroup()
	{
		return AssetManager.item_groups.get(group_id);
	}

	public string getLocaleRarity(Rarity pRarity)
	{
		return name_class + Item.getQualityString(pRarity);
	}

	public override string getLocaleID()
	{
		if (!has_locales)
		{
			return null;
		}
		return translation_key ?? ("item_" + (equipment_subtype ?? id));
	}

	public string getDescriptionID()
	{
		if (!has_locales || isMod())
		{
			return null;
		}
		return id + "_description";
	}

	public string getMaterialID()
	{
		if (!has_locales || isMod())
		{
			return null;
		}
		return "item_mat_" + material;
	}

	public IEnumerable<string> getLocaleIDs()
	{
		if (!has_locales)
		{
			yield break;
		}
		yield return getLocaleID();
		if (isMod())
		{
			yield break;
		}
		yield return getDescriptionID();
		if (material != "basic")
		{
			yield return getMaterialID();
		}
		foreach (Rarity value in Enum.GetValues(typeof(Rarity)))
		{
			yield return getLocaleRarity(value);
		}
	}

	public string getTranslatedName()
	{
		string text = LocalizedTextManager.getText(getLocaleID());
		if (!string.IsNullOrEmpty(material) && material != "basic")
		{
			string text2 = LocalizedTextManager.getText(getMaterialID());
			text = text + " (" + text2 + ")";
		}
		return text;
	}

	public string getTranslatedDescription()
	{
		return LocalizedTextManager.getText(getDescriptionID());
	}

	public void setCost(int pGoldCost, string pResourceID_1 = "none", int pCostResource_1 = 0, string pResourceID_2 = "none", int pCostResource_2 = 0)
	{
		cost_gold = pGoldCost;
		cost_resource_id_1 = pResourceID_1;
		cost_resource_1 = pCostResource_1;
		cost_resource_id_2 = pResourceID_2;
		cost_resource_2 = pCostResource_2;
	}

	public bool isMod()
	{
		return mod_type != null;
	}

	public string getRandomNameTemplate(Actor pActor = null)
	{
		foreach (string item in name_templates.LoopRandom())
		{
			NameGeneratorAsset nameGeneratorAsset = AssetManager.name_generator.get(item);
			if (nameGeneratorAsset.check == null || nameGeneratorAsset.check(pActor))
			{
				return item;
			}
		}
		return null;
	}

	public override bool unlock(bool pSaveData = true)
	{
		if (!base.unlock(pSaveData))
		{
			return false;
		}
		EquipmentAsset item = this as EquipmentAsset;
		List<EquipmentAsset> pot_weapon_assets_unlocked = AssetManager.items.pot_weapon_assets_unlocked;
		if (is_pool_weapon && !pot_weapon_assets_unlocked.Contains(item))
		{
			pot_weapon_assets_unlocked.Add(item);
		}
		Dictionary<string, List<EquipmentAsset>> pot_equipment_by_groups_unlocked = AssetManager.items.pot_equipment_by_groups_unlocked;
		if (!is_pool_weapon)
		{
			if (!pot_equipment_by_groups_unlocked.ContainsKey(group_id))
			{
				pot_equipment_by_groups_unlocked.Add(group_id, new List<EquipmentAsset>());
			}
			List<EquipmentAsset> list = pot_equipment_by_groups_unlocked[group_id];
			if (!list.Contains(item))
			{
				list.Add(item);
			}
		}
		return true;
	}

	protected override bool isDebugUnlockedAll()
	{
		return DebugConfig.isOn(DebugOption.UnlockAllEquipment);
	}
}
// --- End of File: ItemAsset.cs ---



// --- Start of File: ItemAssetLibrary.cs ---
using System;

public abstract class ItemAssetLibrary<T> : BaseLibraryWithUnlockables<T> where T : ItemAsset
{
	public override T add(T pAsset)
	{
		T val = base.add(pAsset);
		if (val.base_stats == null)
		{
			val.base_stats = new BaseStats();
		}
		return val;
	}

	public override void editorDiagnosticLocales()
	{
		foreach (T item in list)
		{
			if (!item.has_locales)
			{
				continue;
			}
			string localeID = item.getLocaleID();
			checkLocale(item, localeID);
			if (item.isMod())
			{
				continue;
			}
			string descriptionID = item.getDescriptionID();
			checkLocale(item, descriptionID);
			if (item.material != "basic")
			{
				checkLocale(item, item.getMaterialID());
			}
			foreach (Rarity value in Enum.GetValues(typeof(Rarity)))
			{
				string localeRarity = item.getLocaleRarity(value);
				checkLocale(item, localeRarity);
			}
		}
	}
}
// --- End of File: ItemAssetLibrary.cs ---



// --- Start of File: ItemCrafting.cs ---
using System.Collections.Generic;

public static class ItemCrafting
{
	private static readonly EquipmentType[] list_equipments = new EquipmentType[5]
	{
		EquipmentType.Helmet,
		EquipmentType.Armor,
		EquipmentType.Boots,
		EquipmentType.Amulet,
		EquipmentType.Ring
	};

	public static bool tryToCraftRandomWeapon(Actor pActor, City pCity)
	{
		int num = pActor.asset.item_making_skill;
		if (pActor.hasCulture() && pActor.culture.hasTrait("weaponsmith_mastery"))
		{
			num += CultureTraitLibrary.getValue("weaponsmith_mastery");
		}
		return craftItem(pActor, pActor.getName(), EquipmentType.Weapon, num, pCity);
	}

	public static bool tryToCraftRandomArmor(Actor pActor, City pCity)
	{
		int num = pActor.asset.item_making_skill;
		if (pActor.hasCulture() && pActor.culture.hasTrait("armorsmith_mastery"))
		{
			num += CultureTraitLibrary.getValue("armorsmith_mastery");
		}
		EquipmentType random = list_equipments.GetRandom();
		return craftItem(pActor, pActor.getName(), random, num, pCity);
	}

	public static bool tryToCraftRandomEquipment(Actor pActor, City pCity)
	{
		bool num = tryToCraftRandomArmor(pActor, pCity);
		bool flag = tryToCraftRandomWeapon(pActor, pCity);
		return num || flag;
	}

	public static bool craftItem(Actor pActor, string pCreatorName, EquipmentType pType, int pTries, City pCity)
	{
		string text = null;
		if (pType == EquipmentType.Weapon)
		{
			if (pActor.hasCulture())
			{
				text = pActor.culture.getPreferredWeaponSubtypeIDs();
			}
			if (string.IsNullOrEmpty(text))
			{
				text = ItemLibrary.default_weapon_pool.GetRandom();
			}
		}
		else
		{
			text = AssetManager.items.getEquipmentType(pType);
		}
		EquipmentAsset equipmentAsset = null;
		ActorEquipmentSlot slot = pActor.equipment.getSlot(pType);
		Item item = slot.getItem();
		if (item != null && item.isCursed())
		{
			return false;
		}
		int pCurrentItemValue = item?.asset.equipment_value ?? 0;
		if (pType == EquipmentType.Weapon && pActor.hasCulture() && pActor.culture.hasPreferredWeaponsToCraft() && Randy.randomBool())
		{
			equipmentAsset = getItemAssetToCraft(pActor, pActor.culture.getPreferredWeaponAssets(), pCity, pCurrentItemValue, pShuffle: true);
		}
		if (equipmentAsset == null)
		{
			List<EquipmentAsset> pItemList = AssetManager.items.equipment_by_subtypes[text];
			equipmentAsset = getItemAssetToCraft(pActor, pItemList, pCity, pCurrentItemValue);
		}
		if (equipmentAsset == null)
		{
			return false;
		}
		Item pItem = World.world.items.generateItem(equipmentAsset, pActor.kingdom, pCreatorName, pTries, pActor);
		if (slot.isEmpty())
		{
			slot.setItem(pItem, pActor);
		}
		else
		{
			Item item2 = slot.getItem();
			slot.takeAwayItem();
			pCity.tryToPutItem(item2);
			slot.setItem(pItem, pActor);
		}
		pActor.spendMoney(equipmentAsset.get_total_cost);
		if (equipmentAsset.cost_resource_id_1 != "none")
		{
			pCity.takeResource(equipmentAsset.cost_resource_id_1, equipmentAsset.cost_resource_1);
		}
		if (equipmentAsset.cost_resource_id_2 != "none")
		{
			pCity.takeResource(equipmentAsset.cost_resource_id_2, equipmentAsset.cost_resource_2);
		}
		return true;
	}

	public static EquipmentAsset getItemAssetToCraft(Actor pActor, List<EquipmentAsset> pItemList, City pCity, int pCurrentItemValue, bool pShuffle = false)
	{
		if (pShuffle)
		{
			pItemList.Shuffle();
		}
		for (int num = pItemList.Count - 1; num >= 0; num--)
		{
			EquipmentAsset equipmentAsset = pItemList[num];
			if (equipmentAsset.equipment_value > pCurrentItemValue && hasEnoughResourcesToCraft(pActor, equipmentAsset, pCity))
			{
				return equipmentAsset;
			}
		}
		return null;
	}

	private static bool hasEnoughResourcesToCraft(Actor pActor, EquipmentAsset pAsset, City pCity)
	{
		int get_total_cost = pAsset.get_total_cost;
		if (!pActor.hasEnoughMoney(get_total_cost))
		{
			return false;
		}
		if (pAsset.cost_resource_id_1 != "none" && pAsset.cost_resource_1 > pCity.getResourcesAmount(pAsset.cost_resource_id_1))
		{
			return false;
		}
		if (pAsset.cost_resource_id_2 != "none" && pAsset.cost_resource_2 > pCity.getResourcesAmount(pAsset.cost_resource_id_2))
		{
			return false;
		}
		return true;
	}
}
// --- End of File: ItemCrafting.cs ---



// --- Start of File: ItemData.cs ---
using System;
using System.ComponentModel;

[Serializable]
public class ItemData : BaseSystemData
{
	public int durability = 100;

	public bool created_by_player;

	[DefaultValue("")]
	public string by = string.Empty;

	internal string byColor = string.Empty;

	[DefaultValue("")]
	public string from = string.Empty;

	internal string fromColor = string.Empty;

	[DefaultValue(0)]
	public int kills;

	public string asset_id = string.Empty;

	public string material = string.Empty;

	public readonly ListPool<string> modifiers = new ListPool<string>();

	[DefaultValue(-1L)]
	public long creator_id { get; set; } = -1L;


	[DefaultValue(-1L)]
	public long creator_kingdom_id { get; set; } = -1L;


	public bool ShouldSerializemodifiers()
	{
		return modifiers.Count > 0;
	}

	public override void Dispose()
	{
		modifiers.Dispose();
		base.Dispose();
	}
}
// --- End of File: ItemData.cs ---



// --- Start of File: ItemGroupAsset.cs ---
using System;

[Serializable]
public class ItemGroupAsset : BaseCategoryAsset
{
}
// --- End of File: ItemGroupAsset.cs ---



// --- Start of File: ItemGroupLibrary.cs ---
public class ItemGroupLibrary : BaseCategoryLibrary<ItemGroupAsset>
{
	public override void init()
	{
		base.init();
		add(new ItemGroupAsset
		{
			id = "helmet",
			name = "equipment_group_helmet",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "armor",
			name = "equipment_group_armor",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "boots",
			name = "equipment_group_boots",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "ring",
			name = "equipment_group_ring",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "amulet",
			name = "equipment_group_amulet",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "sword",
			name = "equipment_group_sword",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "axe",
			name = "equipment_group_axe",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "hammer",
			name = "equipment_group_hammer",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "spear",
			name = "equipment_group_spear",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "bow",
			name = "equipment_group_bow",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "staff",
			name = "equipment_group_staff",
			color = "#BAFFC2"
		});
		add(new ItemGroupAsset
		{
			id = "firearm",
			name = "equipment_group_firearm",
			color = "#BAFFC2"
		});
	}
}
// --- End of File: ItemGroupLibrary.cs ---



// --- Start of File: ItemInHand.cs ---
public enum ItemInHand
{
	Unset,
	Tool,
	Resource,
	Weapon
}
// --- End of File: ItemInHand.cs ---



// --- Start of File: ItemLibrary.cs ---
using System;
using System.Collections.Generic;
using Beebyte.Obfuscator;
using UnityEngine;

[ObfuscateLiterals]
public class ItemLibrary : ItemAssetLibrary<EquipmentAsset>
{
	[NonSerialized]
	public List<EquipmentAsset> pot_weapon_assets_all = new List<EquipmentAsset>();

	[NonSerialized]
	public Dictionary<string, List<EquipmentAsset>> pot_equipment_by_groups_all = new Dictionary<string, List<EquipmentAsset>>();

	[NonSerialized]
	public List<EquipmentAsset> pot_weapon_assets_unlocked = new List<EquipmentAsset>();

	[NonSerialized]
	public Dictionary<string, List<EquipmentAsset>> pot_equipment_by_groups_unlocked = new Dictionary<string, List<EquipmentAsset>>();

	[NonSerialized]
	public Dictionary<string, List<EquipmentAsset>> equipment_by_subtypes = new Dictionary<string, List<EquipmentAsset>>();

	public static readonly string[] default_weapon_pool = new string[6] { "sword", "axe", "hammer", "spear", "bow", "stick" };

	public static EquipmentAsset base_attack;

	private const string TEMPLATE_EQUIPMENT = "$equipment";

	private const string TEMPLATE_ARMOR = "$armor";

	private const string TEMPLATE_BOOTS = "$boots";

	private const string TEMPLATE_HELMET = "$helmet";

	private const string TEMPLATE_ACCESSORY = "$accessory";

	private const string TEMPLATE_RING = "$ring";

	private const string TEMPLATE_AMULET = "$amulet";

	private const string TEMPLATE_WEAPON = "$weapon";

	private const string TEMPLATE_MELEE = "$melee";

	private const string TEMPLATE_RANGE = "$range";

	private const string TEMPLATE_BOW = "$bow";

	private const string TEMPLATE_SWORD = "$sword";

	private const string TEMPLATE_AXE = "$axe";

	private const string TEMPLATE_HAMMER = "$hammer";

	private const string TEMPLATE_SPEAR = "$spear";

	public override void init()
	{
		base.init();
		initTemplates();
		initNormalEquipment();
		initNormalWeapons();
		initWeaponsUnique();
		initBoats();
		initBaseAttacks();
	}

	public override void post_init()
	{
		foreach (EquipmentAsset item in list)
		{
			if (item.is_pool_weapon)
			{
				item.path_gameplay_sprite = "items/weapons/w_" + item.id;
			}
			if (string.IsNullOrEmpty(item.path_icon))
			{
				item.path_icon = "ui/Icons/items/icon_" + item.id;
				int num = 0;
				if (item.cost_resource_id_1 != "none")
				{
					ResourceAsset resourceAsset = AssetManager.resources.get(item.cost_resource_id_1);
					num += resourceAsset.money_cost;
				}
				if (item.cost_resource_id_2 != "none")
				{
					ResourceAsset resourceAsset2 = AssetManager.resources.get(item.cost_resource_id_2);
					num += resourceAsset2.money_cost;
				}
				item.cost_coins_resources = num;
			}
		}
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (EquipmentAsset item in list)
		{
			if (item.item_modifier_ids == null)
			{
				continue;
			}
			item.item_modifiers = new ItemModAsset[item.item_modifier_ids.Length];
			for (int i = 0; i < item.item_modifier_ids.Length; i++)
			{
				string text = item.item_modifier_ids[i];
				ItemModAsset itemModAsset = AssetManager.items_modifiers.get(text);
				if (itemModAsset == null)
				{
					BaseAssetLibrary.logAssetError("ItemLibrary: Item Modifier Asset <e>not found</e>", text);
				}
				else
				{
					item.item_modifiers[i] = itemModAsset;
				}
			}
		}
		fillSubtypesAndGroups();
		fillUnlockedPools();
		foreach (EquipmentAsset item2 in list)
		{
			item2.linkSpells();
		}
	}

	public override EquipmentAsset add(EquipmentAsset pAsset)
	{
		EquipmentAsset equipmentAsset = base.add(pAsset);
		if (equipmentAsset.base_stats == null)
		{
			equipmentAsset.base_stats = new BaseStats();
		}
		return equipmentAsset;
	}

	public string getEquipmentType(EquipmentType pType)
	{
		return pType switch
		{
			EquipmentType.Weapon => "weapon", 
			EquipmentType.Helmet => "helmet", 
			EquipmentType.Armor => "armor", 
			EquipmentType.Boots => "boots", 
			EquipmentType.Ring => "ring", 
			EquipmentType.Amulet => "amulet", 
			_ => null, 
		};
	}

	private void fillSubtypesAndGroups()
	{
		foreach (EquipmentAsset item in list)
		{
			if (!equipment_by_subtypes.ContainsKey(item.equipment_subtype))
			{
				equipment_by_subtypes.Add(item.equipment_subtype, new List<EquipmentAsset>());
			}
			equipment_by_subtypes[item.equipment_subtype].Add(item);
			if (item.is_pool_weapon)
			{
				pot_weapon_assets_all.Add(item);
			}
			if (!item.is_pool_weapon)
			{
				string group_id = item.group_id;
				if (!pot_equipment_by_groups_all.ContainsKey(group_id))
				{
					pot_equipment_by_groups_all.Add(group_id, new List<EquipmentAsset>());
				}
				pot_equipment_by_groups_all[group_id].Add(item);
			}
		}
	}

	private void fillUnlockedPools()
	{
		foreach (string item in GameProgress.instance.data.unlocked_equipment)
		{
			EquipmentAsset equipmentAsset = get(item);
			if (equipmentAsset == null)
			{
				continue;
			}
			if (equipmentAsset.is_pool_weapon && !pot_weapon_assets_unlocked.Contains(equipmentAsset))
			{
				pot_weapon_assets_unlocked.Add(equipmentAsset);
			}
			if (!equipmentAsset.is_pool_weapon)
			{
				string group_id = equipmentAsset.group_id;
				if (!pot_equipment_by_groups_unlocked.ContainsKey(group_id))
				{
					pot_equipment_by_groups_unlocked.Add(group_id, new List<EquipmentAsset>());
				}
				List<EquipmentAsset> list = pot_equipment_by_groups_unlocked[group_id];
				if (!list.Contains(equipmentAsset))
				{
					list.Add(equipmentAsset);
				}
			}
		}
	}

	public string addToGameplayReport(string pWhat)
	{
		string empty = string.Empty;
		empty = empty + pWhat + "\n";
		foreach (EquipmentAsset item in list)
		{
			if (item.has_locales && !item.isTemplateAsset())
			{
				string translatedName = item.getTranslatedName();
				string translatedDescription = item.getTranslatedDescription();
				string text = "\n" + translatedName;
				text += "\n";
				if (!string.IsNullOrEmpty(translatedDescription))
				{
					text = text + "1: " + translatedDescription;
				}
				empty += text;
			}
		}
		return empty + "\n\n";
	}

	public void loadSprites()
	{
		foreach (EquipmentAsset item in list)
		{
			if (item.is_pool_weapon)
			{
				item.gameplay_sprites = SpriteTextureLoader.getSpriteList(item.path_gameplay_sprite);
				if (item.gameplay_sprites.Length == 0)
				{
					Debug.LogError((object)("Weapon Texture is Missing: " + item.path_gameplay_sprite));
				}
			}
		}
	}

	private void initBaseAttacks()
	{
		base_attack = clone("base_attack", "$melee");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_base";
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("hands", "$melee");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("fire_hands", "hands");
		t.has_locales = false;
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("flame");
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("jaws", "$melee");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_jaws";
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("claws", "$melee");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_claws";
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("snowball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.base_stats["range"] = 6f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "snowball";
		t.base_stats["projectiles"] = 1f;
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("ice");
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("bite", "$melee");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_jaws";
		t.attack_type = WeaponType.Melee;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("rocks", "$range");
		t.has_locales = false;
		t.projectile = "rock";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.base_stats["range"] = 15f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["projectiles"] = 1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
	}

	private void initBoats()
	{
		clone("boat_cannonball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_cannonball";
		t.base_stats["damage"] = 50f;
		t.base_stats["range"] = 14f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 3f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "cannonball";
		t.base_stats["projectiles"] = 1f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_arrow", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_bow";
		t.base_stats["damage"] = 30f;
		t.base_stats["range"] = 9f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 0f;
		t.base_stats["accuracy"] = 4f;
		t.base_stats["critical_chance"] = 0.2f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["attack_speed"] = 0.5f;
		t.projectile = "arrow";
		t.base_stats["projectiles"] = 5f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_snowball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_snowball";
		t.base_stats["damage"] = 50f;
		t.base_stats["range"] = 14f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 3f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "snowball";
		t.base_stats["projectiles"] = 1f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_plasma_ball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_plasma_ball";
		t.base_stats["damage"] = 65f;
		t.base_stats["range"] = 20f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 2f;
		t.base_stats["critical_chance"] = 0.2f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "plasma_ball";
		t.base_stats["projectiles"] = 1f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_necro_ball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_necro_ball";
		t.base_stats["damage"] = 45f;
		t.base_stats["range"] = 12f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 3f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "skull";
		t.base_stats["projectiles"] = 3f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_fireball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_cannonball";
		t.base_stats["damage"] = 30f;
		t.base_stats["range"] = 12f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 2f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "fireball";
		t.base_stats["projectiles"] = 1f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_freeze_ball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_snowball";
		t.base_stats["damage"] = 30f;
		t.base_stats["range"] = 12f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 2f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "freeze_orb";
		t.base_stats["projectiles"] = 3f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
		clone("boat_acid_ball", "$range");
		t.has_locales = false;
		t.path_slash_animation = "effects/slashes/slash_acid_ball";
		t.base_stats["damage"] = 50f;
		t.base_stats["range"] = 14f;
		t.base_stats["targets"] = 4f;
		t.base_stats["area_of_effect"] = 4f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.projectile = "acid_ball";
		t.base_stats["projectiles"] = 5f;
		t.show_in_meta_editor = false;
		t.show_in_knowledge_window = false;
	}

	private void initNormalEquipment()
	{
		initArmors();
		initBoots();
		initHelmets();
		initRings();
		initAmulets();
	}

	private void initAmulets()
	{
		clone("amulet_bone", "$amulet");
		t.material = "bone";
		t.equipment_value = 5;
		t.setCost(0, "bones", 1, "gems", 1);
		t.rigidity_rating = 1;
		t.base_stats["critical_chance"] = 0.02f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_copper", "$amulet");
		t.material = "copper";
		t.equipment_value = 10;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1, "gems", 1);
		t.rigidity_rating = 2;
		t.base_stats["critical_chance"] = 0.03f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_bronze", "$amulet");
		t.material = "bronze";
		t.equipment_value = 15;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1, "gems", 1);
		t.rigidity_rating = 3;
		t.base_stats["critical_chance"] = 0.04f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_silver", "$amulet");
		t.material = "silver";
		t.equipment_value = 20;
		t.setCost(0, "silver", 1, "gems", 1);
		t.rigidity_rating = 2;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 10f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_iron", "$amulet");
		t.material = "iron";
		t.equipment_value = 30;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 2, "gems", 1);
		t.rigidity_rating = 4;
		t.base_stats["critical_chance"] = 0.06f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_steel", "$amulet");
		t.material = "steel";
		t.equipment_value = 40;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 3, "gems", 1);
		t.rigidity_rating = 5;
		t.base_stats["critical_chance"] = 0.07f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_mythril", "$amulet");
		t.material = "mythril";
		t.equipment_value = 50;
		t.setCost(0, "mythril", 1, "gems", 1);
		t.rigidity_rating = 6;
		t.base_stats["critical_chance"] = 0.08f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("amulet_adamantine", "$amulet");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.setCost(0, "adamantine", 1, "gems", 1);
		t.rigidity_rating = 7;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["mana"] = 20f;
		t.base_stats["stamina"] = 5f;
	}

	private void initHelmets()
	{
		clone("helmet_leather", "$helmet");
		t.material = "leather";
		t.equipment_value = 5;
		t.setCost(0, "leather", 1);
		t.rigidity_rating = 1;
		t.base_stats["armor"] = 2f;
		t.base_stats["stamina"] = 10f;
		t.base_stats["speed"] = 1f;
		clone("helmet_copper", "$helmet");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["armor"] = 3f;
		t.base_stats["stamina"] = 5f;
		clone("helmet_bronze", "$helmet");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["armor"] = 4f;
		t.base_stats["stamina"] = 5f;
		clone("helmet_silver", "$helmet");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["armor"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("helmet_iron", "$helmet");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["armor"] = 6f;
		t.base_stats["stamina"] = 5f;
		clone("helmet_steel", "$helmet");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["armor"] = 7f;
		t.base_stats["stamina"] = 5f;
		clone("helmet_mythril", "$helmet");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["armor"] = 8f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("helmet_adamantine", "$helmet");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["armor"] = 10f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initArmors()
	{
		clone("armor_leather", "$armor");
		t.material = "leather";
		t.equipment_value = 5;
		t.setCost(0, "leather", 1);
		t.rigidity_rating = 1;
		t.base_stats["armor"] = 2f;
		t.base_stats["stamina"] = 20f;
		t.base_stats["speed"] = 1f;
		clone("armor_copper", "$armor");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["armor"] = 3f;
		t.base_stats["stamina"] = 15f;
		clone("armor_bronze", "$armor");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["armor"] = 4f;
		t.base_stats["stamina"] = 10f;
		clone("armor_silver", "$armor");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["armor"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("armor_iron", "$armor");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["armor"] = 6f;
		t.base_stats["stamina"] = 5f;
		clone("armor_steel", "$armor");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["armor"] = 7f;
		t.base_stats["stamina"] = 5f;
		clone("armor_mythril", "$armor");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["armor"] = 8f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 5f;
		clone("armor_adamantine", "$armor");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["armor"] = 10f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 5f;
	}

	private void initBoots()
	{
		clone("boots_leather", "$boots");
		t.material = "leather";
		t.equipment_value = 5;
		t.setCost(0, "leather", 1);
		t.rigidity_rating = 1;
		t.base_stats["armor"] = 2f;
		t.base_stats["stamina"] = 10f;
		t.base_stats["speed"] = 1f;
		clone("boots_copper", "$boots");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["armor"] = 3f;
		t.base_stats["stamina"] = 5f;
		clone("boots_bronze", "$boots");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["armor"] = 4f;
		t.base_stats["stamina"] = 5f;
		clone("boots_silver", "$boots");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["armor"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("boots_iron", "$boots");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["armor"] = 6f;
		t.base_stats["stamina"] = 5f;
		clone("boots_steel", "$boots");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["armor"] = 7f;
		t.base_stats["stamina"] = 5f;
		clone("boots_mythril", "$boots");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["armor"] = 8f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("boots_adamantine", "$boots");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["armor"] = 10f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initRings()
	{
		clone("ring_bone", "$ring");
		t.material = "bone";
		t.equipment_value = 5;
		t.setCost(0, "bones", 1, "gems", 1);
		t.rigidity_rating = 1;
		t.base_stats["critical_chance"] = 0.02f;
		t.base_stats["stamina"] = 5f;
		clone("ring_copper", "$ring");
		t.material = "copper";
		t.equipment_value = 10;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1, "gems", 1);
		t.rigidity_rating = 2;
		t.base_stats["critical_chance"] = 0.03f;
		t.base_stats["stamina"] = 5f;
		clone("ring_bronze", "$ring");
		t.material = "bronze";
		t.equipment_value = 15;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 1, "gems", 1);
		t.rigidity_rating = 3;
		t.base_stats["critical_chance"] = 0.04f;
		t.base_stats["stamina"] = 5f;
		clone("ring_silver", "$ring");
		t.material = "silver";
		t.equipment_value = 20;
		t.setCost(0, "silver", 1, "gems", 1);
		t.rigidity_rating = 2;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 10f;
		t.base_stats["stamina"] = 5f;
		clone("ring_iron", "$ring");
		t.material = "iron";
		t.equipment_value = 30;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 2, "gems", 1);
		t.rigidity_rating = 4;
		t.base_stats["critical_chance"] = 0.06f;
		t.base_stats["stamina"] = 5f;
		clone("ring_steel", "$ring");
		t.material = "steel";
		t.equipment_value = 40;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "common_metals", 3, "gems", 1);
		t.rigidity_rating = 5;
		t.base_stats["critical_chance"] = 0.07f;
		t.base_stats["stamina"] = 5f;
		clone("ring_mythril", "$ring");
		t.material = "mythril";
		t.equipment_value = 50;
		t.setCost(0, "mythril", 1, "gems", 1);
		t.rigidity_rating = 6;
		t.base_stats["critical_chance"] = 0.08f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("ring_adamantine", "$ring");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.setCost(0, "adamantine", 1, "gems", 1);
		t.rigidity_rating = 7;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["mana"] = 20f;
		t.base_stats["stamina"] = 5f;
	}

	private void initTemplates()
	{
		EquipmentAsset obj = new EquipmentAsset
		{
			id = "$equipment",
			pool = "equipment",
			equipment_subtype = "basic"
		};
		EquipmentAsset pAsset = obj;
		t = obj;
		add(pAsset);
		initTemplatesEquipment();
		initTemplatesWeapons();
	}

	private void initTemplatesEquipment()
	{
		clone("$armor", "$equipment");
		t.equipment_type = EquipmentType.Armor;
		t.name_class = "item_class_armor";
		t.equipment_subtype = "armor";
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("armor_name");
		t.group_id = "armor";
		clone("$boots", "$equipment");
		t.equipment_type = EquipmentType.Boots;
		t.name_class = "item_class_armor";
		t.equipment_subtype = "boots";
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("boots_name");
		t.group_id = "boots";
		clone("$helmet", "$equipment");
		t.equipment_type = EquipmentType.Helmet;
		t.name_class = "item_class_armor";
		t.equipment_subtype = "helmet";
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("helmet_name");
		t.group_id = "helmet";
		clone("$accessory", "$equipment");
		t.name_class = "item_class_accessory";
		clone("$ring", "$accessory");
		t.equipment_subtype = "ring";
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("ring_name");
		t.equipment_type = EquipmentType.Ring;
		t.group_id = "ring";
		clone("$amulet", "$accessory");
		t.equipment_type = EquipmentType.Amulet;
		t.equipment_subtype = "amulet";
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("amulet_name");
		t.group_id = "amulet";
	}

	private void initTemplatesWeapons()
	{
		clone("$weapon", "$equipment");
		t.material = "basic";
		t.group_id = "sword";
		t.equipment_type = EquipmentType.Weapon;
		t.path_slash_animation = "effects/slashes/slash_base";
		t.name_class = "item_class_weapon";
		t.base_stats["damage_range"] = 0.5f;
		clone("$melee", "$weapon");
		t.pool = "melee";
		clone("$range", "$weapon");
		t.pool = "range";
		t.attack_type = WeaponType.Range;
		t.base_stats["projectiles"] = 1f;
		t.base_stats["damage_range"] = 0.6f;
		clone("$bow", "$range");
		t.equipment_subtype = "bow";
		t.is_pool_weapon = true;
		t.pool_rate = 10;
		t.projectile = "arrow";
		t.path_slash_animation = "effects/slashes/slash_bow";
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["recoil"] = 1f;
		t.name_templates = new List<string>();
		t.name_templates.AddTimes(30, "bow_name");
		t.name_templates.Add("weapon_name_city");
		t.name_templates.Add("weapon_name_kingdom");
		t.name_templates.Add("weapon_name_culture");
		t.name_templates.Add("weapon_name_enemy_king");
		t.name_templates.Add("weapon_name_enemy_kingdom");
		t.group_id = "bow";
		clone("$sword", "$melee");
		t.equipment_subtype = "sword";
		t.is_pool_weapon = true;
		t.pool_rate = 10;
		t.path_slash_animation = "effects/slashes/slash_sword";
		t.base_stats["damage"] = 1f;
		t.base_stats["damage_range"] = 0.8f;
		t.name_templates = new List<string>();
		t.name_templates.AddTimes(30, "sword_name");
		t.name_templates.AddTimes(3, "sword_name_king");
		t.name_templates.Add("weapon_name_city");
		t.name_templates.Add("weapon_name_kingdom");
		t.name_templates.Add("weapon_name_culture");
		t.name_templates.Add("weapon_name_enemy_king");
		t.name_templates.Add("weapon_name_enemy_kingdom");
		t.group_id = "sword";
		clone("$axe", "$melee");
		t.equipment_subtype = "axe";
		t.is_pool_weapon = true;
		t.pool_rate = 10;
		t.path_slash_animation = "effects/slashes/slash_axe";
		t.base_stats["damage_range"] = 0.6f;
		t.name_templates = new List<string>();
		t.name_templates.AddTimes(30, "axe_name");
		t.name_templates.AddTimes(3, "axe_name_king");
		t.name_templates.Add("weapon_name_city");
		t.name_templates.Add("weapon_name_kingdom");
		t.name_templates.Add("weapon_name_culture");
		t.name_templates.Add("weapon_name_enemy_king");
		t.name_templates.Add("weapon_name_enemy_kingdom");
		t.group_id = "axe";
		clone("$hammer", "$melee");
		t.equipment_subtype = "hammer";
		t.is_pool_weapon = true;
		t.pool_rate = 10;
		t.path_slash_animation = "effects/slashes/slash_hammer";
		t.base_stats["targets"] = 2f;
		t.base_stats["damage_range"] = 0.1f;
		t.name_templates = new List<string>();
		t.name_templates.AddTimes(30, "hammer_name");
		t.name_templates.Add("weapon_name_city");
		t.name_templates.Add("weapon_name_kingdom");
		t.name_templates.Add("weapon_name_culture");
		t.name_templates.Add("weapon_name_enemy_king");
		t.name_templates.Add("weapon_name_enemy_kingdom");
		t.group_id = "hammer";
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("stun");
		clone("$spear", "$melee");
		t.equipment_subtype = "spear";
		t.is_pool_weapon = true;
		t.pool_rate = 10;
		t.path_slash_animation = "effects/slashes/slash_spear";
		t.base_stats["range"] = 1f;
		t.base_stats["damage_range"] = 0.7f;
		t.name_templates = new List<string>();
		t.name_templates.AddTimes(30, "spear_name");
		t.name_templates.Add("weapon_name_city");
		t.name_templates.Add("weapon_name_kingdom");
		t.name_templates.Add("weapon_name_culture");
		t.name_templates.Add("weapon_name_enemy_king");
		t.name_templates.Add("weapon_name_enemy_kingdom");
		t.group_id = "spear";
	}

	private void initNormalWeapons()
	{
		initWeaponsBasic();
		initWeaponsAdvanced();
	}

	private void initWeaponsAdvanced()
	{
		initWeaponsBows();
		initWeaponsSwords();
		initWeaponsAxes();
		initWeaponsSpears();
		initWeaponsHammers();
	}

	private void initWeaponsBasic()
	{
		clone("stick_wood", "$melee");
		t.equipment_subtype = "stick";
		t.material = "wood";
		t.is_pool_weapon = true;
		t.pool_rate = 10;
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.name_templates = new List<string>();
		t.name_templates.AddTimes(30, "stick_name");
		t.name_templates.Add("weapon_name_city");
		t.name_templates.Add("weapon_name_kingdom");
		t.name_templates.Add("weapon_name_culture");
		t.name_templates.Add("weapon_name_enemy_king");
		t.name_templates.Add("weapon_name_enemy_kingdom");
		t.group_id = "staff";
		t.equipment_value = 1;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "wood", 1);
		t.rigidity_rating = 1;
		t.base_stats["damage"] = 1f;
		t.base_stats["stamina"] = 5f;
		t.base_stats["mana"] = 5f;
	}

	private void initWeaponsSwords()
	{
		clone("sword_wood", "$sword");
		t.material = "wood";
		t.equipment_value = 1;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "wood", 1);
		t.rigidity_rating = 1;
		t.base_stats["damage"] = 1f;
		t.base_stats["stamina"] = 15f;
		clone("sword_stone", "$sword");
		t.material = "stone";
		t.equipment_value = 10;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "stone", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["speed"] = -2f;
		clone("sword_copper", "$sword");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["stamina"] = 10f;
		clone("sword_bronze", "$sword");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["damage"] = 4f;
		t.base_stats["stamina"] = 5f;
		clone("sword_silver", "$sword");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("sword_iron", "$sword");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["damage"] = 6f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("sword_steel", "$sword");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["damage"] = 7f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("sword_mythril", "$sword");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 8f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("sword_adamantine", "$sword");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["damage"] = 10f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initWeaponsBows()
	{
		clone("bow_wood", "$bow");
		t.material = "wood";
		t.equipment_value = 1;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "wood", 1);
		t.rigidity_rating = 1;
		t.base_stats["damage"] = 1f;
		t.base_stats["range"] = 6f;
		t.base_stats["stamina"] = 15f;
		clone("bow_copper", "$bow");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["range"] = 6f;
		t.base_stats["stamina"] = 10f;
		clone("bow_bronze", "$bow");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["damage"] = 4f;
		t.base_stats["range"] = 7f;
		t.base_stats["stamina"] = 5f;
		clone("bow_silver", "$bow");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 5f;
		t.base_stats["range"] = 8f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("bow_iron", "$bow");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["damage"] = 6f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["range"] = 9f;
		t.base_stats["stamina"] = 5f;
		clone("bow_steel", "$bow");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["damage"] = 7f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["range"] = 10f;
		t.base_stats["stamina"] = 5f;
		clone("bow_mythril", "$bow");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 8f;
		t.base_stats["range"] = 11f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("bow_adamantine", "$bow");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["damage"] = 10f;
		t.base_stats["range"] = 12f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initWeaponsAxes()
	{
		clone("axe_wood", "$axe");
		t.material = "wood";
		t.equipment_value = 1;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "wood", 1);
		t.rigidity_rating = 1;
		t.base_stats["damage"] = 1f;
		t.base_stats["stamina"] = 15f;
		clone("axe_stone", "$axe");
		t.material = "stone";
		t.equipment_value = 10;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "stone", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["speed"] = -2f;
		clone("axe_copper", "$axe");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["stamina"] = 10f;
		clone("axe_bronze", "$axe");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["damage"] = 4f;
		t.base_stats["stamina"] = 5f;
		clone("axe_silver", "$axe");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("axe_iron", "$axe");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["damage"] = 6f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("axe_steel", "$axe");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["damage"] = 7f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("axe_mythril", "$axe");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 8f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("axe_adamantine", "$axe");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["damage"] = 10f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initWeaponsSpears()
	{
		clone("spear_wood", "$spear");
		t.material = "wood";
		t.equipment_value = 1;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "wood", 1);
		t.rigidity_rating = 1;
		t.base_stats["damage"] = 1f;
		t.base_stats["stamina"] = 15f;
		clone("spear_stone", "$spear");
		t.material = "stone";
		t.equipment_value = 10;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "stone", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["speed"] = -2f;
		clone("spear_copper", "$spear");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["stamina"] = 10f;
		clone("spear_bronze", "$spear");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["damage"] = 4f;
		t.base_stats["stamina"] = 5f;
		clone("spear_silver", "$spear");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("spear_iron", "$spear");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["damage"] = 6f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("spear_steel", "$spear");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["damage"] = 7f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("spear_mythril", "$spear");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 8f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("spear_adamantine", "$spear");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["damage"] = 10f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initWeaponsHammers()
	{
		clone("hammer_wood", "$hammer");
		t.material = "wood";
		t.equipment_value = 1;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "wood", 1);
		t.rigidity_rating = 1;
		t.base_stats["damage"] = 1f;
		t.base_stats["stamina"] = 15f;
		clone("hammer_stone", "$hammer");
		t.material = "stone";
		t.equipment_value = 10;
		t.minimum_city_storage_resource_1 = 15;
		t.setCost(0, "stone", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["speed"] = -2f;
		clone("hammer_copper", "$hammer");
		t.material = "copper";
		t.equipment_value = 10;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 3f;
		t.base_stats["stamina"] = 10f;
		clone("hammer_bronze", "$hammer");
		t.material = "bronze";
		t.equipment_value = 15;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 2);
		t.rigidity_rating = 3;
		t.base_stats["damage"] = 4f;
		t.base_stats["stamina"] = 5f;
		clone("hammer_silver", "$hammer");
		t.material = "silver";
		t.equipment_value = 20;
		t.metallic = true;
		t.setCost(0, "silver", 1);
		t.rigidity_rating = 2;
		t.base_stats["damage"] = 5f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 5f;
		clone("hammer_iron", "$hammer");
		t.material = "iron";
		t.equipment_value = 30;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 3);
		t.rigidity_rating = 4;
		t.base_stats["damage"] = 6f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("hammer_steel", "$hammer");
		t.material = "steel";
		t.equipment_value = 40;
		t.metallic = true;
		t.minimum_city_storage_resource_1 = 10;
		t.setCost(0, "common_metals", 4);
		t.rigidity_rating = 5;
		t.base_stats["damage"] = 7f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["stamina"] = 5f;
		clone("hammer_mythril", "$hammer");
		t.material = "mythril";
		t.equipment_value = 50;
		t.metallic = true;
		t.setCost(0, "mythril", 1);
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 8f;
		t.base_stats["critical_chance"] = 0.05f;
		t.base_stats["mana"] = 25f;
		t.base_stats["stamina"] = 10f;
		clone("hammer_adamantine", "$hammer");
		t.material = "adamantine";
		t.equipment_value = 70;
		t.metallic = true;
		t.setCost(0, "adamantine", 1);
		t.rigidity_rating = 7;
		t.base_stats["damage"] = 10f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["mana"] = 35f;
		t.base_stats["stamina"] = 10f;
	}

	private void initWeaponsUnique()
	{
		clone("alien_blaster", "$range");
		t.setUnlockedWithAchievement("achievementEquipmentExplorer");
		t.equipment_subtype = "alien_blaster";
		t.setCost(100, "adamantine", 10, "gems", 20);
		t.rigidity_rating = 7;
		t.is_pool_weapon = true;
		t.pool_rate = 1;
		t.path_icon = "ui/Icons/items/icon_alien_blaster";
		t.material = "basic";
		t.projectile = "plasma_ball";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.base_stats["range"] = 20f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["targets"] = 1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["damage_range"] = 0.6f;
		t.base_stats["mana"] = 20f;
		t.base_stats["stamina"] = 20f;
		t.equipment_value = 500;
		t.base_stats["damage"] = 30f;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("blaster_name");
		t.group_id = "firearm";
		clone("shotgun", "$range");
		t.setUnlockedWithAchievement("achievementTLDR");
		t.equipment_subtype = "shotgun";
		t.setCost(100, "adamantine", 10, "mythril", 5);
		t.rigidity_rating = 6;
		t.is_pool_weapon = true;
		t.pool_rate = 1;
		t.path_icon = "ui/Icons/items/icon_shotgun";
		t.projectile = "shotgun_bullet";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.base_stats["projectiles"] = 12f;
		t.base_stats["range"] = 10f;
		t.base_stats["targets"] = 1f;
		t.base_stats["damage"] = 10f;
		t.base_stats["damage_range"] = 0.9f;
		t.base_stats["mana"] = 5f;
		t.base_stats["stamina"] = 10f;
		t.equipment_value = 600;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("shotgun_name");
		t.group_id = "firearm";
		clone("flame_hammer", "$weapon");
		t.setUnlockedWithAchievement("achievementGodlySmithing");
		t.equipment_subtype = "flame_hammer";
		t.setCost(10, "dragon_scales", 3);
		t.is_pool_weapon = true;
		t.animated = true;
		t.pool_rate = 2;
		t.material = "basic";
		t.path_slash_animation = "effects/slashes/slash_hammer";
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 20f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["targets"] = 3f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 15f;
		t.equipment_value = 400;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("flame_hammer_name");
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("flame");
		t.group_id = "hammer";
		clone("ice_hammer", "$weapon");
		t.setUnlockedWithAchievement("achievementMakeWilhelmScream");
		t.equipment_subtype = "ice_hammer";
		t.setCost(10, "mythril", 10, "gems", 2);
		t.rigidity_rating = 6;
		t.is_pool_weapon = true;
		t.animated = true;
		t.pool_rate = 2;
		t.material = "basic";
		t.path_slash_animation = "effects/slashes/slash_hammer";
		t.base_stats["damage"] = 20f;
		t.base_stats["speed"] = 1f;
		t.base_stats["critical_chance"] = 0.15f;
		t.base_stats["targets"] = 3f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 15f;
		t.equipment_value = 400;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("ice_hammer_name");
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("ice", "stun");
		t.group_id = "hammer";
		clone("flame_sword", "$weapon");
		t.equipment_subtype = "flame_sword";
		t.setCost(0, "dragon_scales", 2);
		t.is_pool_weapon = true;
		t.animated = true;
		t.pool_rate = 2;
		t.material = "basic";
		t.path_slash_animation = "effects/slashes/slash_sword";
		t.rigidity_rating = 6;
		t.base_stats["damage"] = 33f;
		t.base_stats["targets"] = 2f;
		t.base_stats["critical_damage_multiplier"] = 0.1f;
		t.base_stats["mana"] = 15f;
		t.base_stats["stamina"] = 15f;
		t.equipment_value = 300;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("flame_sword_name");
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("flame");
		t.group_id = "sword";
		t.base_stats.addTag("building_immunity_fire");
		clone("necromancer_staff", "$range");
		t.equipment_subtype = "necromancer_staff";
		t.setCost(10, "mythril", 2, "gems", 3);
		t.is_pool_weapon = true;
		t.pool_rate = 1;
		t.material = "basic";
		t.projectile = "skull";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.rigidity_rating = 5;
		t.base_stats["range"] = 13f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["targets"] = 1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["mana"] = 40f;
		t.equipment_value = 500;
		t.base_stats["damage"] = 30f;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("necromancer_staff_name");
		t.group_id = "staff";
		t.addSpell("spawn_skeleton");
		t.addSpell("cast_curse");
		clone("evil_staff", "$range");
		t.equipment_subtype = "evil_staff";
		t.setCost(20, "mythril", 3, "gems", 2);
		t.is_pool_weapon = true;
		t.durability = 300;
		t.pool_rate = 1;
		t.material = "basic";
		t.projectile = "red_orb";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.rigidity_rating = 5;
		t.base_stats["range"] = 13f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["targets"] = 1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["mana"] = 40f;
		t.equipment_value = 500;
		t.base_stats["projectiles"] = 20f;
		t.base_stats["damage"] = 10f;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("evil_staff_name");
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("flame");
		t.group_id = "staff";
		t.base_stats.addTag("building_immunity_fire");
		t.addSpell("cast_fire");
		clone("white_staff", "$range");
		t.equipment_subtype = "white_staff";
		t.setCost(20, "mythril", 3, "gems", 2);
		t.is_pool_weapon = true;
		t.durability = 300;
		t.pool_rate = 3;
		t.material = "basic";
		t.projectile = "freeze_orb";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.rigidity_rating = 5;
		t.base_stats["range"] = 18f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["targets"] = 1f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["damage"] = 35f;
		t.base_stats["mana"] = 40f;
		t.equipment_value = 500;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("white_staff_name");
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("ice");
		t.group_id = "staff";
		t.addSpell("cast_blood_rain");
		t.addSpell("summon_lightning");
		clone("plague_doctor_staff", "$weapon");
		t.equipment_subtype = "plague_doctor_staff";
		t.setCost(5, "mythril", 2, "gems", 1);
		t.is_pool_weapon = true;
		t.pool_rate = 3;
		t.material = "basic";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.rigidity_rating = 5;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["targets"] = 3f;
		t.base_stats["critical_damage_multiplier"] = 0.5f;
		t.base_stats["damage"] = 35f;
		t.base_stats["mana"] = 40f;
		t.equipment_value = 200;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("plague_doctor_staff_name");
		t.group_id = "staff";
		t.addSpell("cast_fire");
		t.addSpell("cast_cure");
		clone("druid_staff", "$range");
		t.equipment_subtype = "druid_staff";
		t.setCost(7, "mythril", 3, "gems", 1);
		t.is_pool_weapon = true;
		t.pool_rate = 3;
		t.material = "basic";
		t.projectile = "green_orb";
		t.path_slash_animation = "effects/slashes/slash_punch";
		t.rigidity_rating = 5;
		t.base_stats["range"] = 20f;
		t.base_stats["critical_chance"] = 0.1f;
		t.base_stats["targets"] = 1f;
		t.base_stats["critical_damage_multiplier"] = 0.3f;
		t.base_stats["damage"] = 12f;
		t.base_stats["mana"] = 40f;
		t.equipment_value = 300;
		t.base_stats["projectiles"] = 2f;
		t.name_templates = AssetLibrary<EquipmentAsset>.l<string>("druid_staff_name");
		t.item_modifier_ids = AssetLibrary<EquipmentAsset>.a<string>("slowness");
		t.group_id = "staff";
		t.addSpell("cast_blood_rain");
		t.addSpell("spawn_vegetation");
	}
}
// --- End of File: ItemLibrary.cs ---



// --- Start of File: ItemManager.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using UnityPools;

public class ItemManager : CoreSystemManager<Item, ItemData>
{
	private HashSet<string> unique_legendary_names = new HashSet<string>();

	private List<Item> _to_remove = new List<Item>();

	private bool _dirty;

	public ItemManager()
	{
		type_id = "item";
		MapBox.on_world_loaded = (Action)Delegate.Combine(MapBox.on_world_loaded, (Action)delegate
		{
			diagnostic();
		});
	}

	public bool isDirty()
	{
		return _dirty;
	}

	public void setDirty()
	{
		_dirty = true;
	}

	public Item newItem(EquipmentAsset pAsset)
	{
		Item item = newObject();
		item.newItem(pAsset);
		return item;
	}

	public void diagnostic()
	{
		Dictionary<Item, int> dictionary = UnsafeCollectionPool<Dictionary<Item, int>, KeyValuePair<Item, int>>.Get();
		Dictionary<Item, int> dictionary2 = UnsafeCollectionPool<Dictionary<Item, int>, KeyValuePair<Item, int>>.Get();
		foreach (City city in World.world.cities)
		{
			foreach (List<long> allEquipmentList in city.data.equipment.getAllEquipmentLists())
			{
				foreach (long item3 in allEquipmentList)
				{
					Item item = get(item3);
					if (item != null)
					{
						if (!dictionary.ContainsKey(item))
						{
							dictionary.Add(item, 0);
						}
						dictionary[item]++;
					}
				}
			}
		}
		foreach (Actor unit in World.world.units)
		{
			if (!unit.hasEquipment())
			{
				continue;
			}
			foreach (ActorEquipmentSlot item4 in unit.equipment)
			{
				Item item2 = item4.getItem();
				if (item2 != null)
				{
					if (!dictionary2.ContainsKey(item2))
					{
						dictionary2.Add(item2, 0);
					}
					dictionary2[item2]++;
				}
			}
		}
		foreach (Item item5 in list)
		{
			if (dictionary.ContainsKey(item5) && dictionary2.ContainsKey(item5))
			{
				Debug.LogError((object)("Item Error. Item in city and in unit " + item5.id));
			}
		}
		UnsafeCollectionPool<Dictionary<Item, int>, KeyValuePair<Item, int>>.Release(dictionary);
		UnsafeCollectionPool<Dictionary<Item, int>, KeyValuePair<Item, int>>.Release(dictionary2);
	}

	public override Item loadObject(ItemData pData)
	{
		if (AssetManager.items.get(pData.asset_id) == null)
		{
			return null;
		}
		return base.loadObject(pData);
	}

	private List<ItemModAsset> getModPool(EquipmentType pType)
	{
		switch (pType)
		{
		case EquipmentType.Ring:
		case EquipmentType.Amulet:
			return AssetManager.items_modifiers.pools["accessory"];
		case EquipmentType.Weapon:
			return AssetManager.items_modifiers.pools["weapon"];
		default:
			return AssetManager.items_modifiers.pools["armor"];
		}
	}

	private ItemModAsset getRandomModFromPool(EquipmentType pType)
	{
		return getModPool(pType).GetRandom();
	}

	public void generateModsFor(Item pItem, int pTries = 1, Actor pActor = null, bool pAddName = true)
	{
		EquipmentAsset asset = pItem.getAsset();
		using ListPool<string> listPool = new ListPool<string>();
		for (int i = 0; i < pTries; i++)
		{
			if (Randy.randomBool())
			{
				continue;
			}
			ItemModAsset randomModFromPool = getRandomModFromPool(asset.equipment_type);
			if (randomModFromPool.mod_can_be_given)
			{
				bool flag = tryToAddMod(pItem, randomModFromPool);
				if (pAddName && flag && checkModName(pItem, randomModFromPool, asset, pActor, out var pName))
				{
					listPool.Add(pName);
				}
			}
		}
		if (asset.item_modifiers != null)
		{
			for (int j = 0; j < asset.item_modifiers.Length; j++)
			{
				ItemModAsset pModAsset = asset.item_modifiers[j];
				bool flag2 = tryToAddMod(pItem, pModAsset);
				if (pAddName && flag2 && checkModName(pItem, pModAsset, asset, pActor, out var pName2))
				{
					listPool.Add(pName2);
				}
			}
		}
		listPool.RemoveAll((string tName) => string.IsNullOrEmpty(tName));
		if (listPool.Count > 0)
		{
			pItem.setName(Randy.getRandom(listPool));
		}
	}

	public Item generateItem(EquipmentAsset pItemAsset, Kingdom pKingdom = null, string pWho = null, int pTries = 1, Actor pActor = null, int pFakeCreationYear = 0, bool pByPlayer = false)
	{
		Item item = newItem(pItemAsset);
		generateModsFor(item, pTries, pActor);
		item.data.asset_id = pItemAsset.id;
		item.data.by = pWho;
		if (!pByPlayer && !pActor.isRekt() && pActor.name == pWho)
		{
			item.data.creator_id = pActor.getID();
		}
		else
		{
			item.data.creator_id = -1L;
		}
		item.created_time_unscaled = Time.time;
		item.data.created_time -= (float)pFakeCreationYear * 60f;
		item.data.created_by_player = pByPlayer;
		if (pKingdom != null)
		{
			item.data.byColor = pKingdom.getColor().color_text;
			item.data.creator_kingdom_id = pKingdom.id;
			item.data.from = pKingdom.name;
			item.data.fromColor = pKingdom.getColor().color_text;
		}
		item.initItem();
		return item;
	}

	public override void removeObject(Item pObject)
	{
		base.removeObject(pObject);
		pObject.setShouldBeRemoved();
	}

	public override void clear()
	{
		base.clear();
		unique_legendary_names.Clear();
	}

	private bool tryToAddMod(Item pItem, ItemModAsset pModAsset)
	{
		return pItem.addMod(pModAsset);
	}

	private bool checkModName(Item pItem, ItemModAsset pModAsset, EquipmentAsset pItemAsset, Actor pActor, out string pName)
	{
		pName = null;
		if (pModAsset.quality == Rarity.R3_Legendary)
		{
			int num = 0;
			while (string.IsNullOrEmpty(pName) || unique_legendary_names.Contains(pName))
			{
				string randomNameTemplate = pItemAsset.getRandomNameTemplate(pActor);
				NameGeneratorAsset pAsset = AssetManager.name_generator.get(randomNameTemplate);
				pName = NameGenerator.generateNameFromTemplate(pAsset, pActor);
				if (++num > 100)
				{
					unique_legendary_names.Clear();
				}
			}
			return true;
		}
		return false;
	}

	public override void checkDeadObjects()
	{
		base.checkDeadObjects();
		if (!isDirty())
		{
			return;
		}
		using (IEnumerator<Item> enumerator = GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				Item current = enumerator.Current;
				if (current.isReadyForRemoval())
				{
					_to_remove.Add(current);
				}
			}
		}
		foreach (Item item in _to_remove)
		{
			removeObject(item);
		}
		_to_remove.Clear();
		_dirty = false;
	}
}
// --- End of File: ItemManager.cs ---



// --- Start of File: ItemModAsset.cs ---
using System;

[Serializable]
public class ItemModAsset : ItemAsset
{
}
// --- End of File: ItemModAsset.cs ---



// --- Start of File: ItemModifierLibrary.cs ---
using System.Collections.Generic;

public class ItemModifierLibrary : ItemAssetLibrary<ItemModAsset>
{
	public const string WEAPON = "weapon";

	public const string ACCESSORY = "accessory";

	public const string ARMOR = "armor";

	public const string ALL = "weapon,accessory,armor";

	public Dictionary<string, List<ItemModAsset>> pools = new Dictionary<string, List<ItemModAsset>>();

	public override void init()
	{
		base.init();
		ItemModAsset obj = new ItemModAsset
		{
			id = "normal",
			mod_type = "normal",
			pool = "weapon,accessory,armor",
			rarity = 5,
			mod_can_be_given = false,
			has_locales = false
		};
		ItemModAsset pAsset = obj;
		t = obj;
		add(pAsset);
		ItemModAsset obj2 = new ItemModAsset
		{
			id = "power1",
			mod_type = "power",
			translation_key = "mod_power",
			rarity = 1,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj2;
		t = obj2;
		add(pAsset);
		t.base_stats["damage"] = 1f;
		clone("power2", "power1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["damage"] = 2f;
		clone("power3", "power1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["damage"] = 3f;
		clone("power4", "power1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["damage"] = 4f;
		clone("power5", "power1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["damage"] = 5f;
		ItemModAsset obj3 = new ItemModAsset
		{
			id = "truth1",
			mod_type = "truth",
			translation_key = "mod_truth",
			rarity = 1,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj3;
		t = obj3;
		add(pAsset);
		t.base_stats["diplomacy"] = 1f;
		clone("truth2", "truth1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["diplomacy"] = 2f;
		clone("truth3", "truth1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["diplomacy"] = 3f;
		clone("truth4", "truth1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["diplomacy"] = 4f;
		clone("truth5", "truth1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["diplomacy"] = 5f;
		ItemModAsset obj4 = new ItemModAsset
		{
			id = "protection1",
			mod_type = "protection",
			translation_key = "mod_protection",
			rarity = 1,
			pool = "armor"
		};
		pAsset = obj4;
		t = obj4;
		add(pAsset);
		t.base_stats["armor"] = 3f;
		clone("protection2", "protection1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["armor"] = 4f;
		clone("protection3", "protection1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["armor"] = 5f;
		clone("protection4", "protection1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["armor"] = 6f;
		clone("protection5", "protection1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["armor"] = 7f;
		ItemModAsset obj5 = new ItemModAsset
		{
			id = "speed1",
			mod_type = "speed",
			translation_key = "mod_speed",
			rarity = 3,
			pool = "weapon,accessory,armor"
		};
		pAsset = obj5;
		t = obj5;
		add(pAsset);
		t.base_stats["speed"] = 2f;
		clone("speed2", "speed1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["speed"] = 3f;
		clone("speed3", "speed1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["speed"] = 4f;
		clone("speed4", "speed1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["speed"] = 5f;
		clone("speed5", "speed1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["speed"] = 6f;
		ItemModAsset obj6 = new ItemModAsset
		{
			id = "balance1",
			mod_type = "balance",
			translation_key = "mod_balance",
			rarity = 3,
			pool = "weapon,accessory,armor"
		};
		pAsset = obj6;
		t = obj6;
		add(pAsset);
		t.base_stats["critical_chance"] = 0.05f;
		clone("balance2", "balance1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["critical_chance"] = 0.15f;
		clone("balance3", "balance1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["critical_chance"] = 0.2f;
		clone("balance4", "balance1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["critical_chance"] = 0.25f;
		clone("balance5", "balance1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["critical_chance"] = 0.3f;
		ItemModAsset obj7 = new ItemModAsset
		{
			id = "health1",
			mod_type = "health",
			translation_key = "mod_health",
			rarity = 1,
			pool = "armoraccessory"
		};
		pAsset = obj7;
		t = obj7;
		add(pAsset);
		t.base_stats["health"] = 50f;
		clone("health2", "health1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["health"] = 100f;
		clone("health3", "health1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["health"] = 150f;
		clone("health4", "health1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["health"] = 200f;
		clone("health5", "health1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["health"] = 250f;
		ItemModAsset obj8 = new ItemModAsset
		{
			id = "finesse1",
			mod_type = "finesse",
			translation_key = "mod_finesse",
			rarity = 1,
			pool = "weaponaccessory"
		};
		pAsset = obj8;
		t = obj8;
		add(pAsset);
		t.base_stats["attack_speed"] = 1f;
		clone("finesse2", "finesse1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["attack_speed"] = 1f;
		t.base_stats["speed"] = 1f;
		clone("finesse3", "finesse1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["attack_speed"] = 2f;
		t.base_stats["speed"] = 1f;
		clone("finesse4", "finesse1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["attack_speed"] = 2f;
		t.base_stats["speed"] = 2f;
		clone("finesse5", "finesse1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["attack_speed"] = 3f;
		t.base_stats["speed"] = 3f;
		ItemModAsset obj9 = new ItemModAsset
		{
			id = "mastery1",
			mod_type = "mastery",
			translation_key = "mod_mastery",
			rarity = 1,
			pool = "accessory",
			mod_rank = 1
		};
		pAsset = obj9;
		t = obj9;
		add(pAsset);
		t.base_stats["warfare"] = 1f;
		clone("mastery2", "mastery1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["warfare"] = 2f;
		clone("mastery3", "mastery1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["warfare"] = 3f;
		clone("mastery4", "mastery1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["warfare"] = 4f;
		clone("mastery5", "mastery1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["warfare"] = 5f;
		ItemModAsset obj10 = new ItemModAsset
		{
			id = "knowledge1",
			mod_type = "knowledge",
			translation_key = "mod_knowledge",
			rarity = 1,
			pool = "accessory",
			mod_rank = 1
		};
		pAsset = obj10;
		t = obj10;
		add(pAsset);
		t.base_stats["intelligence"] = 1f;
		clone("knowledge2", "knowledge1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["intelligence"] = 2f;
		clone("knowledge3", "knowledge1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["intelligence"] = 3f;
		clone("knowledge4", "knowledge1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["intelligence"] = 4f;
		clone("knowledge5", "knowledge1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["intelligence"] = 7f;
		ItemModAsset obj11 = new ItemModAsset
		{
			id = "sharpness1",
			mod_type = "sharpness",
			translation_key = "mod_sharpness",
			rarity = 1,
			pool = "accessory",
			mod_rank = 1
		};
		pAsset = obj11;
		t = obj11;
		add(pAsset);
		t.base_stats["damage"] = 1f;
		t.base_stats["multiplier_crit"] = 0.05f;
		clone("sharpness2", "sharpness1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 2;
		t.base_stats["damage"] = 2f;
		t.base_stats["multiplier_crit"] = 0.06f;
		clone("sharpness3", "sharpness1");
		t.quality = Rarity.R1_Rare;
		t.mod_rank = 3;
		t.base_stats["damage"] = 3f;
		t.base_stats["multiplier_crit"] = 0.08f;
		clone("sharpness4", "sharpness1");
		t.quality = Rarity.R2_Epic;
		t.mod_rank = 4;
		t.base_stats["damage"] = 5f;
		t.base_stats["multiplier_crit"] = 0.1f;
		clone("sharpness5", "sharpness1");
		t.quality = Rarity.R3_Legendary;
		t.mod_rank = 5;
		t.base_stats["damage"] = 10f;
		t.base_stats["multiplier_crit"] = 0.1f;
		ItemModAsset obj12 = new ItemModAsset
		{
			id = "flame",
			mod_type = "flame",
			translation_key = "mod_flame",
			rarity = 0,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj12;
		t = obj12;
		add(pAsset);
		t.base_stats.addTag("immunity_fire");
		t.action_attack_target = ActionLibrary.addBurningEffectOnTarget;
		t.action_special_effect = ActionLibrary.flamingWeapon;
		t.special_effect_interval = 0.1f;
		ItemModAsset obj13 = new ItemModAsset
		{
			id = "ice",
			mod_type = "ice",
			translation_key = "mod_ice",
			rarity = 0,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj13;
		t = obj13;
		add(pAsset);
		t.base_stats.addTag("immunity_cold");
		t.action_attack_target = ActionLibrary.addFrozenEffectOnTarget20;
		ItemModAsset obj14 = new ItemModAsset
		{
			id = "stun",
			mod_type = "stun",
			translation_key = "mod_stun",
			rarity = 0,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj14;
		t = obj14;
		add(pAsset);
		t.action_attack_target = ActionLibrary.addStunnedEffectOnTarget20;
		ItemModAsset obj15 = new ItemModAsset
		{
			id = "slowness",
			mod_type = "slowness",
			translation_key = "mod_slowness",
			rarity = 0,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj15;
		t = obj15;
		add(pAsset);
		t.action_attack_target = ActionLibrary.addSlowEffectOnTarget20;
		ItemModAsset obj16 = new ItemModAsset
		{
			id = "poison",
			mod_type = "poison",
			translation_key = "mod_poison",
			rarity = 0,
			pool = "weapon",
			mod_rank = 1
		};
		pAsset = obj16;
		t = obj16;
		add(pAsset);
		t.action_attack_target = ActionLibrary.addPoisonedEffectOnTarget;
		ItemModAsset obj17 = new ItemModAsset
		{
			id = "eternal",
			mod_type = "eternal",
			translation_key = "mod_eternal",
			rarity = 0,
			pool = "weapon,accessory,armor",
			mod_rank = 5
		};
		pAsset = obj17;
		t = obj17;
		add(pAsset);
		ItemModAsset obj18 = new ItemModAsset
		{
			id = "cursed",
			mod_type = "cursed",
			translation_key = "mod_cursed",
			rarity = 0,
			pool = "weapon,accessory,armor",
			mod_rank = 5
		};
		pAsset = obj18;
		t = obj18;
		add(pAsset);
		ItemModAsset obj19 = new ItemModAsset
		{
			id = "divine_rune",
			mod_type = "divine_rune",
			translation_key = "divine_rune",
			rarity = 0,
			pool = "weapon,accessory,armor",
			mod_rank = 5
		};
		pAsset = obj19;
		t = obj19;
		add(pAsset);
	}

	public override void linkAssets()
	{
		base.linkAssets();
		pools.Add("weapon", new List<ItemModAsset>());
		pools.Add("armor", new List<ItemModAsset>());
		pools.Add("accessory", new List<ItemModAsset>());
		foreach (ItemModAsset item in list)
		{
			for (int i = 0; i < item.rarity; i++)
			{
				if (item.pool.Contains("weapon"))
				{
					pools["weapon"].Add(item);
				}
				if (item.pool.Contains("armor"))
				{
					pools["armor"].Add(item);
				}
				if (item.pool.Contains("accessory"))
				{
					pools["accessory"].Add(item);
				}
			}
		}
	}
}
// --- End of File: ItemModifierLibrary.cs ---



// --- Start of File: ItemRendering.cs ---
using UnityEngine;

public static class ItemRendering
{
	public static Sprite getItemMainSpriteFrame(IHandRenderer pHandRendererAsset)
	{
		if (pHandRendererAsset == null)
		{
			return null;
		}
		Sprite[] sprites = pHandRendererAsset.getSprites();
		if (sprites.Length > 1)
		{
			return AnimationHelper.getSpriteFromList(0, sprites, 5f);
		}
		return sprites[0];
	}
}
// --- End of File: ItemRendering.cs ---



// --- Start of File: ItemTools.cs ---
using System;

public class ItemTools
{
	public static int s_value;

	public static Rarity s_quality;

	public static void calcItemValues(Item pItem, BaseStats pStats)
	{
		pStats.clear();
		s_value = 0;
		s_quality = Rarity.R0_Normal;
		pItem.action_attack_target = null;
		mergeStatsWithItem(pStats, pItem);
	}

	public static void mergeStatsWithItem(BaseStats pStats, Item pItem, bool pCalcGlobalValue = true, float pMultiplier = 1f)
	{
		EquipmentAsset asset = pItem.getAsset();
		mergeStats(pStats, asset, pCalcGlobalValue, pMultiplier);
		pItem.action_attack_target = null;
		addAction(pItem, asset.action_attack_target);
		foreach (ref string modifier in pItem.data.modifiers)
		{
			string current = modifier;
			ItemModAsset itemModAsset = AssetManager.items_modifiers.get(current);
			mergeStats(pStats, itemModAsset, pCalcGlobalValue, pMultiplier);
			addAction(pItem, itemModAsset.action_attack_target);
		}
	}

	private static void addAction(Item pItem, AttackAction pAction)
	{
		if (pAction != null)
		{
			if (pItem.action_attack_target == null)
			{
				pItem.action_attack_target = pAction;
			}
			else
			{
				pItem.action_attack_target = (AttackAction)Delegate.Combine(pItem.action_attack_target, pAction);
			}
		}
	}

	public static void mergeStats(BaseStats pStats, ItemAsset pAsset, bool pCalcGlobalValue = true, float pMultiplier = 1f)
	{
		if (pAsset == null)
		{
			return;
		}
		pStats.mergeStats(pAsset.base_stats, pMultiplier);
		if (pCalcGlobalValue)
		{
			if (pAsset.quality > s_quality)
			{
				s_quality = pAsset.quality;
			}
			s_value += pAsset.equipment_value + pAsset.mod_rank * 2;
		}
	}

	public static void getTooltipTitle(EquipmentAsset pAsset, out string pName, out string pMaterial)
	{
		string text = pAsset.getLocaleID().Localize();
		string text2 = "";
		if (!string.IsNullOrEmpty(pAsset.material) && pAsset.material != "basic")
		{
			text2 = text2 + "(" + LocalizedTextManager.getText(pAsset.getMaterialID()) + ") ";
		}
		pName = text;
		pMaterial = text2;
	}

	public static void getAssetIds(string pItemIdWithMaterial, out string pItemAssetId, out string pMaterialAssetId)
	{
		pItemAssetId = null;
		pMaterialAssetId = null;
		int num = pItemIdWithMaterial.LastIndexOf('_');
		if (num != -1)
		{
			pItemAssetId = pItemIdWithMaterial.Substring(0, num);
			pMaterialAssetId = pItemIdWithMaterial.Substring(num + 1);
		}
	}
}
// --- End of File: ItemTools.cs ---



// --- Start of File: ItemWindow.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class ItemWindow : WindowMetaGeneric<Item, ItemData>
{
	[SerializeField]
	private EquipmentBanner _item_banner;

	[SerializeField]
	private Text _text_item_type;

	[SerializeField]
	private Text _text_item_description;

	[SerializeField]
	private SwitchButton _button_cursed;

	[SerializeField]
	private SwitchButton _button_eternal;

	[SerializeField]
	private Sprite _frame_sprite_legendary;

	[SerializeField]
	private Sprite _frame_sprite_epic;

	private IconOutline _outline;

	public override MetaType meta_type => MetaType.Item;

	protected override Item meta_object => SelectedMetas.selected_item;

	public void clickReforge()
	{
		meta_object.reforge(1);
		meta_object.addMod("divine_rune");
		updateStates();
	}

	public void clickReforgeDivine()
	{
		meta_object.reforge(30);
		meta_object.addMod("divine_rune");
		updateStates();
	}

	public void clickCursed()
	{
		if (meta_object.hasMod("cursed"))
		{
			meta_object.removeMod("cursed");
		}
		else
		{
			meta_object.addMod("cursed");
		}
		meta_object.addMod("divine_rune");
		updateStates();
	}

	public void clickEternal()
	{
		if (meta_object.hasMod("eternal"))
		{
			meta_object.removeMod("eternal");
		}
		else
		{
			meta_object.addMod("eternal");
		}
		meta_object.addMod("divine_rune");
		updateStates();
	}

	public void clickTransmutation()
	{
		meta_object.transmute();
		meta_object.addMod("divine_rune");
		updateStates();
	}

	private void updateStates()
	{
		showTopPartInformation();
		loadNameInput();
		updateStatsRows();
		AchievementLibrary.godly_smithing.check();
		Actor actor = meta_object.getActor();
		if (!actor.isRekt())
		{
			actor.setStatsDirty();
		}
	}

	protected override void showTopPartInformation()
	{
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		base.showTopPartInformation();
		clear();
		Item item = meta_object;
		_item_banner.load(item);
		EquipmentAsset asset = meta_object.getAsset();
		string text = "";
		if (asset.material != "basic")
		{
			text = text + "(" + LocalizedTextManager.getText(asset.getMaterialID()) + ") ";
		}
		((Component)_text_item_type).GetComponent<LocalizedText>().setKeyAndUpdate(item.getItemKeyType());
		_text_item_type.text = text + _text_item_type.text;
		((Graphic)_text_item_type).color = Toolbox.makeColor(meta_object.getQualityColor());
		_text_item_description.text = item.getItemDescription();
		_button_cursed.setEnabled(meta_object.hasMod("cursed"));
		_button_eternal.setEnabled(meta_object.hasMod("eternal"));
	}

	internal override void showStatsRows()
	{
		Item item = meta_object;
		BaseStatsHelper.showItemModsRows(base.getStatRow, item);
		BaseStatsHelper.showBaseStatsRows(base.getStatRow, item.getFullStats());
		showStatRow("durability", item.getDurabilityString(), MetaType.None, -1L);
		if (item.data.kills > 0)
		{
			showStatRow("creature_statistics_kills", item.data.kills, MetaType.None, -1L);
		}
	}

	private void showOutline()
	{
		_outline.show(RarityLibrary.legendary.color_container);
	}

	protected override void loadNameInput()
	{
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		((UnityEvent<string>)(object)_name_input.inputField.onEndEdit).AddListener((UnityAction<string>)delegate(string pString)
		{
			onNameChange(pString);
		});
		string text = (_initial_name = meta_object.getName(pWithMaterial: false).Trim());
		_name_input.setText(text);
		((Graphic)_name_input.textField).color = Toolbox.makeColor(meta_object.getQualityColor());
		if (meta_object.data.custom_name)
		{
			_name_input.SetOutline();
		}
	}
}
// --- End of File: ItemWindow.cs ---



// --- Start of File: ITraitsContainer.cs ---
using System.Collections.Generic;

public interface ITraitsContainer<TTrait, TTraitButton> where TTrait : BaseTrait<TTrait> where TTraitButton : TraitButton<TTrait>
{
	IReadOnlyCollection<TTraitButton> getTraitButtons();
}
// --- End of File: ITraitsContainer.cs ---



// --- Start of File: ITraitsEditor.cs ---
using UnityEngine;

public interface ITraitsEditor<TTrait> : IAugmentationsEditor where TTrait : BaseTrait<TTrait>
{
	ITraitsOwner<TTrait> getTraitsOwner();

	void scrollToGroupStarter(GameObject pTraitButton);

	void scrollToGroupStarter(GameObject pTraitButton, bool pIgnoreTooltipCheck);

	WindowMetaTab getEditorTab();
}
// --- End of File: ITraitsEditor.cs ---



// --- Start of File: ITraitsOwner.cs ---
using System.Collections.Generic;

public interface ITraitsOwner<TTrait> where TTrait : BaseTrait<TTrait>
{
	bool hasTrait(TTrait pTraitId);

	bool addTrait(TTrait pTraitId, bool pRemoveOpposites = false);

	bool removeTrait(TTrait pTrait);

	IReadOnlyCollection<TTrait> getTraits();

	bool hasTraits();

	void sortTraits(IReadOnlyCollection<TTrait> pTraits);

	void traitModifiedEvent();

	ActorAsset getActorAsset();
}
// --- End of File: ITraitsOwner.cs ---



// --- Start of File: ITraitWindow.cs ---
using System.Collections.Generic;

public interface ITraitWindow<TTrait, TTraitButton> : IAugmentationsWindow<ITraitsEditor<TTrait>> where TTrait : BaseTrait<TTrait> where TTraitButton : TraitButton<TTrait>
{
	TraitsContainer<TTrait, TTraitButton> getContainer()
	{
		return GetComponentInChildren<TraitsContainer<TTrait, TTraitButton>>();
	}

	void reloadTraits(bool pAnimated = true)
	{
		getContainer().reloadTraits(pAnimated);
	}

	ITraitsOwner<TTrait> getTraitsOwner()
	{
		return getEditor().getTraitsOwner();
	}

	IReadOnlyCollection<TTrait> getTraits()
	{
		return getTraitsOwner().getTraits();
	}

	void sortTraits(IReadOnlyCollection<TTrait> pTraits)
	{
		getTraitsOwner().sortTraits(pTraits);
	}

	bool hasTraits()
	{
		return getTraitsOwner().hasTraits();
	}
}
// --- End of File: ITraitWindow.cs ---



// --- Start of File: IWorldBoxAd.cs ---
using System;

public interface IWorldBoxAd
{
	Action adResetCallback { get; set; }

	Action adFailedCallback { get; set; }

	Action adFinishedCallback { get; set; }

	Action adStartedCallback { get; set; }

	Action<string> logger { get; set; }

	void Reset();

	void RequestAd();

	void KillAd();

	bool IsReady();

	void ShowAd();

	bool HasAd();

	bool IsInitialized();

	string GetProviderName();

	string GetColor();
}
// --- End of File: IWorldBoxAd.cs ---



// --- Start of File: Job.cs ---
public class Job<T>
{
	public JobUpdater job_updater;

	public ObjectContainer<T> container;

	public string id;

	public double time_benchmark;

	public int counter;

	public int random_tick_skips;

	public int current_skips;
}
// --- End of File: Job.cs ---



// --- Start of File: JobAction.cs ---
public delegate void JobAction();
// --- End of File: JobAction.cs ---



// --- Start of File: JobAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public abstract class JobAsset<TCondition, TSimObject> : Asset where TCondition : BehaviourBaseCondition<TSimObject>
{
	public bool random;

	public List<TaskContainer<TCondition, TSimObject>> tasks = new List<TaskContainer<TCondition, TSimObject>>();

	public void addCondition(TCondition pCondition, bool pExpectedResult = true)
	{
		tasks[tasks.Count - 1].addCondition(pCondition, pExpectedResult);
	}

	public void addTask(string pTask)
	{
		TaskContainer<TCondition, TSimObject> taskContainer = new TaskContainer<TCondition, TSimObject>();
		taskContainer.id = pTask;
		tasks.Add(taskContainer);
	}
}
// --- End of File: JobAsset.cs ---



// --- Start of File: JobCityAsset.cs ---
using System;

[Serializable]
public class JobCityAsset : JobAsset<BehaviourCityCondition, City>
{
}
// --- End of File: JobCityAsset.cs ---



// --- Start of File: JobConst.cs ---
public static class JobConst
{
	public static int MAX_ELEMENTS = 256;
}
// --- End of File: JobConst.cs ---



// --- Start of File: JobManagerActors.cs ---
using System.Collections.Generic;

public class JobManagerActors : JobManagerBase<BatchActors, Actor>
{
	public List<BatchActors> active_batches => _batches_active;

	public JobManagerActors(string pID)
		: base(pID)
	{
		benchmark_id = "actors";
	}
}
// --- End of File: JobManagerActors.cs ---



// --- Start of File: JobManagerBase.cs ---
using System.Collections.Generic;
using System.Threading.Tasks;

public class JobManagerBase<TBatch, T> where TBatch : Batch<T>, new()
{
	protected readonly List<TBatch> _batches_active = new List<TBatch>();

	private readonly Stack<TBatch> _batches_free = new Stack<TBatch>();

	public string id;

	public string benchmark_id;

	private Dictionary<string, double> _dict_benchmark_time = new Dictionary<string, double>();

	private Dictionary<string, int> _dict_benchmark_counter = new Dictionary<string, int>();

	public JobManagerBase(string pID)
	{
		id = pID;
	}

	public void updateBase(float pElapsed)
	{
		clearJobBenchmarks();
		updateBaseJobsPre(pElapsed);
		updateBaseJobsParallel(pElapsed);
		updateBaseJobsPost(pElapsed);
		saveJobBenchmarks();
	}

	private void clearJobBenchmarks()
	{
		if (!Bench.bench_enabled)
		{
			return;
		}
		for (int i = 0; i < _batches_active.Count; i++)
		{
			TBatch val = _batches_active[i];
			for (int j = 0; j < val.jobs_pre.Count; j++)
			{
				Job<T> job = val.jobs_pre[j];
				job.time_benchmark = 0.0;
				job.counter = 0;
			}
			for (int k = 0; k < val.jobs_post.Count; k++)
			{
				Job<T> job2 = val.jobs_post[k];
				job2.time_benchmark = 0.0;
				job2.counter = 0;
			}
		}
	}

	private void saveJobBenchmarks()
	{
		if (!Bench.bench_enabled)
		{
			return;
		}
		_dict_benchmark_time.Clear();
		_dict_benchmark_counter.Clear();
		for (int i = 0; i < _batches_active.Count; i++)
		{
			TBatch val = _batches_active[i];
			checkListForBenchmark(val.jobs_pre);
			checkListForBenchmark(val.jobs_post);
		}
		foreach (KeyValuePair<string, double> item in _dict_benchmark_time)
		{
			item.Deconstruct(out var key, out var value);
			string text = key;
			double pValue = value;
			int pCounter = _dict_benchmark_counter[text];
			Bench.benchSave(text, pValue, pCounter, benchmark_id);
			Bench.saveAverageCounter(text, benchmark_id);
		}
	}

	private void checkListForBenchmark(List<Job<T>> pList)
	{
		for (int i = 0; i < pList.Count; i++)
		{
			Job<T> job = pList[i];
			if (!_dict_benchmark_time.ContainsKey(job.id))
			{
				_dict_benchmark_time.Add(job.id, 0.0);
				_dict_benchmark_counter.Add(job.id, 0);
			}
			_dict_benchmark_time[job.id] += job.time_benchmark;
			_dict_benchmark_counter[job.id] += job.counter;
		}
	}

	internal void updateBaseJobsPre(float pElapsed)
	{
		for (int i = 0; i < _batches_active.Count; i++)
		{
			_batches_active[i].updateJobsPre(pElapsed);
		}
	}

	internal void updateBaseJobsPost(float pElapsed)
	{
		for (int i = 0; i < _batches_active.Count; i++)
		{
			_batches_active[i].updateJobsPost(pElapsed);
		}
	}

	internal void updateBaseJobsParallel(float pElapsed)
	{
		clearParallelResults();
		Bench.bench("update_jobs_parallel", benchmark_id);
		if (Config.parallel_jobs_updater)
		{
			Parallel.ForEach(_batches_active, World.world.parallel_options, delegate(TBatch pBatch)
			{
				pBatch.updateJobsParallel(pElapsed);
			});
		}
		else
		{
			List<TBatch> batches_active = _batches_active;
			int count = batches_active.Count;
			for (int i = 0; i < count; i++)
			{
				batches_active[i].updateJobsParallel(pElapsed);
			}
		}
		Bench.benchEnd("update_jobs_parallel", benchmark_id, pSaveCounter: false, 0L);
		applyParallelResults();
	}

	internal void clearParallelResults()
	{
		Bench.bench("clear_parallel_results", benchmark_id);
		for (int i = 0; i < _batches_active.Count; i++)
		{
			_batches_active[i].clearParallelResults?.Invoke();
		}
		Bench.benchEnd("clear_parallel_results", benchmark_id, pSaveCounter: false, 0L);
	}

	internal void applyParallelResults()
	{
		Bench.bench("apply_parallel_results", benchmark_id);
		for (int i = 0; i < _batches_active.Count; i++)
		{
			_batches_active[i].applyParallelResults?.Invoke();
		}
		Bench.benchEnd("apply_parallel_results", benchmark_id, pSaveCounter: false, 0L);
	}

	internal void removeObject(T pObject, TBatch pBatch)
	{
		pBatch.remove(pObject);
		checkFree(pBatch);
	}

	protected TBatch newBatch()
	{
		TBatch val = new TBatch();
		_batches_active.Add(val);
		return val;
	}

	internal virtual void addNewObject(T pObject)
	{
		TBatch batch = getBatch();
		batch.add(pObject);
		batch.main.checkAddRemove();
		if (batch.main.Count >= JobConst.MAX_ELEMENTS)
		{
			batch.free_slots = false;
			_batches_free.Pop();
		}
	}

	internal TBatch getBatch()
	{
		if (_batches_free.Count == 0)
		{
			TBatch val = newBatch();
			val.batch_id = _batches_active.Count;
			makeFree(val);
			return val;
		}
		TBatch val2 = _batches_free.Peek();
		if (val2.main.Count == 0)
		{
			_batches_active.Add(val2);
		}
		return val2;
	}

	protected void checkFree(TBatch pBatch)
	{
		pBatch.main.checkAddRemove();
		if (pBatch.main.Count < JobConst.MAX_ELEMENTS)
		{
			makeFree(pBatch);
		}
		if (pBatch.main.Count == 0)
		{
			_batches_active.Remove(pBatch);
		}
	}

	protected virtual void makeFree(TBatch pBatch)
	{
		if (!pBatch.free_slots)
		{
			pBatch.free_slots = true;
			_batches_free.Push(pBatch);
		}
	}

	internal void clear()
	{
		_batches_free.Clear();
		for (int i = 0; i < _batches_active.Count; i++)
		{
			TBatch val = _batches_active[i];
			val.clear();
			val.free_slots = false;
			makeFree(val);
		}
	}

	internal void clearHelperLists()
	{
		for (int i = 0; i < _batches_active.Count; i++)
		{
			_batches_active[i].clearHelperLists();
		}
	}

	public void debug(DebugTool pTool)
	{
		int num = 0;
		for (int i = 0; i < _batches_active.Count; i++)
		{
			TBatch val = _batches_active[i];
			num += val.main.Count;
		}
		pTool.setText("batches all", _batches_active.Count, 0f, pShowBar: false, 0L);
		pTool.setText("objects", num, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("parallel_jobs_updater_on", Config.parallel_jobs_updater, 0f, pShowBar: false, 0L);
	}

	public string debugBatchCount()
	{
		return _batches_active.Count + " / " + _batches_free.Count;
	}

	public string debugJobCount()
	{
		int num = 0;
		foreach (TBatch item in _batches_active)
		{
			num += item.jobs_post.Count;
			num += item.jobs_pre.Count;
			num += item.jobs_parallel.Count;
		}
		return num.ToString();
	}
}
// --- End of File: JobManagerBase.cs ---



// --- Start of File: JobManagerBuildings.cs ---
public class JobManagerBuildings : JobManagerBase<BatchBuildings, Building>
{
	public JobManagerBuildings(string pID)
		: base(pID)
	{
		benchmark_id = "buildings";
	}
}
// --- End of File: JobManagerBuildings.cs ---



// --- Start of File: JobTesterAsset.cs ---
using System;

[Serializable]
public class JobTesterAsset : JobAsset<BehaviourTesterCondition, AutoTesterBot>
{
	public bool manual_test;
}
// --- End of File: JobTesterAsset.cs ---



// --- Start of File: JobType.cs ---
public enum JobType
{
	Pre,
	Post,
	Parallel
}
// --- End of File: JobType.cs ---



// --- Start of File: JobUpdater.cs ---
public delegate void JobUpdater();
// --- End of File: JobUpdater.cs ---



// --- Start of File: JsonHelper.cs ---
using Newtonsoft.Json;

public static class JsonHelper
{
	private static JsonSerializer _writer;

	private static JsonSerializer _reader;

	private static JsonSerializerSettings _settings;

	public static JsonSerializer writer
	{
		get
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Expected O, but got Unknown
			if (_writer == null)
			{
				_writer = JsonSerializer.Create(new JsonSerializerSettings
				{
					DefaultValueHandling = (DefaultValueHandling)3
				});
			}
			return _writer;
		}
	}

	public static JsonSerializer reader
	{
		get
		{
			if (_reader == null)
			{
				_reader = JsonSerializer.Create(read_settings);
			}
			return _reader;
		}
	}

	public static JsonSerializerSettings read_settings
	{
		get
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_0011: Expected O, but got Unknown
			if (_settings == null)
			{
				_settings = new JsonSerializerSettings();
				_settings.DefaultValueHandling = (DefaultValueHandling)3;
				_settings.Converters.Add((JsonConverter)(object)new LongJsonConverter());
				_settings.Converters.Add((JsonConverter)(object)new LongListJsonConverter());
				_settings.Converters.Add((JsonConverter)(object)new NullableLongJsonConverter());
				_settings.Converters.Add((JsonConverter)(object)new NullableLongListJsonConverter());
			}
			return _settings;
		}
	}
}
// --- End of File: JsonHelper.cs ---



// --- Start of File: KarpenkosPromo.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class KarpenkosPromo : MonoBehaviour
{
	public List<Sprite> sprites = new List<Sprite>();

	public Image image1;

	public Image image2;

	private float intervalChange = 1f;

	private float intervalMainImage = 1.5f;

	private int maxElements;

	private int curImageIndex;

	private float timerChange;

	private Image imageTransition;

	private Image imageCurrent;

	private void Awake()
	{
		maxElements = sprites.Count;
	}

	private void OnEnable()
	{
		curImageIndex = 0;
		timerChange = intervalMainImage / 2f;
		setImage(image1, curImageIndex);
		curImageIndex++;
		setImage(image2, curImageIndex);
		imageCurrent = image1;
		imageTransition = image2;
		((Component)imageCurrent).GetComponent<CanvasGroup>().alpha = 1f;
		((Component)imageTransition).GetComponent<CanvasGroup>().alpha = 0f;
	}

	private void setImage(Image pImage, int pIndex)
	{
		pImage.sprite = sprites[pIndex];
	}

	private void Update()
	{
		if (timerChange > 0f)
		{
			timerChange -= Time.deltaTime;
		}
		else
		{
			if (!(((Component)imageTransition).GetComponent<CanvasGroup>().alpha < 1f))
			{
				return;
			}
			CanvasGroup component = ((Component)imageTransition).GetComponent<CanvasGroup>();
			component.alpha += Time.deltaTime * 2f;
			if (((Component)imageTransition).GetComponent<CanvasGroup>().alpha >= 1f)
			{
				((Component)imageTransition).GetComponent<CanvasGroup>().alpha = 0f;
				imageCurrent.sprite = imageTransition.sprite;
				timerChange = intervalChange;
				if (curImageIndex == 0)
				{
					timerChange = intervalMainImage;
				}
				curImageIndex++;
				if (curImageIndex >= maxElements)
				{
					curImageIndex = 0;
				}
				setImage(imageTransition, curImageIndex);
			}
		}
	}
}
// --- End of File: KarpenkosPromo.cs ---



// --- Start of File: KeyValueField.cs ---
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class KeyValueField : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler, ISelectHandler, IDeselectHandler
{
	public Color odd_color = Toolbox.makeColor("#000000", 0f);

	public Color even_color = Toolbox.makeColor("#30322B");

	public Color highlight_color = Toolbox.makeColor("#111111");

	public Image background;

	public Image icon;

	public Image icon_secondary;

	public Text name_text;

	public Text value;

	public bool auto_odd_even_coloring;

	public UnityAction on_hover_value;

	public UnityAction on_hover_value_out;

	public UnityAction on_click_value;

	private Color _not_highlight_color;

	private LocalizedText _name_text;

	private LocalizedText _value;

	private bool _check_language = true;

	private void Awake()
	{
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Expected O, but got Unknown
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Expected O, but got Unknown
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Expected O, but got Unknown
		Button component = ((Component)value).GetComponent<Button>();
		if (Input.mousePresent)
		{
			component.OnHover((UnityAction)delegate
			{
				if (InputHelpers.mouseSupported)
				{
					UnityAction obj4 = on_hover_value;
					if (obj4 != null)
					{
						obj4.Invoke();
					}
				}
			});
			component.OnHoverOut((UnityAction)delegate
			{
				if (InputHelpers.mouseSupported)
				{
					UnityAction obj3 = on_hover_value_out;
					if (obj3 != null)
					{
						obj3.Invoke();
					}
				}
			});
		}
		((UnityEvent)component.onClick).AddListener((UnityAction)delegate
		{
			//IL_0033: Unknown result type (might be due to invalid IL or missing references)
			if (!InputHelpers.mouseSupported && !Tooltip.isShowingFor(this))
			{
				UnityAction obj = on_hover_value;
				if (obj != null)
				{
					obj.Invoke();
				}
				EventSystem.current.SetSelectedGameObject(((Component)this).gameObject);
			}
			else
			{
				setBackgroundColor(_not_highlight_color);
				UnityAction obj2 = on_click_value;
				if (obj2 != null)
				{
					obj2.Invoke();
				}
			}
		});
		_name_text = ((Component)name_text).GetComponent<LocalizedText>();
		_value = ((Component)value).GetComponent<LocalizedText>();
		_check_language = (Object)(object)_name_text != (Object)null || (Object)(object)_value != (Object)null;
	}

	private void OnEnable()
	{
		checkLanguage();
		if (auto_odd_even_coloring)
		{
			checkOddEvenColor(((Component)this).transform.GetActiveSiblingIndex());
		}
	}

	private void OnDisable()
	{
		on_hover_value = null;
		on_hover_value_out = null;
		on_click_value = null;
	}

	private void checkLanguage()
	{
		if (_check_language)
		{
			_name_text?.checkSpecialLanguages();
			_value?.checkSpecialLanguages();
		}
	}

	public void checkOddEvenColor(int pIndex)
	{
		if (pIndex % 2 != 0)
		{
			setEvenColor();
		}
		else
		{
			setOddColor();
		}
	}

	public void OnPointerEnter(PointerEventData pData)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.mouseSupported)
		{
			_not_highlight_color = ((Graphic)background).color;
			setHighlightColor();
		}
	}

	public void OnPointerExit(PointerEventData pData)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.mouseSupported)
		{
			setBackgroundColor(_not_highlight_color);
		}
	}

	public void OnSelect(BaseEventData pEventData)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		if (!InputHelpers.mouseSupported)
		{
			_not_highlight_color = ((Graphic)background).color;
			setHighlightColor();
		}
	}

	public void OnDeselect(BaseEventData pEventData)
	{
		if (!InputHelpers.mouseSupported)
		{
			setNotHighlightColor();
		}
	}

	public void setEvenColor()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		setBackgroundColor(even_color);
	}

	public void setOddColor()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		setBackgroundColor(odd_color);
	}

	public void setHighlightColor()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		setBackgroundColor(highlight_color);
	}

	public void setNotHighlightColor()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		setBackgroundColor(_not_highlight_color);
	}

	private void setBackgroundColor(Color pColor)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		((Graphic)background).color = pColor;
	}

	public void setMetaForTooltip(MetaType pMetaType, long pMetaId, string pTooltipId = null, TooltipDataGetter pData = null)
	{
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Expected O, but got Unknown
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Expected O, but got Unknown
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Expected O, but got Unknown
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Expected O, but got Unknown
		on_hover_value = null;
		on_hover_value_out = new UnityAction(Tooltip.hideTooltip);
		on_click_value = null;
		if (!pMetaType.isNone())
		{
			MetaTypeAsset tAsset = AssetManager.meta_type_library.getAsset(pMetaType);
			on_hover_value = (UnityAction)delegate
			{
				tAsset.stat_hover(pMetaId, (MonoBehaviour)(object)this);
			};
			on_click_value = (UnityAction)delegate
			{
				tAsset.stat_click(pMetaId, (MonoBehaviour)(object)this);
			};
		}
		else if (!string.IsNullOrEmpty(pTooltipId))
		{
			on_hover_value = (UnityAction)delegate
			{
				Tooltip.show(this, pTooltipId, pData());
			};
		}
	}
}
// --- End of File: KeyValueField.cs ---



// --- Start of File: Kingdom.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using UnityEngine;
using db;

public class Kingdom : MetaObjectWithTraits<KingdomData, KingdomTrait>
{
	public static KingdomCheckCache cache_enemy_check = new KingdomCheckCache();

	public KingdomAsset asset;

	public bool wild;

	public float timer_action;

	public Actor king;

	public City capital;

	public Culture culture;

	public Language language;

	public Religion religion;

	public readonly List<Building> buildings = new List<Building>();

	public readonly List<City> cities = new List<City>();

	public int power;

	public AiSystemKingdom ai;

	public Vector3 location;

	private float _cached_tax_local;

	private float _cached_tax_tribute;

	private bool _has_boats;

	protected override MetaType meta_type => MetaType.Kingdom;

	public override BaseSystemManager manager => World.world.kingdoms;

	protected override bool track_death_types => true;

	protected override AssetLibrary<KingdomTrait> trait_library => AssetManager.kingdoms_traits;

	protected override List<string> default_traits => getActorAsset().default_kingdom_traits;

	protected override List<string> saved_traits => data.saved_traits;

	[Obsolete("use .getColor() instead", false)]
	public ColorAsset kingdomColor => getColor();

	protected override void recalcBaseStats()
	{
		base.recalcBaseStats();
		_cached_tax_local = SimGlobals.m.base_tax_rate_local;
		_cached_tax_tribute = SimGlobals.m.base_tax_rate_tribute;
		foreach (KingdomTrait trait in getTraits())
		{
			if (trait.is_local_tax_trait)
			{
				_cached_tax_local = trait.tax_rate;
			}
			if (trait.is_tribute_tax_trait)
			{
				_cached_tax_tribute = trait.tax_rate;
			}
		}
	}

	protected sealed override void setDefaultValues()
	{
		base.setDefaultValues();
		power = 1;
		timer_action = 5f;
	}

	protected override ColorLibrary getColorLibrary()
	{
		return AssetManager.kingdom_colors_library;
	}

	public void clearListCities()
	{
		cities.Clear();
	}

	public void clearBuildingList()
	{
		buildings.Clear();
	}

	public override void increaseDeaths(AttackType pType)
	{
		if (isAlive())
		{
			base.increaseDeaths(pType);
			if (hasAlliance())
			{
				getAlliance().increaseDeaths(pType);
			}
		}
	}

	public override void increaseKills()
	{
		if (isAlive())
		{
			base.increaseKills();
			if (hasAlliance())
			{
				getAlliance().increaseKills();
			}
		}
	}

	public override void increaseBirths()
	{
		if (isAlive())
		{
			base.increaseBirths();
			if (hasAlliance())
			{
				getAlliance().increaseBirths();
			}
			addRenown(1);
		}
	}

	public void increaseLeft()
	{
		if (isAlive())
		{
			data.left++;
		}
	}

	public void increaseJoined()
	{
		if (isAlive())
		{
			data.joined++;
			addRenown(1);
		}
	}

	public void increaseMoved()
	{
		if (isAlive())
		{
			data.moved++;
			addRenown(2);
		}
	}

	public void increaseMigrants()
	{
		if (isAlive())
		{
			data.migrated++;
		}
	}

	public long getTotalLeft()
	{
		return data.left;
	}

	public long getTotalJoined()
	{
		return data.joined;
	}

	public long getTotalMoved()
	{
		return data.moved;
	}

	public long getTotalMigrated()
	{
		return data.migrated;
	}

	public override bool isReadyForRemoval()
	{
		if (buildings.Count > 0)
		{
			return false;
		}
		if (getPopulationTotal() > 0)
		{
			return false;
		}
		if (hasCities())
		{
			return false;
		}
		if (World.world.projectiles.hasActiveProjectiles(this))
		{
			return false;
		}
		if (!base.isReadyForRemoval())
		{
			return false;
		}
		return true;
	}

	public bool hasBuildings()
	{
		return buildings.Count > 0;
	}

	public void addBuildings(List<Building> pListBuildings)
	{
		buildings.AddRange(pListBuildings);
	}

	public void listCity(City pCity)
	{
		cities.Add(pCity);
	}

	public void listBuilding(Building pBuilding)
	{
		buildings.Add(pBuilding);
	}

	public Subspecies getMainSubspecies()
	{
		if (hasKing())
		{
			return king.subspecies;
		}
		if (base.units.Count == 0)
		{
			return null;
		}
		return base.units[0].subspecies;
	}

	public void createWildKingdom()
	{
		asset.default_kingdom_color.initColor();
		wild = true;
	}

	public void createAI()
	{
		if (Globals.AI_TEST_ACTIVE)
		{
			if (ai == null)
			{
				ai = new AiSystemKingdom(this);
			}
			ai.next_job_delegate = getNextJob;
			ai.jobs_library = AssetManager.job_kingdom;
			ai.task_library = AssetManager.tasks_kingdom;
		}
	}

	public bool isOpinionTowardsKingdomGood(Kingdom pKingdom)
	{
		if (this == pKingdom)
		{
			return true;
		}
		if (World.world.diplomacy.getOpinion(this, pKingdom).total >= 0)
		{
			return true;
		}
		return false;
	}

	public string getNextJob()
	{
		return "kingdom";
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isCiv()
	{
		return asset.civ;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isMobs()
	{
		return asset.mobs;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isNeutral()
	{
		return asset.neutral;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isNature()
	{
		return asset.nature;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isNomads()
	{
		return asset.nomads;
	}

	public override void save()
	{
		base.save();
		if (hasCulture())
		{
			data.id_culture = culture.id;
		}
		if (hasReligion())
		{
			data.id_religion = religion.id;
		}
		if (hasLanguage())
		{
			data.id_language = language.id;
		}
		if (hasKing())
		{
			data.kingID = king.data.id;
		}
		else
		{
			data.kingID = -1L;
		}
		data.saved_traits = getTraitsAsStrings();
	}

	public IEnumerable<War> getWars(bool pRandom = false)
	{
		return World.world.wars.getWars(this, pRandom);
	}

	public bool isAttacker()
	{
		foreach (War war in getWars())
		{
			if (war.isAttacker(this))
			{
				return true;
			}
		}
		return false;
	}

	public bool isDefender()
	{
		foreach (War war in getWars())
		{
			if (war.isDefender(this))
			{
				return true;
			}
		}
		return false;
	}

	public bool isInWarWith(Kingdom pKingdom)
	{
		return World.world.wars.isInWarWith(this, pKingdom);
	}

	public bool isInWarOnSameSide(Kingdom pKingdom)
	{
		foreach (War war in getWars())
		{
			if (war.onTheSameSide(pKingdom, this))
			{
				return true;
			}
		}
		return false;
	}

	public bool isEnemy(Kingdom pKingdomTarget)
	{
		if (pKingdomTarget == null)
		{
			return true;
		}
		long hash = cache_enemy_check.getHash(this, pKingdomTarget);
		if (cache_enemy_check.dict.TryGetValue(hash, out var value))
		{
			return value;
		}
		if (isCiv() && pKingdomTarget.isCiv())
		{
			if (pKingdomTarget == this)
			{
				cache_enemy_check.dict[hash] = false;
				return false;
			}
			if (World.world.wars.isInWarWith(this, pKingdomTarget))
			{
				cache_enemy_check.dict[hash] = true;
				return true;
			}
			cache_enemy_check.dict[hash] = false;
			return false;
		}
		if (asset.isFoe(pKingdomTarget.asset))
		{
			cache_enemy_check.dict[hash] = true;
			return true;
		}
		cache_enemy_check.dict[hash] = false;
		return false;
	}

	public bool isGettingCaptured()
	{
		foreach (City city in getCities())
		{
			if (city.isGettingCaptured())
			{
				return true;
			}
		}
		return false;
	}

	public override ColorAsset getColor()
	{
		if (isCiv())
		{
			return base.getColor();
		}
		return asset.default_kingdom_color;
	}

	internal void newCivKingdom(Actor pActor)
	{
		asset = AssetManager.kingdoms.get(pActor.asset.kingdom_id_civilization);
		data.original_actor_asset = pActor.asset.id;
		string pName = pActor.generateName(MetaType.Kingdom, getID());
		setName(pName);
		data.name_culture_id = culture?.id ?? (-1);
		generateNewMetaObject();
	}

	public override ActorAsset getActorAsset()
	{
		if (hasKing())
		{
			return king.getActorAsset();
		}
		return getFounderSpecies();
	}

	public ActorAsset getFounderSpecies()
	{
		return AssetManager.actor_library.get(data.original_actor_asset);
	}

	public string getSpecies()
	{
		if (string.IsNullOrEmpty(data.original_actor_asset))
		{
			return null;
		}
		return getActorAsset()?.id;
	}

	public void trySetRoyalClan()
	{
		if (hasKing() && king.hasClan() && king.clan.id != data.royal_clan_id)
		{
			long royal_clan_id = data.royal_clan_id;
			Clan clan = World.world.clans.get(royal_clan_id);
			if (clan != null && clan.isAlive())
			{
				logNewRoyalClanChanged(clan, king.clan);
			}
			else if (king.clan.getRenown() >= 10)
			{
				logNewRoyalClan(king.clan);
			}
			data.royal_clan_id = king.clan.id;
		}
	}

	public void checkEndWar()
	{
		data.timestamp_last_war = World.world.getCurWorldTime();
	}

	public void madePeace(War pWar)
	{
		int pAmount = (int)((float)pWar.getRenown() * 0.25f);
		addRenown(pAmount);
		foreach (Actor unit in getUnits())
		{
			unit.madePeace(pWar);
		}
		if (hasAlliance())
		{
			getAlliance().addRenown(pAmount);
		}
	}

	public void wonWar(War pWar)
	{
		addRenown(pWar.getRenown());
		foreach (Actor unit in getUnits())
		{
			unit.warWon(pWar);
		}
		if (hasAlliance())
		{
			getAlliance().addRenown(pWar.getRenown());
		}
	}

	public void lostWar(War pWar)
	{
		int pAmount = (int)((float)pWar.getRenown() * 0.1f);
		addRenown(pAmount);
		foreach (Actor unit in getUnits())
		{
			unit.warLost(pWar);
		}
		if (hasAlliance())
		{
			getAlliance().addRenown(pAmount);
		}
	}

	internal void updateCiv(float pElapsed)
	{
		if (data.timer_new_king > 0f)
		{
			data.timer_new_king -= pElapsed;
		}
		if (ai != null)
		{
			if (timer_action > 0f)
			{
				timer_action -= pElapsed;
			}
			else
			{
				ai.update();
			}
		}
	}

	public void setCapital(City pCity)
	{
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		capital = pCity;
		if (capital != null && capital.isAlive())
		{
			KingdomData kingdomData = data;
			long capitalID = (data.last_capital_id = pCity.data.id);
			kingdomData.capitalID = capitalID;
			location = Vector2.op_Implicit(capital.city_center);
		}
		else
		{
			data.capitalID = -1L;
		}
	}

	public void setKing(Actor pActor, bool pFromLoad = false)
	{
		king = pActor;
		king.setProfession(UnitProfession.King);
		if (!pFromLoad)
		{
			data.total_kings++;
			addRuler(pActor);
			data.timestamp_king_rule = World.world.getCurWorldTime();
			king.changeHappiness("become_king");
		}
		trySetRoyalClan();
	}

	internal void kingLeftEvent()
	{
		if (hasKing())
		{
			if (king.isAlive())
			{
				king.changeHappiness("lost_crown");
			}
			logKingLeft(king);
			removeKing();
		}
	}

	internal void kingFledCity()
	{
		if (hasKing())
		{
			if (king.city.isCapitalCity())
			{
				logKingFledCapital(king);
			}
			else
			{
				logKingFledCity(king);
			}
			king.setCity(null);
		}
	}

	internal void removeKing()
	{
		if (!king.isRekt())
		{
			king.setProfession(UnitProfession.Unit);
		}
		rulerLeft();
		king = null;
		data.timer_new_king = Randy.randomFloat(5f, 20f);
	}

	public void updateRulers()
	{
		if (data.past_rulers == null || data.past_rulers.Count == 0)
		{
			return;
		}
		foreach (LeaderEntry past_ruler in data.past_rulers)
		{
			Actor actor = World.world.units.get(past_ruler.id);
			if (!actor.isRekt())
			{
				past_ruler.name = actor.name;
			}
		}
	}

	public void addRuler(Actor pActor)
	{
		KingdomData kingdomData = data;
		if (kingdomData.past_rulers == null)
		{
			kingdomData.past_rulers = new List<LeaderEntry>();
		}
		rulerLeft();
		data.past_rulers.Add(new LeaderEntry
		{
			id = pActor.getID(),
			name = pActor.name,
			color_id = data.color_id,
			timestamp_ago = World.world.getCurWorldTime()
		});
		if (data.past_rulers.Count > 30)
		{
			data.past_rulers.Shift();
		}
	}

	public void rulerLeft()
	{
		if (data.past_rulers != null && data.past_rulers.Count != 0)
		{
			LeaderEntry leaderEntry = data.past_rulers.Last();
			if (!(leaderEntry.timestamp_end >= leaderEntry.timestamp_ago))
			{
				leaderEntry.timestamp_end = World.world.getCurWorldTime();
				updateRulers();
			}
		}
	}

	public void logKingDead(Actor pActor)
	{
		if (!pActor.attackedBy.isRekt() && pActor.attackedBy.isActor())
		{
			WorldLog.logKingMurder(this, pActor, pActor.attackedBy.a);
		}
		else
		{
			WorldLog.logKingDead(this, pActor);
		}
	}

	public void logKingFledCapital(Actor pActor)
	{
		WorldLog.logKingFledCapital(this, pActor);
	}

	public void logKingFledCity(Actor pActor)
	{
		WorldLog.logKingFledCity(this, pActor);
	}

	public void logKingLeft(Actor pActor)
	{
		WorldLog.logKingLeft(this, pActor);
	}

	public void logNewRoyalClanChanged(Clan pOldClan, Clan pNewClan)
	{
		WorldLog.logRoyalClanChanged(this, pOldClan, pNewClan);
	}

	public void logNewRoyalClan(Clan pClan)
	{
		WorldLog.logRoyalClanNew(this, pClan);
	}

	public void logRoyalClanLost(Clan pClan)
	{
		WorldLog.logRoyalClanNoMore(this, pClan);
	}

	internal void checkClearCapital(City pCity)
	{
		if (pCity.isCapitalCity())
		{
			clearCapital();
		}
	}

	public void clearCapital()
	{
		data.capitalID = -1L;
		capital = null;
	}

	public bool hasNearbyKingdoms()
	{
		foreach (City city in getCities())
		{
			if (city.neighbours_kingdoms.Count > 0)
			{
				return true;
			}
		}
		return false;
	}

	public void capturedFrom(Kingdom pKingdom)
	{
		World.world.diplomacy.getRelation(this, pKingdom);
	}

	public virtual string getMotto()
	{
		if (string.IsNullOrEmpty(data.motto))
		{
			data.motto = NameGenerator.getName("kingdom_mottos");
		}
		return data.motto;
	}

	public override void generateBanner()
	{
		BannerAsset bannerAsset = AssetManager.kingdom_banners_library.get(getActorAsset().banner_id);
		data.banner_icon_id = Randy.randomInt(0, bannerAsset.icons.Count);
		data.banner_background_id = Randy.randomInt(0, bannerAsset.backgrounds.Count);
	}

	public override void loadData(KingdomData pData)
	{
		base.loadData(pData);
		if (data.id_culture.hasValue())
		{
			setCulture(World.world.cultures.get(data.id_culture));
		}
		if (data.id_language.hasValue())
		{
			setLanguage(World.world.languages.get(data.id_language));
		}
		if (data.id_religion.hasValue())
		{
			setReligion(World.world.religions.get(data.id_religion));
		}
		ActorAsset actorAsset = getActorAsset();
		asset = AssetManager.kingdoms.get(actorAsset.kingdom_id_civilization);
	}

	internal void load2()
	{
		City city = World.world.cities.get(data.capitalID);
		if (city != null)
		{
			setCapital(city);
		}
		if (data.kingID.hasValue())
		{
			Actor actor = World.world.units.get(data.kingID);
			if (actor != null)
			{
				setKing(actor, pFromLoad: true);
				actor.setProfession(UnitProfession.King);
			}
		}
	}

	public override bool updateColor(ColorAsset pColor)
	{
		bool flag = base.updateColor(pColor);
		if (flag)
		{
			foreach (Building building in buildings)
			{
				building.updateKingdomColors();
			}
		}
		return flag;
	}

	public static float distanceBetweenKingdom(Kingdom pKingdom, Kingdom pTarget)
	{
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		if (!pKingdom.hasCities() || !pTarget.hasCities())
		{
			return -1f;
		}
		float num = float.MaxValue;
		using ListPool<Vector2> listPool = new ListPool<Vector2>();
		using ListPool<Vector2> listPool2 = new ListPool<Vector2>();
		foreach (City city in pKingdom.getCities())
		{
			listPool.Add(city.city_center);
		}
		foreach (City city2 in pTarget.getCities())
		{
			listPool2.Add(city2.city_center);
		}
		foreach (ref Vector2 item in listPool)
		{
			Vector2 current3 = item;
			foreach (ref Vector2 item2 in listPool2)
			{
				Vector2 current4 = item2;
				float num2 = Toolbox.SquaredDistVec2Float(current3, current4);
				if (num2 < num)
				{
					num = num2;
				}
			}
		}
		return num;
	}

	public override IEnumerable<City> getCities()
	{
		if (World.world.kingdoms.hasDirtyCities())
		{
			foreach (City city in World.world.cities)
			{
				if (!city.isRekt() && city.kingdom == this)
				{
					yield return city;
				}
			}
			yield break;
		}
		foreach (City city2 in cities)
		{
			if (!city2.isRekt())
			{
				yield return city2;
			}
		}
	}

	public void clear()
	{
		buildings.Clear();
		cities.Clear();
		base.units.Clear();
		cache_enemy_check.clear();
		clearCapital();
	}

	public override void Dispose()
	{
		DBInserter.deleteData(getID(), "kingdom");
		clear();
		asset = null;
		king = null;
		capital = null;
		culture = null;
		language = null;
		religion = null;
		ai?.reset();
		base.Dispose();
	}

	public bool hasEnemies()
	{
		return World.world.wars.hasWars(this);
	}

	public ListPool<Kingdom> getEnemiesKingdoms()
	{
		return World.world.wars.getEnemiesOf(this);
	}

	public void makeSurvivorsToNomads()
	{
		if (base.units.Count == 0)
		{
			return;
		}
		for (int i = 0; i < base.units.Count; i++)
		{
			Actor actor = base.units[i];
			if (actor.isAlive())
			{
				if (actor.asset.is_boat)
				{
					actor.getHitFullHealth(AttackType.None);
					continue;
				}
				actor.cancelAllBeh();
				actor.removeFromPreviousFaction();
				actor.joinKingdom(World.world.kingdoms_wild.get(actor.asset.kingdom_id_wild));
			}
		}
		base.units.Clear();
	}

	public void clearKingData()
	{
		king = null;
	}

	public void updateAge()
	{
		if (hasKing() && king.hasClan())
		{
			king.clan.addRenown(1);
		}
	}

	public override int countCouples()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countCouples();
		}
		return num;
	}

	public override int countSingleMales()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countSingleMales();
		}
		return num;
	}

	public override int countSingleFemales()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countSingleFemales();
		}
		return num;
	}

	public int countZones()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countZones();
		}
		return num;
	}

	public int countBuildings()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countBuildings();
		}
		return num;
	}

	public int countCities()
	{
		if (!World.world.kingdoms.hasDirtyCities())
		{
			return cities.Count;
		}
		int num = 0;
		foreach (City city in getCities())
		{
			_ = city;
			num++;
		}
		return num;
	}

	public override int getPopulationPeople()
	{
		if (!_has_boats)
		{
			return base.units.Count;
		}
		int num = 0;
		int num2 = 0;
		foreach (City city in getCities())
		{
			num += city.getPopulationPeople();
			num2 += city.countBoats();
		}
		if (num + num2 == base.units.Count)
		{
			return num;
		}
		num = 0;
		foreach (Actor unit in getUnits())
		{
			if (!unit.asset.is_boat)
			{
				num++;
			}
		}
		return num;
	}

	public override int countUnits()
	{
		return getPopulationPeople();
	}

	public override IEnumerable<Actor> getUnits()
	{
		foreach (Actor unit in base.units)
		{
			if (unit.isAlive() && !unit.asset.is_boat && unit.kingdom == this)
			{
				yield return unit;
			}
		}
	}

	public override Actor getRandomUnit()
	{
		foreach (Actor item in base.units.LoopRandom())
		{
			if (item.isAlive() && !item.asset.is_boat && item.kingdom == this)
			{
				return item;
			}
		}
		return null;
	}

	public int getPopulationTotal()
	{
		return base.units.Count;
	}

	public int countBoats()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countBoats();
		}
		return num;
	}

	public int getPopulationTotalPossible()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.getPopulationMaximum();
		}
		return num;
	}

	public int countWeapons()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countWeapons();
		}
		return num;
	}

	public int countTotalFood()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.getTotalFood();
		}
		return num;
	}

	public int countTotalWarriors()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.countWarriors();
		}
		return num;
	}

	public int countWarriorsMax()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			num += city.getMaxWarriors();
		}
		return num;
	}

	public int getMaxCities()
	{
		int num = getActorAsset().civ_base_cities;
		if (hasKing())
		{
			num += (int)king.stats["cities"];
		}
		if (num < 1)
		{
			num = 1;
		}
		return num;
	}

	public bool diceAgressionSuccess()
	{
		if (!hasKing())
		{
			return false;
		}
		int num = countCities();
		if (num < getMaxCities())
		{
			return true;
		}
		if (num >= getMaxCities() && Randy.randomChance(king.stats["personality_aggression"]))
		{
			return true;
		}
		return false;
	}

	public bool isSupreme()
	{
		return DiplomacyManager.kingdom_supreme == this;
	}

	public bool isSecondBest()
	{
		return DiplomacyManager.kingdom_second == this;
	}

	public bool hasAlliance()
	{
		return getAlliance() != null;
	}

	public Alliance getAlliance()
	{
		if (!data.allianceID.hasValue())
		{
			return null;
		}
		Alliance alliance = World.world.alliances.get(data.allianceID);
		if (alliance == null)
		{
			data.allianceID = -1L;
		}
		return alliance;
	}

	public void allianceLeave(Alliance pAlliance)
	{
		data.allianceID = -1L;
		data.timestamp_alliance = World.world.getCurWorldTime();
	}

	public void allianceJoin(Alliance pAlliance)
	{
		data.allianceID = pAlliance.data.id;
		data.timestamp_alliance = World.world.getCurWorldTime();
	}

	public void calculateNeighbourCities()
	{
		foreach (City city in getCities())
		{
			city.recalculateNeighbourCities();
		}
	}

	public Culture getCulture()
	{
		return culture;
	}

	public void setCulture(Culture pCulture)
	{
		if (culture != pCulture)
		{
			culture = pCulture;
			World.world.cultures.setDirtyKingdoms();
		}
	}

	public bool hasCulture()
	{
		if (culture != null && !culture.isAlive())
		{
			setCulture(null);
		}
		return culture != null;
	}

	public void setLanguage(Language pLanguage)
	{
		language = pLanguage;
		World.world.languages.setDirtyKingdoms();
	}

	public Language getLanguage()
	{
		return language;
	}

	public bool hasLanguage()
	{
		if (language != null && !language.isAlive())
		{
			setLanguage(null);
		}
		return language != null;
	}

	public void setReligion(Religion pReligion)
	{
		if (religion != pReligion)
		{
			religion = pReligion;
			World.world.religions.setDirtyKingdoms();
		}
	}

	public Religion getReligion()
	{
		return religion;
	}

	public bool hasReligion()
	{
		if (religion != null && !religion.isAlive())
		{
			setReligion(null);
		}
		return religion != null;
	}

	public bool isEnemyAroundZone(TileZone pZone)
	{
		TileZone[] neighbours = pZone.neighbours;
		foreach (TileZone tileZone in neighbours)
		{
			if (tileZone.city == null)
			{
				return true;
			}
			Kingdom kingdom = tileZone.city.kingdom;
			if (kingdom != this)
			{
				return true;
			}
			if (kingdom != this && kingdom.isEnemy(this))
			{
				return true;
			}
		}
		return false;
	}

	public override bool hasCities()
	{
		using (IEnumerator<City> enumerator = getCities().GetEnumerator())
		{
			if (enumerator.MoveNext())
			{
				_ = enumerator.Current;
				return true;
			}
		}
		return false;
	}

	public bool hasCapital()
	{
		return capital != null;
	}

	public bool hasKing()
	{
		if (king == null)
		{
			return false;
		}
		if (!king.isAlive())
		{
			removeKing();
			return false;
		}
		return true;
	}

	public void affectKingByPowers()
	{
		if (hasKing())
		{
			king.addStatusEffect("voices_in_my_head");
		}
	}

	public int countUnhappyCities()
	{
		int num = 0;
		foreach (City city in getCities())
		{
			if (!city.isHappy())
			{
				num++;
			}
		}
		return num;
	}

	public Sprite getSpeciesIcon()
	{
		return getActorAsset().getSpriteIcon();
	}

	public Sprite getElementIcon()
	{
		return AssetManager.kingdom_banners_library.getSpriteIcon(data.banner_icon_id, getActorAsset().banner_id);
	}

	public Sprite getElementBackground()
	{
		return AssetManager.kingdom_banners_library.getSpriteBackground(data.banner_background_id, getActorAsset().banner_id);
	}

	public void increaseHappinessFromNewCityCapture()
	{
		foreach (Actor unit in getUnits())
		{
			if (!unit.hasHappinessEntry("was_conquered", 400f))
			{
				unit.changeHappiness("conquered_city");
			}
		}
	}

	public void increaseHappinessFromDestroyingCity()
	{
		foreach (Actor unit in getUnits())
		{
			if (!unit.hasHappinessEntry("was_conquered", 400f))
			{
				unit.changeHappiness("destroyed_city");
			}
		}
	}

	public void decreaseHappinessFromLostCityCapture(City pCity)
	{
		foreach (Actor unit in base.units)
		{
			if (!unit.hasHappinessEntry("was_conquered", 400f))
			{
				if (pCity.isCapitalCity())
				{
					unit.changeHappiness("lost_capital");
				}
				else
				{
					unit.changeHappiness("lost_city");
				}
			}
		}
	}

	public void decreaseHappinessFromRazedCity(City pCity)
	{
		foreach (Actor unit in base.units)
		{
			if (!unit.hasHappinessEntry("was_conquered", 400f))
			{
				if (pCity.isCapitalCity())
				{
					unit.changeHappiness("razed_capital");
				}
				else
				{
					unit.changeHappiness("razed_city");
				}
			}
		}
	}

	public int getLootMin()
	{
		return 5;
	}

	public float getTaxRateTribute()
	{
		return _cached_tax_tribute;
	}

	public float getTaxRateLocal()
	{
		return _cached_tax_local;
	}

	public void copyMetasFromOtherKingdom(Kingdom pKingdom)
	{
		if (pKingdom.hasCulture())
		{
			setCulture(pKingdom.culture);
		}
		if (pKingdom.hasLanguage())
		{
			setLanguage(pKingdom.language);
		}
		if (pKingdom.hasReligion())
		{
			setReligion(pKingdom.religion);
		}
	}

	public void setUnitMetas(Actor pActor)
	{
		if (pActor.hasCulture())
		{
			setCulture(pActor.culture);
		}
		if (pActor.hasLanguage())
		{
			setLanguage(pActor.language);
		}
		if (pActor.hasReligion())
		{
			setReligion(pActor.religion);
		}
	}

	public void setCityMetas(City pCity)
	{
		if (pCity.hasCulture())
		{
			setCulture(pCity.culture);
		}
		if (pCity.hasLanguage())
		{
			setLanguage(pCity.language);
		}
		if (pCity.hasReligion())
		{
			setReligion(pCity.religion);
		}
	}

	public Clan getKingClan()
	{
		if (hasKing() && king.hasClan())
		{
			return king.clan;
		}
		return null;
	}

	public override void listUnit(Actor pActor)
	{
		if (pActor.asset.is_boat)
		{
			_has_boats = true;
		}
		base.listUnit(pActor);
	}

	internal override void clearListUnits()
	{
		_has_boats = false;
		base.clearListUnits();
	}

	public override string ToString()
	{
		if (data == null)
		{
			return "[Kingdom is null]";
		}
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		stringBuilderPool.Append($"[Kingdom:{base.id} ");
		if (!isAlive())
		{
			stringBuilderPool.Append("[DEAD] ");
		}
		stringBuilderPool.Append("\"" + name + "\" ");
		stringBuilderPool.Append($"Cities:{cities.Count} ");
		if (World.world.kingdoms.hasDirtyCities())
		{
			stringBuilderPool.Append($" [Dirty:{countCities()}] ");
		}
		stringBuilderPool.Append($"Units:{base.units.Count} ");
		if (isDirtyUnits())
		{
			stringBuilderPool.Append("[Dirty] ");
		}
		if (hasKing())
		{
			stringBuilderPool.Append($"King:{king.id} ");
		}
		return stringBuilderPool.ToString().Trim() + "]";
	}
}
// --- End of File: Kingdom.cs ---



// --- Start of File: KingdomAlliesContainer.cs ---
using System.Collections;
using UnityEngine;

public class KingdomAlliesContainer : KingdomDiplomacyContainer<KingdomBanner, Kingdom, KingdomData>
{
	protected override IEnumerator showContent()
	{
		using ListPool<Kingdom> tList = World.world.wars.getNeutralKingdoms(base.kingdom);
		if (base.kingdom.hasAlliance())
		{
			foreach (Kingdom item in base.kingdom.getAlliance().kingdoms_list)
			{
				if (item != base.kingdom && !item.isRekt())
				{
					tList.Add(item);
				}
			}
		}
		track_objects.AddRange(tList);
		if (tList.Count == 0)
		{
			yield break;
		}
		yield return (object)new WaitForSecondsRealtime(0.025f);
		Vector3 val = default(Vector3);
		((Vector3)(ref val))._002Ector(0.5f, 0.5f, 1f);
		foreach (ref Kingdom item2 in tList)
		{
			Kingdom current2 = item2;
			if (!current2.isRekt())
			{
				KingdomBanner next = pool_elements.getNext();
				next.diplo_banner = true;
				((Component)next).GetComponent<TipButton>().showOnClick = true;
				((Behaviour)((Component)next).GetComponentInChildren<RotateOnHover>()).enabled = true;
				if (!((Component)(object)next).HasComponent<DraggableLayoutElement>())
				{
					((Component)(object)next).AddComponent<DraggableLayoutElement>();
				}
				next.load(current2);
				((Behaviour)((Component)next).GetComponent<UiButtonHoverAnimation>()).enabled = false;
				((Component)next).GetComponent<UiButtonHoverAnimation>().scale_size = 1f;
				((Component)next).GetComponent<UiButtonHoverAnimation>().default_scale = val;
				((Component)next).GetComponent<TipButton>().setDefaultScale(val);
				RectTransform component = ((Component)next).GetComponent<RectTransform>();
				component.SetAnchor(AnchorPresets.MiddleCenter);
				((Transform)component).localScale = val;
				component.anchoredPosition = new Vector2(0f, 0f);
			}
		}
	}
}
// --- End of File: KingdomAlliesContainer.cs ---



// --- Start of File: KingdomAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using Newtonsoft.Json;
using UnityEngine;

[Serializable]
public class KingdomAsset : Asset
{
	public bool civ;

	[DefaultValue(-1)]
	public int default_civ_color_index = -1;

	public bool nomads;

	public bool nature;

	public bool abandoned;

	public bool concept;

	public bool always_attack_each_other;

	public bool units_always_looking_for_enemies;

	[NonSerialized]
	public HashSet<string> assets_discrepancies;

	[NonSerialized]
	public HashSet<string> assets_discrepancies_bad;

	public bool force_look_all_chunks;

	public bool mobs;

	public bool neutral;

	public bool brain;

	public bool group_miniciv;

	public bool group_minicivs_cool;

	public bool group_creeps;

	public bool group_main;

	public bool is_forced_by_trait;

	[DefaultValue("")]
	public string forced_by_trait_kingdom_id = string.Empty;

	[DefaultValue("")]
	public string building_attractor_id = string.Empty;

	public bool count_as_danger = true;

	public HashSet<string> friendly_tags = new HashSet<string>();

	public HashSet<string> enemy_tags = new HashSet<string>();

	public HashSet<string> list_tags = new HashSet<string>();

	private Dictionary<int, int> _cached_enemies = new Dictionary<int, int>();

	public ColorAsset default_kingdom_color;

	public Color color_building = Color.white;

	private Sprite _cached_sprite;

	public string path_icon = "ui/Icons/iconWarning";

	public bool show_icon;

	public bool friendship_for_everyone;

	private ColorAsset _debug_color_asset;

	[JsonIgnore]
	public ColorAsset debug_color_asset
	{
		get
		{
			if (_debug_color_asset == null)
			{
				_debug_color_asset = AssetManager.kingdom_colors_library?.list?.GetRandom();
			}
			return _debug_color_asset;
		}
		set
		{
			_debug_color_asset = value;
		}
	}

	public Sprite getSprite()
	{
		if ((Object)(object)_cached_sprite == (Object)null)
		{
			_cached_sprite = SpriteTextureLoader.getSprite(path_icon);
		}
		return _cached_sprite;
	}

	public void setIcon(string pPath)
	{
		path_icon = pPath;
		show_icon = true;
	}

	public void addTag(string pTag)
	{
		list_tags.Add(pTag);
	}

	public void addFriendlyTag(string pTag)
	{
		friendly_tags.Add(pTag);
	}

	public void addEnemyTag(string pTag)
	{
		enemy_tags.Add(pTag);
	}

	public bool isFoe(KingdomAsset pTarget)
	{
		int value = 0;
		int hashCode = pTarget.GetHashCode();
		_cached_enemies.TryGetValue(hashCode, out value);
		if (value != 0)
		{
			return value == 1;
		}
		if (nature || pTarget.nature)
		{
			_cached_enemies.Add(hashCode, -1);
			return false;
		}
		if (this == pTarget)
		{
			_cached_enemies.Add(hashCode, always_attack_each_other ? 1 : (-1));
			return always_attack_each_other;
		}
		if (enemy_tags.Count > 0 && enemy_tags.Overlaps(pTarget.list_tags))
		{
			_cached_enemies.Add(hashCode, 1);
			return true;
		}
		pTarget.list_tags.Add(pTarget.id);
		list_tags.Add(id);
		if (friendly_tags.Count > 0 && friendly_tags.Overlaps(pTarget.list_tags))
		{
			_cached_enemies.Add(hashCode, -1);
			return false;
		}
		_cached_enemies.Add(hashCode, 1);
		return true;
	}

	public void clearKingdomColor()
	{
		default_kingdom_color = null;
	}
}
// --- End of File: KingdomAsset.cs ---



// --- Start of File: KingdomBanner.cs ---
using UnityEngine;
using UnityEngine.UI;

public class KingdomBanner : BannerGeneric<Kingdom, KingdomData>
{
	public bool diplo_banner;

	[SerializeField]
	protected Image background;

	[SerializeField]
	protected Image icon;

	[SerializeField]
	protected Image dead_image;

	[SerializeField]
	protected Image left_image;

	[SerializeField]
	protected Image winner_image;

	[SerializeField]
	protected Image loser_image;

	private Color _bgcolor;

	private Color _iconcolor;

	protected override MetaType meta_type => MetaType.Kingdom;

	protected override string tooltip_id => "kingdom";

	protected override void setupTooltip()
	{
		base.setupTooltip();
	}

	protected override void setupBanner()
	{
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		base.setupBanner();
		((Component)dead_image).gameObject.SetActive(false);
		((Component)left_image).gameObject.SetActive(false);
		((Component)winner_image).gameObject.SetActive(false);
		((Component)loser_image).gameObject.SetActive(false);
		part_background.sprite = meta_object.getElementBackground();
		part_icon.sprite = meta_object.getElementIcon();
		ColorAsset colorAsset = meta_object.getColor();
		((Graphic)part_background).color = colorAsset.getColorMainSecond();
		((Graphic)part_icon).color = colorAsset.getColorBanner();
	}

	public override void load(NanoObject pObject)
	{
		base.load(pObject);
		if (meta_object.hasDied())
		{
			showAsDead();
		}
	}

	private void showAsDead()
	{
		((Component)dead_image).gameObject.SetActive(true);
	}

	public void hasLeftWar()
	{
		((Component)left_image).gameObject.SetActive(true);
	}

	public void hasWon()
	{
		((Component)winner_image).gameObject.SetActive(true);
	}

	public void hasLost()
	{
		((Component)loser_image).gameObject.SetActive(true);
	}

	protected override void tooltipAction()
	{
		if (meta_object != null)
		{
			string pType = (meta_object.hasDied() ? "kingdom_dead" : "kingdom");
			string tip_name = string.Empty;
			if (diplo_banner)
			{
				pType = "kingdom_diplo";
				tip_name = "kingdom_diplo";
			}
			TooltipData tooltipData = getTooltipData();
			tooltipData.tip_name = tip_name;
			Tooltip.show(this, pType, tooltipData);
		}
	}

	protected override TooltipData getTooltipData()
	{
		TooltipData tooltipData = base.getTooltipData();
		tooltipData.kingdom = meta_object;
		return tooltipData;
	}
}
// --- End of File: KingdomBanner.cs ---



// --- Start of File: KingdomBannerLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public class KingdomBannerLibrary : GenericBannerLibrary
{
	public const string PATH_BANNER_KINGDOMS = "banners_kingdoms/";

	public const string PATH_BACKGROUND = "/background";

	public const string PATH_ICON = "/icon";

	public override void init()
	{
		base.init();
	}

	public override BannerAsset get(string pID)
	{
		if (dict.ContainsKey(pID))
		{
			return base.get(pID);
		}
		loadNewAssetRuntime(pID);
		return base.get(pID);
	}

	public static string getFullPathBackground(string pID)
	{
		return "banners_kingdoms/" + pID + "/background";
	}

	public static string getFullPathIcon(string pID)
	{
		return "banners_kingdoms/" + pID + "/icon";
	}

	private BannerAsset loadNewAssetRuntime(string pID)
	{
		string fullPathBackground = getFullPathBackground(pID);
		string fullPathIcon = getFullPathIcon(pID);
		Sprite[] spriteList = SpriteTextureLoader.getSpriteList(fullPathBackground);
		Sprite[] spriteList2 = SpriteTextureLoader.getSpriteList(fullPathIcon);
		List<string> list = new List<string>();
		List<string> list2 = new List<string>();
		Sprite[] array = spriteList;
		foreach (Sprite val in array)
		{
			string item = fullPathBackground + "/" + ((Object)val).name;
			list.Add(item);
		}
		array = spriteList2;
		foreach (Sprite val2 in array)
		{
			string item2 = fullPathIcon + "/" + ((Object)val2).name;
			list2.Add(item2);
		}
		BannerAsset bannerAsset = new BannerAsset
		{
			id = pID,
			backgrounds = list,
			icons = list2
		};
		add(bannerAsset);
		return bannerAsset;
	}
}
// --- End of File: KingdomBannerLibrary.cs ---



// --- Start of File: KingdomBehCheckCapital.cs ---
namespace ai.behaviours;

public class KingdomBehCheckCapital : BehaviourActionKingdom
{
	public override BehResult execute(Kingdom pKingdom)
	{
		if (!pKingdom.hasCities())
		{
			return BehResult.Continue;
		}
		if (pKingdom.hasCapital() && pKingdom.capital.isAlive())
		{
			return BehResult.Continue;
		}
		City city = null;
		foreach (City city2 in pKingdom.cities)
		{
			if (city == null || city2.buildings.Count > city.buildings.Count)
			{
				city = city2;
			}
		}
		pKingdom.setCapital(city);
		return BehResult.Continue;
	}
}
// --- End of File: KingdomBehCheckCapital.cs ---



// --- Start of File: KingdomBehCheckKing.cs ---
using System;
using System.Collections.Generic;
using UnityPools;

namespace ai.behaviours;

public class KingdomBehCheckKing : BehaviourActionKingdom
{
	public override BehResult execute(Kingdom pKingdom)
	{
		if (pKingdom.data.timer_new_king > 0f)
		{
			return BehResult.Continue;
		}
		if (pKingdom.hasKing())
		{
			Actor king = pKingdom.king;
			if (king.isAlive())
			{
				tryToGiveGoldenTooth(king);
				checkClanCreation(king);
				return BehResult.Continue;
			}
		}
		pKingdom.clearKingData();
		if (pKingdom.data.royal_clan_id != -1)
		{
			Clan clan = BehaviourActionBase<Kingdom>.world.clans.get(pKingdom.data.royal_clan_id);
			bool flag = !clan.isRekt();
			Actor actor = findKingFromRoyalClan(pKingdom);
			if (actor == null)
			{
				if (pKingdom.countCities() == 1)
				{
					if (pKingdom.capital != null && pKingdom.capital.hasLeader())
					{
						Actor leader = pKingdom.capital.leader;
						pKingdom.capital.removeLeader();
						leader.stopBeingWarrior();
						pKingdom.setKing(leader);
					}
				}
				else
				{
					checkKingdomChaos(pKingdom);
				}
			}
			else if (pKingdom.hasCulture() && pKingdom.culture.hasTrait("shattered_crown") && flag)
			{
				checkShatteredCrownEvent(pKingdom, actor, clan);
			}
			if (!flag)
			{
				pKingdom.data.royal_clan_id = -1L;
			}
		}
		else
		{
			Actor kingFromLeaders = SuccessionTool.getKingFromLeaders(pKingdom);
			if (kingFromLeaders != null)
			{
				makeKingAndMoveToCapital(pKingdom, kingFromLeaders);
			}
			else
			{
				checkKingdomChaos(pKingdom);
			}
		}
		return BehResult.Continue;
	}

	private void checkKingdomChaos(Kingdom pMainKingdom)
	{
		bool flag = false;
		using ListPool<City> listPool = new ListPool<City>(pMainKingdom.countCities());
		foreach (City city in pMainKingdom.getCities())
		{
			if (city != pMainKingdom.capital && city.hasLeader())
			{
				listPool.Add(city);
			}
		}
		if (listPool.Count == 0)
		{
			return;
		}
		foreach (City item in listPool.LoopRandom())
		{
			Actor leader = item.leader;
			if (leader != null && leader.isAlive())
			{
				item.makeOwnKingdom(leader, pRebellion: false, pFellApart: true);
				flag = true;
			}
		}
		if (flag)
		{
			if (pMainKingdom.hasAlliance())
			{
				pMainKingdom.getAlliance().leave(pMainKingdom);
			}
			WorldLog.logFracturedKingdom(pMainKingdom);
		}
	}

	private void checkShatteredCrownEvent(Kingdom pMainKingdom, Actor pMainKing, Clan pRoyalClan)
	{
		if (!isRebellionsEnabled() || pRoyalClan == null)
		{
			return;
		}
		ListPool<Actor> tTempActors = new ListPool<Actor>(pRoyalClan.units.Count);
		try
		{
			using ListPool<City> listPool = new ListPool<City>(pMainKingdom.countCities());
			foreach (Actor unit in pRoyalClan.units)
			{
				if (!unit.isRekt() && unit != pMainKing && !unit.isKing())
				{
					tTempActors.Add(unit);
				}
			}
			foreach (City city3 in pMainKingdom.getCities())
			{
				if (city3 != pMainKingdom.capital)
				{
					listPool.Add(city3);
				}
			}
			if (tTempActors.Count == 0 || listPool.Count == 0)
			{
				return;
			}
			Dictionary<long, int> dictionary = UnsafeCollectionPool<Dictionary<long, int>, KeyValuePair<long, int>>.Get();
			using ListPool<Kingdom> listPool2 = new ListPool<Kingdom>();
			dictionary[pMainKingdom.id] = pMainKingdom.countCities();
			listPool.Shuffle();
			tTempActors.Shuffle();
			listPool.Sort(delegate(City a, City b)
			{
				int num = tTempActors.CountAll((Actor t) => t.city == a);
				int value = tTempActors.CountAll((Actor t) => t.city == b);
				return num.CompareTo(value);
			});
			bool flag = false;
			while (listPool.Count > 0 && tTempActors.Count > 0)
			{
				City city = listPool.Pop();
				Actor actor = null;
				if (city.hasLeader() && tTempActors.Contains(city.leader))
				{
					actor = city.leader;
				}
				else
				{
					foreach (ref Actor item in tTempActors)
					{
						Actor current3 = item;
						if (current3.city == city)
						{
							actor = current3;
							break;
						}
					}
				}
				if (actor == null)
				{
					actor = tTempActors.Last();
				}
				tTempActors.Remove(actor);
				if (actor.isCityLeader())
				{
					actor.city.removeLeader();
				}
				Kingdom kingdom = city.makeOwnKingdom(actor, pRebellion: false, pFellApart: true);
				listPool2.Add(kingdom);
				dictionary[kingdom.id] = 1;
				dictionary[pMainKingdom.id]--;
				actor.stopBeingWarrior();
				actor.joinCity(city);
				flag = true;
			}
			while (listPool.Count > 0)
			{
				City city2 = listPool.Pop();
				Kingdom random = listPool2.GetRandom();
				if (dictionary[random.id] < dictionary[pMainKingdom.id])
				{
					dictionary[random.id]++;
					dictionary[pMainKingdom.id]--;
					city2.joinAnotherKingdom(random, pCaptured: false, pRebellion: true);
				}
			}
			UnsafeCollectionPool<Dictionary<long, int>, KeyValuePair<long, int>>.Release(dictionary);
			if (flag)
			{
				if (pMainKingdom.hasAlliance())
				{
					pMainKingdom.getAlliance().leave(pMainKingdom);
				}
				WorldLog.logShatteredCrown(pMainKingdom);
			}
		}
		finally
		{
			if (tTempActors != null)
			{
				((IDisposable)tTempActors).Dispose();
			}
		}
	}

	private void checkClanCreation(Actor pActor)
	{
		if (!pActor.hasClan())
		{
			BehaviourActionBase<Kingdom>.world.clans.newClan(pActor, pAddDefaultTraits: true);
		}
	}

	private void tryToGiveGoldenTooth(Actor pActor)
	{
		if (pActor.getAge() > 45 && Randy.randomChance(0.05f))
		{
			pActor.addTrait("golden_tooth");
		}
	}

	private bool isRebellionsEnabled()
	{
		return WorldLawLibrary.world_law_rebellions.isEnabled();
	}

	private Actor findKingFromRoyalClan(Kingdom pKingdom)
	{
		Actor actor = SuccessionTool.getKingFromRoyalClan(pKingdom);
		if (actor == null && pKingdom.hasCulture() && (pKingdom.culture.hasTrait("unbroken_chain") || !isRebellionsEnabled()))
		{
			actor = SuccessionTool.getKingFromLeaders(pKingdom);
		}
		if (actor == null)
		{
			return null;
		}
		makeKingAndMoveToCapital(pKingdom, actor);
		return actor;
	}

	private void makeKingAndMoveToCapital(Kingdom pKingdom, Actor pNewKing)
	{
		if (pNewKing.hasCity())
		{
			pNewKing.stopBeingWarrior();
			if (pNewKing.isCityLeader())
			{
				pNewKing.city.removeLeader();
			}
		}
		if (pKingdom.hasCapital() && pNewKing.city != pKingdom.capital)
		{
			pNewKing.joinCity(pKingdom.capital);
		}
		pKingdom.setKing(pNewKing);
		WorldLog.logNewKing(pKingdom);
	}
}
// --- End of File: KingdomBehCheckKing.cs ---



// --- Start of File: KingdomBehRandomWait.cs ---
namespace ai.behaviours;

public class KingdomBehRandomWait : BehaviourActionKingdom
{
	private float min;

	private float max;

	public override bool shouldRetry(Kingdom pObject)
	{
		return false;
	}

	public KingdomBehRandomWait(float pMin = 0f, float pMax = 1f)
	{
		min = pMin;
		max = pMax;
	}

	public override BehResult execute(Kingdom pKingdom)
	{
		pKingdom.timer_action = Randy.randomFloat(min, max);
		return BehResult.Continue;
	}
}
// --- End of File: KingdomBehRandomWait.cs ---



// --- Start of File: KingdomCapitalElement.cs ---
using System.Collections;
using UnityEngine;

public class KingdomCapitalElement : KingdomElement
{
	[SerializeField]
	private CityListElement _capital_element;

	protected override IEnumerator showContent()
	{
		if (base.kingdom.hasCapital())
		{
			track_objects.Add(base.kingdom.capital);
			((Component)_capital_element).gameObject.SetActive(true);
			_capital_element.show(base.kingdom.capital);
		}
		yield break;
	}

	protected override void clear()
	{
		((Component)_capital_element).gameObject.SetActive(false);
		base.clear();
	}

	public override bool checkRefreshWindow()
	{
		if (((Component)_capital_element).gameObject.activeSelf && !base.kingdom.hasCapital())
		{
			return true;
		}
		return base.checkRefreshWindow();
	}
}
// --- End of File: KingdomCapitalElement.cs ---



// --- Start of File: KingdomCheckAttackTarget.cs ---
namespace ai.behaviours;

public class KingdomCheckAttackTarget : BehaviourActionKingdom
{
}
// --- End of File: KingdomCheckAttackTarget.cs ---



// --- Start of File: KingdomCheckCache.cs ---
using System.Collections.Generic;

public class KingdomCheckCache
{
	public Dictionary<long, bool> dict = new Dictionary<long, bool>();

	public long getHash(Kingdom pK1, Kingdom pK2)
	{
		int hashCode = pK1.GetHashCode();
		int hashCode2 = pK2.GetHashCode();
		if (hashCode > hashCode2)
		{
			return hashCode * 1000000 + hashCode2;
		}
		return hashCode2 * 1000000 + hashCode;
	}

	public void clear()
	{
		dict.Clear();
	}
}
// --- End of File: KingdomCheckCache.cs ---



// --- Start of File: KingdomCitiesContainer.cs ---
using System.Collections;
using UnityEngine;

public class KingdomCitiesContainer : KingdomElement
{
	private ObjectPoolGenericMono<CityListElement> _pool_elements;

	[SerializeField]
	private CityListElement _prefab;

	protected override void Awake()
	{
		_pool_elements = new ObjectPoolGenericMono<CityListElement>(_prefab, ((Component)this).transform);
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		using ListPool<City> tListCities = new ListPool<City>(base.kingdom.getCities());
		track_objects.AddRange(tListCities);
		tListCities.Sort(ComponentListBase<CityListElement, City, CityData, CityListComponent>.sortByPopulation);
		for (int i = 0; i < tListCities.Count; i++)
		{
			City tCity = tListCities[i];
			if (!tCity.isCapitalCity())
			{
				yield return (object)new WaitForSecondsRealtime(0.025f);
				showCityElement(tCity);
			}
		}
	}

	private void showCityElement(City pCity)
	{
		_pool_elements.getNext().show(pCity);
	}

	protected override void clear()
	{
		_pool_elements.clear();
		base.clear();
	}
}
// --- End of File: KingdomCitiesContainer.cs ---



// --- Start of File: KingdomColorsLibrary.cs ---
public class KingdomColorsLibrary : ColorLibrary
{
	public KingdomColorsLibrary()
	{
		file_path = "colors/colors_general";
		must_be_global = true;
	}

	public override void init()
	{
		base.init();
		loadFromFile<KingdomColorsLibrary>();
	}

	public override bool isColorUsedInWorld(ColorAsset pAsset)
	{
		foreach (Kingdom kingdom in World.world.kingdoms)
		{
			if (checkColor(pAsset, kingdom.data.color_id))
			{
				return true;
			}
		}
		foreach (Alliance alliance in World.world.alliances)
		{
			if (checkColor(pAsset, alliance.data.color_id))
			{
				return true;
			}
		}
		return base.isColorUsedInWorld(pAsset);
	}
}
// --- End of File: KingdomColorsLibrary.cs ---



// --- Start of File: KingdomCustomizeWindow.cs ---
public class KingdomCustomizeWindow : GenericCustomizeWindow<Kingdom, KingdomData, KingdomBanner>
{
	protected override MetaType meta_type => MetaType.Kingdom;

	protected override Kingdom meta_object => SelectedMetas.selected_kingdom;

	protected override void onBannerChange()
	{
		meta_object.getActorAsset();
		image_banner_option_1.sprite = meta_object.getElementBackground();
		image_banner_option_2.sprite = meta_object.getElementIcon();
	}
}
// --- End of File: KingdomCustomizeWindow.cs ---



// --- Start of File: KingdomData.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using Newtonsoft.Json;
using UnityEngine.Scripting;

[Serializable]
public class KingdomData : MetaObjectData
{
	[DefaultValue(-1.0)]
	public double timestamp_alliance = -1.0;

	public List<string> saved_traits;

	[DefaultValue(-1.0)]
	public double timestamp_last_war = -1.0;

	[DefaultValue(-1.0)]
	public double timestamp_new_conquest = -1.0;

	[DefaultValue(-1.0)]
	public double timestamp_king_rule = -1.0;

	public float timer_new_king = 10f;

	public List<LeaderEntry> past_rulers;

	[DefaultValue(0)]
	public int total_kings;

	[DefaultValue(-1L)]
	public long allianceID { get; set; } = -1L;


	[JsonProperty(/*Could not decode attribute arguments.*/)]
	public string original_actor_asset { get; set; }

	[DefaultValue(-1L)]
	public long royal_clan_id { get; set; } = -1L;


	public string motto { get; set; }

	[DefaultValue(-1L)]
	public long id_culture { get; set; } = -1L;


	[DefaultValue(-1L)]
	public long id_language { get; set; } = -1L;


	[DefaultValue(-1L)]
	public long id_religion { get; set; } = -1L;


	[DefaultValue(-1L)]
	public long kingID { get; set; } = -1L;


	[DefaultValue(-1L)]
	public long capitalID { get; set; } = -1L;


	[DefaultValue(-1L)]
	public long last_capital_id { get; set; } = -1L;


	[DefaultValue(1)]
	public int last_army_id { get; set; } = 1;


	[Preserve]
	[Obsolete("use .color_id instead", true)]
	public int colorId
	{
		set
		{
			if (value != -1 && base.color_id == 0)
			{
				setColorID(value);
			}
		}
	}

	[Preserve]
	[Obsolete("use .original_actor_asset instead", true)]
	public string raceId
	{
		set
		{
			if (!string.IsNullOrEmpty(value) && string.IsNullOrEmpty(original_actor_asset))
			{
				original_actor_asset = value;
			}
		}
	}

	[DefaultValue(0)]
	public int banner_background_id { get; set; }

	[DefaultValue(0)]
	public int banner_icon_id { get; set; }

	public long left { get; set; }

	public long joined { get; set; }

	public long moved { get; set; }

	public long migrated { get; set; }

	public override void Dispose()
	{
		base.Dispose();
		saved_traits?.Clear();
		saved_traits = null;
		past_rulers?.Clear();
		past_rulers = null;
	}
}
// --- End of File: KingdomData.cs ---



// --- Start of File: KingdomDiplomacyContainer.cs ---
using UnityEngine;

public class KingdomDiplomacyContainer<TBanner, TMetaObject, TData> : KingdomElement where TBanner : BannerGeneric<TMetaObject, TData> where TMetaObject : CoreSystemObject<TData> where TData : BaseSystemData
{
	protected ObjectPoolGenericMono<TBanner> pool_elements;

	[SerializeField]
	private TBanner _prefab;

	[SerializeField]
	private Transform _container;

	protected override void Awake()
	{
		pool_elements = new ObjectPoolGenericMono<TBanner>(_prefab, _container);
		base.Awake();
	}

	protected override void clear()
	{
		pool_elements.clear();
		base.clear();
	}
}
// --- End of File: KingdomDiplomacyContainer.cs ---



// --- Start of File: KingdomElement.cs ---
public class KingdomElement : WindowMetaElement<Kingdom, KingdomData>
{
	protected Kingdom kingdom => meta_object;
}
// --- End of File: KingdomElement.cs ---



// --- Start of File: KingdomJob.cs ---
using System;

[Serializable]
public class KingdomJob : JobAsset<BehaviourKingdomCondition, Kingdom>
{
}
// --- End of File: KingdomJob.cs ---



// --- Start of File: KingdomJobLibrary.cs ---
public class KingdomJobLibrary : AssetLibrary<KingdomJob>
{
	public override void init()
	{
		base.init();
		add(new KingdomJob
		{
			id = "kingdom"
		});
		t.addTask("do_checks");
		t.addTask("wait1");
		t.addTask("wait1");
	}
}
// --- End of File: KingdomJobLibrary.cs ---



// --- Start of File: KingdomKingElement.cs ---
using System.Collections;
using UnityEngine;

public class KingdomKingElement : KingdomElement
{
	[SerializeField]
	private GameObject _title_element;

	[SerializeField]
	private PrefabUnitElement _king_element;

	protected override IEnumerator showContent()
	{
		if (base.kingdom.hasKing())
		{
			track_objects.Add(base.kingdom.king);
			_title_element.SetActive(true);
			((Component)_king_element).gameObject.SetActive(true);
			_king_element.show(base.kingdom.king);
		}
		yield break;
	}

	protected override void clear()
	{
		_title_element.SetActive(false);
		((Component)_king_element).gameObject.SetActive(false);
		base.clear();
	}

	public override bool checkRefreshWindow()
	{
		if (((Component)_king_element).gameObject.activeSelf && !base.kingdom.hasKing())
		{
			return true;
		}
		return base.checkRefreshWindow();
	}
}
// --- End of File: KingdomKingElement.cs ---



// --- Start of File: KingdomLibrary.cs ---
using System;
using System.Collections.Generic;
using System.IO;
using UnityPools;

public class KingdomLibrary : AssetLibrary<KingdomAsset>
{
	private const string TEMPLATE_MOB = "$TEMPLATE_MOB$";

	private const string TEMPLATE_MOB_GOOD = "$TEMPLATE_MOB_GOOD$";

	private const string TEMPLATE_MOB_VERY_GOOD = "$TEMPLATE_MOB_VERY_GOOD$";

	private const string TEMPLATE_ANIMAL = "$TEMPLATE_ANIMAL$";

	private const string TEMPLATE_ANIMAL_NEUTRAL = "$TEMPLATE_ANIMAL_NEUTRAL$";

	private const string TEMPLATE_ANIMAL_PEACEFUL = "$TEMPLATE_ANIMAL_PEACEFUL$";

	private const string TEMPLATE_CIV = "$TEMPLATE_CIV$";

	private const string TEMPLATE_CIV_GOOD = "$TEMPLATE_CIV_GOOD$";

	private const string TEMPLATE_NOMAD = "$TEMPLATE_NOMAD$";

	private const string TEMPLATE_CIV_NEW = "$TEMPLATE_CIV_NEW$";

	private ColorAsset _shared_default_color;

	public override void init()
	{
		base.init();
		_shared_default_color = ColorAsset.tryMakeNewColorAsset("#888888");
		_shared_default_color.id = "SHARED_COLOR";
		addTemplates();
		addNeutral();
		addNomads();
		addNewCivs();
		addCivs();
		addAnimals();
		addUnique();
		addMobs();
		addAnimalMinicivs();
		addCoolMinicivs();
		addCreeps();
	}

	private void addTemplates()
	{
		add(new KingdomAsset
		{
			id = "$TEMPLATE_MOB$",
			mobs = true
		});
		clone("$TEMPLATE_MOB_GOOD$", "$TEMPLATE_MOB$");
		t.addTag("good");
		t.addFriendlyTag("good");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("civ");
		t.addEnemyTag("orc");
		t.addEnemyTag("bandit");
		clone("$TEMPLATE_MOB_VERY_GOOD$", "$TEMPLATE_MOB_GOOD$");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("living_plants");
		t.addFriendlyTag("snowman");
		t.addEnemyTag("wolf");
		t.addEnemyTag("bear");
		clone("$TEMPLATE_ANIMAL$", "$TEMPLATE_MOB$");
		t.addTag("nature_creature");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("neutral_animals");
		clone("$TEMPLATE_ANIMAL_NEUTRAL$", "$TEMPLATE_MOB$");
		t.count_as_danger = false;
		t.addTag("neutral_animals");
		t.addTag("neutral");
		clone("$TEMPLATE_ANIMAL_PEACEFUL$", "$TEMPLATE_ANIMAL_NEUTRAL$");
		t.addFriendlyTag("good");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("civ");
		add(new KingdomAsset
		{
			id = "$TEMPLATE_CIV$",
			civ = true
		});
		t.addTag("civ");
		t.addEnemyTag("bandit");
		clone("$TEMPLATE_CIV_GOOD$", "$TEMPLATE_CIV$");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("good");
		clone("$TEMPLATE_NOMAD$", "$TEMPLATE_CIV_GOOD$");
		t.addFriendlyTag("neutral");
		t.civ = false;
		t.mobs = true;
		t.nomads = true;
		clone("$TEMPLATE_CIV_NEW$", "$TEMPLATE_CIV_GOOD$");
		t.addFriendlyTag("neutral");
	}

	private void addNomads()
	{
		clone("nomads_human", "$TEMPLATE_NOMAD$");
		t.group_main = true;
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#BACADD");
		t.setIcon("ui/Icons/iconHumans");
		t.addTag("human");
		t.addTag("sliceable");
		t.addFriendlyTag("human");
		clone("nomads_elf", "$TEMPLATE_NOMAD$");
		t.group_main = true;
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#98DB8C");
		t.setIcon("ui/Icons/iconElves");
		t.addTag("elf");
		t.addTag("nature_creature");
		t.addTag("sliceable");
		t.addFriendlyTag("elf");
		t.addFriendlyTag("nature_creature");
		clone("nomads_orc", "$TEMPLATE_NOMAD$");
		t.group_main = true;
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#FFCD70");
		t.setIcon("ui/Icons/iconOrcs");
		t.civ = false;
		t.mobs = true;
		t.addTag("orc");
		t.addTag("sliceable");
		t.addFriendlyTag("orc");
		t.addFriendlyTag("golden_brain");
		t.addFriendlyTag("wolf");
		t.addFriendlyTag("hyena");
		clone("nomads_dwarf", "$TEMPLATE_NOMAD$");
		t.group_main = true;
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#B1A0FF");
		t.setIcon("ui/Icons/iconDwarf");
		t.addTag("dwarf");
		t.addFriendlyTag("dwarf");
		t.addFriendlyTag("civ_crystal_golem");
	}

	private void addCivs()
	{
		clone("human", "nomads_human");
		t.group_main = true;
		t.clearKingdomColor();
		t.setIcon("ui/Icons/iconHumans");
		t.civ = true;
		t.mobs = false;
		clone("elf", "nomads_elf");
		t.group_main = true;
		t.clearKingdomColor();
		t.setIcon("ui/Icons/iconElves");
		t.civ = true;
		t.mobs = false;
		clone("dwarf", "nomads_dwarf");
		t.group_main = true;
		t.clearKingdomColor();
		t.setIcon("ui/Icons/iconDwarf");
		t.civ = true;
		t.mobs = false;
		clone("orc", "nomads_orc");
		t.group_main = true;
		t.clearKingdomColor();
		t.setIcon("ui/Icons/iconOrcs");
		t.civ = true;
		t.mobs = false;
	}

	private void addNewCivs()
	{
		clone("civ_cat", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_cat");
		t.addTag("sliceable");
		clone("civ_dog", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_dog");
		t.addTag("sliceable");
		clone("civ_chicken", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_chicken");
		t.addTag("sliceable");
		clone("civ_rabbit", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_rabbit");
		t.addTag("sliceable");
		clone("civ_monkey", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_monkey");
		t.addTag("sliceable");
		clone("civ_fox", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_fox");
		t.addTag("sliceable");
		clone("civ_sheep", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_sheep");
		t.addTag("sliceable");
		clone("civ_cow", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_cow");
		t.addTag("sliceable");
		clone("civ_armadillo", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_armadillo");
		clone("civ_wolf", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_wolf");
		t.addTag("sliceable");
		clone("civ_bear", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_bear");
		t.addTag("sliceable");
		clone("civ_rhino", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_rhino");
		clone("civ_buffalo", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_buffalo");
		t.addTag("sliceable");
		clone("civ_hyena", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_hyena");
		t.addTag("sliceable");
		clone("civ_rat", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_rat");
		t.addTag("sliceable");
		clone("civ_alpaca", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_alpaca");
		t.addTag("sliceable");
		clone("civ_capybara", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_capybara");
		t.friendship_for_everyone = true;
		t.addFriendlyTag("everyone");
		clone("civ_goat", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_goat");
		t.addTag("sliceable");
		clone("civ_crab", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_crab");
		t.addFriendlyTag("crab");
		clone("civ_scorpion", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_scorpion");
		clone("civ_penguin", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_penguin");
		t.addTag("sliceable");
		clone("civ_turtle", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_turtle");
		clone("civ_crocodile", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_crocodile");
		t.addTag("sliceable");
		clone("civ_snake", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_snake");
		t.addTag("sliceable");
		t.addFriendlyTag("snake");
		t.addFriendlyTag("miniciv_snake");
		clone("civ_frog", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_frog");
		t.addTag("sliceable");
		clone("civ_piranha", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_piranha");
		clone("civ_liliar", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_liliar");
		t.addTag("sliceable");
		clone("civ_garlic_man", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_garlic_man");
		t.addTag("garlic");
		clone("civ_lemon_man", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_lemon_man");
		t.addTag("sliceable");
		clone("civ_acid_gentleman", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_acid_gentleman");
		clone("civ_crystal_golem", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_crystal_golem");
		t.addFriendlyTag("dwarf");
		clone("civ_candy_man", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_candy_man");
		clone("civ_beetle", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_beetle");
		clone("civ_seal", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_seal");
		clone("civ_unicorn", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_unicorn");
		clone("civ_ghost", "$TEMPLATE_CIV_NEW$");
		t.setIcon("ui/Icons/civs/civ_ghost");
	}

	private void addMobs()
	{
		clone("bandit", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconBandit");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#E3362F");
		t.addTag("neutral");
		t.addTag("sliceable");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("miniciv_bandit");
		t.addEnemyTag("civ");
		clone("snowman", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconSnowMan");
		t.addTag("snow");
		t.addFriendlyTag("good");
		t.addFriendlyTag("snow");
		clone("evil_mage", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconEvilMage");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#E3362F");
		t.addTag("evil");
		t.addFriendlyTag("demon");
		clone("white_mage", "$TEMPLATE_MOB_VERY_GOOD$");
		t.setIcon("ui/Icons/iconWhiteMage");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#91E1D6");
		clone("necromancer", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconNecromancer");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#81208B");
		t.addTag("evil");
		t.addFriendlyTag("undead");
		t.addFriendlyTag("miniciv_necromancer");
		t.addFriendlyTag("fly");
		t.addEnemyTag("garlic");
		clone("druid", "$TEMPLATE_MOB_GOOD$");
		t.setIcon("ui/Icons/iconDruid");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#85C32E");
		t.addTag("nature_creature");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("super_pumpkin");
		clone("plague_doctor", "$TEMPLATE_MOB_VERY_GOOD$");
		t.setIcon("ui/Icons/iconPlagueDoctor");
		clone("undead", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconZombie");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#D5D5D5");
		t.addFriendlyTag("necromancer");
		t.addEnemyTag("garlic");
		clone("cold_one", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconWalker");
		t.addTag("snow");
		t.addFriendlyTag("snow");
		clone("demon", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconDemon");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#A30000");
		t.addFriendlyTag("fire_elemental");
		clone("angle", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconAngle");
		t.addTag("good");
		t.addTag("nature_creature");
		t.addFriendlyTag("good");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("civ");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("super_pumpkin");
		t.addFriendlyTag("snowman");
		clone("aliens", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconAlien");
		t.addTag("sliceable");
		t.addFriendlyTag("assimilators");
		clone("mush", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/actor_traits/iconMushSpores");
		t.addTag("sliceable");
		t.addFriendlyTag("living_plants");
		clone("greg", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconGreg");
		t.addTag("sliceable");
		clone("fire_elemental", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconFireElemental");
		t.addFriendlyTag("demon");
		t.addFriendlyTag("dragons");
		t.addFriendlyTag("fire_skull");
		clone("dragons", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconDragon");
		t.addTag("sliceable");
		t.addFriendlyTag("fire_elemental");
		clone("living_plants", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconLivingPlants");
		t.addTag("nature_creature");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("good");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("mush");
		clone("living_houses", "$TEMPLATE_MOB$");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#E53B3B");
		t.setIcon("ui/Icons/iconLivingHouse");
		t.addFriendlyTag("living_houses");
		clone("fire_skull", "$TEMPLATE_MOB$");
		t.addTag("undead");
		t.addTag("demon");
		t.setIcon("ui/Icons/iconFireSkull");
		t.addFriendlyTag("demon");
		t.addFriendlyTag("dragons");
		t.addFriendlyTag("undead");
		t.addFriendlyTag("fire_elemental");
		clone("jumpy_skull", "$TEMPLATE_MOB$");
		t.addTag("undead");
		t.setIcon("ui/Icons/iconJumpySkull");
		t.addFriendlyTag("undead");
		t.addFriendlyTag("fire_skull");
		t.addFriendlyTag("necromancer");
		clone("fairy", "good");
		t.setIcon("ui/Icons/iconFairy");
		t.addTag("good");
	}

	private void addAnimals()
	{
		clone("cat", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconCat");
		t.addTag("small");
		t.addTag("sliceable");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("snowman");
		t.addEnemyTag("snake");
		clone("dog", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconDog");
		t.addTag("sliceable");
		t.addFriendlyTag("wolf");
		t.addFriendlyTag("human");
		t.addEnemyTag("cat");
		clone("chicken", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconChicken");
		t.addTag("small");
		t.addTag("sliceable");
		clone("rabbit", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconRabbit");
		t.addTag("small");
		t.addTag("sliceable");
		clone("monkey", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconMonkey");
		t.addTag("sliceable");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("snowman");
		t.addEnemyTag("snake");
		clone("fox", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconFox");
		t.addTag("sliceable");
		t.addFriendlyTag("wolf");
		t.addFriendlyTag("bear");
		clone("sheep", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconSheep");
		t.addTag("sliceable");
		clone("cow", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconCow");
		t.addTag("sliceable");
		clone("armadillo", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconArmadillo");
		clone("raccoon", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconRaccoon");
		t.addTag("sliceable");
		t.addTag("small");
		t.addFriendlyTag("bandit");
		clone("wolf", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconWolf");
		t.addTag("sliceable");
		t.addFriendlyTag("orc");
		t.addFriendlyTag("dog");
		t.addFriendlyTag("living_houses");
		clone("bear", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconBear");
		t.addTag("sliceable");
		t.addFriendlyTag("living_houses");
		t.addEnemyTag("rhino");
		t.addEnemyTag("crocodile");
		clone("rhino", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconRhino");
		t.addEnemyTag("hyena");
		t.addEnemyTag("snake");
		t.addEnemyTag("bear");
		t.addEnemyTag("wolf");
		t.addEnemyTag("rat");
		clone("buffalo", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconBuffalo");
		t.addTag("sliceable");
		t.addFriendlyTag("rhino");
		t.addEnemyTag("hyena");
		t.addEnemyTag("bear");
		t.addEnemyTag("wolf");
		t.addEnemyTag("crocodile");
		clone("hyena", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconHyena");
		t.addTag("sliceable");
		t.addFriendlyTag("orc");
		t.addFriendlyTag("living_houses");
		t.addEnemyTag("monkey");
		clone("rat", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconRat");
		t.addTag("sliceable");
		t.addTag("small");
		t.addFriendlyTag("civ_acid_gentleman");
		t.addFriendlyTag("miniciv_acid_blob");
		t.addFriendlyTag("acid_blob");
		t.addEnemyTag("cat");
		clone("alpaca", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconAlpaca");
		t.addTag("sliceable");
		clone("capybara", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconCapybara");
		t.friendship_for_everyone = true;
		t.addFriendlyTag("everyone");
		clone("goat", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconGoat");
		t.addFriendlyTag("nomads_dwarf");
		t.addFriendlyTag("dwarf");
		t.addFriendlyTag("civ_crystal_golem");
		t.addFriendlyTag("crystal_sword");
		clone("penguin", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconPenguin");
		t.addTag("sliceable");
		t.addFriendlyTag("bandit");
		t.addFriendlyTag("super_pumpkin");
		clone("ostrich", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconOstrich");
		t.addTag("sliceable");
		clone("crab", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconCrab");
		t.addTag("small");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("snowman");
		t.addFriendlyTag("crabzilla");
		clone("scorpion", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconScorpion");
		clone("turtle", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconTurtle");
		clone("crocodile", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconCrocodile");
		t.addTag("sliceable");
		t.addEnemyTag("chicken");
		t.addEnemyTag("monkey");
		clone("snake", "$TEMPLATE_ANIMAL_NEUTRAL$");
		t.setIcon("ui/Icons/iconSnake");
		t.addTag("small");
		t.addTag("nature_creature");
		t.addFriendlyTag("civ_snake");
		t.addFriendlyTag("elf");
		t.addFriendlyTag("nature_creature");
		clone("frog", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconFrog");
		t.addTag("sliceable");
		clone("piranha", "$TEMPLATE_ANIMAL$");
		t.setIcon("ui/Icons/iconPiranha");
		t.addTag("sliceable");
		t.addTag("small");
		clone("seal", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconSeal");
		t.addTag("sliceable");
		clone("flower_bud", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconFlowerBud");
		t.addTag("sliceable");
		clone("crystal_sword", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconCrystalSword");
		t.addEnemyTag("sliceable");
		clone("lemon_snail", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconLemonSnail");
		t.addTag("sliceable");
		t.addTag("small");
		clone("garl", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconGarl");
		t.addTag("garlic");
		clone("smore", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconSmore");
		t.addTag("sliceable");
		t.addTag("small");
		clone("acid_blob", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconAcidBlob");
		t.addEnemyTag("small");
		clone("unicorn", "$TEMPLATE_ANIMAL_PEACEFUL$");
		t.setIcon("ui/Icons/iconUnicorn");
		t.addEnemyTag("sliceable");
	}

	private void addCoolMinicivs()
	{
		cloneAsMiniciv("civ_aliens", "aliens", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("civ_druid", "druid");
		t.group_minicivs_cool = true;
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#85C32E");
		t.addTag("sliceable");
		cloneAsMiniciv("miniciv_angle", "angle", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_bandit", "bandit", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_cold_one", "cold_one", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_demon", "demon", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_evil_mage", "evil_mage", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_fire_skull", "fire_skull", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_jumpy_skull", "jumpy_skull", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_necromancer", "necromancer", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		t.addFriendlyTag("necromancer");
		t.addFriendlyTag("undead");
		cloneAsMiniciv("miniciv_plague_doctor", "plague_doctor", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_white_mage", "white_mage", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_greg", "greg");
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_fairy", "fairy", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
		cloneAsMiniciv("miniciv_snowman", "snowman", pMakeLoveToNeutrals: true);
		t.group_minicivs_cool = true;
	}

	private void addAnimalMinicivs()
	{
		cloneAsMiniciv("miniciv_cat", "cat");
		cloneAsMiniciv("miniciv_dog", "dog");
		cloneAsMiniciv("miniciv_chicken", "chicken");
		cloneAsMiniciv("miniciv_rabbit", "rabbit");
		cloneAsMiniciv("miniciv_monkey", "monkey");
		cloneAsMiniciv("miniciv_fox", "fox");
		cloneAsMiniciv("miniciv_sheep", "sheep");
		cloneAsMiniciv("miniciv_cow", "cow");
		cloneAsMiniciv("miniciv_armadillo", "armadillo");
		cloneAsMiniciv("miniciv_raccoon", "raccoon");
		cloneAsMiniciv("miniciv_wolf", "wolf");
		cloneAsMiniciv("miniciv_bear", "bear");
		cloneAsMiniciv("miniciv_rhino", "rhino");
		cloneAsMiniciv("miniciv_buffalo", "buffalo");
		cloneAsMiniciv("miniciv_hyena", "hyena");
		cloneAsMiniciv("miniciv_rat", "rat");
		cloneAsMiniciv("miniciv_alpaca", "alpaca");
		cloneAsMiniciv("miniciv_capybara", "capybara");
		t.addFriendlyTag("everyone");
		cloneAsMiniciv("miniciv_goat", "goat");
		cloneAsMiniciv("miniciv_penguin", "penguin");
		cloneAsMiniciv("miniciv_ostrich", "ostrich");
		cloneAsMiniciv("miniciv_crab", "crab");
		t.addFriendlyTag("crabzilla");
		cloneAsMiniciv("miniciv_scorpion", "scorpion");
		cloneAsMiniciv("miniciv_turtle", "turtle");
		cloneAsMiniciv("miniciv_crocodile", "crocodile");
		cloneAsMiniciv("miniciv_snake", "snake");
		cloneAsMiniciv("miniciv_frog", "frog");
		cloneAsMiniciv("miniciv_piranha", "piranha");
		cloneAsMiniciv("miniciv_seal", "seal");
		cloneAsMiniciv("miniciv_flower_bud", "flower_bud");
		cloneAsMiniciv("miniciv_crystal_sword", "crystal_sword");
		cloneAsMiniciv("miniciv_lemon_snail", "lemon_snail");
		cloneAsMiniciv("miniciv_garl", "garl");
		cloneAsMiniciv("miniciv_smore", "smore");
		cloneAsMiniciv("miniciv_acid_blob", "acid_blob");
		cloneAsMiniciv("miniciv_insect", "insect");
		cloneAsMiniciv("miniciv_unicorn", "unicorn");
	}

	private void addCreeps()
	{
		clone("super_pumpkin", "$TEMPLATE_MOB$");
		t.setIcon("ui/Icons/iconSuperPumpkin");
		t.addTag("sliceable");
		t.group_creeps = true;
		t.addFriendlyTag("druid");
		clone("tumor", "$TEMPLATE_MOB$");
		t.group_creeps = true;
		t.setIcon("ui/Icons/iconTumor");
		clone("biomass", "$TEMPLATE_MOB$");
		t.group_creeps = true;
		t.setIcon("ui/Icons/iconBiomass");
		clone("assimilators", "$TEMPLATE_MOB$");
		t.group_creeps = true;
		t.setIcon("ui/Icons/iconAssimilator");
		t.addFriendlyTag("aliens");
	}

	private void addUnique()
	{
		add(new KingdomAsset
		{
			id = "godfinger",
			nature = true,
			count_as_danger = false
		});
		t.setIcon("ui/Icons/iconGodFinger");
		add(new KingdomAsset
		{
			id = "good",
			mobs = true,
			concept = true,
			count_as_danger = false
		});
		t.setIcon("ui/Icons/actor_traits/iconBlessing");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("civ");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("snowman");
		t.addEnemyTag("wolf");
		t.addEnemyTag("bear");
		t.addEnemyTag("orc");
		t.addEnemyTag("bandit");
		add(new KingdomAsset
		{
			id = "mad",
			always_attack_each_other = true,
			force_look_all_chunks = true,
			mobs = true,
			units_always_looking_for_enemies = true,
			is_forced_by_trait = true,
			forced_by_trait_kingdom_id = "madness"
		});
		t.setIcon("ui/Icons/actor_traits/iconMadness");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#E53B3B");
		add(new KingdomAsset
		{
			id = "alien_mold",
			force_look_all_chunks = true,
			mobs = true,
			units_always_looking_for_enemies = true,
			is_forced_by_trait = true,
			forced_by_trait_kingdom_id = "desire_alien_mold",
			building_attractor_id = "waypoint_alien_mold"
		});
		t.setIcon("ui/Icons/iconWaypointAlienMold");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#C342FF");
		t.addFriendlyTag("aliens");
		t.addFriendlyTag("civ_aliens");
		add(new KingdomAsset
		{
			id = "computer",
			force_look_all_chunks = true,
			mobs = true,
			units_always_looking_for_enemies = true,
			is_forced_by_trait = true,
			forced_by_trait_kingdom_id = "desire_computer",
			building_attractor_id = "waypoint_computer"
		});
		t.setIcon("ui/Icons/iconWaypointComputer");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#5DCE2D");
		t.addFriendlyTag("assimilators");
		add(new KingdomAsset
		{
			id = "golden_egg",
			force_look_all_chunks = true,
			mobs = true,
			units_always_looking_for_enemies = true,
			is_forced_by_trait = true,
			forced_by_trait_kingdom_id = "desire_golden_egg",
			building_attractor_id = "waypoint_golden_egg"
		});
		t.setIcon("ui/Icons/iconWaypointGoldenEgg");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#FFEC77");
		t.addFriendlyTag("chicken");
		t.addFriendlyTag("civ_chicken");
		t.addFriendlyTag("miniciv_chicken");
		t.addFriendlyTag("sheep");
		t.addFriendlyTag("civ_sheep");
		t.addFriendlyTag("miniciv_sheep");
		add(new KingdomAsset
		{
			id = "harp",
			force_look_all_chunks = true,
			mobs = true,
			units_always_looking_for_enemies = true,
			is_forced_by_trait = true,
			forced_by_trait_kingdom_id = "desire_harp",
			building_attractor_id = "waypoint_harp"
		});
		t.setIcon("ui/Icons/iconWaypointHarp");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#FF60E9");
		t.addFriendlyTag("crystal_sword");
		t.addFriendlyTag("civ_crystal_golem");
		t.addFriendlyTag("miniciv_crystal_sword");
		add(new KingdomAsset
		{
			id = "possessed",
			force_look_all_chunks = true
		});
		t.setIcon("ui/Icons/iconPossessed2");
		t.addEnemyTag("nature");
		t.addEnemyTag("ruins");
		t.addEnemyTag("abandoned");
		add(new KingdomAsset
		{
			id = "crabzilla",
			mobs = true
		});
		t.setIcon("ui/Icons/iconCrabzilla");
		t.addTag("crab");
		t.addFriendlyTag("crab");
		t.addFriendlyTag("civ_crab");
		t.addFriendlyTag("miniciv_crab");
		add(new KingdomAsset
		{
			id = "ants",
			mobs = true
		});
		t.setIcon("ui/Icons/iconAntRed");
		t.addTag("nature_creature");
		t.addFriendlyTag("good");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("living_houses");
		add(new KingdomAsset
		{
			id = "golden_brain",
			mobs = true,
			brain = true,
			count_as_danger = false
		});
		t.setIcon("ui/Icons/iconGoldBrain");
		t.addTag("neutral");
		t.addFriendlyTag("orc");
		t.addFriendlyTag("bandit");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("civ");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("snowman");
		add(new KingdomAsset
		{
			id = "corrupted_brain",
			mobs = true,
			brain = true
		});
		t.setIcon("ui/Icons/iconCorruptedBrain");
		t.addTag("mad");
	}

	private void addNeutral()
	{
		//IL_0270: Unknown result type (might be due to invalid IL or missing references)
		//IL_0275: Unknown result type (might be due to invalid IL or missing references)
		//IL_02df: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e4: Unknown result type (might be due to invalid IL or missing references)
		add(new KingdomAsset
		{
			id = "neutral",
			civ = true,
			neutral = true,
			default_civ_color_index = 83,
			count_as_danger = false,
			concept = true
		});
		t.setIcon("ui/Icons/worldrules/icon_random_seeds");
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#AAAAAA");
		t.addTag("nature_creature");
		t.addTag("neutral");
		t.addFriendlyTag("good");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("neutral");
		add(new KingdomAsset
		{
			id = "neutral_animals",
			mobs = true,
			count_as_danger = false,
			concept = true
		});
		t.setIcon("ui/Icons/worldrules/icon_animalspawn");
		t.addTag("neutral");
		t.addTag("nature_creature");
		t.addFriendlyTag("good");
		t.addFriendlyTag("neutral");
		t.addFriendlyTag("nature_creature");
		t.addFriendlyTag("living_houses");
		t.addFriendlyTag("snowman");
		t.addFriendlyTag("civ");
		clone("insect", "neutral_animals");
		t.setIcon("ui/Icons/iconBeetle");
		t.concept = true;
		clone("fly", "insect");
		t.setIcon("ui/Icons/iconFly");
		add(new KingdomAsset
		{
			id = "nature",
			nature = true,
			mobs = true,
			count_as_danger = false,
			concept = true
		});
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#888888");
		t.setIcon("ui/Icons/world generation/icon_randomBiomes");
		add(new KingdomAsset
		{
			id = "ruins",
			nature = true,
			mobs = true,
			count_as_danger = false,
			concept = true
		});
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#444444");
		t.setIcon("ui/Icons/iconCityDestroyed");
		t.color_building = Toolbox.color_white;
		add(new KingdomAsset
		{
			id = "abandoned",
			nature = true,
			mobs = true,
			abandoned = true,
			count_as_danger = false,
			concept = true
		});
		t.default_kingdom_color = ColorAsset.tryMakeNewColorAsset("#888888");
		t.setIcon("ui/Icons/iconKingdomDestroyed");
		t.color_building = Toolbox.color_abandoned_building;
	}

	public override void post_init()
	{
		base.post_init();
		using ListPool<string> listPool = new ListPool<string>();
		foreach (KingdomAsset item in list)
		{
			if (item.friendship_for_everyone && !item.brain)
			{
				listPool.Add(item.id);
			}
		}
		foreach (KingdomAsset item2 in list)
		{
			item2.addTag("everyone");
			foreach (ref string item3 in listPool)
			{
				string current3 = item3;
				item2.addFriendlyTag(current3);
			}
			if (item2.default_kingdom_color != null)
			{
				if (string.Equals(item2.default_kingdom_color.id, "ASSET_ID"))
				{
					item2.default_kingdom_color.id = "kingdom_library_color_" + item2.id;
				}
			}
			else
			{
				item2.default_kingdom_color = _shared_default_color;
			}
		}
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (KingdomAsset item in list)
		{
			finish(item);
		}
	}

	private void finish(KingdomAsset pAsset)
	{
	}

	public override void editorDiagnostic()
	{
		base.editorDiagnostic();
		generateDebugReportFile();
		foreach (KingdomAsset item in list)
		{
			if ((!item.civ && !item.mobs) || item.concept || item.nomads || item.nature || item.neutral || item.brain || item.is_forced_by_trait)
			{
				continue;
			}
			bool flag = false;
			foreach (ActorAsset item2 in AssetManager.actor_library.list)
			{
				if (item.civ && item2.kingdom_id_civilization == item.id)
				{
					flag = true;
					break;
				}
				if (item.mobs && item2.kingdom_id_wild == item.id)
				{
					flag = true;
					break;
				}
			}
			if (!flag)
			{
				if (item.civ)
				{
					BaseAssetLibrary.logAssetError("<b>KingdomLibrary</b>: <e>Civ Kingdom</e> is not used by any <e>kingdom_id_civilization</e>", item.id);
				}
				else
				{
					BaseAssetLibrary.logAssetError("<b>KingdomLibrary</b>: <e>Mob Kingdom</e> is not used by any <e>kingdom_id_wild</e>", item.id);
				}
			}
		}
	}

	public void checkForMissingTags()
	{
		for (int i = 0; i < list.Count - 1; i++)
		{
			KingdomAsset kingdomAsset = list[i];
			for (int j = i + 1; j < list.Count; j++)
			{
				KingdomAsset kingdomAsset2 = list[j];
				if (kingdomAsset == kingdomAsset2 || kingdomAsset.isFoe(kingdomAsset2) == kingdomAsset2.isFoe(kingdomAsset))
				{
					continue;
				}
				KingdomAsset kingdomAsset3 = kingdomAsset;
				if (kingdomAsset3.assets_discrepancies == null)
				{
					kingdomAsset3.assets_discrepancies = new HashSet<string>();
				}
				kingdomAsset3 = kingdomAsset2;
				if (kingdomAsset3.assets_discrepancies == null)
				{
					kingdomAsset3.assets_discrepancies = new HashSet<string>();
				}
				kingdomAsset.assets_discrepancies.Add(kingdomAsset2.id);
				kingdomAsset2.assets_discrepancies.Add(kingdomAsset.id);
				if (kingdomAsset2.id.Contains(kingdomAsset.id) || kingdomAsset.id.Contains(kingdomAsset2.id))
				{
					kingdomAsset3 = kingdomAsset;
					if (kingdomAsset3.assets_discrepancies_bad == null)
					{
						kingdomAsset3.assets_discrepancies_bad = new HashSet<string>();
					}
					kingdomAsset3 = kingdomAsset2;
					if (kingdomAsset3.assets_discrepancies_bad == null)
					{
						kingdomAsset3.assets_discrepancies_bad = new HashSet<string>();
					}
					kingdomAsset.assets_discrepancies_bad.Add(kingdomAsset2.id);
					kingdomAsset2.assets_discrepancies_bad.Add(kingdomAsset.id);
				}
			}
		}
	}

	public void generateDebugReportFile()
	{
		if (!DebugConfig.isOn(DebugOption.GenerateGameplayReport))
		{
			return;
		}
		string path = "GenAssets/wbdiag/kingdom_library.log";
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		stringBuilderPool.AppendLine("# RELATIONS");
		using ListPool<string> listPool = new ListPool<string>();
		using ListPool<string> listPool2 = new ListPool<string>();
		Span<KingdomAsset> span = list.AsSpan();
		Span<KingdomAsset> span2 = span;
		for (int i = 0; i < span2.Length; i++)
		{
			KingdomAsset kingdomAsset = span2[i];
			listPool.Clear();
			listPool2.Clear();
			stringBuilderPool.AppendLine("###" + kingdomAsset.id.ToUpper() + ":");
			Span<KingdomAsset> span3 = span;
			for (int j = 0; j < span3.Length; j++)
			{
				KingdomAsset kingdomAsset2 = span3[j];
				if (kingdomAsset.isFoe(kingdomAsset2))
				{
					listPool2.Add(kingdomAsset2.id);
				}
				else
				{
					listPool.Add(kingdomAsset2.id);
				}
			}
			stringBuilderPool.AppendLine("- FRIENDLY:");
			foreach (ref string item in listPool)
			{
				string current = item;
				stringBuilderPool.AppendLine("   " + current);
			}
			stringBuilderPool.AppendLine("- FOES:");
			foreach (ref string item2 in listPool2)
			{
				string current2 = item2;
				stringBuilderPool.AppendLine("   " + current2);
			}
			stringBuilderPool.AppendLine();
		}
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine("# TAGS");
		Dictionary<string, HashSet<string>> dictionary = UnsafeCollectionPool<Dictionary<string, HashSet<string>>, KeyValuePair<string, HashSet<string>>>.Get();
		span2 = span;
		for (int i = 0; i < span2.Length; i++)
		{
			foreach (string list_tag in span2[i].list_tags)
			{
				dictionary.TryAdd(list_tag, UnsafeCollectionPool<HashSet<string>, string>.Get());
				Span<KingdomAsset> span3 = span;
				for (int j = 0; j < span3.Length; j++)
				{
					KingdomAsset kingdomAsset3 = span3[j];
					if (kingdomAsset3.list_tags.Contains(list_tag))
					{
						dictionary[list_tag].Add(kingdomAsset3.id);
					}
				}
			}
		}
		foreach (KeyValuePair<string, HashSet<string>> item3 in dictionary)
		{
			stringBuilderPool.AppendLine("-" + item3.Key.ToUpper() + ":");
			foreach (string item4 in item3.Value)
			{
				stringBuilderPool.AppendLine("   " + item4);
			}
			UnsafeCollectionPool<HashSet<string>, string>.Release(item3.Value);
		}
		dictionary.Clear();
		UnsafeCollectionPool<Dictionary<string, HashSet<string>>, KeyValuePair<string, HashSet<string>>>.Release(dictionary);
		File.WriteAllTextAsync(path, stringBuilderPool.ToString());
	}

	public void cloneAsMiniciv(string pNew, string pFrom, bool pMakeLoveToNeutrals = false)
	{
		clone(pNew, pFrom);
		t.group_miniciv = true;
		t.mobs = false;
		t.civ = true;
		t.addTag(pFrom);
		t.addFriendlyTag(pFrom);
		get(pFrom).addFriendlyTag(pNew);
		if (pMakeLoveToNeutrals)
		{
			t.addTag("civ");
			t.addFriendlyTag("neutral");
			t.addFriendlyTag("nature_creature");
		}
	}

	public override KingdomAsset clone(string pNew, string pFrom)
	{
		base.clone(pNew, pFrom);
		t.concept = false;
		return t;
	}
}
// --- End of File: KingdomLibrary.cs ---



// --- Start of File: KingdomListComponent.cs ---
public class KingdomListComponent : ComponentListBase<KingdomListElement, Kingdom, KingdomData, KingdomListComponent>
{
	protected override MetaType meta_type => MetaType.Kingdom;

	protected override void setupSortingTabs()
	{
		genericMetaSortByAge(base.sortByAge);
		genericMetaSortByRenown(base.sortByRenown);
		genericMetaSortByPopulation(ComponentListBase<KingdomListElement, Kingdom, KingdomData, KingdomListComponent>.sortByPopulation);
		sorting_tab.tryAddButton("ui/Icons/iconArmy", "sort_by_army", show, delegate
		{
			current_sort = sortByArmy;
		});
		sorting_tab.tryAddButton("ui/Icons/iconChildren", "sort_by_children", show, delegate
		{
			current_sort = sortByChildren;
		});
		sorting_tab.tryAddButton("ui/Icons/iconVillages", "sort_by_villages", show, delegate
		{
			current_sort = sortByCities;
		});
		sorting_tab.tryAddButton("ui/Icons/iconZones", "sort_by_area", show, delegate
		{
			current_sort = sortByArea;
		});
	}

	private static int sortByArea(Kingdom p1, Kingdom p2)
	{
		return p2.countZones().CompareTo(p1.countZones());
	}

	public static int sortByArmy(Kingdom p1, Kingdom p2)
	{
		return p2.countTotalWarriors().CompareTo(p1.countTotalWarriors());
	}

	private static int sortByChildren(Kingdom p1, Kingdom p2)
	{
		return p2.countChildren().CompareTo(p1.countChildren());
	}

	private static int sortByCities(Kingdom p1, Kingdom p2)
	{
		return p2.countCities().CompareTo(p1.countCities());
	}
}
// --- End of File: KingdomListComponent.cs ---



// --- Start of File: KingdomListElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class KingdomListElement : WindowListElementBase<Kingdom, KingdomData>
{
	public CountUpOnClick textAge;

	public CountUpOnClick textPopulation;

	public CountUpOnClick textArmy;

	public CountUpOnClick textCities;

	public CountUpOnClick textHouses;

	public CountUpOnClick textZones;

	public Text kingdomName;

	public GameObject buttonCapital;

	public GameObject buttonKing;

	public UiUnitAvatarElement avatarLoader;

	internal override void show(Kingdom pKingdom)
	{
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		base.show(pKingdom);
		kingdomName.text = pKingdom.name;
		Color colorText = pKingdom.getColor().getColorText();
		((Graphic)kingdomName).color = colorText;
		avatarLoader.show(pKingdom.king);
		int num = 0;
		int num2 = 0;
		int num3 = 0;
		foreach (City city in pKingdom.getCities())
		{
			num3++;
			num += city.zones.Count;
			num2 += city.buildings.Count;
		}
		textPopulation.setValue(pKingdom.getPopulationPeople());
		textArmy.setValue(pKingdom.countTotalWarriors());
		textZones.setValue(num);
		textHouses.setValue(num2);
		textCities.setValue(num3, "/" + pKingdom.getMaxCities());
		textAge.setValue(pKingdom.getAge());
	}

	protected override void tooltipAction()
	{
		Tooltip.show(this, "kingdom", new TooltipData
		{
			kingdom = meta_object
		});
	}

	protected override ActorAsset getActorAsset()
	{
		return meta_object.getActorAsset();
	}
}
// --- End of File: KingdomListElement.cs ---



// --- Start of File: KingdomManager.cs ---
using System;
using System.Collections.Generic;
using JetBrains.Annotations;
using SQLite;
using UnityEngine;
using db;

public class KingdomManager : MetaSystemManager<Kingdom, KingdomData>
{
	private bool _dirty_cities = true;

	private bool _dirty_buildings = true;

	protected readonly Dictionary<long, DeadKingdom> _dead_kingdoms = new Dictionary<long, DeadKingdom>();

	public KingdomManager()
	{
		type_id = "kingdom";
	}

	public Kingdom makeNewCivKingdom(Actor pActor, string pID = null, bool pLog = true)
	{
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		World.world.game_stats.data.kingdomsCreated++;
		World.world.map_stats.kingdomsCreated++;
		Kingdom kingdom = newObject();
		kingdom.newCivKingdom(pActor);
		pActor.stopBeingWarrior();
		pActor.joinKingdom(kingdom);
		kingdom.setKing(pActor);
		kingdom.location = Vector2.op_Implicit(pActor.current_position);
		if (pLog)
		{
			WorldLog.logNewKingdom(kingdom);
		}
		return kingdom;
	}

	protected override void addObject(Kingdom pObject)
	{
		base.addObject(pObject);
		World.world.zone_calculator?.setDrawnZonesDirty();
		pObject.createAI();
	}

	public override void removeObject(Kingdom pKingdom)
	{
		World.world.game_stats.data.kingdomsDestroyed++;
		World.world.map_stats.kingdomsDestroyed++;
		WorldLog.logKingdomDestroyed(pKingdom);
		World.world.diplomacy.removeRelationsFor(pKingdom);
		if (World.world.isSelectedPower("relations") && SelectedMetas.selected_kingdom == pKingdom)
		{
			World.world.selected_buttons.unselectAll();
		}
		if (Config.whisper_A == pKingdom)
		{
			Config.whisper_A = null;
		}
		if (Config.unity_A == pKingdom)
		{
			Config.unity_A = null;
		}
		pKingdom.makeSurvivorsToNomads();
		World.world.zone_calculator.setDrawnZonesDirty();
		using ListPool<War> listPool = new ListPool<War>(pKingdom.getWars());
		foreach (ref War item in listPool)
		{
			item.removeFromWar(pKingdom, pInPeace: false);
		}
		pKingdom.getAlliance()?.leave(pKingdom);
		World.world.cultures.setDirtyKingdoms();
		World.world.languages.setDirtyKingdoms();
		World.world.religions.setDirtyKingdoms();
		base.removeObject(pKingdom);
		DBInserter.insertData((BaseSystemData)pKingdom.data, type_id);
	}

	public Kingdom getCivOrWildViaID(long pID)
	{
		if (pID < 0)
		{
			return World.world.kingdoms_wild.get(pID);
		}
		return World.world.kingdoms.get(pID);
	}

	public override void update(float pElapsed)
	{
		base.update(pElapsed);
		using (IEnumerator<Kingdom> enumerator = GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				enumerator.Current.clearCursorOver();
			}
		}
		if (!World.world.isPaused())
		{
			updateCivKingdoms(pElapsed);
		}
	}

	private void updateCivKingdoms(float pElapsed)
	{
		int i = 0;
		for (int count = list.Count; i < count; i++)
		{
			list[i].updateCiv(pElapsed);
		}
	}

	public void updateAge()
	{
		using IEnumerator<Kingdom> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.updateAge();
		}
	}

	[CanBeNull]
	public DeadKingdom db_get(long pID)
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		if (Config.disable_db)
		{
			return null;
		}
		if (_dead_kingdoms.TryGetValue(pID, out var value))
		{
			return value;
		}
		SQLiteConnectionWithLock syncConnection = DBManager.getSyncConnection();
		LockWrapper val = syncConnection.Lock();
		try
		{
			KingdomData kingdomData = ((SQLiteConnection)syncConnection).Find<KingdomData>((object)pID);
			if (kingdomData == null)
			{
				return null;
			}
			kingdomData.from_db = true;
			value = new DeadKingdom();
			value.loadData(kingdomData);
			_dead_kingdoms[pID] = value;
			return value;
		}
		finally
		{
			((IDisposable)(LockWrapper)(ref val)).Dispose();
		}
	}

	public override void clear()
	{
		foreach (DeadKingdom value in _dead_kingdoms.Values)
		{
			value.Dispose();
		}
		_dead_kingdoms.Clear();
		base.clear();
	}

	public override bool isLocked()
	{
		if (isUnitsDirty())
		{
			return true;
		}
		if (_dirty_cities)
		{
			return true;
		}
		return false;
	}

	protected override void updateDirtyUnits()
	{
		for (int i = 0; i < World.world.units.units_only_dying.Count; i++)
		{
			World.world.units.units_only_dying[i].kingdom.preserveAlive();
		}
		List<Actor> units_only_civ = World.world.units.units_only_civ;
		for (int j = 0; j < units_only_civ.Count; j++)
		{
			Actor actor = units_only_civ[j];
			if (actor.kingdom.isDirtyUnits())
			{
				actor.kingdom.listUnit(actor);
			}
		}
	}

	public void beginChecksCities()
	{
		if (_dirty_cities)
		{
			updateDirtyCities();
		}
		_dirty_cities = false;
	}

	public void updateDirtyCities()
	{
		clearAllCitiesLists();
		foreach (City city in World.world.cities)
		{
			city.kingdom.listCity(city);
		}
	}

	public void clearAllCitiesLists()
	{
		using (IEnumerator<Kingdom> enumerator = GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				enumerator.Current.clearListCities();
			}
		}
		WildKingdomsManager.neutral.clearListCities();
	}

	public bool hasDirtyCities()
	{
		return _dirty_cities;
	}

	public void setDirtyCities()
	{
		_dirty_cities = true;
	}

	public void beginChecksBuildings()
	{
		if (_dirty_buildings)
		{
			updateDirtyBuildings();
		}
		_dirty_buildings = false;
	}

	private void updateDirtyBuildings()
	{
		clearAllBuildingLists();
		foreach (City city in World.world.cities)
		{
			if (!city.kingdom.wild)
			{
				city.kingdom.addBuildings(city.buildings);
			}
		}
	}

	public void setDirtyBuildings()
	{
		_dirty_buildings = true;
	}

	private void clearAllBuildingLists()
	{
		using IEnumerator<Kingdom> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.clearBuildingList();
		}
	}
}
// --- End of File: KingdomManager.cs ---



// --- Start of File: KingdomMetaBanners.cs ---
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class KingdomMetaBanners : KingdomElement, IBaseMetaBanners
{
	[SerializeField]
	private CityBanner _banner_city;

	[SerializeField]
	private CultureBanner _banner_culture;

	[SerializeField]
	private AllianceBanner _banner_alliance;

	[SerializeField]
	private LanguageBanner _banner_language;

	[SerializeField]
	private ReligionBanner _banner_religion;

	[SerializeField]
	private ClanBanner _banner_clan;

	[SerializeField]
	private SubspeciesBanner _banner_subspecies;

	protected List<MetaBannerElement> banners = new List<MetaBannerElement>();

	private const float DELAY = 0.025f;

	protected int visible_banners;

	protected override void Awake()
	{
		base.Awake();
		banners.Add(new MetaBannerElement
		{
			banner = _banner_city,
			check = () => base.kingdom.hasCapital(),
			nano = () => base.kingdom.capital
		});
		banners.Add(new MetaBannerElement
		{
			banner = _banner_clan,
			check = () => base.kingdom.getKingClan() != null,
			nano = () => base.kingdom.getKingClan()
		});
		banners.Add(new MetaBannerElement
		{
			banner = _banner_alliance,
			check = () => base.kingdom.hasAlliance(),
			nano = () => base.kingdom.getAlliance()
		});
		banners.Add(new MetaBannerElement
		{
			banner = _banner_language,
			check = () => base.kingdom.hasLanguage(),
			nano = () => base.kingdom.getLanguage()
		});
		banners.Add(new MetaBannerElement
		{
			banner = _banner_culture,
			check = () => base.kingdom.hasCulture(),
			nano = () => base.kingdom.getCulture()
		});
		banners.Add(new MetaBannerElement
		{
			banner = _banner_religion,
			check = () => base.kingdom.hasReligion(),
			nano = () => base.kingdom.getReligion()
		});
		banners.Add(new MetaBannerElement
		{
			banner = _banner_subspecies,
			check = () => base.kingdom.getMainSubspecies() != null,
			nano = () => base.kingdom.getMainSubspecies()
		});
		((IBaseMetaBanners)this).enableClickAnimation();
	}

	protected override IEnumerator showContent()
	{
		banners.Sort((MetaBannerElement x, MetaBannerElement y) => ((Component)x.banner).transform.GetSiblingIndex().CompareTo(((Component)y.banner).transform.GetSiblingIndex()));
		yield return (object)new WaitForSecondsRealtime(0.025f);
		foreach (MetaBannerElement banner in banners)
		{
			if (banner.check())
			{
				track_objects.Add(banner.nano());
				metaBannerShow(banner);
			}
		}
	}

	protected override void clear()
	{
		base.clear();
		foreach (MetaBannerElement banner in banners)
		{
			metaBannerHide(banner);
		}
		visible_banners = 0;
	}

	public void metaBannerShow(MetaBannerElement pAsset)
	{
		((Component)pAsset.banner).gameObject.SetActive(true);
		pAsset.banner.load(pAsset.nano());
		visible_banners++;
	}

	public void metaBannerHide(MetaBannerElement pAsset)
	{
		if (((Component)pAsset.banner).gameObject.activeSelf)
		{
			((Component)pAsset.banner).gameObject.SetActive(false);
		}
	}

	public IReadOnlyCollection<MetaBannerElement> getBanners()
	{
		return banners;
	}
}
// --- End of File: KingdomMetaBanners.cs ---



// --- Start of File: KingdomOpinion.cs ---
using System;
using System.Collections.Generic;
using UnityPools;

public class KingdomOpinion : IDisposable
{
	public readonly Dictionary<OpinionAsset, int> results = UnsafeCollectionPool<Dictionary<OpinionAsset, int>, KeyValuePair<OpinionAsset, int>>.Get();

	public int total;

	public Kingdom main;

	public Kingdom target;

	public KingdomOpinion(Kingdom k1, Kingdom k2)
	{
		main = k1;
		target = k2;
	}

	internal void calculate(Kingdom pMain, Kingdom pTarget, DiplomacyRelation pRelation)
	{
		clear();
		foreach (OpinionAsset item in AssetManager.opinion_library.list)
		{
			int num = item.calc(pMain, pTarget);
			total += num;
			if (num != 0)
			{
				results.Add(item, num);
			}
		}
	}

	private void clear()
	{
		total = 0;
		results.Clear();
	}

	public void Dispose()
	{
		clear();
		UnsafeCollectionPool<Dictionary<OpinionAsset, int>, KeyValuePair<OpinionAsset, int>>.Release(results);
		main = null;
		target = null;
	}
}
// --- End of File: KingdomOpinion.cs ---



// --- Start of File: KingdomsBannersContainer.cs ---
using System.Collections.Generic;

public class KingdomsBannersContainer : BannersMetaContainer<KingdomBanner, Kingdom, KingdomData>
{
	protected override IEnumerable<Kingdom> getMetaList(IMetaObject pMeta)
	{
		return pMeta.getKingdoms();
	}
}
// --- End of File: KingdomsBannersContainer.cs ---



// --- Start of File: KingdomSelectedAlliesContainer.cs ---
using UnityEngine;

public class KingdomSelectedAlliesContainer : KingdomDiplomacyContainer<KingdomBanner, Kingdom, KingdomData>
{
	protected override void OnEnable()
	{
	}

	public void update(Kingdom pKingdom)
	{
		meta_object = pKingdom;
		clear();
		using ListPool<Kingdom> listPool = World.world.wars.getNeutralKingdoms(base.kingdom);
		if (base.kingdom.hasAlliance())
		{
			foreach (Kingdom item in base.kingdom.getAlliance().kingdoms_list)
			{
				if (item != base.kingdom && !item.isRekt())
				{
					listPool.Add(item);
				}
			}
		}
		track_objects.AddRange(listPool);
		if (listPool.Count == 0)
		{
			return;
		}
		foreach (ref Kingdom item2 in listPool)
		{
			Kingdom current2 = item2;
			if (!current2.isRekt())
			{
				KingdomBanner next = pool_elements.getNext();
				next.diplo_banner = true;
				((Component)next).GetComponent<TipButton>().showOnClick = true;
				((Behaviour)((Component)next).GetComponentInChildren<RotateOnHover>()).enabled = true;
				if (!((Component)(object)next).HasComponent<DraggableLayoutElement>())
				{
					((Component)(object)next).AddComponent<DraggableLayoutElement>();
				}
				next.load(current2);
			}
		}
	}
}
// --- End of File: KingdomSelectedAlliesContainer.cs ---



// --- Start of File: KingdomSelectedContainerCities.cs ---
using UnityEngine;

public class KingdomSelectedContainerCities : SelectedElementBase<CityBanner>
{
	[SerializeField]
	private CityBanner _banner_prefab;

	private void Awake()
	{
		_pool = new ObjectPoolGenericMono<CityBanner>(_banner_prefab, _grid);
		((Component)_grid).gameObject.AddOrGetComponent<TraitsGrid>();
	}

	public void update(NanoObject pNano)
	{
		refresh(pNano);
	}

	protected override void refresh(NanoObject pNano)
	{
		clear();
		foreach (City city in ((Kingdom)pNano).getCities())
		{
			addBanner(city);
		}
	}

	private void addBanner(City pCity)
	{
		_pool.getNext().load(pCity);
	}
}
// --- End of File: KingdomSelectedContainerCities.cs ---



// --- Start of File: KingdomSelectedContainerTraits.cs ---
using System.Collections.Generic;

public class KingdomSelectedContainerTraits : SelectedContainerTraits<KingdomTrait, KingdomTraitButton, KingdomTraitsContainer, KingdomTraitsEditor>
{
	protected override MetaType meta_type => MetaType.Kingdom;

	protected override IReadOnlyCollection<KingdomTrait> getTraits()
	{
		return SelectedMetas.selected_kingdom.getTraits();
	}

	protected override bool canEditTraits()
	{
		return true;
	}
}
// --- End of File: KingdomSelectedContainerTraits.cs ---



// --- Start of File: KingdomSelectedMetaBanners.cs ---
public class KingdomSelectedMetaBanners : KingdomMetaBanners, ISelectedTabBanners<Kingdom>
{
	public void update(Kingdom pKingdom)
	{
		meta_object = pKingdom;
		clear();
		foreach (MetaBannerElement banner in banners)
		{
			if (banner.check())
			{
				metaBannerShow(banner);
			}
		}
	}

	protected override void OnEnable()
	{
	}

	public int countVisibleBanners()
	{
		return visible_banners;
	}
}
// --- End of File: KingdomSelectedMetaBanners.cs ---



// --- Start of File: KingdomSelectedWarsContainer.cs ---
using UnityEngine;

public class KingdomSelectedWarsContainer : KingdomDiplomacyContainer<WarBanner, War, WarData>
{
	protected override void OnEnable()
	{
	}

	public void update(Kingdom pKingdom)
	{
		meta_object = pKingdom;
		clear();
		if (!base.kingdom.hasEnemies())
		{
			return;
		}
		using ListPool<War> listPool = new ListPool<War>(base.kingdom.getWars());
		track_objects.AddRange(listPool);
		foreach (ref War item in listPool)
		{
			War current = item;
			if (!current.isRekt())
			{
				WarBanner next = pool_elements.getNext();
				TipButton component = ((Component)next).GetComponent<TipButton>();
				if (!((Component)(object)next).HasComponent<DraggableLayoutElement>())
				{
					((Component)(object)next).AddComponent<DraggableLayoutElement>();
				}
				component.showOnClick = true;
				next.buttons_enabled = true;
				next.load(current);
			}
		}
	}
}
// --- End of File: KingdomSelectedWarsContainer.cs ---



// --- Start of File: KingdomsMetaContainer.cs ---
using System;
using System.Collections.Generic;

public class KingdomsMetaContainer : ListMetaContainer<KingdomListElement, Kingdom, KingdomData>
{
	protected override IEnumerable<Kingdom> getMetaList()
	{
		return getMeta().getKingdoms();
	}

	protected override Comparison<Kingdom> getSorting()
	{
		return ComponentListBase<KingdomListElement, Kingdom, KingdomData, KingdomListComponent>.sortByPopulation;
	}
}
// --- End of File: KingdomsMetaContainer.cs ---



// --- Start of File: KingdomsNoItems.cs ---
public class KingdomsNoItems : MetaListNoItems
{
	protected override bool hasMetas()
	{
		return base.meta_object.hasKingdoms();
	}
}
// --- End of File: KingdomsNoItems.cs ---



// --- Start of File: KingdomStatsElement.cs ---
using System.Collections;
using UnityEngine;

public class KingdomStatsElement : KingdomElement, IStatsElement, IRefreshElement
{
	private StatsIconContainer _stats_icons;

	public void setIconValue(string pName, float pMainVal, float? pMax = null, string pColor = "", bool pFloat = false, string pEnding = "", char pSeparator = '/')
	{
		_stats_icons.setIconValue(pName, pMainVal, pMax, pColor, pFloat, pEnding, pSeparator);
	}

	protected override void Awake()
	{
		_stats_icons = ((Component)this).gameObject.AddOrGetComponent<StatsIconContainer>();
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		if (base.kingdom != null && base.kingdom.isAlive())
		{
			_stats_icons.showGeneralIcons<Kingdom, KingdomData>(base.kingdom);
			setIconValue("i_population", base.kingdom.getPopulationPeople(), base.kingdom.getPopulationTotalPossible());
			setIconValue("i_army", base.kingdom.countTotalWarriors(), base.kingdom.countWarriorsMax());
			if (base.kingdom.countCities() > base.kingdom.getMaxCities())
			{
				setIconValue("i_cities", base.kingdom.countCities(), base.kingdom.getMaxCities(), "#FB2C21");
			}
			else
			{
				setIconValue("i_cities", base.kingdom.countCities(), base.kingdom.getMaxCities());
			}
			setIconValue("i_territory", base.kingdom.countZones());
			setIconValue("i_buildings", base.kingdom.countBuildings());
			setIconValue("i_food", base.kingdom.countTotalFood());
		}
		yield break;
	}

	GameObject IStatsElement.get_gameObject()
	{
		return ((Component)this).gameObject;
	}
}
// --- End of File: KingdomStatsElement.cs ---



// --- Start of File: KingdomTrait.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class KingdomTrait : BaseTrait<KingdomTrait>
{
	public bool is_local_tax_trait;

	public bool is_tribute_tax_trait;

	public float tax_rate;

	protected override HashSet<string> progress_elements => base._progress_data?.unlocked_traits_kingdom;

	public override string typed_id => "kingdom_trait";

	protected override IEnumerable<ITraitsOwner<KingdomTrait>> getRelatedMetaList()
	{
		return World.world.kingdoms;
	}

	public override BaseCategoryAsset getGroup()
	{
		return AssetManager.kingdoms_traits_groups.get(group_id);
	}
}
// --- End of File: KingdomTrait.cs ---



// --- Start of File: KingdomTraitButton.cs ---
public class KingdomTraitButton : TraitButton<KingdomTrait>
{
	protected override string tooltip_type => "kingdom_trait";

	internal override void load(string pTraitID)
	{
		KingdomTrait pElement = AssetManager.kingdoms_traits.get(pTraitID);
		load(pElement);
	}

	protected override TooltipData tooltipDataBuilder()
	{
		return new TooltipData
		{
			kingdom_trait = augmentation_asset
		};
	}
}
// --- End of File: KingdomTraitButton.cs ---



// --- Start of File: KingdomTraitEditorButton.cs ---
public class KingdomTraitEditorButton : TraitEditorButton<KingdomTraitButton, KingdomTrait>
{
}
// --- End of File: KingdomTraitEditorButton.cs ---



// --- Start of File: KingdomTraitGroupAsset.cs ---
using System;

[Serializable]
public class KingdomTraitGroupAsset : BaseTraitGroupAsset
{
}
// --- End of File: KingdomTraitGroupAsset.cs ---



// --- Start of File: KingdomTraitGroupElement.cs ---
public class KingdomTraitGroupElement : TraitGroupElement<KingdomTrait, KingdomTraitButton, KingdomTraitEditorButton>
{
}
// --- End of File: KingdomTraitGroupElement.cs ---



// --- Start of File: KingdomTraitGroupLibrary.cs ---
public class KingdomTraitGroupLibrary : BaseCategoryLibrary<KingdomTraitGroupAsset>
{
	public override void init()
	{
		base.init();
		add(new KingdomTraitGroupAsset
		{
			id = "tribute",
			name = "trait_group_tribute",
			color = "#BAFFC2"
		});
		add(new KingdomTraitGroupAsset
		{
			id = "local_tax",
			name = "trait_group_local_tax",
			color = "#BAFFC2"
		});
		add(new KingdomTraitGroupAsset
		{
			id = "miscellaneous",
			name = "trait_group_miscellaneous",
			color = "#D8D8D8"
		});
		add(new KingdomTraitGroupAsset
		{
			id = "fate",
			name = "trait_group_fate",
			color = "#ffd82f"
		});
	}
}
// --- End of File: KingdomTraitGroupLibrary.cs ---



// --- Start of File: KingdomTraitLibrary.cs ---
using System.Collections.Generic;

public class KingdomTraitLibrary : BaseTraitLibrary<KingdomTrait>
{
	protected override string icon_path => "ui/Icons/kingdom_traits/";

	protected override List<string> getDefaultTraitsForMeta(ActorAsset pAsset)
	{
		return pAsset.default_kingdom_traits;
	}

	public override void init()
	{
		base.init();
		add(new KingdomTrait
		{
			id = "tax_rate_local_high",
			group_id = "local_tax",
			is_local_tax_trait = true,
			tax_rate = 0.7f
		});
		t.addOpposite("tax_rate_local_low");
		add(new KingdomTrait
		{
			id = "tax_rate_local_low",
			group_id = "local_tax",
			is_local_tax_trait = true,
			tax_rate = 0.2f
		});
		t.addOpposite("tax_rate_local_high");
		add(new KingdomTrait
		{
			id = "tax_rate_tribute_high",
			group_id = "tribute",
			is_tribute_tax_trait = true,
			tax_rate = 0.7f
		});
		t.addOpposite("tax_rate_tribute_low");
		add(new KingdomTrait
		{
			id = "tax_rate_tribute_low",
			group_id = "tribute",
			is_tribute_tax_trait = true,
			tax_rate = 0.2f
		});
		t.addOpposite("tax_rate_tribute_high");
		add(new KingdomTrait
		{
			id = "grin_mark",
			group_id = "fate",
			spawn_random_trait_allowed = false,
			priority = -100
		});
		t.setTraitInfoToGrinMark();
		t.setUnlockedWithAchievement("achievementCreaturesExplorer");
	}
}
// --- End of File: KingdomTraitLibrary.cs ---



// --- Start of File: KingdomTraitsContainer.cs ---
public class KingdomTraitsContainer : TraitsContainer<KingdomTrait, KingdomTraitButton>
{
}
// --- End of File: KingdomTraitsContainer.cs ---



// --- Start of File: KingdomTraitsEditor.cs ---
using System.Collections.Generic;

public class KingdomTraitsEditor : TraitsEditor<KingdomTrait, KingdomTraitButton, KingdomTraitEditorButton, KingdomTraitGroupAsset, KingdomTraitGroupElement>
{
	protected override MetaType meta_type => MetaType.Kingdom;

	protected override List<KingdomTraitGroupAsset> augmentation_groups_list => AssetManager.kingdoms_traits_groups.list;

	protected override List<KingdomTrait> all_augmentations_list => AssetManager.kingdoms_traits.list;
}
// --- End of File: KingdomTraitsEditor.cs ---



// --- Start of File: KingdomWarsContainer.cs ---
using System.Collections;
using UnityEngine;

public class KingdomWarsContainer : KingdomDiplomacyContainer<WarBanner, War, WarData>
{
	protected override IEnumerator showContent()
	{
		if (!base.kingdom.hasEnemies())
		{
			yield break;
		}
		using ListPool<War> tList = new ListPool<War>(base.kingdom.getWars());
		track_objects.AddRange(tList);
		yield return (object)new WaitForSecondsRealtime(0.025f);
		Vector3 val = default(Vector3);
		((Vector3)(ref val))._002Ector(0.8f, 0.8f, 1f);
		foreach (ref War item in tList)
		{
			War current = item;
			if (!current.isRekt())
			{
				WarBanner next = pool_elements.getNext();
				TipButton component = ((Component)next).GetComponent<TipButton>();
				if (!((Component)(object)next).HasComponent<DraggableLayoutElement>())
				{
					((Component)(object)next).AddComponent<DraggableLayoutElement>();
				}
				component.showOnClick = true;
				component.setDefaultScale(val);
				next.buttons_enabled = true;
				next.load(current);
				UiButtonHoverAnimation component2 = ((Component)next).GetComponent<UiButtonHoverAnimation>();
				((Behaviour)component2).enabled = false;
				component2.scale_size = 1f;
				component2.default_scale = val;
				RectTransform component3 = ((Component)next).GetComponent<RectTransform>();
				component3.SetAnchor(AnchorPresets.MiddleCenter);
				((Transform)component3).localScale = val;
				component3.anchoredPosition = new Vector2(0f, 0f);
			}
		}
	}
}
// --- End of File: KingdomWarsContainer.cs ---



// --- Start of File: KingdomWindow.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class KingdomWindow : WindowMetaGeneric<Kingdom, KingdomData>, ITraitWindow<KingdomTrait, KingdomTraitButton>, IAugmentationsWindow<ITraitsEditor<KingdomTrait>>
{
	public Image raceTopIcon1;

	public Image raceTopIcon2;

	public NameInput mottoInput;

	public override MetaType meta_type => MetaType.Kingdom;

	protected override Kingdom meta_object => SelectedMetas.selected_kingdom;

	protected override void initNameInput()
	{
		base.initNameInput();
		mottoInput.addListener(applyInputMotto);
	}

	protected override bool onNameChange(string pInput)
	{
		if (!base.onNameChange(pInput))
		{
			return false;
		}
		long iD = meta_object.getID();
		string name = meta_object.data.name;
		foreach (War war in World.world.wars)
		{
			if (!war.isRekt() && war.data.started_by_kingdom_id == iD)
			{
				war.data.started_by_kingdom_name = name;
			}
		}
		foreach (Alliance alliance in World.world.alliances)
		{
			if (!alliance.isRekt() && alliance.data.founder_kingdom_id == iD)
			{
				alliance.data.founder_kingdom_name = name;
			}
		}
		foreach (Religion religion in World.world.religions)
		{
			if (!religion.isRekt() && religion.data.creator_kingdom_id == iD)
			{
				religion.data.creator_kingdom_name = name;
			}
		}
		foreach (Culture culture in World.world.cultures)
		{
			if (!culture.isRekt() && culture.data.creator_kingdom_id == iD)
			{
				culture.data.creator_kingdom_name = name;
			}
		}
		foreach (Clan clan in World.world.clans)
		{
			if (!clan.isRekt() && clan.data.founder_kingdom_id == iD)
			{
				clan.data.founder_kingdom_name = name;
			}
		}
		foreach (Language language in World.world.languages)
		{
			if (!language.isRekt() && language.data.creator_kingdom_id == iD)
			{
				language.data.creator_kingdom_name = name;
			}
		}
		foreach (Family family in World.world.families)
		{
			if (!family.isRekt() && family.data.founder_kingdom_id == iD)
			{
				family.data.founder_kingdom_name = name;
			}
		}
		foreach (Book book in World.world.books)
		{
			if (!book.isRekt() && book.data.author_kingdom_id == iD)
			{
				book.data.author_kingdom_name = name;
			}
		}
		foreach (Item item in World.world.items)
		{
			if (!item.isRekt() && item.data.creator_kingdom_id == iD)
			{
				item.data.from = name;
			}
		}
		foreach (Army army in World.world.armies)
		{
			if (!army.isRekt() && army.getKingdom() == meta_object)
			{
				army.onKingdomNameChange();
			}
		}
		return true;
	}

	private void applyInputMotto(string pInput)
	{
		if (pInput != null && meta_object != null)
		{
			meta_object.data.motto = pInput;
		}
	}

	protected override void showTopPartInformation()
	{
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		base.showTopPartInformation();
		Kingdom kingdom = meta_object;
		if (kingdom != null)
		{
			raceTopIcon1.sprite = kingdom.getSpriteIcon();
			raceTopIcon2.sprite = kingdom.getSpriteIcon();
			mottoInput.setText(kingdom.getMotto());
			((Graphic)mottoInput.textField).color = kingdom.getColor().getColorText();
		}
	}

	private void tryShowPastRulers()
	{
		List<LeaderEntry> past_rulers = meta_object.data.past_rulers;
		if (past_rulers != null && past_rulers.Count > 1)
		{
			showStatRow("past_kings", meta_object.data.past_rulers.Count, MetaType.None, -1L, "iconKingdomList", "past_rulers", getTooltipPastRulers);
		}
	}

	private TooltipData getTooltipPastRulers()
	{
		return new TooltipData
		{
			tip_name = "past_kings",
			meta_type = MetaType.Kingdom,
			past_rulers = new ListPool<LeaderEntry>(meta_object.data.past_rulers)
		};
	}

	internal override void showStatsRows()
	{
		Kingdom kingdom = meta_object;
		tryShowPastNames();
		showStatRow("founded", kingdom.getFoundedDate(), MetaType.None, -1L, "iconAge");
		tryShowPastRulers();
		tryToShowActor("king", -1L, null, kingdom.king, "iconKings");
		Actor pObject = SuccessionTool.findNextHeir(kingdom, kingdom.king);
		tryToShowActor("heir", -1L, null, pObject, "iconChildren");
		if (kingdom.hasKing())
		{
			if (kingdom.king.s_personality != null)
			{
				showStatRow("creature_statistics_personality", kingdom.king.s_personality.getTranslatedName(), MetaType.None, -1L, "actor_traits/iconStupid");
			}
			int yearsSince = Date.getYearsSince(kingdom.data.timestamp_king_rule);
			showStatRow("kingdom_statistics_king_ruled", yearsSince, MetaType.None, -1L, "iconClock");
			showStatRow("ruler_money", kingdom.king.money, "#43FF43", MetaType.None, -1L, pColorText: false, "iconMoney");
		}
		string pValue = kingdom.getTaxRateTribute().ToString("0%");
		showStatRow("tribute", pValue, "#43FF43", MetaType.None, -1L, pColorText: false, "kingdom_traits/kingdom_trait_tax_rate_tribute_high");
		tryToShowMetaSpecies("founder_species", kingdom.getFounderSpecies().id);
	}

	public override void showMetaRows()
	{
		Kingdom kingdom = meta_object;
		meta_rows_container.tryToShowMetaAlliance("alliance", -1L, null, kingdom.getAlliance());
		meta_rows_container.tryToShowMetaCity("kingdom_statistics_capital", -1L, null, kingdom.capital, "iconKingdom");
		meta_rows_container.tryToShowMetaClan("clan", -1L, null, kingdom.king?.clan);
		meta_rows_container.tryToShowMetaCulture("culture", -1L, null, kingdom.culture);
		meta_rows_container.tryToShowMetaLanguage("language", -1L, null, kingdom.language);
		meta_rows_container.tryToShowMetaReligion("religion", -1L, null, kingdom.religion);
		meta_rows_container.tryToShowMetaSubspecies("main_subspecies", -1L, null, kingdom.getMainSubspecies());
	}

	protected override void OnDisable()
	{
		base.OnDisable();
		mottoInput.inputField.DeactivateInputField();
	}

	public void clickCapital()
	{
		SelectedMetas.selected_city = meta_object.capital;
		ScrollWindow.showWindow("city");
	}

	T IAugmentationsWindow<ITraitsEditor<KingdomTrait>>.GetComponentInChildren<T>(bool includeInactive)
	{
		return ((Component)this).GetComponentInChildren<T>(includeInactive);
	}
}
// --- End of File: KingdomWindow.cs ---



// --- Start of File: KnowledgeAsset.cs ---
using System;
using System.ComponentModel;
using UnityEngine;

[Serializable]
public class KnowledgeAsset : Asset, ILocalizedAsset
{
	[DefaultValue(true)]
	public bool show_in_knowledge_window = true;

	public string path_icon;

	public string path_icon_easter_egg;

	public string button_prefab_path;

	public string window_id;

	public KnowledgeButtonLoader load_button;

	public ButtonTipLoader tip_button_loader;

	public ButtonTooltipLoader show_tooltip;

	public LibraryGetter get_library;

	public SpriteGetter get_asset_sprite;

	public OnKnowledgeIconClick click_icon_action = showWindow;

	private Sprite _cache_icon;

	private ILibraryWithUnlockables _cache_library;

	public string getLocaleID()
	{
		return "knowledge_" + id;
	}

	public Sprite getIcon()
	{
		if (_cache_icon == null)
		{
			_cache_icon = SpriteTextureLoader.getSprite(path_icon);
		}
		return _cache_icon;
	}

	public int countTotal()
	{
		return get_library().countTotalKnowledge();
	}

	public int countUnlockedByPlayer()
	{
		return get_library().countUnlockedByPlayer();
	}

	private static void showWindow(KnowledgeAsset pAsset)
	{
		ScrollWindow.showWindow(pAsset.window_id);
	}
}
// --- End of File: KnowledgeAsset.cs ---



// --- Start of File: KnowledgeButtonLoader.cs ---
using UnityEngine;

public delegate void KnowledgeButtonLoader(Transform pButton, BaseUnlockableAsset pAsset);
// --- End of File: KnowledgeButtonLoader.cs ---



// --- Start of File: KnowledgeElement.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class KnowledgeElement : MonoBehaviour
{
	[SerializeField]
	private LocalizedText _localized_text;

	[SerializeField]
	private Image _icon_left;

	[SerializeField]
	private Image _icon_right;

	[SerializeField]
	private EasterEggBanner _icon_easter_left;

	[SerializeField]
	private EasterEggBanner _icon_easter_right;

	[SerializeField]
	private StatBar _progress_bar;

	[SerializeField]
	private RunningIcons _running_icons;

	private CubeOverview _cube_overview_big;

	private WindowMetaTab _cube_tab;

	private KnowledgeAsset _asset;

	private int _running_icon_latest_index;

	private ILibraryWithUnlockables _library;

	private List<BaseUnlockableAsset> _assets_list = new List<BaseUnlockableAsset>();

	private int _items;

	private bool _initialized;

	private void OnEnable()
	{
		if (_initialized)
		{
			resetBar();
		}
	}

	private void Start()
	{
		init(_asset);
		resetBar();
	}

	public void setAsset(KnowledgeAsset pAsset)
	{
		_asset = pAsset;
	}

	public void setCube(CubeOverview pBigCube, WindowMetaTab pCubeTab)
	{
		_cube_overview_big = pBigCube;
		_cube_tab = pCubeTab;
	}

	private void init(KnowledgeAsset pAsset)
	{
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Expected O, but got Unknown
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Expected O, but got Unknown
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Expected O, but got Unknown
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_021d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0227: Expected O, but got Unknown
		//IL_022e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0238: Expected O, but got Unknown
		if (_initialized)
		{
			return;
		}
		_initialized = true;
		_asset = pAsset;
		_localized_text.setKeyAndUpdate(_asset.getLocaleID());
		Sprite icon = _asset.getIcon();
		_icon_left.sprite = icon;
		((UnityEvent)((Component)_icon_left).GetComponentInParent<Button>().onClick).AddListener((UnityAction)delegate
		{
			_asset.click_icon_action(_asset);
		});
		((UnityEvent)((Component)_icon_right).GetComponentInParent<Button>().onClick).AddListener((UnityAction)delegate
		{
			_cube_overview_big.setFilterAsset(_asset);
			((UnityEvent<WindowMetaTab>)_cube_tab.tab_action).Invoke(_cube_tab);
		});
		_library = _asset.get_library();
		foreach (BaseUnlockableAsset item in _library.elements_list)
		{
			if (item.show_in_knowledge_window)
			{
				_assets_list.Add(item);
			}
		}
		_assets_list.Shuffle();
		_running_icons.init(prevItem, nextItem);
		using ListPool<Vector3> listPool = new ListPool<Vector3>(((Component)_running_icons).transform.childCount);
		foreach (Transform item2 in ((Component)_running_icons).transform)
		{
			Transform val = item2;
			listPool.Add(val.localPosition);
			Object.Destroy((Object)(object)((Component)val).gameObject);
		}
		Transform val2 = Resources.Load<Transform>(pAsset.button_prefab_path);
		DraggableLayoutElement draggableLayoutElement = default(DraggableLayoutElement);
		foreach (ref Vector3 item3 in listPool)
		{
			Vector3 current2 = item3;
			Transform val3 = Object.Instantiate<Transform>(val2, ((Component)_running_icons).transform);
			((Component)val3).transform.localPosition = current2;
			val3.SetSiblingIndex(_items++);
			if (!((Component)(object)val3).HasComponent<RunningIcon>())
			{
				((Component)(object)val3).AddComponent<RunningIcon>();
			}
			_running_icons.addIcon(((Component)val3).GetComponent<RunningIcon>());
			Button componentInChildren = ((Component)val3).GetComponentInChildren<Button>();
			((Behaviour)componentInChildren).enabled = false;
			componentInChildren.OnHover((UnityAction)delegate
			{
				_running_icons.toggle(pState: false);
			});
			componentInChildren.OnHoverOut((UnityAction)delegate
			{
				_running_icons.toggle(pState: true);
			});
			if (((Component)val3).TryGetComponent<DraggableLayoutElement>(ref draggableLayoutElement))
			{
				((Behaviour)draggableLayoutElement).enabled = false;
			}
			BaseUnlockableAsset nextAsset = getNextAsset();
			_asset.load_button(val3, nextAsset);
			_asset.tip_button_loader?.Invoke(val3, nextAsset);
		}
		checkEasterEggsSprite();
	}

	private void checkEasterEggsSprite()
	{
		if (string.IsNullOrEmpty(_asset.path_icon_easter_egg))
		{
			((Component)_icon_easter_left).gameObject.SetActive(false);
			((Component)_icon_easter_right).gameObject.SetActive(false);
		}
		else
		{
			Sprite sprite = SpriteTextureLoader.getSprite(_asset.path_icon_easter_egg);
			_icon_easter_left.main_image.sprite = sprite;
			_icon_easter_right.main_image.sprite = sprite;
		}
	}

	private void resetBar()
	{
		int num = _asset.countUnlockedByPlayer();
		int num2 = _asset.countTotal();
		_progress_bar.setBar(num, num2, "/" + num2.ToText());
	}

	private void nextItem(Transform pButton)
	{
		BaseUnlockableAsset nextAsset = getNextAsset();
		_asset.load_button(pButton, nextAsset);
		_asset.tip_button_loader?.Invoke(pButton, nextAsset);
	}

	private BaseUnlockableAsset getNextAsset()
	{
		_running_icon_latest_index++;
		int index = (_running_icon_latest_index = Toolbox.loopIndex(_running_icon_latest_index, _assets_list.Count));
		return _assets_list[index];
	}

	private void prevItem(Transform pButton)
	{
		BaseUnlockableAsset prevAsset = getPrevAsset();
		_asset.load_button(pButton, prevAsset);
		_asset.tip_button_loader?.Invoke(pButton, prevAsset);
	}

	private BaseUnlockableAsset getPrevAsset()
	{
		_running_icon_latest_index--;
		int index = Toolbox.loopIndex((_running_icon_latest_index = Toolbox.loopIndex(_running_icon_latest_index, _assets_list.Count)) - _items + 1, _assets_list.Count);
		return _assets_list[index];
	}
}
// --- End of File: KnowledgeElement.cs ---



// --- Start of File: KnowledgeLibrary.cs ---
using UnityEngine;
using UnityEngine.UI;

public class KnowledgeLibrary : AssetLibrary<KnowledgeAsset>
{
	private KnowledgeAsset units;

	private KnowledgeAsset items;

	private KnowledgeAsset genes;

	private KnowledgeAsset traits;

	private KnowledgeAsset subspecies_traits;

	private KnowledgeAsset culture_traits;

	private KnowledgeAsset language_traits;

	private KnowledgeAsset clan_traits;

	private KnowledgeAsset religion_traits;

	private KnowledgeAsset kingdom_traits;

	private KnowledgeAsset plots;

	public override void init()
	{
		base.init();
		units = add(new KnowledgeAsset
		{
			id = "units",
			path_icon = "ui/Icons/iconInterestingPeople",
			path_icon_easter_egg = "ui/Icons/iconBre",
			button_prefab_path = "ui/RunningIcon",
			window_id = "list_favorite_units",
			get_library = () => AssetManager.actor_library,
			get_asset_sprite = getActorSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				RunningIcon component = ((Component)pButton).GetComponent<RunningIcon>();
				Sprite icon = units.get_asset_sprite(pAsset);
				component.setIcon(icon);
				checkButtonColor(component.getIconImage(), pAsset);
			},
			tip_button_loader = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				ActorAsset tAsset = pAsset as ActorAsset;
				((Component)pButton).GetComponent<TipButton>().setHoverAction(delegate
				{
					TooltipData pData = new TooltipData
					{
						actor_asset = tAsset
					};
					Tooltip.show(pButton, "unit_button", pData);
				});
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				ActorAsset actor_asset = (ActorAsset)pAsset;
				TooltipData tooltipData11 = new TooltipData
				{
					actor_asset = actor_asset
				};
				Tooltip.show(pButton, "unit_button", tooltipData11);
				return tooltipData11;
			}
		});
		items = add(new KnowledgeAsset
		{
			id = "items",
			path_icon = "ui/Icons/iconEquipmentEditor",
			path_icon_easter_egg = "ui/Icons/civs/civ_armadillo",
			button_prefab_path = "ui/EquipmentButton",
			window_id = "equipment_rain_editor",
			get_library = () => AssetManager.items,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				augmentationButtonLoader<EquipmentButton, EquipmentAsset>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				EquipmentAsset item_asset = (EquipmentAsset)pAsset;
				TooltipData tooltipData10 = new TooltipData
				{
					item_asset = item_asset
				};
				Tooltip.show(pButton, "equipment_in_editor", tooltipData10);
				return tooltipData10;
			}
		});
		genes = add(new KnowledgeAsset
		{
			id = "genes",
			path_icon = "ui/Icons/iconGene",
			path_icon_easter_egg = "ui/Icons/iconGreg",
			button_prefab_path = "ui/genetic_elements/GeneButton",
			window_id = "list_subspecies",
			get_library = () => AssetManager.gene_library,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				augmentationButtonLoader<GeneButton, GeneAsset>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				GeneAsset gene = (GeneAsset)pAsset;
				TooltipData tooltipData9 = new TooltipData
				{
					gene = gene
				};
				Tooltip.show(pButton, "gene", tooltipData9);
				return tooltipData9;
			}
		});
		traits = add(new KnowledgeAsset
		{
			id = "traits",
			path_icon = "ui/Icons/iconEditTrait",
			path_icon_easter_egg = "ui/Icons/iconZombie",
			button_prefab_path = "ui/unit_window_elements/ActorTraitButton",
			window_id = "trait_rain_editor",
			get_library = () => AssetManager.traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<ActorTraitButton, ActorTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				ActorTrait actorTrait = (ActorTrait)pAsset;
				TooltipData tooltipData8 = new TooltipData
				{
					trait = actorTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, actorTrait.typed_id, tooltipData8);
				return tooltipData8;
			},
			click_icon_action = delegate(KnowledgeAsset pAsset)
			{
				Config.selected_trait_editor = PowerLibrary.traits_delta_rain_edit.id;
				ScrollWindow.showWindow(pAsset.window_id);
			}
		});
		subspecies_traits = add(new KnowledgeAsset
		{
			id = "subspecies_traits",
			path_icon = "ui/Icons/iconSpecies",
			path_icon_easter_egg = "ui/Icons/subspecies_traits/subspecies_trait_reproduction_budding",
			button_prefab_path = "ui/subspecies_window_elements/SubspeciesTraitButton",
			window_id = "list_subspecies",
			get_library = () => AssetManager.subspecies_traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<SubspeciesTraitButton, SubspeciesTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				SubspeciesTrait subspeciesTrait = (SubspeciesTrait)pAsset;
				TooltipData tooltipData7 = new TooltipData
				{
					subspecies_trait = subspeciesTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, subspeciesTrait.typed_id, tooltipData7);
				return tooltipData7;
			}
		});
		culture_traits = add(new KnowledgeAsset
		{
			id = "culture_traits",
			path_icon = "ui/Icons/iconCulture",
			path_icon_easter_egg = "ui/Icons/iconEvilMage",
			button_prefab_path = "ui/culture_window_elements/CultureTraitButton",
			window_id = "list_cultures",
			get_library = () => AssetManager.culture_traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<CultureTraitButton, CultureTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				CultureTrait cultureTrait = (CultureTrait)pAsset;
				TooltipData tooltipData6 = new TooltipData
				{
					culture_trait = cultureTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, cultureTrait.typed_id, tooltipData6);
				return tooltipData6;
			}
		});
		language_traits = add(new KnowledgeAsset
		{
			id = "language_traits",
			path_icon = "ui/Icons/iconLanguage",
			path_icon_easter_egg = "ui/Icons/iconShrug",
			button_prefab_path = "ui/language_window_elements/LanguageTraitButton",
			window_id = "list_languages",
			get_library = () => AssetManager.language_traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<LanguageTraitButton, LanguageTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				LanguageTrait languageTrait = (LanguageTrait)pAsset;
				TooltipData tooltipData5 = new TooltipData
				{
					language_trait = languageTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, languageTrait.typed_id, tooltipData5);
				return tooltipData5;
			}
		});
		clan_traits = add(new KnowledgeAsset
		{
			id = "clan_traits",
			path_icon = "ui/Icons/iconClan",
			path_icon_easter_egg = "ui/Icons/iconLivingPlants",
			button_prefab_path = "ui/clan_window_elements/ClanTraitButton",
			window_id = "list_clans",
			get_library = () => AssetManager.clan_traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<ClanTraitButton, ClanTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				ClanTrait clanTrait = (ClanTrait)pAsset;
				TooltipData tooltipData4 = new TooltipData
				{
					clan_trait = clanTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, clanTrait.typed_id, tooltipData4);
				return tooltipData4;
			}
		});
		religion_traits = add(new KnowledgeAsset
		{
			id = "religion_traits",
			path_icon = "ui/Icons/iconReligion",
			path_icon_easter_egg = "ui/Icons/iconWhiteMage",
			button_prefab_path = "ui/religion_window_elements/ReligionTraitButton",
			window_id = "list_religions",
			get_library = () => AssetManager.religion_traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<ReligionTraitButton, ReligionTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				ReligionTrait religionTrait = (ReligionTrait)pAsset;
				TooltipData tooltipData3 = new TooltipData
				{
					religion_trait = religionTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, religionTrait.typed_id, tooltipData3);
				return tooltipData3;
			}
		});
		kingdom_traits = add(new KnowledgeAsset
		{
			id = "kingdom_traits",
			show_in_knowledge_window = false,
			path_icon = "ui/Icons/iconKingdom",
			path_icon_easter_egg = "ui/Icons/iconWhiteMage",
			button_prefab_path = "ui/kingdom_window_elements/KingdomTraitButton",
			window_id = "list_kingdoms",
			get_library = () => AssetManager.kingdoms_traits,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				traitButtonLoader<KingdomTraitButton, KingdomTrait>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				KingdomTrait kingdomTrait = (KingdomTrait)pAsset;
				TooltipData tooltipData2 = new TooltipData
				{
					kingdom_trait = kingdomTrait,
					is_editor_augmentation_button = true
				};
				Tooltip.show(pButton, kingdomTrait.typed_id, tooltipData2);
				return tooltipData2;
			}
		});
		plots = add(new KnowledgeAsset
		{
			id = "plots",
			path_icon = "ui/Icons/iconPlot",
			path_icon_easter_egg = "ui/Icons/actor_traits/iconGenius",
			button_prefab_path = "ui/PlotButton",
			window_id = "list_plots",
			get_library = () => AssetManager.plots_library,
			get_asset_sprite = getAugmentationSprite,
			load_button = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				augmentationButtonLoader<PlotButton, PlotAsset>(pButton, pAsset);
			},
			show_tooltip = delegate(Transform pButton, BaseUnlockableAsset pAsset)
			{
				PlotAsset plot_asset = (PlotAsset)pAsset;
				TooltipData tooltipData = new TooltipData
				{
					plot_asset = plot_asset
				};
				Tooltip.show(pButton, "plot_in_editor", tooltipData);
				return tooltipData;
			}
		});
	}

	private Sprite getActorSprite(BaseUnlockableAsset pAsset)
	{
		return ((ActorAsset)pAsset).getSpriteIcon();
	}

	private Sprite getAugmentationSprite(BaseUnlockableAsset pAsset)
	{
		return ((BaseAugmentationAsset)pAsset).getSprite();
	}

	private TButton augmentationButtonLoader<TButton, TAsset>(Transform pButton, BaseUnlockableAsset pAsset) where TButton : AugmentationButton<TAsset> where TAsset : BaseAugmentationAsset
	{
		TButton component = ((Component)pButton).GetComponent<TButton>();
		component.load(pAsset as TAsset);
		((Behaviour)component.locked_bg).enabled = false;
		checkButtonColor(component.image, pAsset);
		component.is_editor_button = true;
		return component;
	}

	private TButton traitButtonLoader<TButton, TAsset>(Transform pButton, BaseUnlockableAsset pAsset) where TButton : TraitButton<TAsset> where TAsset : BaseTrait<TAsset>
	{
		TButton val = augmentationButtonLoader<TButton, TAsset>(pButton, pAsset);
		checkButtonColor(val.image, pAsset);
		return val;
	}

	private void checkButtonColor(Image pImage, BaseUnlockableAsset pAsset)
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		if (pAsset.isUnlockedByPlayer())
		{
			((Graphic)pImage).color = Toolbox.color_white;
		}
		else
		{
			((Graphic)pImage).color = Toolbox.color_black;
		}
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (KnowledgeAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
		}
	}
}
// --- End of File: KnowledgeLibrary.cs ---



// --- Start of File: KnowledgeWindow.cs ---
using UnityEngine;

public class KnowledgeWindow : TabbedWindow
{
	[SerializeField]
	private Transform _elements_parent;

	[SerializeField]
	private KnowledgeElement _element_prefab;

	[SerializeField]
	private StatBar _progress_bar;

	[SerializeField]
	private CubeOverview _cube_overview_big;

	[SerializeField]
	private WindowMetaTab _cube_tab;

	protected override void create()
	{
		base.create();
		foreach (KnowledgeAsset item in AssetManager.knowledge_library.list)
		{
			if (item.show_in_knowledge_window)
			{
				KnowledgeElement knowledgeElement = Object.Instantiate<KnowledgeElement>(_element_prefab, _elements_parent);
				knowledgeElement.setAsset(item);
				knowledgeElement.setCube(_cube_overview_big, _cube_tab);
			}
		}
	}

	private void OnEnable()
	{
		int num = 0;
		int num2 = 0;
		foreach (KnowledgeAsset item in AssetManager.knowledge_library.list)
		{
			if (item.show_in_knowledge_window)
			{
				num += item.countUnlockedByPlayer();
				num2 += item.countTotal();
			}
		}
		_progress_bar.setBar(num, num2, "/" + num2.ToText());
	}
}
// --- End of File: KnowledgeWindow.cs ---



// --- Start of File: Language.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using db;

public class Language : MetaObjectWithTraits<LanguageData, LanguageTrait>
{
	public readonly List<City> cities = new List<City>();

	public readonly List<Kingdom> kingdoms = new List<Kingdom>();

	public readonly BooksHandler books = new BooksHandler();

	protected override MetaType meta_type => MetaType.Language;

	public override BaseSystemManager manager => World.world.languages;

	protected override List<string> default_traits => getActorAsset().default_language_traits;

	protected override AssetLibrary<LanguageTrait> trait_library => AssetManager.language_traits;

	protected override List<string> saved_traits => data.saved_traits;

	protected override string species_id => data.creator_species_id;

	public void newLanguage(Actor pActor, bool pAddDefaultTraits)
	{
		generateName(pActor);
		data.creator_name = pActor.getName();
		data.creator_id = pActor.getID();
		data.creator_species_id = pActor.asset.id;
		data.creator_subspecies_name = pActor.subspecies.name;
		data.creator_subspecies_id = pActor.subspecies.getID();
		data.creator_kingdom_id = pActor.kingdom.getID();
		data.creator_kingdom_name = pActor.kingdom.data.name;
		data.creator_clan_id = pActor.clan?.getID() ?? (-1);
		data.creator_clan_name = pActor.clan?.data.name;
		data.creator_city_id = pActor.city?.getID() ?? (-1);
		data.creator_city_name = pActor.city?.name;
		generateNewMetaObject(pAddDefaultTraits);
		books.setMeta(null, this);
	}

	public void countNewSpeaker()
	{
		increaseNewSpeakers();
		addRenown(1);
	}

	public void countConversion()
	{
		increaseConvertedSpeakers();
		addRenown(2);
	}

	public override void save()
	{
		base.save();
		data.saved_traits = getTraitsAsStrings();
	}

	protected sealed override void setDefaultValues()
	{
		base.setDefaultValues();
	}

	public override void increaseBirths()
	{
		new NotImplementedException(GetType().Name);
	}

	public override void generateBanner()
	{
		data.banner_icon_id = AssetManager.language_banners_library.getNewIndexIcon();
		data.banner_background_id = AssetManager.language_banners_library.getNewIndexBackground();
	}

	protected override ColorLibrary getColorLibrary()
	{
		return AssetManager.languages_colors_library;
	}

	public void listCity(City pCity)
	{
		cities.Add(pCity);
	}

	public void listKingdom(Kingdom pKingdom)
	{
		kingdoms.Add(pKingdom);
	}

	public void clearListCities()
	{
		cities.Clear();
	}

	public void clearListKingdoms()
	{
		kingdoms.Clear();
	}

	private void generateName(Actor pActor)
	{
		string pName = pActor.generateName(MetaType.Language, getID());
		setName(pName);
		data.name_culture_id = pActor.culture?.getID() ?? (-1);
	}

	public Sprite getBackgroundSprite()
	{
		return AssetManager.language_banners_library.getSpriteBackground(data.banner_background_id);
	}

	public Sprite getIconSprite()
	{
		return AssetManager.language_banners_library.getSpriteIcon(data.banner_icon_id);
	}

	public override void loadData(LanguageData pData)
	{
		base.loadData(pData);
		books.setMeta(null, this);
	}

	public int countWrittenBooks()
	{
		return data.books_written;
	}

	public int countCities()
	{
		return cities.Count;
	}

	public int countKingdoms()
	{
		return kingdoms.Count;
	}

	public int getSpeakersNew()
	{
		return data.speakers_new;
	}

	public int getSpeakersLost()
	{
		return data.speakers_lost;
	}

	public int getSpeakersConverted()
	{
		return data.speakers_converted;
	}

	public void increaseConvertedSpeakers()
	{
		data.speakers_converted++;
	}

	public void increaseNewSpeakers()
	{
		data.speakers_new++;
	}

	public void increaseSpeakersLost()
	{
		data.speakers_lost++;
	}

	public override bool isReadyForRemoval()
	{
		if (books.hasBooks())
		{
			return false;
		}
		return base.isReadyForRemoval();
	}

	public override void convertSameSpeciesAroundUnit(Actor pActorMain, bool pOverrideExisting = false)
	{
		foreach (Actor item in getUnitFromChunkForConversion(pActorMain))
		{
			if (pOverrideExisting || !item.hasLanguage())
			{
				item.joinLanguage(this);
			}
		}
	}

	public override void forceConvertSameSpeciesAroundUnit(Actor pActorMain)
	{
		convertSameSpeciesAroundUnit(pActorMain, pOverrideExisting: true);
	}

	public override void Dispose()
	{
		DBInserter.deleteData(getID(), "language");
		books.clear();
		cities.Clear();
		kingdoms.Clear();
		base.Dispose();
	}

	public override bool hasCities()
	{
		return cities.Count > 0;
	}

	public override IEnumerable<City> getCities()
	{
		return cities;
	}

	public override bool hasKingdoms()
	{
		return kingdoms.Count > 0;
	}

	public override IEnumerable<Kingdom> getKingdoms()
	{
		return kingdoms;
	}
}
// --- End of File: Language.cs ---



// --- Start of File: LanguageBanner.cs ---
using UnityEngine.UI;

public class LanguageBanner : BannerGeneric<Language, LanguageData>
{
	protected override MetaType meta_type => MetaType.Language;

	protected override string tooltip_id => "language";

	protected override TooltipData getTooltipData()
	{
		TooltipData tooltipData = base.getTooltipData();
		tooltipData.language = meta_object;
		return tooltipData;
	}

	protected override void setupBanner()
	{
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		base.setupBanner();
		part_background.sprite = meta_object.getBackgroundSprite();
		part_icon.sprite = meta_object.getIconSprite();
		ColorAsset colorAsset = meta_object.getColor();
		((Graphic)part_background).color = colorAsset.getColorMainSecond();
		((Graphic)part_icon).color = colorAsset.getColorBanner();
	}
}
// --- End of File: LanguageBanner.cs ---



// --- Start of File: LanguageBannerLibrary.cs ---
using System.Collections.Generic;

public class LanguageBannerLibrary : GenericBannerLibrary
{
	public override void init()
	{
		base.init();
		main = add(new BannerAsset
		{
			id = "main",
			backgrounds = new List<string> { "languages/background_00", "languages/background_01", "languages/background_02", "languages/background_03", "languages/background_04", "languages/background_05", "languages/background_06", "languages/background_07", "languages/background_08", "languages/background_09" },
			icons = new List<string>
			{
				"languages/icon_00", "languages/icon_01", "languages/icon_02", "languages/icon_03", "languages/icon_04", "languages/icon_05", "languages/icon_06", "languages/icon_07", "languages/icon_08", "languages/icon_09",
				"languages/icon_10", "languages/icon_11", "languages/icon_12", "languages/icon_13", "languages/icon_14", "languages/icon_15", "languages/icon_16", "languages/icon_17", "languages/icon_18", "languages/icon_19",
				"languages/icon_20"
			}
		});
	}
}
// --- End of File: LanguageBannerLibrary.cs ---



// --- Start of File: LanguageCustomizeWindow.cs ---
public class LanguageCustomizeWindow : GenericCustomizeWindow<Language, LanguageData, LanguageBanner>
{
	protected override MetaType meta_type => MetaType.Language;

	protected override Language meta_object => SelectedMetas.selected_language;

	protected override void onBannerChange()
	{
		image_banner_option_1.sprite = meta_object.getBackgroundSprite();
		image_banner_option_2.sprite = meta_object.getIconSprite();
	}
}
// --- End of File: LanguageCustomizeWindow.cs ---



// --- Start of File: LanguageData.cs ---
using System.Collections.Generic;
using System.ComponentModel;

public class LanguageData : MetaObjectData
{
	public int banner_background_id;

	public int banner_icon_id;

	public int books_written;

	public string creator_name = string.Empty;

	[DefaultValue(-1L)]
	public long creator_id = -1L;

	public string creator_subspecies_name = string.Empty;

	[DefaultValue(-1L)]
	public long creator_subspecies_id = -1L;

	public string creator_species_id = string.Empty;

	[DefaultValue(-1L)]
	public long creator_kingdom_id = -1L;

	public string creator_kingdom_name = string.Empty;

	[DefaultValue(-1L)]
	public long creator_clan_id = -1L;

	public string creator_clan_name = string.Empty;

	[DefaultValue(-1L)]
	public long creator_city_id = -1L;

	public string creator_city_name = string.Empty;

	public List<string> saved_traits;

	public int speakers_new;

	public int speakers_converted;

	public int speakers_lost;

	public LanguageStructure structure;
}
// --- End of File: LanguageData.cs ---



// --- Start of File: LanguageElement.cs ---
public class LanguageElement : WindowMetaElement<Language, LanguageData>
{
	protected Language language => meta_object;
}
// --- End of File: LanguageElement.cs ---



// --- Start of File: LanguageListComponent.cs ---
public class LanguageListComponent : ComponentListBase<LanguageListElement, Language, LanguageData, LanguageListComponent>
{
	protected override MetaType meta_type => MetaType.Language;

	protected override void setupSortingTabs()
	{
		genericMetaSortByAge(base.sortByAge);
		genericMetaSortByRenown(base.sortByRenown);
		genericMetaSortByPopulation(ComponentListBase<LanguageListElement, Language, LanguageData, LanguageListComponent>.sortByPopulation);
		genericMetaSortByKills(ComponentListBase<LanguageListElement, Language, LanguageData, LanguageListComponent>.sortByKills);
		genericMetaSortByDeath(ComponentListBase<LanguageListElement, Language, LanguageData, LanguageListComponent>.sortByDeaths);
		sorting_tab.tryAddButton("ui/Icons/iconVillages", "sort_by_villages", show, delegate
		{
			current_sort = sortByVillages;
		});
	}

	public static int sortByVillages(Language pObject1, Language pObject2)
	{
		return pObject2.cities.Count.CompareTo(pObject1.cities.Count);
	}
}
// --- End of File: LanguageListComponent.cs ---



// --- Start of File: LanguageListElement.cs ---
using UnityEngine.UI;

public class LanguageListElement : WindowListElementBase<Language, LanguageData>
{
	public Text text_name;

	public CountUpOnClick text_age;

	public CountUpOnClick text_population;

	public CountUpOnClick text_books;

	public CountUpOnClick text_villages;

	public CountUpOnClick text_kingdom;

	internal override void show(Language pLanguage)
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		base.show(pLanguage);
		text_name.text = pLanguage.name;
		((Graphic)text_name).color = pLanguage.getColor().getColorText();
		text_age.setValue(pLanguage.getAge());
		text_population.setValue(pLanguage.countUnits());
		text_villages.setValue(pLanguage.countCities());
		text_kingdom.setValue(pLanguage.countKingdoms());
		text_books.setValue(pLanguage.books.count());
	}

	protected override void tooltipAction()
	{
		Tooltip.show(this, "language", new TooltipData
		{
			language = meta_object
		});
	}

	protected override ActorAsset getActorAsset()
	{
		return meta_object.getActorAsset();
	}
}
// --- End of File: LanguageListElement.cs ---



// --- Start of File: LanguageManager.cs ---
using System.Collections.Generic;

public class LanguageManager : MetaSystemManager<Language, LanguageData>
{
	private bool _dirty_kingdoms = true;

	private bool _dirty_cities = true;

	public LanguageManager()
	{
		type_id = "language";
	}

	public Language newLanguage(Actor pActor, bool pAddDefaultTraits)
	{
		World.world.game_stats.data.languagesCreated++;
		World.world.map_stats.languagesCreated++;
		Language language = newObject();
		language.newLanguage(pActor, pAddDefaultTraits);
		MetaHelper.addRandomTrait(language, AssetManager.language_traits);
		addRandomTraitFromBiomeToLanguage(language, pActor.current_tile);
		return language;
	}

	public void addRandomTraitFromBiomeToLanguage(Language pLanguage, WorldTile pTile)
	{
		pLanguage.addRandomTraitFromBiome(pTile, pTile.Type.biome_asset?.spawn_trait_language, AssetManager.language_traits);
	}

	public Language getMainLanguage(List<Actor> pUnitList)
	{
		for (int i = 0; i < pUnitList.Count; i++)
		{
			Actor actor = pUnitList[i];
			if (actor.hasLanguage())
			{
				Language language = actor.language;
				countMetaObject(language);
			}
		}
		return getMostUsedMetaObject();
	}

	public override void removeObject(Language pObject)
	{
		World.world.game_stats.data.languagesForgotten++;
		World.world.map_stats.languagesForgotten++;
		base.removeObject(pObject);
	}

	protected override void updateDirtyUnits()
	{
		List<Actor> units_only_alive = World.world.units.units_only_alive;
		for (int i = 0; i < units_only_alive.Count; i++)
		{
			Actor actor = units_only_alive[i];
			Language language = actor.language;
			if (language != null && language.isDirtyUnits())
			{
				language.listUnit(actor);
			}
		}
	}

	public void beginChecksKingdoms()
	{
		if (_dirty_kingdoms)
		{
			updateDirtyKingdoms();
		}
		_dirty_kingdoms = false;
	}

	private void updateDirtyKingdoms()
	{
		clearAllKingdomListst();
		foreach (Kingdom kingdom in World.world.kingdoms)
		{
			kingdom.getLanguage()?.listKingdom(kingdom);
		}
	}

	private void clearAllKingdomListst()
	{
		using IEnumerator<Language> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.clearListKingdoms();
		}
	}

	public void beginChecksCities()
	{
		if (_dirty_cities)
		{
			updateDirtyCities();
		}
		_dirty_cities = false;
	}

	private void updateDirtyCities()
	{
		clearAllCitiesListst();
		foreach (City city in World.world.cities)
		{
			if (city.hasLanguage())
			{
				city.language.listCity(city);
			}
		}
	}

	private void clearAllCitiesListst()
	{
		using IEnumerator<Language> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.clearListCities();
		}
	}

	public void setDirtyKingdoms()
	{
		_dirty_kingdoms = true;
	}

	public void setDirtyCities()
	{
		_dirty_cities = true;
	}

	public override bool isLocked()
	{
		if (isUnitsDirty())
		{
			return true;
		}
		if (_dirty_cities)
		{
			return true;
		}
		if (_dirty_kingdoms)
		{
			return true;
		}
		return false;
	}
}
// --- End of File: LanguageManager.cs ---



// --- Start of File: LanguagesColorsLibrary.cs ---
public class LanguagesColorsLibrary : ColorLibrary
{
	public LanguagesColorsLibrary()
	{
		file_path = "colors/colors_general";
	}

	public override void init()
	{
		base.init();
		useSameColorsFrom(AssetManager.kingdom_colors_library);
	}

	public override bool isColorUsedInWorld(ColorAsset pAsset)
	{
		foreach (Language language in World.world.languages)
		{
			if (checkColor(pAsset, language.data.color_id))
			{
				return true;
			}
		}
		return base.isColorUsedInWorld(pAsset);
	}
}
// --- End of File: LanguagesColorsLibrary.cs ---



// --- Start of File: LanguageSelectedContainerTraits.cs ---
using System.Collections.Generic;

public class LanguageSelectedContainerTraits : SelectedContainerTraits<LanguageTrait, LanguageTraitButton, LanguageTraitsContainer, LanguageTraitsEditor>
{
	protected override MetaType meta_type => MetaType.Language;

	protected override IReadOnlyCollection<LanguageTrait> getTraits()
	{
		return SelectedMetas.selected_language.getTraits();
	}

	protected override bool canEditTraits()
	{
		return true;
	}
}
// --- End of File: LanguageSelectedContainerTraits.cs ---



// --- Start of File: LanguageStatsElement.cs ---
using System.Collections;
using UnityEngine;

public class LanguageStatsElement : LanguageElement, IStatsElement, IRefreshElement
{
	private StatsIconContainer _stats_icons;

	public void setIconValue(string pName, float pMainVal, float? pMax = null, string pColor = "", bool pFloat = false, string pEnding = "", char pSeparator = '/')
	{
		_stats_icons.setIconValue(pName, pMainVal, pMax, pColor, pFloat, pEnding, pSeparator);
	}

	protected override void Awake()
	{
		_stats_icons = ((Component)this).gameObject.AddOrGetComponent<StatsIconContainer>();
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		if (base.language != null && base.language.isAlive())
		{
			_stats_icons.showGeneralIcons<Language, LanguageData>(base.language);
			setIconValue("i_books", base.language.books.count());
			setIconValue("i_kingdoms", base.language.countKingdoms());
			setIconValue("i_cities", base.language.countCities());
			setIconValue("i_books_written", base.language.data.books_written);
		}
		yield break;
	}

	GameObject IStatsElement.get_gameObject()
	{
		return ((Component)this).gameObject;
	}
}
// --- End of File: LanguageStatsElement.cs ---



// --- Start of File: LanguageStructure.cs ---
using System;
using System.Text.RegularExpressions;

[Serializable]
public class LanguageStructure
{
	public string[] sets_vowels;

	public string[] sets_consonants;

	public string[] sets_onset_1;

	public string[] sets_onset_2;

	public string[] sets_codas_1;

	public string[] sets_codas_2;

	public string[] sets_diphthongs;

	public string[] syllables_start;

	public string[] syllables_mid;

	public string[] syllables_ends;

	public string[] word_patterns;

	public float[] word_weights;

	public ArticleSettings settings_articles;

	public PrefixesSettings settings_prefixes;

	public SuffixesSettings settings_suffixes;

	public LanguageStructure()
	{
		generateSyllableSets();
	}

	public void generateSyllableSets()
	{
		if (syllables_start == null)
		{
			generateMainParts();
			generatePatterns();
			int pSizeMin = Randy.randomInt(1, 2);
			int pSizeMax = Randy.randomInt(1, 3);
			settings_articles = new ArticleSettings();
			settings_articles.create(this, pSizeMin, pSizeMax);
			settings_prefixes = new PrefixesSettings();
			settings_prefixes.create(this, 0, 4);
			settings_suffixes = new SuffixesSettings();
			settings_suffixes.create(this, 0, 4);
			syllables_start = generateSyllables("syllable_starts", Randy.randomInt(2, 10));
			syllables_mid = generateSyllables("syllable_mids", Randy.randomInt(2, 10));
			syllables_ends = generateSyllables("syllable_ends", Randy.randomInt(2, 10));
		}
	}

	private void generatePatterns()
	{
		int num = Randy.randomInt(3, 10);
		word_patterns = new string[num];
		word_weights = new float[num];
		for (int i = 0; i < num; i++)
		{
			word_patterns[i] = LanguageStructureHelpers.possible_word_patterns.GetRandom();
			word_weights[i] = Randy.randomFloat(0.05f, 1f);
		}
	}

	private void generateMainParts()
	{
		sets_consonants = generateParts("consonant", 5);
		sets_vowels = generateParts("vowel", 5);
		sets_onset_1 = generateParts("onset1", 5);
		sets_onset_2 = generateParts("onset2", 5);
		sets_codas_1 = generateParts("coda1", 5);
		sets_codas_2 = generateParts("coda2", 5);
		sets_diphthongs = generateParts("diphthongs", 5);
	}

	private string[] generateParts(string pID, int pAmount)
	{
		LinguisticsAsset linguisticsAsset = AssetManager.linguistics_library.get(pID);
		string[] array = new string[pAmount];
		for (int i = 0; i < pAmount; i++)
		{
			array[i] = linguisticsAsset.getRandom();
		}
		return array;
	}

	private string[] generateSyllables(string pID, int pAmount)
	{
		string[] array = new string[pAmount];
		LinguisticsAsset linguisticsAsset = AssetManager.linguistics_library.get(pID);
		for (int i = 0; i < pAmount; i++)
		{
			string[] randomPattern = linguisticsAsset.getRandomPattern();
			string text = string.Join("", randomPattern);
			using (new StringBuilderPool())
			{
				string text2 = string.Empty;
				string empty = string.Empty;
				string text3 = string.Empty;
				if (text.StartsWith("CC"))
				{
					text2 = sets_onset_2.GetRandom();
				}
				else if (text.StartsWith("C"))
				{
					text2 = sets_onset_1.GetRandom();
				}
				empty = ((text.Contains("VV") || Randy.randomChance(0.2f)) ? sets_diphthongs.GetRandom() : sets_vowels.GetRandom());
				if (text.EndsWith("CC"))
				{
					text3 = sets_codas_2.GetRandom();
				}
				else if (text.EndsWith("C"))
				{
					text3 = sets_codas_1.GetRandom();
				}
				string text4 = text2 + empty + text3;
				array[i] = text4;
			}
		}
		return array;
	}

	private string fixOrthography(string pSyllable)
	{
		if (string.IsNullOrEmpty(pSyllable))
		{
			return pSyllable;
		}
		string input = pSyllable;
		input = Regex.Replace(input, "([bcdfghjklmnpqrstvwxyz])\\1{2,}", "$1$1");
		input = input.Replace("ck", "ck");
		input = input.Replace("kk", "ck");
		input = input.Replace("cc", "ck");
		input = Regex.Replace(input, "qw|qv", "qu");
		input = input.Replace("q", "qu");
		input = Regex.Replace(input, "aa+", "a");
		input = Regex.Replace(input, "ii+", "i");
		input = Regex.Replace(input, "uu+", "u");
		if (input.StartsWith("x"))
		{
			input = "z" + input.Substring(1);
		}
		input = Regex.Replace(input, "([bcdfghjklmnpqrstvwxyz])\\1\\1+", "$1$1");
		input = input.Replace("tch", "ch");
		input = input.Replace("dge", "ge");
		if (input.Length > 2)
		{
			string text = input.Substring(0, 2).ToLower();
			string[] array = new string[7] { "kg", "pn", "gn", "kn", "wr", "mn", "ps" };
			foreach (string text2 in array)
			{
				if (text == text2)
				{
					input = input.Substring(1);
					break;
				}
			}
		}
		return input;
	}
}
// --- End of File: LanguageStructure.cs ---



// --- Start of File: LanguageStructureHelpers.cs ---
public static class LanguageStructureHelpers
{
	public const int AMOUNT_TYPES = 7;

	public static readonly WordType[] word_types = new WordType[7]
	{
		WordType.Name,
		WordType.Place,
		WordType.Concept,
		WordType.Action,
		WordType.Object,
		WordType.Creature,
		WordType.Pronoun
	};

	public static readonly string[] possible_word_patterns = new string[12]
	{
		"S", "S", "S", "SE", "SE", "SE", "SE", "SE", "SE", "SME",
		"SME", "SMME"
	};

	public static readonly string[] possible_article_separators = new string[12]
	{
		"", " ", " ", " ", " ", " ", " ", " ", " ", "-",
		"'", ""
	};
}
// --- End of File: LanguageStructureHelpers.cs ---



// --- Start of File: LanguageTrait.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class LanguageTrait : BaseTrait<LanguageTrait>
{
	public BookTraitAction read_book_trait_action;

	protected override HashSet<string> progress_elements => base._progress_data?.unlocked_traits_language;

	public override string typed_id => "language_trait";

	protected override IEnumerable<ITraitsOwner<LanguageTrait>> getRelatedMetaList()
	{
		return World.world.languages;
	}

	public override BaseCategoryAsset getGroup()
	{
		return AssetManager.language_trait_groups.get(group_id);
	}
}
// --- End of File: LanguageTrait.cs ---



// --- Start of File: LanguageTraitButton.cs ---
public class LanguageTraitButton : TraitButton<LanguageTrait>
{
	protected override string tooltip_type => "language_trait";

	internal override void load(string pTraitID)
	{
		LanguageTrait pElement = AssetManager.language_traits.get(pTraitID);
		load(pElement);
	}

	protected override void startSignal()
	{
		AchievementLibrary.trait_explorer_language.checkBySignal();
	}

	protected override TooltipData tooltipDataBuilder()
	{
		return new TooltipData
		{
			language_trait = augmentation_asset
		};
	}
}
// --- End of File: LanguageTraitButton.cs ---



// --- Start of File: LanguageTraitEditorButton.cs ---
public class LanguageTraitEditorButton : TraitEditorButton<LanguageTraitButton, LanguageTrait>
{
}
// --- End of File: LanguageTraitEditorButton.cs ---



// --- Start of File: LanguageTraitGroupAsset.cs ---
using System;

[Serializable]
public class LanguageTraitGroupAsset : BaseTraitGroupAsset
{
}
// --- End of File: LanguageTraitGroupAsset.cs ---



// --- Start of File: LanguageTraitGroupElement.cs ---
public class LanguageTraitGroupElement : TraitGroupElement<LanguageTrait, LanguageTraitButton, LanguageTraitEditorButton>
{
}
// --- End of File: LanguageTraitGroupElement.cs ---



// --- Start of File: LanguageTraitGroupLibrary.cs ---
public class LanguageTraitGroupLibrary : BaseCategoryLibrary<LanguageTraitGroupAsset>
{
	public override void init()
	{
		base.init();
		add(new LanguageTraitGroupAsset
		{
			id = "knowledge",
			name = "trait_group_knowledge",
			color = "#BAF0F4"
		});
		add(new LanguageTraitGroupAsset
		{
			id = "spirit",
			name = "trait_group_spirit",
			color = "#BAFFC2"
		});
		add(new LanguageTraitGroupAsset
		{
			id = "harmony",
			name = "trait_group_harmony",
			color = "#FFFAA3"
		});
		add(new LanguageTraitGroupAsset
		{
			id = "chaos",
			name = "trait_group_chaos",
			color = "#FF6B86"
		});
		add(new LanguageTraitGroupAsset
		{
			id = "miscellaneous",
			name = "trait_group_miscellaneous",
			color = "#D8D8D8"
		});
		add(new LanguageTraitGroupAsset
		{
			id = "fate",
			name = "trait_group_fate",
			color = "#ffd82f"
		});
		add(new LanguageTraitGroupAsset
		{
			id = "special",
			name = "trait_group_special",
			color = "#FF8F44"
		});
	}
}
// --- End of File: LanguageTraitGroupLibrary.cs ---



// --- Start of File: LanguageTraitLibrary.cs ---
using System.Collections.Generic;

public class LanguageTraitLibrary : BaseTraitLibrary<LanguageTrait>
{
	protected override string icon_path => "ui/Icons/language_traits/";

	protected override List<string> getDefaultTraitsForMeta(ActorAsset pAsset)
	{
		return pAsset.default_language_traits;
	}

	public override void init()
	{
		base.init();
		add(new LanguageTrait
		{
			id = "melodic",
			value = 3f,
			group_id = "harmony"
		});
		add(new LanguageTrait
		{
			id = "stylish_writing",
			value = 3f,
			group_id = "harmony"
		});
		add(new LanguageTrait
		{
			id = "scribble",
			group_id = "knowledge"
		});
		t.addOpposite("nicely_structured_grammar");
		add(new LanguageTrait
		{
			id = "nicely_structured_grammar",
			value = 2f,
			group_id = "knowledge"
		});
		t.addOpposite("scribble");
		add(new LanguageTrait
		{
			id = "beautiful_calligraphy",
			value = 2f,
			group_id = "harmony"
		});
		add(new LanguageTrait
		{
			id = "magic_words",
			group_id = "spirit"
		});
		t.setUnlockedWithAchievement("achievementTraitExplorerLanguage");
		add(new LanguageTrait
		{
			id = "words_of_madness",
			value = 0.1f,
			group_id = "chaos",
			spawn_random_trait_allowed = false,
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (!a.hasTrait("evil") && !a.hasTrait("blessed") && Randy.randomChance(pTrait.value))
				{
					a.addTrait("madness");
				}
			}
		});
		t.setUnlockedWithAchievement("achievementCursedWorld");
		add(new LanguageTrait
		{
			id = "cursed_font",
			value = 0.2f,
			group_id = "chaos",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (!a.hasTrait("evil") && Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("cursed");
				}
			}
		});
		t.setUnlockedWithAchievement("achievementTheCorruptedTrees");
		add(new LanguageTrait
		{
			id = "font_of_gods",
			value = 0.2f,
			group_id = "spirit",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("enchanted");
				}
			}
		});
		add(new LanguageTrait
		{
			id = "chilly_font",
			value = 0.4f,
			group_id = "chaos",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("frozen");
				}
			}
		});
		add(new LanguageTrait
		{
			id = "ancient_runes",
			value = 0.4f,
			group_id = "spirit",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("spell_boost");
				}
			}
		});
		t.setUnlockedWithAchievement("achievementPlotsExplorer");
		add(new LanguageTrait
		{
			id = "repeated_sentences",
			value = 0.1f,
			group_id = "miscellaneous",
			spawn_random_trait_allowed = false,
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value) && a.hasCity() && a.asset.can_be_cloned && a.city.hasFreeHouseSlots() && !a.city.hasReachedWorldLawLimit() && (!a.hasSubspecies() || !a.subspecies.hasReachedPopulationLimit()))
				{
					World.world.units.cloneUnit(a);
				}
			}
		});
		t.setUnlockedWithAchievement("achievementCloneWars");
		add(new LanguageTrait
		{
			id = "spooky_language",
			value = 0.2f,
			group_id = "chaos",
			spawn_random_trait_allowed = false,
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value) && a.hasCity())
				{
					World.world.units.spawnNewUnit("ghost", a.current_tile.neighboursAll.GetRandom());
				}
			}
		});
		t.setUnlockedWithAchievement("achievementChildNamedToto");
		add(new LanguageTrait
		{
			id = "powerful_words",
			value = 0.2f,
			group_id = "spirit",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("powerup");
				}
			}
		});
		add(new LanguageTrait
		{
			id = "confusing_semantics",
			value = 0.2f,
			group_id = "chaos",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.makeStunned();
					if (a.hasLanguage())
					{
						a.joinLanguage(null);
					}
				}
			}
		});
		add(new LanguageTrait
		{
			id = "raging_paragraphs",
			value = 0.2f,
			group_id = "chaos",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("rage");
				}
			}
		});
		add(new LanguageTrait
		{
			id = "mortal_tongue",
			value = 0.2f,
			group_id = "chaos",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (!a.hasTrait("evil") && !a.hasTrait("blessed") && Randy.randomChance(pTrait.value))
				{
					a.getHitFullHealth(AttackType.Divine);
				}
			}
		});
		t.setUnlockedWithAchievement("achievementCursedWorld");
		add(new LanguageTrait
		{
			id = "scorching_words",
			value = 0.5f,
			group_id = "chaos",
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (Randy.randomChance(pTrait.value))
				{
					a.addStatusEffect("burning");
				}
			}
		});
		add(new LanguageTrait
		{
			id = "doomed_glyphs",
			value = 0.1f,
			group_id = "chaos",
			spawn_random_trait_allowed = false,
			read_book_trait_action = delegate(Actor a, LanguageTrait pTrait, Book _)
			{
				if (!a.hasTrait("lucky") && WorldLawLibrary.world_law_disasters_nature.isEnabled() && Randy.randomChance(pTrait.value))
				{
					Meteorite.spawnMeteoriteDisaster(a.current_tile, a);
				}
			}
		});
		t.setUnlockedWithAchievement("achievementMultiplySpoken");
		add(new LanguageTrait
		{
			id = "enlightening_script",
			group_id = "knowledge"
		});
		t.base_stats["intelligence"] = 10f;
		add(new LanguageTrait
		{
			id = "foolish_glyphs",
			group_id = "knowledge"
		});
		t.base_stats["intelligence"] = -5f;
		add(new LanguageTrait
		{
			id = "eternal_text",
			group_id = "miscellaneous",
			spawn_random_trait_allowed = false
		});
		t.setUnlockedWithAchievement("achievementPie");
		t.base_stats["lifespan"] = 500f;
		add(new LanguageTrait
		{
			id = "elegant_words",
			group_id = "spirit"
		});
		t.base_stats["offspring"] = 4f;
		add(new LanguageTrait
		{
			id = "strict_spelling",
			group_id = "knowledge"
		});
		t.base_stats["warfare"] = 10f;
		add(new LanguageTrait
		{
			id = "divine_encryption",
			group_id = "special",
			can_be_given = false,
			can_be_removed = false,
			can_be_in_book = false,
			spawn_random_trait_allowed = false
		});
		add(new LanguageTrait
		{
			id = "grin_mark",
			group_id = "fate",
			spawn_random_trait_allowed = false,
			priority = -100
		});
		t.setTraitInfoToGrinMark();
		t.setUnlockedWithAchievement("achievementCreaturesExplorer");
	}

	public static float getValueFloat(string pID)
	{
		return AssetManager.language_traits.get(pID).value;
	}

	public static int getValue(string pID)
	{
		return (int)AssetManager.language_traits.get(pID).value;
	}
}
// --- End of File: LanguageTraitLibrary.cs ---



// --- Start of File: LanguageTraitsContainer.cs ---
public class LanguageTraitsContainer : TraitsContainer<LanguageTrait, LanguageTraitButton>
{
}
// --- End of File: LanguageTraitsContainer.cs ---



// --- Start of File: LanguageTraitsEditor.cs ---
using System.Collections.Generic;

public class LanguageTraitsEditor : TraitsEditor<LanguageTrait, LanguageTraitButton, LanguageTraitEditorButton, LanguageTraitGroupAsset, LanguageTraitGroupElement>
{
	protected override MetaType meta_type => MetaType.Language;

	protected override List<LanguageTraitGroupAsset> augmentation_groups_list => AssetManager.language_trait_groups.list;

	protected override List<LanguageTrait> all_augmentations_list => AssetManager.language_traits.list;

	protected override LanguageTrait edited_marker_augmentation => AssetManager.language_traits.get("divine_encryption");

	protected override void startSignal()
	{
		AchievementLibrary.trait_explorer_language.checkBySignal();
	}
}
// --- End of File: LanguageTraitsEditor.cs ---



// --- Start of File: LanguageWindow.cs ---
using System.Collections.Generic;
using UnityEngine;

public class LanguageWindow : WindowMetaGeneric<Language, LanguageData>, ITraitWindow<LanguageTrait, LanguageTraitButton>, IAugmentationsWindow<ITraitsEditor<LanguageTrait>>, IBooksWindow
{
	public override MetaType meta_type => MetaType.Language;

	protected override Language meta_object => SelectedMetas.selected_language;

	protected override void showTopPartInformation()
	{
		base.showTopPartInformation();
		AchievementLibrary.multiply_spoken.checkBySignal(meta_object);
	}

	internal override void showStatsRows()
	{
		Language language = meta_object;
		tryShowPastNames();
		showStatRow("founded", language.getFoundedDate(), MetaType.None, -1L, "iconAge");
		tryToShowActor("creator", language.data.creator_id, language.data.creator_name, null, "actor_traits/iconStupid");
		tryToShowMetaClan("creators_clan", language.data.creator_clan_id, language.data.creator_clan_name);
		tryToShowMetaKingdom("origin", language.data.creator_kingdom_id, language.data.creator_kingdom_name);
		tryToShowMetaCity("birthplace", language.data.creator_city_id, language.data.creator_city_name);
		tryToShowMetaSubspecies("creator_subspecies", language.data.creator_subspecies_id, language.data.creator_subspecies_name);
		tryToShowMetaSpecies("creator_species", language.data.creator_species_id);
	}

	public List<long> getBooks()
	{
		return meta_object.books.getList();
	}

	protected override bool onNameChange(string pInput)
	{
		if (!base.onNameChange(pInput))
		{
			return false;
		}
		long iD = meta_object.getID();
		string name = meta_object.data.name;
		foreach (Book book in World.world.books)
		{
			if (!book.isRekt() && book.data.language_id == iD)
			{
				book.data.language_name = name;
			}
		}
		return true;
	}

	T IAugmentationsWindow<ITraitsEditor<LanguageTrait>>.GetComponentInChildren<T>(bool includeInactive)
	{
		return ((Component)this).GetComponentInChildren<T>(includeInactive);
	}
}
// --- End of File: LanguageWindow.cs ---



// --- Start of File: LavaHelper.cs ---
public static class LavaHelper
{
	public static void heatUpLava(WorldTile pTile)
	{
		if (!string.IsNullOrEmpty(pTile.Type.lava_increase))
		{
			changeLavaTile(pTile, pTile.Type.lava_increase);
		}
	}

	public static void coolDownLava(WorldTile pTile)
	{
		if (!string.IsNullOrEmpty(pTile.Type.lava_decrease))
		{
			changeLavaTile(pTile, pTile.Type.lava_decrease);
		}
		else
		{
			putOut(pTile);
		}
	}

	public static void addLava(WorldTile pTile, string pType = "lava3")
	{
		if (!pTile.Type.lava || !string.IsNullOrEmpty(pTile.Type.lava_increase))
		{
			pTile.startFire();
			MapAction.terraformMain(pTile, AssetManager.tiles.get(pType), TerraformLibrary.lava_damage);
		}
	}

	private static void changeLavaTile(WorldTile pTile, string pType)
	{
		MapAction.terraformMain(pTile, AssetManager.tiles.get(pType), TerraformLibrary.lava_damage);
	}

	public static void putOut(WorldTile pTile)
	{
		if (!WorldLawLibrary.world_law_forever_lava.isEnabled() && !WorldLawLibrary.world_law_gaias_covenant.isEnabled())
		{
			MapAction.increaseTile(pTile, pDamage: false);
		}
	}

	public static void removeLava(WorldTile pTile)
	{
		MapAction.decreaseTile(pTile, pDamage: false);
	}
}
// --- End of File: LavaHelper.cs ---



// --- Start of File: LavaLayer.cs ---
using System.Collections.Generic;
using UnityEngine;

public class LavaLayer : MapLayer
{
	private List<WorldTile> _to_clear = new List<WorldTile>();

	internal override void create()
	{
		base.create();
	}

	protected override void checkAutoDisable()
	{
		bool flag = WorldBehaviourActionLava.hasLava();
		if (!MapBox.isRenderMiniMap())
		{
			flag = false;
		}
		if (flag)
		{
			if (!((Renderer)sprRnd).enabled)
			{
				((Renderer)sprRnd).enabled = true;
			}
		}
		else if (((Renderer)sprRnd).enabled)
		{
			((Renderer)sprRnd).enabled = false;
		}
	}

	public override void update(float pElapsed)
	{
		checkAutoDisable();
		updateLava();
	}

	public override void draw(float pElapsed)
	{
	}

	private void updateLava()
	{
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		bool flag = false;
		if (_to_clear.Count > 0)
		{
			foreach (WorldTile item in _to_clear)
			{
				pixels[item.data.tile_id] = Toolbox.clear;
			}
			_to_clear.Clear();
			flag = true;
		}
		if (WorldBehaviourActionLava.hasLava())
		{
			flag = true;
			drawLavaPixel(TileLibrary.lava0);
			drawLavaPixel(TileLibrary.lava1);
			drawLavaPixel(TileLibrary.lava2);
			drawLavaPixel(TileLibrary.lava3);
		}
		if (flag)
		{
			updatePixels();
		}
	}

	internal override void clear()
	{
		base.clear();
		_to_clear.Clear();
	}

	private void drawLavaPixel(TileType pType)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		if (pType.hashset.Count == 0)
		{
			return;
		}
		foreach (WorldTile item in pType.hashset)
		{
			pixels[item.data.tile_id] = pType.color;
			_to_clear.Add(item);
		}
	}
}
// --- End of File: LavaLayer.cs ---



// --- Start of File: LavaRenderer.cs ---
using UnityEngine;
using UnityEngine.Rendering;

public class LavaRenderer : MonoBehaviour
{
	public Camera curCamera;

	public Camera targetCamera;

	private RenderTexture renderTexture;

	private void Start()
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Expected O, but got Unknown
		renderTexture = new RenderTexture(Screen.width, Screen.height, 8, (RenderTextureFormat)0);
		((Texture)renderTexture).dimension = (TextureDimension)2;
		renderTexture.antiAliasing = 1;
		((Texture)renderTexture).anisoLevel = 0;
		((Texture)renderTexture).filterMode = (FilterMode)0;
		renderTexture.Create();
		curCamera.targetTexture = renderTexture;
	}

	private void OnPreRender()
	{
		targetCamera.targetTexture = renderTexture;
	}

	private void OnPostRender()
	{
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		targetCamera.targetTexture = null;
		Graphics.DrawTexture(new Rect(0f, 0f, (float)(Screen.width / 2), (float)(Screen.height / 2)), (Texture)(object)renderTexture, (Material)null);
	}
}
// --- End of File: LavaRenderer.cs ---



// --- Start of File: LayoutGroupExtended.cs ---
using System;
using System.Collections.Generic;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.Pool;
using UnityEngine.UI;

namespace LayoutGroupExt;

[DisallowMultipleComponent]
[ExecuteAlways]
[RequireComponent(typeof(RectTransform))]
public abstract class LayoutGroupExtended : LayoutGroup
{
	[SerializeField]
	public float moveDuration = 0.15f;

	[Tooltip("Will position the n items immediately, animating the next ones.")]
	[SerializeField]
	public int delayItems = 1;

	private Dictionary<RectTransform, TweenerCore<Vector2, Vector2, VectorOptions>> RectPositionXTweens = new Dictionary<RectTransform, TweenerCore<Vector2, Vector2, VectorOptions>>();

	private Dictionary<RectTransform, TweenerCore<Vector2, Vector2, VectorOptions>> RectPositionYTweens = new Dictionary<RectTransform, TweenerCore<Vector2, Vector2, VectorOptions>>();

	private static List<RectTransform> _to_remove = new List<RectTransform>();

	internal List<RectTransform> m_Children = new List<RectTransform>();

	internal Dictionary<int, List<RectTransform>> m_Axis = new Dictionary<int, List<RectTransform>>
	{
		{
			0,
			new List<RectTransform>()
		},
		{
			1,
			new List<RectTransform>()
		}
	};

	internal Vector2[] m_Positions = (Vector2[])(object)new Vector2[0];

	internal RectTransform[] m_Sort = (RectTransform[])(object)new RectTransform[0];

	internal Dictionary<RectTransform, Vector2> m_Grid_Positions = new Dictionary<RectTransform, Vector2>();

	internal Dictionary<RectTransform, Vector2> m_Grid_Anchors = new Dictionary<RectTransform, Vector2>();

	private int _skip_frame = -1;

	private static RectTransform _highlighter_prefab;

	private ObjectPoolGenericMono<RectTransform> _pool_highlighter;

	protected void SetChildAlongAxis(RectTransform rect, int axis, float pos)
	{
		if (!((Object)(object)rect == (Object)null))
		{
			SetChildAlongAxisWithScale(rect, axis, pos, 1f);
		}
	}

	public override void CalculateLayoutInputHorizontal()
	{
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Expected O, but got Unknown
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		if (_skip_frame == Time.frameCount)
		{
			((LayoutGroup)this).SetDirty();
			return;
		}
		bool flag = ((LayoutGroup)this).rectChildren.Count == 0;
		((LayoutGroup)this).rectChildren.Clear();
		List<Component> list = CollectionPool<List<Component>, Component>.Get();
		for (int i = 0; i < ((Transform)((LayoutGroup)this).rectTransform).childCount; i++)
		{
			if (Application.isPlaying && flag && ((LayoutGroup)this).rectChildren.Count == delayItems)
			{
				_skip_frame = Time.frameCount;
				((LayoutGroup)this).SetDirty();
				break;
			}
			Transform child = ((Transform)((LayoutGroup)this).rectTransform).GetChild(i);
			RectTransform val = (RectTransform)(object)((child is RectTransform) ? child : null);
			if ((Object)(object)val == (Object)null || !((Component)val).gameObject.activeInHierarchy)
			{
				continue;
			}
			((Component)val).GetComponents(typeof(ILayoutIgnorer), list);
			if (list.Count == 0)
			{
				((LayoutGroup)this).rectChildren.Add(val);
				continue;
			}
			foreach (ILayoutIgnorer item in list)
			{
				ILayoutIgnorer val2 = item;
				if (!val2.ignoreLayout && ((Behaviour)(MonoBehaviour)val2).enabled)
				{
					((LayoutGroup)this).rectChildren.Add(val);
					break;
				}
			}
		}
		CollectionPool<List<Component>, Component>.Release(list);
		((DrivenRectTransformTracker)(ref base.m_Tracker)).Clear();
	}

	protected void SetChildAlongAxisWithScale(RectTransform rect, int axis, float pos, float scaleFactor)
	{
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)rect == (Object)null))
		{
			((DrivenRectTransformTracker)(ref base.m_Tracker)).Add((Object)(object)this, rect, (DrivenTransformProperties)(0xF00 | ((axis == 0) ? 2 : 4)));
			rect.anchorMin = Vector2.up;
			rect.anchorMax = Vector2.up;
			if (!m_Grid_Anchors.TryGetValue(rect, out var value) || !Application.isPlaying)
			{
				value = rect.anchoredPosition;
				m_Grid_Anchors[rect] = value;
			}
			Vector2 val;
			float num3;
			if (axis != 0)
			{
				float num = 0f - pos;
				val = rect.sizeDelta;
				float num2 = ((Vector2)(ref val))[axis];
				val = rect.pivot;
				num3 = num - num2 * (1f - ((Vector2)(ref val))[axis]) * scaleFactor;
			}
			else
			{
				val = rect.sizeDelta;
				float num4 = ((Vector2)(ref val))[axis];
				val = rect.pivot;
				num3 = pos + num4 * ((Vector2)(ref val))[axis] * scaleFactor;
			}
			((Vector2)(ref value))[axis] = num3;
			SetPosition(rect, value, axis);
		}
	}

	protected void SetChildAlongAxis(RectTransform rect, int axis, float pos, float size)
	{
		if (!((Object)(object)rect == (Object)null))
		{
			SetChildAlongAxisWithScale(rect, axis, pos, size, 1f);
		}
	}

	protected void SetChildAlongAxisWithScale(RectTransform rect, int axis, float pos, float size, float scaleFactor)
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)rect == (Object)null))
		{
			((DrivenRectTransformTracker)(ref base.m_Tracker)).Add((Object)(object)this, rect, (DrivenTransformProperties)(0xF00 | ((axis == 0) ? 4098 : 8196)));
			rect.anchorMin = Vector2.up;
			rect.anchorMax = Vector2.up;
			Vector2 sizeDelta = rect.sizeDelta;
			((Vector2)(ref sizeDelta))[axis] = size;
			rect.sizeDelta = sizeDelta;
			if (!m_Grid_Anchors.TryGetValue(rect, out var value) || !Application.isPlaying)
			{
				value = rect.anchoredPosition;
				m_Grid_Anchors[rect] = value;
			}
			Vector2 pivot;
			float num2;
			if (axis != 0)
			{
				float num = 0f - pos;
				pivot = rect.pivot;
				num2 = num - size * (1f - ((Vector2)(ref pivot))[axis]) * scaleFactor;
			}
			else
			{
				pivot = rect.pivot;
				num2 = pos + size * ((Vector2)(ref pivot))[axis] * scaleFactor;
			}
			((Vector2)(ref value))[axis] = num2;
			SetPosition(rect, value, axis);
		}
	}

	public void SetPosition(RectTransform rect, Vector2 pos, int axis)
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01da: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_0273: Unknown result type (might be due to invalid IL or missing references)
		//IL_0278: Unknown result type (might be due to invalid IL or missing references)
		//IL_0282: Unknown result type (might be due to invalid IL or missing references)
		//IL_0284: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0136: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_0114: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00df: Unknown result type (might be due to invalid IL or missing references)
		//IL_0311: Unknown result type (might be due to invalid IL or missing references)
		//IL_031b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0330: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_039e: Unknown result type (might be due to invalid IL or missing references)
		//IL_03a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_03e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_03f1: Expected O, but got Unknown
		//IL_03f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_03fb: Expected O, but got Unknown
		//IL_040e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0418: Expected O, but got Unknown
		//IL_0418: Unknown result type (might be due to invalid IL or missing references)
		//IL_0422: Expected O, but got Unknown
		//IL_03bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0382: Unknown result type (might be due to invalid IL or missing references)
		if (!Application.isPlaying)
		{
			rect.anchoredPosition = pos;
			return;
		}
		if (!m_Axis[axis].Contains(rect))
		{
			if (m_Axis[axis].Count >= delayItems)
			{
				Vector2 val = Vector2.zero;
				float num = float.MaxValue;
				for (int num2 = m_Axis[axis].Count - 1; num2 >= 0; num2--)
				{
					Vector2 val2 = m_Axis[axis][num2].anchoredPosition;
					if (val2 == Vector2.zero)
					{
						val2 = m_Grid_Anchors[m_Axis[axis][num2]];
					}
					float num3 = Vector2.Distance(val2, pos);
					if (num3 < num)
					{
						num = num3;
						val = val2;
					}
				}
				Vector2 val3 = val - pos;
				if (Mathf.Abs(val3.y) > Mathf.Abs(val3.x))
				{
					rect.anchoredPosition = val + new Vector2(0f, 1f);
				}
				else
				{
					rect.anchoredPosition = val - new Vector2(1f, 0f);
				}
			}
			else
			{
				rect.anchoredPosition = pos;
			}
			m_Axis[axis].Add(rect);
			if (!m_Children.Contains(rect))
			{
				m_Children.Add(rect);
			}
		}
		m_Grid_Anchors[rect] = pos;
		Vector2 anchoredPosition = rect.anchoredPosition;
		rect.anchoredPosition = pos;
		m_Grid_Positions[rect] = Vector2.op_Implicit(((Transform)rect).position);
		rect.anchoredPosition = anchoredPosition;
		if (m_Children.Count != m_Positions.Length)
		{
			m_Positions = (Vector2[])(object)new Vector2[m_Children.Count];
			m_Sort = (RectTransform[])(object)new RectTransform[m_Children.Count];
		}
		m_Children.Sort((RectTransform a, RectTransform b) => ((Transform)a).GetSiblingIndex().CompareTo(((Transform)b).GetSiblingIndex()));
		for (int i = 0; i < m_Children.Count; i++)
		{
			Vector2 val4 = m_Grid_Positions[m_Children[i]];
			m_Positions[i] = val4;
			m_Sort[i] = m_Children[i];
		}
		Dictionary<RectTransform, TweenerCore<Vector2, Vector2, VectorOptions>> dict;
		TweenerCore<Vector2, Vector2, VectorOptions> tween;
		switch (axis)
		{
		default:
			return;
		case 0:
		{
			dict = RectPositionXTweens;
			if (dict.TryGetValue(rect, out var value2) && TweenExtensions.IsActive((Tween)(object)value2))
			{
				if (Mathf.Approximately(value2.endValue.x, pos.x))
				{
					return;
				}
				TweenExtensions.Kill((Tween)(object)value2, false);
			}
			if (Mathf.Approximately(rect.anchoredPosition.x, pos.x))
			{
				return;
			}
			tween = DOTweenModuleUI.DOAnchorPosX(rect, pos.x, moveDuration, false);
			break;
		}
		case 1:
		{
			dict = RectPositionYTweens;
			if (dict.TryGetValue(rect, out var value) && TweenExtensions.IsActive((Tween)(object)value))
			{
				if (Mathf.Approximately(value.endValue.y, pos.y))
				{
					return;
				}
				TweenExtensions.Kill((Tween)(object)value, false);
			}
			if (Mathf.Approximately(rect.anchoredPosition.y, pos.y))
			{
				return;
			}
			tween = DOTweenModuleUI.DOAnchorPosY(rect, pos.y, moveDuration, false);
			break;
		}
		}
		TweenerCore<Vector2, Vector2, VectorOptions> obj = tween;
		((Tween)obj).onKill = (TweenCallback)Delegate.Combine((Delegate?)(object)((Tween)obj).onKill, (Delegate?)(TweenCallback)delegate
		{
			if (dict.ContainsKey(rect) && dict[rect] == tween)
			{
				dict.Remove(rect);
			}
		});
		TweenerCore<Vector2, Vector2, VectorOptions> obj2 = tween;
		((Tween)obj2).onComplete = (TweenCallback)Delegate.Combine((Delegate?)(object)((Tween)obj2).onComplete, (Delegate?)(TweenCallback)delegate
		{
			LayoutRebuilder.MarkLayoutForRebuild(((LayoutGroup)this).rectTransform);
			dict.Remove(rect);
		});
		dict[rect] = tween;
	}

	protected override void OnEnable()
	{
		((LayoutGroup)this).OnEnable();
		ScrollWindow.addCallbackShow(setDirty);
		ScrollWindow.addCallbackShowFinished(setDirty);
	}

	protected override void OnDisable()
	{
		((LayoutGroup)this).OnDisable();
		ScrollWindow.removeCallbackShow(setDirty);
		ScrollWindow.removeCallbackShowFinished(setDirty);
		_skip_frame = -1;
		m_Axis[0].Clear();
		m_Axis[1].Clear();
		m_Children.Clear();
		m_Grid_Positions.Clear();
		m_Grid_Anchors.Clear();
		((LayoutGroup)this).rectChildren.Clear();
		using ListPool<TweenerCore<Vector2, Vector2, VectorOptions>> listPool = new ListPool<TweenerCore<Vector2, Vector2, VectorOptions>>(RectPositionXTweens.Count + RectPositionYTweens.Count);
		listPool.AddRange(RectPositionXTweens.Values);
		listPool.AddRange(RectPositionYTweens.Values);
		RectPositionXTweens.Clear();
		RectPositionYTweens.Clear();
		foreach (ref TweenerCore<Vector2, Vector2, VectorOptions> item in listPool)
		{
			TweenExtensions.Kill((Tween)(object)item, false);
		}
	}

	private void LateUpdate()
	{
		foreach (RectTransform child in m_Children)
		{
			if (!((LayoutGroup)this).rectChildren.Contains(child) || !((Component)child).gameObject.activeInHierarchy)
			{
				_to_remove.Add(child);
			}
		}
		foreach (RectTransform item in _to_remove)
		{
			m_Children.Remove(item);
			m_Axis[0].Remove(item);
			m_Axis[1].Remove(item);
			m_Grid_Positions.Remove(item);
			m_Grid_Anchors.Remove(item);
		}
		_to_remove.Clear();
	}

	private void setDirty(string pWindowName)
	{
		((LayoutGroup)this).SetDirty();
	}

	private void DebugInit()
	{
		if ((Object)(object)_highlighter_prefab == (Object)null)
		{
			_highlighter_prefab = Object.Instantiate<RectTransform>(Resources.Load<RectTransform>("ui/selector"));
		}
		if (_pool_highlighter == null)
		{
			_pool_highlighter = new ObjectPoolGenericMono<RectTransform>(_highlighter_prefab, ((Component)this).transform);
		}
		_pool_highlighter.clear();
	}

	protected virtual void Update()
	{
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_013b: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		//IL_015e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0176: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01af: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0214: Unknown result type (might be due to invalid IL or missing references)
		//IL_0216: Unknown result type (might be due to invalid IL or missing references)
		//IL_022e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0230: Unknown result type (might be due to invalid IL or missing references)
		if (!Application.isPlaying)
		{
			return;
		}
		if (!DebugConfig.isOn(DebugOption.ShowLayoutGroupGrid))
		{
			_pool_highlighter?.clear();
			return;
		}
		DebugInit();
		Vector2 val2;
		for (int i = 0; i < m_Positions.Length; i++)
		{
			Vector2 val = m_Positions[i];
			RectTransform next = _pool_highlighter.getNext();
			((Transform)next).localScale = ((Transform)m_Children[0]).localScale;
			((Graphic)((Component)((Transform)next).GetChild(0)).GetComponent<Image>()).color = new Color(1f, 0f, 0f, 0.25f);
			GameObject gameObject = ((Component)next).gameObject;
			string text = i.ToString();
			val2 = val;
			((Object)gameObject).name = "m_positions " + text + " " + ((object)(Vector2)(ref val2)).ToString();
			((Transform)next).position = Vector2.op_Implicit(val);
		}
		for (int j = 0; j < m_Sort.Length; j++)
		{
			RectTransform key = m_Sort[j];
			Vector2 val3 = m_Grid_Anchors[key];
			RectTransform next2 = _pool_highlighter.getNext();
			((Transform)next2).localScale = ((Transform)m_Children[0]).localScale;
			((Graphic)((Component)((Transform)next2).GetChild(0)).GetComponent<Image>()).color = new Color(0f, 1f, 0f, 0.25f);
			GameObject gameObject2 = ((Component)next2).gameObject;
			string text2 = j.ToString();
			val2 = val3;
			((Object)gameObject2).name = "m_Grid_Anchors " + text2 + " " + ((object)(Vector2)(ref val2)).ToString();
			next2.anchoredPosition = val3;
		}
		for (int k = 0; k < m_Sort.Length; k++)
		{
			RectTransform key2 = m_Sort[k];
			Vector2 val4 = m_Grid_Positions[key2];
			RectTransform next3 = _pool_highlighter.getNext();
			((Transform)next3).localScale = ((Transform)m_Children[0]).localScale;
			((Graphic)((Component)((Transform)next3).GetChild(0)).GetComponent<Image>()).color = new Color(0f, 0f, 1f, 0.25f);
			GameObject gameObject3 = ((Component)next3).gameObject;
			string text3 = k.ToString();
			val2 = val4;
			((Object)gameObject3).name = "m_Grid_Positions " + text3 + " " + ((object)(Vector2)(ref val2)).ToString();
			((Transform)next3).position = Vector2.op_Implicit(val4);
		}
	}
}
// --- End of File: LayoutGroupExtended.cs ---



// --- Start of File: LeaderEntry.cs ---
public class LeaderEntry
{
	public long id;

	public int color_id;

	public string name;

	public double timestamp_ago;

	public double timestamp_end;
}
// --- End of File: LeaderEntry.cs ---



// --- Start of File: LegendaryBG.cs ---
using UnityEngine;
using UnityEngine.UI;

public class LegendaryBG : MonoBehaviour
{
	public Sprite[] spriteArray;

	private Image img;

	private int max_frames = 9;

	private int currentFrame;

	private float timer = 0.07f;

	private void Awake()
	{
		img = ((Component)this).GetComponent<Image>();
		max_frames = spriteArray.Length;
	}

	private void OnEnable()
	{
		timer = 0.2f;
		currentFrame = max_frames - 1;
	}

	private void Update()
	{
		if (timer > 0f)
		{
			timer -= Time.deltaTime;
			return;
		}
		timer = 0.07f;
		currentFrame++;
		if (currentFrame >= max_frames)
		{
			currentFrame = 0;
		}
		else if (currentFrame == max_frames - 1)
		{
			timer = 2.4f;
		}
		img.sprite = spriteArray[currentFrame];
	}
}
// --- End of File: LegendaryBG.cs ---



// --- Start of File: LevelPreviewButton.cs ---
using System;
using System.Collections;
using System.IO;
using UnityEngine;
using UnityEngine.Networking;
using UnityEngine.UI;

public class LevelPreviewButton : MonoBehaviour
{
	public bool premiumOnly = true;

	public bool worldNetUpload;

	public Image premiumIcon;

	public Image rewardAdIcon;

	public Button button;

	public SlotButtonCallback slotData;

	public Sprite defaultSprite;

	private ButtonAnimation buttonAnimation;

	public bool loaded;

	public bool loading;

	public bool autoload;

	public void click()
	{
		if (ScrollWindow.isAnimationActive())
		{
			return;
		}
		if ((Object)(object)buttonAnimation == (Object)null)
		{
			buttonAnimation = ((Component)((Component)this).transform.parent.parent.parent).GetComponent<ButtonAnimation>();
		}
		buttonAnimation.clickAnimation();
		SaveManager.setCurrentSlot(slotData.slotID);
		if (worldNetUpload)
		{
			if (SaveManager.currentSlotExists() && SaveManager.currentPreviewExists() && SaveManager.currentMetaExists())
			{
				ScrollWindow.showWindow("worldnet_upload_world_name");
			}
		}
		else if (SaveManager.currentSlotExists())
		{
			ScrollWindow.showWindow("save_slot");
		}
		else
		{
			ScrollWindow.showWindow("save_slot_new");
		}
	}

	public void checkTextureDestroy()
	{
		if ((Object)(object)((Selectable)button).image.sprite.texture != (Object)(object)defaultSprite.texture)
		{
			Object.Destroy((Object)(object)((Selectable)button).image.sprite.texture);
		}
	}

	private void OnEnable()
	{
		if (autoload)
		{
			reloadImage();
		}
	}

	private void OnDisable()
	{
		Button obj = button;
		object obj2;
		if (obj == null)
		{
			obj2 = null;
		}
		else
		{
			Image image = ((Selectable)obj).image;
			if (image == null)
			{
				obj2 = null;
			}
			else
			{
				Sprite sprite = image.sprite;
				obj2 = ((sprite != null) ? sprite.texture : null);
			}
		}
		if ((Object)obj2 == (Object)(object)defaultSprite.texture)
		{
			return;
		}
		Button obj3 = button;
		object obj4;
		if (obj3 == null)
		{
			obj4 = null;
		}
		else
		{
			Image image2 = ((Selectable)obj3).image;
			if (image2 == null)
			{
				obj4 = null;
			}
			else
			{
				Sprite sprite2 = image2.sprite;
				obj4 = ((sprite2 != null) ? sprite2.texture : null);
			}
		}
		Object.Destroy((Object)obj4);
		Button obj5 = button;
		object obj6;
		if (obj5 == null)
		{
			obj6 = null;
		}
		else
		{
			Image image3 = ((Selectable)obj5).image;
			obj6 = ((image3 != null) ? image3.sprite : null);
		}
		Object.Destroy((Object)obj6);
	}

	public void reloadImage()
	{
		if ((Object)(object)this == (Object)null || !((Behaviour)this).isActiveAndEnabled)
		{
			return;
		}
		if (loaded)
		{
			Button obj = button;
			object obj2;
			if (obj == null)
			{
				obj2 = null;
			}
			else
			{
				Image image = ((Selectable)obj).image;
				obj2 = ((image != null) ? image.sprite : null);
			}
			if ((Object)obj2 != (Object)null)
			{
				return;
			}
		}
		if (loading)
		{
			return;
		}
		loading = true;
		if (SaveManager.currentWorkshopMapData != null)
		{
			loadWorkshopMapPreview();
			return;
		}
		bool flag = SaveManager.currentSlotExists();
		if (slotData.slotID == -1 && !flag)
		{
			loadImage(PreviewHelper.getCurrentWorldPreview());
		}
		else
		{
			((MonoBehaviour)this).StartCoroutine(loadSaveSlotImage(slotData.slotID));
		}
	}

	private void loadWorkshopMapPreview()
	{
		loadImage(PreviewHelper.loadWorkshopMapPreview());
	}

	private IEnumerator loadSaveSlotImage(int slotID)
	{
		string path = SaveManager.getPngSlotPath(slotID);
		if (string.IsNullOrEmpty(path) || !File.Exists(path))
		{
			loadImage(null);
			yield break;
		}
		UnityWebRequest webRequest = UnityWebRequestTexture.GetTexture("file://" + path);
		try
		{
			yield return webRequest.SendWebRequest();
			if ((int)webRequest.result == 3 || (int)webRequest.result == 2)
			{
				Debug.LogError((object)(((Object)((Component)this).gameObject).name + " " + webRequest.error + " " + path));
				loadImage(null);
			}
			else
			{
				Texture2D content = DownloadHandlerTexture.GetContent(webRequest);
				Sprite pSource = Sprite.Create(content, new Rect(0f, 0f, (float)((Texture)content).width, (float)((Texture)content).height), new Vector2(0.5f, 0.5f));
				loadImage(pSource);
			}
		}
		finally
		{
			((IDisposable)webRequest)?.Dispose();
		}
	}

	public void loadImage(Sprite pSource)
	{
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_0105: Unknown result type (might be due to invalid IL or missing references)
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)this == (Object)null || !((Behaviour)this).isActiveAndEnabled)
		{
			loaded = false;
			loading = false;
			return;
		}
		if (!premiumOnly || Config.hasPremium)
		{
			((Component)premiumIcon).gameObject.SetActive(false);
		}
		bool flag = false;
		if ((Object)(object)pSource != (Object)null)
		{
			flag = true;
			((Texture)pSource.texture).anisoLevel = 0;
			((Texture)pSource.texture).filterMode = (FilterMode)0;
		}
		else
		{
			pSource = defaultSprite;
		}
		((Selectable)button).image.sprite = pSource;
		RectTransform component = ((Component)this).gameObject.GetComponent<RectTransform>();
		Rect rect = pSource.rect;
		float width = ((Rect)(ref rect)).width;
		rect = pSource.rect;
		component.sizeDelta = new Vector2(width, ((Rect)(ref rect)).height);
		RectTransform component2 = ((Component)((Component)button).transform.parent.parent).GetComponent<RectTransform>();
		float num = 1f;
		float num2 = 1f;
		float x = component2.sizeDelta.x;
		rect = pSource.rect;
		num = x / ((Rect)(ref rect)).width;
		float y = component2.sizeDelta.y;
		rect = pSource.rect;
		num2 = y / ((Rect)(ref rect)).height;
		float num3 = ((num > num2) ? num : num2);
		Transform parent = ((Component)this).transform.parent;
		if (!flag)
		{
			num3 = 1f;
		}
		parent.localScale = new Vector3(num3, num3, 1f);
		loaded = true;
		loading = false;
	}
}
// --- End of File: LevelPreviewButton.cs ---



// --- Start of File: LibraryGetter.cs ---
public delegate ILibraryWithUnlockables LibraryGetter();
// --- End of File: LibraryGetter.cs ---



// --- Start of File: LibraryMaterials.cs ---
using System.Collections.Generic;
using UnityEngine;

public class LibraryMaterials : MonoBehaviour
{
	public static LibraryMaterials instance;

	public const string mat_id_world_object = "mat_world_object";

	public const string mat_id_world_object_lit_always = "mat_world_object_lit";

	public Dictionary<string, Material> dict = new Dictionary<string, Material>();

	public Material mat_damaged;

	public Material mat_highlighted;

	public Material mat_world_object;

	public Material mat_world_object_lit;

	public Material mat_buildings;

	public Material mat_socialize;

	public Material mat_minis;

	public Material mat_tree;

	public Material mat_tree_celestial;

	public Material mat_jelly;

	public Material mat_buildings_light;

	public Material mat_lava_glow;

	public Material mat_overlapped_shadows;

	private float _shadow_alpha_target = 0.40392157f;

	private float _shadow_alpha = 0.40392157f;

	private Color _shadows_color;

	private List<Material> _night_affected_colors = new List<Material>();

	private float _time;

	private void Awake()
	{
		//IL_0140: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		instance = this;
		mat_damaged = loadMaterial("materials/damaged", pCopy: true);
		mat_highlighted = loadMaterial("materials/highlighted", pCopy: true);
		mat_buildings = loadMaterial("materials/building", pCopy: true);
		mat_tree = loadMaterial("materials/tree", pCopy: true);
		mat_socialize = loadMaterial("materials/socialize");
		mat_minis = loadMaterial("materials/minis");
		mat_tree_celestial = loadMaterial("materials/tree_celestial", pCopy: true);
		mat_jelly = loadMaterial("materials/jelly", pCopy: true);
		mat_overlapped_shadows = loadMaterial("materials/OverlappedShadows", pCopy: true);
		mat_buildings_light = loadMaterial("materials/MatBuildingsLight");
		mat_world_object = loadMaterial("materials/mat_world_object");
		mat_world_object_lit = loadMaterial("materials/mat_world_object_lit");
		mat_lava_glow = loadMaterial("materials/lava_glow", pCopy: true);
		_night_affected_colors.Add(mat_buildings);
		_night_affected_colors.Add(mat_tree);
		_night_affected_colors.Add(mat_jelly);
		_night_affected_colors.Add(mat_world_object);
		_shadows_color = mat_overlapped_shadows.GetColor("_Color");
		AssetManager.status.linkMaterials();
		Shader.SetGlobalFloat("GlobalTime", 1f);
	}

	private Material loadMaterial(string pPath, bool pCopy = false)
	{
		Material val = Resources.Load<Material>(pPath);
		if (pCopy)
		{
			val = Object.Instantiate<Material>(val);
		}
		string name = ((Object)val).name;
		name = name.Replace("(Clone)", "");
		dict.Add(name, val);
		return val;
	}

	internal void updateMat()
	{
		if (!World.world.isPaused())
		{
			_time += World.world.elapsed;
		}
		updateNight();
		Shader.SetGlobalFloat("GlobalTime", _time);
	}

	private void updateNight()
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		float nightMod = World.world.era_manager.getNightMod();
		Color color = Toolbox.blendColor(Color32.op_Implicit(Toolbox.color_night), Toolbox.color_white, nightMod);
		foreach (Material night_affected_color in _night_affected_colors)
		{
			night_affected_color.color = color;
		}
		Color backgroundColor = Toolbox.blendColor(Color32.op_Implicit(Toolbox.color_night), Color32.op_Implicit(Toolbox.color_ocean), nightMod);
		if (nightMod > 0f)
		{
			backgroundColor.r -= 0.007843138f;
			backgroundColor.b -= 1f / 51f;
		}
		World.world.camera.backgroundColor = backgroundColor;
	}

	public void updateZoomoutValue(float pValue)
	{
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		float num = pValue;
		num = 4f - num * 3f;
		if (!DebugConfig.isOn(DebugOption.ScaleEffectEnabled))
		{
			num = 1f;
		}
		_shadow_alpha = num * _shadow_alpha_target;
		_shadows_color.a = _shadow_alpha;
		mat_overlapped_shadows.SetColor("_Color", _shadows_color);
	}
}
// --- End of File: LibraryMaterials.cs ---



// --- Start of File: LibraryWindow.cs ---
using UnityEngine;

public class LibraryWindow : MonoBehaviour
{
}
// --- End of File: LibraryWindow.cs ---



// --- Start of File: LightBlobData.cs ---
using UnityEngine;

public struct LightBlobData
{
	public Vector2 position;

	public float radius;
}
// --- End of File: LightBlobData.cs ---



// --- Start of File: LightRenderer.cs ---
using UnityEngine;
using UnityEngine.UI;

public class LightRenderer : MonoBehaviour
{
	public static LightRenderer instance;

	public Camera camera;

	public EffectsCamera effectsCamera;

	private RawImage _rawImage;

	private void Awake()
	{
		instance = this;
		_rawImage = ((Component)this).GetComponent<RawImage>();
	}

	public void update(float pElapsed)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		_rawImage.texture = (Texture)(object)effectsCamera.renderTexture;
		Color light_color = World.world_era.light_color;
		light_color.a = World.world.era_manager.getNightMod() * 0.6f;
		((Graphic)_rawImage).color = light_color;
	}
}
// --- End of File: LightRenderer.cs ---



// --- Start of File: LinguisticsAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class LinguisticsAsset : Asset
{
	public string simple_text;

	public WordType word_type = WordType.None;

	public bool symbols_around;

	public string symbols_around_left;

	public string symbols_around_right;

	public bool add_space;

	public bool next_uppercase;

	public string[] array;

	public bool word_group;

	private List<string[]> _pot_patterns = new List<string[]>();

	public void addPattern(int pRate, params string[] pPattern)
	{
		_pot_patterns.AddTimes(pRate, pPattern);
	}

	public string getRandom()
	{
		return array.GetRandom();
	}

	public string[] getRandomPattern()
	{
		if (_pot_patterns.Count == 0)
		{
			return null;
		}
		return _pot_patterns.GetRandom();
	}

	public string getLocaleID()
	{
		throw new NotImplementedException();
	}

	public string getDescriptionID()
	{
		throw new NotImplementedException();
	}

	public string getDescriptionID2()
	{
		throw new NotImplementedException();
	}
}
// --- End of File: LinguisticsAsset.cs ---



// --- Start of File: LinguisticsLibrary.cs ---
public class LinguisticsLibrary : AssetLibrary<LinguisticsAsset>
{
	private const string C = "C";

	private const string V = "V";

	public override void init()
	{
		addPronounce();
		addWordGroups();
		addUnique();
		addMain();
	}

	private void addPronounce()
	{
		add(new LinguisticsAsset
		{
			id = "pron_subj",
			word_group = true,
			add_space = true,
			array = AssetLibrary<LinguisticsAsset>.a<string>("pron_subj_i", "pron_subj_we", "pron_subj_you", "pron_subj_it", "pron_subj_they")
		});
		add(new LinguisticsAsset
		{
			id = "pron_obj",
			word_group = true,
			add_space = true,
			array = AssetLibrary<LinguisticsAsset>.a<string>("pron_obj_me", "pron_obj_us", "pron_obj_you", "pron_obj_it", "pron_obj_them")
		});
		add(new LinguisticsAsset
		{
			id = "pron_poss_adj",
			word_group = true,
			add_space = true,
			array = AssetLibrary<LinguisticsAsset>.a<string>("pron_poss_my", "pron_poss_our", "pron_poss_your", "pron_poss_its", "pron_poss_their")
		});
		add(new LinguisticsAsset
		{
			id = "pron_posspr",
			word_group = true,
			add_space = true,
			array = AssetLibrary<LinguisticsAsset>.a<string>("pron_poss_mine", "pron_poss_ours", "pron_poss_yours", "pron_poss_theirs")
		});
	}

	private void addWordGroups()
	{
		add(new LinguisticsAsset
		{
			id = "word_concept",
			word_group = true,
			add_space = true,
			word_type = WordType.Concept,
			array = AssetLibrary<LinguisticsAsset>.a<string>("concept_love", "concept_death", "concept_nature")
		});
		add(new LinguisticsAsset
		{
			id = "word_action",
			word_group = true,
			add_space = true,
			word_type = WordType.Action,
			array = AssetLibrary<LinguisticsAsset>.a<string>("action_run", "action_walk", "action_fight")
		});
		add(new LinguisticsAsset
		{
			id = "word_object",
			word_group = true,
			add_space = true,
			word_type = WordType.Object,
			array = AssetLibrary<LinguisticsAsset>.a<string>("object_sword", "object_shield", "object_bow")
		});
		add(new LinguisticsAsset
		{
			id = "word_place",
			word_group = true,
			add_space = true,
			word_type = WordType.Place,
			array = AssetLibrary<LinguisticsAsset>.a<string>("place_forest", "place_mountain", "place_hill")
		});
		add(new LinguisticsAsset
		{
			id = "word_creature",
			word_group = true,
			add_space = true,
			word_type = WordType.Creature,
			array = AssetLibrary<LinguisticsAsset>.a<string>("creature_king", "creature_queen", "creature_prince")
		});
	}

	private void addMain()
	{
		add(new LinguisticsAsset
		{
			id = "vowel",
			array = AssetLibrary<LinguisticsAsset>.a<string>("a", "e", "i", "o", "u", "y")
		});
		add(new LinguisticsAsset
		{
			id = "diphthongs",
			array = AssetLibrary<LinguisticsAsset>.a<string>("ai", "ei", "oi", "au", "ou", "ia", "io", "ua", "ue")
		});
		add(new LinguisticsAsset
		{
			id = "consonant",
			array = AssetLibrary<LinguisticsAsset>.a<string>("p", "b", "t", "d", "k", "g", "f", "v", "s", "z", "h", "m", "n", "l", "r", "w", "y", "j")
		});
		add(new LinguisticsAsset
		{
			id = "onset1",
			array = AssetLibrary<LinguisticsAsset>.a<string>("p", "b", "t", "d", "k", "g", "f", "v", "s", "z", "sh", "zh", "m", "n", "l", "r", "w", "y", "ch", "j")
		});
		add(new LinguisticsAsset
		{
			id = "onset2",
			array = AssetLibrary<LinguisticsAsset>.a<string>("pr", "br", "tr", "dr", "kr", "gr", "fr", "vr", "shr", "thr", "pl", "bl", "kl", "gl", "fl", "vl", "tw", "dw", "kw", "gw", "sw", "sk", "st", "sp")
		});
		add(new LinguisticsAsset
		{
			id = "coda1",
			array = AssetLibrary<LinguisticsAsset>.a<string>("n", "m", "l", "r", "s", "sh", "z")
		});
		add(new LinguisticsAsset
		{
			id = "coda2",
			array = AssetLibrary<LinguisticsAsset>.a<string>("nd", "nt", "nk", "mp", "lt", "ld", "lp", "lf", "rk", "rt", "rs", "rz", "st", "sk")
		});
		add(new LinguisticsAsset
		{
			id = "syllable_starts"
		});
		t.addPattern(50, "C", "V");
		t.addPattern(25, "C", "C", "V");
		t.addPattern(20, "C", "V", "C");
		t.addPattern(5, "V");
		add(new LinguisticsAsset
		{
			id = "syllable_mids"
		});
		t.addPattern(40, "C", "V");
		t.addPattern(30, "C", "V", "C");
		t.addPattern(10, "C", "C", "V");
		t.addPattern(20, "V");
		add(new LinguisticsAsset
		{
			id = "syllable_ends"
		});
		t.addPattern(40, "C", "V", "C");
		t.addPattern(30, "V", "C");
		t.addPattern(20, "C", "V");
		t.addPattern(10, "V");
	}

	private void addUnique()
	{
		add(new LinguisticsAsset
		{
			id = "comma",
			simple_text = ","
		});
		add(new LinguisticsAsset
		{
			id = "period",
			simple_text = ".",
			next_uppercase = true
		});
		add(new LinguisticsAsset
		{
			id = "semicolon",
			simple_text = ";",
			next_uppercase = true
		});
		add(new LinguisticsAsset
		{
			id = "colon",
			simple_text = ":"
		});
		add(new LinguisticsAsset
		{
			id = "dash",
			add_space = true,
			simple_text = ""
		});
		add(new LinguisticsAsset
		{
			id = "hyphen",
			simple_text = "-"
		});
		add(new LinguisticsAsset
		{
			id = "ellipsis",
			simple_text = "...",
			next_uppercase = true
		});
		add(new LinguisticsAsset
		{
			id = "question_mark",
			simple_text = "?",
			next_uppercase = true
		});
		add(new LinguisticsAsset
		{
			id = "exclamation_mark",
			simple_text = "!",
			next_uppercase = true
		});
		add(new LinguisticsAsset
		{
			id = "space",
			simple_text = " "
		});
		add(new LinguisticsAsset
		{
			id = "quotation_marks",
			symbols_around = true,
			add_space = true,
			symbols_around_left = "",
			symbols_around_right = ""
		});
		add(new LinguisticsAsset
		{
			id = "parentheses",
			symbols_around = true,
			add_space = true,
			symbols_around_left = "(",
			symbols_around_right = ")"
		});
		add(new LinguisticsAsset
		{
			id = "brackets",
			symbols_around = true,
			add_space = true,
			symbols_around_left = "[",
			symbols_around_right = "]"
		});
		add(new LinguisticsAsset
		{
			id = "braces",
			symbols_around = true,
			add_space = true,
			symbols_around_left = "{",
			symbols_around_right = "}"
		});
		add(new LinguisticsAsset
		{
			id = "apostrophe",
			add_space = true,
			simple_text = "'"
		});
	}
}
// --- End of File: LinguisticsLibrary.cs ---



// --- Start of File: LinkDirection.cs ---
internal enum LinkDirection
{
	Up,
	Down,
	Left,
	Right,
	LR,
	UD
}
// --- End of File: LinkDirection.cs ---



// --- Start of File: List.cs ---
using System.Collections.Generic;

public static class List
{
	public static List<T> Of<T>(params T[] pArgs)
	{
		return new List<T>(pArgs);
	}
}
// --- End of File: List.cs ---



// --- Start of File: ListAccessHelper.cs ---
internal static class ListAccessHelper
{
	internal record ListDataHelper<T>
	{
		public T[] _items;

		public int _size;

		public int _version;
	}

	public static readonly int ItemsOffset = 0;

	public static readonly int SizeOffset = 8;

	public static readonly int VersionOffset = 12;
}
// --- End of File: ListAccessHelper.cs ---



// --- Start of File: ListComponentSetter.cs ---
using UnityEngine;

public delegate IComponentList ListComponentSetter(Transform pTransform);
// --- End of File: ListComponentSetter.cs ---



// --- Start of File: ListElementPrefabGetter.cs ---
using UnityEngine;

public delegate MonoBehaviour ListElementPrefabGetter();
// --- End of File: ListElementPrefabGetter.cs ---



// --- Start of File: ListExtensions.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using JetBrains.Annotations;
using Unity.Collections.LowLevel.Unsafe;
using UnityEngine;
using UnityEngine.Pool;

public static class ListExtensions
{
	private static Random rnd => Randy.rnd;

	public static string ToJson(this List<string> list)
	{
		if (list.Count == 0)
		{
			return "[]";
		}
		return "['" + string.Join("','", list) + "']";
	}

	public static void ShuffleHalf<T>(this List<T> list)
	{
		if (list.Count >= 2)
		{
			int count = list.Count;
			int num = count / 2 + 1;
			for (int i = 0; i < num && i < count; i += 2)
			{
				list.Swap(i, rnd.Next(i, count));
			}
		}
	}

	public static void ShuffleN<T>(this List<T> list, int pItems)
	{
		if (list.Count >= 2)
		{
			int num = ((list.Count < pItems) ? list.Count : pItems);
			for (int i = 0; i < num; i++)
			{
				list.Swap(i, rnd.Next(i, num));
			}
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void Shuffle<T>(this List<T> list)
	{
		if (list.Count >= 2)
		{
			int count = list.Count;
			for (int i = 0; i < count; i++)
			{
				list.Swap(i, rnd.Next(i, count));
			}
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void ShuffleOne<T>(this List<T> list)
	{
		if (list.Count >= 2)
		{
			list.Swap(0, rnd.Next(0, list.Count));
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void ShuffleOne<T>(this List<T> list, int nItem)
	{
		if (list.Count >= 2 && list.Count >= nItem + 1)
		{
			list.Swap(nItem, rnd.Next(nItem, list.Count));
		}
	}

	public static void ShuffleLast<T>(this List<T> list)
	{
		if (list.Count >= 2)
		{
			list.Swap(list.Count - 1, rnd.Next(0, list.Count));
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static T Pop<T>(this List<T> list)
	{
		T result = list[list.Count - 1];
		list.RemoveAt(list.Count - 1);
		return result;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static T Shift<T>(this List<T> list)
	{
		T result = list[0];
		list.RemoveAt(0);
		return result;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static T First<T>(this List<T> list)
	{
		return list[0];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static T Last<T>(this List<T> list)
	{
		return list[list.Count - 1];
	}

	public static void ShuffleRandomOne<T>(this List<T> list)
	{
		if (list.Count >= 2)
		{
			int num = Randy.randomInt(0, list.Count - 1);
			list.Swap(num, rnd.Next(num, list.Count));
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void Swap<T>(this List<T> list, int i, int j)
	{
		T value = list[i];
		list[i] = list[j];
		list[j] = value;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static T GetRandom<T>(this List<T> list)
	{
		return list[rnd.Next(0, list.Count)];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void RemoveAtSwapBack<T>(this List<T> list, T pObject)
	{
		int num = list.IndexOf(pObject);
		if (num != -1)
		{
			int index = list.Count - 1;
			list[num] = list[index];
			list[index] = pObject;
			list.RemoveAt(index);
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool Any<T>(this List<T> list)
	{
		if (list == null)
		{
			return false;
		}
		return list.Count > 0;
	}

	[Pure]
	public static bool SetEquals<T>(this List<T> pList, IEnumerable<T> pOther)
	{
		if (pList == null || pOther == null)
		{
			return false;
		}
		HashSet<T> hashSet = CollectionPool<HashSet<T>, T>.Get();
		HashSet<T> hashSet2 = CollectionPool<HashSet<T>, T>.Get();
		hashSet.UnionWith(pList);
		hashSet2.UnionWith(pOther);
		bool result = hashSet.SetEquals(hashSet2);
		hashSet2.Clear();
		hashSet.Clear();
		CollectionPool<HashSet<T>, T>.Release(hashSet);
		CollectionPool<HashSet<T>, T>.Release(hashSet2);
		return result;
	}

	public static string ToLineString<T>(this List<T> pList, string pSeparator = ",")
	{
		if (pList == null)
		{
			return string.Empty;
		}
		return string.Join(pSeparator, pList);
	}

	public static void PrintToConsole<T>(this List<T> pList)
	{
		if (pList != null)
		{
			Debug.Log((object)pList.ToLineString());
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void AddTimes<T>(this List<T> pList, int pAmount, T pObject)
	{
		for (int i = 0; i < pAmount; i++)
		{
			pList.Add(pObject);
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static T LoopNext<T>(this List<T> pList, T pObject)
	{
		int num = pList.IndexOf(pObject);
		if (num == -1)
		{
			return pObject;
		}
		num++;
		if (num >= pList.Count)
		{
			num = 0;
		}
		return pList[num];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static Span<T> AsSpan<T>(this List<T> pList)
	{
		ListAccessHelper.ListDataHelper<T> obj = UnsafeUtility.As<List<T>, ListAccessHelper.ListDataHelper<T>>(ref pList);
		int size = obj._size;
		T[] items = obj._items;
		if ((uint)size > (uint)items.Length)
		{
			throw new InvalidOperationException("Concurrent operations are not supported.");
		}
		return new Span<T>(items, 0, size);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static ReadOnlySpan<T> AsReadOnlySpan<T>(this List<T> pList)
	{
		ListAccessHelper.ListDataHelper<T> obj = UnsafeUtility.As<List<T>, ListAccessHelper.ListDataHelper<T>>(ref pList);
		int size = obj._size;
		T[] items = obj._items;
		if ((uint)size > (uint)items.Length)
		{
			throw new InvalidOperationException("Concurrent operations are not supported.");
		}
		return new ReadOnlySpan<T>(items, 0, size);
	}

	public static string AsString<T>(this List<T> pList)
	{
		return pList.ToArray().AsString();
	}
}
// --- End of File: ListExtensions.cs ---



// --- Start of File: ListItemsFilter.cs ---
public enum ListItemsFilter
{
	All,
	Favorites,
	Dead,
	OnlyAlive
}
// --- End of File: ListItemsFilter.cs ---



// --- Start of File: ListMetaContainer.cs ---
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class ListMetaContainer<TListElement, TMetaObject, TMetaData> : WindowMetaElementBase where TListElement : WindowListElementBase<TMetaObject, TMetaData> where TMetaObject : CoreSystemObject<TMetaData> where TMetaData : BaseSystemData
{
	[SerializeField]
	private TListElement _prefab;

	[SerializeField]
	private Transform _container;

	private StatsWindow _window;

	private ObjectPoolGenericMono<TListElement> _pool_elements;

	protected override void Awake()
	{
		_window = ((Component)this).GetComponentInParent<StatsWindow>();
		_pool_elements = new ObjectPoolGenericMono<TListElement>(_prefab, _container);
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		using ListPool<TMetaObject> tListObjects = new ListPool<TMetaObject>(getMetaList());
		track_objects.AddRange(tListObjects);
		tListObjects.Sort(getSorting());
		for (int i = 0; i < tListObjects.Count; i++)
		{
			TMetaObject tObject = tListObjects[i];
			yield return (object)new WaitForSecondsRealtime(0.025f);
			showElement(tObject);
		}
	}

	private void showElement(TMetaObject pMeta)
	{
		_pool_elements.getNext().show(pMeta);
	}

	protected override void clear()
	{
		_pool_elements.clear();
		base.clear();
	}

	protected IMetaObject getMeta()
	{
		return AssetManager.meta_type_library.getAsset(_window.meta_type).get_selected() as IMetaObject;
	}

	protected virtual IEnumerable<TMetaObject> getMetaList()
	{
		throw new NotImplementedException();
	}

	protected virtual Comparison<TMetaObject> getSorting()
	{
		throw new NotImplementedException();
	}
}
// --- End of File: ListMetaContainer.cs ---



// --- Start of File: ListPool.cs ---
using System;
using System.Buffers;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics.CodeAnalysis;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Threading;

[Serializable]
public sealed class ListPool<T> : IList<T>, ICollection<T>, IEnumerable<T>, IEnumerable, IList, ICollection, IReadOnlyList<T>, IReadOnlyCollection<T>, IDisposable
{
	public struct Enumerator : IEnumerator<T>, IEnumerator, IDisposable
	{
		private readonly T[] _source;

		private readonly int _itemsCount;

		private int _index;

		public readonly ref T Current
		{
			[MethodImpl(MethodImplOptions.AggressiveInlining)]
			[return: MaybeNull]
			get
			{
				return ref _source[_index];
			}
		}

		readonly T IEnumerator<T>.Current
		{
			[MethodImpl(MethodImplOptions.AggressiveInlining)]
			[return: MaybeNull]
			get
			{
				return _source[_index];
			}
		}

		readonly object? IEnumerator.Current
		{
			[MethodImpl(MethodImplOptions.AggressiveInlining)]
			[return: MaybeNull]
			get
			{
				return _source[_index];
			}
		}

		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		public Enumerator(T[] source, int itemsCount)
		{
			_source = source;
			_itemsCount = itemsCount;
			_index = -1;
		}

		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		public bool MoveNext()
		{
			return ++_index < _itemsCount;
		}

		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		public void Reset()
		{
			_index = -1;
		}

		public readonly void Dispose()
		{
		}
	}

	private const int MinimumCapacity = 32;

	private T[] _items;

	[NonSerialized]
	private object? _syncRoot;

	private static readonly ArrayPool<T> _arrayPool = ArrayPool<T>.Shared;

	private static readonly bool _should_clean = !typeof(T).IsValueType && typeof(string) != typeof(T);

	public int Capacity => _items.Length;

	int ICollection.Count => Count;

	bool IList.IsFixedSize => false;

	bool ICollection.IsSynchronized => false;

	bool IList.IsReadOnly => false;

	object ICollection.SyncRoot
	{
		get
		{
			if (_syncRoot == null)
			{
				Interlocked.CompareExchange<object>(ref _syncRoot, new object(), (object)null);
			}
			return _syncRoot;
		}
	}

	object IList.this[int index]
	{
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		[return: MaybeNull]
		get
		{
			if (index >= Count)
			{
				throw new IndexOutOfRangeException("index");
			}
			return _items[index];
		}
		set
		{
			if (index >= Count)
			{
				throw new IndexOutOfRangeException("index");
			}
			if (value is T val)
			{
				_items[index] = val;
				return;
			}
			throw new ArgumentException($"Wrong value type. Expected {typeof(T)}, got: '{value}'.", "value");
		}
	}

	public int Count { get; private set; }

	public bool IsReadOnly => false;

	public T this[int index]
	{
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		[return: MaybeNull]
		get
		{
			if (index >= Count)
			{
				throw new IndexOutOfRangeException("index");
			}
			return _items[index];
		}
		set
		{
			if (index >= Count)
			{
				throw new IndexOutOfRangeException("index");
			}
			_items[index] = value;
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public ListPool()
	{
		_items = _arrayPool.Rent(32);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public ListPool(int capacity)
	{
		_items = _arrayPool.Rent((capacity < 32) ? 32 : capacity);
	}

	public ListPool(ICollection<T> collection)
	{
		if (collection == null)
		{
			throw new ArgumentNullException("collection");
		}
		T[] array = _arrayPool.Rent((collection.Count > 32) ? collection.Count : 32);
		collection.CopyTo(array, 0);
		_items = array;
		Count = collection.Count;
	}

	public ListPool(IEnumerable<T> source)
	{
		if (source == null)
		{
			throw new ArgumentNullException("source");
		}
		int num = Enumerable.Count(source);
		_items = _arrayPool.Rent((num > 32) ? num : 32);
		T[] items = _items;
		Count = 0;
		int num2 = 0;
		using IEnumerator<T> enumerator = source.GetEnumerator();
		while (enumerator.MoveNext())
		{
			if (num2 < items.Length)
			{
				items[num2] = enumerator.Current;
				num2++;
				continue;
			}
			Count = num2;
			AddWithResize(enumerator.Current);
			num2++;
			items = _items;
		}
		Count = num2;
	}

	public ListPool(T[] source)
	{
		if (source == null)
		{
			throw new ArgumentNullException("source");
		}
		int minimumLength = ((source.Length > 32) ? source.Length : 32);
		T[] array = _arrayPool.Rent(minimumLength);
		source.CopyTo(array, 0);
		_items = array;
		Count = source.Length;
	}

	public ListPool(ReadOnlySpan<T> source)
	{
		int minimumLength = ((source.Length > 32) ? source.Length : 32);
		T[] array = _arrayPool.Rent(minimumLength);
		source.CopyTo(array);
		_items = array;
		Count = source.Length;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Dispose()
	{
		if (_should_clean)
		{
			Clear();
		}
		Count = 0;
		_arrayPool.Return(_items);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	int IList.Add(object item)
	{
		if (item is T item2)
		{
			Add(item2);
			return Count - 1;
		}
		throw new ArgumentException($"Wrong value type. Expected {typeof(T)}, got: '{item}'.", "item");
	}

	bool IList.Contains(object item)
	{
		if (item is T item2)
		{
			return Contains(item2);
		}
		throw new ArgumentException($"Wrong value type. Expected {typeof(T)}, got: '{item}'.", "item");
	}

	int IList.IndexOf(object item)
	{
		if (item is T item2)
		{
			return IndexOf(item2);
		}
		throw new ArgumentException($"Wrong value type. Expected {typeof(T)}, got: '{item}'.", "item");
	}

	void IList.Remove(object item)
	{
		if (item is T item2)
		{
			Remove(item2);
		}
		else if (item != null)
		{
			throw new ArgumentException($"Wrong value type. Expected {typeof(T)}, got: '{item}'.", "item");
		}
	}

	void IList.Insert(int index, object item)
	{
		if (item is T item2)
		{
			Insert(index, item2);
			return;
		}
		throw new ArgumentException($"Wrong value type. Expected {typeof(T)}, got: '{item}'.", "item");
	}

	void ICollection.CopyTo(Array array, int arrayIndex)
	{
		Array.Copy(_items, 0, array, arrayIndex, Count);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Add(T item)
	{
		T[] items = _items;
		int count = Count;
		if (count < items.Length)
		{
			items[count] = item;
			Count = count + 1;
		}
		else
		{
			AddWithResize(item);
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Clear()
	{
		if (Count > 0)
		{
			Array.Clear(_items, 0, Count);
			Count = 0;
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Clear(int pAfterIndex)
	{
		if (Count > 0 && pAfterIndex < Count)
		{
			Array.Clear(_items, pAfterIndex, Count - pAfterIndex);
			Count = pAfterIndex;
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool Contains(T item)
	{
		return IndexOf(item) > -1;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public int IndexOf(T item)
	{
		return Array.IndexOf(_items, item, 0, Count);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void CopyTo(T[] array, int arrayIndex)
	{
		Array.Copy(_items, 0, array, arrayIndex, Count);
	}

	public bool Remove(T item)
	{
		if (item == null)
		{
			return false;
		}
		int num = IndexOf(item);
		if (num == -1)
		{
			return false;
		}
		RemoveAt(num);
		return true;
	}

	public void Insert(int index, T item)
	{
		int count = Count;
		T[] items = _items;
		if (items.Length == count)
		{
			int capacity = count * 2;
			EnsureCapacity(capacity);
			items = _items;
		}
		if (index < count)
		{
			Array.Copy(items, index, items, index + 1, count - index);
			items[index] = item;
			Count++;
			return;
		}
		if (index == count)
		{
			items[index] = item;
			Count++;
			return;
		}
		throw new IndexOutOfRangeException("index");
	}

	public void RemoveAt(int index)
	{
		int count = Count;
		T[] items = _items;
		if (index >= count)
		{
			throw new IndexOutOfRangeException("index");
		}
		count--;
		Array.Copy(items, index + 1, items, index, count - index);
		if (_should_clean)
		{
			items[count] = default(T);
		}
		Count = count;
	}

	public int RemoveAll(Predicate<T> match)
	{
		int count = Count;
		T[] items = _items;
		int i;
		for (i = 0; i < count && !match(items[i]); i++)
		{
		}
		if (i >= count)
		{
			return 0;
		}
		int j = i + 1;
		while (j < count)
		{
			for (; j < count && match(items[j]); j++)
			{
			}
			if (j < count)
			{
				items[i++] = items[j++];
			}
		}
		if (_should_clean)
		{
			Array.Clear(items, i, count - i);
		}
		int result = count - i;
		Count = i;
		return result;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	IEnumerator<T> IEnumerable<T>.GetEnumerator()
	{
		return new Enumerator(_items, Count);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	IEnumerator IEnumerable.GetEnumerator()
	{
		return new Enumerator(_items, Count);
	}

	public void AddRange(Span<T> items)
	{
		int count = Count;
		T[] items2 = _items;
		if (items2.Length - items.Length - count < 0)
		{
			EnsureCapacity(items2.Length + items.Length);
			items2 = _items;
		}
		items.CopyTo(items2.AsSpan().Slice(count));
		Count += items.Length;
	}

	public void AddRange(ReadOnlySpan<T> items)
	{
		int count = Count;
		T[] items2 = _items;
		if (items2.Length - items.Length - count < 0)
		{
			EnsureCapacity(items2.Length + items.Length);
			items2 = _items;
		}
		items.CopyTo(items2.AsSpan().Slice(count));
		Count += items.Length;
	}

	public void AddRange(T[] items)
	{
		int count = Count;
		T[] items2 = _items;
		if (items2.Length - items.Length - count < 0)
		{
			EnsureCapacity(items2.Length + items.Length);
			items2 = _items;
		}
		Array.Copy(items, 0, items2, count, items.Length);
		Count += items.Length;
	}

	public void AddRange(IEnumerable<T> items)
	{
		int num = Count;
		T[] items2 = _items;
		if (items is ICollection<T> collection)
		{
			if (items2.Length - collection.Count - num < 0)
			{
				EnsureCapacity(items2.Length + collection.Count);
				items2 = _items;
			}
			collection.CopyTo(items2, num);
			Count += collection.Count;
			return;
		}
		foreach (T item in items)
		{
			if (num < items2.Length)
			{
				items2[num] = item;
				num++;
				continue;
			}
			Count = num;
			AddWithResize(item);
			num++;
			items2 = _items;
		}
		Count = num;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public Span<T> AsSpan()
	{
		return _items.AsSpan(0, Count);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public Memory<T> AsMemory()
	{
		return _items.AsMemory(0, Count);
	}

	[MethodImpl(MethodImplOptions.NoInlining)]
	private void AddWithResize(T item)
	{
		ArrayPool<T> arrayPool = _arrayPool;
		T[] items = _items;
		T[] array = arrayPool.Rent(items.Length * 2);
		int num = items.Length;
		Array.Copy(items, 0, array, 0, num);
		array[num] = item;
		_items = array;
		Count = num + 1;
		arrayPool.Return(items, _should_clean);
	}

	public void EnsureCapacity(int capacity)
	{
		if (capacity > Capacity)
		{
			ArrayPool<T> arrayPool = _arrayPool;
			T[] array = arrayPool.Rent(capacity);
			T[] items = _items;
			Array.Copy(items, 0, array, 0, items.Length);
			_items = array;
			arrayPool.Return(items, _should_clean);
		}
	}

	public T[] GetRawBuffer()
	{
		return _items;
	}

	public void SetOffsetManually(int offset)
	{
		Count = offset;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public Enumerator GetEnumerator()
	{
		return new Enumerator(_items, Count);
	}

	public void Sort()
	{
		Sort(0, Count, null);
	}

	public void Sort(IComparer<T> comparer)
	{
		Sort(0, Count, comparer);
	}

	public void Sort(int index, int count, IComparer<T> comparer)
	{
		Array.Sort(_items, index, count, comparer);
	}

	public void Sort(Comparison<T> comparison)
	{
		Array.Sort(_items, 0, Count, Comparer<T>.Create(comparison));
	}

	public void Reverse()
	{
		Array.Reverse(_items, 0, Count);
	}

	public void Reverse(int index, int count)
	{
		Array.Reverse(_items, index, count);
	}
}
// --- End of File: ListPool.cs ---



// --- Start of File: ListPoolExtensions.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using JetBrains.Annotations;
using UnityEngine.Pool;

public static class ListPoolExtensions
{
	private static Random rnd => Randy.rnd;

	public static string ToJson(this ListPool<string> list)
	{
		if (list.Count == 0)
		{
			return "[]";
		}
		return "['" + string.Join("','", list) + "']";
	}

	public static void ShuffleHalf<T>(this ListPool<T> list)
	{
		if (list.Count >= 2)
		{
			int count = list.Count;
			int num = count / 2 + 1;
			for (int i = 0; i < num && i < count; i += 2)
			{
				list.Swap(i, rnd.Next(i, count));
			}
		}
	}

	public static void ShuffleN<T>(this ListPool<T> list, int pItems)
	{
		if (list.Count >= 2)
		{
			int num = ((list.Count < pItems) ? list.Count : pItems);
			for (int i = 0; i < num; i++)
			{
				list.Swap(i, rnd.Next(i, num));
			}
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void Shuffle<T>(this ListPool<T> list)
	{
		if (list.Count >= 2)
		{
			int count = list.Count;
			for (int i = 0; i < count; i++)
			{
				list.Swap(i, rnd.Next(i, count));
			}
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void ShuffleOne<T>(this ListPool<T> list)
	{
		if (list.Count >= 2)
		{
			list.Swap(0, rnd.Next(0, list.Count));
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void ShuffleOne<T>(this ListPool<T> list, int nItem)
	{
		if (list.Count >= 2 && list.Count >= nItem + 1)
		{
			list.Swap(nItem, rnd.Next(nItem, list.Count));
		}
	}

	public static void ShuffleLast<T>(this ListPool<T> list)
	{
		if (list.Count >= 2)
		{
			list.Swap(list.Count - 1, rnd.Next(0, list.Count));
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static T Pop<T>(this ListPool<T> list)
	{
		T result = list[list.Count - 1];
		list.RemoveAt(list.Count - 1);
		return result;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static T Shift<T>(this ListPool<T> list)
	{
		T result = list[0];
		list.RemoveAt(0);
		return result;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static T First<T>(this ListPool<T> list)
	{
		return list[0];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static T Last<T>(this ListPool<T> list)
	{
		return list[list.Count - 1];
	}

	public static void ShuffleRandomOne<T>(this ListPool<T> list)
	{
		if (list.Count >= 2)
		{
			int num = Randy.randomInt(0, list.Count - 1);
			list.Swap(num, rnd.Next(num, list.Count));
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void Swap<T>(this ListPool<T> list, int i, int j)
	{
		T[] rawBuffer = list.GetRawBuffer();
		T val = rawBuffer[i];
		rawBuffer[i] = rawBuffer[j];
		rawBuffer[j] = val;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static T GetRandom<T>(this ListPool<T> list)
	{
		return list[rnd.Next(0, list.Count)];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void RemoveAtSwapBack<T>(this ListPool<T> list, T pObject)
	{
		int num = list.IndexOf(pObject);
		if (num != -1)
		{
			int index = list.Count - 1;
			list[num] = list[index];
			list[index] = pObject;
			list.RemoveAt(index);
		}
	}

	[Pure]
	public static T[] ToArray<T>(this ListPool<T> list)
	{
		T[] array = new T[list.Count];
		list.CopyTo(array, 0);
		return array;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[Pure]
	public static bool Any<T>(this ListPool<T> list)
	{
		if (list == null)
		{
			return false;
		}
		return list.Count > 0;
	}

	[Pure]
	public static bool SetEquals<T>(this ListPool<T> pList, IEnumerable<T> pOther)
	{
		if (pList == null || pOther == null)
		{
			return false;
		}
		HashSet<T> hashSet = CollectionPool<HashSet<T>, T>.Get();
		HashSet<T> hashSet2 = CollectionPool<HashSet<T>, T>.Get();
		hashSet.UnionWith(pList);
		hashSet2.UnionWith(pOther);
		bool result = hashSet.SetEquals(hashSet2);
		hashSet2.Clear();
		hashSet.Clear();
		CollectionPool<HashSet<T>, T>.Release(hashSet);
		CollectionPool<HashSet<T>, T>.Release(hashSet2);
		return result;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static void AddTimes<T>(this ListPool<T> pList, int pAmount, T pObject)
	{
		for (int i = 0; i < pAmount; i++)
		{
			pList.Add(pObject);
		}
	}

	public static int CountAll<T>(this ListPool<T> pList, Predicate<T> pMatch)
	{
		int num = 0;
		for (int i = 0; i < pList.Count; i++)
		{
			if (pMatch(pList[i]))
			{
				num++;
			}
		}
		return num;
	}

	public static IEnumerable<T> Where<T>(this ListPool<T> pList, Func<T, bool> pPredicate)
	{
		for (int i = 0; i < pList.Count; i++)
		{
			if (pPredicate(pList[i]))
			{
				yield return pList[i];
			}
		}
	}

	[Pure]
	public static bool ValuesEqual<T>(this ListPool<T> pList, ListPool<T> pOther)
	{
		if (pList.Count != pOther.Count)
		{
			return false;
		}
		long longHashCode = pList.GetLongHashCode();
		long longHashCode2 = pOther.GetLongHashCode();
		if (longHashCode != longHashCode2)
		{
			return false;
		}
		return true;
	}

	[Pure]
	public static long GetLongHashCode<T>(this ListPool<T> pList)
	{
		long num = 0L;
		foreach (ref T p in pList)
		{
			T current = p;
			num += current.GetHashCode();
		}
		return num;
	}

	public static string AsString<T>(this ListPool<T> pListPool)
	{
		return pListPool.ToArray().AsString();
	}
}
// --- End of File: ListPoolExtensions.cs ---



// --- Start of File: ListSorters.cs ---
public class ListSorters
{
	public static int sortUnitByAgeOldFirst(Actor pActor1, Actor pActor2)
	{
		return -pActor2.data.created_time.CompareTo(pActor1.data.created_time);
	}

	public static int sortUnitByAgeYoungFirst(Actor pActor1, Actor pActor2)
	{
		return pActor2.data.created_time.CompareTo(pActor1.data.created_time);
	}

	public static int sortUnitByKills(Actor pActor1, Actor pActor2)
	{
		return -pActor1.data.kills.CompareTo(pActor2.data.kills);
	}

	public static int sortUnitByRenown(Actor pActor1, Actor pActor2)
	{
		return -pActor1.data.renown.CompareTo(pActor2.data.renown);
	}

	public static int sortUnitByGoldCoins(Actor pActor1, Actor pActor2)
	{
		return -pActor1.data.money.CompareTo(pActor2.data.money);
	}

	public static int sortUnitByGender(Actor pActor1, Actor pActor2, ActorSex pTopGender)
	{
		if (pActor1.data.sex == pActor2.data.sex)
		{
			return 0;
		}
		if (pActor1.data.sex == pTopGender)
		{
			return -1;
		}
		return 1;
	}

	public static int sortUnitByStats(Actor pActor1, Actor pActor2, string pStatId)
	{
		float num = pActor1.stats.get(pStatId);
		float value = pActor2.stats.get(pStatId);
		return -num.CompareTo(value);
	}

	public static Actor getUnitSortedByAgeAndTraits(ListPool<Actor> pUnits, Culture pCulture)
	{
		sortUnitsSortedByAgeAndTraits(pUnits, pCulture);
		return pUnits[0];
	}

	public static void sortUnitsSortedByAgeAndTraits(ListPool<Actor> pUnits, Culture pCulture)
	{
		if (pCulture == null)
		{
			pUnits.Sort(sortUnitByAgeOldFirst);
			return;
		}
		if (pCulture.hasTrait("ultimogeniture"))
		{
			pUnits.Sort(sortUnitByAgeYoungFirst);
		}
		else
		{
			pUnits.Sort(sortUnitByAgeOldFirst);
		}
		bool num = pCulture.hasTrait("diplomatic_ascension");
		bool flag = pCulture.hasTrait("warriors_ascension");
		bool flag2 = pCulture.hasTrait("golden_rule");
		bool flag3 = pCulture.hasTrait("fames_crown");
		if (num)
		{
			pUnits.Sort((Actor a1, Actor a2) => sortUnitByStats(a1, a2, "diplomacy"));
		}
		else if (flag)
		{
			pUnits.Sort((Actor a1, Actor a2) => sortUnitByStats(a1, a2, "warfare"));
		}
		else if (flag3)
		{
			pUnits.Sort((Actor a1, Actor a2) => sortUnitByRenown(a1, a2));
		}
		else if (flag2)
		{
			pUnits.Sort((Actor a1, Actor a2) => sortUnitByGoldCoins(a1, a2));
		}
		bool flag4 = pCulture.hasTrait("patriarchy");
		bool flag5 = pCulture.hasTrait("matriarchy");
		if (flag4 || flag5)
		{
			ActorSex tSex = ((!flag4) ? ActorSex.Female : ActorSex.Male);
			pUnits.Sort((Actor a1, Actor a2) => sortUnitByGender(a1, a2, tSex));
		}
	}
}
// --- End of File: ListSorters.cs ---



// --- Start of File: ListWindow.cs ---
using System;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class ListWindow : MonoBehaviour
{
	[SerializeField]
	private Transform _content_list;

	[SerializeField]
	private WindowMetaTab _tab_list;

	[SerializeField]
	private WindowMetaTab _tab_favorite;

	[SerializeField]
	private WindowMetaTab _tab_dead;

	[SerializeField]
	private WindowMetaTabButtonsContainer _tabs_container;

	[SerializeField]
	private Image _art;

	[SerializeField]
	private Image _tab_list_icon;

	[SerializeField]
	private Image _title_icon_left;

	[SerializeField]
	private Image _title_icon_right;

	[SerializeField]
	private Image _no_items_icon_left;

	[SerializeField]
	private Image _no_items_icon_right;

	[SerializeField]
	private TipButton _tip_button_favorite;

	[SerializeField]
	private LocalizedText _no_items_description;

	[SerializeField]
	private ListWindowStatistics _statistics;

	[SerializeField]
	private MetaRepresentationTotal _breakdown;

	[SerializeField]
	private GameObject _no_items;

	[SerializeField]
	private SortingTab _sorting_tab;

	[SerializeField]
	private Transform _list_transform;

	[SerializeField]
	private ScrollRect _scroll_rect;

	[SerializeField]
	private Text _title_counter;

	[SerializeField]
	private Text _favorites_counter;

	[SerializeField]
	private Text _dead_counter;

	[SerializeField]
	private GameObject _list_element_prefab;

	[SerializeField]
	private MetaType _meta_type;

	private ListWindowAsset _asset;

	private void Awake()
	{
		_asset = AssetManager.list_window_library.getByMetaType(_meta_type);
		((Component)_list_transform).gameObject.SetActive(false);
		IComponentList pComponent = _asset.set_list_component(_list_transform);
		initComponent(pComponent);
		initTabsCallbacks(pComponent);
		((UnityEvent<WindowMetaTab>)_tab_list.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate
		{
			_no_items_description.setKeyAndUpdate(_asset.no_items_locale);
		});
		_no_items_description.setKeyAndUpdate(_asset.no_items_locale);
		if ((Object)(object)_statistics != (Object)null)
		{
			_statistics.meta_type = _meta_type;
		}
		((Component)_list_transform).gameObject.SetActive(true);
		_art.sprite = SpriteTextureLoader.getSprite(_asset.art_path);
		Sprite sprite = SpriteTextureLoader.getSprite(_asset.icon_path);
		_tab_list_icon.sprite = sprite;
		_title_icon_left.sprite = sprite;
		_title_icon_right.sprite = sprite;
		_no_items_icon_left.sprite = sprite;
		_no_items_icon_right.sprite = sprite;
		if ((Object)(object)_breakdown != (Object)null)
		{
			_breakdown.setMetaType(_meta_type);
		}
	}

	protected virtual void initComponent(IComponentList pComponent)
	{
		pComponent.init(_no_items, _sorting_tab, _list_element_prefab, _list_transform, _scroll_rect, _title_counter, _favorites_counter, _dead_counter);
	}

	protected virtual void initTabsCallbacks(IComponentList pComponent)
	{
		bool flag = (Object)(object)_tab_favorite != (Object)null && ((Component)_tab_favorite).gameObject.activeSelf;
		bool flag2 = (Object)(object)_tab_dead != (Object)null && ((Component)_tab_dead).gameObject.activeSelf;
		if (flag || flag2)
		{
			setTabCallbacks(_tab_list, pComponent.setShowAll, pComponent.setDefault);
			if (flag)
			{
				setTabCallbacks(_tab_favorite, pComponent.setShowFavoritesOnly, pComponent.setDefault);
				((UnityEvent<WindowMetaTab>)_tab_favorite.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate
				{
					_no_items_description.setKeyAndUpdate("empty_favorites_list");
				});
			}
			if (flag2)
			{
				setTabCallbacks(_tab_list, pComponent.setShowAliveOnly, pComponent.setDefault);
				setTabCallbacks(_tab_dead, pComponent.setShowDeadOnly, pComponent.setDefault);
				((UnityEvent<WindowMetaTab>)_tab_dead.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate
				{
					_no_items_description.setKeyAndUpdate(_asset.no_dead_items_locale);
				});
			}
		}
		else
		{
			((UnityEvent<WindowMetaTab>)_tab_list.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate
			{
				_tabs_container.showTab(_tab_list);
			});
		}
	}

	protected void setTabCallbacks(WindowMetaTab pTab, Action pCallback, Action pDefaultCallback = null)
	{
		((UnityEventBase)pTab.tab_action).RemoveAllListeners();
		if (pDefaultCallback != null)
		{
			((UnityEvent<WindowMetaTab>)pTab.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate
			{
				pDefaultCallback();
			});
		}
		((UnityEvent<WindowMetaTab>)pTab.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate
		{
			pCallback();
		});
		((UnityEvent<WindowMetaTab>)pTab.tab_action).AddListener((UnityAction<WindowMetaTab>)delegate(WindowMetaTab p)
		{
			_tabs_container.showTab(p);
		});
	}

	protected LocalizedText getNoItems()
	{
		return _no_items_description;
	}
}
// --- End of File: ListWindow.cs ---



// --- Start of File: ListWindowAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class ListWindowAsset : Asset, IMultiLocalesAsset
{
	public string no_items_locale;

	public string no_dead_items_locale;

	public string art_path;

	public string icon_path;

	public MetaType meta_type;

	public ListComponentSetter set_list_component;

	public IEnumerable<string> getLocaleIDs()
	{
		yield return no_items_locale;
		if (!string.IsNullOrEmpty(no_dead_items_locale))
		{
			yield return no_dead_items_locale;
		}
	}
}
// --- End of File: ListWindowAsset.cs ---



// --- Start of File: ListWindowLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public class ListWindowLibrary : AssetLibrary<ListWindowAsset>
{
	private Dictionary<MetaType, ListWindowAsset> _dict = new Dictionary<MetaType, ListWindowAsset>();

	public override void init()
	{
		add(new ListWindowAsset
		{
			id = "list_alliances",
			meta_type = MetaType.Alliance,
			no_items_locale = "list_empty_alliances",
			art_path = "ui/illustrations/art_alliances",
			icon_path = "ui/Icons/iconAllianceList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<AllianceListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_clans",
			meta_type = MetaType.Clan,
			no_items_locale = "list_empty_clans",
			art_path = "ui/illustrations/art_clans",
			icon_path = "ui/Icons/iconClanList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<ClanListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_cultures",
			meta_type = MetaType.Culture,
			no_items_locale = "list_empty_cultures",
			art_path = "ui/illustrations/art_cultures",
			icon_path = "ui/Icons/iconCultureList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<CultureListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_cities",
			meta_type = MetaType.City,
			no_items_locale = "list_empty_villages",
			art_path = "ui/illustrations/art_cities",
			icon_path = "ui/Icons/iconCityList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<CityListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_families",
			meta_type = MetaType.Family,
			no_items_locale = "list_empty_families",
			art_path = "ui/illustrations/art_families",
			icon_path = "ui/Icons/iconFamilyList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<FamilyListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_favorite_items",
			meta_type = MetaType.Item,
			no_items_locale = "list_empty_favorites_items",
			art_path = "ui/illustrations/art_favorite_items",
			icon_path = "ui/Icons/iconFavoriteItemsList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<FavoriteItemListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_favorite_units",
			meta_type = MetaType.Unit,
			no_items_locale = "list_empty_favorite_units",
			art_path = "ui/illustrations/art_favorite_units",
			icon_path = "ui/Icons/iconFavoritesList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<WindowFavorites>()
		});
		add(new ListWindowAsset
		{
			id = "list_kingdoms",
			meta_type = MetaType.Kingdom,
			no_items_locale = "list_empty_kingdoms",
			art_path = "ui/illustrations/art_kingdoms",
			icon_path = "ui/Icons/iconKingdomList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<KingdomListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_languages",
			meta_type = MetaType.Language,
			no_items_locale = "list_empty_languages",
			art_path = "ui/illustrations/art_languages",
			icon_path = "ui/Icons/iconLanguageList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<LanguageListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_plots",
			meta_type = MetaType.Plot,
			no_items_locale = "list_empty_plots",
			art_path = "ui/illustrations/art_plots",
			icon_path = "ui/Icons/iconPlotList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<PlotListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_religions",
			meta_type = MetaType.Religion,
			no_items_locale = "list_empty_religions",
			art_path = "ui/illustrations/art_religions",
			icon_path = "ui/Icons/iconReligionList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<ReligionListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_subspecies",
			meta_type = MetaType.Subspecies,
			no_items_locale = "list_empty_subspecies",
			art_path = "ui/illustrations/art_subspecies",
			icon_path = "ui/Icons/iconSubspeciesList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<SubspeciesListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_wars",
			meta_type = MetaType.War,
			no_items_locale = "list_empty_wars",
			no_dead_items_locale = "empty_past_wars_list",
			art_path = "ui/illustrations/art_wars",
			icon_path = "ui/Icons/iconWarList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<WarListComponent>()
		});
		add(new ListWindowAsset
		{
			id = "list_armies",
			meta_type = MetaType.Army,
			no_items_locale = "list_empty_armies",
			art_path = "ui/illustrations/art_armies",
			icon_path = "ui/Icons/iconArmyList",
			set_list_component = (Transform pTransform) => ((Component)(object)pTransform).AddComponent<ArmyListComponent>()
		});
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (ListWindowAsset item in list)
		{
			_dict.Add(item.meta_type, item);
		}
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (ListWindowAsset item in list)
		{
			foreach (string localeID in item.getLocaleIDs())
			{
				checkLocale(item, localeID);
			}
		}
	}

	public ListWindowAsset getByMetaType(MetaType pType)
	{
		return _dict[pType];
	}
}
// --- End of File: ListWindowLibrary.cs ---



// --- Start of File: ListWindowStatistics.cs ---
public class ListWindowStatistics : StatisticsRows
{
	public MetaType meta_type;

	protected override void init()
	{
		foreach (StatisticsAsset item in AssetManager.statistics_library.list)
		{
			if (!item.list_window_meta_type.isNone() && meta_type == item.list_window_meta_type)
			{
				addStatRow(item);
			}
		}
	}
}
// --- End of File: ListWindowStatistics.cs ---



// --- Start of File: LivingIcon.cs ---
using UnityEngine;

public class LivingIcon : MonoBehaviour
{
	private Vector3 init_position;

	private float speed_back;

	private float speed_away;

	private float return_timer;

	public static int killed_mod = 1;

	private void Awake()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		init_position = ((Component)this).transform.position;
	}

	public void kill()
	{
		killed_mod++;
		((Behaviour)this).enabled = false;
	}

	public void Update()
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0140: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0150: Unknown result type (might be due to invalid IL or missing references)
		//IL_0185: Unknown result type (might be due to invalid IL or missing references)
		//IL_018a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0190: Unknown result type (might be due to invalid IL or missing references)
		//IL_0195: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ab: Unknown result type (might be due to invalid IL or missing references)
		Vector3 mousePosition = Input.mousePosition;
		float num = Vector2.Distance(Vector2.op_Implicit(((Component)this).transform.position), Vector2.op_Implicit(mousePosition));
		float num2 = 80 + killed_mod * 10;
		if (num < num2)
		{
			if (speed_away == 0f && killed_mod > 6)
			{
				speed_away = killed_mod * 10;
			}
			speed_away += 200f * Time.deltaTime * (float)killed_mod;
		}
		else if (speed_away > 0f)
		{
			speed_away -= 500f * Time.deltaTime;
			if (speed_away < 0f)
			{
				speed_away = 0f;
			}
		}
		if (speed_away > 0f)
		{
			((Component)this).transform.position = Vector2.op_Implicit(Vector2.MoveTowards(Vector2.op_Implicit(((Component)this).transform.position), Vector2.op_Implicit(mousePosition), -1f * speed_away * Time.deltaTime));
			return_timer = 1f;
			speed_back = 0f;
			rotate();
		}
		else if (return_timer > 0f)
		{
			return_timer -= Time.deltaTime;
		}
		else if (Vector2.Distance(Vector2.op_Implicit(((Component)this).transform.position), Vector2.op_Implicit(init_position)) > 1f)
		{
			speed_back += Time.deltaTime * 400f;
			((Component)this).transform.position = Vector2.op_Implicit(Vector2.MoveTowards(Vector2.op_Implicit(((Component)this).transform.position), Vector2.op_Implicit(init_position), Time.deltaTime * speed_back));
		}
		else
		{
			speed_back = 0f;
		}
		void rotate()
		{
			//IL_0006: Unknown result type (might be due to invalid IL or missing references)
			//IL_000b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0022: Unknown result type (might be due to invalid IL or missing references)
			Vector3 eulerAngles = ((Component)this).transform.eulerAngles;
			eulerAngles.z += 10f;
			((Component)this).transform.eulerAngles = eulerAngles;
		}
	}
}
// --- End of File: LivingIcon.cs ---



// --- Start of File: LoadingScreen.cs ---
using System.Collections;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.UI;

public class LoadingScreen : MonoBehaviour
{
	public delegate void TransitionAction();

	public Image background;

	public CanvasGroup canvasGroup;

	public Text percents;

	public LocalizedText topText;

	public LocalizedText tipText;

	public Image bar;

	public Image mask;

	private AsyncOperation asyncLoad;

	private bool appearDone;

	public bool inGameScreen;

	internal bool modeIn;

	public TransitionAction action;

	private float outTimer;

	public Canvas canvas;

	public Text loadingHelperText;

	private static int _last_tip = -1;

	private static int _max_tip = 0;

	private float lastBgWidth;

	private float lastBgHeight;

	private float lastCScale;

	public bool debugg;

	private void setupBg()
	{
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		float num = Screen.width;
		float num2 = Screen.height;
		if (lastBgHeight != num2 || lastBgWidth != num || canvas.scaleFactor != lastCScale)
		{
			lastBgWidth = num;
			lastBgHeight = num2;
			lastCScale = canvas.scaleFactor;
			float num3 = (float)((Graphic)background).mainTexture.width * canvas.scaleFactor;
			float num4 = (float)((Graphic)background).mainTexture.height * canvas.scaleFactor;
			float num5 = (float)Screen.width / num3;
			float num6 = (float)Screen.height / num4;
			if (num5 > num6)
			{
				((Component)background).transform.localScale = new Vector3(num5, num5, 1f);
			}
			else
			{
				((Component)background).transform.localScale = new Vector3(num6, num6, 1f);
			}
		}
	}

	private void Awake()
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		InitLibraries.initMainLibs();
		Config.enableAutoRotation(pValue: false);
		((Component)this).transform.localPosition = default(Vector3);
		if (inGameScreen)
		{
			outTimer = 0.3f;
			canvasGroup.alpha = 1f;
			appearDone = true;
			((Component)bar).transform.localScale = new Vector3(1f, 1f, 1f);
		}
		else
		{
			canvasGroup.alpha = 0f;
			((Component)bar).transform.localScale = new Vector3(0f, 1f, 1f);
		}
	}

	private void startAction()
	{
		ScrollWindow.hideAllEvent(pWithAnimation: false);
		modeIn = false;
		if (Config.isMobile && !Config.hasPremium)
		{
			Debug.Log((object)("PremiumElementsChecker.goodForInterstitialAd(): " + PremiumElementsChecker.goodForInterstitialAd()));
			if (PremiumElementsChecker.goodForInterstitialAd())
			{
				if (PlayInterstitialAd.instance.isReady())
				{
					PlayInterstitialAd.instance.showAd();
					PremiumElementsChecker.setInterstitialAdTimer();
				}
				else
				{
					PlayInterstitialAd.instance.initAds();
				}
			}
		}
		action();
	}

	internal void startTransition(TransitionAction pAction)
	{
		Config.enableAutoRotation(pValue: false);
		action = pAction;
		((Component)bar).gameObject.SetActive(false);
		((Component)percents).gameObject.SetActive(false);
		((Component)topText).gameObject.SetActive(false);
		((Component)tipText).gameObject.SetActive(false);
		((Component)mask).gameObject.SetActive(false);
		((Component)this).gameObject.SetActive(true);
		canvasGroup.alpha = 0f;
		modeIn = true;
	}

	private void OnEnable()
	{
		string key = "loading_screen_" + Randy.randomInt(1, 22);
		topText.key = key;
		tipText.key = getTipID();
		topText.updateText();
		tipText.updateText();
		((Component)topText).gameObject.SetActive(true);
		((Component)tipText).gameObject.SetActive(true);
	}

	internal static string getTipID()
	{
		if (_max_tip == 0)
		{
			for (int i = 0; i < 1000 && LocalizedTextManager.stringExists(getTip(i)); i++)
			{
				_max_tip = i;
			}
		}
		int num = Randy.randomInt(0, _max_tip + 1);
		if (num == _last_tip)
		{
			return getTipID();
		}
		_last_tip = num;
		return getTip(num);
	}

	internal static string getTip(int pTip)
	{
		string pString = pTip.ToString();
		return "tip" + Toolbox.fillLeft(pString, 3, '0');
	}

	private void Update()
	{
		//IL_0142: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_017a: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c1: Unknown result type (might be due to invalid IL or missing references)
		if (!string.IsNullOrEmpty(SmoothLoader.latest_called_id))
		{
			loadingHelperText.text = SmoothLoader.latest_called_id + ":" + SmoothLoader.latest_time;
		}
		else
		{
			loadingHelperText.text = "";
		}
		if (inGameScreen)
		{
			if (modeIn)
			{
				if (canvasGroup.alpha >= 1f)
				{
					startAction();
				}
				CanvasGroup obj = canvasGroup;
				obj.alpha += Time.deltaTime * 2f;
				return;
			}
			if (outTimer > 0f)
			{
				outTimer -= Time.deltaTime;
				return;
			}
			if (canvasGroup.alpha <= 0f)
			{
				Config.enableAutoRotation(pValue: true);
				((Component)this).gameObject.SetActive(false);
			}
			if (!SmoothLoader.isLoading())
			{
				CanvasGroup obj2 = canvasGroup;
				obj2.alpha -= Time.fixedDeltaTime * 2f;
			}
			return;
		}
		if (!appearDone)
		{
			CanvasGroup obj3 = canvasGroup;
			obj3.alpha += Time.deltaTime;
			if (!(canvasGroup.alpha >= 1f))
			{
				return;
			}
			appearDone = true;
			((MonoBehaviour)this).StartCoroutine(LoadGame());
		}
		float num = ((Component)bar).transform.localScale.x;
		if (((Component)bar).transform.localScale.x < asyncLoad.progress)
		{
			num = ((Component)bar).transform.localScale.x + Time.deltaTime * 2f;
			if (num > asyncLoad.progress)
			{
				num = asyncLoad.progress;
			}
			((Component)bar).transform.localScale = new Vector3(num, 1f, 1f);
		}
		percents.text = Mathf.CeilToInt(asyncLoad.progress * 100f) + " %";
		if (num >= 0.9f)
		{
			if (!asyncLoad.allowSceneActivation)
			{
				Analytics.LogEvent("preloading_done");
			}
			asyncLoad.allowSceneActivation = true;
		}
	}

	private IEnumerator LoadGame()
	{
		asyncLoad = SceneManager.LoadSceneAsync("World");
		asyncLoad.allowSceneActivation = false;
		while (!asyncLoad.isDone)
		{
			yield return null;
		}
	}
}
// --- End of File: LoadingScreen.cs ---



// --- Start of File: LoadingScreenOut.cs ---
using UnityEngine;

public class LoadingScreenOut : MonoBehaviour
{
	public CanvasGroup canvasGroup;

	private void Update()
	{
		CanvasGroup obj = canvasGroup;
		obj.alpha -= Time.deltaTime * 2f;
		if (canvasGroup.alpha <= 0f)
		{
			((Component)this).gameObject.SetActive(false);
		}
	}
}
// --- End of File: LoadingScreenOut.cs ---



// --- Start of File: LoadingScreenSheepAnimation.cs ---
using UnityEngine;

public class LoadingScreenSheepAnimation : MonoBehaviour
{
	internal static float angle;

	private void Update()
	{
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		angle += Time.deltaTime * 20f;
		((Component)this).transform.localEulerAngles = new Vector3(0f, 0f, angle);
	}
}
// --- End of File: LoadingScreenSheepAnimation.cs ---



// --- Start of File: LoadWorldButton.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class LoadWorldButton : MonoBehaviour
{
	private void Start()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Expected O, but got Unknown
		Button val = default(Button);
		if (((Component)this).TryGetComponent<Button>(ref val))
		{
			((UnityEvent)val.onClick).AddListener(new UnityAction(loadWorld));
		}
	}

	private void loadWorld()
	{
		if (SaveManager.getCurrentMeta().saveVersion == 15)
		{
			ErrorWindow.errorMessage = "No, abandon it.";
			ScrollWindow.get("error_with_reason").clickShow();
		}
		else
		{
			ScrollWindow.showWindow("save_load_confirm");
		}
	}
}
// --- End of File: LoadWorldButton.cs ---



// --- Start of File: LocaleGetter.cs ---
public delegate string LocaleGetter();
// --- End of File: LocaleGetter.cs ---



// --- Start of File: LocaleGroupAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class LocaleGroupAsset : Asset
{
	public string[] libraries;

	public List<string> contains = new List<string>();

	public List<string> starts_with_priority = new List<string>();

	public List<string> starts_with = new List<string>();

	public List<string> matches = new List<string>();

	public LocaleGroupChecker checker;

	public Dictionary<string, string> locales = new Dictionary<string, string>();
}
// --- End of File: LocaleGroupAsset.cs ---



// --- Start of File: LocaleGroupChecker.cs ---
public delegate bool LocaleGroupChecker(string pKey);
// --- End of File: LocaleGroupChecker.cs ---



// --- Start of File: LocaleGroupLibrary.cs ---
using System.Collections.Generic;
using strings;

public class LocaleGroupLibrary : AssetLibrary<LocaleGroupAsset>
{
	private static Dictionary<string, LocaleGroupAsset> _already_found = new Dictionary<string, LocaleGroupAsset>();

	public override void init()
	{
		base.init();
		add(new LocaleGroupAsset
		{
			id = "achievements"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("achievement_groups", "achievements");
		t.starts_with.Add("achievement");
		add(new LocaleGroupAsset
		{
			id = "api_discord"
		});
		t.starts_with.Add("discordsocial");
		t.starts_with.Add("discord_");
		add(new LocaleGroupAsset
		{
			id = "api_steam"
		});
		t.starts_with_priority.Add("steam");
		t.starts_with.Add("promo_steam");
		add(new LocaleGroupAsset
		{
			id = "biomes"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("biome_library");
		add(new LocaleGroupAsset
		{
			id = "books"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("book_types_library");
		t.starts_with.Add("book");
		add(new LocaleGroupAsset
		{
			id = "debug"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("debug_tool_library", "tester_jobs", "tester_tasks");
		t.contains.Add("debug");
		t.starts_with.Add("search_by_");
		t.starts_with.Add("dt_");
		t.starts_with_priority.Add("tab_debug");
		add(new LocaleGroupAsset
		{
			id = "genes"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("chromosome_type_library", "gene_library");
		t.starts_with.Add("neuro");
		t.starts_with.Add("dna");
		t.starts_with.Add("gene");
		t.starts_with.Add("nucleo_");
		t.contains.Add("amplif");
		t.starts_with.Add("locus");
		t.starts_with.Add("chromosomes");
		t.starts_with.Add("sequence_synergy");
		add(new LocaleGroupAsset
		{
			id = "history"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("world_log_library", "history_groups");
		t.matches.Add("diplomacy_peace");
		t.starts_with.Add("race_dead_");
		add(new LocaleGroupAsset
		{
			id = "hotkeys"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("hotkey_library");
		t.starts_with.Add("hotkey_");
		add(new LocaleGroupAsset
		{
			id = "creatures"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("units");
		t.starts_with.Add("creature_statistics");
		add(new LocaleGroupAsset
		{
			id = "traits_units"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("traits", "trait_groups");
		add(new LocaleGroupAsset
		{
			id = "traits_cultures"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("culture_traits", "culture_trait_groups");
		add(new LocaleGroupAsset
		{
			id = "traits_languages"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("language_traits", "language_trait_groups");
		add(new LocaleGroupAsset
		{
			id = "traits_clans"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("clan_traits", "clan_trait_groups");
		add(new LocaleGroupAsset
		{
			id = "traits_subspecies"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("subspecies_traits", "subspecies_trait_groups");
		add(new LocaleGroupAsset
		{
			id = "traits_religions"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("religion_traits", "religion_trait_groups");
		add(new LocaleGroupAsset
		{
			id = "traits_kingdoms"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("kingdom_traits", "kingdom_trait_group");
		add(new LocaleGroupAsset
		{
			id = "meta_traits"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("rarity_library");
		t.contains.Add("trait");
		add(new LocaleGroupAsset
		{
			id = "meta_alliances"
		});
		t.starts_with.Add("alliance");
		t.starts_with.Add("unity_");
		t.starts_with.Add("whisper_");
		add(new LocaleGroupAsset
		{
			id = "meta_clans"
		});
		t.starts_with.Add("clan");
		add(new LocaleGroupAsset
		{
			id = "meta_religions"
		});
		t.starts_with.Add("religion");
		add(new LocaleGroupAsset
		{
			id = "meta_families"
		});
		t.starts_with.Add("families");
		add(new LocaleGroupAsset
		{
			id = "meta_cultures"
		});
		t.starts_with.Add("culture");
		add(new LocaleGroupAsset
		{
			id = "meta_languages"
		});
		t.starts_with_priority.Add("language");
		add(new LocaleGroupAsset
		{
			id = "meta_plots"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("plots", "plot_group");
		t.starts_with.Add("plot");
		t.starts_with.Add("can_be_done");
		add(new LocaleGroupAsset
		{
			id = "meta_subspecies"
		});
		t.starts_with.Add("subspecies");
		t.starts_with.Add("race");
		t.contains.Add("species");
		t.checker = delegate(string pKey)
		{
			if (typeof(S_SocialStructure).hasField(pKey))
			{
				return true;
			}
			return typeof(S_TaxonomyRank).hasField(pKey) ? true : false;
		};
		add(new LocaleGroupAsset
		{
			id = "meta_wars"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("war_types_library");
		t.matches.Add("war");
		t.starts_with.Add("war_");
		t.starts_with.Add("wars");
		t.starts_with.Add("attacke");
		t.starts_with.Add("defende");
		add(new LocaleGroupAsset
		{
			id = "metas"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("meta_customization_library", "knowledge_library");
		add(new LocaleGroupAsset
		{
			id = "happiness"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("happiness_library");
		add(new LocaleGroupAsset
		{
			id = "loyalty"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("loyalty_library");
		add(new LocaleGroupAsset
		{
			id = "opinion"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("opinion_library");
		add(new LocaleGroupAsset
		{
			id = "meta_reports"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("meta_text_report_library");
		add(new LocaleGroupAsset
		{
			id = "moods"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("architect_mood_library");
		t.starts_with.Add("mood_");
		t.starts_with.Add("architect_mood_");
		add(new LocaleGroupAsset
		{
			id = "onomastics"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("onomastics_library", "onomastics_evolution_library");
		t.matches.Add("naming_parts");
		t.matches.Add("naming_examples");
		t.matches.Add("group_editor");
		t.starts_with.Add("onomastic");
		add(new LocaleGroupAsset
		{
			id = "possession"
		});
		t.starts_with.Add("possession");
		t.starts_with.Add("crabzilla");
		add(new LocaleGroupAsset
		{
			id = "resources"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("resources");
		add(new LocaleGroupAsset
		{
			id = "powers"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("powers");
		t.starts_with.Add("Infinity Coin");
		add(new LocaleGroupAsset
		{
			id = "ui_options"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("options_library");
		t.matches.Add("resolution");
		t.matches.Add("additional_sounds");
		t.matches.Add("windowed_mode");
		t.starts_with.Add("setting");
		t.starts_with.Add("option_");
		t.starts_with_priority.Add("button_option");
		t.starts_with_priority.Add("graphics");
		t.starts_with.Add("username");
		add(new LocaleGroupAsset
		{
			id = "ui_tabs"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("power_tab_library");
		t.starts_with.Add("tab_");
		add(new LocaleGroupAsset
		{
			id = "base_stats"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("base_stats_library");
		add(new LocaleGroupAsset
		{
			id = "personalities"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("personalities");
		add(new LocaleGroupAsset
		{
			id = "statistics"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("graph_time_library", "history_data_library", "history_meta_data_library", "statistics_library");
		t.starts_with_priority.Add("chart_");
		t.starts_with_priority.Add("graph");
		t.starts_with_priority.Add("world_statistics_");
		t.starts_with_priority.Add("statistics_");
		t.contains.Add("_stat");
		add(new LocaleGroupAsset
		{
			id = "information"
		});
		t.matches.Add("loyalty_world_law");
		t.matches.Add("males_single");
		t.matches.Add("population_pyramid");
		t.matches.Add("status_waiting_for_passengers");
		t.matches.Add("task");
		t.matches.Add("total_deaths");
		t.matches.Add("total_knowledge");
		t.matches.Add("total_knowledge_info");
		t.matches.Add("total_population_money");
		t.matches.Add("upkeep_buildings");
		t.matches.Add("upkeep_homeless");
		t.matches.Add("yearly_gain");
		t.matches.Add("taxonomy_description_tooltip");
		t.matches.Add("vegetation");
		t.matches.Add("ownerless_item_info");
		t.matches.Add("ownerless_item_tip");
		t.matches.Add("capital");
		t.matches.Add("alpha");
		t.matches.Add("age");
		t.matches.Add("ages");
		t.matches.Add("amount");
		t.matches.Add("amount");
		t.matches.Add("ancestor_families");
		t.matches.Add("ancestor_family");
		t.matches.Add("area");
		t.matches.Add("best_friend");
		t.matches.Add("biggest_level");
		t.matches.Add("birthday");
		t.matches.Add("birthplace");
		t.matches.Add("carrying");
		t.matches.Add("couples");
		t.matches.Add("created");
		t.matches.Add("creator");
		t.matches.Add("creators_clan");
		t.matches.Add("creature");
		t.matches.Add("deity");
		t.matches.Add("deity");
		t.matches.Add("durability");
		t.matches.Add("fastest");
		t.matches.Add("females_single");
		t.matches.Add("fertility");
		t.matches.Add("food_consumed");
		t.matches.Add("founded");
		t.matches.Add("founded_in");
		t.matches.Add("founder");
		t.matches.Add("founder_clan");
		t.matches.Add("fullest");
		t.matches.Add("grandparents");
		t.matches.Add("great_clan_of");
		t.matches.Add("happiest");
		t.matches.Add("happy_units");
		t.matches.Add("happy_units_description");
		t.matches.Add("heir");
		t.matches.Add("home_village");
		t.matches.Add("house");
		t.matches.Add("hunger");
		t.matches.Add("hungriest");
		t.matches.Add("influence");
		t.matches.Add("instigator");
		t.matches.Add("instigator_from");
		t.matches.Add("inventory");
		t.matches.Add("level");
		t.matches.Add("lifespan_female");
		t.matches.Add("lifespan_male");
		t.matches.Add("locate");
		t.matches.Add("lover");
		t.matches.Add("max_age");
		t.matches.Add("max_children");
		t.matches.Add("members");
		t.matches.Add("mobs");
		t.matches.Add("nutrition");
		t.matches.Add("oldest");
		t.matches.Add("origin");
		t.matches.Add("origin_families");
		t.matches.Add("origin_family");
		t.matches.Add("parents");
		t.matches.Add("passengers");
		t.matches.Add("past_kings");
		t.matches.Add("past_leaders");
		t.matches.Add("resources");
		t.matches.Add("richest");
		t.matches.Add("ruler");
		t.matches.Add("ruler_money");
		t.matches.Add("saddest");
		t.matches.Add("sex");
		t.matches.Add("siblings");
		t.matches.Add("loot");
		t.matches.Add("smartest");
		t.matches.Add("speakers");
		t.matches.Add("started_at");
		t.matches.Add("started_by");
		t.matches.Add("status");
		t.matches.Add("statuses");
		t.matches.Add("strongest");
		t.matches.Add("tax");
		t.matches.Add("tribute");
		t.matches.Add("unhappy_units");
		t.matches.Add("unhappy_units_description");
		t.matches.Add("unit_age");
		t.matches.Add("unit_age_description");
		t.matches.Add("upkeep_army");
		t.matches.Add("year");
		t.matches.Add("year_era");
		t.matches.Add("years_ago");
		t.matches.Add("youngest");
		t.matches.Add("zone_range");
		t.matches.Add("zones");
		t.matches.Add("zones_description");
		t.matches.Add("residents");
		t.matches.Add("family_heads");
		t.matches.Add("family_members");
		t.starts_with.Add("most_");
		add(new LocaleGroupAsset
		{
			id = "status"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("status");
		add(new LocaleGroupAsset
		{
			id = "technologies"
		});
		t.starts_with.Add("tech_");
		add(new LocaleGroupAsset
		{
			id = "ui_brushes"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("brush_library");
		add(new LocaleGroupAsset
		{
			id = "ui_buttons"
		});
		t.starts_with.Add("button_");
		add(new LocaleGroupAsset
		{
			id = "ui_clicks"
		});
		t.starts_with.Add("click_");
		add(new LocaleGroupAsset
		{
			id = "ui_loading_screen"
		});
		t.starts_with.Add("loading_");
		add(new LocaleGroupAsset
		{
			id = "ui_new_world"
		});
		t.starts_with.Add("maptype");
		t.starts_with.Add("generat");
		t.starts_with.Add("custom_world");
		t.starts_with.Add("template_config");
		add(new LocaleGroupAsset
		{
			id = "ui_premium"
		});
		t.starts_with.Add("free_");
		t.starts_with.Add("ios_ad");
		t.starts_with.Add("ad_");
		t.starts_with.Add("waiting_for_ad");
		t.starts_with.Add("unlock_");
		t.starts_with.Add("prem_");
		t.starts_with.Add("premium_");
		t.starts_with.Add("restore");
		add(new LocaleGroupAsset
		{
			id = "ui_sort"
		});
		t.starts_with_priority.Add("sort_by_");
		t.starts_with_priority.Add("default_sort");
		add(new LocaleGroupAsset
		{
			id = "ui_speed"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("world_time_scales_library");
		add(new LocaleGroupAsset
		{
			id = "ui_tips"
		});
		t.starts_with.Add("tip_");
		add(new LocaleGroupAsset
		{
			id = "ui_tutorial"
		});
		t.starts_with.Add("tut_");
		add(new LocaleGroupAsset
		{
			id = "ui_worlds"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("map_sizes", "map_gen_templates", "map_gen_settings");
		t.matches.Add("world");
		t.matches.Add("worlds");
		t.matches.Add("your_world");
		t.matches.Add("your_worlds");
		t.matches.Add("no_world_found");
		t.matches.Add("name_your_world");
		t.matches.Add("describe_your_world");
		t.starts_with.Add("map_size");
		t.starts_with.Add("new_world");
		t.starts_with.Add("modded");
		t.starts_with.Add("mods_");
		t.starts_with.Add("save");
		t.starts_with.Add("load_");
		t.starts_with.Add("world_");
		t.starts_with.Add("create_worlds");
		t.starts_with.Add("future_save_version");
		add(new LocaleGroupAsset
		{
			id = "ui_windows"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("list_window_library");
		t.starts_with.Add("window_");
		t.starts_with.Add("title_");
		t.starts_with.Add("official_");
		t.starts_with.Add("community");
		t.starts_with.Add("facebook");
		t.starts_with.Add("link_");
		t.starts_with.Add("thank");
		t.starts_with.Add("ui_class_");
		t.starts_with.Add("under_development");
		add(new LocaleGroupAsset
		{
			id = "ui_workshop"
		});
		t.starts_with.Add("report");
		t.starts_with.Add("upload");
		t.starts_with.Add("workshop");
		t.starts_with.Add("sharing_your_world");
		t.starts_with.Add("world_uploaded");
		add(new LocaleGroupAsset
		{
			id = "ui_worldnet"
		});
		t.matches.Add("pasted_world_from_clipboard");
		t.matches.Add("your_account");
		t.matches.Add("logout");
		t.matches.Add("logging_in");
		t.matches.Add("email");
		t.matches.Add("missing_email");
		t.matches.Add("email_already_in_use");
		t.contains.Add("fav_error");
		t.contains.Add("authentication_error");
		t.contains.Add("worldnet");
		t.contains.Add("logout_");
		t.contains.Add("login");
		t.contains.Add("invalid");
		t.contains.Add("find_world");
		t.contains.Add("password");
		t.contains.Add("register");
		t.starts_with.Add("generic");
		t.starts_with.Add("getting_your");
		t.starts_with_priority.Add("load_a_world");
		t.starts_with_priority.Add("load_world_with_id");
		t.starts_with_priority.Add("welcome_worldnet");
		t.starts_with.Add("share_your_world");
		t.starts_with.Add("status_logged_in");
		t.starts_with_priority.Add("username_taken");
		t.starts_with_priority.Add("user_");
		t.starts_with_priority.Add("world_net");
		t.starts_with_priority.Add("worlds_max_maps_uploaded");
		t.starts_with_priority.Add("worlds_no");
		t.starts_with_priority.Add("worlds_error");
		t.starts_with_priority.Add("thank_you_for_your_report");
		t.starts_with_priority.Add("num_comments");
		t.starts_with_priority.Add("num_subscriptions");
		t.starts_with_priority.Add("num_upvotes");
		add(new LocaleGroupAsset
		{
			id = "ui_welcome"
		});
		t.starts_with_priority.Add("tip0");
		t.starts_with_priority.Add("update_");
		t.starts_with_priority.Add("feature_");
		t.starts_with.Add("vote");
		t.starts_with.Add("rate");
		t.starts_with.Add("welcome");
		t.starts_with.Add("your_heroes");
		add(new LocaleGroupAsset
		{
			id = "ui_general"
		});
		t.matches.Add("king");
		t.matches.Add("knowledge");
		t.matches.Add("knowledge_description");
		t.matches.Add("show_ui_description");
		t.matches.Add("translators");
		t.matches.Add("try_again");
		t.matches.Add("unlocks_goodie");
		t.matches.Add("unlocks_goodies");
		t.matches.Add("other");
		t.matches.Add("epic_items");
		t.matches.Add("disasters");
		t.matches.Add("description");
		t.matches.Add("help");
		t.matches.Add("about");
		t.matches.Add("browse_worlds");
		t.matches.Add("auto_saved_worlds");
		t.matches.Add("auto_saves_tip");
		t.matches.Add("auto_saves_tip_description");
		t.matches.Add("brush");
		t.matches.Add("cancel");
		t.matches.Add("canceled");
		t.matches.Add("changed_brush");
		t.matches.Add("changed_worldspeed");
		t.matches.Add("close");
		t.matches.Add("color");
		t.matches.Add("continue");
		t.matches.Add("copied_world_to_clipboard");
		t.matches.Add("date");
		t.matches.Add("delete");
		t.matches.Add("delete_confirmation");
		t.matches.Add("delete_confirmation_warning");
		t.matches.Add("downloads");
		t.matches.Add("enjoy_the_game");
		t.matches.Add("error_description");
		t.matches.Add("error_happened_logs");
		t.matches.Add("game_created_by");
		t.matches.Add("game_paused");
		t.matches.Add("game_unpaused");
		t.matches.Add("get_it");
		t.matches.Add("getting_worlds");
		t.matches.Add("go_back");
		t.matches.Add("history");
		t.matches.Add("leave_feedback");
		t.matches.Add("logs_folder");
		t.matches.Add("mouse_wheel");
		t.matches.Add("not_found");
		t.matches.Add("open_console");
		t.matches.Add("open_in_steam");
		t.matches.Add("open_workshop");
		t.matches.Add("patch_log");
		t.matches.Add("pause_ages");
		t.matches.Add("pause_ages_description");
		t.matches.Add("premium");
		t.matches.Add("press_for_next_tip");
		t.matches.Add("quit_game_desktop");
		t.matches.Add("reset");
		t.matches.Add("send_feedback");
		t.matches.Add("show_ui");
		t.matches.Add("short_on");
		t.matches.Add("short_off");
		t.matches.Add("sounds");
		t.matches.Add("sounds_ambient");
		t.matches.Add("load");
		t.matches.Add("actor_locked_tooltip_text_achievement");
		t.matches.Add("actor_locked_tooltip_text_exploration");
		t.matches.Add("news");
		t.matches.Add("outdated_version");
		t.matches.Add("overview");
		t.matches.Add("warning");
		t.matches.Add("stats");
		t.matches.Add("statistics");
		t.matches.Add("special_thanks");
		t.matches.Add("slot");
		t.matches.Add("plays");
		t.matches.Add("empty_dead_list");
		t.matches.Add("empty_non_sapient_list");
		t.matches.Add("empty_sapient_list");
		t.matches.Add("infinity_coin_used");
		t.matches.Add("watch_ad");
		t.matches.Add("play_now");
		t.starts_with.Add("news_");
		add(new LocaleGroupAsset
		{
			id = "world_ages"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("month_library", "era_library");
		t.matches.Add("randomize_ages");
		t.matches.Add("randomize_ages_description");
		t.starts_with.Add("next_age_");
		t.starts_with.Add("age_");
		t.starts_with.Add("ages_");
		t.starts_with.Add("all_ages");
		t.starts_with_priority.Add("world_age");
		add(new LocaleGroupAsset
		{
			id = "world_laws"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("world_laws_library", "world_law_groups");
		t.starts_with_priority.Add("forbidden_knowledg");
		t.starts_with_priority.Add("world_curse");
		t.starts_with_priority.Add("world_law");
		add(new LocaleGroupAsset
		{
			id = "unit_tasks"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("decisions_library", "beh_actor", "job_actor");
		add(new LocaleGroupAsset
		{
			id = "mind"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("neural_layer_library");
		t.contains.Add("toggle_all_neurons");
		t.contains.Add("toggle_all_neurons_description");
		add(new LocaleGroupAsset
		{
			id = "favorites"
		});
		t.contains.Add("favorite");
		add(new LocaleGroupAsset
		{
			id = "items"
		});
		t.libraries = AssetLibrary<LocaleGroupAsset>.a<string>("items", "items_modifiers", "item_groups");
		t.starts_with.Add("item_");
		t.contains.Add("equipment");
		add(new LocaleGroupAsset
		{
			id = "kingdoms"
		});
		t.contains.Add("_kingdom_");
		t.starts_with.Add("kingdom");
		t.starts_with.Add("village");
		add(new LocaleGroupAsset
		{
			id = "_others"
		});
	}

	public override void editorDiagnostic()
	{
	}
}
// --- End of File: LocaleGroupLibrary.cs ---



// --- Start of File: LocalizationButton.cs ---
using System;
using UnityEngine;
using UnityEngine.UI;

public class LocalizationButton : MonoBehaviour
{
	public Sprite button_current;

	public Sprite button_normal;

	public Sprite button_highlight;

	[SerializeField]
	private Image _icon;

	[SerializeField]
	private Image _bg_image;

	[SerializeField]
	private Button _button;

	[SerializeField]
	private Text _text_field;

	private TipButton _tip_button;

	private LocalizedText _localized_text;

	[SerializeField]
	private Text _percent;

	private GameLanguageAsset _asset;

	private bool _initialized;

	public GameLanguageAsset getAsset()
	{
		return _asset;
	}

	private void init()
	{
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		//IL_0142: Unknown result type (might be due to invalid IL or missing references)
		//IL_014c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		if (_initialized)
		{
			return;
		}
		_initialized = true;
		_localized_text = ((Component)_text_field).GetComponent<LocalizedText>();
		_tip_button = ((Component)_button).GetComponent<TipButton>();
		_tip_button.hoverAction = delegate
		{
			if (InputHelpers.mouseSupported)
			{
				showTooltip();
			}
		};
		TipButton tip_button = _tip_button;
		tip_button.clickAction = (TooltipAction)Delegate.Combine(tip_button.clickAction, (TooltipAction)delegate
		{
			if (InputHelpers.mouseSupported)
			{
				changeLanguage();
			}
			else if (Tooltip.isShowingFor(this))
			{
				changeLanguage();
			}
			else
			{
				showTooltip();
			}
		});
		((Object)((Component)this).gameObject).name = _asset.id;
		if (_asset.path_icon != null)
		{
			_icon.sprite = SpriteTextureLoader.getSprite(_asset.path_icon);
			((Component)_icon).gameObject.SetActive(true);
			RectTransform component = ((Component)_text_field).GetComponent<RectTransform>();
			component.offsetMin = new Vector2(18.5f, component.offsetMin.y);
			component.offsetMax = new Vector2(-4f, component.offsetMax.y);
		}
		else
		{
			((Component)_icon).gameObject.SetActive(false);
			RectTransform component2 = ((Component)_text_field).GetComponent<RectTransform>();
			component2.offsetMin = new Vector2(4f, component2.offsetMin.y);
			component2.offsetMax = new Vector2(-4f, component2.offsetMax.y);
		}
		_text_field.text = _asset.name;
		_localized_text.checkSpecialLanguages(_asset);
	}

	private void showTooltip()
	{
		TooltipData pData = new TooltipData
		{
			game_language_asset = _asset
		};
		Tooltip.show(this, "game_language", pData);
	}

	private void changeLanguage()
	{
		LocalizedTextManager.instance.setLanguage(_asset.id);
		WorldLanguagesWindow.updateButtons();
	}

	internal void checkSprite()
	{
		if (LocalizedTextManager.current_language == _asset)
		{
			_bg_image.sprite = button_current;
		}
		else if (LocalizedTextManager.getCulture(((Object)((Component)((Component)this).transform).gameObject).name) == LocalizedTextManager.getCurrentCulture())
		{
			_bg_image.sprite = button_highlight;
		}
		else
		{
			_bg_image.sprite = button_normal;
		}
	}

	public void SetAsset(GameLanguageAsset pAsset, int pDone)
	{
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		_asset = pAsset;
		if (pDone > 0)
		{
			if (pDone < 40)
			{
				((Graphic)_percent).color = Toolbox.color_negative_RGBA;
			}
			else if (pDone < 60)
			{
				((Graphic)_percent).color = Toolbox.color_log_warning;
			}
			else if (pDone < 80)
			{
				((Graphic)_percent).color = Toolbox.color_text_default;
			}
			else
			{
				((Graphic)_percent).color = Toolbox.color_positive_RGBA;
			}
			_percent.text = pDone + "%";
			((Component)_percent).gameObject.SetActive(true);
		}
		else
		{
			((Component)_percent).gameObject.SetActive(false);
		}
		init();
		checkSprite();
	}
}
// --- End of File: LocalizationButton.cs ---



// --- Start of File: LocalizedText.cs ---
using System.Collections.Generic;
using System.Text.RegularExpressions;
using UPersian.Utils;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

public class LocalizedText : UIBehaviour
{
	public const string DEFAULT_KEY = "??????";

	protected const char LINE_ENDING = '\n';

	public bool convertToUppercase;

	public bool autoField = true;

	public bool specialTags;

	public string key = "??????";

	private FontStyle? _font_style_before;

	private bool? _shadow_before = false;

	private bool _has_shadow;

	internal Text text;

	private TextAnchor? _text_alignment_before;

	protected override void Awake()
	{
		((UIBehaviour)this).Awake();
		text = ((Component)this).GetComponent<Text>();
	}

	protected override void Start()
	{
		((UIBehaviour)this).Start();
		if (autoField)
		{
			LocalizedTextManager.addTextField(this);
			updateText();
		}
	}

	public void setKeyAndUpdate(string pKey)
	{
		key = pKey;
		updateText();
	}

	protected override void OnRectTransformDimensionsChange()
	{
		GameLanguageAsset current_language = LocalizedTextManager.current_language;
		if ((current_language == null || current_language.isRTL()) && !string.IsNullOrEmpty(key) && !(key == "??????") && !((Object)(object)text == (Object)null))
		{
			updateText();
			((UIBehaviour)this).OnRectTransformDimensionsChange();
		}
	}

	internal virtual void updateText(bool pCheckText = true)
	{
		if ((Object)(object)this.text == (Object)null || LocalizedTextManager.instance == null || !LocalizedTextManager.instance.initiated)
		{
			return;
		}
		if ((Object)(object)LocalizedTextManager.current_font != (Object)null)
		{
			this.text.font = LocalizedTextManager.current_font;
		}
		string text = LocalizedTextManager.getText(key, this.text);
		if (convertToUppercase)
		{
			text = text.ToUpper();
		}
		if (specialTags && text.Contains("$"))
		{
			if (text.Contains("$total_prem_powers$"))
			{
				text = text.Replace("$total_prem_powers$", GodPower.premium_powers.Count.ToString() ?? "");
			}
			if (text.Contains("$minutes$"))
			{
				text = text.Replace("$minutes$", 30.ToString() ?? "");
			}
			if (text.Contains("$minutes_clock$"))
			{
				text = text.Replace("$minutes_clock$", 720.ToString() ?? "");
			}
			if (text.Contains("$hours_clock$"))
			{
				text = text.Replace("$hours_clock$", 12.ToString() ?? "");
			}
			if (text.Contains("$power$") && Config.power_to_unlock != null)
			{
				text = text.Replace("$power$", Config.power_to_unlock.getLocaleID().Localize() ?? "");
			}
			if (text.Contains("$hours$"))
			{
				text = text.Replace("$hours$", 3.ToString() ?? "");
			}
			if (text.Contains("$number$"))
			{
				text = text.Replace("$number$", 3.ToString() ?? "");
			}
			if (text.Contains("$discord_count$"))
			{
				text = text.Replace("$discord_count$", 560000.ToText() ?? "");
			}
			if (text.Contains("$wbcode$"))
			{
				text = text.Replace("$wbcode$", "<color=cyan>WB-5555-1166-5555</color>");
			}
			if (text.Contains("$lifeissimhours$"))
			{
				text = text.Replace("$lifeissimhours$", 24f.ToText());
			}
			if (text.Contains("$current_era_year"))
			{
				text = text.Replace("$current_era_year$", Date.getCurrentYear().ToText());
			}
			if (text.Contains("$era_moons_left"))
			{
				int pInt = World.world.era_manager.calculateMoonsLeft();
				text = text.Replace("$era_moons_left$", pInt.ToText());
			}
		}
		this.text.text = text;
		checkTextFont();
		if (pCheckText)
		{
			checkSpecialLanguages();
		}
	}

	internal void checkTextFont(GameLanguageAsset pLanguage = null)
	{
		if (!((Object)(object)text == (Object)null))
		{
			if (pLanguage == null)
			{
				pLanguage = LocalizedTextManager.current_language;
			}
			Font val = pLanguage.font();
			if (!((Object)(object)val == (Object)null))
			{
				text.font = val;
			}
		}
	}

	internal void checkSpecialLanguages(GameLanguageAsset pLanguage = null)
	{
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01be: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)text == (Object)null)
		{
			return;
		}
		if (pLanguage == null)
		{
			pLanguage = LocalizedTextManager.current_language;
		}
		checkTextFont(pLanguage);
		if (!_text_alignment_before.HasValue)
		{
			_text_alignment_before = text.alignment;
		}
		if (!_font_style_before.HasValue)
		{
			_font_style_before = text.fontStyle;
		}
		if (!_shadow_before.HasValue)
		{
			_shadow_before = (_has_shadow = ((Component)(object)text).HasComponent<Shadow>());
		}
		if (pLanguage.hasForcedStyle())
		{
			text.fontStyle = pLanguage.force_style.style;
			if (text.fontSize < 9 && pLanguage.force_style.shadow && !_has_shadow)
			{
				((Component)text).gameObject.AddComponent<Shadow>().effectColor = new Color(0f, 0f, 0f, 160f);
				_has_shadow = true;
			}
		}
		else
		{
			text.fontStyle = _font_style_before.Value;
			if (_has_shadow && _shadow_before == false)
			{
				Shadow val = default(Shadow);
				if (((Component)text).TryGetComponent<Shadow>(ref val))
				{
					Object.Destroy((Object)(object)val);
				}
				_has_shadow = false;
			}
		}
		if (pLanguage.isRTL())
		{
			text.text = getRTLText(text, text.text);
			text.alignment = getRTLAlignment(_text_alignment_before.Value);
		}
		else
		{
			text.alignment = _text_alignment_before.Value;
		}
		if (pLanguage.isHindi() && !Regex.IsMatch(text.text, "[a-zA-Z]"))
		{
			text.SetHindiText(text.text);
		}
	}

	internal static string getRTLText(Text pText, string pString)
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		TextGenerator cachedTextGenerator = pText.cachedTextGenerator;
		Rect rect = ((Graphic)pText).rectTransform.rect;
		cachedTextGenerator.Populate(pString, pText.GetGenerationSettings(((Rect)(ref rect)).size));
		if (!(pText.cachedTextGenerator.lines is List<UILineInfo> list))
		{
			return null;
		}
		string text = "";
		if (list.Count == 0)
		{
			text = pString;
		}
		for (int i = 0; i < list.Count; i++)
		{
			if (i < list.Count - 1)
			{
				int startCharIdx = list[i].startCharIdx;
				int length = list[i + 1].startCharIdx - list[i].startCharIdx;
				text += pString.Substring(startCharIdx, length);
				if (text.Length > 0 && text[text.Length - 1] != '\n' && text[text.Length - 1] != '\r')
				{
					text += "\n";
				}
			}
			else
			{
				text += pString.Substring(list[i].startCharIdx);
			}
		}
		UPersianUtils.RtlFix(ref text);
		return text;
	}

	internal TextAnchor getRTLAlignment(TextAnchor pTextAlignment)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Invalid comparison between Unknown and I4
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Invalid comparison between Unknown and I4
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Invalid comparison between Unknown and I4
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Invalid comparison between Unknown and I4
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Invalid comparison between Unknown and I4
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		if ((int)pTextAlignment == 0)
		{
			return (TextAnchor)2;
		}
		if ((int)pTextAlignment == 2)
		{
			return (TextAnchor)0;
		}
		if ((int)pTextAlignment == 3)
		{
			return (TextAnchor)5;
		}
		if ((int)pTextAlignment == 5)
		{
			return (TextAnchor)3;
		}
		if ((int)pTextAlignment == 6)
		{
			return (TextAnchor)8;
		}
		if ((int)pTextAlignment == 8)
		{
			return (TextAnchor)6;
		}
		return pTextAlignment;
	}
}
// --- End of File: LocalizedText.cs ---



// --- Start of File: LocalizedTextManager.cs ---
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Text;
using Newtonsoft.Json;
using Proyecto26;
using UnityEngine;
using UnityEngine.UI;

public class LocalizedTextManager
{
	private const string MISSING_LOCALE = "LOC_ER";

	private static List<string> _all_languages;

	private static List<string> _changed_languages;

	public static LocalizedTextManager instance;

	private static readonly Dictionary<string, string> _boat_strings = new Dictionary<string, string>();

	public static GameLanguageAsset current_language;

	private bool _lang_dirty;

	private Dictionary<string, string> _localized_text;

	private Dictionary<string, string> _localized_text_files;

	private Font _default_font;

	private Font _hindi_font;

	private Font _japanese_font;

	private Font _korean_font;

	private Font _arabic_font;

	private Font _persian_font;

	private Font _simplified_chinese_font;

	private Font _thai_font;

	public Font default_font;

	internal bool initiated;

	internal string language = "not_set";

	internal List<LocalizedText> texts;

	public static Font current_font => current_language?.font?.Invoke() ?? instance.default_font;

	public Font hindi_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_hindi_font == null)
			{
				_hindi_font = (Font)Resources.Load("Fonts/Poppins-Regular", typeof(Font));
			}
			return _hindi_font;
		}
	}

	public Font japanese_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_japanese_font == null)
			{
				_japanese_font = (Font)Resources.Load("Fonts/MPLUSRounded1c-Medium", typeof(Font));
			}
			return _japanese_font;
		}
	}

	public Font korean_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_korean_font == null)
			{
				_korean_font = (Font)Resources.Load("Fonts/NanumGothicCoding-Bold", typeof(Font));
			}
			return _korean_font;
		}
	}

	public Font persian_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_persian_font == null)
			{
				_persian_font = (Font)Resources.Load("Fonts/Vazirmatn-Bold", typeof(Font));
			}
			return _persian_font;
		}
	}

	public Font arabic_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_arabic_font == null)
			{
				_arabic_font = (Font)Resources.Load("Fonts/Tajawal-Bold", typeof(Font));
			}
			return _arabic_font;
		}
	}

	public Font simplified_chinese_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_simplified_chinese_font == null)
			{
				_simplified_chinese_font = (Font)Resources.Load("Fonts/NotoSansCJKsc-Bold", typeof(Font));
			}
			return _simplified_chinese_font;
		}
	}

	public Font thai_font
	{
		get
		{
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Expected O, but got Unknown
			if (_thai_font == null)
			{
				_thai_font = (Font)Resources.Load("Fonts/krubbold", typeof(Font));
			}
			return _thai_font;
		}
	}

	public static void init(string pLanguage = null)
	{
		if (instance == null)
		{
			instance = new LocalizedTextManager();
			instance.create();
			if (pLanguage == null)
			{
				pLanguage = PlayerConfig.dict["language"].stringVal;
			}
			instance.setLanguage(pLanguage);
		}
	}

	private void create()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Expected O, but got Unknown
		default_font = (Font)Resources.Load("Fonts/Roboto-Bold", typeof(Font));
		instance = this;
		texts = new List<LocalizedText>();
	}

	public bool contains(string pString)
	{
		return instance._localized_text.ContainsKey(pString);
	}

	public static IEnumerable<string> getKeys()
	{
		return instance._localized_text.Keys;
	}

	public static void addTextField(LocalizedText pText)
	{
		instance.texts.Add(pText);
		instance._lang_dirty = true;
	}

	public static void removeTextField(LocalizedText pText)
	{
		if (instance != null)
		{
			instance.texts.Remove(pText);
		}
	}

	public static void updateTexts()
	{
		Debug.Log((object)("LocalizedTextManager: total texts loaded: " + instance.texts.Count));
		foreach (LocalizedText text in instance.texts)
		{
			text.updateText();
		}
	}

	public static bool stringExists(string pKey)
	{
		if (string.IsNullOrEmpty(pKey))
		{
			return false;
		}
		if (instance._localized_text.ContainsKey(pKey))
		{
			return true;
		}
		return false;
	}

	public static string getText(string pKey, Text text = null, bool pForceEnglish = false)
	{
		if (instance.language == "boat")
		{
			return transformToBoat(pKey);
		}
		if (instance.language == "keys")
		{
			return transformToKeys(pKey);
		}
		string text2;
		if (instance._localized_text.ContainsKey(pKey))
		{
			text2 = instance._localized_text[pKey];
		}
		else
		{
			text2 = pKey;
			if (pKey.Contains("_placeholder"))
			{
				text2 = "";
			}
			else if (AssetManager.missing_locale_keys.Add(pKey))
			{
				Debug.LogError((object)("LocalizedTextManager: missing text: " + pKey), (Object)(object)text);
				AssetManager.generateMissingLocalesFile();
			}
		}
		if (pKey.StartsWith("world_law_", StringComparison.Ordinal))
		{
			text2 = text2.Replace("\n\n", "\n");
		}
		return text2;
	}

	public static string transformToKeys(string pTextKey)
	{
		string text = string.Empty;
		if (instance._localized_text_files.ContainsKey(pTextKey))
		{
			text = instance._localized_text_files[pTextKey];
		}
		return text + ": " + pTextKey;
	}

	public static string transformToBoat(string pTextKey)
	{
		if (_boat_strings.ContainsKey(pTextKey))
		{
			return _boat_strings[pTextKey];
		}
		int num = pTextKey.Split(' ').Length + 1;
		string text = "";
		for (int i = 0; i < num; i++)
		{
			if (text.Length > 0)
			{
				text += " ";
			}
			text = ((!Randy.randomBool()) ? ((!Randy.randomBool()) ? ((!Randy.randomBool()) ? (text + "ye") : (text + "boat")) : (text + "Ahoy")) : ((!Randy.randomBool()) ? ((!Randy.randomBool()) ? (text + "Argh") : (text + "Aye")) : (text + "Boat")));
		}
		_boat_strings[pTextKey] = text;
		return _boat_strings[pTextKey];
	}

	public void loadLocalizedText(string pLocaleID)
	{
		initiated = true;
		instance._localized_text = new Dictionary<string, string>();
		instance._localized_text_files = new Dictionary<string, string>();
		string text = "locales/" + pLocaleID;
		TextAsset[] array;
		try
		{
			array = Resources.LoadAll<TextAsset>(text);
		}
		catch (Exception)
		{
			array = Resources.LoadAll<TextAsset>("locales/en");
		}
		if (array == null || array.Length == 0)
		{
			array = Resources.LoadAll<TextAsset>("locales/en");
		}
		TextAsset[] array2 = array;
		foreach (TextAsset obj in array2)
		{
			string text2 = obj.text;
			string name = ((Object)obj).name;
			Dictionary<string, string> dictionary = JsonConvert.DeserializeObject<Dictionary<string, string>>(text2);
			foreach (string key in dictionary.Keys)
			{
				add(key, dictionary[key], pReplace: false, name, pCheckForCharacters: false);
			}
		}
	}

	public static void add(string pKey, string pTranslation, bool pReplace = false, string pFileName = "", bool pCheckForCharacters = true)
	{
		pKey = pKey.Underscore();
		if (!pReplace && instance._localized_text.ContainsKey(pKey))
		{
			if (instance._localized_text[pKey] == pTranslation)
			{
				Debug.LogWarning((object)("Skipped - already exists - " + pKey + " - exists : " + pTranslation));
				return;
			}
			Debug.LogError((object)("Already exists - " + pKey + " - exists : " + instance._localized_text[pKey]));
			Debug.LogError((object)("Already exists - " + pKey + " - skipped: " + pTranslation));
		}
		else
		{
			instance._localized_text[pKey] = pTranslation;
			instance._localized_text_files[pKey] = pFileName;
		}
	}

	public void setLanguage(string pLanguage)
	{
		if (!(language == pLanguage) || _lang_dirty)
		{
			_lang_dirty = false;
			Debug.Log((object)("LOAD LANGUAGE " + pLanguage));
			string text = string.Concat("locales/" + pLanguage, "/creatures");
			if (pLanguage != "boat" && pLanguage != "keys" && Resources.Load(text) == null)
			{
				pLanguage = PlayerConfig.detectLanguage();
			}
			bool flag = false;
			if (language != "not_set")
			{
				flag = true;
			}
			language = pLanguage;
			instance.loadLocalizedText(pLanguage);
			try
			{
				RestClient.DefaultRequestHeaders["wb-language"] = language ?? "na";
			}
			catch (Exception)
			{
			}
			current_language = AssetManager.game_language_library.get(language);
			DebugLocales.init();
			updateTexts();
			if (PlayerConfig.dict["language"].stringVal != pLanguage)
			{
				flag = true;
			}
			PlayerConfig.dict["language"].stringVal = pLanguage;
			if (flag)
			{
				PlayerConfig.saveData();
			}
		}
	}

	public static string langToCulture(string pLanguage = null)
	{
		if (pLanguage == null)
		{
			pLanguage = instance.language;
		}
		string text = pLanguage;
		if (text == "boat")
		{
			return "";
		}
		if (text == "keys")
		{
			return "";
		}
		if (text == "lb")
		{
			return "lb-LU";
		}
		if (text == "ka")
		{
			return "ka-GE";
		}
		if (text == "gr")
		{
			return "el-GR";
		}
		return text switch
		{
			"hr" => "hr-HR", 
			"by" => "be-BY", 
			"ch" => "zh-Hant", 
			"cz" => "zh-Hans", 
			"fn" => "fi-FI", 
			"ph" => "fil-PH", 
			"gr" => "fi", 
			"br" => "pt", 
			"ko" => "ko-KR", 
			"th" => "th-TH", 
			"ua" => "uk", 
			"no" => "nb-NO", 
			"lt" => "lt", 
			"vn" => "vi", 
			_ => text, 
		};
	}

	public static CultureInfo getCulture(string pLanguage = null)
	{
		string text = langToCulture(pLanguage);
		if (text != "")
		{
			try
			{
				return new CultureInfo(text);
			}
			catch (CultureNotFoundException)
			{
				return CultureInfo.CurrentCulture;
			}
		}
		return CultureInfo.CurrentCulture;
	}

	public static CultureInfo getCurrentCulture()
	{
		return CultureInfo.CurrentCulture;
	}

	public static bool cultureSupported()
	{
		switch (instance.language)
		{
		case "boat":
		case "hi":
		case "by":
		case "ka":
		case "lb":
			return false;
		default:
			return true;
		}
	}

	public static List<string> getAllLanguages()
	{
		if (_all_languages == null)
		{
			_all_languages = new List<string>();
			TextAsset[] array = Resources.LoadAll<TextAsset>("locales");
			foreach (TextAsset val in array)
			{
				_all_languages.Add(((Object)val).name);
			}
		}
		return _all_languages;
	}

	public static List<string> getAllLanguagesWithChanges()
	{
		if (_changed_languages == null)
		{
			_changed_languages = new List<string>();
			int num = 10;
			TextAsset[] array = Resources.LoadAll<TextAsset>("locales");
			foreach (TextAsset val in array)
			{
				string name = ((Object)val).name;
				string screenshotFolder = TesterBehScreenshotFolder.getScreenshotFolder(name);
				if (name == "boat" || name == "keys")
				{
					continue;
				}
				if (File.Exists(screenshotFolder + "/" + name + ".json"))
				{
					string text = File.ReadAllText(screenshotFolder + "/" + name + ".json", Encoding.UTF8);
					string text2 = val.text;
					Debug.Log((object)(text2.Length + " vs " + text.Length));
					if (text == text2)
					{
						Debug.Log((object)("Language " + name + " has no changes"));
						continue;
					}
					Debug.Log((object)("Language " + name + " has changes"));
					File.Delete(screenshotFolder + "/" + name + ".json");
				}
				_changed_languages.Add(name);
				if (_changed_languages.Count >= num)
				{
					break;
				}
			}
		}
		return _changed_languages;
	}
}
// --- End of File: LocalizedTextManager.cs ---



// --- Start of File: LocalizedTextPrice.cs ---
using UnityEngine;
using UnityEngine.Purchasing;
using UnityEngine.UI;

public class LocalizedTextPrice : MonoBehaviour
{
	public static string price_current = "???";

	public static string price_old = string.Empty;

	public static string discount = string.Empty;

	public Text text_old_price;

	public Text text_current_price;

	public GameObject discount_bg;

	public Text text_percent;

	private const string IN_APP_ID = "premium";

	internal void updateText(bool pCheckText = true)
	{
		if (!string.IsNullOrEmpty(discount))
		{
			showDiscount(discount);
		}
		string text = "";
		if ((Object)(object)InAppManager.instance != (Object)null)
		{
			InAppManager instance = InAppManager.instance;
			object obj;
			if (instance == null)
			{
				obj = null;
			}
			else
			{
				IStoreController controller = instance.controller;
				obj = ((controller != null) ? controller.products : null);
			}
			if (obj != null)
			{
				Product val = InAppManager.instance.controller.products.WithID("premium");
				if (val != null)
				{
					text = val.metadata.localizedPriceString;
				}
				goto IL_007a;
			}
		}
		text = price_current;
		goto IL_007a;
		IL_007a:
		text_current_price.text = text;
		if (!string.IsNullOrEmpty(price_old))
		{
			text_old_price.text = price_old;
			((Component)text_old_price).gameObject.SetActive(true);
		}
	}

	private void showDiscount(string pString)
	{
		text_percent.text = pString;
		discount_bg.gameObject.SetActive(true);
	}

	private void setDefault()
	{
		discount_bg.gameObject.SetActive(false);
		((Component)text_current_price).gameObject.SetActive(true);
		text_current_price.text = "??";
		((Component)text_old_price).gameObject.SetActive(false);
	}

	private void OnEnable()
	{
		setDefault();
		updateText();
	}
}
// --- End of File: LocalizedTextPrice.cs ---



// --- Start of File: LocusClickEvent.cs ---
public delegate void LocusClickEvent(LocusElement pLocusElement);
// --- End of File: LocusClickEvent.cs ---



// --- Start of File: LocusDot.cs ---
using UnityEngine;
using UnityEngine.UI;

public class LocusDot : MonoBehaviour
{
	[SerializeField]
	private Image _status;

	internal Image status => _status;

	public void colorDot(Color pColor)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		((Graphic)_status).color = pColor;
	}

	public void colorDot(char pGeneticCode)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		colorDot(NucleobaseHelper.getColor(pGeneticCode));
	}
}
// --- End of File: LocusDot.cs ---



// --- Start of File: LocusElement.cs ---
using System;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class LocusElement : ChainElement, IDropHandler, IEventSystemHandler
{
	private Chromosome _chromosome;

	private LocusClickEvent _locus_click_event;

	private Action _chromosome_updated_event;

	private LocusType locus_type;

	public Image sprite_background;

	public Image effect_amplifier;

	public Image effect_locus_amplifier_bad;

	public Sprite sprite_locus_bg_normal;

	public Sprite sprite_locus_bg_synergy;

	public Sprite sprite_locus_bg_bad;

	[SerializeField]
	private LocusDot _dot_left;

	[SerializeField]
	private LocusDot _dot_right;

	[SerializeField]
	private LocusDot _dot_up;

	[SerializeField]
	private LocusDot _dot_down;

	private float _normal_size = 0.8f;

	private float _super_size = 0.8f;

	private int _locus_x;

	private int _locus_y;

	private SpriteAnimation _animation_amplifier;

	private SpriteAnimation _animation_amplifier_bad;

	[SerializeField]
	private GeneButton _gene_button;

	protected override void create()
	{
		base.create();
		is_editor_button = false;
		_animation_amplifier = ((Component)effect_amplifier).GetComponent<SpriteAnimation>();
		_animation_amplifier_bad = ((Component)effect_locus_amplifier_bad).GetComponent<SpriteAnimation>();
	}

	protected override void Update()
	{
		base.Update();
		if (isAmplifier())
		{
			if (((Behaviour)_animation_amplifier).isActiveAndEnabled)
			{
				_animation_amplifier.update(Time.deltaTime);
			}
			if (((Behaviour)_animation_amplifier_bad).isActiveAndEnabled)
			{
				_animation_amplifier_bad.update(Time.deltaTime);
			}
		}
	}

	private void click()
	{
		if (base.gene.can_drop_and_grab)
		{
			_locus_click_event(this);
			checkSprite();
			if (!InputHelpers.mouseSupported)
			{
				((Component)this).GetComponent<TipButton>().hoverAction();
			}
		}
	}

	private void clearLocus()
	{
		_locus_click_event(null);
		checkSprite();
	}

	private void checkSprite()
	{
		//IL_0150: Unknown result type (might be due to invalid IL or missing references)
		//IL_0160: Expected O, but got Unknown
		//IL_01a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0180: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		bool num = isEmptyLocus();
		bool flag = isAmplifier();
		bool active = !num && !flag;
		bool flag2 = _chromosome.isNextToBad(_locus_x, _locus_y);
		if (flag)
		{
			if (flag2)
			{
				((Component)effect_amplifier).gameObject.SetActive(false);
				((Component)effect_locus_amplifier_bad).gameObject.SetActive(true);
			}
			else
			{
				((Component)effect_amplifier).gameObject.SetActive(true);
				((Component)effect_locus_amplifier_bad).gameObject.SetActive(false);
			}
		}
		else
		{
			((Component)effect_amplifier).gameObject.SetActive(false);
			((Component)effect_locus_amplifier_bad).gameObject.SetActive(false);
		}
		if (shouldBeBadLocus())
		{
			sprite_background.sprite = sprite_locus_bg_bad;
		}
		else if (shouldBeGoldenLocus())
		{
			sprite_background.sprite = sprite_locus_bg_synergy;
		}
		else
		{
			sprite_background.sprite = sprite_locus_bg_normal;
		}
		((Component)sprite_background).gameObject.SetActive(active);
		checkChainsColors();
		if (num || flag)
		{
			((Component)_gene_button).gameObject.SetActive(false);
		}
		else
		{
			((Component)_gene_button).gameObject.SetActive(true);
			_gene_button.load(base.gene);
			_gene_button.is_editor_button = true;
			_gene_button.locusChild(new UnityAction(click), locus_index);
		}
		if (isAmplifier())
		{
			((Component)this).transform.localScale = new Vector3(_super_size, _super_size, _super_size);
		}
		else
		{
			((Component)this).transform.localScale = new Vector3(_normal_size, _normal_size, _normal_size);
		}
		((Component)this).GetComponent<TipButton>().setDefaultScale(((Component)this).transform.localScale);
	}

	private bool shouldBeBadChainSide(int pX, int pY, int pOffsetX, int pOffsetY)
	{
		return shouldBeBadChain(pX, pY, pX + pOffsetX, pY + pOffsetY);
	}

	private bool shouldBeBadChain(int pX, int pY, int pToX, int pToY)
	{
		if (base.gene.is_bad)
		{
			return true;
		}
		GeneAsset geneAt = _chromosome.getGeneAt(pToX, pToY);
		if (geneAt != null && geneAt.is_bad)
		{
			return true;
		}
		if (_chromosome.hasAmplifierBad(pX, pY))
		{
			return true;
		}
		if (_chromosome.hasAmplifierBad(pToX, pToY))
		{
			return true;
		}
		return false;
	}

	private void checkChainsColors()
	{
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_015a: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_027a: Unknown result type (might be due to invalid IL or missing references)
		int locus_x = _locus_x;
		int locus_y = _locus_y;
		Chromosome chromosome = _chromosome;
		GeneAsset geneLeft = chromosome.getGeneLeft(locus_x, locus_y);
		GeneAsset geneRight = chromosome.getGeneRight(locus_x, locus_y);
		GeneAsset geneUp = chromosome.getGeneUp(locus_x, locus_y);
		GeneAsset geneDown = chromosome.getGeneDown(locus_x, locus_y);
		bool flag = !chromosome.hasBoundLeft(locus_x, locus_y);
		bool flag2 = !chromosome.hasBoundRight(locus_x, locus_y);
		bool flag3 = !chromosome.hasBoundUp(locus_x, locus_y);
		bool flag4 = !chromosome.hasBoundDown(locus_x, locus_y);
		bool flag5 = chromosome.hasSynergyConnectionLeft(locus_x, locus_y);
		bool flag6 = chromosome.hasSynergyConnectionRight(locus_x, locus_y);
		bool flag7 = chromosome.hasSynergyConnectionUp(locus_x, locus_y);
		bool flag8 = chromosome.hasSynergyConnectionDown(locus_x, locus_y);
		if (!flag5)
		{
			hideChain(chain_left);
		}
		else if (shouldBeBadChain(locus_x, locus_y, locus_x - 1, locus_y))
		{
			showChain(chain_left, pShow: true, base.gene.genetic_code_left, NucleobaseHelper.color_bad);
		}
		else if (chromosome.isForcedSynergyLeft(locus_x, locus_y))
		{
			showChain(chain_left, pShow: true, base.gene.genetic_code_left);
		}
		else
		{
			showChain(chain_left, pShow: true, geneLeft.genetic_code_right);
		}
		if (!flag6)
		{
			hideChain(chain_right);
		}
		else if (shouldBeBadChain(locus_x, locus_y, locus_x + 1, locus_y))
		{
			showChain(chain_right, pShow: true, base.gene.genetic_code_right, NucleobaseHelper.color_bad);
		}
		else if (chromosome.isForcedSynergyRight(locus_x, locus_y))
		{
			showChain(chain_right, pShow: true, base.gene.genetic_code_right);
		}
		else
		{
			showChain(chain_right, pShow: true, geneRight.genetic_code_left);
		}
		if (!flag7)
		{
			hideChain(chain_up);
		}
		else if (shouldBeBadChain(locus_x, locus_y, locus_x, locus_y - 1))
		{
			showChain(chain_up, pShow: true, base.gene.genetic_code_up, NucleobaseHelper.color_bad);
		}
		else if (chromosome.isForcedSynergyUp(locus_x, locus_y))
		{
			showChain(chain_up, pShow: true, base.gene.genetic_code_up);
		}
		else
		{
			showChain(chain_up, pShow: true, geneUp.genetic_code_down);
		}
		if (!flag8)
		{
			hideChain(chain_down);
		}
		else if (shouldBeBadChain(locus_x, locus_y, locus_x, locus_y + 1))
		{
			showChain(chain_down, pShow: true, base.gene.genetic_code_down, NucleobaseHelper.color_bad);
		}
		else if (chromosome.isForcedSynergyDown(locus_x, locus_y))
		{
			showChain(chain_down, pShow: true, base.gene.genetic_code_down);
		}
		else
		{
			showChain(chain_down, pShow: true, geneDown.genetic_code_up);
		}
		showDot(_dot_left, flag && !flag5, base.gene.genetic_code_left);
		showDot(_dot_right, flag2 && !flag6, base.gene.genetic_code_right);
		showDot(_dot_up, flag3 && !flag7, base.gene.genetic_code_up);
		showDot(_dot_down, flag4 && !flag8, base.gene.genetic_code_down);
	}

	public override void load(GeneAsset pAsset)
	{
		throw new NotImplementedException("Use show instead");
	}

	internal override void load(string pElementID)
	{
		throw new NotImplementedException("Use show instead");
	}

	public void show(int pLocusIndex, Chromosome pChromosome, GeneAsset pGene, LocusType pLocusType, LocusClickEvent pLocusClickEvent)
	{
		base.load(pGene);
		clearActions();
		_chromosome = pChromosome;
		locus_index = pLocusIndex;
		(int, int) xYFromIndex = _chromosome.getXYFromIndex(pLocusIndex);
		int item = xYFromIndex.Item1;
		int item2 = xYFromIndex.Item2;
		_locus_x = item;
		_locus_y = item2;
		_locus_click_event = pLocusClickEvent;
		locus_type = pLocusType;
		((Object)((Component)this).gameObject).name = "Locus " + base.gene.id;
		colorChains();
		checkSprite();
	}

	protected override void clearActions()
	{
		base.clearActions();
		_chromosome_updated_event = null;
	}

	public bool shouldBeBadLocus()
	{
		bool is_bad = base.gene.is_bad;
		bool flag = _chromosome.isNextToBad(_locus_x, _locus_y);
		return is_bad || flag;
	}

	public bool shouldBeGoldenLocus()
	{
		if (isAmplifier())
		{
			return true;
		}
		if (base.gene.synergy_sides_always)
		{
			return true;
		}
		if (_chromosome.hasFullSynergy(locus_index))
		{
			return true;
		}
		return false;
	}

	public bool isAmplifier()
	{
		return locus_type == LocusType.Amplifier;
	}

	public bool isAmplifierBad()
	{
		return _chromosome.hasAmplifierBad(_locus_x, _locus_y);
	}

	public bool isEmptyLocus()
	{
		return locus_type == LocusType.Empty;
	}

	protected override void fillTooltipData(GeneAsset pElement)
	{
		Tooltip.show(this, "gene", tooltipDataBuilder());
	}

	protected override TooltipData tooltipDataBuilder()
	{
		return new TooltipData
		{
			gene = base.gene,
			locus = this,
			chromosome = _chromosome
		};
	}

	public bool canAddGene()
	{
		return _chromosome.canAddToLocus(locus_index);
	}

	public bool isSpecialLocus()
	{
		return _chromosome.isSpecialLocus(locus_index);
	}

	public void OnDrop(PointerEventData pEventData)
	{
		if ((Object)(object)pEventData.pointerDrag == (Object)null || isAmplifier())
		{
			return;
		}
		if (!Config.hasPremium)
		{
			ScrollWindow.showWindow("premium_menu");
			return;
		}
		GeneButton component = pEventData.pointerDrag.GetComponent<GeneButton>();
		if ((Object)(object)component == (Object)null)
		{
			return;
		}
		GeneAsset elementAsset = component.getElementAsset();
		if (elementAsset.can_drop_and_grab)
		{
			if (component.locus_index > -1)
			{
				GeneAsset pAsset = _chromosome.getGene(locus_index);
				_chromosome.setGene(pAsset, component.locus_index);
			}
			GeneAsset geneAsset = getGeneAsset();
			_chromosome.setGene(elementAsset, locus_index);
			_chromosome_updated_event();
			SelectedMetas.selected_subspecies.eventGMO();
			if (elementAsset != geneAsset)
			{
				AchievementLibrary.engineered_evolution.check();
			}
			fillTooltipData(base.gene);
		}
	}

	public void addChromosomeUpdatedEvent(Action pChromosomeUpdatedEvent)
	{
		_chromosome_updated_event = pChromosomeUpdatedEvent;
	}

	protected void showDot(LocusDot pChainDot, bool pShow, char pGeneticCode)
	{
		((Component)pChainDot).gameObject.SetActive(pShow);
		if (pShow)
		{
			pChainDot.colorDot(pGeneticCode);
		}
	}

	protected override void startSignal()
	{
		AchievementLibrary.genes_explorer.checkBySignal();
	}

	protected override bool unlockElement()
	{
		bool result = base.unlockElement();
		isElementUnlocked();
		return result;
	}
}
// --- End of File: LocusElement.cs ---



// --- Start of File: LocusType.cs ---
public enum LocusType
{
	Standard,
	Amplifier,
	Empty
}
// --- End of File: LocusType.cs ---



// --- Start of File: LogHandler.cs ---
using System;
using System.Collections.Concurrent;
using System.IO;
using UnityEngine;
using UnityEngine.Rendering;
using WorldBoxConsole;

public class LogHandler : MonoBehaviour
{
	private static string folder_base = "/logs";

	private static string dataName = "/error";

	public static string log = "";

	internal static int errorNum = 0;

	private static string lastError = "";

	private static int errorRepeated = 0;

	private static bool _init_handler = false;

	private static bool _init_instance = false;

	private static bool toggledConsole = false;

	private static string _filename = null;

	private static ConcurrentQueue<LogItem> log_queue = new ConcurrentQueue<LogItem>();

	private static LogHandler _instance;

	[RuntimeInitializeOnLoadMethod(/*Could not decode attribute arguments.*/)]
	public static void init()
	{
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Expected O, but got Unknown
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Expected O, but got Unknown
		if (!_init_handler)
		{
			_init_handler = true;
			if (!Application.isEditor)
			{
				Application.SetStackTraceLogType((LogType)3, (StackTraceLogType)0);
				Application.SetStackTraceLogType((LogType)2, (StackTraceLogType)1);
				Application.SetStackTraceLogType((LogType)0, (StackTraceLogType)1);
			}
			Application.logMessageReceivedThreaded += new LogCallback(HandleLog);
			Application.logMessageReceivedThreaded += new LogCallback(WorldBoxConsole.Console.HandleLog);
			if (!Directory.Exists(getDirPath()))
			{
				Directory.CreateDirectory(getDirPath());
			}
		}
	}

	[RuntimeInitializeOnLoadMethod]
	public static void initInstance()
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Expected O, but got Unknown
		if (!_init_instance)
		{
			_init_instance = true;
			if ((Object)(object)_instance == (Object)null)
			{
				GameObject val = new GameObject("[LogHandler]");
				_instance = val.AddComponent<LogHandler>();
				Object.DontDestroyOnLoad((Object)val);
				((Object)val).hideFlags = (HideFlags)52;
			}
		}
	}

	private void Update()
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		LogItem result;
		while (log_queue.TryDequeue(out result))
		{
			ProcessLog(result.log, result.stack_trace, result.type);
		}
	}

	private static void HandleLog(string pLogString, string pStackTrace, LogType pLogType)
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		if (ThreadHelper.isMainThread())
		{
			ProcessLog(pLogString, pStackTrace, pLogType);
		}
		else
		{
			log_queue.Enqueue(new LogItem(pLogString, pStackTrace, pLogType));
		}
	}

	private static void ProcessLog(string pLogString, string pStackTrace, LogType pLogType)
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Invalid comparison between Unknown and I4
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Invalid comparison between Unknown and I4
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_026f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0274: Unknown result type (might be due to invalid IL or missing references)
		//IL_0297: Unknown result type (might be due to invalid IL or missing references)
		//IL_029c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0413: Unknown result type (might be due to invalid IL or missing references)
		//IL_0418: Unknown result type (might be due to invalid IL or missing references)
		pLogString = pLogString.Trim(' ', '\n');
		if ((int)pLogType == 0 || (int)pLogType == 4 || (int)pLogType == 1)
		{
			if (errorNum > 100)
			{
				return;
			}
			log = "";
			if (errorNum == 0)
			{
				log = log + "Game Version: " + Application.version;
				if (!string.IsNullOrEmpty(Config.versionCodeText))
				{
					log = log + " (" + Config.versionCodeText;
					if (!string.IsNullOrEmpty(Config.gitCodeText))
					{
						log = log + "@" + Config.gitCodeText;
					}
					log += ")";
				}
				log = log + "\nModded: " + Config.MODDED;
				string text = log;
				OperatingSystemFamily operatingSystemFamily = SystemInfo.operatingSystemFamily;
				log = text + "\noperatingSystemFamily: " + ((object)(OperatingSystemFamily)(ref operatingSystemFamily)).ToString();
				log = log + "\ndeviceModel: " + SystemInfo.deviceModel;
				log = log + "\ndeviceName: " + SystemInfo.deviceName;
				string text2 = log;
				DeviceType deviceType = SystemInfo.deviceType;
				log = text2 + "\ndeviceType: " + ((object)(DeviceType)(ref deviceType)).ToString();
				log = log + "\nsystemMemorySize: " + SystemInfo.systemMemorySize;
				log = log + "\ngraphicsDeviceID: " + SystemInfo.graphicsDeviceID;
				string text3 = log;
				GraphicsTier activeTier = Graphics.activeTier;
				log = text3 + "\ngraphicsActiveTier: " + ((object)(GraphicsTier)(ref activeTier)).ToString();
				log = log + "\nGC.GetTotalMemory: " + GC.GetTotalMemory(forceFullCollection: false) / 1000000 + " mb";
				log = log + "\ngraphicsMemorySize: " + SystemInfo.graphicsMemorySize;
				log = log + "\nmaxTextureSize: " + SystemInfo.maxTextureSize;
				log = log + "\noperatingSystem: " + SystemInfo.operatingSystem;
				log = log + "\nprocessorType: " + SystemInfo.processorType;
				string text4 = log;
				ApplicationInstallMode installMode = Application.installMode;
				log = text4 + "\ninstallMode: " + ((object)(ApplicationInstallMode)(ref installMode)).ToString();
				string text5 = log;
				ApplicationSandboxType sandboxType = Application.sandboxType;
				log = text5 + "\nsandboxType: " + ((object)(ApplicationSandboxType)(ref sandboxType)).ToString();
				try
				{
					if (Input.anyKey)
					{
						string text6 = "";
						if (HotkeyLibrary.isHoldingAlt())
						{
							text6 += "Alt ";
						}
						if (HotkeyLibrary.isHoldingControlForSelection())
						{
							text6 += "Ctrl ";
						}
						if (HotkeyLibrary.isHoldingAnyMod())
						{
							text6 += "Mod ";
						}
						log = log + "\nkeyboard: " + Input.anyKey + " " + Input.anyKeyDown + " " + Input.inputString + " " + text6;
						if (Input.mousePresent)
						{
							string text7 = (Input.GetMouseButton(0) ? "press0" : (Input.GetMouseButtonDown(0) ? "down0" : (Input.GetMouseButtonUp(0) ? "up0" : "none1")));
							string text8 = (Input.GetMouseButton(1) ? "press1" : (Input.GetMouseButtonDown(1) ? "down1" : (Input.GetMouseButtonUp(1) ? "up1" : "none1")));
							string text9 = (Input.GetMouseButton(2) ? "press2" : (Input.GetMouseButtonDown(2) ? "down2" : (Input.GetMouseButtonUp(2) ? "up2" : "none2")));
							Vector3 mousePosition = Input.mousePosition;
							string text10 = ((object)(Vector3)(ref mousePosition)).ToString();
							log = log + "\nmouse: " + text10 + " " + text7 + " " + text8 + " " + text9;
						}
					}
				}
				catch (Exception)
				{
				}
				log = log + "\nFPS: " + FPS.fps;
				log += "\n-----------\n\n";
			}
			if (!pStackTrace.AsSpan().Trim().IsEmpty && pStackTrace == lastError)
			{
				errorRepeated++;
				return;
			}
			if (pStackTrace.AsSpan().Trim().IsEmpty && pLogString == lastError)
			{
				errorRepeated++;
				return;
			}
			clearRepeat();
			log = log + "- error[" + errorNum + "]: " + pLogString + "\n";
			log = log + "- stack:\n" + pStackTrace + "\n";
			lastError = pStackTrace;
			File.AppendAllText(getPath(), log);
			errorNum++;
			openConsole();
		}
		else
		{
			clearRepeat();
			log = log + "- trace: " + pLogString + "\n";
		}
	}

	private static void openConsole()
	{
		if (Config.show_console_on_error && (Object)(object)World.world != (Object)null && (Object)(object)World.world.console != (Object)null && !toggledConsole)
		{
			toggledConsole = true;
			World.world.console.Show();
		}
	}

	private static void clearRepeat()
	{
		if (errorRepeated > 0)
		{
			log = log + "- last error repeated " + errorRepeated + " times\n";
			lastError = "";
			errorRepeated = 0;
		}
	}

	public static string getDirPath()
	{
		return Application.persistentDataPath + folder_base;
	}

	private static string getPath()
	{
		if (_filename == null)
		{
			_filename = getFileName();
		}
		return _filename;
	}

	private static string getFileName()
	{
		string text = DateTime.Now.ToString("yyyy_MM_dd_HH_mm_ss");
		return getDirPath() + dataName + "_" + text + ".log";
	}
}
// --- End of File: LogHandler.cs ---



// --- Start of File: LogHandlerInit.cs ---
using System;
using UnityEngine;

public class LogHandlerInit : MonoBehaviour
{
	private void Awake()
	{
		try
		{
			LogHandler.init();
		}
		catch (Exception ex)
		{
			Debug.LogError((object)ex);
			throw;
		}
	}
}
// --- End of File: LogHandlerInit.cs ---



// --- Start of File: Login.cs ---
using System;
using System.Threading.Tasks;

public class Login
{
	public static string createLoginQueueItemAsJSON(string username, string password)
	{
		string text = "";
		return "" + text;
	}

	public static async void GetEmailForUsername(string username, string password, Action<string, string> resultCallback)
	{
		await Task.Yield();
	}

	private static void UnsubscribeLoginQueueListener()
	{
	}
}
// --- End of File: Login.cs ---



// --- Start of File: LoginData.cs ---
using System;

[Serializable]
public class LoginData
{
	public string email;

	public string userName;
}
// --- End of File: LoginData.cs ---



// --- Start of File: LogItem.cs ---
using System;
using UnityEngine;

public readonly struct LogItem
{
	public readonly string log;

	public readonly string stack_trace;

	public readonly LogType type;

	public readonly DateTime time;

	public LogItem(string pLog, string pStackTrace, LogType pType)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		log = pLog;
		stack_trace = pStackTrace;
		type = pType;
		time = DateTime.Now;
	}

	public LogItem(string pLog, string pStackTrace, LogType pType, DateTime pTime)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		log = pLog;
		stack_trace = pStackTrace;
		type = pType;
		time = pTime;
	}
}
// --- End of File: LogItem.cs ---



// --- Start of File: LogoButton.cs ---
using System.Collections.Generic;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;

public class LogoButton : MonoBehaviour
{
	private List<UiCreature> listLetters;

	private float initScale = 1f;

	private Tweener tweener;

	private void Awake()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		initScale = ((Component)this).transform.localScale.x;
		loadLetters();
	}

	private void loadLetters()
	{
		listLetters = new List<UiCreature>();
		Transform transform = ((Component)((Component)this).transform.FindRecursive("Letters")).transform;
		int childCount = transform.childCount;
		for (int i = 0; i < childCount; i++)
		{
			UiCreature component = ((Component)transform.GetChild(i)).GetComponent<UiCreature>();
			if (component.dropped)
			{
				component.resetPosition();
			}
			listLetters.Add(component);
		}
	}

	private void letterFall()
	{
		if (listLetters.Count == 0)
		{
			loadLetters();
			AchievementLibrary.destroy_worldbox.check();
			return;
		}
		listLetters.ShuffleOne();
		UiCreature uiCreature = listLetters[0];
		listLetters.RemoveAt(0);
		uiCreature.click();
	}

	public void clickLogo()
	{
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionHuge");
		if (tweener != null && ((Tween)tweener).active)
		{
			TweenExtensions.Kill((Tween)(object)tweener, false);
		}
		float num = initScale * 1.2f;
		if (listLetters.Count == 0)
		{
			num = 1.6f;
			((Component)this).transform.localScale = new Vector3(num, num, num);
			tweener = (Tweener)(object)TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).transform, new Vector3(initScale, initScale, initScale), 0.3f), (Ease)27);
		}
		else
		{
			((Component)this).transform.localScale = new Vector3(num, num, num);
			tweener = (Tweener)(object)TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).transform, new Vector3(initScale, initScale, initScale), 0.3f), (Ease)27);
		}
		letterFall();
	}
}
// --- End of File: LogoButton.cs ---



// --- Start of File: LogText.cs ---
using System.IO;
using UnityEngine;

public class LogText
{
	private static string dataName = "/wb_runtime.log";

	private static bool created = false;

	internal static int offset = 0;

	public static void log(string pEvent, string pInfo = "", string pState = "")
	{
		if (!Globals.DIAGNOSTIC)
		{
			return;
		}
		if (!created)
		{
			created = true;
			File.WriteAllText(getPath(), "");
		}
		if (pState == "st")
		{
			offset++;
		}
		else if (pState == "en")
		{
			offset--;
		}
		string text = "";
		for (int i = 0; i < offset; i++)
		{
			text += " ";
		}
		if (pState == "en")
		{
			text += " ";
		}
		else if (pState == "")
		{
			text += " ";
		}
		if (pState == "en")
		{
			pState = "x";
		}
		else if (pState == "st")
		{
			pState = "!";
		}
		if (pInfo != "")
		{
			pEvent = text + pEvent + " :: " + pInfo;
			if (pState != "")
			{
				pEvent = pEvent + " - " + pState;
			}
		}
		File.AppendAllText(getPath(), pEvent + "\n");
	}

	public static string getPath()
	{
		return Application.persistentDataPath + dataName;
	}
}
// --- End of File: LogText.cs ---



// --- Start of File: LongExtension.cs ---
using System.Runtime.CompilerServices;

public static class LongExtension
{
	public const long NULL = -1L;

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool hasValue(this long pLong)
	{
		return pLong != -1;
	}

	public static long? toNullLong(this long pLong)
	{
		if (!pLong.hasValue())
		{
			return null;
		}
		return pLong;
	}

	public static long toLong(this long? pLong)
	{
		return pLong ?? (-1);
	}
}
// --- End of File: LongExtension.cs ---



// --- Start of File: LongJsonConverter.cs ---
using System;
using System.Collections.Generic;
using Newtonsoft.Json;
using UnityEngine;

public class LongJsonConverter : JsonConverter
{
	internal static long next_long = 100000000L;

	internal static Dictionary<string, long> longs = new Dictionary<string, long>();

	public override bool CanWrite => false;

	public override bool CanRead => true;

	public static void reset()
	{
		next_long = 100000000L;
		longs.Clear();
	}

	public static long getLong(string pString, JsonReader pReader)
	{
		if (string.IsNullOrEmpty(pString))
		{
			return -1L;
		}
		string s = pString;
		if (pString.IndexOf('_') > 0)
		{
			string[] array = pString.Split('_');
			if (array.Length == 2)
			{
				string pValue = array[0] + "_";
				if (MapStats.possible_formats.IndexOf(pValue) > -1)
				{
					s = array[1];
				}
			}
		}
		if (long.TryParse(s, out var result))
		{
			return result;
		}
		bool flag = pString.Length == 8 || (pString.Length == 36 && pString[8] == '-' && pString[13] == '-' && pString[18] == '-' && pString[23] == '-');
		if (!longs.TryGetValue(pString, out var value))
		{
			value = next_long++;
			longs[pString] = value;
			if (!flag)
			{
				Debug.LogWarning((object)(pReader.Path + " Failed to parse long <b>" + pString + "</b> " + pString.Length + " -> " + value));
			}
		}
		else if (!flag)
		{
			Debug.LogWarning((object)(pReader.Path + " Failed to parse long <b>" + pString + "</b> " + pString.Length + " -> " + value + " already had it"));
		}
		return value;
	}

	public override object ReadJson(JsonReader reader, Type objectType, object existingValue, JsonSerializer serializer)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Expected I4, but got Unknown
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		JsonToken tokenType = reader.TokenType;
		switch (tokenType - 7)
		{
		case 4:
			return -1L;
		case 0:
			return Convert.ToInt64(reader.Value);
		case 2:
			return getLong((string)reader.Value, reader);
		default:
		{
			string[] obj = new string[8]
			{
				"Unhandled type ",
				reader.Path,
				" ",
				reader.Value?.ToString(),
				" ",
				null,
				null,
				null
			};
			tokenType = reader.TokenType;
			obj[5] = ((object)(JsonToken)(ref tokenType)).ToString();
			obj[6] = " -> ";
			obj[7] = (-1L).ToString();
			Debug.LogWarning((object)string.Concat(obj));
			return -1L;
		}
		}
	}

	public override void WriteJson(JsonWriter writer, object value, JsonSerializer serializer)
	{
		writer.WriteValue(value);
	}

	public override bool CanConvert(Type objectType)
	{
		return objectType == typeof(long);
	}
}
// --- End of File: LongJsonConverter.cs ---



// --- Start of File: LongListJsonConverter.cs ---
using System;
using System.Collections.Generic;
using Newtonsoft.Json;
using UnityEngine;

public class LongListJsonConverter : JsonConverter
{
	public override bool CanWrite => false;

	public override bool CanRead => true;

	public override object ReadJson(JsonReader reader, Type objectType, object existingValue, JsonSerializer serializer)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Invalid comparison between Unknown and I4
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Invalid comparison between Unknown and I4
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Expected I4, but got Unknown
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Invalid comparison between Unknown and I4
		if ((int)reader.TokenType == 11)
		{
			return null;
		}
		JsonToken tokenType;
		if ((int)reader.TokenType == 2)
		{
			using ListPool<long> listPool = new ListPool<long>();
			while (reader.Read())
			{
				tokenType = reader.TokenType;
				switch (tokenType - 7)
				{
				case 0:
					listPool.Add(Convert.ToInt64(reader.Value));
					continue;
				case 4:
					listPool.Add(-1L);
					continue;
				case 2:
				{
					string pString = (string)reader.Value;
					listPool.Add(LongJsonConverter.getLong(pString, reader));
					continue;
				}
				case 1:
				case 3:
					continue;
				}
				if ((int)tokenType != 14)
				{
					continue;
				}
				return new List<long>(listPool);
			}
		}
		string[] obj = new string[7]
		{
			"Unhandled type ",
			reader.Path,
			" ",
			reader.Value?.ToString(),
			" ",
			null,
			null
		};
		tokenType = reader.TokenType;
		obj[5] = ((object)(JsonToken)(ref tokenType)).ToString();
		obj[6] = " -> null";
		Debug.LogWarning((object)string.Concat(obj));
		return null;
	}

	public override void WriteJson(JsonWriter writer, object value, JsonSerializer serializer)
	{
		writer.WriteValue(value);
	}

	public override bool CanConvert(Type objectType)
	{
		return objectType == typeof(List<long>);
	}
}
// --- End of File: LongListJsonConverter.cs ---



// --- Start of File: LongTextLoader.cs ---
using System;
using UnityEngine;
using UnityEngine.UI;

public class LongTextLoader : MonoBehaviour
{
	public TextAsset textAsset;

	protected Text m_text;

	private void Start()
	{
		m_text = ((Component)this).GetComponent<Text>();
		create();
		finish();
	}

	private void finish()
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		RectTransform component = ((Component)m_text).GetComponent<RectTransform>();
		component.sizeDelta = new Vector2(component.sizeDelta.x, m_text.preferredHeight + 10f);
		RectTransform component2 = ((Component)((Component)this).transform.parent).GetComponent<RectTransform>();
		component2.sizeDelta = new Vector2(component2.sizeDelta.x, component.sizeDelta.y);
		float num = 0f - ((Component)component2).transform.localPosition.y;
		((Component)((Transform)component2).parent).GetComponent<RectTransform>().sizeDelta = new Vector2(0f, component.sizeDelta.y + 20f + num);
	}

	public virtual void create()
	{
		try
		{
			m_text.text = textAsset.text;
		}
		catch (Exception)
		{
			Debug.LogError((object)"LongTextLoader: Text File is too long");
		}
	}
}
// --- End of File: LongTextLoader.cs ---



// --- Start of File: LoyaltyAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class LoyaltyAsset : Asset, IMultiLocalesAsset
{
	public string translation_key;

	public string translation_key_negative;

	public LoyaltyDelegateCalc calc;

	public IEnumerable<string> getLocaleIDs()
	{
		yield return translation_key;
		if (!string.IsNullOrEmpty(translation_key_negative))
		{
			yield return translation_key_negative;
		}
	}

	public string getTranslationKey(int pValue)
	{
		if (pValue > 0)
		{
			return translation_key;
		}
		if (!string.IsNullOrEmpty(translation_key_negative))
		{
			return translation_key_negative;
		}
		return translation_key;
	}
}
// --- End of File: LoyaltyAsset.cs ---



// --- Start of File: LoyaltyCalculator.cs ---
using System.Collections.Generic;

public static class LoyaltyCalculator
{
	public static Dictionary<LoyaltyAsset, int> results = new Dictionary<LoyaltyAsset, int>();

	public static int total = 0;

	public static int calculate(City pCity)
	{
		clear();
		foreach (LoyaltyAsset item in AssetManager.loyalty_library.list)
		{
			int num = item.calc(pCity);
			total += num;
			if (num != 0)
			{
				results.Add(item, num);
			}
		}
		return total;
	}

	private static void clear()
	{
		total = 0;
		results.Clear();
	}
}
// --- End of File: LoyaltyCalculator.cs ---



// --- Start of File: LoyaltyDelegateCalc.cs ---
public delegate int LoyaltyDelegateCalc(City pCity = null);
// --- End of File: LoyaltyDelegateCalc.cs ---



// --- Start of File: LoyaltyLibrary.cs ---
using UnityEngine;

public class LoyaltyLibrary : AssetLibrary<LoyaltyAsset>
{
	public override void init()
	{
		base.init();
		add(new LoyaltyAsset
		{
			id = "king_diplomacy",
			translation_key = "loyalty_king",
			calc = delegate(City pCity)
			{
				int result15 = 0;
				if (!pCity.kingdom.hasKing())
				{
					return result15;
				}
				Actor king2 = pCity.kingdom.king;
				if (king2.isAlive())
				{
					result15 = (int)(king2.stats["diplomacy"] + king2.stats["stewardship"] * 2f);
				}
				return result15;
			}
		});
		add(new LoyaltyAsset
		{
			id = "leader_diplomacy",
			translation_key = "loyalty_leader",
			calc = delegate(City pCity)
			{
				int result14 = 0;
				if (!pCity.hasLeader())
				{
					return result14;
				}
				Actor leader2 = pCity.leader;
				if (leader2.isAlive())
				{
					result14 = -(int)(leader2.stats["diplomacy"] + leader2.stats["stewardship"] * 2f);
				}
				return result14;
			}
		});
		add(new LoyaltyAsset
		{
			id = "leader_loyalty",
			translation_key = "loyalty_traits",
			calc = delegate(City pCity)
			{
				int num12 = 0;
				if (pCity.hasLeader())
				{
					num12 = (int)pCity.leader.stats["loyalty_traits"];
				}
				if (pCity.hasLeader() && pCity.kingdom.hasKing())
				{
					int num13 = AssetManager.traits.checkTraitsMod(pCity.leader, pCity.kingdom.king);
					num12 += num13;
				}
				return num12;
			}
		});
		add(new LoyaltyAsset
		{
			id = "population",
			translation_key = "loyalty_population",
			calc = delegate(City pCity)
			{
				int result13 = 0;
				if (pCity.isCapitalCity())
				{
					return result13;
				}
				if (pCity.kingdom.hasCapital())
				{
					int num11 = Mathf.Abs(pCity.status.population - pCity.kingdom.capital.status.population) / 3;
					if (num11 > 30)
					{
						num11 = 30;
					}
					result13 = ((pCity.status.population <= pCity.kingdom.capital.status.population) ? num11 : (-num11));
				}
				return result13;
			}
		});
		add(new LoyaltyAsset
		{
			id = "zones",
			translation_key = "loyalty_zones",
			calc = delegate(City pCity)
			{
				int result12 = 0;
				if (pCity.isCapitalCity())
				{
					return result12;
				}
				if (pCity.kingdom.hasCapital())
				{
					int num10 = Mathf.Abs(pCity.zones.Count - pCity.kingdom.capital.zones.Count) / 20;
					if (num10 > 5)
					{
						num10 = 5;
					}
					result12 = ((pCity.zones.Count <= pCity.kingdom.capital.zones.Count) ? num10 : (-num10));
				}
				return result12;
			}
		});
		add(new LoyaltyAsset
		{
			id = "distance",
			translation_key = "loyalty_distance",
			calc = delegate(City pCity)
			{
				//IL_0052: Unknown result type (might be due to invalid IL or missing references)
				//IL_0062: Unknown result type (might be due to invalid IL or missing references)
				int result11 = 0;
				if (pCity.isCapitalCity())
				{
					return result11;
				}
				if (pCity.kingdom.hasCapital() && pCity.city_center.x != Globals.POINT_IN_VOID_2.x && pCity.kingdom.capital.city_center.x != Globals.POINT_IN_VOID_2.x)
				{
					result11 = -(int)(Toolbox.DistVec2Float(pCity.city_center, pCity.kingdom.capital.city_center) / 10f);
				}
				return result11;
			}
		});
		add(new LoyaltyAsset
		{
			id = "capital",
			translation_key = "loyalty_capital",
			calc = (City pCity) => pCity.isCapitalCity() ? 1000 : 0
		});
		add(new LoyaltyAsset
		{
			id = "mood",
			translation_key = "loyalty_leader_mood",
			calc = delegate(City pCity)
			{
				int result10 = 0;
				if (pCity.hasLeader())
				{
					result10 = (int)pCity.leader.stats["loyalty_mood"];
				}
				return result10;
			}
		});
		add(new LoyaltyAsset
		{
			id = "new_city",
			translation_key = "loyalty_new_city",
			calc = delegate(City pCity)
			{
				int result9 = 0;
				int age2 = pCity.getAge();
				int num9 = 15;
				if (age2 <= num9)
				{
					result9 = (num9 - age2) * 5;
				}
				return result9;
			}
		});
		add(new LoyaltyAsset
		{
			id = "new_kingdom",
			translation_key = "loyalty_new_kingdom",
			calc = delegate(City pCity)
			{
				int result8 = 0;
				int age = pCity.kingdom.getAge();
				if (age <= 5)
				{
					result8 = (5 - age) * 5;
				}
				return result8;
			}
		});
		add(new LoyaltyAsset
		{
			id = "cities",
			translation_key = "loyalty_number_of_cities",
			calc = delegate(City pCity)
			{
				int result7 = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				int maxCities = pCity.kingdom.getMaxCities();
				int num8 = pCity.kingdom.countCities();
				if (num8 > maxCities)
				{
					result7 = (maxCities - num8) * 25;
				}
				return result7;
			}
		});
		add(new LoyaltyAsset
		{
			id = "superior_enemies",
			translation_key = "loyalty_superior_enemies",
			calc = delegate(City pCity)
			{
				int num6 = 0;
				if (pCity.kingdom.hasEnemies())
				{
					int num7 = 0;
					using ListPool<Kingdom> listPool = World.world.wars.getEnemiesOf(pCity.kingdom);
					foreach (ref Kingdom item in listPool)
					{
						Kingdom current = item;
						num7 += current.power;
					}
					num6 = (num7 - pCity.kingdom.power) / 2;
					if (num6 < 0)
					{
						num6 = 0;
					}
					else if (num6 > 50)
					{
						num6 = 50;
					}
				}
				return num6;
			}
		});
		add(new LoyaltyAsset
		{
			id = "close_to_capital",
			translation_key = "loyalty_close_to_capital",
			calc = delegate(City pCity)
			{
				int result6 = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				if (pCity.kingdom.hasCapital() && City.nearbyBorders(pCity.kingdom.capital, pCity))
				{
					result6 = 20;
				}
				return result6;
			}
		});
		add(new LoyaltyAsset
		{
			id = "connected_to_capital",
			translation_key = "loyalty_connected_to_capital",
			translation_key_negative = "loyalty_not_connected_to_capital",
			calc = delegate(City pCity)
			{
				if (!pCity.kingdom.hasCapital())
				{
					return 0;
				}
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				if (pCity.kingdom.capital.getSpecies() != pCity.getSpecies())
				{
					return 0;
				}
				return pCity.isConnectedToCapital() ? 20 : (-35);
			}
		});
		add(new LoyaltyAsset
		{
			id = "culture",
			translation_key = "loyalty_culture",
			translation_key_negative = "opinion_culture_different",
			calc = delegate(City pCity)
			{
				int result5 = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				if (!pCity.hasCulture())
				{
					return 0;
				}
				if (pCity.kingdom.hasCapital())
				{
					result5 = ((pCity.kingdom.capital.culture != pCity.culture) ? (-25) : 15);
				}
				return result5;
			}
		});
		add(new LoyaltyAsset
		{
			id = "language",
			translation_key = "loyalty_language",
			translation_key_negative = "opinion_language_different",
			calc = delegate(City pCity)
			{
				int result4 = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				if (!pCity.hasLanguage())
				{
					return 0;
				}
				if (pCity.kingdom.hasCapital())
				{
					result4 = ((pCity.kingdom.capital.language != pCity.language) ? (-20) : 15);
				}
				return result4;
			}
		});
		add(new LoyaltyAsset
		{
			id = "religion",
			translation_key = "loyalty_religion",
			translation_key_negative = "opinion_religion_different",
			calc = delegate(City pCity)
			{
				int result3 = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				if (!pCity.hasReligion())
				{
					return 0;
				}
				if (pCity.kingdom.hasCapital())
				{
					result3 = ((pCity.kingdom.capital.religion != pCity.religion) ? (-30) : 15);
				}
				return result3;
			}
		});
		add(new LoyaltyAsset
		{
			id = "species",
			translation_key = "loyalty_species",
			translation_key_negative = "loyalty_species_different",
			calc = delegate(City pCity)
			{
				int result2 = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				if (pCity.kingdom.hasCapital())
				{
					if (pCity.kingdom.capital.getSpecies() == pCity.getSpecies())
					{
						result2 = 0;
					}
					else
					{
						result2 = ((!pCity.hasLeader()) ? (-25) : ((!pCity.leader.hasXenophiles()) ? (-25) : (-5)));
						if (pCity.hasLeader() && (pCity.leader.hasXenophobic() || (pCity.kingdom.hasKing() && pCity.kingdom.king.hasXenophobic())))
						{
							result2 = -50;
						}
					}
				}
				return result2;
			}
		});
		add(new LoyaltyAsset
		{
			id = "subspecies",
			translation_key = "loyalty_subspecies",
			translation_key_negative = "opinion_subspecies_different",
			calc = delegate(City pCity)
			{
				int num5 = 0;
				if (!pCity.kingdom.hasCapital())
				{
					return 0;
				}
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				City capital = pCity.kingdom.capital;
				if (capital.getSpecies() != pCity.getSpecies())
				{
					return 0;
				}
				return (capital.getMainSubspecies() == pCity.getMainSubspecies()) ? 15 : (-15);
			}
		});
		add(new LoyaltyAsset
		{
			id = "clan",
			translation_key = "loyalty_same_clan",
			translation_key_negative = "loyalty_different_clans",
			calc = delegate(City pCity)
			{
				int result = 0;
				if (pCity.isCapitalCity())
				{
					return 0;
				}
				Actor leader = pCity.leader;
				Actor king = pCity.kingdom.king;
				if (!pCity.hasLeader() || !pCity.kingdom.hasKing())
				{
					return 0;
				}
				if (king.subspecies != leader.subspecies)
				{
					return result;
				}
				return (pCity.leader.clan == pCity.kingdom.king.clan) ? 30 : (-20);
			}
		});
		add(new LoyaltyAsset
		{
			id = "new_conquest",
			translation_key = "loyalty_new_conquest",
			calc = delegate(City pCity)
			{
				Kingdom kingdom3 = pCity.kingdom;
				if (kingdom3.data.timestamp_new_conquest == -1.0)
				{
					return 0;
				}
				int yearsSince3 = Date.getYearsSince(kingdom3.data.timestamp_new_conquest);
				int num4 = 10;
				return (yearsSince3 <= num4) ? ((num4 - yearsSince3) * 30) : 0;
			}
		});
		add(new LoyaltyAsset
		{
			id = "part_of_kingdom",
			translation_key = "loyalty_part_of_kingdom",
			calc = delegate(City pCity)
			{
				int yearsSince2 = Date.getYearsSince(pCity.data.timestamp_kingdom);
				int num3 = 10;
				return (yearsSince2 <= num3) ? ((num3 - yearsSince2) * 10) : 0;
			}
		});
		add(new LoyaltyAsset
		{
			id = "supreme_kingdom",
			translation_key = "loyalty_supreme_kingdom",
			calc = delegate(City pCity)
			{
				if (World.world.kingdoms.Count <= 1)
				{
					return 0;
				}
				return pCity.kingdom.isSupreme() ? 100 : 0;
			}
		});
		add(new LoyaltyAsset
		{
			id = "second_best_kingdom",
			translation_key = "loyalty_second_best",
			calc = delegate(City pCity)
			{
				if (World.world.kingdoms.Count <= 2)
				{
					return 0;
				}
				return pCity.kingdom.isSecondBest() ? 50 : 0;
			}
		});
		add(new LoyaltyAsset
		{
			id = "king_rule",
			translation_key = "loyalty_king_ruled",
			calc = delegate(City pCity)
			{
				if (!pCity.kingdom.hasKing())
				{
					return 0;
				}
				int yearsSince = Date.getYearsSince(pCity.kingdom.data.timestamp_king_rule);
				int num = 5;
				int num2 = 40;
				if (yearsSince < num)
				{
					return 0;
				}
				return (yearsSince > num2) ? num2 : yearsSince;
			}
		});
		add(new LoyaltyAsset
		{
			id = "loyalty_world_era",
			translation_key = "loyalty_world_era",
			calc = (City pCity) => World.world_era.bonus_loyalty
		});
		add(new LoyaltyAsset
		{
			id = "loyalty_baby_king",
			translation_key = "loyalty_baby_king",
			calc = delegate(City pCity)
			{
				if (!pCity.kingdom.hasKing())
				{
					return 0;
				}
				return (pCity.kingdom.king.getAge() < 18) ? (-50) : 0;
			}
		});
		add(new LoyaltyAsset
		{
			id = "opinion_patriarchy",
			translation_key = "opinion_patriarchy",
			calc = delegate(City pCity)
			{
				Culture culture2 = pCity.culture;
				Kingdom kingdom2 = pCity.kingdom;
				if (!pCity.hasCulture())
				{
					return 0;
				}
				if (culture2 != kingdom2.culture)
				{
					return 0;
				}
				if (!culture2.hasTrait("patriarchy"))
				{
					return 0;
				}
				if (!kingdom2.hasKing())
				{
					return 0;
				}
				return (!kingdom2.king.isSexMale()) ? (-50) : 0;
			}
		});
		add(new LoyaltyAsset
		{
			id = "opinion_matriarchy",
			translation_key = "opinion_matriarchy",
			calc = delegate(City pCity)
			{
				Culture culture = pCity.culture;
				Kingdom kingdom = pCity.kingdom;
				if (!pCity.hasCulture())
				{
					return 0;
				}
				if (culture != kingdom.culture)
				{
					return 0;
				}
				if (!culture.hasTrait("matriarchy"))
				{
					return 0;
				}
				if (!kingdom.hasKing())
				{
					return 0;
				}
				return (!kingdom.king.isSexFemale()) ? (-50) : 0;
			}
		});
	}

	public override void editorDiagnosticLocales()
	{
		foreach (LoyaltyAsset item in list)
		{
			foreach (string localeID in item.getLocaleIDs())
			{
				checkLocale(item, localeID);
			}
		}
		base.editorDiagnosticLocales();
	}
}
// --- End of File: LoyaltyLibrary.cs ---



// --- Start of File: Magnet.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class Magnet
{
	private const float ANIMATED_SHRINK_SPEED = 0.3f;

	private const float PICKED_UP_SPEED_MULTIPLIER = 0.1f;

	private int _magnet_state;

	private WorldTile _magnet_last_pos;

	private bool _has_units;

	internal List<Actor> magnet_units = new List<Actor>();

	private HashSet<Actor> _magnet_units = new HashSet<Actor>();

	private float _picked_up_multiplier = 1f;

	private float _angle;

	public float moving_angle;

	private MagnetThrow _magnet_throw = new MagnetThrow();

	private float _target_angle;

	private float _current_angle;

	private float _rotation_velocity;

	internal void magnetAction(bool pFromUpdate, WorldTile pTile = null)
	{
		if (ScrollWindow.isWindowActive())
		{
			dropPickedUnits();
		}
		else
		{
			if (pFromUpdate && _magnet_state != 1 && _magnet_state != 3)
			{
				return;
			}
			if (pTile != null)
			{
				_magnet_last_pos = pTile;
			}
			_magnet_throw.trackMouseMovement(_magnet_state);
			updatePickedUnits();
			if (pTile != null)
			{
				World.world.flash_effects.flashPixel(pTile, 10);
			}
			switch (_magnet_state)
			{
			case 0:
				if (Input.GetMouseButton(0))
				{
					_magnet_state = 1;
					_magnet_throw.initializeMouseTracking();
				}
				break;
			case 1:
				if (!pFromUpdate)
				{
					pickupUnits(pTile);
				}
				if (Input.GetMouseButtonUp(0))
				{
					_magnet_state = 2;
					dropPickedUnits();
				}
				break;
			case 2:
				if (!pFromUpdate && Input.GetMouseButton(0))
				{
					dropPickedUnits();
					_magnet_state = 0;
				}
				break;
			}
		}
	}

	public void dropPickedUnits()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		if (magnet_units.Count == 0)
		{
			return;
		}
		Vector2 val = _magnet_throw.calculateThrowForce();
		for (int i = 0; i < magnet_units.Count; i++)
		{
			Actor actor = magnet_units[i];
			if (actor != null && actor.isAlive())
			{
				actor.current_position.y -= actor.position_height;
				actor.is_in_magnet = false;
				actor.dirty_current_tile = true;
				actor.findCurrentTile();
				actor.spawnOn(actor.current_tile, actor.getActorAsset().default_height);
				actor.makeStunned(1f);
				actor.addStatusEffect("magnetized");
				actor.target_angle.z = 0f;
				if (((Vector2)(ref val)).magnitude > 0.1f)
				{
					Vector2 val2 = val;
					val2.x += Random.Range(-0.3f, 0.3f);
					val2.y += Random.Range(-0.3f, 0.3f);
					actor.addForce(val2.x, val2.y, ((Vector2)(ref val2)).magnitude * 0.3f, pCheckLandCancelAllActions: true, pIgnorePosHeight: true);
				}
				else
				{
					actor.addForce(0f, 0f, 0.1f, pCheckLandCancelAllActions: true);
				}
				actor.addActionWaitAfterLand(0.5f);
			}
		}
		magnet_units.Clear();
		_magnet_units.Clear();
		_has_units = false;
		_magnet_throw.clear();
	}

	private void updatePickedUnits()
	{
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_013e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0189: Unknown result type (might be due to invalid IL or missing references)
		//IL_0190: Unknown result type (might be due to invalid IL or missing references)
		//IL_019f: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a4: Unknown result type (might be due to invalid IL or missing references)
		if (_magnet_last_pos == null || magnet_units.Count == 0)
		{
			return;
		}
		updateMovingForce();
		if (_picked_up_multiplier > 0.1f)
		{
			_picked_up_multiplier -= World.world.delta_time * 0.3f;
			if (_picked_up_multiplier < 0.1f)
			{
				_picked_up_multiplier = 0.1f;
			}
		}
		float num = magnet_units.Count;
		float num2 = 6f;
		if (num > 100f)
		{
			num2 = 4f;
		}
		else if (num > 50f)
		{
			num2 = 4.5f;
		}
		else if (num > 5f)
		{
			num2 = 5f;
		}
		float num3 = MathF.PI * 2f / num2;
		int num4 = Config.current_brush_data.width + 1;
		float num5 = ((0 == 0) ? ((float)num4 / 2f) : (Mathf.Lerp(0f, (float)num4, _picked_up_multiplier) / 2f));
		float num6 = 1f / num * num5;
		_angle += num3 * Time.deltaTime;
		Vector2 mousePos = World.world.getMousePos();
		for (int i = 0; (float)i < num; i++)
		{
			Actor actor = magnet_units[i];
			if (actor != null && actor.isAlive())
			{
				actor.findCurrentTile();
				Vector3 val = Vector2.op_Implicit(mousePos);
				val.x += Mathf.Cos(_angle + (float)i) * (num6 * (float)i);
				val.y += Mathf.Sin(_angle + (float)i) * (num6 * (float)i);
				actor.current_position = new Vector2(val.x, val.y - actor.position_height);
				actor.callbacks_magnet_update?.Invoke(actor);
			}
		}
	}

	private void updateMovingForce()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = new Vector2(Input.GetAxisRaw("Mouse X"), Input.GetAxisRaw("Mouse Y")) * 3f;
		if (((Vector2)(ref val)).magnitude > 0.1f)
		{
			_target_angle = Mathf.Atan2(val.y, val.x) * 57.29578f;
			_target_angle -= 90f;
		}
		else
		{
			_target_angle = 0f;
		}
		_current_angle = Mathf.SmoothDampAngle(_current_angle, _target_angle, ref _rotation_velocity, 0.2f);
		moving_angle = _current_angle;
	}

	private void pickupUnits(WorldTile pTile)
	{
		BrushPixelData[] pos = Config.current_brush_data.pos;
		for (int i = 0; i < pos.Length; i++)
		{
			WorldTile tile = World.world.GetTile(pos[i].x + pTile.x, pos[i].y + pTile.y);
			if (tile == null || !tile.hasUnits())
			{
				continue;
			}
			tile.doUnits(delegate(Actor tActor)
			{
				if (tActor.asset.can_be_moved_by_powers && !tActor.isInsideSomething() && _magnet_units.Add(tActor))
				{
					tActor.cancelAllBeh();
					magnet_units.Add(tActor);
					tActor.is_in_magnet = true;
					_picked_up_multiplier = 2f;
				}
			});
		}
		_has_units = _magnet_units.Count > 0;
	}

	public int countUnits()
	{
		return _magnet_units.Count;
	}

	public bool hasUnits()
	{
		return _has_units;
	}
}
// --- End of File: Magnet.cs ---



// --- Start of File: MagnetThrow.cs ---
using System.Collections.Generic;
using UnityEngine;

public class MagnetThrow
{
	private Vector2 _mouse_velocity = Vector2.zero;

	private Vector2 _last_mouse_position;

	private readonly List<Vector2> _velocity_samples = new List<Vector2>();

	private const int MAX_VELOCITY_SAMPLES = 5;

	private const float THROW_FORCE_MULTIPLIER = 5f;

	public const float MIN_THROW_FORCE = 0.1f;

	private const float MAX_THROW_FORCE = 10f;

	private Vector2 _throw_momentum = Vector2.zero;

	private const float MOMENTUM_DECAY = 0.85f;

	private const float MOMENTUM_BUILD_RATE = 0.7f;

	public void initializeMouseTracking()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		_last_mouse_position = World.world.getMousePos();
		_velocity_samples.Clear();
		_throw_momentum = Vector2.zero;
	}

	public void trackMouseMovement(int pMagnetState)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		if (pMagnetState == 1)
		{
			Vector2 mousePos = World.world.getMousePos();
			Vector2 val = mousePos - _last_mouse_position;
			_mouse_velocity = val * 60f;
			_velocity_samples.Add(_mouse_velocity);
			if (_velocity_samples.Count > 5)
			{
				_velocity_samples.RemoveAt(0);
			}
			Vector2 val2 = val * 0.7f;
			_throw_momentum = Vector2.Lerp(_throw_momentum, val2, Time.deltaTime * 10f);
			_last_mouse_position = mousePos;
		}
	}

	public Vector2 calculateThrowForce()
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Vector2.zero;
		if (_velocity_samples.Count > 0)
		{
			foreach (Vector2 velocity_sample in _velocity_samples)
			{
				val += velocity_sample;
			}
			val /= (float)_velocity_samples.Count;
		}
		Vector2 result = val * 5f * Time.deltaTime;
		float magnitude = ((Vector2)(ref result)).magnitude;
		if (magnitude > 10f)
		{
			result = ((Vector2)(ref result)).normalized * 10f;
		}
		else if (magnitude < 0.1f && magnitude > 0.1f)
		{
			result = ((Vector2)(ref result)).normalized * 0.1f;
		}
		return result;
	}

	public void clear()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		_velocity_samples.Clear();
		_throw_momentum = Vector2.zero;
	}
}
// --- End of File: MagnetThrow.cs ---



// --- Start of File: Map.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class Map
{
	public string mapId;

	public string language;

	public string timestamp;

	public string userId;

	public string username;

	public string version;

	public string mapName;

	public string mapDescription;

	public int size;

	public int sortIndex;

	public List<MapTagType> mapTags;

	public MapMetaData mapMeta;

	public OnlineStats onlineStats = new OnlineStats
	{
		downloads = 0,
		plays = 0,
		favs = 0,
		reports = 0
	};

	public string formattedMapId
	{
		get
		{
			if (!string.IsNullOrEmpty(mapId) && mapId.Length == 12)
			{
				return "WB-" + mapId.Substring(0, 4) + "-" + mapId.Substring(4, 4) + "-" + mapId.Substring(8, 4);
			}
			return mapId;
		}
	}
}
// --- End of File: Map.cs ---



// --- Start of File: MapAction.cs ---
using System.Collections.Generic;
using UnityEngine;

public static class MapAction
{
	private static List<WorldTile> temp_list_tiles_road_path = new List<WorldTile>();

	private static List<WorldTile> temp_list_tiles_road_tiles_to_build = new List<WorldTile>();

	public static void checkAcidTerraform(WorldTile pTile)
	{
		if (pTile.isTemporaryFrozen())
		{
			pTile.unfreeze(99);
		}
		if (pTile.top_type != null && pTile.top_type.wasteland)
		{
			return;
		}
		if (pTile.top_type != null)
		{
			decreaseTile(pTile, pDamage: true);
		}
		else if (pTile.Type.ground)
		{
			if (pTile.isTileRank(TileRank.Low))
			{
				terraformTop(pTile, TopTileLibrary.wasteland_low);
			}
			else if (pTile.isTileRank(TileRank.High))
			{
				terraformTop(pTile, TopTileLibrary.wasteland_high);
			}
			AchievementLibrary.lets_not.check();
		}
	}

	public static void terraformMain(WorldTile pTile, TileType pType, bool pSkipTerraform = false)
	{
		terraformTile(pTile, pType, null, TerraformLibrary.flash, pSkipTerraform);
	}

	public static void terraformTop(WorldTile pTile, TopTileType pTopType, bool pSkipTerraform = false)
	{
		terraformTile(pTile, pTile.main_type, pTopType, TerraformLibrary.flash, pSkipTerraform);
	}

	public static void terraformMain(WorldTile pTile, TileType pType, TerraformOptions pOptions, bool pSkipTerraform = false)
	{
		terraformTile(pTile, pType, null, pOptions, pSkipTerraform);
	}

	public static void terraformTop(WorldTile pTile, TopTileType pTopType, TerraformOptions pOptions, bool pSkipTerraform = false)
	{
		terraformTile(pTile, pTile.main_type, pTopType, pOptions, pSkipTerraform);
	}

	public static void terraformTile(WorldTile pTile, TileType pNewTypeMain, TopTileType pTopType, TerraformOptions pOptions = null, bool pSkipTerraform = false)
	{
		if (pOptions == null)
		{
			pOptions = TerraformLibrary.flash;
		}
		TileTypeBase type = pTile.Type;
		TileTypeBase type2 = pTile.Type;
		if (pOptions.remove_fire)
		{
			pTile.stopFire();
		}
		if (!pSkipTerraform)
		{
			if (pOptions.remove_water && pTile.Type.ocean)
			{
				pNewTypeMain = pTile.Type.decrease_to;
			}
			if (pOptions.remove_top_tile && pTile.top_type != null)
			{
				pNewTypeMain = pTile.Type.decrease_to;
			}
			if (pOptions.remove_roads && pTile.Type.road)
			{
				pNewTypeMain = pTile.Type.decrease_to;
			}
			if (pOptions.remove_frozen && pTile.isTemporaryFrozen())
			{
				pTile.unfreeze(99);
			}
			if (pNewTypeMain != null)
			{
				pTile.setTileTypes(pNewTypeMain, pTopType);
			}
			else
			{
				pTile.setTopTileType(pTopType);
			}
		}
		if (type2.can_be_farm != pTile.Type.can_be_farm && !pTile.zone.hasCity())
		{
			World.world.city_zone_helper.city_place_finder.setDirty();
		}
		if ((pTile.burned_stages > 0 && !pTile.Type.can_be_set_on_fire) || pOptions.remove_burned)
		{
			pTile.removeBurn();
		}
		World.world.resetRedrawTimer();
		if (pOptions.remove_borders)
		{
			World.world.checkCityZone(pTile);
		}
		if (pOptions.flash)
		{
			World.world.flash_effects.flashPixel(pTile, 20);
		}
		if (pTile.hasBuilding() && !pTile.building.isRuin() && !pTile.building.asset.isOverlaysBiomeTags(pTile.Type))
		{
			if (pTile.building.asset.has_ruins_graphics)
			{
				pTile.building.startMakingRuins();
			}
			else
			{
				pTile.building.startDestroyBuilding();
			}
		}
		if (pOptions.make_ruins && pTile.hasBuilding())
		{
			Building building = pTile.building;
			if (building.asset.has_ruins_graphics)
			{
				building.startMakingRuins();
			}
			else
			{
				building.startDestroyBuilding();
			}
			if (!building.asset.can_be_placed_on_blocks && pTile.Type.rocks)
			{
				building.startDestroyBuilding();
			}
			if (!building.asset.can_be_placed_on_liquid && pTile.Type.liquid)
			{
				building.startDestroyBuilding();
			}
		}
		if (pOptions.destroy_buildings && pTile.hasBuilding())
		{
			bool flag = false;
			if (pOptions.ignore_kingdoms != null)
			{
				flag = true;
				for (int i = 0; i < pOptions.ignore_kingdoms.Length; i++)
				{
					if (!(pOptions.ignore_kingdoms[i] != pTile.building.kingdom?.name))
					{
						flag = false;
						break;
					}
				}
			}
			else if (pOptions.destroy_only == null)
			{
				flag = pOptions.ignore_buildings == null || !pOptions.ignore_buildings.Contains(pTile.building.asset.id);
			}
			else
			{
				flag = false;
				for (int j = 0; j < pOptions.destroy_only.Count; j++)
				{
					if (!(pOptions.destroy_only[j] != pTile.building.asset.group))
					{
						flag = true;
						break;
					}
				}
			}
			if (flag)
			{
				pTile.building.startDestroyBuilding();
			}
		}
		checkTileState(pTile, type);
	}

	public static void checkTileState(WorldTile pTile, TileTypeBase pOldType, bool pForceMapChunk = false)
	{
		if (pOldType.layer_type != pTile.Type.layer_type || pForceMapChunk)
		{
			World.world.map_chunk_manager.setDirty(pTile.chunk);
			MapChunk[] neighbours_all = pTile.chunk.neighbours_all;
			foreach (MapChunk pChunk in neighbours_all)
			{
				World.world.map_chunk_manager.setDirty(pChunk, pRegions: false);
			}
		}
		if (pTile.Type.layer_type != TileLayerType.Ground)
		{
			World.world.checkCityZone(pTile);
		}
		if (pTile.hasBuilding() && !pTile.building.asset.can_be_placed_on_liquid && pTile.Type.ocean)
		{
			pTile.building.startDestroyBuilding();
		}
	}

	public static void setOcean(WorldTile pTile)
	{
		if (pTile.Type.fill_to_ocean != null)
		{
			TileType pType = AssetManager.tiles.get(pTile.Type.fill_to_ocean);
			if (pTile.Type.water_fill_sound != string.Empty)
			{
				MusicBox.playSound(pTile.Type.water_fill_sound, pTile);
			}
			terraformMain(pTile, pType, TerraformLibrary.water_fill);
		}
	}

	public static void decreaseTile(WorldTile pTile, bool pDamage, TerraformOptions pTerraformOption)
	{
		if (checkTileDamageGaiaCovenant(pTile, pDamage))
		{
			if (pTile.isTemporaryFrozen())
			{
				pTile.unfreeze(100);
			}
			else if (pTile.top_type != null)
			{
				terraformTile(pTile, pTile.main_type, null, pTerraformOption);
			}
			else if (pTile.Type.decrease_to != null)
			{
				terraformMain(pTile, pTile.Type.decrease_to, pTerraformOption);
			}
		}
	}

	public static bool checkTileDamageGaiaCovenant(WorldTile pTile, bool pDamage)
	{
		bool flag = pTile.Type.life || pTile.Type.explodable;
		if (pDamage && WorldLawLibrary.world_law_gaias_covenant.isEnabled() && !flag)
		{
			return false;
		}
		return true;
	}

	public static void decreaseTile(WorldTile pTile, bool pDamage, string pTerraformOption = "flash")
	{
		if (checkTileDamageGaiaCovenant(pTile, pDamage))
		{
			decreaseTile(pTile, pDamage, AssetManager.terraform.get(pTerraformOption));
		}
	}

	public static void increaseTile(WorldTile pTile, bool pDamage, string pTerraformOption = "flash")
	{
		if (checkTileDamageGaiaCovenant(pTile, pDamage))
		{
			if (pTile.top_type != null)
			{
				terraformTile(pTile, pTile.main_type, null, AssetManager.terraform.get(pTerraformOption));
			}
			else if (pTile.Type.increase_to != null)
			{
				terraformMain(pTile, pTile.Type.increase_to, AssetManager.terraform.get(pTerraformOption));
			}
		}
	}

	public static void removeLiquid(WorldTile pTile)
	{
		if (pTile.Type.liquid)
		{
			decreaseTile(pTile, pDamage: false);
		}
	}

	public static void growGreens(WorldTile pTile, TopTileType pTopType)
	{
		terraformTop(pTile, pTopType, TerraformLibrary.flash);
	}

	public static void removeGreens(WorldTile pTile)
	{
		decreaseTile(pTile, pDamage: false);
	}

	private static void applyLightningEffect(WorldTile pTile)
	{
		if (pTile.Type.lava && pTile.heat > 20)
		{
			decreaseTile(pTile, pDamage: true);
			if (Randy.randomChance(0.9f))
			{
				int num = pTile.heat / 10;
				World.world.drop_manager.spawnParabolicDrop(pTile, "lava", 0f, 0.15f, 33f + (float)(num * 2), 1f, 40f + (float)num);
			}
			AchievementLibrary.lava_strike.check();
		}
		if (pTile.Type.layer_type == TileLayerType.Ocean)
		{
			removeLiquid(pTile);
			if (Randy.randomChance(0.8f))
			{
				World.world.drop_manager.spawnParabolicDrop(pTile, "rain", 0f, 1f, 66f, 1f, 45f);
			}
		}
		if (pTile.hasBuilding() && pTile.building.asset.spawn_drops)
		{
			if (!pTile.building.data.hasFlag("stop_spawn_drops"))
			{
				pTile.building.spawnBurstSpecial(10);
			}
			if (pTile.building.data.hasFlag("stop_spawn_drops"))
			{
				pTile.building.data.removeFlag("stop_spawn_drops");
			}
			else
			{
				pTile.building.data.addFlag("stop_spawn_drops");
			}
		}
	}

	public static void applyTileDamage(WorldTile pTargetTile, float pRad, TerraformOptions pOptions)
	{
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		World.world.resetRedrawTimer();
		BrushData brushData = Brush.get((int)pRad);
		World.world.conway_layer.checkKillRange(pTargetTile.pos, brushData.size);
		if (pOptions.remove_tornado)
		{
			tryRemoveTornadoFromTile(pTargetTile);
		}
		WorldBehaviourTileEffects.checkTileForEffectKill(pTargetTile, brushData.size);
		for (int i = 0; i < brushData.pos.Length; i++)
		{
			BrushPixelData brushPixelData = brushData.pos[i];
			Vector2Int pos = pTargetTile.pos;
			int num = ((Vector2Int)(ref pos)).x + brushPixelData.x;
			pos = pTargetTile.pos;
			int num2 = ((Vector2Int)(ref pos)).y + brushPixelData.y;
			if (num < 0 || num >= MapBox.width || num2 < 0 || num2 >= MapBox.height)
			{
				continue;
			}
			WorldTile tileSimple = World.world.GetTileSimple(num, num2);
			if (tileSimple.Type.grey_goo)
			{
				Config.grey_goo_damaged = true;
			}
			if (pOptions.add_burned && !tileSimple.Type.liquid)
			{
				tileSimple.setBurned();
			}
			if (pOptions.lightning_effect)
			{
				applyLightningEffect(tileSimple);
			}
			if (pOptions.add_heat != 0)
			{
				World.world.heat.addTile(tileSimple, pOptions.add_heat);
			}
			if (tileSimple.hasBuilding() && pOptions.damage_buildings)
			{
				bool flag = true;
				if (pOptions.ignore_kingdoms != null && tileSimple.building.isAlive() && !tileSimple.building.kingdom.isNature())
				{
					for (int j = 0; j < pOptions.ignore_kingdoms.Length; j++)
					{
						string pID = pOptions.ignore_kingdoms[j];
						Kingdom kingdom = World.world.kingdoms_wild.get(pID);
						if (tileSimple.building.kingdom == kingdom)
						{
							flag = false;
						}
					}
				}
				if (flag)
				{
					tileSimple.building.getHit(pOptions.damage);
				}
			}
			if (pOptions.set_fire)
			{
				tileSimple.startFire(pForce: true);
			}
			bool flag2 = false;
			if (pOptions.explode_tile)
			{
				flag2 = explodeTile(tileSimple, brushPixelData.dist, pRad, pTargetTile, pOptions);
			}
			if (pOptions.transform_to_wasteland && !flag2)
			{
				checkAcidTerraform(tileSimple);
			}
			if (tileSimple.hasUnits() && !string.IsNullOrEmpty(pOptions.add_trait))
			{
				tileSimple.doUnits(delegate(Actor tActor)
				{
					tActor.addTrait(pOptions.add_trait);
				});
			}
		}
	}

	public static bool explodeTile(WorldTile pTile, float pDist, float pRadius, WorldTile pExplosionCenter, TerraformOptions pOptions)
	{
		if (pOptions.damage > 0)
		{
			pTile.doUnits(delegate(Actor tActor)
			{
				if (!tActor.asset.very_high_flyer || pOptions.applies_to_high_flyers)
				{
					tActor.getHit(pOptions.damage, pFlash: true, AttackType.Explosion);
				}
			});
		}
		if (pTile.isTemporaryFrozen())
		{
			pTile.unfreeze();
		}
		float num = 0f;
		num = pDist / pRadius;
		float num2 = 1f - num;
		int num3 = (int)(30f * num2);
		if (num3 <= 0)
		{
			return false;
		}
		bool liquid = pTile.Type.liquid;
		if (!pTile.Type.explodable && Randy.random() > num2)
		{
			return false;
		}
		World.world.game_stats.data.pixelsExploded++;
		if (pOptions.explosion_pixel_effect)
		{
			World.world.explosion_layer.setDirty(pTile, pDist, pRadius);
		}
		num3 -= (int)((double)num3 * 0.5 * (double)Randy.random() * (double)num);
		if (pTile.Type.explodable && pTile.explosion_wave == 0)
		{
			World.world.explosion_layer.explodeBomb(pTile);
		}
		if (pTile.Type.explodable_delayed)
		{
			World.world.explosion_layer.activateDelayedBomb(pTile);
		}
		if (pTile.Type.strength <= pOptions.explode_strength)
		{
			decreaseTile(pTile, pDamage: true, TerraformLibrary.flash);
		}
		if (pTile.hasBuilding() && pTile.Type.liquid && !pTile.building.asset.can_be_placed_on_liquid)
		{
			pTile.building.startDestroyBuilding();
		}
		if (!liquid)
		{
			pTile.setBurned();
			if (pOptions.explode_and_set_random_fire)
			{
				if ((double)Randy.random() > 0.8)
				{
					pTile.startFire(pForce: true);
				}
				else
				{
					pTile.startFire();
				}
			}
		}
		return true;
	}

	public static void damageWorld(WorldTile pTile, int pRad, TerraformOptions pOptions, BaseSimObject pByWho = null)
	{
		if (pOptions.shake)
		{
			World.world.startShake(pOptions.shake_duration, pOptions.shake_interval, pOptions.shake_intensity);
		}
		if (pOptions.apply_force)
		{
			World.world.applyForceOnTile(pTile, pRad, pOptions.force_power, pForceOut: true, pOptions.damage, pOptions.ignore_kingdoms, pByWho, pOptions);
		}
		applyTileDamage(pTile, pRad, pOptions);
	}

	public static void makeTileChanged(WorldTile pTile)
	{
		World.world.resetRedrawTimer();
	}

	public static void removeLifeFromTile(WorldTile pTile)
	{
		World.world.conway_layer.remove(pTile);
		if (pTile.Type.life)
		{
			decreaseTile(pTile, pDamage: false, "destroy_life");
		}
		double tClickStartedAt = World.world.player_control.click_started_at;
		pTile.doUnits(delegate(Actor tActor)
		{
			if (tActor.a.asset.can_be_killed_by_life_eraser && !(tActor.a.created_time_unscaled >= tClickStartedAt))
			{
				AchievementLibrary.not_on_my_watch.check(tActor);
				tActor.applyRandomForce();
				tActor.getHitFullHealth(AttackType.Divine);
			}
		});
		HashSet<TornadoEffect> tornadoesFromTile = TornadoEffect.getTornadoesFromTile(pTile);
		if (tornadoesFromTile == null)
		{
			return;
		}
		using ListPool<TornadoEffect> listPool = new ListPool<TornadoEffect>(tornadoesFromTile);
		foreach (ref TornadoEffect item in listPool)
		{
			item.die();
		}
	}

	public static void createRoadTile(WorldTile pTile)
	{
		terraformTop(pTile, TopTileLibrary.road, AssetManager.terraform.get("road"));
	}

	public static void createRoadTilesToBuild(List<WorldTile> pPath, WorldTile pFrom, WorldTile pTarget, bool pForceFinished = false)
	{
		if (pPath.Count > 20 || (pTarget.road_island != null && pTarget.road_island == pFrom.road_island))
		{
			return;
		}
		for (int i = 0; i < pPath.Count; i++)
		{
			WorldTile worldTile = pPath[i];
			if (!worldTile.Type.road)
			{
				if (pFrom != worldTile && pFrom.road_island != null && worldTile.road_island == pTarget.road_island)
				{
					return;
				}
				temp_list_tiles_road_tiles_to_build.Add(worldTile);
				if (pForceFinished)
				{
					createRoadTile(worldTile);
				}
			}
		}
		World.world.resetRedrawTimer();
	}

	public static void makeRoadBetween(WorldTile pTile1, WorldTile pTile2, City pCity = null, bool pForceFinished = false)
	{
		if (pTile1.road_island == null || pTile1.road_island != pTile2.road_island)
		{
			temp_list_tiles_road_path.Clear();
			temp_list_tiles_road_tiles_to_build.Clear();
			World.world.pathfinding_param.resetParam();
			World.world.pathfinding_param.roads = true;
			World.world.calcPath(pTile1, pTile2, temp_list_tiles_road_path);
			createRoadTilesToBuild(temp_list_tiles_road_path, pTile1, pTile2, pForceFinished);
			pCity?.addRoads(temp_list_tiles_road_tiles_to_build);
		}
	}

	public static void tryRemoveTornadoFromTile(WorldTile pTile)
	{
		HashSet<TornadoEffect> tornadoesFromTile = TornadoEffect.getTornadoesFromTile(pTile);
		if (tornadoesFromTile == null)
		{
			return;
		}
		using ListPool<TornadoEffect> listPool = new ListPool<TornadoEffect>(tornadoesFromTile);
		foreach (ref TornadoEffect item in listPool)
		{
			item.die();
		}
	}

	public static void checkSantaHit(Vector2Int pPos, int pRad)
	{
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		List<BaseEffect> list = World.world.stack_effects.get("fx_santa").getList();
		for (int i = 0; i < list.Count; i++)
		{
			Santa component = ((Component)list[i]).GetComponent<Santa>();
			if (component.active && component.alive)
			{
				Vector3 localPosition = ((Component)component).transform.localPosition;
				if (!(Toolbox.Dist(((Vector2Int)(ref pPos)).x, 0f, localPosition.x, 0f) > (float)pRad) && !(localPosition.y < (float)((Vector2Int)(ref pPos)).y) && !(localPosition.y - 20f > (float)((Vector2Int)(ref pPos)).y))
				{
					component.alive = false;
					AchievementLibrary.mayday.check();
				}
			}
		}
	}

	public static void checkUFOHit(Vector2Int pPos, int pRad, Actor pActor)
	{
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		Kingdom kingdom = World.world.kingdoms_wild.get("aliens");
		if (kingdom.units.Count == 0)
		{
			return;
		}
		List<Actor> units = kingdom.units;
		for (int i = 0; i < units.Count; i++)
		{
			Actor actor = units[i];
			if (actor.isAlive())
			{
				Vector3 val = Vector2.op_Implicit(actor.current_position);
				if (!(Toolbox.Dist(((Vector2Int)(ref pPos)).x, 0f, val.x, 0f) > (float)pRad) && !(val.y < (float)((Vector2Int)(ref pPos)).y) && !(val.y - 10f > (float)((Vector2Int)(ref pPos)).y) && actor.asset.flag_ufo)
				{
					actor.getHit(actor.getHealth(), pFlash: true, AttackType.Other, pActor);
				}
			}
		}
	}

	public static void checkTornadoHit(Vector2Int pPos, int pRad)
	{
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		if (!World.world.stack_effects.get("fx_tornado").isAnyActive())
		{
			return;
		}
		using ListPool<BaseEffect> listPool = new ListPool<BaseEffect>(World.world.stack_effects.get("fx_tornado").getList());
		for (int i = 0; i < listPool.Count; i++)
		{
			if (listPool[i].active)
			{
				TornadoEffect tornadoEffect = (TornadoEffect)listPool[i];
				if (!tornadoEffect.isKilled() && !(Toolbox.DistVec2Float(Vector2.op_Implicit(((Component)tornadoEffect).transform.localPosition), Vector2Int.op_Implicit(pPos)) > (float)pRad))
				{
					tornadoEffect.split();
				}
			}
		}
	}

	public static void checkLightningAction(Vector2Int pPos, int pRad, Actor pActor = null, bool pCheckForImmortal = false, bool pCheckMayIInterrupt = false)
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		bool flag = false;
		int num = pRad * pRad;
		List<Actor> simpleList = World.world.units.getSimpleList();
		for (int i = 0; i < simpleList.Count; i++)
		{
			Actor actor = simpleList[i];
			if (Toolbox.SquaredDistVec2(actor.current_tile.pos, pPos) > num)
			{
				continue;
			}
			if (actor.asset.flag_finger)
			{
				actor.getActorComponent<GodFinger>().lightAction();
				actor.getHit(1f, pFlash: true, AttackType.Other, pActor);
				continue;
			}
			if (pCheckForImmortal && !flag && !actor.hasTrait("immortal") && Randy.randomChance(0.2f))
			{
				actor.addTrait("immortal");
				actor.addTrait("energized");
				flag = true;
			}
			if (pCheckMayIInterrupt)
			{
				AchievementLibrary.may_i_interrupt.checkBySignal(actor.ai.task?.id);
			}
		}
	}
}
// --- End of File: MapAction.cs ---



// --- Start of File: MapBorder.cs ---
using System.Collections.Generic;
using UnityEngine;

public class MapBorder : BaseEffect
{
	private int currentState;

	private WorldTimer updateTimer;

	private WorldTimer alphaTimer;

	private int curWidth;

	private int curHeight;

	internal override void create()
	{
		base.create();
		updateTimer = new WorldTimer(0.12f, updateEffect);
		alphaTimer = new WorldTimer(0.02f, updateAlpha);
	}

	internal void generateTexture()
	{
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Expected O, but got Unknown
		//IL_0288: Unknown result type (might be due to invalid IL or missing references)
		//IL_0297: Unknown result type (might be due to invalid IL or missing references)
		//IL_02d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0243: Unknown result type (might be due to invalid IL or missing references)
		//IL_0248: Unknown result type (might be due to invalid IL or missing references)
		//IL_024d: Unknown result type (might be due to invalid IL or missing references)
		if (curWidth == MapBox.width && curHeight == MapBox.height)
		{
			return;
		}
		curWidth = MapBox.width;
		curHeight = MapBox.height;
		SpriteRenderer component = ((Component)this).gameObject.GetComponent<SpriteRenderer>();
		Texture2D val = new Texture2D(curWidth, curHeight, (TextureFormat)4, false);
		((Texture)val).filterMode = (FilterMode)0;
		((Object)val).name = "MapBorder_" + curWidth + "x" + curHeight;
		int num = ((Texture)val).height * ((Texture)val).width;
		Color32[] array = (Color32[])(object)new Color32[num];
		List<int> list = new List<int>();
		List<int> list2 = new List<int>();
		int num2 = 0;
		int num3 = 0;
		list2.Clear();
		num2 = 0;
		num3 = 0;
		for (int i = 0; i < num; i++)
		{
			if (num3 == 0 && !list.Contains(i))
			{
				list2.Add(i);
			}
			num2++;
			if (num2 >= curWidth)
			{
				num2 = 0;
				num3++;
			}
		}
		list.AddRange(list2);
		list2.Clear();
		num2 = 0;
		num3 = 0;
		for (int j = 0; j < num; j++)
		{
			if (num2 == curWidth - 1 && !list.Contains(j))
			{
				list2.Add(j);
			}
			num2++;
			if (num2 >= curWidth)
			{
				num2 = 0;
				num3++;
			}
		}
		list.AddRange(list2);
		list2.Clear();
		num2 = 0;
		num3 = 0;
		for (int k = 0; k < num; k++)
		{
			if (num3 == curHeight - 1 && !list.Contains(k))
			{
				list2.Add(k);
			}
			num2++;
			if (num2 >= curWidth)
			{
				num2 = 0;
				num3++;
			}
		}
		list.AddRange(list2);
		list2.Clear();
		num2 = 0;
		num3 = 0;
		for (int l = 0; l < num; l++)
		{
			if (num2 == 0 && !list.Contains(l))
			{
				list2.Add(l);
			}
			num2++;
			if (num2 >= curWidth)
			{
				num2 = 0;
				num3++;
			}
		}
		list2.Reverse();
		list.AddRange(list2);
		int num4 = 0;
		for (int m = 0; m < list.Count; m++)
		{
			int num5 = list[m];
			if (num4 == 0 || num4 == 1 || num4 == 2)
			{
				array[num5] = Color32.op_Implicit(Color.white);
				num4++;
			}
			else
			{
				num4 = 0;
			}
		}
		component.sprite = Sprite.Create(val, new Rect(0f, 0f, (float)((Texture)val).width, (float)((Texture)val).height), new Vector2(0.5f, 0.5f), 1f);
		val.SetPixels32(array);
		val.Apply();
		((Component)this).gameObject.transform.localPosition = new Vector3((float)(curWidth / 2), (float)(curHeight / 2));
	}

	private void Update()
	{
		updateTimer.update();
		alphaTimer.update();
	}

	private void updateAlpha()
	{
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)World.world.selected_buttons.selectedButton == (Object)null)
		{
			alpha -= 0.02f;
			if (alpha < 0f)
			{
				alpha = 0f;
			}
		}
		else
		{
			alpha += 0.02f;
			if (alpha > 0.42f)
			{
				alpha = 0.42f;
			}
		}
		if (sprite_renderer.color.a != alpha)
		{
			setAlpha(alpha);
		}
	}

	private void updateEffect()
	{
		if (alpha != 0f)
		{
			currentState++;
			if (currentState > 3)
			{
				currentState = 0;
			}
			switch (currentState)
			{
			case 0:
				sprite_renderer.flipX = false;
				sprite_renderer.flipY = false;
				break;
			case 1:
				sprite_renderer.flipX = true;
				sprite_renderer.flipY = false;
				break;
			case 2:
				sprite_renderer.flipX = true;
				sprite_renderer.flipY = true;
				break;
			case 3:
				sprite_renderer.flipX = false;
				sprite_renderer.flipY = true;
				break;
			}
		}
	}
}
// --- End of File: MapBorder.cs ---



// --- Start of File: MapBox.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using DG.Tweening;
using EpPathFinding.cs;
using UnityEngine;
using WorldBoxConsole;
using ai;
using ai.behaviours;
using db;
using life.taxi;
using tools.debug;

public class MapBox : MonoBehaviour
{
	internal GameObject joys;

	public const float TRANSITION_EFFECT_ALPHA = 0.1f;

	public const float TRANSITION_EFFECT_ALPHA_SPEED = 0.1f;

	internal SaveManager save_manager;

	internal ResourceThrowManager resource_throw_manager;

	internal GameStats game_stats;

	internal WorldObject world_object = new WorldObject();

	internal MapStats map_stats = new MapStats();

	internal WorldLaws world_laws;

	internal HotkeyTabsData hotkey_tabs_data;

	internal Canvas canvas;

	public static MapBox instance;

	internal PowerButtonSelector selected_buttons;

	internal ParallelOptions parallel_options;

	public Transform drag_parent;

	public static int width;

	public static int height;

	public static int current_world_seed_id;

	internal WorldTile[,] tiles_map;

	internal WorldTile[] tiles_list;

	public readonly List<BaseSystemManager> list_all_sim_managers = new List<BaseSystemManager>();

	private readonly List<BaseSystemManager> _list_meta_other_managers = new List<BaseSystemManager>();

	private readonly List<BaseSystemManager> _list_meta_main_managers = new List<BaseSystemManager>();

	private readonly List<BaseSystemManager> _list_sim_objects_managers = new List<BaseSystemManager>();

	public ProjectileManager projectiles;

	public StatusManager statuses;

	public CityManager cities;

	public WarManager wars;

	public PlotManager plots;

	public AllianceManager alliances;

	public ClanManager clans;

	public KingdomManager kingdoms;

	public WildKingdomsManager kingdoms_wild;

	public CultureManager cultures;

	public BookManager books;

	public SubspeciesManager subspecies;

	public ReligionManager religions;

	public LanguageManager languages;

	public FamilyManager families;

	public ArmyManager armies;

	public ItemManager items;

	public DiplomacyManager diplomacy;

	public BuildingManager buildings;

	public ActorManager units;

	public TileManager tile_manager;

	internal WorldTilemap tilemap;

	private float _redraw_timer;

	private bool _initiated;

	private DebugLayer _debug_layer;

	internal readonly RegionPathFinder region_path_finder = new RegionPathFinder();

	internal LoadingScreen transition_screen;

	internal StackEffects stack_effects;

	public DropManager drop_manager;

	internal PathFindingVisualiser path_finding_visualiser;

	internal WorldLayer world_layer;

	internal SpriteRenderer _world_layer_switch_effect;

	internal WorldLayerEdges world_layer_edges;

	internal UnitLayer unit_layer;

	internal GreyGooLayer grey_goo_layer;

	internal FireLayer fire_layer;

	private LavaLayer _lava_layer;

	internal PixelFlashEffects flash_effects;

	internal IslandsCalculator islands_calculator;

	internal ZoneCalculator zone_calculator;

	internal RoadsCalculator roads_calculator;

	internal BurnedTilesLayer burned_layer;

	internal ExplosionsEffects explosion_layer;

	internal ConwayLife conway_layer;

	internal MapChunkManager map_chunk_manager;

	internal AutoCivilization civilization_maker;

	private List<MapLayer> _map_layers;

	private List<BaseModule> _map_modules;

	internal Earthquake earthquake_manager;

	public Vector2 wind_direction;

	private StaticGrid _search_grid_ground;

	internal HashSet<WorldTile> tiles_dirty;

	internal GlowParticles particles_fire;

	internal GlowParticles particles_smoke;

	internal NameplateManager nameplate_manager;

	internal WorldBoxConsole.Console console;

	internal bool has_focus = true;

	internal Heat heat;

	internal HeatRayEffect heat_ray_fx;

	internal EffectDivineLight fx_divine_light;

	private MapBorder _map_border;

	internal QualityChanger quality_changer;

	internal Transform transform_units;

	internal SimObjectsZones sim_object_zones;

	internal Tutorial tutorial;

	private WorldLog _world_log;

	internal Magnet magnet;

	internal float timer_nutrition_decay;

	internal AutoTesterBot auto_tester;

	private UnitSelectionEffect _unit_select_effect;

	private readonly List<SpriteGroupSystem<GroupSpriteObject>> _list_systems = new List<SpriteGroupSystem<GroupSpriteObject>>();

	public static CursorSpeed cursor_speed;

	private DebugTextGroupSystem _debug_text_group_system;

	private SignalManager _signal_manager;

	internal ExplosionChecker explosion_checker;

	internal WorldAgeManager era_manager;

	public DelayedActionsManager delayed_actions_manager;

	public PlayerControl player_control;

	private bool _first_gen = true;

	private int _load_counter;

	private float _shake_timer;

	private float _shake_interval_timer;

	private float _shake_intensity = 1f;

	private float _shake_interval = 0.1f;

	private bool _shake_x = true;

	private bool _shake_y = true;

	private Transform _shake_camera;

	internal float elapsed;

	internal float delta_time;

	internal float fixed_delta_time;

	public readonly CityZoneHelper city_zone_helper = new CityZoneHelper();

	internal static Action on_world_loaded;

	private static int _tile_id;

	internal readonly AStarParam pathfinding_param = new AStarParam();

	internal int dirty_tiles_last;

	private bool _is_paused;

	private int _render_skip;

	private bool _meta_skip = true;

	private MetaTypeAsset _cached_map_meta_asset;

	private ArchitectMood _cached_architect_mood;

	internal LibraryMaterials library_materials => LibraryMaterials.instance;

	internal Camera camera { get; private set; }

	internal MoveCamera move_camera { get; private set; }

	internal ZoneCamera zone_camera { get; private set; }

	public GodPower selected_power => selected_buttons.selectedButton?.godPower;

	private void Awake()
	{
		//IL_046f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0474: Unknown result type (might be due to invalid IL or missing references)
		instance = this;
		player_control = new PlayerControl();
		parallel_options = new ParallelOptions
		{
			CancellationToken = ((MonoBehaviour)this).destroyCancellationToken
		};
		auto_tester = Object.FindFirstObjectByType<AutoTesterBot>((FindObjectsInactive)1);
		save_manager = ((Component)this).GetComponentInChildren<SaveManager>();
		game_stats = ((Component)this).GetComponentInChildren<GameStats>();
		tilemap = ((Component)this).GetComponentInChildren<WorldTilemap>();
		_map_border = ((Component)this).GetComponentInChildren<MapBorder>();
		stack_effects = ((Component)this).GetComponentInChildren<StackEffects>();
		resource_throw_manager = new ResourceThrowManager();
		heat_ray_fx = ((Component)this).GetComponentInChildren<HeatRayEffect>();
		fx_divine_light = ((Component)this).GetComponentInChildren<EffectDivineLight>();
		particles_fire = ((Component)((Component)this).transform.Find("Particles Fire")).GetComponent<GlowParticles>();
		particles_smoke = ((Component)((Component)this).transform.Find("Particles Smoke")).GetComponent<GlowParticles>();
		_shake_camera = GameObject.Find("CameraShake").transform;
		Transform transform = GameObject.Find("Canvas Container Main").transform;
		canvas = ((Component)transform.FindRecursive("Canvas - UI/General")).GetComponent<Canvas>();
		transition_screen = ((Component)transform).GetComponentInChildren<LoadingScreen>(true);
		console = ((Component)transform).GetComponentInChildren<WorldBoxConsole.Console>(true);
		nameplate_manager = ((Component)transform).GetComponentInChildren<NameplateManager>(true);
		tutorial = ((Component)transform).GetComponentInChildren<Tutorial>(true);
		selected_buttons = ((Component)transform).GetComponentInChildren<PowerButtonSelector>();
		cursor_speed = new CursorSpeed();
		_signal_manager = new SignalManager();
		joys = GameObject.Find("Joys");
		joys.gameObject.SetActive(false);
		magnet = new Magnet();
		islands_calculator = new IslandsCalculator();
		sim_object_zones = new SimObjectsZones();
		_world_log = new WorldLog();
		quality_changer = ((Component)this).GetComponent<QualityChanger>();
		transform_units = ((Component)this).transform.FindRecursive("Units");
		stack_effects.create();
		tiles_dirty = new HashSet<WorldTile>();
		tiles_list = new WorldTile[0];
		tile_manager = new TileManager();
		drop_manager = new DropManager(((Component)this).transform.Find("Drops"));
		_list_meta_main_managers.Add(subspecies = new SubspeciesManager());
		_list_meta_main_managers.Add(families = new FamilyManager());
		_list_meta_main_managers.Add(armies = new ArmyManager());
		_list_meta_main_managers.Add(languages = new LanguageManager());
		_list_meta_main_managers.Add(religions = new ReligionManager());
		_list_meta_main_managers.Add(cities = new CityManager());
		_list_meta_main_managers.Add(clans = new ClanManager());
		_list_meta_main_managers.Add(alliances = new AllianceManager());
		_list_meta_main_managers.Add(kingdoms = new KingdomManager());
		_list_meta_main_managers.Add(kingdoms_wild = new WildKingdomsManager());
		_list_meta_main_managers.Add(cultures = new CultureManager());
		_list_meta_main_managers.Add(plots = new PlotManager());
		_list_meta_main_managers.Add(wars = new WarManager());
		_list_meta_main_managers.Add(items = new ItemManager());
		_list_meta_other_managers.Add(books = new BookManager());
		_list_meta_other_managers.Add(diplomacy = new DiplomacyManager());
		_list_meta_other_managers.Add(projectiles = new ProjectileManager());
		_list_meta_other_managers.Add(statuses = new StatusManager());
		_list_sim_objects_managers.Add(units = new ActorManager());
		_list_sim_objects_managers.Add(buildings = new BuildingManager());
		list_all_sim_managers.AddRange(_list_sim_objects_managers);
		list_all_sim_managers.AddRange(_list_meta_main_managers);
		list_all_sim_managers.AddRange(_list_meta_other_managers);
		heat = new Heat();
		wind_direction = new Vector2(-0.1f, 0.2f);
		era_manager = new WorldAgeManager();
		delayed_actions_manager = new DelayedActionsManager();
		AssetManager.world_behaviours.createManagers();
		((Component)this).gameObject.AddOrGetComponent<MusicBox>();
		DOTween.SetTweensCapacity(1000, 100);
	}

	private void Start()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Expected O, but got Unknown
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Expected O, but got Unknown
		//IL_024f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0256: Expected O, but got Unknown
		//IL_0280: Unknown result type (might be due to invalid IL or missing references)
		Application.lowMemory += new LowMemoryCallback(AutoSaveManager.OnLowMemory);
		Application.lowMemory += new LowMemoryCallback(PlayerConfig.turnOffAssetsPreloading);
		PlayerConfig.instance.start();
		explosion_checker = new ExplosionChecker();
		camera = Camera.main;
		move_camera = ((Component)camera).GetComponent<MoveCamera>();
		_initiated = true;
		_map_layers = new List<MapLayer>();
		_map_modules = new List<BaseModule>();
		_map_layers.Add(world_layer = ((Component)this).GetComponentInChildren<WorldLayer>());
		_map_layers.Add(world_layer_edges = ((Component)this).GetComponentInChildren<WorldLayerEdges>());
		_world_layer_switch_effect = ((Component)((Component)this).gameObject.transform.Find("world_layer_back")).GetComponent<SpriteRenderer>();
		_map_layers.Add(unit_layer = ((Component)this).GetComponentInChildren<UnitLayer>());
		_map_layers.Add(zone_calculator = ((Component)this).GetComponentInChildren<ZoneCalculator>());
		_map_layers.Add(burned_layer = ((Component)this).GetComponentInChildren<BurnedTilesLayer>());
		_map_layers.Add(explosion_layer = ((Component)this).GetComponentInChildren<ExplosionsEffects>());
		_map_layers.Add(conway_layer = ((Component)this).GetComponentInChildren<ConwayLife>());
		_map_layers.Add(fire_layer = ((Component)this).GetComponentInChildren<FireLayer>());
		_map_layers.Add(_lava_layer = ((Component)this).GetComponentInChildren<LavaLayer>());
		_map_layers.Add(_debug_layer = ((Component)this).GetComponentInChildren<DebugLayer>());
		_map_layers.Add(((Component)this).GetComponentInChildren<DebugLayerCursor>());
		_map_layers.Add(path_finding_visualiser = ((Component)this).GetComponentInChildren<PathFindingVisualiser>());
		_map_layers.Add(flash_effects = ((Component)this).GetComponentInChildren<PixelFlashEffects>());
		_map_modules.Add(roads_calculator = ((Component)this).GetComponentInChildren<RoadsCalculator>());
		_map_modules.Add(grey_goo_layer = ((Component)this).GetComponentInChildren<GreyGooLayer>());
		map_chunk_manager = new MapChunkManager();
		zone_camera = new ZoneCamera();
		if (Config.isComputer || Config.isEditor)
		{
			GameObject val = (GameObject)Resources.Load("effects/PrefabUnitSelectionEffect");
			_unit_select_effect = Object.Instantiate<GameObject>(val, ((Component)this).gameObject.transform).GetComponent<UnitSelectionEffect>();
			_unit_select_effect.create();
		}
		addNewSystem(_debug_text_group_system = new GameObject().AddComponent<DebugTextGroupSystem>());
		foreach (SpriteGroupSystem<GroupSpriteObject> list_system in _list_systems)
		{
			list_system.create();
		}
	}

	private void addNewSystem(SpriteGroupSystem<GroupSpriteObject> pSystem)
	{
		_list_systems.Add(pSystem);
		((Component)pSystem).transform.parent = ((Component)this).transform;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isGameplayControlsLocked()
	{
		if (!ScrollWindow.isWindowActive() && !ScrollWindow.isAnimationActive())
		{
			return RewardedAds.isShowing();
		}
		return true;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isWindowOnScreen()
	{
		if (!ScrollWindow.isWindowActive())
		{
			return ScrollWindow.isAnimationActive();
		}
		return true;
	}

	internal bool calcPath(WorldTile pFrom, WorldTile pTargetTile, List<WorldTile> pSavePath)
	{
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		pSavePath.Clear();
		StaticGrid search_grid_ground = _search_grid_ground;
		HeuristicMode heuristic = HeuristicMode.MANHATTAN;
		float weight = 2f;
		DiagonalMovement diagonalMovement;
		int num;
		if (pathfinding_param.ocean)
		{
			num = 50;
			diagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;
		}
		else
		{
			if (pathfinding_param.limit)
			{
				num = 500;
			}
			else
			{
				num = -1;
			}
			diagonalMovement = DiagonalMovement.Always;
		}
		num = -1;
		if (pathfinding_param.roads)
		{
			weight = 1f;
			diagonalMovement = DiagonalMovement.Never;
			heuristic = HeuristicMode.EUCLIDEAN;
		}
		search_grid_ground.Reset();
		if (!pFrom.isSameIsland(pTargetTile) && !pathfinding_param.ocean)
		{
			pSavePath.Add(pFrom);
			pSavePath.Add(pTargetTile);
			path_finding_visualiser.showPath(search_grid_ground, pSavePath);
			return true;
		}
		Vector2Int pos = pFrom.pos;
		int x = ((Vector2Int)(ref pos)).x;
		pos = pFrom.pos;
		GridPos iStartPos = new GridPos(x, ((Vector2Int)(ref pos)).y);
		pos = pTargetTile.pos;
		int x2 = ((Vector2Int)(ref pos)).x;
		pos = pTargetTile.pos;
		GridPos iEndPos = new GridPos(x2, ((Vector2Int)(ref pos)).y);
		pathfinding_param.setGrid(search_grid_ground, iStartPos, iEndPos);
		pathfinding_param.DiagonalMovement = diagonalMovement;
		pathfinding_param.SetHeuristic(heuristic);
		pathfinding_param.max_open_list = num;
		pathfinding_param.weight = weight;
		AStarFinder.FindPath(pathfinding_param, pSavePath);
		path_finding_visualiser.showPath(search_grid_ground, pSavePath);
		if (pSavePath.Count == 0)
		{
			return false;
		}
		return true;
	}

	public void startTheGame(bool pForceGenerate = false)
	{
		LogText.log("MapBox", "startTheGame", "st");
		Randy.fullReset();
		Config.game_loaded = true;
		Config.current_brush = "circ_5";
		if (Config.isMobile)
		{
			PlayInterstitialAd.setActive(pActive: true);
		}
		Config.LOAD_TIME_CREATE = Time.realtimeSinceStartup;
		if (pForceGenerate || Config.load_new_map)
		{
			generateNewMap();
		}
		else if (Config.load_random_test_map)
		{
			TestMaps.loadNextMap();
		}
		else if (Config.load_dragon)
		{
			SaveManager.loadMapFromResources("mapTemplates/map_dragon");
		}
		else if (Config.load_save_on_start)
		{
			_first_gen = false;
			string slotSavePath = SaveManager.getSlotSavePath(Config.load_save_on_start_slot);
			save_manager.loadWorld(slotSavePath);
		}
		else if (Config.load_save_from_path)
		{
			SaveManager.loadMapFromResources(Config.load_test_save_path);
		}
		else if (Config.load_test_map)
		{
			DebugMap.makeDebugMap();
		}
		else
		{
			string text = "";
			try
			{
				text = DateTime.Now.ToString("MM/dd");
			}
			catch (Exception)
			{
				text = "";
			}
			if (text == "04/01")
			{
				SaveManager.loadMapFromResources("mapTemplates/map_april_fools");
			}
			else if (FavoriteWorld.hasFavoriteWorldSet())
			{
				int favorite_world = PlayerConfig.instance.data.favorite_world;
				FavoriteWorld.cacheSaveSlotID(favorite_world);
				FavoriteWorld.clearFavoriteWorld();
				_first_gen = false;
				string slotSavePath2 = SaveManager.getSlotSavePath(favorite_world);
				save_manager.loadWorld(slotSavePath2);
			}
			else if (game_stats.data.gameLaunches <= 3)
			{
				SaveManager.loadMapFromResources("mapTemplates/map_dragon");
			}
			else
			{
				generateNewMap();
				SmoothLoader.add(delegate
				{
					buildings.addBuilding("volcano", GetTile(width / 2, height / 2));
				}, "add_volcano");
				SmoothLoader.add(delegate
				{
					WorldTile tile = GetTile(0, height - 1);
					WorldTile tile2 = GetTile(width - 1, height - 1);
					WorldTile tile3 = GetTile(0, 0);
					WorldTile tile4 = GetTile(width - 1, 0);
					units.spawnNewUnit("angle", tile, pSpawnSound: false, pMiracleSpawn: true).setName("DAB", pTrack: false);
					units.spawnNewUnit("angle", tile2, pSpawnSound: false, pMiracleSpawn: true).setName("ABC", pTrack: false);
					units.spawnNewUnit("angle", tile3, pSpawnSound: false, pMiracleSpawn: true).setName("CDA", pTrack: false);
					units.spawnNewUnit("angle", tile4, pSpawnSound: false, pMiracleSpawn: true).setName("BCD", pTrack: false);
				}, "spawn_angles");
			}
		}
		SmoothLoader.add(addLastStep, "Prepare Game Launch");
	}

	private void addLastStep()
	{
		SmoothLoader.add(delegate
		{
			Config.LOAD_TIME_GENERATE = Time.realtimeSinceStartup;
			((Renderer)((Component)this).GetComponent<SpriteRenderer>()).enabled = true;
			((Component)nameplate_manager).gameObject.SetActive(true);
			FavoriteWorld.restoreCachedFavoriteWorldOnSuccess();
			if (!Config.disable_startup_window)
			{
				if (PlayerConfig.instance.data.tutorialFinished || Config.disable_tutorial)
				{
					ScrollWindow.get("welcome").forceShow();
				}
				else
				{
					tutorial.startTutorial();
				}
			}
			PremiumElementsChecker.checkElements();
			MonoBehaviour.print((object)("LOAD TIME INIT: " + Config.LOAD_TIME_INIT));
			MonoBehaviour.print((object)("LOAD TIME CREATE: " + (Config.LOAD_TIME_CREATE - Config.LOAD_TIME_INIT)));
			MonoBehaviour.print((object)("LOAD TIME GENERATE: " + (Config.LOAD_TIME_GENERATE - Config.LOAD_TIME_CREATE)));
			LogText.log("MapBox", "startTheGame", "en");
		}, "Start the Game", pSkipFrame: false, 0.001f, pToEnd: true);
	}

	private void afterLoadEvent()
	{
		Debug.Log((object)"afterLoadEvent--------------------------");
		PremiumElementsChecker.checkElements();
	}

	internal void centerCamera()
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		Vector3 position = ((Component)camera).transform.position;
		position.x = width / 2;
		position.y = height / 2;
		((Component)camera).transform.position = position;
		move_camera.resetZoom();
	}

	private void resetTiles()
	{
		_search_grid_ground?.Reset();
		WorldTile[] array = tiles_list;
		for (int i = 0; i < array.Length; i++)
		{
			array[i].clear();
		}
		tiles_dirty.Clear();
		tilemap.clear();
	}

	private void clearTiles()
	{
		_search_grid_ground?.Dispose();
		_search_grid_ground = null;
		zone_calculator.clean();
		map_chunk_manager.clean();
		WorldTile[] array = tiles_list;
		for (int i = 0; i < array.Length; i++)
		{
			array[i].Dispose();
		}
		tiles_list = new WorldTile[0];
		for (int j = 0; j < width; j++)
		{
			for (int k = 0; k < height; k++)
			{
				tiles_map[j, k] = null;
			}
		}
		tiles_map = null;
		tiles_dirty.Clear();
		tilemap.clear();
	}

	private void createTiles()
	{
		SmoothLoader.add(delegate
		{
			tiles_list = new WorldTile[width * height];
			tiles_map = new WorldTile[width, height];
			GeneratorTool.Setup(tiles_map);
		}, "Prepare Tiles");
		SmoothLoader.add(delegate
		{
			_tile_id = 0;
			for (int j = 0; j < height; j++)
			{
				for (int k = 0; k < width; k++)
				{
					WorldTile worldTile = new WorldTile(k, j, _tile_id);
					_search_grid_ground.SetTileNode(k, j, worldTile);
					tiles_map[k, j] = worldTile;
					tiles_list[_tile_id] = worldTile;
					_tile_id++;
				}
			}
		}, "Create Tiles (" + height * width + ")", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			_ = tiles_list.Length;
		}, "Create Neighbours [" + height * width + "] (1/3)", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			int num = tiles_list.Length;
			for (int i = 0; i < num; i++)
			{
				tiles_list[i].resetNeighbourLists();
			}
		}, "Create Neighbours [" + height * width + "] (2/3)", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			GeneratorTool.GenerateTileNeighbours(tiles_list);
		}, "Create Neighbours [" + height * width + "] (3/3)", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			zone_calculator.generate();
			WorldBehaviourActionFire.prepare();
		}, "Create Zones", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			map_chunk_manager.prepare();
		}, "Create Chunks", pSkipFrame: true);
	}

	public static AttackDataResult newAttack(AttackData pData)
	{
		if (pData.hit_tile == null)
		{
			return new AttackDataResult(ApplyAttackState.Continue, -1L);
		}
		int num = pData.targets;
		AttackDataResult result = new AttackDataResult(ApplyAttackState.Continue, -1L);
		if (pData.target != null)
		{
			result = checkAttackFor(pData, pData.target);
			switch (result.state)
			{
			case ApplyAttackState.Hit:
				num--;
				break;
			case ApplyAttackState.Block:
			case ApplyAttackState.Deflect:
				return result;
			}
			if (num == 0)
			{
				return result;
			}
		}
		if (num == 0)
		{
			return result;
		}
		List<BaseSimObject> list = EnemiesFinder.findEnemiesFrom(pData.hit_tile, pData.kingdom, 0).list;
		if (list == null)
		{
			return result;
		}
		foreach (BaseSimObject item in list.LoopRandom())
		{
			if (item != pData.target)
			{
				if (num == 0)
				{
					break;
				}
				result = checkAttackFor(pData, item);
				switch (result.state)
				{
				case ApplyAttackState.Hit:
					num--;
					break;
				case ApplyAttackState.Block:
				case ApplyAttackState.Deflect:
					return result;
				}
			}
		}
		return result;
	}

	public static AttackDataResult checkAttackFor(AttackData pData, BaseSimObject pTargetToCheck)
	{
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0112: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		if (pTargetToCheck.isRekt())
		{
			return AttackDataResult.Continue;
		}
		if (pData.initiator.isRekt())
		{
			return AttackDataResult.Continue;
		}
		if (pTargetToCheck == pData.initiator)
		{
			return AttackDataResult.Continue;
		}
		if (!pData.initiator.canAttackTarget(pTargetToCheck))
		{
			return AttackDataResult.Continue;
		}
		if (pTargetToCheck.isActor() && pTargetToCheck.hasStatus("dodge"))
		{
			return AttackDataResult.Continue;
		}
		Vector3 val = Vector2.op_Implicit(pTargetToCheck.current_position);
		float num = Toolbox.SquaredDist(val.x, val.y + pTargetToCheck.getHeight(), pData.hit_position.x, pData.hit_position.y + pData.hit_position.z);
		float num2 = pData.area_of_effect + pTargetToCheck.stats["size"];
		num2 *= num2;
		if (num < num2)
		{
			Vector3 val2 = Vector3.MoveTowards(pData.hit_position, val, pTargetToCheck.stats["size"] * 0.9f);
			val2.y += pTargetToCheck.getHeight();
			AttackDataResult result = applyAttack(pData, pTargetToCheck);
			if (result.state == ApplyAttackState.Hit)
			{
				Vector3 hit_position = pData.hit_position;
				hit_position.y += hit_position.z;
				if (pData.critical)
				{
					EffectsLibrary.spawnAt("fx_hit_critical", hit_position, 0.1f);
					return result;
				}
				EffectsLibrary.spawnAt("fx_hit", hit_position, 0.1f);
			}
			return result;
		}
		return AttackDataResult.Miss;
	}

	private static AttackDataResult applyAttack(AttackData pData, BaseSimObject pTargetToCheck)
	{
		bool flag = pTargetToCheck.isActor();
		Actor a = pTargetToCheck.a;
		ProjectileAsset projectileAsset = null;
		if (pData.is_projectile)
		{
			projectileAsset = AssetManager.projectiles.get(pData.projectile_id);
		}
		if (flag && ControllableUnit.isControllingUnit(a) && a.hasMeleeAttack() && a.isJustAttacked())
		{
			CombatActionLibrary.combat_action_deflect.action_actor(pTargetToCheck.a, pData);
			return new AttackDataResult(ApplyAttackState.Deflect, pTargetToCheck.a.data.id);
		}
		if (flag && a.tryToUseAdvancedCombatAction(a.getCombatActionPool(CombatActionPool.BEFORE_HIT_DEFLECT), null, out var pResultCombatAsset))
		{
			pResultCombatAsset.action_actor(pTargetToCheck.a, pData);
			return new AttackDataResult(ApplyAttackState.Deflect, pTargetToCheck.a.data.id);
		}
		bool flag2 = false;
		if (projectileAsset != null && projectileAsset.can_be_blocked)
		{
			flag2 = true;
		}
		if (flag2 && flag && a.tryToUseAdvancedCombatAction(a.getCombatActionPool(CombatActionPool.BEFORE_HIT_BLOCK), null, out pResultCombatAsset))
		{
			pResultCombatAsset.action_actor(pTargetToCheck.a, pData);
			return AttackDataResult.Block;
		}
		if (flag && a.tryToUseAdvancedCombatAction(a.getCombatActionPool(CombatActionPool.BEFORE_HIT), null, out pResultCombatAsset))
		{
			pResultCombatAsset.action_actor(a, pData);
			return AttackDataResult.Continue;
		}
		int num = (int)Randy.randomFloat(pData.damage_range * (float)pData.damage, pData.damage);
		if (pData.critical)
		{
			num *= pData.critical_damage_multiplier;
		}
		if (pData.initiator.isActor() && pTargetToCheck.isAlive())
		{
			pData.initiator.a.addExperience(2);
		}
		pTargetToCheck.getHit(num, pFlash: true, pData.attack_type, pData.initiator, pMetallicWeapon: pData.metallic_weapon, pSkipIfShake: pData.skip_shake);
		if (!pTargetToCheck.hasHealth())
		{
			ActorTool.applyForceToUnit(pData, pTargetToCheck);
		}
		else
		{
			ActorTool.applyForceToUnit(pData, pTargetToCheck, 0.5f, pCheckCancelJobOnLand: true);
		}
		if (pData.initiator.isActor())
		{
			pData.initiator.a.attackTargetActions(pTargetToCheck, pData.hit_tile);
		}
		if (flag && pData.initiator.isActor() && !pTargetToCheck.hasHealth() && pData.initiator.a.needsFood() && pData.initiator.a.subspecies.diet_meat && a.asset.source_meat)
		{
			pData.initiator.a.addNutritionFromEating(70, pSetMaxNutrition: true);
			pData.initiator.a.countConsumed();
		}
		return AttackDataResult.Hit;
	}

	public void clearArchitectMood()
	{
		_cached_architect_mood = null;
	}

	public void clearWorld()
	{
		clearArchitectMood();
		current_world_seed_id++;
		DBInserter.Lock();
		tile_manager.clear();
		CursedSacrifice.reset();
		LogText.log("MapBox", "clearWorld", "st");
		auto_tester?.clearWorld();
		Analytics.worldLoading();
		SelectedUnit.clear();
		ControllableUnit.clear();
		DBManager.clearAndClose();
		explosion_checker.clear();
		BattleKeeperManager.clear();
		ZoneMetaDataVisualizer.clearAll();
		Finder.clear();
		_debug_layer.clear();
		selected_buttons.unselectAll();
		player_control.clear();
		MusicBox.clearAllSounds();
		clearFrameCaches();
		EnemiesFinder.disposeAll();
		TaxiManager.clear();
		islands_calculator.clear();
		RegionLinkHashes.clear();
		nameplate_manager.clearAll();
		map_chunk_manager.clearAll();
		islands_calculator.clear();
		quality_changer.reset();
		tilemap.clear();
		zone_camera.clear();
		Config.paused = false;
		if (DebugConfig.isOn(DebugOption.PauseOnStart))
		{
			Config.paused = true;
		}
		selected_buttons.checkToggleIcons();
		heat.clear();
		era_manager.clear();
		delayed_actions_manager.clear();
		foreach (TileType item in AssetManager.tiles.list)
		{
			item.hashsetClear();
		}
		foreach (TopTileType item2 in AssetManager.top_tiles.list)
		{
			item2.hashsetClear();
		}
		foreach (WorldBehaviourAsset item3 in AssetManager.world_behaviours.list)
		{
			item3.manager.clear();
		}
		WildKingdomsManager.neutral.clearListCities();
		AutoSaveManager.resetAutoSaveTimer();
		AssetManager.actor_library.clear();
		AssetManager.buildings.clear();
		BehaviourActionActor.clear();
		city_zone_helper.clear();
		region_path_finder.clear();
		Toolbox.clearAll();
		drop_manager.clear();
		armies.clear();
		foreach (BaseSystemManager list_all_sim_manager in list_all_sim_managers)
		{
			list_all_sim_manager.clear();
		}
		particles_fire.clear();
		particles_smoke.clear();
		stack_effects.clear();
		TornadoEffect.Clear();
		resource_throw_manager.clear();
		foreach (MapLayer map_layer in _map_layers)
		{
			map_layer.clear();
		}
		foreach (BaseModule map_module in _map_modules)
		{
			map_module.clear();
		}
		sim_object_zones.fullClear();
		resetTiles();
		zone_camera.fullClear();
		world_layer_edges.clear();
		WorldBehaviourActionFire.clearFires();
		HistoryHud.instance.Clear();
		DBInserter.Unlock();
		DBManager.clearAndClose();
		LogText.log("MapBox", "clearWorld", "en");
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public WorldTile GetTile(int pX, int pY)
	{
		if (pX < 0 || pX >= width || pY < 0 || pY >= height)
		{
			return null;
		}
		return tiles_map[pX, pY];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public WorldTile GetTileSimple(int pX, int pY)
	{
		return tiles_map[pX, pY];
	}

	public void setMapSize(int pWidth, int pHeight)
	{
		Config.ZONE_AMOUNT_X = pWidth;
		Config.ZONE_AMOUNT_Y = pHeight;
		width = Config.ZONE_AMOUNT_X * 64;
		height = Config.ZONE_AMOUNT_Y * 64;
		int num = width * height;
		if (tiles_list.Length != num)
		{
			recreateSizes();
		}
	}

	private void afterTransitionGeneration()
	{
		generateNewMap();
	}

	public void clickGenerateNewMap()
	{
		transition_screen.startTransition(afterTransitionGeneration);
	}

	public void generateNewMap()
	{
		if (!_initiated)
		{
			return;
		}
		if (Config.show_console_on_start)
		{
			console.Toggle();
		}
		SmoothLoader.prepare();
		SmoothLoader.add(delegate
		{
			LogText.log("MapBox", "generateNewMap", "st");
			Analytics.worldLoading();
			if (_first_gen)
			{
				Config.customMapSize = Config.customMapSizeDefault;
			}
			if (!_first_gen)
			{
				AchievementLibrary.custom_world.check();
			}
			_first_gen = false;
			int size = MapSizeLibrary.getSize(Config.customMapSize);
			addClearWorld(size, size);
		}, "Generate New Map (1/3)");
		SmoothLoader.add(delegate
		{
			Config.ZONE_AMOUNT_Y = (Config.ZONE_AMOUNT_X = MapSizeLibrary.getSize(Config.customMapSize));
		}, "Generate New Map (2/3)");
		SmoothLoader.add(delegate
		{
			setMapSize(Config.ZONE_AMOUNT_X, Config.ZONE_AMOUNT_Y);
		}, "Generate New Map (3/3)");
		SmoothLoader.add(delegate
		{
			LogText.log("MapBox", "GenerateMap", "st");
			AssetManager.tiles.setListTo(DepthGeneratorType.Generator);
			world_laws = new WorldLaws();
			world_laws.init();
			hotkey_tabs_data = new HotkeyTabsData();
		}, "gen: World Laws");
		SmoothLoader.add(delegate
		{
			map_stats = new MapStats();
			map_stats.initNewWorld();
			Randy.resetSeed(Randy.randomInt(1, 555555555));
		}, "gen: Generating Name");
		if (!Config.disable_db)
		{
			SmoothLoader.add(delegate
			{
				DBManager.createDB();
			}, "Creating Stats DB");
			DBTables.createOrMigrateTablesLoader();
		}
		WindowPreloader.addWaitForWindowResources();
		SmoothLoader.add(delegate
		{
			era_manager.setDefaultAges();
		}, "gen: World Ages");
		SmoothLoader.add(delegate
		{
			MapGenerator.prepare();
			LogText.log("MapBox", "GenerateMap", "en");
		}, "Preparing Map", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			cleanUpWorld();
		}, "Cleaning Up The World", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			redrawTiles();
		}, "Drawing Up The World", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			preloadRenderedSprites();
		}, "Preload rendered sprites...", pSkipFrame: false, 0.2f);
		SmoothLoader.add(delegate
		{
			finishMakingWorld();
			LogText.log("MapBox", "generateNewMap", "en");
		}, "Tidying Up The World", pSkipFrame: true);
		SmoothLoader.add(delegate
		{
			lastGC();
		}, "Rewriting The World", pSkipFrame: true);
		addLoadAutoTester();
		addKillAllUnits();
		addLoadWorldCallbacks();
		SmoothLoader.add(delegate
		{
			finishingUpLoading();
		}, "Finishing up...", pSkipFrame: false, 0.2f);
	}

	public void finishingUpLoading()
	{
		CanvasMain.instance.setMainUiEnabled(pEnabled: true);
	}

	public void preloadRenderedSprites()
	{
		foreach (Actor unit in units)
		{
			unit.checkSpriteToRender();
		}
		foreach (Building building in buildings)
		{
			building.checkSpriteToRender();
		}
	}

	public void addUnloadResources()
	{
		_load_counter++;
		if (_load_counter > 5)
		{
			_load_counter = 0;
			SmoothLoader.add(delegate
			{
				Resources.UnloadUnusedAssets();
			}, "UnloadUnusedAssets", pSkipFrame: true);
		}
	}

	public void addClearWorld(int pNextWidth, int pNextHeight)
	{
		SmoothLoader.add(delegate
		{
			LogText.log("MapBox", "clearWorld", "st");
			clearWorld();
			LogText.log("MapBox", "clearWorld", "en");
		}, "Clearing World", pSkipFrame: true);
		DebugMemory.addMemorySnapshot("clearWorld");
		int num = pNextWidth * 64;
		int num2 = pNextHeight * 64;
		int num3 = num * num2;
		if (tiles_list.Length != num3)
		{
			SmoothLoader.add(delegate
			{
				clearTiles();
			}, "Clean old Tiles");
			DebugMemory.addMemorySnapshot("clearTiles");
		}
	}

	public void addKillAllUnits()
	{
		if (!DebugConfig.isOn(DebugOption.KillAllUnitsOnLoad))
		{
			return;
		}
		SmoothLoader.add(delegate
		{
			foreach (Actor unit in units)
			{
				unit.dieAndDestroy(AttackType.None);
			}
		}, "Killing All Units", pSkipFrame: true);
	}

	public void addLoadAutoTester()
	{
		if (!DebugConfig.isOn(DebugOption.TesterLibs))
		{
			return;
		}
		SmoothLoader.add(delegate
		{
			if (!string.IsNullOrEmpty(Config.auto_test_on_start))
			{
				auto_tester.create(Config.auto_test_on_start);
				((Component)auto_tester).gameObject.SetActive(true);
			}
		}, "Loading Auto Tester", pSkipFrame: true);
	}

	public void addLoadWorldCallbacks()
	{
		SmoothLoader.add(delegate
		{
			Config.debug_worlds_loaded++;
			on_world_loaded?.Invoke();
		}, "World Loaded", pSkipFrame: true);
	}

	private void generateMap(string pType = "islands")
	{
	}

	public void cleanUpWorld(bool pSetChunksDirty = true)
	{
		MapGenerator.clear();
		updateDirtyMetaContainersAndCleanup();
		era_manager.prepare();
		if (pSetChunksDirty)
		{
			map_chunk_manager.allDirty();
			map_chunk_manager.update(0f, pForce: true);
		}
		foreach (City city in cities)
		{
			city.forceDoChecks();
		}
		foreach (City city2 in cities)
		{
			city2.executeAllActionsForCity();
		}
		allTilesDirty();
		centerCamera();
	}

	public void redrawTiles()
	{
		_meta_skip = true;
		if (MusicBox.new_world_on_start_played)
		{
			MusicBox.reserveFlag("new_world");
		}
		tilemap.redrawTiles(pForceAll: true);
	}

	public void finishMakingWorld()
	{
		ToolbarButtons.instance?.resetBar();
		game_stats.data.mapsCreated++;
		AchievementLibrary.gen_5_worlds.check();
		AchievementLibrary.gen_50_worlds.check();
		AchievementLibrary.gen_100_worlds.check();
		Analytics.worldLoaded();
		Config.LAST_LOAD_TIME = Time.realtimeSinceStartup;
	}

	public void lastGC()
	{
		Config.forceGC("finish making world");
	}

	private void recreateSizes()
	{
		SmoothLoader.add(delegate
		{
			_search_grid_ground = new StaticGrid(width, height);
		}, "Recreate Sizes (1/4)");
		SmoothLoader.add(delegate
		{
			createTiles();
		}, "Recreate Sizes (2/4)");
		SmoothLoader.add(delegate
		{
			tile_manager.setup(width, height, tiles_map);
		}, "Tile Manager", pSkipFrame: true);
		for (int j = 0; j < _map_layers.Count; j++)
		{
			int i = j;
			SmoothLoader.add(delegate
			{
				_map_layers[i].createTextureNew();
			}, "Recreate Sizes (3/4) (" + (j + 1) + "/" + _map_layers.Count + ")");
		}
		SmoothLoader.add(delegate
		{
			if (Globals.TRAILER_MODE)
			{
				Object.Destroy((Object)(object)((Component)_map_border).gameObject);
			}
			else
			{
				_map_border.generateTexture();
			}
		}, "Recreate Sizes (4/4)");
	}

	public Actor getActorNearCursor()
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		return ActionLibrary.getActorNearPos(instance.getMousePos());
	}

	public WorldTile getMouseTilePosCachedFrame()
	{
		return player_control.getMouseTilePosCachedFrame();
	}

	public Vector2 getMousePos()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return player_control.getMousePos();
	}

	public WorldTile getMouseTilePos()
	{
		return player_control.getMouseTilePos();
	}

	public bool isPointerInGame()
	{
		return player_control.isPointerInGame();
	}

	public bool isPointerInsideMapBounds()
	{
		return getMouseTilePos() != null;
	}

	public bool isOverUI()
	{
		return player_control.isOverUI();
	}

	public bool isTouchOverUI(Touch pTouch)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return player_control.isTouchOverUI(pTouch);
	}

	public static bool controlsLocked()
	{
		return PlayerControl.controlsLocked();
	}

	public static bool isControllingUnit()
	{
		return PlayerControl.isControllingUnit();
	}

	public bool isBusyWithUI()
	{
		return player_control.isBusyWithUI();
	}

	public bool isActionHappening()
	{
		return player_control.isActionHappening();
	}

	public bool isOverUiButton()
	{
		return player_control?.isPointerOverUIButton() ?? false;
	}

	public void loopWithBrush(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
	{
		BrushPixelData[] pos = pBrush.pos;
		int num = pos.Length;
		for (int i = 0; i < num; i++)
		{
			BrushPixelData brushPixelData = pos[i];
			int num2 = pCenterTile.x + brushPixelData.x;
			int num3 = pCenterTile.y + brushPixelData.y;
			if (num2 >= 0 && num2 < width && num3 >= 0 && num3 < height)
			{
				WorldTile tileSimple = instance.GetTileSimple(num2, num3);
				pAction(tileSimple, pPower);
			}
		}
	}

	public void highlightTilesBrush(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
	{
		loopWithBrush(pCenterTile, pBrush, pAction, pPower);
	}

	public void loopWithBrushPowerForDropsFull(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
	{
		loopWithBrush(pCenterTile, pBrush, pAction, pPower);
	}

	public void loopWithBrushPowerForDropsRandom(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
	{
		BrushPixelData[] pos = pBrush.pos;
		int num = pos.Length;
		using ListPool<WorldTile> listPool = new ListPool<WorldTile>();
		for (int i = 0; i < num; i++)
		{
			BrushPixelData brushPixelData = pos[i];
			int num2 = pCenterTile.x + brushPixelData.x;
			int num3 = pCenterTile.y + brushPixelData.y;
			if (num2 >= 0 && num2 < width && num3 >= 0 && num3 < height)
			{
				WorldTile tileSimple = instance.GetTileSimple(num2, num3);
				listPool.Add(tileSimple);
			}
		}
		int drops = pBrush.drops;
		listPool.Shuffle();
		for (int j = 0; j < drops; j++)
		{
			if (listPool.Count == 0)
			{
				break;
			}
			WorldTile pTile = listPool.Pop();
			pAction(pTile, pPower);
		}
	}

	public void loopWithBrush(WorldTile pCenterTile, BrushData pBrush, PowerActionWithID pAction, string pPowerID = null)
	{
		BrushPixelData[] pos = pBrush.pos;
		int num = pos.Length;
		for (int i = 0; i < num; i++)
		{
			BrushPixelData brushPixelData = pos[i];
			int num2 = pCenterTile.x + brushPixelData.x;
			int num3 = pCenterTile.y + brushPixelData.y;
			if (num2 >= 0 && num2 < width && num3 >= 0 && num3 < height)
			{
				WorldTile tileSimple = instance.GetTileSimple(num2, num3);
				pAction(tileSimple, pPowerID);
			}
		}
	}

	public void checkCityZone(WorldTile pTile)
	{
		if (pTile.zone.city == null)
		{
			return;
		}
		bool flag = false;
		HashSet<Building> hashset = pTile.zone.getHashset(BuildingList.Civs);
		if (hashset != null)
		{
			foreach (Building item in hashset)
			{
				if (item.city == pTile.zone.city)
				{
					flag = true;
					break;
				}
			}
		}
		if (!flag)
		{
			pTile.zone.city.removeZone(pTile.zone);
		}
	}

	public static void spawnLightningBig(WorldTile pTile, float pScale = 0.25f, Actor pActor = null)
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = EffectsLibrary.spawnAtTile("fx_lightning_big", pTile, pScale);
		if (!((Object)(object)baseEffect == (Object)null))
		{
			int pRad = (int)(pScale * 25f);
			MapAction.checkLightningAction(pTile.pos, pRad, pActor, pCheckForImmortal: true, pCheckMayIInterrupt: true);
			MapAction.damageWorld(pTile, pRad, AssetManager.terraform.get("lightning_power"), pActor);
			baseEffect.sprite_renderer.flipX = Randy.randomBool();
			MapAction.checkSantaHit(pTile.pos, pRad);
			MapAction.checkUFOHit(pTile.pos, pRad, pActor);
			MapAction.checkTornadoHit(pTile.pos, pRad);
		}
	}

	public static void spawnLightningMedium(WorldTile pTile, float pScale = 0.25f, Actor pActor = null)
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = EffectsLibrary.spawnAtTile("fx_lightning_medium", pTile, pScale);
		if (!((Object)(object)baseEffect == (Object)null))
		{
			int pRad = (int)(pScale * 15f);
			MapAction.checkLightningAction(pTile.pos, pRad, pActor);
			MapAction.damageWorld(pTile, pRad, AssetManager.terraform.get("lightning_normal"), pActor);
			baseEffect.sprite_renderer.flipX = Randy.randomBool();
			MapAction.checkTornadoHit(pTile.pos, pRad);
		}
	}

	public static void spawnLightningSmall(WorldTile pTile, float pScale = 0.25f, Actor pActor = null)
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		BaseEffect baseEffect = EffectsLibrary.spawnAtTile("fx_lightning_small", pTile, pScale);
		if (!((Object)(object)baseEffect == (Object)null))
		{
			int pRad = (int)(pScale * 10f);
			MapAction.checkLightningAction(pTile.pos, pRad, pActor);
			MapAction.damageWorld(pTile, pRad, AssetManager.terraform.get("lightning_normal"), pActor);
			baseEffect.sprite_renderer.flipX = Randy.randomBool();
			MapAction.checkTornadoHit(pTile.pos, pRad);
		}
	}

	public void applyForceOnTile(WorldTile pTile, int pRad = 10, float pForceAmount = 1.5f, bool pForceOut = true, int pDamage = 0, string[] pIgnoreKingdoms = null, BaseSimObject pByWho = null, TerraformOptions pOptions = null, bool pChangeHappiness = false)
	{
		int num = pRad * pRad;
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 1))
		{
			if (item == pByWho?.a || (float)Toolbox.SquaredDistTile(item.current_tile, pTile) > (float)num || (pOptions != null && item.asset.very_high_flyer && !pOptions.applies_to_high_flyers))
			{
				continue;
			}
			if (pIgnoreKingdoms != null)
			{
				bool flag = false;
				for (int i = 0; i < pIgnoreKingdoms.Length; i++)
				{
					Kingdom kingdom = kingdoms_wild.get(pIgnoreKingdoms[i]);
					if (item.kingdom == kingdom)
					{
						flag = true;
						break;
					}
				}
				if (flag)
				{
					continue;
				}
			}
			item.makeStunned(4f);
			if (pChangeHappiness)
			{
				item.changeHappiness("just_forced_power");
			}
			if (item.asset.can_be_hurt_by_powers && pDamage > 0)
			{
				AttackType pAttackType = AttackType.Other;
				if (pOptions != null)
				{
					pAttackType = pOptions.attack_type;
				}
				item.getHit(pDamage, pFlash: true, pAttackType, pByWho);
			}
			if (pForceAmount > 0f)
			{
				if (pForceOut)
				{
					item.calculateForce(item.current_tile.x, item.current_tile.y, pTile.x, pTile.y, pForceAmount, 0f, pCheckCancelJobOnLand: true);
				}
				else
				{
					item.calculateForce(pTile.x, pTile.y, item.current_tile.x, item.current_tile.y, pForceAmount, 0f, pCheckCancelJobOnLand: true);
				}
			}
		}
	}

	internal void stopAttacksFor(bool pMonsters)
	{
		foreach (Actor unit in units)
		{
			if (unit.has_attack_target && unit.isEnemyTargetAlive() && (unit.kingdom.asset.mobs || unit.attack_target.kingdom.asset.mobs) == pMonsters)
			{
				unit.cancelAllBeh();
			}
		}
	}

	public void allDirty()
	{
		for (int i = 0; i < tiles_list.Length; i++)
		{
			WorldTile worldTile = tiles_list[i];
			tiles_dirty.Add(worldTile);
			tilemap.addToQueueToRedraw(worldTile);
		}
	}

	private void OnApplicationFocus(bool pFocus)
	{
		has_focus = pFocus;
	}

	private void OnApplicationPause(bool pPause)
	{
		has_focus = !pPause;
	}

	private void OnApplicationQuit()
	{
		DOTween.KillAll(false);
	}

	private void updateShake(float pElapsed)
	{
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Unknown result type (might be due to invalid IL or missing references)
		if (_shake_timer == 0f)
		{
			return;
		}
		if (_shake_timer > 0f)
		{
			_shake_timer -= pElapsed;
		}
		if (_shake_timer <= 0f)
		{
			_shake_timer = 0f;
			_shake_camera.position = new Vector3(0f, 0f);
			return;
		}
		if (_shake_interval_timer > 0f)
		{
			_shake_interval_timer -= pElapsed;
			return;
		}
		_shake_interval_timer = _shake_interval;
		Vector3 position = default(Vector3);
		if (_shake_x)
		{
			position.x = Randy.randomFloat(0f - _shake_intensity, _shake_intensity);
		}
		if (_shake_y)
		{
			position.y = Randy.randomFloat(0f - _shake_intensity, _shake_intensity);
		}
		_shake_camera.position = position;
	}

	public void startShake(float pDuration = 0.3f, float pInterval = 0.01f, float pIntensity = 2f, bool pShakeX = false, bool pShakeY = true)
	{
		_shake_timer = pDuration;
		_shake_interval = pInterval;
		_shake_intensity = pIntensity;
		_shake_x = pShakeX;
		_shake_y = pShakeY;
	}

	private void updateMapLayers(float pElapsed)
	{
		Bench.bench("heat", "game_total");
		heat.update(pElapsed);
		Bench.benchEnd("heat", "game_total", pSaveCounter: false, 0L);
		Bench.bench("map_chunk_manager", "game_total");
		map_chunk_manager.update(pElapsed);
		Bench.benchEnd("map_chunk_manager", "game_total", pSaveCounter: false, 0L);
		Bench.bench("map_layers", "game_total");
		for (int i = 0; i < _map_layers.Count; i++)
		{
			_map_layers[i].update(pElapsed);
		}
		Bench.benchEnd("map_layers", "game_total", pSaveCounter: false, 0L);
		Bench.bench("map_layers_draw", "game_total");
		for (int j = 0; j < _map_layers.Count; j++)
		{
			_map_layers[j].draw(pElapsed);
		}
		Bench.benchEnd("map_layers_draw", "game_total", pSaveCounter: false, 0L);
		Bench.bench("map_modules", "game_total");
		for (int k = 0; k < _map_modules.Count; k++)
		{
			_map_modules[k].update(pElapsed);
		}
		Bench.benchEnd("map_modules", "game_total", pSaveCounter: false, 0L);
	}

	public float calculateCurElapsed()
	{
		return Time.fixedDeltaTime * Config.time_scale_asset.multiplier;
	}

	private void clearFrameCaches()
	{
	}

	private void LateUpdate()
	{
		player_control.clearLateUpdate();
	}

	private void Update()
	{
		FPS.update();
		if (!Config.game_loaded)
		{
			return;
		}
		Config.parallel_jobs_updater = DebugConfig.isOn(DebugOption.ParallelJobsUpdater);
		Bench.bench_ai_enabled = DebugConfig.isOn(DebugOption.BenchAiEnabled);
		if (SmoothLoader.isLoading())
		{
			if (DebugConfig.isOn(DebugOption.GenerateNewMapOnMapLoadingError))
			{
				try
				{
					SmoothLoader.update(Time.deltaTime);
					return;
				}
				catch (Exception ex)
				{
					Debug.LogError((object)ex);
					generateNewMap();
					return;
				}
			}
			SmoothLoader.update(Time.deltaTime);
			return;
		}
		Randy.nextSeed();
		Bench.bench("game_total");
		ScrollingHelper.update();
		Bench.bench("move_camera", "game_total");
		move_camera.update();
		Bench.benchEnd("move_camera", "game_total", pSaveCounter: false, 0L);
		Bench.bench("mapbox_update_1", "game_total");
		stack_effects.light_blobs.Clear();
		_signal_manager.update();
		clearFrameCaches();
		Config.updateCrashMetadata();
		PlayerConfig.instance.update();
		Tooltip.checkClearAll();
		CursorTooltipHelper.update();
		delta_time = Time.fixedDeltaTime;
		fixed_delta_time = Time.fixedDeltaTime;
		game_stats.updateStats(Time.deltaTime);
		_is_paused = Config.paused || ScrollWindow.isWindowActive() || RewardedAds.isShowing();
		_cached_map_meta_asset = Zones.getMapMetaAsset();
		Bench.benchEnd("mapbox_update_1", "game_total", pSaveCounter: false, 0L);
		Bench.bench("battle_keeper", "game_total");
		BattleKeeperManager.update(delta_time);
		Bench.benchEnd("battle_keeper", "game_total", pSaveCounter: false, 0L);
		elapsed = calculateCurElapsed();
		if (Config.fps_lock_30)
		{
			elapsed *= 2f;
		}
		cursor_speed.update();
		Bench.bench("music_box", "game_total");
		MusicBox.inst.update(delta_time);
		Bench.benchEnd("music_box", "game_total", pSaveCounter: false, 0L);
		Bench.bench("auto_tester", "game_total");
		auto_tester.update(elapsed);
		Bench.benchEnd("auto_tester", "game_total", pSaveCounter: false, 0L);
		if (Config.isMobile && (RewardedAds.isShowing() || PlayInterstitialAd.isShowing()))
		{
			return;
		}
		Bench.bench("auto_save", "game_total");
		AutoSaveManager.update();
		Bench.benchEnd("auto_save", "game_total", pSaveCounter: false, 0L);
		Bench.bench("send_to_sql", "game_total");
		DBInserter.executeCommandsAsync();
		Bench.benchEnd("send_to_sql", "game_total", pSaveCounter: false, 0L);
		checkMainSimulationUpdate();
		delayed_actions_manager.update(elapsed, delta_time);
		tilemap.update(elapsed);
		Bench.bench("update_shake", "game_total");
		updateShake(elapsed);
		Bench.benchEnd("update_shake", "game_total", pSaveCounter: false, 0L);
		Bench.bench("update_panel", "game_total");
		map_stats.updateStatsForPanel(delta_time);
		Bench.benchEnd("update_panel", "game_total", pSaveCounter: false, 0L);
		Bench.bench("quality_changer", "game_total");
		quality_changer.update();
		Bench.benchEnd("quality_changer", "game_total", pSaveCounter: false, 0L);
		updateTransitionEffect();
		Bench.bench("update_controls", "game_total");
		player_control.updateControls();
		Bench.benchEnd("update_controls", "game_total", pSaveCounter: false, 0L);
		Bench.bench("zone_camera", "game_total");
		zone_camera.update();
		Bench.benchEnd("zone_camera", "game_total", pSaveCounter: false, 0L);
		Bench.bench("unit_select_effect", "game_total");
		if ((Object)(object)_unit_select_effect != (Object)null)
		{
			_unit_select_effect.update(elapsed);
		}
		Bench.benchEnd("unit_select_effect", "game_total", pSaveCounter: false, 0L);
		Bench.bench("zone_selection_effect", "game_total");
		zone_calculator.updateAnimationsAndSelections();
		Bench.benchEnd("zone_selection_effect", "game_total", pSaveCounter: false, 0L);
		Bench.bench("nameplates", "game_total");
		nameplate_manager.update();
		Bench.benchEnd("nameplates", "game_total", pSaveCounter: false, 0L);
		if (Config.time_scale_asset.render_skip)
		{
			if (_render_skip < 2)
			{
				_render_skip++;
			}
			else
			{
				_render_skip = 0;
				calculateVisibleObjects();
				renderStuff();
			}
		}
		else
		{
			calculateVisibleObjects();
			renderStuff();
		}
		Bench.bench("update_sprite_constructor", "game_total");
		updateDynamicSprites();
		Bench.benchEnd("update_sprite_constructor", "game_total", pSaveCounter: false, 0L);
		Bench.bench("light_renderer", "game_total");
		LightRenderer.instance.update(delta_time);
		Bench.benchEnd("light_renderer", "game_total", pSaveCounter: false, 0L);
		Bench.bench("update_finish", "game_total");
		updateFinish();
		Bench.benchEnd("update_finish", "game_total", pSaveCounter: false, 0L);
		Bench.bench("end_checks", "game_total");
		checkMinWindowSize();
		checkVersionCallbacks();
		Bench.update();
		Bench.benchEnd("end_checks", "game_total", pSaveCounter: false, 0L);
		Bench.benchEnd("game_total", "main", pSaveCounter: false, 0L);
	}

	private void checkMainSimulationUpdate()
	{
		int num = (ScrollWindow.isWindowActive() ? 1 : Config.time_scale_asset.ticks);
		for (int i = 0; i < num; i++)
		{
			updateSimulation(elapsed);
		}
	}

	private void updateTransitionEffect()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		if (_world_layer_switch_effect.color.a != 0f)
		{
			Color color = _world_layer_switch_effect.color;
			color.a -= delta_time * 0.1f;
			if (color.a < 0f)
			{
				color.a = 0f;
			}
			_world_layer_switch_effect.color = color;
		}
	}

	private void updateSimulation(float pElapsed)
	{
		updateDirtyMetaContainersAndCleanup();
		explosion_checker.update(pElapsed);
		city_zone_helper.update(pElapsed);
		if (!isPaused())
		{
			updateTimerNutrition(pElapsed);
			Bench.bench("update_age", "game_total");
			map_stats.updateWorldTime(pElapsed);
			Bench.benchEnd("update_age", "game_total", pSaveCounter: false, 0L);
			Bench.bench("taxi", "game_total");
			TaxiManager.update(pElapsed);
			Bench.benchEnd("taxi", "game_total", pSaveCounter: false, 0L);
			Bench.bench("update_meta_history", "game_total");
			updateMetaHistory();
			Bench.benchEnd("update_meta_history", "game_total", pSaveCounter: false, 0L);
		}
		AnimationHelper.updateTime(pElapsed, delta_time);
		EnemiesFinder.clear();
		ControllableUnit.updateControllableUnit();
		updateMapLayers(pElapsed);
		updateCities(pElapsed);
		updateActors(pElapsed);
		updateBuildings(pElapsed);
		drop_manager.update(pElapsed);
		cultures.update(pElapsed);
		stack_effects.update(pElapsed);
		resource_throw_manager.update(pElapsed);
		updateWorldBehaviours(pElapsed);
		Bench.bench("army_manager", "game_total");
		armies.update(pElapsed);
		Bench.benchEnd("army_manager", "game_total", pSaveCounter: false, 0L);
		Bench.bench("kingdoms", "game_total");
		kingdoms.update(pElapsed);
		Bench.benchEnd("kingdoms", "game_total", pSaveCounter: false, 0L);
		Bench.bench("diplomacy", "game_total");
		diplomacy.update(pElapsed);
		Bench.benchEnd("diplomacy", "game_total", pSaveCounter: false, 0L);
		Bench.bench("subspecies", "game_total");
		subspecies.update(pElapsed);
		Bench.benchEnd("subspecies", "game_total", pSaveCounter: false, 0L);
		Bench.bench("plots", "game_total");
		plots.update(pElapsed);
		Bench.benchEnd("plots", "game_total", pSaveCounter: false, 0L);
		Bench.bench("clans", "game_total");
		clans.update(pElapsed);
		Bench.benchEnd("clans", "game_total", pSaveCounter: false, 0L);
		Bench.bench("alliances", "game_total");
		alliances.update(pElapsed);
		Bench.benchEnd("alliances", "game_total", pSaveCounter: false, 0L);
		Bench.bench("wars", "game_total");
		wars.update(pElapsed);
		Bench.benchEnd("wars", "game_total", pSaveCounter: false, 0L);
		Bench.bench("languages", "game_total");
		languages.update(pElapsed);
		Bench.benchEnd("languages", "game_total", pSaveCounter: false, 0L);
		Bench.bench("religions", "game_total");
		religions.update(pElapsed);
		Bench.benchEnd("religions", "game_total", pSaveCounter: false, 0L);
		Bench.bench("projectiles", "game_total");
		projectiles.update(pElapsed);
		Bench.benchEnd("projectiles", "game_total", pSaveCounter: false, 0L);
		Bench.bench("stasuses", "game_total");
		statuses.update(pElapsed);
		Bench.benchEnd("stasuses", "game_total", pSaveCounter: false, 0L);
		Bench.bench("era_manager", "game_total");
		era_manager.update(pElapsed);
		Bench.benchEnd("era_manager", "game_total", pSaveCounter: false, 0L);
	}

	private void updateMetaHistory()
	{
		if (!Config.graphs || Config.disable_db || Date.getCurrentMonth() != 12)
		{
			return;
		}
		int currentYear = Date.getCurrentYear();
		if (currentYear == map_stats.history_current_year)
		{
			return;
		}
		map_stats.history_current_year = currentYear;
		foreach (BaseSystemManager list_all_sim_manager in list_all_sim_managers)
		{
			list_all_sim_manager.startCollectHistoryData();
		}
		world_object.startCollectHistoryData();
		foreach (BaseSystemManager list_all_sim_manager2 in list_all_sim_managers)
		{
			list_all_sim_manager2.clearLastYearStats();
		}
		world_object.clearLastYearStats();
	}

	private void updateDirtyMetaContainersAndCleanup()
	{
		BuildingZonesSystem.update();
		checkSimManagerLists();
		units.checkContainer();
		buildings.checkContainer();
		sim_object_zones.update();
		Bench.bench("prepare_for_meta_checks", "game_total");
		units.prepareForMetaChecks();
		Bench.benchEnd("prepare_for_meta_checks", "game_total", pSaveCounter: false, 0L);
		Bench.bench("check_dirty_meta_units", "game_total");
		checkDirtyUnits();
		Bench.benchEnd("check_dirty_meta_units", "game_total", pSaveCounter: false, 0L);
		Bench.bench("check_dirty_meta_objects", "game_total");
		checkDirtyMetaObjects();
		Bench.benchEnd("check_dirty_meta_objects", "game_total", pSaveCounter: false, 0L);
		if (!isWindowOnScreen())
		{
			Bench.bench("check_meta_obj_destroy", "game_total");
			checkMetaObjectsDestroy();
			Bench.benchEnd("check_meta_obj_destroy", "game_total", pSaveCounter: false, 0L);
			Bench.bench("check_obj_destroy", "game_total");
			checkObjectsToDestroy();
			Bench.benchEnd("check_obj_destroy", "game_total", pSaveCounter: false, 0L);
		}
		checkSimManagerLists();
		Bench.bench("check_references_units", "game_total");
		checkEventUnitsDestroy();
		Bench.benchEnd("check_references_units", "game_total", pSaveCounter: false, 0L);
		Bench.bench("check_references_buildings", "game_total");
		checkEventBuildingsDestroy();
		Bench.benchEnd("check_references_buildings", "game_total", pSaveCounter: false, 0L);
		Bench.bench("check_references_houses", "game_total");
		checkEventHouses();
		Bench.benchEnd("check_references_houses", "game_total", pSaveCounter: false, 0L);
		Bench.bench("check_dirty_meta_objects_2", "game_total");
		checkDirtyMetaObjects();
		Bench.benchEnd("check_dirty_meta_objects_2", "game_total", pSaveCounter: false, 0L);
		Bench.bench("check_anything_changed", "game_total");
		checkAnyMetaAddedRemoved();
		Bench.benchEnd("check_anything_changed", "game_total", pSaveCounter: false, 0L);
	}

	private void checkEventUnitsDestroy()
	{
		if (!units.event_destroy)
		{
			return;
		}
		units.event_destroy = false;
		foreach (Actor unit in units)
		{
			if (unit.beh_actor_target != null && !unit.beh_actor_target.isAlive())
			{
				unit.beh_actor_target = null;
			}
			if (unit.attackedBy != null && !unit.attackedBy.isAlive())
			{
				unit.attackedBy = null;
			}
			if (unit.hasLover() && !unit.lover.isAlive())
			{
				unit.lover.lover = null;
				unit.lover = null;
			}
		}
		TaxiManager.removeDeadUnits();
	}

	private void checkEventBuildingsDestroy()
	{
		if (!buildings.event_destroy)
		{
			return;
		}
		List<Actor> simpleList = units.getSimpleList();
		for (int i = 0; i < simpleList.Count; i++)
		{
			Actor actor = simpleList[i];
			if (actor.beh_building_target != null && !actor.beh_building_target.isAlive())
			{
				actor.beh_building_target = null;
			}
			if (actor.attackedBy != null && !actor.attackedBy.isAlive())
			{
				actor.attackedBy = null;
			}
		}
		buildings.event_destroy = false;
	}

	private void checkEventHouses()
	{
		if (!buildings.event_houses)
		{
			return;
		}
		foreach (Building occupied_building in buildings.occupied_buildings)
		{
			occupied_building.residents.Clear();
			if (occupied_building.asset.docks)
			{
				occupied_building.component_docks.clearBoatCounter();
			}
		}
		List<Actor> simpleList = units.getSimpleList();
		for (int i = 0; i < simpleList.Count; i++)
		{
			Actor actor = simpleList[i];
			actor.checkHomeBuilding();
			Building home_building = actor.home_building;
			if (home_building != null)
			{
				if (home_building.asset.docks)
				{
					home_building.component_docks.increaseBoatCounter(actor);
				}
				else
				{
					home_building.residents.Add(actor.data.id);
				}
			}
			Building inside_building = actor.inside_building;
			if (inside_building != null && (!inside_building.isUsable() || inside_building.isAbandoned()))
			{
				actor.exitBuilding();
				actor.cancelAllBeh();
			}
		}
		buildings.event_houses = false;
	}

	private void debugHouses()
	{
		foreach (Building building in buildings)
		{
			if (!building.isUsable() && building.countResidents() > 0)
			{
				Debug.LogError((object)("Building " + building.data.id + " has residents but is not usable"));
			}
			if (!building.asset.docks && building.countResidents() > building.asset.housing_slots)
			{
				Debug.LogError((object)(building.asset.id + " has more residents than housing " + building.countResidents() + "/" + building.asset.housing_slots));
			}
		}
	}

	public void checkSimManagerLists()
	{
		for (int i = 0; i < list_all_sim_managers.Count; i++)
		{
			list_all_sim_managers[i].checkLists();
		}
	}

	private void checkDirtyUnits()
	{
		bool flag = false;
		int num = 0;
		for (int i = 0; i < _list_meta_main_managers.Count; i++)
		{
			if (_list_meta_main_managers[i].isUnitsDirty())
			{
				flag = true;
				num++;
			}
		}
		if (!flag)
		{
			return;
		}
		if (num < 3)
		{
			subspecies.beginChecksUnits();
			families.beginChecksUnits();
			armies.beginChecksUnits();
			clans.beginChecksUnits();
			plots.beginChecksUnits();
			languages.beginChecksUnits();
			cultures.beginChecksUnits();
			religions.beginChecksUnits();
			cities.beginChecksUnits();
			kingdoms.beginChecksUnits();
			kingdoms_wild.beginChecksUnits();
		}
		else
		{
			Parallel.ForEach(_list_meta_main_managers, parallel_options, delegate(BaseSystemManager pSystem)
			{
				pSystem.parallelDirtyUnitsCheck();
			});
		}
	}

	private void checkDirtyMetaObjects()
	{
		kingdoms_wild.beginChecksBuildings();
		kingdoms.beginChecksBuildings();
		cities.beginChecksBuildings();
		kingdoms.beginChecksCities();
		religions.beginChecksKingdoms();
		religions.beginChecksCities();
		cultures.beginChecksKingdoms();
		cultures.beginChecksCities();
		languages.beginChecksKingdoms();
		languages.beginChecksCities();
	}

	private void checkAnyMetaAddedRemoved()
	{
		if (!BaseSystemManager.anything_changed)
		{
			return;
		}
		Config.selected_objects_graph.RemoveWhere((NanoObject pNanoObject) => pNanoObject.isRekt());
		if (ScrollWindow.isWindowActive())
		{
			ScrollWindow.checkElements();
			if (!MetaSwitchManager.isAnimationActive())
			{
				MetaSwitchManager.checkAndRefresh();
			}
		}
		SpriteSwitcher.checkAllStates();
		BaseSystemManager.anything_changed = false;
	}

	private void checkMetaObjectsDestroy()
	{
		if (_meta_skip)
		{
			_meta_skip = false;
			return;
		}
		foreach (BaseSystemManager list_meta_main_manager in _list_meta_main_managers)
		{
			list_meta_main_manager.checkDeadObjects();
		}
	}

	private void calculateVisibleObjects()
	{
		buildings.calculateVisibleBuildings();
		units.calculateVisibleActors();
	}

	public void resetRedrawTimer()
	{
		_redraw_timer = -1f;
	}

	private void renderStuff()
	{
		QuantumSpriteManager.update();
		Bench.bench("redraw_mini_map", "game_total");
		if (_redraw_timer > 0f)
		{
			_redraw_timer -= Time.deltaTime;
		}
		else
		{
			_redraw_timer = 0.001f;
			if (tiles_dirty.Count > 0)
			{
				redrawMiniMap();
			}
		}
		Bench.benchEnd("redraw_mini_map", "game_total", pSaveCounter: false, 0L);
		Bench.bench("redraw_tiles", "game_total");
		tilemap.redrawTiles();
		Bench.benchEnd("redraw_tiles", "game_total", pSaveCounter: false, 0L);
		Bench.bench("update_debug_texts", "game_total");
		updateDebugGroupSystem();
		Bench.benchEnd("update_debug_texts", "game_total", pSaveCounter: false, 0L);
	}

	private void updateFinish()
	{
		if (timer_nutrition_decay <= 0f)
		{
			timer_nutrition_decay = SimGlobals.m.interval_nutrition_decay;
		}
	}

	private void checkVersionCallbacks()
	{
		if (VersionCallbacks.timer > 0f)
		{
			VersionCallbacks.updateVC(elapsed);
		}
		if (Config.EVERYTHING_FIREWORKS)
		{
			spawnForcedFireworks();
		}
	}

	private void checkMinWindowSize()
	{
		if (!Screen.fullScreen)
		{
			if (Screen.width < 720)
			{
				Screen.SetResolution(720, Screen.height, false);
			}
			else if (Screen.height < 480)
			{
				Screen.SetResolution(Screen.width, 480, false);
			}
		}
	}

	private void checkObjectsToDestroy()
	{
		buildings.checkObjectsToDestroy();
		units.checkObjectsToDestroy();
	}

	private void updateWorldBehaviours(float pElapsed)
	{
		if (!DebugConfig.isOn(DebugOption.SystemWorldBehaviours))
		{
			return;
		}
		Bench.bench("world_beh", "game_total");
		List<WorldBehaviourAsset> list = AssetManager.world_behaviours.list;
		for (int i = 0; i < list.Count; i++)
		{
			WorldBehaviourAsset worldBehaviourAsset = list[i];
			if (worldBehaviourAsset.enabled)
			{
				Bench.bench(worldBehaviourAsset.id, "world_beh");
				worldBehaviourAsset.manager.update(pElapsed);
				Bench.benchEnd(worldBehaviourAsset.id, "world_beh", pSaveCounter: false, 0L);
			}
		}
		Bench.benchEnd("world_beh", "game_total", pSaveCounter: false, 0L);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public float getWorldTimeElapsedSince(double pTime)
	{
		return (float)(map_stats.world_time - pTime);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public float getRealTimeElapsedSince(double pTime)
	{
		return (float)(getCurSessionTime() - pTime);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public double getCurWorldTime()
	{
		return map_stats.world_time;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public double getCurSessionTime()
	{
		return game_stats.data.gameTime;
	}

	public void updateDynamicSprites()
	{
		AssetManager.dynamic_sprites_library.checkDirty();
	}

	public void updateDebugGroupSystem()
	{
		_debug_text_group_system.update(elapsed);
	}

	internal void updateTimerNutrition(float pElapsed)
	{
		if (timer_nutrition_decay > 0f)
		{
			timer_nutrition_decay -= pElapsed;
		}
	}

	internal void updateObjectAge()
	{
		foreach (Actor unit in units)
		{
			unit.updateAge();
		}
		cities.updateAge();
		kingdoms.updateAge();
	}

	private void updateCities(float pElapsed)
	{
		if (DebugConfig.isOn(DebugOption.SystemUpdateCities))
		{
			Bench.bench("cities", "game_total");
			cities.update(pElapsed);
			Bench.benchEnd("cities", "game_total", pSaveCounter: false, 0L);
		}
	}

	private void updateBuildings(float pElapsed)
	{
		if (DebugConfig.isOn(DebugOption.SystemUpdateBuildings))
		{
			buildings.update(pElapsed);
		}
	}

	private void updateActors(float pElapsed)
	{
		if (DebugConfig.isOn(DebugOption.SystemUpdateUnits))
		{
			units.update(pElapsed);
		}
	}

	private void allTilesDirty()
	{
		tiles_dirty.Clear();
		tilemap.clear();
		for (int i = 0; i < tiles_list.Length; i++)
		{
			WorldTile tileDirty = tiles_list[i];
			setTileDirty(tileDirty);
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void redrawRenderedTile(WorldTile pTile)
	{
		pTile.last_rendered_tile_type = null;
		setTileDirty(pTile);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void setTileDirty(WorldTile pTile)
	{
		pTile.updateStats();
		tiles_dirty.Add(pTile);
		if (tilemap.needsRedraw(pTile))
		{
			tilemap.addToQueueToRedraw(pTile);
			if (pTile.has_tile_up)
			{
				tilemap.addToQueueToRedraw(pTile.tile_up);
			}
			if (pTile.has_tile_down)
			{
				tilemap.addToQueueToRedraw(pTile.tile_down);
			}
			if (pTile.has_tile_left)
			{
				tilemap.addToQueueToRedraw(pTile.tile_left);
			}
			if (pTile.has_tile_right)
			{
				tilemap.addToQueueToRedraw(pTile.tile_right);
			}
		}
		world_layer_edges.addDirtyChunk(pTile.chunk);
		checkBehaviours(pTile);
	}

	internal void setZoomOrthographic(float pZoom)
	{
		quality_changer.setZoomOrthographic(pZoom);
	}

	public void redrawMiniMap(bool pForce = false)
	{
		if (!DebugConfig.isOn(DebugOption.SystemRedrawMap) || !(isRenderMiniMap() || pForce))
		{
			return;
		}
		dirty_tiles_last = tiles_dirty.Count;
		foreach (WorldTile item in tiles_dirty)
		{
			updateDirtyTile(item);
		}
		world_layer_edges.redraw();
		tiles_dirty.Clear();
		world_layer.updatePixels();
	}

	internal void checkBehaviours(WorldTile pTile)
	{
		if (pTile.Type.explodable_timed)
		{
			explosion_layer.addTimedTnt(pTile);
		}
		if (pTile.Type.can_be_filled_with_ocean)
		{
			WorldBehaviourOcean.tiles.Add(pTile);
		}
		else
		{
			WorldBehaviourOcean.tiles.Remove(pTile);
		}
	}

	private void updateDirtyTile(WorldTile pTile)
	{
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		if (pTile.hasBuilding())
		{
			_ = Color.grey;
			if (!(Color32.op_Implicit(pTile.building.getColorForMinimap(pTile)) == Color32.op_Implicit(Toolbox.clear)))
			{
				world_layer.pixels[pTile.data.tile_id] = pTile.building.getColorForMinimap(pTile);
				return;
			}
		}
		world_layer.pixels[pTile.data.tile_id] = pTile.getColor();
	}

	public void followUnit(Actor pActor)
	{
		SelectedUnit.clear();
		move_camera.focusOnAndFollow(pActor, null, null);
	}

	public void locateSelectedVillage()
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		City selected_city = SelectedMetas.selected_city;
		ScrollWindow.hideAllEvent();
		move_camera.focusOn(Vector2.op_Implicit(selected_city.city_center));
	}

	public void locatePosition(Vector3 pVector)
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		if (isGameplayControlsLocked())
		{
			ScrollWindow.hideAllEvent();
		}
		move_camera.focusOn(pVector);
	}

	public void locatePosition(Vector3 pVector, Action pFocusReachedCallback, Action pFocusCancelCallback)
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		if (isGameplayControlsLocked())
		{
			ScrollWindow.hideAllEvent();
		}
		move_camera.focusOn(pVector, pFocusReachedCallback, pFocusCancelCallback);
	}

	public void locateAndFollow(Actor pActor, Action pFocusReachedCallback, Action pFocusCancelCallback)
	{
		if (isGameplayControlsLocked())
		{
			ScrollWindow.hideAllEvent();
		}
		move_camera.focusOnAndFollow(pActor, pFocusReachedCallback, pFocusCancelCallback);
	}

	public bool isSelectedPower(string pPower)
	{
		if (!isAnyPowerSelected())
		{
			return false;
		}
		if (selected_power.id == pPower)
		{
			return true;
		}
		return false;
	}

	public string getSelectedPowerID()
	{
		if (!isAnyPowerSelected())
		{
			return string.Empty;
		}
		return selected_power.id;
	}

	public MouseHoldAnimation getSelectedPowerHoldAnimation()
	{
		if (!isAnyPowerSelected())
		{
			return MouseHoldAnimation.Default;
		}
		return getSelectedPowerAsset().mouse_hold_animation;
	}

	public bool canDragMap()
	{
		if (!isAnyPowerSelected())
		{
			return true;
		}
		return getSelectedPowerAsset().can_drag_map;
	}

	public GodPower getSelectedPowerAsset()
	{
		if (!isAnyPowerSelected())
		{
			return null;
		}
		return AssetManager.powers.get(getSelectedPowerID());
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isAnyPowerSelected()
	{
		return (Object)(object)selected_buttons.selectedButton != (Object)null;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	internal bool isPaused()
	{
		return _is_paused;
	}

	internal void spawnCongratulationFireworks()
	{
		City random = cities.getRandom();
		if (random != null)
		{
			Building random2 = Randy.getRandom(random.buildings);
			if (random2 != null && !random2.isUnderConstruction())
			{
				EffectsLibrary.spawn("fx_fireworks", random2.current_tile);
			}
		}
	}

	internal void spawnForcedFireworks()
	{
		WorldTile random = Randy.getRandom(tiles_list);
		PlayerConfig.dict["sound"].boolVal = true;
		EffectsLibrary.spawn("fx_fireworks", random);
	}

	public int getCivWorldPopulation()
	{
		int num = 0;
		foreach (Actor unit in units)
		{
			if (unit.isSapient())
			{
				num++;
			}
			if (unit.asset.is_boat)
			{
				num++;
			}
		}
		return num;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool isRenderMiniMap()
	{
		return instance.quality_changer.isLowRes();
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool isRenderGameplay()
	{
		return !instance.quality_changer.isLowRes();
	}

	internal static void aye()
	{
		CornerAye.instance.startAye();
	}

	public MetaTypeAsset getCachedMapMetaAsset()
	{
		return _cached_map_meta_asset;
	}

	public ArchitectMood getArchitectMood()
	{
		if (_cached_architect_mood == null)
		{
			_cached_architect_mood = map_stats.getArchitectMood();
		}
		return _cached_architect_mood;
	}

	public Color getArchitectColor()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return getArchitectMood().getColor();
	}
}
// --- End of File: MapBox.cs ---



// --- Start of File: MapChunk.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class MapChunk : IDisposable
{
	private readonly Queue<WorldTile> _wave = new Queue<WorldTile>(256);

	public readonly ChunkObjectContainer objects = new ChunkObjectContainer();

	public MapChunk[] neighbours;

	public MapChunk[] neighbours_all;

	public readonly WorldTile[] tiles = new WorldTile[256];

	public readonly List<MapRegion> regions = new List<MapRegion>(4);

	public List<WorldTile> edges_all;

	public List<WorldTile> chunk_bounds;

	public readonly List<WorldTile> bounds_left = new List<WorldTile>(16);

	public readonly List<WorldTile> bounds_up = new List<WorldTile>(16);

	public readonly List<WorldTile> bounds_down = new List<WorldTile>(16);

	public readonly List<WorldTile> bounds_right = new List<WorldTile>(16);

	public float world_center_x;

	public float world_center_y;

	public WorldTile edge_up_left;

	public WorldTile edge_up_right;

	public WorldTile edge_down_left;

	public WorldTile edge_down_right;

	private WorldTile _edge_up_left_connection;

	private WorldTile _edge_up_right_connection;

	private WorldTile _edge_down_left_connection;

	private WorldTile _edge_down_right_connection;

	public bool world_edge;

	public int x;

	public int y;

	public int id;

	public Color color;

	public bool dirty_regions;

	public bool dirty_links;

	private readonly List<WorldTile> _temp_tiles = new List<WorldTile>(16);

	private readonly List<TempLinkStruct> _new_hashes = new List<TempLinkStruct>();

	internal MapChunk chunk_up;

	internal MapChunk chunk_down;

	internal MapChunk chunk_left;

	internal MapChunk chunk_right;

	private readonly StackPool<MapRegion> _region_pool = new StackPool<MapRegion>();

	public readonly List<TileZone> zones = new List<TileZone>();

	private bool _buildings_dirty;

	private bool _tile_types_dirty;

	private const int MAX_TILE_TYPES = 256;

	private readonly Dictionary<TileTypeBase, int> _tile_types_count = new Dictionary<TileTypeBase, int>(256);

	private readonly List<MusicBoxTileData> _simple_data = new List<MusicBoxTileData>();

	public bool buildings_dirty => _buildings_dirty;

	internal void addTile(WorldTile pTile, int pX, int pY)
	{
		tiles[tiles.FreeIndex()] = pTile;
	}

	internal void addNeighbour(MapChunk pNeighbour, TileDirection pDirection, IList<MapChunk> pNeighbours, IList<MapChunk> pNeighboursAll, bool pDiagonal = false)
	{
		if (pNeighbour == null)
		{
			world_edge = true;
			return;
		}
		if (!pDiagonal)
		{
			pNeighbours.Add(pNeighbour);
		}
		pNeighboursAll.Add(pNeighbour);
		switch (pDirection)
		{
		case TileDirection.Up:
			chunk_up = pNeighbour;
			break;
		case TileDirection.Down:
			chunk_down = pNeighbour;
			break;
		case TileDirection.Left:
			chunk_left = pNeighbour;
			break;
		case TileDirection.Right:
			chunk_right = pNeighbour;
			break;
		}
	}

	public void calculateRegions()
	{
		dirty_regions = false;
		WorldTile[] array = tiles;
		List<MapRegion> list = regions;
		StackPool<MapRegion> region_pool = _region_pool;
		clearTiles();
		int num = array.Length;
		for (int i = 0; i < num; i++)
		{
			WorldTile worldTile = array[i];
			if (worldTile.region == null)
			{
				MapRegion mapRegion = region_pool.get();
				mapRegion.reset();
				mapRegion.type = worldTile.Type.layer_type;
				mapRegion.chunk = this;
				fillRegion(worldTile, mapRegion);
				mapRegion.id = worldTile.zone.id * 1000 + list.Count;
				list.Add(mapRegion);
				if (mapRegion.tiles.Count == array.Length)
				{
					break;
				}
			}
		}
		clearTiles(pClearRegion: false);
		num = list.Count;
		for (int j = 0; j < num; j++)
		{
			list[j].checkZones();
		}
	}

	private void clearTiles(bool pClearRegion = true)
	{
		WorldTile[] array = tiles;
		if (pClearRegion)
		{
			int num = array.Length;
			for (int i = 0; i < num; i++)
			{
				WorldTile obj = array[i];
				obj.is_checked_tile = false;
				obj.region = null;
			}
		}
		else
		{
			int num2 = array.Length;
			for (int j = 0; j < num2; j++)
			{
				array[j].is_checked_tile = false;
			}
		}
	}

	internal void shuffleRegionTiles()
	{
		for (int i = 0; i < regions.Count; i++)
		{
			MapRegion mapRegion = regions[i];
			if (regions.Count > 1)
			{
				mapRegion.center_region = false;
			}
			else
			{
				mapRegion.center_region = true;
			}
			mapRegion.tiles.Shuffle();
		}
	}

	private void fillRegion(WorldTile pTile, MapRegion pTargetRegion)
	{
		Queue<WorldTile> wave = _wave;
		wave.Enqueue(pTile);
		while (wave.Count > 0)
		{
			WorldTile worldTile = wave.Dequeue();
			worldTile.is_checked_tile = true;
			worldTile.region = pTargetRegion;
			pTargetRegion.tiles.Add(worldTile);
			processTileNeighbours(worldTile, pTargetRegion, wave);
		}
		wave.Clear();
	}

	private void processTileNeighbours(WorldTile pTileMain, MapRegion pTargetRegion, Queue<WorldTile> pWave)
	{
		WorldTile[] neighboursAll = pTileMain.neighboursAll;
		foreach (WorldTile worldTile in neighboursAll)
		{
			TileTypeBase type = worldTile.Type;
			if (!worldTile.is_checked_tile)
			{
				if (type.layer_type != pTileMain.region.type || worldTile.chunk != this)
				{
					pTargetRegion.edge_tiles_set.Add(worldTile);
				}
				else if (!isDiagonalBlockedByCorners(pTileMain, worldTile))
				{
					worldTile.is_checked_tile = true;
					worldTile.region = pTargetRegion;
					pWave.Enqueue(worldTile);
				}
			}
		}
	}

	private bool isDiagonalBlockedByCorners(WorldTile pTileFrom, WorldTile pTileTo)
	{
		int num = pTileTo.x - pTileFrom.x;
		int num2 = pTileTo.y - pTileFrom.y;
		if (Math.Abs(num) != 1 || Math.Abs(num2) != 1)
		{
			return false;
		}
		WorldTile tile = World.world.GetTile(pTileFrom.x + num, pTileFrom.y);
		WorldTile tile2 = World.world.GetTile(pTileFrom.x, pTileFrom.y + num2);
		bool num3 = tile?.Type.block ?? true;
		bool flag = tile2?.Type.block ?? true;
		return num3 || flag;
	}

	public void clearObjects(bool pForceClearBuildings = false)
	{
		if (pForceClearBuildings)
		{
			setBuildingsDirty();
		}
		objects.reset(buildings_dirty);
		_temp_tiles.Clear();
		_new_hashes.Clear();
	}

	public void clearRegions()
	{
		clearIsland();
		for (int i = 0; i < regions.Count; i++)
		{
			MapRegion mapRegion = regions[i];
			mapRegion.reset();
			_region_pool.release(mapRegion);
		}
		regions.Clear();
	}

	public void Dispose()
	{
		clearRegions();
		clearObjects(pForceClearBuildings: true);
		setBuildingsDirty();
		objects.Dispose();
		neighbours.Clear();
		neighbours_all.Clear();
		neighbours = null;
		neighbours_all = null;
		tiles.Clear();
		_wave.Clear();
		edges_all?.Clear();
		chunk_bounds?.Clear();
		bounds_left.Clear();
		bounds_up.Clear();
		bounds_down.Clear();
		bounds_right.Clear();
		chunk_up = null;
		chunk_down = null;
		chunk_left = null;
		chunk_right = null;
		edge_down_left = null;
		edge_down_right = null;
		edge_up_left = null;
		edge_up_right = null;
		_edge_down_left_connection = null;
		_edge_down_right_connection = null;
		_edge_up_left_connection = null;
		_edge_up_right_connection = null;
		_region_pool.clear();
		zones.Clear();
	}

	public void clearIsland()
	{
		for (int i = 0; i < regions.Count; i++)
		{
			MapRegion mapRegion = regions[i];
			mapRegion.clear();
			if (mapRegion.island != null)
			{
				World.world.islands_calculator.makeDirty(mapRegion.island);
			}
		}
	}

	internal void combineEdges()
	{
		HashSet<WorldTile> hashSet = new HashSet<WorldTile>();
		edges_all = new List<WorldTile>(hashSet);
		hashSet.Clear();
		hashSet.UnionWith(bounds_down);
		hashSet.UnionWith(bounds_left);
		hashSet.UnionWith(bounds_right);
		hashSet.UnionWith(bounds_up);
		chunk_bounds = new List<WorldTile>(hashSet);
	}

	public void generateEdgeConnections()
	{
		_edge_up_left_connection = chunk_left?.chunk_up?.edge_down_right;
		_edge_up_right_connection = chunk_right?.chunk_up?.edge_down_left;
		_edge_down_left_connection = chunk_left?.chunk_down?.edge_up_right;
		_edge_down_right_connection = chunk_right?.chunk_down?.edge_up_left;
	}

	public void checkLinksResults()
	{
		for (int i = 0; i < _new_hashes.Count; i++)
		{
			TempLinkStruct tempLinkStruct = _new_hashes[i];
			RegionLinkHashes.addHash(tempLinkStruct.hash, tempLinkStruct.region);
		}
		MapChunkManager.m_newLinks += _new_hashes.Count;
		_new_hashes.Clear();
	}

	internal void calculateLinks()
	{
		dirty_links = false;
		calculateLink(bounds_right, chunk_right?.bounds_left, LinkDirection.Right, LinkDirection.LR, pUseTargetList: true);
		calculateLink(bounds_left, chunk_left?.bounds_right, LinkDirection.Left, LinkDirection.LR);
		calculateLink(bounds_up, chunk_up?.bounds_down, LinkDirection.Up, LinkDirection.UD, pUseTargetList: true);
		calculateLink(bounds_down, chunk_down?.bounds_up, LinkDirection.Down, LinkDirection.UD);
		checkSpecialDiagonalConnection(edge_up_left, _edge_up_left_connection, LinkDirection.Up, LinkDirection.UD);
		checkSpecialDiagonalConnection(edge_up_right, _edge_up_right_connection, LinkDirection.Up, LinkDirection.UD, pUseTargetList: true);
		checkSpecialDiagonalConnection(edge_down_left, _edge_down_left_connection, LinkDirection.Down, LinkDirection.UD);
		checkSpecialDiagonalConnection(edge_down_right, _edge_down_right_connection, LinkDirection.Down, LinkDirection.UD, pUseTargetList: true);
	}

	private void checkSpecialDiagonalConnection(WorldTile pTileMain, WorldTile pTileTarget, LinkDirection pDirection, LinkDirection pGroupID, bool pUseTargetList = false)
	{
		if (pTileTarget != null && WorldTile.isSameLayer(pTileMain, pTileTarget) && !isDiagonalBlockedByCorners(pTileMain, pTileTarget))
		{
			if (pUseTargetList)
			{
				_temp_tiles.Add(pTileTarget);
			}
			else
			{
				_temp_tiles.Add(pTileMain);
			}
			makeLink(_temp_tiles, pDirection, pGroupID, pTileMain.region);
		}
	}

	private void calculateLink(List<WorldTile> pOurBounds, List<WorldTile> pTargetEdgeTiles, LinkDirection pDirection, LinkDirection pGroupID, bool pUseTargetList = false)
	{
		if (pTargetEdgeTiles == null)
		{
			return;
		}
		int count = pOurBounds.Count;
		List<WorldTile> temp_tiles = _temp_tiles;
		temp_tiles.Clear();
		bool flag = false;
		MapRegion pRegionMain = null;
		for (int i = 0; i < count; i++)
		{
			bool flag2 = i == count - 1;
			WorldTile worldTile = pOurBounds[i];
			WorldTile worldTile2 = pTargetEdgeTiles[i];
			bool flag3 = WorldTile.isSameLayer(worldTile, worldTile2);
			if (flag3 && !flag)
			{
				flag = true;
				pRegionMain = worldTile.region;
			}
			if (!flag2)
			{
				if (flag3)
				{
					WorldTile pTile = pOurBounds[i + 1];
					flag3 = WorldTile.isSameLayer(worldTile, pTile);
				}
				if (flag3)
				{
					WorldTile pTile2 = pTargetEdgeTiles[i + 1];
					flag3 = WorldTile.isSameLayer(worldTile, pTile2);
				}
			}
			if (!flag3 && !flag && tryDiagonal(worldTile, worldTile2, pDirection, pGroupID, pUseTargetList, temp_tiles))
			{
				flag = false;
				pRegionMain = null;
				continue;
			}
			if (flag2)
			{
				flag3 = false;
			}
			if (flag || flag3)
			{
				if (!flag && flag3)
				{
					flag = true;
					pRegionMain = worldTile.region;
					saveToConnection(temp_tiles, worldTile, worldTile2, pUseTargetList);
				}
				else if (flag && !flag3)
				{
					saveToConnection(temp_tiles, worldTile, worldTile2, pUseTargetList);
					makeLink(temp_tiles, pDirection, pGroupID, pRegionMain);
					flag = false;
					pRegionMain = null;
				}
				else
				{
					saveToConnection(temp_tiles, worldTile, worldTile2, pUseTargetList);
				}
			}
		}
	}

	private bool tryDiagonal(WorldTile pMainTile, WorldTile pTargetTile, LinkDirection pDirection, LinkDirection pGroupID, bool pUseTargetList, List<WorldTile> pListConnections)
	{
		bool result = false;
		WorldTile diagonalConnection = getDiagonalConnection(pMainTile, pTargetTile, pDirection, pFirst: true);
		if (diagonalConnection != null)
		{
			saveToConnection(pListConnections, pMainTile, diagonalConnection, pUseTargetList);
			makeLink(pListConnections, pDirection, pGroupID, pMainTile.region);
			result = true;
		}
		WorldTile diagonalConnection2 = getDiagonalConnection(pMainTile, pTargetTile, pDirection, pFirst: false);
		if (diagonalConnection2 != null)
		{
			saveToConnection(pListConnections, pMainTile, diagonalConnection2, pUseTargetList);
			makeLink(pListConnections, pDirection, pGroupID, pMainTile.region);
			result = true;
		}
		return result;
	}

	private void saveToConnection(List<WorldTile> pList, WorldTile pOurTile, WorldTile pTargetTile, bool pUseTargetList)
	{
		if (pUseTargetList)
		{
			pList.Add(pTargetTile);
		}
		else
		{
			pList.Add(pOurTile);
		}
	}

	private WorldTile getDiagonalConnection(WorldTile pOurTile, WorldTile pTargetTile, LinkDirection pDirection, bool pFirst)
	{
		TileLayerType layer_type = pOurTile.Type.layer_type;
		WorldTile worldTile = null;
		switch (pDirection)
		{
		case LinkDirection.Up:
		case LinkDirection.Down:
			worldTile = (pFirst ? pTargetTile.tile_right : pTargetTile.tile_left);
			break;
		case LinkDirection.Left:
		case LinkDirection.Right:
			worldTile = (pFirst ? pTargetTile.tile_up : pTargetTile.tile_down);
			break;
		}
		if (worldTile == null)
		{
			return null;
		}
		if (isDiagonalBlockedByCorners(pOurTile, worldTile))
		{
			return null;
		}
		if (worldTile.Type.layer_type != layer_type)
		{
			return null;
		}
		return worldTile;
	}

	private void makeLink(List<WorldTile> pConnectionList, LinkDirection pDirection, LinkDirection pGroupID, MapRegion pRegionMain)
	{
		int hash = pRegionMain.newConnection(pConnectionList, pDirection, pGroupID);
		_new_hashes.Add(new TempLinkStruct
		{
			region = pRegionMain,
			hash = hash
		});
		pConnectionList.Clear();
	}

	public void setBuildingsDirty()
	{
		_buildings_dirty = true;
	}

	public void finishBuildingsCheck()
	{
		_buildings_dirty = false;
	}

	public List<MusicBoxTileData> getSimpleData()
	{
		if (_tile_types_dirty)
		{
			musicBoxCheckCount();
		}
		return _simple_data;
	}

	private void musicBoxCheckCount()
	{
		_tile_types_dirty = false;
		_tile_types_count.Clear();
		_simple_data.Clear();
		int i = 0;
		TileTypeBase key;
		for (int count = zones.Count; i < count; i++)
		{
			foreach (KeyValuePair<TileTypeBase, HashSet<WorldTile>> tileType in zones[i].getTileTypes())
			{
				tileType.Deconstruct(out key, out var value);
				TileTypeBase tileTypeBase = key;
				HashSet<WorldTile> hashSet = value;
				if (tileTypeBase.music_assets != null)
				{
					int count2 = hashSet.Count;
					if (!_tile_types_count.TryAdd(tileTypeBase, count2))
					{
						Dictionary<TileTypeBase, int> tile_types_count = _tile_types_count;
						key = tileTypeBase;
						tile_types_count[key] += count2;
					}
				}
			}
		}
		foreach (KeyValuePair<TileTypeBase, int> item in _tile_types_count)
		{
			item.Deconstruct(out key, out var value2);
			TileTypeBase tileTypeBase2 = key;
			int amount = value2;
			_simple_data.Add(new MusicBoxTileData
			{
				tile_type_id = tileTypeBase2.index_id,
				amount = amount
			});
		}
	}

	public Dictionary<TileTypeBase, int> getTileTypesCount()
	{
		if (_tile_types_dirty)
		{
			musicBoxCheckCount();
		}
		return _tile_types_count;
	}

	public int countTilesOfType(TileTypeBase pType)
	{
		if (_tile_types_dirty)
		{
			musicBoxCheckCount();
		}
		_tile_types_count.TryGetValue(pType, out var value);
		return value;
	}

	public void setTileTypesDirty()
	{
		_tile_types_dirty = true;
	}
}
// --- End of File: MapChunk.cs ---



// --- Start of File: MapChunkManager.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using UnityEngine;

public class MapChunkManager
{
	private readonly Color _color_1_gray = Color.gray;

	private readonly Color _color_2_white = Color.white;

	private MapChunk[,] _map;

	public MapChunk[] chunks = new MapChunk[0];

	private readonly List<MapChunk> _dirty_chunks_regions = new List<MapChunk>();

	private readonly List<MapChunk> _dirty_chunks_links = new List<MapChunk>();

	private int m_dirtyChunks;

	private static int m_dirtyCorners;

	private static int m_newRegions;

	public static int m_newLinks;

	internal static int m_newIslands;

	internal static int m_dirtyIslands;

	private float _timer = 0.4f;

	private int _get_amount_x;

	private int _amount_y;

	private readonly List<MapChunk> _last_dirty_chunks = new List<MapChunk>();

	private readonly List<MapChunk> _last_dirty_links = new List<MapChunk>();

	private readonly HashSet<MapRegion> _region_set = new HashSet<MapRegion>();

	private readonly List<TileIsland> _temp_dirty_neighbours_islands = new List<TileIsland>();

	public int amount_x => _get_amount_x;

	private bool _is_parallel_enabled => DebugConfig.isOn(DebugOption.ParallelChunks);

	private bool _batches_enabled => DebugConfig.isOn(DebugOption.ChunkBatches);

	public void checkDiagnosticRegions()
	{
		diagnosticRegions();
	}

	public void update(float pElapsed, bool pForce = false)
	{
		if (_timer > 0f && !pForce)
		{
			_timer -= pElapsed;
		}
		else
		{
			updateDirty();
		}
	}

	private void diagnosticRegions()
	{
		HashSet<MapRegion> hashSet = new HashSet<MapRegion>();
		HashSet<MapRegion> hashSet2 = new HashSet<MapRegion>();
		MapChunk[] array = chunks;
		int num = array.Length;
		for (int i = 0; i < num; i++)
		{
			foreach (MapRegion region in array[i].regions)
			{
				if (region.tiles.Count == 0 || region.chunk == null)
				{
					hashSet.Add(region);
				}
				foreach (MapRegion neighbour in region.neighbours)
				{
					if (neighbour.tiles.Count == 0 || neighbour.chunk == null)
					{
						hashSet2.Add(region);
					}
				}
			}
		}
		if (hashSet.Count > 0 || hashSet2.Count > 0)
		{
			Debug.LogError((object)"Something is wrong with regions");
			Debug.LogError((object)("tRegionMain: " + hashSet.Count));
			Debug.LogError((object)("tRegionNeighbour: " + hashSet2.Count));
		}
	}

	public void prepare()
	{
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		int num = 4;
		_get_amount_x = Config.ZONE_AMOUNT_X * num;
		_amount_y = Config.ZONE_AMOUNT_Y * num;
		_map = new MapChunk[_get_amount_x, _amount_y];
		int num2 = _get_amount_x * _amount_y;
		if (num2 != chunks.Length)
		{
			chunks = new MapChunk[num2];
		}
		else
		{
			Array.Clear(chunks, 0, chunks.Length);
		}
		int num3 = 0;
		int num4 = 0;
		for (int i = 0; i < _amount_y; i++)
		{
			for (int j = 0; j < _get_amount_x; j++)
			{
				MapChunk mapChunk = new MapChunk();
				mapChunk.id = num3++;
				mapChunk.x = j;
				mapChunk.y = i;
				_map[j, i] = mapChunk;
				if ((j + i) % 2 == 0)
				{
					mapChunk.color = _color_1_gray;
				}
				else
				{
					mapChunk.color = _color_2_white;
				}
				chunks[num4] = mapChunk;
				fill(mapChunk);
				num4++;
			}
		}
		fillAndLinkTileZones();
		generateNeighbours();
		generateEdgeConnections();
	}

	private void generateEdgeConnections()
	{
		MapChunk[] array = chunks;
		int num = array.Length;
		for (int i = 0; i < num; i++)
		{
			array[i].generateEdgeConnections();
		}
	}

	private void fillAndLinkTileZones()
	{
		for (int i = 0; i < World.world.zone_calculator.zones.Count; i++)
		{
			TileZone tileZone = World.world.zone_calculator.zones[i];
			tileZone.chunk.zones.Add(tileZone);
		}
	}

	private void fill(MapChunk pChunk)
	{
		int num = 16;
		int num2 = pChunk.x * num;
		int num3 = pChunk.y * num;
		for (int i = 0; i < num; i++)
		{
			for (int j = 0; j < num; j++)
			{
				WorldTile tileSimple = World.world.GetTileSimple(i + num2, j + num3);
				tileSimple.chunk = pChunk;
				pChunk.addTile(tileSimple, i, j);
			}
		}
		pChunk.world_center_x = num2 + 8;
		pChunk.world_center_y = num3 + 8;
		for (int k = 0; k < 16; k++)
		{
			WorldTile tileSimple = World.world.GetTileSimple(k + num2, num3);
			pChunk.bounds_down.Add(tileSimple);
		}
		for (int l = 0; l < 16; l++)
		{
			WorldTile tileSimple = World.world.GetTileSimple(num2, num3 + l);
			pChunk.bounds_left.Add(tileSimple);
		}
		for (int m = 0; m < 16; m++)
		{
			WorldTile tileSimple = World.world.GetTileSimple(num2 + 16 - 1, num3 + m);
			pChunk.bounds_right.Add(tileSimple);
		}
		for (int n = 0; n < 16; n++)
		{
			WorldTile tileSimple = World.world.GetTileSimple(n + num2, num3 + 16 - 1);
			pChunk.bounds_up.Add(tileSimple);
		}
		pChunk.edge_up_left = pChunk.bounds_up[0];
		pChunk.edge_up_right = pChunk.bounds_up[15];
		pChunk.edge_down_left = pChunk.bounds_down[0];
		pChunk.edge_down_right = pChunk.bounds_down[15];
		pChunk.combineEdges();
	}

	private void generateNeighbours()
	{
		MapChunk[] array = chunks;
		int num = array.Length;
		using ListPool<MapChunk> listPool = new ListPool<MapChunk>(4);
		using ListPool<MapChunk> listPool2 = new ListPool<MapChunk>(8);
		for (int i = 0; i < num; i++)
		{
			MapChunk mapChunk = array[i];
			MapChunk pNeighbour = get(mapChunk.x - 1, mapChunk.y);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Left, listPool, listPool2);
			pNeighbour = get(mapChunk.x + 1, mapChunk.y);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Right, listPool, listPool2);
			pNeighbour = get(mapChunk.x, mapChunk.y - 1);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Down, listPool, listPool2);
			pNeighbour = get(mapChunk.x, mapChunk.y + 1);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Up, listPool, listPool2);
			pNeighbour = get(mapChunk.x - 1, mapChunk.y - 1);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Null, listPool, listPool2, pDiagonal: true);
			pNeighbour = get(mapChunk.x - 1, mapChunk.y + 1);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Null, listPool, listPool2, pDiagonal: true);
			pNeighbour = get(mapChunk.x + 1, mapChunk.y - 1);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Null, listPool, listPool2, pDiagonal: true);
			pNeighbour = get(mapChunk.x + 1, mapChunk.y + 1);
			mapChunk.addNeighbour(pNeighbour, TileDirection.Null, listPool, listPool2, pDiagonal: true);
			mapChunk.neighbours = listPool.ToArray();
			mapChunk.neighbours_all = listPool2.ToArray();
			listPool.Clear();
			listPool2.Clear();
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public MapChunk get(int pX, int pY)
	{
		if (pX < 0 || pX >= _get_amount_x || pY < 0 || pY >= _amount_y)
		{
			return null;
		}
		return _map[pX, pY];
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public MapChunk get(ref Vector2Int pPos)
	{
		if (((Vector2Int)(ref pPos)).x < 0 || ((Vector2Int)(ref pPos)).x >= _get_amount_x || ((Vector2Int)(ref pPos)).y < 0 || ((Vector2Int)(ref pPos)).y >= _amount_y)
		{
			return null;
		}
		return _map[((Vector2Int)(ref pPos)).x, ((Vector2Int)(ref pPos)).y];
	}

	public MapChunk getByID(int pID)
	{
		return chunks[pID];
	}

	public void clearAll()
	{
		World.world.islands_calculator.clear();
		_dirty_chunks_links.Clear();
		_dirty_chunks_regions.Clear();
		int num = chunks.Length;
		for (int i = 0; i < num; i++)
		{
			chunks[i].clearRegions();
		}
	}

	public void clean()
	{
		clearAll();
		MapChunk[] array = chunks;
		int num = array.Length;
		for (int i = 0; i < num; i++)
		{
			array[i].Dispose();
		}
		Array.Clear(chunks, 0, chunks.Length);
	}

	public void setAllLinksDirty()
	{
		MapChunk[] array = chunks;
		foreach (MapChunk pChunk in array)
		{
			setDirty(pChunk, pRegions: false);
		}
	}

	public void setDirty(MapChunk pChunk, bool pRegions = true, bool pLinks = true)
	{
		if (pRegions && !pChunk.dirty_regions)
		{
			pChunk.dirty_regions = true;
			_dirty_chunks_regions.Add(pChunk);
		}
		if (pLinks && !pChunk.dirty_links)
		{
			pChunk.dirty_links = true;
			_dirty_chunks_links.Add(pChunk);
		}
	}

	public void allDirty()
	{
		_dirty_chunks_links.Clear();
		_dirty_chunks_regions.Clear();
		MapChunk[] array = chunks;
		int num = array.Length;
		for (int i = 0; i < num; i++)
		{
			MapChunk obj = array[i];
			obj.dirty_links = true;
			obj.dirty_regions = true;
		}
		_dirty_chunks_links.AddRange(chunks);
		_dirty_chunks_regions.AddRange(chunks);
	}

	private bool isAllChunksDirty()
	{
		return chunks.Length == _dirty_chunks_regions.Count;
	}

	private void updateDirty()
	{
		if (!DebugConfig.isOn(DebugOption.SystemUpdateDirtyChunks) || (!isAllChunksDirty() && World.world.isActionHappening()) || (_dirty_chunks_links.Count == 0 && _dirty_chunks_regions.Count == 0))
		{
			return;
		}
		Bench.bench("chunks", "chunks_total");
		_timer = 0.4f;
		m_dirtyChunks = _dirty_chunks_regions.Count;
		m_newRegions = 0;
		m_newLinks = 0;
		m_newIslands = 0;
		m_dirtyIslands = 0;
		m_dirtyCorners = 0;
		MapRegion.created_time_last = Time.time;
		World.world.islands_calculator.prepareCalc();
		Bench.bench("clear_regions", "chunks");
		calc_clearRegions();
		Bench.benchEnd("clear_regions", "chunks", pSaveCounter: true, _dirty_chunks_links.Count);
		Bench.bench("clear_dirty_islands", "chunks");
		World.world.islands_calculator.clearDirty();
		Bench.benchEnd("clear_dirty_islands", "chunks", pSaveCounter: true, _dirty_chunks_links.Count);
		Bench.bench("P calc_regions", "chunks");
		calc_regions();
		Bench.benchEnd("P calc_regions", "chunks", pSaveCounter: true, _dirty_chunks_regions.Count);
		Bench.bench("shuffle_region_tiles", "chunks");
		calc_shuffleRegionTiles();
		Bench.benchEnd("shuffle_region_tiles", "chunks", pSaveCounter: true, m_newRegions);
		Bench.bench("P calc_links", "chunks");
		calc_links();
		Bench.benchEnd("P calc_links", "chunks", pSaveCounter: true, _dirty_chunks_links.Count);
		Bench.bench("create_links", "chunks");
		calc_checkLinkResults();
		Bench.benchEnd("create_links", "chunks", pSaveCounter: true, _dirty_chunks_links.Count);
		Bench.bench("P calc_linked_regions", "chunks");
		calc_linkedRegions();
		Bench.benchEnd("P calc_linked_regions", "chunks", pSaveCounter: true, _dirty_chunks_links.Count);
		using ListPool<TileIsland> pNewIslands = new ListPool<TileIsland>();
		World.world.islands_calculator.findIslands(pNewIslands);
		Bench.bench("tile_corners_prepare", "chunks");
		calc_tileCornersPrepare(_region_set);
		m_dirtyCorners = _region_set.Count;
		Bench.benchEnd("tile_corners_prepare", "chunks", pSaveCounter: true, _dirty_chunks_links.Count);
		Bench.bench("center_regions", "chunks");
		calc_centerRegions();
		Bench.benchEnd("center_regions", "chunks", pSaveCounter: true, _region_set.Count);
		Bench.bench("island_region_edges", "chunks");
		int num = calc_islandRegionEdges(pNewIslands);
		Bench.benchEnd("island_region_edges", "chunks", pSaveCounter: true, num);
		Bench.bench("PH tile_edges", "chunks");
		calc_tileEdges();
		Bench.benchEnd("PH tile_edges", "chunks", pSaveCounter: true, _region_set.Count);
		Bench.bench("prepare_d_neighbour_islands", "chunks");
		prepareDirtyNeighbourIslands();
		Bench.benchEnd("prepare_d_neighbour_islands", "chunks", pSaveCounter: true, _temp_dirty_neighbours_islands.Count);
		Bench.bench("P neighbour_islands", "chunks");
		calc_neighbourIslands();
		Bench.benchEnd("P neighbour_islands", "chunks", pSaveCounter: true, _temp_dirty_neighbours_islands.Count);
		Bench.bench("clear_end", "chunks");
		_region_set.Clear();
		_dirty_chunks_links.Clear();
		_dirty_chunks_regions.Clear();
		World.world.city_zone_helper.city_place_finder.setDirty();
		World.world.region_path_finder.clearCache();
		Bench.benchEnd("clear_end", "chunks", pSaveCounter: false, 0L);
		Bench.benchSetValue("m_dirtyChunks", m_dirtyChunks, "chunks");
		Bench.benchSetValue("m_newRegions", m_newRegions, "chunks");
		Bench.benchSetValue("m_newLinks", m_newLinks, "chunks");
		Bench.benchSetValue("m_newIslands", m_newIslands, "chunks");
		Bench.benchSetValue("m_dirtyIslands", m_dirtyIslands, "chunks");
		Bench.benchSetValue("m_dirtyCorners", m_dirtyCorners, "chunks");
		Bench.benchSetValue("m_dirtyIslandNeighb", _temp_dirty_neighbours_islands.Count, "chunks");
		Bench.benchEnd("chunks", "chunks_total", pSaveCounter: false, 0L);
	}

	private void calc_clearRegions()
	{
		List<MapChunk> dirty_chunks_regions = _dirty_chunks_regions;
		int count = dirty_chunks_regions.Count;
		for (int i = 0; i < count; i++)
		{
			dirty_chunks_regions[i].clearRegions();
		}
		List<MapChunk> dirty_chunks_links = _dirty_chunks_links;
		int count2 = dirty_chunks_links.Count;
		for (int j = 0; j < count2; j++)
		{
			dirty_chunks_links[j].clearIsland();
		}
	}

	private void calc_regions()
	{
		if (_is_parallel_enabled)
		{
			List<MapChunk> tDirtyChunks = _dirty_chunks_regions;
			int tCount = tDirtyChunks.Count;
			if (!_batches_enabled)
			{
				Parallel.For(0, tCount, World.world.parallel_options, delegate(int pIndex)
				{
					tDirtyChunks[pIndex].calculateRegions();
				});
				return;
			}
			int tDynamicBatchSize = ParallelHelper.getDynamicBatchSize(tCount);
			int toExclusive = ParallelHelper.calcTotalBatches(tCount, tDynamicBatchSize);
			Parallel.For(0, toExclusive, World.world.parallel_options, delegate(int pBatchIndex)
			{
				int num = ParallelHelper.calculateBatchBeg(pBatchIndex, tDynamicBatchSize);
				int num2 = ParallelHelper.calculateBatchEnd(num, tDynamicBatchSize, tCount);
				for (int j = num; j < num2; j++)
				{
					tDirtyChunks[j].calculateRegions();
				}
			});
		}
		else
		{
			List<MapChunk> dirty_chunks_regions = _dirty_chunks_regions;
			int count = dirty_chunks_regions.Count;
			for (int i = 0; i < count; i++)
			{
				dirty_chunks_regions[i].calculateRegions();
			}
		}
	}

	private void calc_shuffleRegionTiles()
	{
		List<MapChunk> dirty_chunks_regions = _dirty_chunks_regions;
		int count = dirty_chunks_regions.Count;
		for (int i = 0; i < count; i++)
		{
			MapChunk mapChunk = dirty_chunks_regions[i];
			m_newRegions += mapChunk.regions.Count;
			mapChunk.shuffleRegionTiles();
		}
	}

	private void calc_links()
	{
		if (_is_parallel_enabled)
		{
			List<MapChunk> tDirtyChunks = _dirty_chunks_links;
			int tCount = tDirtyChunks.Count;
			if (!_batches_enabled)
			{
				Parallel.For(0, tCount, World.world.parallel_options, delegate(int pIndex)
				{
					tDirtyChunks[pIndex].calculateLinks();
				});
				return;
			}
			int tDynamicBatchSize = ParallelHelper.getDynamicBatchSize(tCount);
			int toExclusive = ParallelHelper.calcTotalBatches(tCount, tDynamicBatchSize);
			Parallel.For(0, toExclusive, World.world.parallel_options, delegate(int pBatchIndex)
			{
				int num = ParallelHelper.calculateBatchBeg(pBatchIndex, tDynamicBatchSize);
				int num2 = ParallelHelper.calculateBatchEnd(num, tDynamicBatchSize, tCount);
				for (int j = num; j < num2; j++)
				{
					tDirtyChunks[j].calculateLinks();
				}
			});
		}
		else
		{
			List<MapChunk> dirty_chunks_links = _dirty_chunks_links;
			int count = dirty_chunks_links.Count;
			for (int i = 0; i < count; i++)
			{
				dirty_chunks_links[i].calculateLinks();
			}
		}
	}

	private void calc_checkLinkResults()
	{
		List<MapChunk> dirty_chunks_links = _dirty_chunks_links;
		int count = dirty_chunks_links.Count;
		for (int i = 0; i < count; i++)
		{
			dirty_chunks_links[i].checkLinksResults();
		}
	}

	private void calc_linkedRegions()
	{
		if (_is_parallel_enabled)
		{
			List<MapChunk> tDirtyChunks = _dirty_chunks_links;
			int tCount = tDirtyChunks.Count;
			if (!_batches_enabled)
			{
				Parallel.For(0, tCount, World.world.parallel_options, delegate(int pIndex)
				{
					MapChunk pChunk3 = tDirtyChunks[pIndex];
					calculateRegionNeighbours(pChunk3);
				});
				return;
			}
			int tDynamicBatchSize = ParallelHelper.getDynamicBatchSize(tCount);
			int toExclusive = ParallelHelper.calcTotalBatches(tCount, tDynamicBatchSize);
			Parallel.For(0, toExclusive, World.world.parallel_options, delegate(int pBatchIndex)
			{
				int num = ParallelHelper.calculateBatchBeg(pBatchIndex, tDynamicBatchSize);
				int num2 = ParallelHelper.calculateBatchEnd(num, tDynamicBatchSize, tCount);
				for (int j = num; j < num2; j++)
				{
					MapChunk pChunk2 = tDirtyChunks[j];
					calculateRegionNeighbours(pChunk2);
				}
			});
		}
		else
		{
			List<MapChunk> dirty_chunks_links = _dirty_chunks_links;
			int count = dirty_chunks_links.Count;
			for (int i = 0; i < count; i++)
			{
				MapChunk pChunk = dirty_chunks_links[i];
				calculateRegionNeighbours(pChunk);
			}
		}
	}

	private void calc_tileCornersPrepare(HashSet<MapRegion> pSetRegionsResult)
	{
		List<MapChunk> dirty_chunks_links = _dirty_chunks_links;
		int count = dirty_chunks_links.Count;
		for (int i = 0; i < count; i++)
		{
			List<MapRegion> regions = dirty_chunks_links[i].regions;
			int count2 = regions.Count;
			for (int j = 0; j < count2; j++)
			{
				MapRegion item = regions[j];
				pSetRegionsResult.Add(item);
			}
		}
	}

	private void calc_centerRegions()
	{
		foreach (MapRegion item in _region_set)
		{
			item.calculateCenterRegion();
		}
	}

	private int calc_islandRegionEdges(ListPool<TileIsland> pNewIslands)
	{
		int num = 0;
		for (int i = 0; i < pNewIslands.Count; i++)
		{
			TileIsland tileIsland = pNewIslands[i];
			List<MapRegion> simpleList = tileIsland.regions.getSimpleList();
			for (int j = 0; j < simpleList.Count; j++)
			{
				MapRegion mapRegion = simpleList[j];
				num++;
				if (!mapRegion.center_region)
				{
					tileIsland.insideRegionEdges.Add(mapRegion);
				}
			}
		}
		return num;
	}

	private void calc_tileEdges()
	{
		HashSet<MapRegion> region_set = _region_set;
		if (_is_parallel_enabled)
		{
			Parallel.ForEach(region_set, World.world.parallel_options, delegate(MapRegion tReg)
			{
				tReg.calculateTileEdges();
			});
			return;
		}
		foreach (MapRegion item in region_set)
		{
			item.calculateTileEdges();
		}
	}

	private void prepareDirtyNeighbourIslands()
	{
		ListPool<TileIsland> islands = World.world.islands_calculator.islands;
		List<TileIsland> temp_dirty_neighbours_islands = _temp_dirty_neighbours_islands;
		temp_dirty_neighbours_islands.Clear();
		foreach (ref TileIsland item in islands)
		{
			TileIsland current = item;
			if (current.isDirtyNeighbours())
			{
				temp_dirty_neighbours_islands.Add(current);
			}
		}
	}

	private void calc_neighbourIslands()
	{
		List<TileIsland> tIslandsWithDirtyNeighbours = _temp_dirty_neighbours_islands;
		if (_is_parallel_enabled)
		{
			int tCount = tIslandsWithDirtyNeighbours.Count;
			if (!_batches_enabled)
			{
				Parallel.For(0, tCount, World.world.parallel_options, delegate(int pIndex)
				{
					tIslandsWithDirtyNeighbours[pIndex].calcNeighbourIslands();
				});
				return;
			}
			int tDynamicBatchSize = ParallelHelper.DEBUG_BATCH_SIZE;
			int toExclusive = ParallelHelper.calcTotalBatches(tCount, tDynamicBatchSize);
			Parallel.For(0, toExclusive, World.world.parallel_options, delegate(int pBatchIndex)
			{
				int num = ParallelHelper.calculateBatchBeg(pBatchIndex, tDynamicBatchSize);
				int num2 = ParallelHelper.calculateBatchEnd(num, tDynamicBatchSize, tCount);
				for (int j = num; j < num2; j++)
				{
					tIslandsWithDirtyNeighbours[j].calcNeighbourIslands();
				}
			});
		}
		else
		{
			for (int i = 0; i < tIslandsWithDirtyNeighbours.Count; i++)
			{
				tIslandsWithDirtyNeighbours[i].calcNeighbourIslands();
			}
		}
	}

	private void checkWrongIslands()
	{
		MapChunk[] array = chunks;
		int num = array.Length;
		for (int i = 0; i < num; i++)
		{
			MapChunk mapChunk = array[i];
			foreach (MapRegion region in mapChunk.regions)
			{
				foreach (WorldTile tile in region.tiles)
				{
					if (tile.Type.layer_type != region.island.type)
					{
						bool flag = _last_dirty_chunks.Contains(mapChunk);
						bool flag2 = _last_dirty_links.Contains(mapChunk);
						Debug.LogError((object)("Wrong island type: " + tile.Type.layer_type.ToString() + " != " + region.island.type.ToString() + " " + tile.chunk.id + " - was dirty: " + flag + " | " + flag2));
						break;
					}
				}
			}
		}
	}

	private void calculateRegionNeighbours(MapChunk pChunk)
	{
		for (int i = 0; i < pChunk.regions.Count; i++)
		{
			pChunk.regions[i].calculateNeighbours();
		}
	}

	public int countRegions()
	{
		int num = 0;
		MapChunk[] array = chunks;
		int num2 = array.Length;
		for (int i = 0; i < num2; i++)
		{
			MapChunk mapChunk = array[i];
			num += mapChunk.regions.Count;
		}
		return num;
	}
}
// --- End of File: MapChunkManager.cs ---



// --- Start of File: MapDescription.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapDescription : MonoBehaviour
{
	public Button continueButton;

	public InputField mapDescriptionText;
}
// --- End of File: MapDescription.cs ---



// --- Start of File: MapEdges.cs ---
using UnityEngine;

public class MapEdges
{
	private static Texture2D textureLeft;

	private static Texture2D textureRight;

	private static Texture2D textureUp;

	private static Texture2D textureDown;

	private static Texture2D textureTempUp;

	private static Texture2D textureTempDown;

	private static int edgeSize;

	internal static void AddEdgeGradientCircle(WorldTile[,] pMap, string pWhat)
	{
		WorldTile pT = pMap[MapBox.width / 2, MapBox.height / 2];
		float num = 0.99f;
		float num2 = 0.85f;
		float num3 = (float)(MapBox.width / 2) * num;
		float num4 = (float)(MapBox.width / 2) * num2;
		float num5 = num3 - num4;
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			float num6 = Toolbox.DistTile(worldTile, pT);
			if (num6 > num3)
			{
				worldTile.Height = 0;
			}
			else if (num6 < num3 && num6 > num4)
			{
				float num7 = (num3 - num6) / num5;
				int height = (int)((float)worldTile.Height * num7);
				worldTile.Height = height;
			}
		}
	}

	internal static void AddEdgeSquare(WorldTile[,] pMap, string pWhat)
	{
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Expected O, but got Unknown
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Expected O, but got Unknown
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Expected O, but got Unknown
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Expected O, but got Unknown
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Expected O, but got Unknown
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Expected O, but got Unknown
		edgeSize = 64;
		if ((Object)(object)textureLeft == (Object)null)
		{
			textureLeft = (Texture2D)Resources.Load("edges/edge100xLeft");
			textureRight = (Texture2D)Resources.Load("edges/edge100xRight");
			textureUp = (Texture2D)Resources.Load("edges/edge100xUp");
			textureDown = (Texture2D)Resources.Load("edges/edge100xDown");
			textureTempUp = (Texture2D)Resources.Load("edges/edgeTempUp");
			textureTempDown = (Texture2D)Resources.Load("edges/edgeTempDown");
		}
		int num = (int)((float)MapBox.width / (float)edgeSize) + 1;
		int num2 = (int)((float)MapBox.height / (float)edgeSize) + 1;
		if (pWhat == "temperature")
		{
			for (int i = 0; i < num; i++)
			{
				fill(i, 0, textureTempDown, pMap, pWhat);
			}
			for (int j = 0; j < num; j++)
			{
				fill(j, num2 - 2, textureTempUp, pMap, pWhat);
			}
			return;
		}
		for (int k = 0; k < num2; k++)
		{
			fill(0, k, textureLeft, pMap, pWhat);
		}
		for (int l = 0; l < num2; l++)
		{
			fill(num - 2, l, textureRight, pMap, pWhat);
		}
		for (int m = 0; m < num; m++)
		{
			fill(m, 0, textureDown, pMap, pWhat);
		}
		for (int n = 0; n < num; n++)
		{
			fill(n, num2 - 2, textureUp, pMap, pWhat);
		}
	}

	internal static void fill(int pX, int pY, Texture2D pTexture, WorldTile[,] tilesMap, string pWhat)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		for (int i = 0; i < ((Texture)pTexture).height; i++)
		{
			for (int j = 0; j < ((Texture)pTexture).width; j++)
			{
				int num = (int)(pTexture.GetPixel(j, i).a * 255f);
				int num2 = j + pX * edgeSize;
				int num3 = i + pY * edgeSize;
				if (num2 < MapBox.width && num3 < MapBox.height)
				{
					WorldTile worldTile = tilesMap[num2, num3];
					if (worldTile != null && pWhat == "height")
					{
						worldTile.Height -= num;
					}
				}
			}
		}
	}
}
// --- End of File: MapEdges.cs ---



// --- Start of File: MapGenerator.cs ---
using System.Collections.Generic;
using UnityEngine;

public static class MapGenerator
{
	public static MapGenTemplate template;

	private static int _width = 0;

	private static int _height = 0;

	private static WorldTile[,] _tilesMap;

	private static List<GeneratedRoom> _rooms = new List<GeneratedRoom>();

	private static bool reported_tryMakeBiomeSteps = false;

	private static MapGenValues gen_values => template.values;

	public static void clear()
	{
		_tilesMap = null;
		_rooms.Clear();
	}

	public static void prepare()
	{
		template = AssetManager.map_gen_templates.get(Config.current_map_template);
		_width = MapBox.width;
		_height = MapBox.height;
		_tilesMap = World.world.tiles_map;
		schedulePerlinNoiseMap();
		scheduleUpdateTileTypes();
		if (gen_values.forbidden_knowledge_start)
		{
			World.world.world_laws.enable("world_law_cursed_world");
			CursedSacrifice.loadAlreadyCursedState();
		}
		if (gen_values.remove_mountains)
		{
			SmoothLoader.add(delegate
			{
				removeMountains();
			}, "Normalize Ground");
		}
		if (template.special_anthill)
		{
			SmoothLoader.add(delegate
			{
				specialAnthill();
			}, "Anthill");
		}
		if (template.special_checkerboard)
		{
			SmoothLoader.add(delegate
			{
				specialCheckerBoard();
			}, "Checkerboard");
		}
		if (template.special_cubicles)
		{
			SmoothLoader.add(delegate
			{
				specialCubicles();
			}, "Cubicles");
		}
		scheduleRandomShapes(Randy.randomBool());
		if (template.perlin_replace.Count > 0)
		{
			foreach (PerlinReplaceContainer tOption in template.perlin_replace)
			{
				SmoothLoader.add(delegate
				{
					GeneratorTool.ApplyPerlinReplace(tOption);
				}, "Perlin Replace");
			}
		}
		SmoothLoader.add(delegate
		{
			World.world.map_chunk_manager.allDirty();
		}, "Map Chunk Manager (1/2)", pSkipFrame: false, 0.1f);
		SmoothLoader.add(delegate
		{
			World.world.map_chunk_manager.update(0f, pForce: true);
		}, "Map Chunk Manager (2/2)", pSkipFrame: false, 0.1f);
		if (gen_values.random_biomes)
		{
			SmoothLoader.add(delegate
			{
				generateBiomes();
			}, "Add Random Biome");
		}
		if (gen_values.add_mountain_edges)
		{
			SmoothLoader.add(delegate
			{
				addMountainEdges();
			}, "Add Mountain Edges");
		}
		if (template.freeze_mountains)
		{
			SmoothLoader.add(delegate
			{
				freezeMountainTops();
			}, "Freeze Mountain Tops");
		}
		if (gen_values.add_vegetation)
		{
			int num = 12;
			int vegSpread = World.world.tiles_list.Length / 20;
			for (int i = 0; i < num; i++)
			{
				SmoothLoader.add(delegate
				{
					AssetManager.tiles.setListTo(DepthGeneratorType.Gameplay);
					spawnVegetation(vegSpread);
				}, "Add Vegetation (" + (i + 1) + "/" + num + ")");
			}
		}
		if (gen_values.add_resources)
		{
			SmoothLoader.add(delegate
			{
				spawnResources();
			}, "Add Resources");
		}
	}

	private static void scheduleUpdateTileTypes()
	{
		int num = 4;
		int num2 = World.world.tiles_list.Length / num;
		int num3 = 0;
		for (int i = 0; i < num; i++)
		{
			int tileAmount = Mathf.Min(World.world.tiles_list.Length - num3, num2);
			int startIndex = num3;
			num3 += tileAmount;
			SmoothLoader.add(delegate
			{
				GeneratorTool.UpdateTileTypes(pGeneratorStage: true, startIndex, tileAmount);
			}, "Generate Tiles (" + num3 + "/" + World.world.tiles_list.Length + ")", pSkipFrame: true);
		}
	}

	private static void scheduleRandomShapes(bool pSubstract)
	{
		if (gen_values.random_shapes_amount == 0)
		{
			return;
		}
		SmoothLoader.add(delegate
		{
			GeneratorTool.Init();
		}, "Perlin Random Shapes (Init)");
		for (int i = 0; i < gen_values.random_shapes_amount; i++)
		{
			SmoothLoader.add(delegate
			{
				GeneratorTool.ApplyRandomShape("height", 2f, 0.7f, pSubstract);
			}, "Perlin Random Shapes (" + (i + 1) + "/" + gen_values.random_shapes_amount + ")");
		}
	}

	private static void specialCubicles()
	{
		HashSet<MapChunk> pChunksUsed = new HashSet<MapChunk>();
		List<MapChunk> list = new List<MapChunk>();
		MapChunk[] chunks = World.world.map_chunk_manager.chunks;
		foreach (MapChunk item in chunks)
		{
			list.Add(item);
		}
		_rooms.Clear();
		while (list.Count > 0)
		{
			MapChunk random = list.GetRandom();
			startCubicle(pChunksUsed, list, random);
		}
		createDoors();
	}

	private static void startCubicle(HashSet<MapChunk> pChunksUsed, List<MapChunk> pListLeft, MapChunk pStartRoomChunk)
	{
		MapChunk mapChunk = pStartRoomChunk;
		List<MapChunk> list = new List<MapChunk>();
		rememberChunk(mapChunk, pChunksUsed, pListLeft, list);
		int pMinInclusive = 2;
		int pMaxExclusive = gen_values.cubicle_size + 2;
		int num = Randy.randomInt(pMinInclusive, pMaxExclusive);
		for (int i = 0; i < num; i++)
		{
			if (mapChunk == null)
			{
				break;
			}
			mapChunk = mapChunk.chunk_right;
			if (mapChunk != null && !pChunksUsed.Contains(mapChunk))
			{
				rememberChunk(mapChunk, pChunksUsed, pListLeft, list);
			}
		}
		mapChunk = pStartRoomChunk;
		num = Randy.randomInt(pMinInclusive, pMaxExclusive);
		for (int j = 0; j < num; j++)
		{
			if (mapChunk == null)
			{
				break;
			}
			mapChunk = mapChunk.chunk_left;
			if (mapChunk != null && !pChunksUsed.Contains(mapChunk))
			{
				rememberChunk(mapChunk, pChunksUsed, pListLeft, list);
			}
		}
		List<MapChunk> list2 = new List<MapChunk>();
		list2.AddRange(list);
		List<MapChunk> list3 = new List<MapChunk>();
		list3.AddRange(list2);
		int num2 = Randy.randomInt(pMinInclusive, pMaxExclusive);
		for (int k = 0; k < num2; k++)
		{
			List<MapChunk> list4 = new List<MapChunk>();
			bool flag = true;
			foreach (MapChunk item in list3)
			{
				if (item.chunk_down == null)
				{
					flag = false;
					k = num2;
					break;
				}
				if (pChunksUsed.Contains(item.chunk_down))
				{
					flag = false;
					k = num2;
					break;
				}
				list4.Add(item);
			}
			if (!flag)
			{
				continue;
			}
			list3.Clear();
			foreach (MapChunk item2 in list4)
			{
				rememberChunk(item2.chunk_down, pChunksUsed, pListLeft, list);
				list3.Add(item2.chunk_down);
			}
		}
		list3.Clear();
		list3.AddRange(list2);
		num2 = Randy.randomInt(pMinInclusive, pMaxExclusive);
		for (int l = 0; l < num2; l++)
		{
			List<MapChunk> list5 = new List<MapChunk>();
			bool flag2 = true;
			foreach (MapChunk item3 in list3)
			{
				if (item3.chunk_up == null)
				{
					flag2 = false;
					l = num2;
					break;
				}
				if (pChunksUsed.Contains(item3.chunk_up))
				{
					flag2 = false;
					l = num2;
					break;
				}
				list5.Add(item3);
			}
			if (!flag2)
			{
				continue;
			}
			list3.Clear();
			foreach (MapChunk item4 in list5)
			{
				rememberChunk(item4.chunk_up, pChunksUsed, pListLeft, list);
				list3.Add(item4.chunk_up);
			}
		}
		finishRoom(list);
	}

	private static void rememberChunk(MapChunk pChunk, HashSet<MapChunk> pChunksUsed, List<MapChunk> pListLeft, List<MapChunk> pNewRoom)
	{
		pChunksUsed.Add(pChunk);
		pListLeft.Remove(pChunk);
		pNewRoom.Add(pChunk);
	}

	private static void finishRoom(List<MapChunk> pChunks)
	{
		BiomeAsset random = BiomeLibrary.pool_biomes.GetRandom();
		TileType pNewTypeMain = TileLibrary.soil_high;
		if (Randy.randomBool())
		{
			pNewTypeMain = TileLibrary.soil_low;
		}
		WorldTile tileSimple = World.world.GetTileSimple(0, 0);
		WorldTile tileSimple2 = World.world.GetTileSimple(MapBox.width - 1, 0);
		WorldTile tileSimple3 = World.world.GetTileSimple(0, MapBox.height - 1);
		WorldTile tileSimple4 = World.world.GetTileSimple(MapBox.width - 1, MapBox.height - 1);
		WorldTile worldTile = null;
		WorldTile worldTile2 = null;
		WorldTile worldTile3 = null;
		WorldTile worldTile4 = null;
		float num = 0f;
		float num2 = 0f;
		float num3 = 0f;
		float num4 = 0f;
		for (int i = 0; i < pChunks.Count; i++)
		{
			WorldTile[] tiles = pChunks[i].tiles;
			int num5 = tiles.Length;
			for (int j = 0; j < num5; j++)
			{
				WorldTile worldTile5 = tiles[j];
				MapAction.terraformTile(worldTile5, pNewTypeMain, null);
				if (gen_values.random_biomes)
				{
					DropsLibrary.useSeedOn(worldTile5, random.getTileLow(), random.getTileHigh());
				}
				float num6 = Toolbox.DistTile(tileSimple, worldTile5);
				float num7 = Toolbox.DistTile(tileSimple2, worldTile5);
				float num8 = Toolbox.DistTile(tileSimple3, worldTile5);
				float num9 = Toolbox.DistTile(tileSimple4, worldTile5);
				if (worldTile == null || num6 < num)
				{
					worldTile = worldTile5;
					num = num6;
				}
				if (worldTile2 == null || num7 < num2)
				{
					worldTile2 = worldTile5;
					num2 = num7;
				}
				if (worldTile3 == null || num8 < num3)
				{
					worldTile3 = worldTile5;
					num3 = num8;
				}
				if (worldTile4 == null || num9 < num4)
				{
					worldTile4 = worldTile5;
					num4 = num9;
				}
			}
		}
		GeneratedRoom generatedRoom = new GeneratedRoom();
		generatedRoom.id_debug = _rooms.Count;
		_rooms.Add(generatedRoom);
		generatedRoom.edges_up = fillTiles(worldTile, worldTile2, TileLibrary.mountains);
		generatedRoom.edges_down = fillTiles(worldTile3, worldTile4, TileLibrary.mountains);
		generatedRoom.edges_left = fillTiles(worldTile, worldTile3, TileLibrary.mountains);
		generatedRoom.edges_right = fillTiles(worldTile4, worldTile2, TileLibrary.mountains);
	}

	private static void createDoors()
	{
		foreach (GeneratedRoom room in _rooms)
		{
			makeDoor(room.edges_down);
			makeDoor(room.edges_left);
			makeDoor(room.edges_right);
			makeDoor(room.edges_up);
		}
	}

	private static void makeDoor(List<WorldTile> pTiles)
	{
		foreach (WorldTile pTile in pTiles)
		{
			if (pTile.main_type != TileLibrary.mountains)
			{
				return;
			}
		}
		WorldTile worldTile;
		if (pTiles.Count > 3)
		{
			int index = Randy.randomInt(3, pTiles.Count - 3);
			worldTile = pTiles[index];
		}
		else
		{
			int index2 = pTiles.Count / 2;
			worldTile = pTiles[index2];
		}
		MapAction.terraformTile(worldTile, TileLibrary.hills, null);
		WorldTile[] neighboursAll = worldTile.neighboursAll;
		foreach (WorldTile worldTile2 in neighboursAll)
		{
			if (worldTile2.main_type == TileLibrary.mountains)
			{
				MapAction.terraformTile(worldTile2, TileLibrary.hills, null);
			}
		}
	}

	private static void specialCheckerBoard()
	{
		BiomeAsset random = BiomeLibrary.pool_biomes.GetRandom();
		BiomeAsset random2 = BiomeLibrary.pool_biomes.GetRandom();
		MapChunk[] chunks = World.world.map_chunk_manager.chunks;
		foreach (MapChunk mapChunk in chunks)
		{
			WorldTile[] tiles = mapChunk.tiles;
			if ((mapChunk.x + mapChunk.y) % 2 == 0)
			{
				int num = tiles.Length;
				for (int j = 0; j < num; j++)
				{
					WorldTile pTile = tiles[j];
					MapAction.terraformTile(pTile, TileLibrary.soil_high, null);
					if (gen_values.random_biomes)
					{
						DropsLibrary.useSeedOn(pTile, random.getTileLow(), random.getTileHigh());
					}
				}
				continue;
			}
			int num2 = tiles.Length;
			for (int k = 0; k < num2; k++)
			{
				WorldTile pTile2 = tiles[k];
				MapAction.terraformTile(pTile2, TileLibrary.soil_low, null);
				if (gen_values.random_biomes)
				{
					DropsLibrary.useSeedOn(pTile2, random2.getTileLow(), random2.getTileHigh());
				}
			}
		}
	}

	private static void specialAnthill()
	{
		WorldTile[] tiles_list = World.world.tiles_list;
		for (int i = 0; i < tiles_list.Length; i++)
		{
			MapAction.terraformTile(tiles_list[i], TileLibrary.mountains, null);
		}
		List<TileZone> list = new List<TileZone>();
		List<WorldTile> list2 = new List<WorldTile>();
		ZoneCalculator zone_calculator = World.world.zone_calculator;
		int num = zone_calculator.zones_total_x / 10 + 1;
		int num2 = zone_calculator.zones_total_y / 10 + 1;
		TileZone tileZone = zone_calculator.map[num, num2];
		TileZone tileZone2 = zone_calculator.map[zone_calculator.zones_total_x - num, num2];
		TileZone tileZone3 = zone_calculator.map[zone_calculator.zones_total_x - num, zone_calculator.zones_total_y - num2];
		TileZone tileZone4 = zone_calculator.map[num, zone_calculator.zones_total_y - num2];
		makeJailRoom(list, zone_calculator.map[zone_calculator.zones_total_x / 2, zone_calculator.zones_total_y / 2]);
		makeJailRoom(list, zone_calculator.map[zone_calculator.zones_total_x / 2, zone_calculator.zones_total_y / 2]);
		makeJailRoom(list, tileZone);
		makeJailRoom(list, tileZone);
		makeJailRoom(list, tileZone2);
		makeJailRoom(list, tileZone2);
		makeJailRoom(list, tileZone3);
		makeJailRoom(list, tileZone3);
		makeJailRoom(list, tileZone4);
		makeJailRoom(list, tileZone4);
		makeWay(tileZone, tileZone2, list2);
		makeWay(tileZone4, tileZone3, list2);
		makeWay(tileZone, tileZone4, list2);
		makeWay(tileZone3, tileZone2, list2);
		makeWay(tileZone3, tileZone, list2);
		foreach (TileZone item in list)
		{
			carveZone(item);
		}
		foreach (WorldTile item2 in list2)
		{
			carveTunnel(item2);
		}
	}

	private static List<WorldTile> fillTiles(WorldTile pTile1, WorldTile pTile2, TileType pType)
	{
		List<WorldTile> list = PathfinderTools.raycast(pTile1, pTile2, 1f);
		List<WorldTile> list2 = new List<WorldTile>(list);
		list.Clear();
		foreach (WorldTile item in list2)
		{
			MapAction.terraformTile(item, pType, null);
		}
		return list2;
	}

	private static void makeWay(TileZone tZone1, TileZone tZone2, List<WorldTile> pTunnels)
	{
		List<WorldTile> list = PathfinderTools.raycast(tZone1.centerTile, tZone2.centerTile);
		foreach (WorldTile item in list)
		{
			WorldTile[] neighboursAll = item.neighboursAll;
			foreach (WorldTile worldTile in neighboursAll)
			{
				MapAction.terraformTile(worldTile, TileLibrary.soil_high, null);
				pTunnels.Add(worldTile);
			}
		}
		list.Clear();
	}

	private static void carveTunnel(WorldTile pTile)
	{
		for (int i = 0; i < 10; i++)
		{
			WorldTile worldTile = pTile.neighbours.GetRandom();
			for (int num = 10; num > 0; num--)
			{
				WorldTile random = worldTile.neighbours.GetRandom();
				if (random.Type.rocks)
				{
					MapAction.terraformTile(worldTile, TileLibrary.soil_high, null);
					worldTile = random;
				}
			}
		}
	}

	private static void carveZone(TileZone pZone)
	{
		for (int i = 0; i < 20; i++)
		{
			WorldTile worldTile = pZone.tiles.GetRandom();
			for (int num = 15; num > 0; num--)
			{
				WorldTile random = worldTile.neighbours.GetRandom();
				if (random.Type.rocks)
				{
					MapAction.terraformTile(worldTile, TileLibrary.soil_high, null);
					worldTile = random;
				}
			}
		}
	}

	private static void makeJailRoom(List<TileZone> pZones, TileZone pStartZone)
	{
		int num = World.world.zone_calculator.zones.Count / 10;
		TileZone tileZone = pStartZone;
		if (tileZone.world_edge)
		{
			return;
		}
		for (int i = 0; i < num; i++)
		{
			if (tileZone.world_edge)
			{
				tileZone = tileZone.neighbours.GetRandom();
				continue;
			}
			WorldTile[] tiles = tileZone.tiles;
			int num2 = tiles.Length;
			for (int j = 0; j < num2; j++)
			{
				MapAction.terraformTile(tiles[j], TileLibrary.soil_high, null);
			}
			pZones.Add(tileZone);
			tileZone = tileZone.neighbours.GetRandom();
		}
	}

	private static void schedulePerlinNoiseMap()
	{
		scheduleRandomShapes(pSubstract: true);
		if (gen_values.main_perlin_noise_stage && gen_values.perlin_scale_stage_1 > 0)
		{
			SmoothLoader.add(delegate
			{
				int num7 = Randy.randomInt(0, 1000000);
				int num8 = Randy.randomInt(0, 1000000);
				GeneratorTool.ApplyPerlinNoise(_tilesMap, _width, _height, num7, num8, 1f, 1f * (float)gen_values.perlin_scale_stage_1);
			}, "Perlin Noise", pSkipFrame: true);
		}
		if (template.force_height_to > 0)
		{
			SmoothLoader.add(delegate
			{
				forceHeight();
			}, "Add Height");
		}
		if (gen_values.add_center_gradient_land)
		{
			SmoothLoader.add(delegate
			{
				addCenterGradient();
			}, "Center Gradient");
		}
		if (gen_values.center_gradient_mountains)
		{
			SmoothLoader.add(delegate
			{
				addCenterMountains();
			}, "Center Mountains");
		}
		if (gen_values.add_center_lake)
		{
			SmoothLoader.add(delegate
			{
				addCenterLake();
			}, "Center Lake");
		}
		if (gen_values.perlin_noise_stage_2 && gen_values.perlin_scale_stage_2 > 0)
		{
			SmoothLoader.add(delegate
			{
				float num4 = gen_values.perlin_scale_stage_2;
				int num5 = Randy.randomInt(0, 1000000);
				int num6 = Randy.randomInt(0, 1000000);
				GeneratorTool.ApplyPerlinNoise(_tilesMap, _width, _height, num5, num6, 0.2f, 4f * num4, pSubtract: true);
			}, "Perlin Noise (1)");
		}
		if (gen_values.perlin_noise_stage_3 && gen_values.perlin_scale_stage_3 > 0)
		{
			SmoothLoader.add(delegate
			{
				float num = gen_values.perlin_scale_stage_3;
				int num2 = Randy.randomInt(0, 1000000);
				int num3 = Randy.randomInt(0, 1000000);
				GeneratorTool.ApplyPerlinNoise(_tilesMap, _width, _height, num2, num3, 0.1f, num * 10f, pSubtract: true);
			}, "Perlin Noise (2)");
		}
		if (gen_values.low_ground)
		{
			SmoothLoader.add(delegate
			{
				lowGround();
			}, "Lower Ground");
		}
		if (gen_values.high_ground)
		{
			SmoothLoader.add(delegate
			{
				highGround();
			}, "High Ground");
		}
		scheduleRandomShapes(pSubstract: true);
		if (gen_values.ring_effect)
		{
			SmoothLoader.add(delegate
			{
				GeneratorTool.ApplyRingEffect();
			}, "Perlin Ring", pSkipFrame: true);
		}
		if (gen_values.gradient_round_edges)
		{
			SmoothLoader.add(delegate
			{
				MapEdges.AddEdgeGradientCircle(World.world.tiles_map, "height");
			}, "Gradient Circle Edges", pSkipFrame: true);
		}
		if (gen_values.square_edges)
		{
			SmoothLoader.add(delegate
			{
				MapEdges.AddEdgeSquare(World.world.tiles_map, "height");
			}, "Gradient Circle Edges", pSkipFrame: true);
		}
	}

	private static void forceHeight()
	{
		WorldTile[] tiles_list = World.world.tiles_list;
		for (int i = 0; i < tiles_list.Length; i++)
		{
			tiles_list[i].Height = template.force_height_to;
		}
	}

	private static void removeMountains()
	{
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			if (worldTile.Type.rocks)
			{
				MapAction.decreaseTile(worldTile, pDamage: false);
			}
			if (worldTile.Type.rocks)
			{
				MapAction.decreaseTile(worldTile, pDamage: false);
			}
		}
	}

	private static void lowGround()
	{
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			if (worldTile.Height > 150)
			{
				worldTile.Height -= 50;
			}
			if (worldTile.Height > 130)
			{
				worldTile.Height -= 20;
			}
		}
	}

	private static void highGround()
	{
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			if (worldTile.Height < 20)
			{
				worldTile.Height += 80;
			}
			else if (worldTile.Height < 120)
			{
				worldTile.Height += 40;
			}
		}
	}

	private static void addCenterGradient()
	{
		WorldTile pT = World.world.tiles_map[MapBox.width / 2, MapBox.height / 2];
		float num = 0.9f;
		float num2 = 0.6f;
		float num3 = (float)(MapBox.width / 2) * num;
		float num4 = (float)(MapBox.width / 2) * num2;
		float num5 = num3 - num4;
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			float num6 = Toolbox.DistTile(worldTile, pT);
			if (!(num6 > num3))
			{
				float num7 = (num3 - num6) / num5;
				int num8 = (int)(45f * num7);
				worldTile.Height += num8;
			}
		}
	}

	private static void addCenterLake()
	{
		WorldTile pT = World.world.tiles_map[MapBox.width / 2, MapBox.height / 2];
		float num = 0.6f;
		float num2 = 0.2f;
		float num3 = (float)(MapBox.width / 2) * num;
		float num4 = (float)(MapBox.width / 2) * num2;
		float num5 = num3 - num4;
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile worldTile in tiles_list)
		{
			float num6 = Toolbox.DistTile(worldTile, pT);
			if (!(num6 > num3))
			{
				float num7 = num3 - num6;
				float num8 = 1f - num7 / num5;
				int height = (int)((float)worldTile.Height * num8);
				worldTile.Height = height;
			}
		}
	}

	private static void addCenterMountains()
	{
		WorldTile pT = World.world.tiles_map[MapBox.width / 2, MapBox.height / 2];
		float num = 0.3f;
		float num2 = 0f;
		float num3 = (float)(MapBox.width / 2) * num;
		float num4 = (float)(MapBox.width / 2) * num2;
		float num5 = num3 - num4;
		WorldTile[] tiles_list = World.world.tiles_list;
		foreach (WorldTile obj in tiles_list)
		{
			float num6 = Toolbox.DistTile(obj, pT);
			float num7 = (num3 - num6) / num5;
			int num8 = (int)(75f * num7);
			obj.Height -= num8;
		}
	}

	private static void generateBiomes()
	{
		HashSetWorldTile hashSetWorldTile = new HashSetWorldTile();
		for (int i = 0; i < World.world.tiles_list.Length; i++)
		{
			WorldTile worldTile = World.world.tiles_list[i];
			if (worldTile.Type.soil)
			{
				hashSetWorldTile.Add(worldTile);
			}
		}
		using ListPool<WorldTile> listPool = new ListPool<WorldTile>(hashSetWorldTile.Count);
		bool flag = true;
		while (hashSetWorldTile.Count > 0)
		{
			if (flag)
			{
				flag = false;
				recreateSoilList(hashSetWorldTile, listPool);
			}
			WorldTile pStartTile = listPool.Last();
			BiomeAsset random = BiomeLibrary.pool_biomes.GetRandom();
			int num = tryMakeBiomeSteps(pStartTile, random);
			if (num == 0)
			{
				listPool.Pop();
				continue;
			}
			tryMakeBiome(pStartTile, hashSetWorldTile, num, random);
			flag = true;
		}
	}

	private static void recreateSoilList(HashSetWorldTile pHashSet, ListPool<WorldTile> pTempSoilTiles)
	{
		pTempSoilTiles.Clear();
		pTempSoilTiles.AddRange(pHashSet);
		pTempSoilTiles.Shuffle();
	}

	private static int tryMakeBiomeSteps(WorldTile pStartTile, BiomeAsset pBiome)
	{
		if (!reported_tryMakeBiomeSteps)
		{
			if (pBiome == null)
			{
				Debug.Log((object)"pBiome is null");
				reported_tryMakeBiomeSteps = true;
			}
			if (pStartTile == null)
			{
				Debug.Log((object)"pStartTile is null");
				reported_tryMakeBiomeSteps = true;
			}
			if (pStartTile.region == null)
			{
				Debug.Log((object)"pStartTile.region is null");
				reported_tryMakeBiomeSteps = true;
			}
			if (pStartTile.region.island == null)
			{
				Debug.Log((object)"pStartTile.region.island is null");
				reported_tryMakeBiomeSteps = true;
			}
		}
		int tileCount = pStartTile.region.island.getTileCount();
		int num = ((tileCount < 400) ? tileCount : ((tileCount >= 600) ? (tileCount / 3) : (tileCount / 2)));
		if (num > pBiome.generator_max_size && pBiome.generator_max_size != 0)
		{
			num = pBiome.generator_max_size;
		}
		return num;
	}

	private static void tryMakeBiome(WorldTile pStartTile, HashSetWorldTile pSoilTiles, int pMaxSteps, BiomeAsset pBiome)
	{
		int num = 0;
		using ListPool<WorldTile> listPool = new ListPool<WorldTile>(pMaxSteps);
		HashSetWorldTile hashSetWorldTile = new HashSetWorldTile();
		listPool.Add(pStartTile);
		hashSetWorldTile.Add(pStartTile);
		while (listPool.Count > 0 && num < pMaxSteps)
		{
			listPool.ShuffleLast();
			WorldTile worldTile = listPool.Pop();
			if (worldTile.isTileRank(TileRank.Low))
			{
				worldTile.setTopTileType(pBiome.getTileLow());
			}
			else
			{
				worldTile.setTopTileType(pBiome.getTileHigh());
			}
			pSoilTiles.Remove(worldTile);
			num++;
			for (int i = 0; i < worldTile.neighboursAll.Length; i++)
			{
				WorldTile worldTile2 = worldTile.neighboursAll[i];
				if (!hashSetWorldTile.Contains(worldTile2) && worldTile2.Type.soil)
				{
					listPool.Add(worldTile2);
					hashSetWorldTile.Add(worldTile2);
				}
			}
		}
		if (num <= 10)
		{
			removeSmallBiomePatches(hashSetWorldTile, pStartTile);
		}
	}

	private static void removeSmallBiomePatches(HashSetWorldTile pTiles, WorldTile pStartTile)
	{
		WorldTile worldTile = null;
		WorldTile[] neighboursAll = pStartTile.neighboursAll;
		foreach (WorldTile worldTile2 in neighboursAll)
		{
			if (worldTile2.Type.is_biome && !worldTile2.Type.biome_asset.special_biome && worldTile2.Type.biome_asset != pStartTile.Type.biome_asset)
			{
				worldTile = worldTile2;
				break;
			}
		}
		if (worldTile == null)
		{
			return;
		}
		BiomeAsset biome_asset = worldTile.top_type.biome_asset;
		foreach (WorldTile pTile in pTiles)
		{
			TopTileType tile = biome_asset.getTile(pTile);
			pTile.setTopTileType(tile);
		}
	}

	private static void addMountainEdges()
	{
		int num = 0;
		int num2 = 0;
		WorldTile tileSimple = World.world.GetTileSimple(num, num2);
		WorldTile tileSimple2 = World.world.GetTileSimple(MapBox.width - num - 1, num2);
		WorldTile tileSimple3 = World.world.GetTileSimple(MapBox.width - num - 1, MapBox.height - num2 - 1);
		WorldTile tileSimple4 = World.world.GetTileSimple(num, MapBox.height - num2 - 1);
		fillTiles(tileSimple, tileSimple2, TileLibrary.mountains);
		fillTiles(tileSimple4, tileSimple3, TileLibrary.mountains);
		fillTiles(tileSimple, tileSimple4, TileLibrary.mountains);
		fillTiles(tileSimple3, tileSimple2, TileLibrary.mountains);
	}

	private static void freezeMountainTops()
	{
		for (int i = 0; i < World.world.tiles_list.Length; i++)
		{
			WorldTile worldTile = World.world.tiles_list[i];
			if (worldTile.Type.IsType("mountains") && worldTile.Height > 220)
			{
				worldTile.freeze();
			}
		}
	}

	private static void spawnVegetation(int pAmount)
	{
		for (int i = 0; i < pAmount; i++)
		{
			WorldTile random = World.world.tiles_list.GetRandom();
			if (!random.Type.ground || random.zone.countBuildingsType(BuildingList.Trees) >= 3)
			{
				continue;
			}
			BiomeAsset biome_asset = random.Type.biome_asset;
			if (biome_asset != null && biome_asset.grow_vegetation_auto)
			{
				switch (Randy.randomInt(0, 3))
				{
				case 0:
					BuildingActions.tryGrowVegetationRandom(random, VegetationType.Plants, pOnStart: true);
					break;
				case 1:
					BuildingActions.tryGrowVegetationRandom(random, VegetationType.Trees, pOnStart: true);
					break;
				case 2:
					BuildingActions.tryGrowVegetationRandom(random, VegetationType.Bushes, pOnStart: true);
					break;
				}
			}
		}
	}

	private static void spawnResources()
	{
		BuildingActions.spawnResource(World.world.tiles_list.Length / 1000 / 2 / 2, "fruit_bush", pRandomSize: false);
	}
}
// --- End of File: MapGenerator.cs ---



// --- Start of File: MapGenSettingsAsset.cs ---
using System;

[Serializable]
public class MapGenSettingsAsset : Asset, ILocalizedAsset
{
	public bool is_switch;

	public int min_value;

	public int max_value;

	public MapGenSettingsDelegateBool allowed_check;

	public MapGenSettingsDelegate increase;

	public MapGenSettingsDelegate decrease;

	public MapGenSettingsDelegateSwitch action_switch;

	public MapGenSettingsDelegateGet action_get;

	public MapGenSettingsDelegateSet action_set;

	public string getLocaleID()
	{
		return id;
	}
}
// --- End of File: MapGenSettingsAsset.cs ---



// --- Start of File: MapGenSettingsDelegate.cs ---
public delegate void MapGenSettingsDelegate(MapGenSettingsAsset pAsset);
// --- End of File: MapGenSettingsDelegate.cs ---



// --- Start of File: MapGenSettingsDelegateBool.cs ---
public delegate bool MapGenSettingsDelegateBool(MapGenTemplate pAsset);
// --- End of File: MapGenSettingsDelegateBool.cs ---



// --- Start of File: MapGenSettingsDelegateGet.cs ---
public delegate int MapGenSettingsDelegateGet();
// --- End of File: MapGenSettingsDelegateGet.cs ---



// --- Start of File: MapGenSettingsDelegateSet.cs ---
public delegate void MapGenSettingsDelegateSet(int pValue);
// --- End of File: MapGenSettingsDelegateSet.cs ---



// --- Start of File: MapGenSettingsDelegateSwitch.cs ---
public delegate void MapGenSettingsDelegateSwitch(MapGenSettingsAsset pAsset);
// --- End of File: MapGenSettingsDelegateSwitch.cs ---



// --- Start of File: MapGenSettingsLibrary.cs ---
public class MapGenSettingsLibrary : AssetLibrary<MapGenSettingsAsset>
{
	private MapGenValues gen_values => AssetManager.map_gen_templates.get(Config.current_map_template).values;

	public override void init()
	{
		base.init();
		add(new MapGenSettingsAsset
		{
			id = "gen_perlin_scale_stage_1",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_perlin_scale_stage_1,
			max_value = 30,
			action_get = () => gen_values.perlin_scale_stage_1,
			action_set = delegate(int pValue)
			{
				gen_values.perlin_scale_stage_1 = pValue;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_perlin_scale_stage_2",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_perlin_scale_stage_1,
			max_value = 30,
			action_get = () => gen_values.perlin_scale_stage_2,
			action_set = delegate(int pValue)
			{
				gen_values.perlin_scale_stage_2 = pValue;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_perlin_scale_stage_3",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_perlin_scale_stage_1,
			max_value = 30,
			action_get = () => gen_values.perlin_scale_stage_3,
			action_set = delegate(int pValue)
			{
				gen_values.perlin_scale_stage_3 = pValue;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_random_shapes",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_shapes,
			max_value = 40,
			action_get = () => gen_values.random_shapes_amount,
			action_set = delegate(int pValue)
			{
				gen_values.random_shapes_amount = pValue;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_cubicles_sizes",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_cubicles,
			min_value = 2,
			max_value = 15,
			action_get = () => gen_values.cubicle_size,
			action_set = delegate(int pValue)
			{
				gen_values.cubicle_size = pValue;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_random_biomes",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_biomes,
			is_switch = true,
			action_get = () => gen_values.random_biomes ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.random_biomes = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_mountain_edges",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_mountain_edges,
			is_switch = true,
			action_get = () => gen_values.add_mountain_edges ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.add_mountain_edges = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_add_vegetation",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_vegetation,
			is_switch = true,
			action_get = () => gen_values.add_vegetation ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.add_vegetation = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_add_resources",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_resources,
			is_switch = true,
			action_get = () => gen_values.add_resources ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.add_resources = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_add_center_lake",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_center_lake,
			is_switch = true,
			action_get = () => gen_values.add_center_lake ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.add_center_lake = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_add_center_land",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_center_land,
			is_switch = true,
			action_get = () => gen_values.add_center_gradient_land ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.add_center_gradient_land = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_round_edges",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_round_edges,
			is_switch = true,
			action_get = () => gen_values.gradient_round_edges ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.gradient_round_edges = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_square_edges",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_square_edges,
			is_switch = true,
			action_get = () => gen_values.square_edges ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.square_edges = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_ring_effect",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_ring_effect,
			is_switch = true,
			action_get = () => gen_values.ring_effect ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.ring_effect = pValue == 1;
			}
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_low_ground",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_low_ground,
			is_switch = true,
			action_set = delegate(int pValue)
			{
				gen_values.low_ground = pValue == 1;
			},
			action_get = () => gen_values.low_ground ? 1 : 0
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_high_ground",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_high_ground,
			is_switch = true,
			action_set = delegate(int pValue)
			{
				gen_values.high_ground = pValue == 1;
			},
			action_get = () => gen_values.high_ground ? 1 : 0
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_remove_mountains",
			allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_remove_mountains,
			is_switch = true,
			action_set = delegate(int pValue)
			{
				gen_values.remove_mountains = pValue == 1;
			},
			action_get = () => gen_values.remove_mountains ? 1 : 0
		});
		add(new MapGenSettingsAsset
		{
			id = "gen_forbidden_knowledge",
			allowed_check = (MapGenTemplate _) => Config.hasPremium && AchievementLibrary.cursed_world.isUnlocked(),
			is_switch = true,
			action_get = () => gen_values.forbidden_knowledge_start ? 1 : 0,
			action_set = delegate(int pValue)
			{
				gen_values.forbidden_knowledge_start = pValue == 1;
			}
		});
	}

	public override MapGenSettingsAsset add(MapGenSettingsAsset pAsset)
	{
		pAsset.increase = delegate(MapGenSettingsAsset pAsset)
		{
			int num3 = pAsset.action_get();
			int num4 = 1;
			if (HotkeyLibrary.many_mod.isHolding())
			{
				num4 = 5;
			}
			num3 += num4;
			if (num3 > pAsset.max_value)
			{
				num3 = pAsset.min_value;
			}
			pAsset.action_set(num3);
		};
		pAsset.decrease = delegate(MapGenSettingsAsset pAsset)
		{
			int num = pAsset.action_get();
			int num2 = 1;
			if (HotkeyLibrary.many_mod.isHolding())
			{
				num2 = 5;
			}
			num -= num2;
			if (num < pAsset.min_value)
			{
				num = pAsset.max_value;
			}
			pAsset.action_set(num);
		};
		pAsset.action_switch = delegate(MapGenSettingsAsset pAsset)
		{
			int pValue = ((pAsset.action_get() == 0) ? 1 : 0);
			pAsset.action_set(pValue);
		};
		return base.add(pAsset);
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (MapGenSettingsAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
		}
	}
}
// --- End of File: MapGenSettingsLibrary.cs ---



// --- Start of File: MapGenTemplate.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class MapGenTemplate : Asset, IDescriptionAsset, ILocalizedAsset
{
	public MapGenValues values = new MapGenValues();

	public int force_height_to;

	public bool freeze_mountains;

	public bool special_anthill;

	public bool special_checkerboard;

	public bool special_cubicles;

	public List<PerlinReplaceContainer> perlin_replace = new List<PerlinReplaceContainer>();

	public string path_icon = "ui/template_icon_1";

	public bool allow_edit_size = true;

	public bool allow_edit_random_shapes = true;

	public bool allow_edit_random_biomes = true;

	public bool allow_edit_perlin_scale_stage_1 = true;

	public bool allow_edit_perlin_scale_stage_2 = true;

	public bool allow_edit_perlin_scale_stage_3 = true;

	public bool allow_edit_mountain_edges = true;

	public bool allow_edit_random_vegetation = true;

	public bool allow_edit_random_resources = true;

	public bool allow_edit_center_lake = true;

	public bool allow_edit_round_edges = true;

	public bool allow_edit_square_edges = true;

	public bool allow_edit_ring_effect = true;

	public bool allow_edit_center_land = true;

	public bool allow_edit_low_ground = true;

	public bool allow_edit_high_ground = true;

	public bool allow_edit_remove_mountains = true;

	public bool allow_edit_cubicles;

	public bool show_reset_button = true;

	public string getLocaleID()
	{
		return "template_" + id;
	}

	public string getDescriptionID()
	{
		return "template_" + id + "_info";
	}
}
// --- End of File: MapGenTemplate.cs ---



// --- Start of File: MapGenTemplateLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public class MapGenTemplateLibrary : AssetLibrary<MapGenTemplate>
{
	private Dictionary<string, MapGenValues> default_values = new Dictionary<string, MapGenValues>();

	public override void init()
	{
		base.init();
		add(new MapGenTemplate
		{
			id = "continent",
			freeze_mountains = true,
			path_icon = "ui/new_world_templates_icons/template_continent"
		});
		t.values.main_perlin_noise_stage = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.perlin_noise_stage_3 = true;
		t.values.gradient_round_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.ring_effect = true;
		t.values.random_shapes_amount = 5;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "box_world",
			freeze_mountains = true,
			path_icon = "ui/new_world_templates_icons/template_box_world"
		});
		t.values.main_perlin_noise_stage = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.perlin_noise_stage_3 = true;
		t.values.add_mountain_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.ring_effect = true;
		t.values.random_shapes_amount = 5;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "islands",
			freeze_mountains = true,
			path_icon = "ui/new_world_templates_icons/template_islands"
		});
		t.values.main_perlin_noise_stage = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.perlin_noise_stage_3 = true;
		t.values.gradient_round_edges = true;
		t.values.ring_effect = true;
		t.values.random_shapes_amount = 5;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "toast",
			path_icon = "ui/new_world_templates_icons/template_toast"
		});
		t.values.square_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.main_perlin_noise_stage = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.perlin_noise_stage_3 = true;
		t.values.remove_mountains = true;
		t.values.random_shapes_amount = 5;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "pancake",
			path_icon = "ui/new_world_templates_icons/template_pancake"
		});
		t.values.gradient_round_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.main_perlin_noise_stage = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.perlin_noise_stage_3 = true;
		t.values.remove_mountains = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "boring_plains",
			path_icon = "ui/new_world_templates_icons/template_boring_plains"
		});
		t.values.add_center_gradient_land = true;
		t.values.main_perlin_noise_stage = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.perlin_noise_stage_3 = true;
		t.values.add_mountain_edges = true;
		t.values.remove_mountains = true;
		t.allow_edit_low_ground = false;
		t.allow_edit_high_ground = false;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		addReplaceOption(0, "shallow_waters", "soil_low");
		addReplaceOption(0, "close_ocean", "soil_low");
		addReplaceOption(0, "deep_ocean", "soil_high");
		add(new MapGenTemplate
		{
			id = "checkerboard",
			special_checkerboard = true,
			path_icon = "ui/new_world_templates_icons/template_checkerboard"
		});
		t.values.random_biomes = true;
		t.values.add_mountain_edges = true;
		t.values.remove_mountains = true;
		disableNormalSettings(t);
		t.allow_edit_random_biomes = true;
		t.allow_edit_random_resources = true;
		t.allow_edit_random_vegetation = true;
		add(new MapGenTemplate
		{
			id = "cubicles",
			special_cubicles = true,
			allow_edit_cubicles = true,
			path_icon = "ui/new_world_templates_icons/template_cubicles"
		});
		t.values.random_biomes = true;
		t.values.add_mountain_edges = true;
		t.values.remove_mountains = true;
		t.values.cubicle_size = 2;
		disableNormalSettings(t);
		t.allow_edit_cubicles = true;
		t.allow_edit_random_biomes = true;
		t.allow_edit_random_resources = true;
		t.allow_edit_random_vegetation = true;
		add(new MapGenTemplate
		{
			id = "dormant_volcano",
			force_height_to = 125,
			path_icon = "ui/new_world_templates_icons/template_dormant_volcano"
		});
		t.values.perlin_noise_stage_2 = true;
		t.values.random_biomes = false;
		t.values.gradient_round_edges = true;
		t.values.add_center_gradient_land = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "cheese",
			force_height_to = 120,
			path_icon = "ui/new_world_templates_icons/template_cheese"
		});
		t.values.square_edges = true;
		t.values.perlin_noise_stage_2 = true;
		t.values.remove_mountains = true;
		t.values.add_center_gradient_land = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "shallow_waters");
		addReplaceOption(170, "sand", "shallow_waters");
		addReplaceOption(150, "soil_high", "sand");
		addReplaceOption(130, "soil_low", "sand");
		addReplaceOption(80, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "bad_apple",
			path_icon = "ui/new_world_templates_icons/template_bad_apple"
		});
		t.values.gradient_round_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.center_gradient_mountains = true;
		t.values.main_perlin_noise_stage = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "donut",
			force_height_to = 125,
			path_icon = "ui/new_world_templates_icons/template_donut"
		});
		t.values.gradient_round_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.add_center_lake = true;
		t.values.perlin_noise_stage_2 = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "lasagna",
			path_icon = "ui/new_world_templates_icons/template_lasagna"
		});
		t.values.square_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.main_perlin_noise_stage = true;
		t.values.random_shapes_amount = 5;
		t.values.low_ground = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "chaos_pearl",
			path_icon = "ui/new_world_templates_icons/template_chaos_pearl"
		});
		t.values.gradient_round_edges = true;
		t.values.add_center_gradient_land = true;
		t.values.main_perlin_noise_stage = true;
		t.values.low_ground = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "anthill",
			special_anthill = true,
			path_icon = "ui/new_world_templates_icons/template_anthill"
		});
		disableNormalSettings(t);
		t.allow_edit_random_biomes = true;
		t.allow_edit_random_resources = true;
		t.allow_edit_random_vegetation = true;
		newReplaceContainer(15);
		addReplaceOption(170, "soil_high", "soil_low");
		add(new MapGenTemplate
		{
			id = "empty",
			show_reset_button = false,
			path_icon = "ui/new_world_templates_icons/template_empty"
		});
		disableNormalSettings(t);
		createDefaultBackupValues();
	}

	public void createDefaultBackupValues()
	{
		foreach (MapGenTemplate item in list)
		{
			MapGenValues value = JsonUtility.FromJson<MapGenValues>(JsonUtility.ToJson((object)item.values));
			default_values.Add(item.id, value);
		}
	}

	public void resetTemplateValues(MapGenTemplate pAsset)
	{
		MapGenValues values = JsonUtility.FromJson<MapGenValues>(JsonUtility.ToJson((object)default_values[pAsset.id]));
		pAsset.values = values;
	}

	public void disableNormalSettings(MapGenTemplate pAsset)
	{
		pAsset.allow_edit_size = false;
		pAsset.allow_edit_random_shapes = false;
		pAsset.allow_edit_random_biomes = false;
		pAsset.allow_edit_perlin_scale_stage_1 = false;
		pAsset.allow_edit_perlin_scale_stage_2 = false;
		pAsset.allow_edit_perlin_scale_stage_3 = false;
		pAsset.allow_edit_mountain_edges = false;
		pAsset.allow_edit_random_vegetation = false;
		pAsset.allow_edit_random_resources = false;
		pAsset.allow_edit_center_lake = false;
		pAsset.allow_edit_round_edges = false;
		pAsset.allow_edit_square_edges = false;
		pAsset.allow_edit_ring_effect = false;
		pAsset.allow_edit_center_land = false;
		pAsset.allow_edit_low_ground = false;
		pAsset.allow_edit_high_ground = false;
		pAsset.allow_edit_remove_mountains = false;
	}

	private void newReplaceContainer(int pScale = 1)
	{
		t.perlin_replace.Add(new PerlinReplaceContainer
		{
			scale = pScale
		});
	}

	private void addReplaceOption(int pHeight, string pFrom, string pTo)
	{
		t.perlin_replace[t.perlin_replace.Count - 1].options.Add(new PerlinReplaceOption
		{
			replace_height_value = pHeight,
			from = pFrom,
			to = pTo
		});
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (MapGenTemplate item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
	}
}
// --- End of File: MapGenTemplateLibrary.cs ---



// --- Start of File: MapGenValues.cs ---
using System;

[Serializable]
public class MapGenValues
{
	public int perlin_scale_stage_1 = 5;

	public int perlin_scale_stage_2 = 5;

	public int perlin_scale_stage_3 = 5;

	public bool main_perlin_noise_stage;

	public bool perlin_noise_stage_2;

	public bool perlin_noise_stage_3;

	public bool square_edges;

	public bool gradient_round_edges;

	public bool add_center_gradient_land;

	public bool center_gradient_mountains;

	public bool add_center_lake;

	public bool ring_effect;

	public bool add_vegetation = true;

	public bool add_resources = true;

	public bool add_mountain_edges;

	public bool random_biomes = true;

	public int random_shapes_amount;

	public int cubicle_size;

	public bool remove_mountains;

	public bool forbidden_knowledge_start;

	public bool low_ground;

	public bool high_ground;
}
// --- End of File: MapGenValues.cs ---



// --- Start of File: MapId.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapId : MonoBehaviour
{
	public Button continueButton;

	public InputField mapIdText;

	public Text statusText;

	public static string mapId;

	public static Map map;

	public Sprite buttonOn;

	public Sprite buttonOff;

	public static string formattedMapId
	{
		get
		{
			if (!string.IsNullOrEmpty(mapId) && mapId.Length == 12)
			{
				return "WB-" + mapId.Substring(0, 4) + "-" + mapId.Substring(4, 4) + "-" + mapId.Substring(8, 4);
			}
			return mapId;
		}
	}
}
// --- End of File: MapId.cs ---



// --- Start of File: MapLayer.cs ---
using System.Collections.Generic;
using UnityEngine;

public class MapLayer : BaseMapObject
{
	public bool autoDisable;

	public bool autoDisableCheckPixels;

	public int textureID;

	protected float timer;

	protected Color colorValues;

	protected int colors_amount = 1;

	internal SpriteRenderer sprRnd;

	internal Texture2D texture;

	internal Color32[] pixels;

	internal HashSetWorldTile pixels_to_update;

	protected List<Color32> colors;

	internal HashSetWorldTile hashsetTiles;

	private int textureWidth;

	private int textureHeight;

	public bool rewriteSortingLayer = true;

	internal override void create()
	{
		base.create();
		pixels_to_update = new HashSetWorldTile();
		sprRnd = ((Component)this).gameObject.GetComponent<SpriteRenderer>();
		if (rewriteSortingLayer)
		{
			((Renderer)sprRnd).sortingLayerName = ((Renderer)((Component)World.world).GetComponent<SpriteRenderer>()).sortingLayerName;
		}
		colors = new List<Color32>();
		createColors();
	}

	protected virtual void checkAutoDisable()
	{
		if (!autoDisable)
		{
			return;
		}
		if (autoDisableCheckPixels)
		{
			if (pixels_to_update.Count > 0)
			{
				if (!((Renderer)sprRnd).enabled)
				{
					((Renderer)sprRnd).enabled = true;
				}
			}
			else if (((Renderer)sprRnd).enabled)
			{
				((Renderer)sprRnd).enabled = false;
			}
		}
		else if (hashsetTiles.Count > 0)
		{
			if (!((Renderer)sprRnd).enabled)
			{
				((Renderer)sprRnd).enabled = true;
			}
		}
		else if (((Renderer)sprRnd).enabled)
		{
			((Renderer)sprRnd).enabled = false;
		}
	}

	internal void createTextureNew()
	{
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f9: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)texture == (Object)null || MapBox.width != textureWidth || MapBox.height != ((Texture)texture).height)
		{
			if ((Object)(object)sprRnd.sprite != (Object)null && textureWidth != 0)
			{
				Texture2DStorage.addToStorage(sprRnd.sprite, textureWidth, textureHeight);
			}
			textureWidth = MapBox.width;
			textureHeight = MapBox.height;
			sprRnd.sprite = Texture2DStorage.getSprite(textureWidth, textureHeight);
			texture = sprRnd.sprite.texture;
			textureID = ((object)texture).GetHashCode();
			int num = ((Texture)texture).height * ((Texture)texture).width;
			Color32 val = Color32.op_Implicit(Color.clear);
			pixels = (Color32[])(object)new Color32[num];
			for (int i = 0; i < num; i++)
			{
				pixels[i] = val;
			}
			updatePixels();
		}
	}

	public bool contains(WorldTile pTile)
	{
		return pixels_to_update.Contains(pTile);
	}

	internal virtual void clear()
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		if (pixels != null)
		{
			pixels_to_update.Clear();
			Color32 val = Color32.op_Implicit(Color.clear);
			for (int i = 0; i < pixels.Length; i++)
			{
				pixels[i] = val;
			}
			updatePixels();
		}
	}

	public void setRendererEnabled(bool pBool)
	{
		((Renderer)sprRnd).enabled = pBool;
	}

	protected void createColors()
	{
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		for (int i = 0; i < colors_amount; i++)
		{
			float num = ((i <= 0) ? 0f : (1f / (float)colors_amount * (float)i));
			colors.Add(Color32.op_Implicit(new Color(colorValues.r, colorValues.g, colorValues.b, num * colorValues.a)));
		}
	}

	public override void update(float pElapsed)
	{
		checkAutoDisable();
	}

	public virtual void draw(float pElapsed)
	{
		if (((Renderer)sprRnd).enabled)
		{
			UpdateDirty(pElapsed);
		}
	}

	internal void updatePixels()
	{
		texture.SetPixels32(pixels);
		texture.Apply();
	}

	protected virtual void UpdateDirty(float pElapsed)
	{
	}
}
// --- End of File: MapLayer.cs ---



// --- Start of File: MapLoaderAction.cs ---
public delegate void MapLoaderAction();
// --- End of File: MapLoaderAction.cs ---



// --- Start of File: MapLoaderContainer.cs ---
internal class MapLoaderContainer
{
	public MapLoaderAction action;

	public string id;

	public bool debug_log = true;

	public float new_timer_value = 0.001f;

	public MapLoaderContainer(MapLoaderAction pAction, string pID, bool pDebugLog = true, float pNewWaitTimerValue = 0.001f)
	{
		action = pAction;
		id = pID;
		debug_log = pDebugLog;
		new_timer_value = pNewWaitTimerValue;
	}
}
// --- End of File: MapLoaderContainer.cs ---



// --- Start of File: MapMetaData.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using Newtonsoft.Json;

[Serializable]
public class MapMetaData
{
	[NonSerialized]
	public string temp_date_string = "";

	public int saveVersion;

	public int width;

	public int height;

	public MapStats mapStats;

	public int cities;

	public int units;

	public int population;

	public int structures;

	public int mobs;

	public int vegetation;

	public long deaths;

	public int kingdoms;

	public int buildings;

	public int equipment;

	public int books;

	public int wars;

	public int alliances;

	public int families;

	public int clans;

	public int cultures;

	public int religions;

	public int languages;

	public int subspecies;

	public int favorites;

	public int favorite_items;

	public bool cursed;

	[DefaultValue(false)]
	public bool modded;

	[DefaultValue(null)]
	public List<string> modsActive = new List<string>();

	public double timestamp;

	public void prepareForSave()
	{
		modded = Config.MODDED;
		if (modded)
		{
			modsActive = new List<string>(ModLoader.getModsLoaded());
		}
		timestamp = Epoch.Current();
	}

	public string toJson()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Expected O, but got Unknown
		return JsonConvert.SerializeObject((object)this, new JsonSerializerSettings
		{
			DefaultValueHandling = (DefaultValueHandling)3
		});
	}
}
// --- End of File: MapMetaData.cs ---



// --- Start of File: MapName.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapName : MonoBehaviour
{
	public Button continueButton;

	public InputField mapNameText;
}
// --- End of File: MapName.cs ---



// --- Start of File: MapObjectType.cs ---
public enum MapObjectType
{
	Actor,
	Building,
	All
}
// --- End of File: MapObjectType.cs ---



// --- Start of File: MapPreviewImage.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapPreviewImage : MonoBehaviour
{
	public bool premiumOnly = true;

	public Image premiumIcon;

	public Button button;

	public SlotButtonCallback slotData;

	public Map map;

	public Sprite defaultSprite;

	private ButtonAnimation buttonAnimation;
}
// --- End of File: MapPreviewImage.cs ---



// --- Start of File: MapRegion.cs ---
using System;
using System.Collections.Generic;

public class MapRegion : IEquatable<MapRegion>
{
	public int id;

	public bool used_by_path_lock;

	public int region_path_id = -1;

	public TileLayerType type;

	public readonly float created;

	private readonly List<WorldTile> _edge_tiles = new List<WorldTile>(4);

	public readonly HashSet<WorldTile> edge_tiles_set = new HashSet<WorldTile>();

	private readonly HashSet<MapRegion> _outside_edge_regions = new HashSet<MapRegion>();

	private readonly HashSet<TileIsland> _outside_islands = new HashSet<TileIsland>();

	public readonly List<WorldTile> tiles = new List<WorldTile>(256);

	private readonly List<RegionLink> _links = new List<RegionLink>(4);

	public TileIsland island;

	public bool is_island_checked;

	public bool is_checked_path;

	public int path_wave_id = -1;

	public bool region_path;

	public MapChunk chunk;

	public readonly HashSet<TileZone> zones = new HashSet<TileZone>();

	public bool center_region;

	public readonly List<MapRegion> neighbours = new List<MapRegion>(4);

	private readonly HashSet<MapRegion> _neighbours_hash = new HashSet<MapRegion>();

	public static float created_time_last;

	public List<WorldTile> debug_blink_edges_left;

	public List<WorldTile> debug_blink_edges_up;

	public List<WorldTile> debug_blink_edges_down;

	public List<WorldTile> debug_blink_edges_right;

	public MapRegion()
	{
		created = created_time_last;
	}

	public void reset()
	{
		_edge_tiles.Clear();
		edge_tiles_set.Clear();
		_outside_edge_regions.Clear();
		_outside_islands.Clear();
		tiles.Clear();
		zones.Clear();
		_links.Clear();
		island = null;
		is_island_checked = false;
		is_checked_path = false;
		path_wave_id = -1;
		region_path = false;
		chunk = null;
		center_region = false;
		neighbours.Clear();
		_neighbours_hash.Clear();
		debug_blink_edges_left?.Clear();
		debug_blink_edges_up?.Clear();
		debug_blink_edges_down?.Clear();
		debug_blink_edges_right?.Clear();
	}

	public void checkZones()
	{
		if (chunk.regions.Count == 1)
		{
			zones.UnionWith(chunk.zones);
			return;
		}
		List<WorldTile> list = tiles;
		int count = list.Count;
		for (int i = 0; i < count; i++)
		{
			zones.Add(list[i].zone);
		}
	}

	private void checkDebugLists()
	{
		if (DebugConfig.isOn(DebugOption.Connections) && debug_blink_edges_left == null)
		{
			debug_blink_edges_left = new List<WorldTile>();
			debug_blink_edges_up = new List<WorldTile>();
			debug_blink_edges_down = new List<WorldTile>();
			debug_blink_edges_right = new List<WorldTile>();
		}
	}

	internal int newConnection(List<WorldTile> pTiles, LinkDirection pDirection, LinkDirection pDirectionID)
	{
		return newHash(pTiles, pTiles.Count, pDirection, pDirectionID);
	}

	private void checkDebugEdges(List<WorldTile> pTiles, LinkDirection pDirection)
	{
		if (DebugConfig.isOn(DebugOption.Connections))
		{
			List<WorldTile> list = null;
			checkDebugLists();
			switch (pDirection)
			{
			case LinkDirection.Left:
				list = debug_blink_edges_left;
				break;
			case LinkDirection.Down:
				list = debug_blink_edges_down;
				break;
			case LinkDirection.Right:
				list = debug_blink_edges_right;
				break;
			case LinkDirection.Up:
				list = debug_blink_edges_up;
				break;
			}
			list?.AddRange(pTiles);
		}
	}

	private int newHash(List<WorldTile> pTiles, int pLen, LinkDirection pDirection, LinkDirection pDirectionID)
	{
		WorldTile worldTile = pTiles[0];
		int x = worldTile.x;
		int y = worldTile.y;
		int num = (int)(worldTile.Type.layer_type + 1) * 100000 + (x * 11 + y * 3) * 10000 + pLen * 1000 + x * 10 + y;
		if (pDirectionID == LinkDirection.LR)
		{
			num = -num;
		}
		return num;
	}

	public void clear()
	{
		for (int i = 0; i < _links.Count; i++)
		{
			RegionLinkHashes.remove(_links[i], this);
		}
		_links.Clear();
		region_path_id = -1;
	}

	public void addLink(RegionLink pLink)
	{
		_links.Add(pLink);
	}

	public void calculateNeighbours()
	{
		neighbours.Clear();
		_neighbours_hash.Clear();
		for (int i = 0; i < _links.Count; i++)
		{
			foreach (MapRegion region in _links[i].regions)
			{
				if (region != this)
				{
					_neighbours_hash.Add(region);
				}
			}
		}
		neighbours.AddRange(_neighbours_hash);
	}

	public bool hasNeighbour(MapRegion pRegion)
	{
		return _neighbours_hash.Contains(pRegion);
	}

	public void debugLinks(DebugTool pTool)
	{
		pTool.setText("- links:", _links.Count, 0f, pShowBar: false, 0L);
		List<RegionLink> list = new List<RegionLink>(_links);
		list.Sort(linkSortByID);
		for (int i = 0; i < list.Count; i++)
		{
			_ = list[i];
			pTool.setText("- hash " + i + ":", list[i].id, 0f, pShowBar: false, 0L);
		}
	}

	private int linkSortByID(RegionLink o1, RegionLink o2)
	{
		return o2.id.CompareTo(o1.id);
	}

	public void calculateCenterRegion()
	{
		center_region = true;
		if (chunk.regions.Count > 1)
		{
			center_region = false;
			return;
		}
		MapChunk[] neighbours_all = chunk.neighbours_all;
		for (int i = 0; i < neighbours_all.Length; i++)
		{
			List<MapRegion> regions = neighbours_all[i].regions;
			if (regions.Count > 1)
			{
				center_region = false;
				break;
			}
			if (regions[0].island != island)
			{
				center_region = false;
				break;
			}
		}
	}

	public void calculateTileEdges()
	{
		if (center_region)
		{
			return;
		}
		_edge_tiles.Clear();
		_outside_edge_regions.Clear();
		_outside_islands.Clear();
		foreach (WorldTile item in edge_tiles_set)
		{
			if (item.Type.layer_type != type)
			{
				_edge_tiles.Add(item);
				_outside_edge_regions.Add(item.region);
			}
		}
	}

	public WorldTile getRandomTile()
	{
		return tiles.GetRandom();
	}

	public bool isTypeGround()
	{
		return type == TileLayerType.Ground;
	}

	public List<WorldTile> getEdgeTiles()
	{
		return _edge_tiles;
	}

	public HashSet<MapRegion> getEdgeRegions()
	{
		return _outside_edge_regions;
	}

	public override int GetHashCode()
	{
		return id;
	}

	public override bool Equals(object obj)
	{
		return Equals(obj as MapRegion);
	}

	public bool Equals(MapRegion pObject)
	{
		return id == pObject.id;
	}
}
// --- End of File: MapRegion.cs ---



// --- Start of File: MapShowMeta.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapShowMeta : MonoBehaviour
{
	public WorldElement worldElementPrefab;

	public WorldElement element;

	public Transform transformContent;

	public GameObject loadingSpinner;

	public GameObject errorImage;

	public GameObject textStatusBG;

	public Text textStatusMessage;

	public GameObject playButton;

	public GameObject favButton;

	public Text playButtonText;

	public GameObject deleteButton;

	public GameObject reportButton;

	public GameObject bottomButtons;

	public Image iconFavorite;

	private bool startSpinning;

	private float angle;

	private void Update()
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		if (startSpinning)
		{
			angle -= Time.deltaTime * 180f;
			((Component)iconFavorite).transform.localEulerAngles = new Vector3(0f, 0f, angle);
		}
		else if (angle != 0f)
		{
			angle -= Time.deltaTime * 720f;
			if (angle < -360f)
			{
				angle = 0f;
			}
			((Component)iconFavorite).transform.localEulerAngles = new Vector3(0f, 0f, angle);
		}
	}

	public void pressFavorite()
	{
	}

	public void copyToClipboard()
	{
	}
}
// --- End of File: MapShowMeta.cs ---



// --- Start of File: MapSizeAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class MapSizeAsset : Asset, ILocalizedAsset
{
	public Sprite cached_sprite;

	public string path_icon;

	public bool show_warning;

	public int size = 1;

	public string getLocaleID()
	{
		return "map_size_" + id;
	}

	public Sprite getIconSprite()
	{
		if ((Object)(object)cached_sprite == (Object)null)
		{
			cached_sprite = SpriteTextureLoader.getSprite("ui/Icons/" + path_icon);
		}
		return cached_sprite;
	}
}
// --- End of File: MapSizeAsset.cs ---



// --- Start of File: MapSizeLibrary.cs ---
using Beebyte.Obfuscator;

[Skip]
public class MapSizeLibrary : AssetLibrary<MapSizeAsset>
{
	public const string tiny = "tiny";

	public const string small = "small";

	public const string standard = "standard";

	public const string large = "large";

	public const string huge = "huge";

	public const string gigantic = "gigantic";

	public const string titanic = "titanic";

	public const string iceberg = "iceberg";

	private static string[] _mapSizes;

	public static string[] getSizes()
	{
		return _mapSizes;
	}

	public override void init()
	{
		base.init();
		add(new MapSizeAsset
		{
			id = "tiny",
			size = 2,
			path_icon = "actor_traits/iconTiny"
		});
		add(new MapSizeAsset
		{
			id = "small",
			size = 3,
			path_icon = "iconAntBlack"
		});
		add(new MapSizeAsset
		{
			id = "standard",
			size = 4,
			path_icon = "iconTileSand"
		});
		add(new MapSizeAsset
		{
			id = "large",
			size = 5,
			path_icon = "iconTileSoil",
			show_warning = true
		});
		add(new MapSizeAsset
		{
			id = "huge",
			size = 6,
			path_icon = "iconTileHighSoil",
			show_warning = true
		});
		add(new MapSizeAsset
		{
			id = "gigantic",
			size = 7,
			path_icon = "iconTileMountains",
			show_warning = true
		});
		add(new MapSizeAsset
		{
			id = "titanic",
			size = 8,
			path_icon = "iconTitanic",
			show_warning = true
		});
		add(new MapSizeAsset
		{
			id = "iceberg",
			size = 9,
			path_icon = "iconIceberg",
			show_warning = true
		});
	}

	public override void linkAssets()
	{
		base.linkAssets();
		convertToOldFormat();
	}

	private void convertToOldFormat()
	{
		_mapSizes = new string[list.Count];
		for (int i = 0; i < _mapSizes.Length; i++)
		{
			_mapSizes[i] = list[i].id;
		}
	}

	public static int getSize(string pId)
	{
		return AssetManager.map_sizes.get(pId)?.size ?? 2;
	}

	public static MapSizeAsset getPresetAsset(int pMapSize)
	{
		foreach (MapSizeAsset item in AssetManager.map_sizes.list)
		{
			if (item.size == pMapSize)
			{
				return item;
			}
		}
		return null;
	}

	public static string getPreset(int pMapSize)
	{
		foreach (MapSizeAsset item in AssetManager.map_sizes.list)
		{
			if (item.size == pMapSize)
			{
				return item.id;
			}
		}
		return null;
	}

	public static bool isSizeValid(int pMapSize)
	{
		if (getPresetAsset(pMapSize) == null)
		{
			return false;
		}
		if (pMapSize > getSize(Config.maxMapSize))
		{
			return false;
		}
		return true;
	}

	public override void editorDiagnosticLocales()
	{
		foreach (MapSizeAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
		}
		base.editorDiagnosticLocales();
	}
}
// --- End of File: MapSizeLibrary.cs ---



// --- Start of File: MapSizeTextUpdater.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapSizeTextUpdater : MonoBehaviour
{
	public Text text_counter;

	private void Update()
	{
		updateVars();
	}

	private void updateVars()
	{
		Text component = ((Component)this).GetComponent<Text>();
		string text = LocalizedTextManager.getText(AssetManager.map_sizes.get(Config.customMapSize).getLocaleID());
		component.text = text.ToUpper();
		((Component)component).GetComponent<LocalizedText>().checkSpecialLanguages();
		string[] sizes = MapSizeLibrary.getSizes();
		int num = sizes.IndexOf(Config.customMapSize);
		text_counter.text = num + 1 + "/" + sizes.Length;
	}
}
// --- End of File: MapSizeTextUpdater.cs ---



// --- Start of File: MapStats.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Globalization;
using Newtonsoft.Json;
using UnityEngine;
using UnityEngine.Scripting;

[Serializable]
public class MapStats
{
	public string name = "WorldBox";

	public string description = "";

	public string player_name;

	public string player_mood;

	public SaveCustomData custom_data;

	[JsonProperty(/*Could not decode attribute arguments.*/)]
	public double world_time;

	public int history_current_year = -1;

	[JsonProperty(/*Could not decode attribute arguments.*/)]
	public string world_age_id;

	public int world_age_slot_index;

	public double world_age_started_at;

	public double same_world_age_started_at;

	public float current_world_ages_duration;

	public float current_age_progress;

	public bool is_world_ages_paused;

	[DefaultValue(1f)]
	public float world_ages_speed_multiplier = 1f;

	public string[] world_ages_slots;

	public long housesBuilt;

	public long housesDestroyed;

	public long population;

	public long creaturesBorn;

	public long creaturesCreated;

	public long subspeciesCreated;

	public long subspeciesExtinct;

	public long languagesCreated;

	public long languagesForgotten;

	public long booksWritten;

	public long booksRead;

	public long booksBurnt;

	public long culturesCreated;

	public long culturesForgotten;

	public long religionsCreated;

	public long religionsForgotten;

	public long kingdomsCreated;

	public long kingdomsDestroyed;

	public long citiesCreated;

	public long citiesConquered;

	public long citiesRebelled;

	public long citiesDestroyed;

	public long alliancesMade;

	public long alliancesDissolved;

	public long warsStarted;

	public long peacesMade;

	public long familiesCreated;

	public long armiesCreated;

	public long armiesDestroyed;

	public long familiesDestroyed;

	public long clansCreated;

	public long clansDestroyed;

	public long plotsStarted;

	public long plotsSucceeded;

	public long plotsForgotten;

	public double exploding_mushrooms_enabled_at;

	[DefaultValue(1L)]
	public long id_unit = 1L;

	[DefaultValue(1L)]
	public long id_building = 1L;

	[DefaultValue(1L)]
	public long id_kingdom = 1L;

	[DefaultValue(1L)]
	public long id_city = 1L;

	[DefaultValue(1L)]
	public long id_culture = 1L;

	[DefaultValue(1L)]
	public long id_clan = 1L;

	[DefaultValue(1L)]
	public long id_alliance = 1L;

	[DefaultValue(1L)]
	public long id_war = 1L;

	[DefaultValue(1L)]
	public long id_projectile = 1L;

	[DefaultValue(1L)]
	public long id_status = 1L;

	[DefaultValue(1L)]
	public long id_plot = 1L;

	[DefaultValue(1L)]
	public long id_book = 1L;

	[DefaultValue(1L)]
	public long id_subspecies = 1L;

	[DefaultValue(1L)]
	public long id_family = 1L;

	[DefaultValue(1L)]
	public long id_army = 1L;

	[DefaultValue(1L)]
	public long id_language = 1L;

	[DefaultValue(1L)]
	public long id_religion = 1L;

	[DefaultValue(1L)]
	public long id_item = 1L;

	[DefaultValue(1L)]
	public long id_diplomacy = 1L;

	[DefaultValue(1L)]
	public long life_dna = 1L;

	[NonSerialized]
	public long current_infected;

	[NonSerialized]
	public long current_mobs;

	[NonSerialized]
	public long current_houses;

	[NonSerialized]
	public long current_vegetation;

	[NonSerialized]
	public long current_infected_plague;

	private int _last_year = -1;

	private int _last_month = -1;

	private float _timer_stats = 0.1f;

	public static string[] possible_formats = new string[20]
	{
		"pr_", "st_", "w_", "a_", "c_", "u_", "b_", "k_", "c_", "cl_",
		"p_", "bo_", "sp_", "lang_", "rel_", "it_", "f_", "fa_", "army_", "d_"
	};

	[Preserve]
	[Obsolete("use .world_age_id instead", true)]
	public string era_id
	{
		set
		{
			if (!string.IsNullOrEmpty(value) && string.IsNullOrEmpty(world_age_id))
			{
				world_age_id = value;
			}
		}
	}

	public long deaths { get; set; }

	public long deaths_age { get; set; }

	public long deaths_hunger { get; set; }

	public long deaths_eaten { get; set; }

	public long deaths_plague { get; set; }

	public long deaths_poison { get; set; }

	public long deaths_infection { get; set; }

	public long deaths_tumor { get; set; }

	public long deaths_acid { get; set; }

	public long deaths_fire { get; set; }

	public long deaths_divine { get; set; }

	public long deaths_weapon { get; set; }

	public long deaths_gravity { get; set; }

	public long deaths_drowning { get; set; }

	public long deaths_water { get; set; }

	public long deaths_explosion { get; set; }

	public long metamorphosis { get; set; }

	public long evolutions { get; set; }

	public long deaths_other { get; set; }

	public long deaths_smile { get; set; }

	[JsonIgnore]
	public int year => _last_year;

	[Preserve]
	[JsonProperty("year")]
	[Obsolete("use .world_time instead", true)]
	public int year_obsolete
	{
		set
		{
			if (value != 0)
			{
				world_time += (float)value * 60f;
			}
		}
	}

	[Preserve]
	[JsonProperty("month")]
	[Obsolete("use .world_time instead", true)]
	public int month_obsolete
	{
		set
		{
			if (value != 0)
			{
				world_time += (float)value * 5f;
			}
		}
	}

	[Preserve]
	[JsonProperty("worldTime")]
	[Obsolete("use .world_time instead", true)]
	public double worldTime_obsolete
	{
		set
		{
			if (value != 0.0)
			{
				world_time += value;
			}
		}
	}

	public MapStats()
	{
		checkDefault();
	}

	private void checkDefault()
	{
		if (world_ages_slots == null)
		{
			world_ages_slots = new string[8];
		}
		if (string.IsNullOrEmpty(player_name))
		{
			player_name = "The Creator";
		}
		if (string.IsNullOrEmpty(player_mood))
		{
			setDefaultMood();
		}
		if (custom_data == null)
		{
			custom_data = new SaveCustomData();
		}
	}

	public void generateLifeDNA()
	{
		CultureInfo invariantCulture = CultureInfo.InvariantCulture;
		long num = long.Parse(DateTime.UtcNow.ToString("yyyyMMddHH", invariantCulture));
		life_dna = num;
	}

	internal void updateStatsForPanel(float pElapsed)
	{
		if (_timer_stats > 0f)
		{
			_timer_stats -= pElapsed;
			return;
		}
		_timer_stats = 0.1f;
		recalcCounters();
	}

	internal void updateWorldTime(float pElapsed)
	{
		world_time += pElapsed;
		int currentYear = Date.getCurrentYear();
		int currentMonth = Date.getCurrentMonth();
		if (_last_year != currentYear)
		{
			World.world.updateObjectAge();
		}
		if (_last_year != currentYear)
		{
			_last_month = -1;
		}
		_last_year = currentYear;
		_last_month = currentMonth;
	}

	public void load()
	{
		checkDefault();
		_last_year = Date.getCurrentYear();
		_last_month = Date.getCurrentMonth();
	}

	private void recalcCounters()
	{
		current_infected = 0L;
		current_mobs = 0L;
		current_houses = 0L;
		current_vegetation = 0L;
		current_infected_plague = 0L;
		List<Actor> simpleList = World.world.units.getSimpleList();
		int i = 0;
		for (int count = simpleList.Count; i < count; i++)
		{
			Actor actor = simpleList[i];
			if (actor.hasTrait("plague"))
			{
				current_infected_plague++;
			}
			if (actor.isSick())
			{
				current_infected++;
			}
			if (actor.asset.count_as_unit && !actor.isSapient())
			{
				current_mobs++;
			}
		}
		List<Building> simpleList2 = World.world.buildings.getSimpleList();
		int j = 0;
		for (int count2 = simpleList2.Count; j < count2; j++)
		{
			Building building = simpleList2[j];
			if (building.isCiv())
			{
				current_houses++;
			}
			else if (building.asset.is_vegetation)
			{
				current_vegetation++;
			}
		}
	}

	public long getNextId(string pType)
	{
		long result = 0L;
		switch (pType)
		{
		case "projectile":
			result = id_projectile++;
			break;
		case "statuses":
			result = id_status++;
			break;
		case "war":
			result = id_war++;
			break;
		case "alliance":
			result = id_alliance++;
			break;
		case "culture":
			result = id_culture++;
			break;
		case "unit":
			result = id_unit++;
			break;
		case "building":
			result = id_building++;
			break;
		case "kingdom":
			result = id_kingdom++;
			break;
		case "city":
			result = id_city++;
			break;
		case "clan":
			result = id_clan++;
			break;
		case "plot":
			result = id_plot++;
			break;
		case "book":
			result = id_book++;
			break;
		case "subspecies":
			result = id_subspecies++;
			break;
		case "language":
			result = id_language++;
			break;
		case "religion":
			result = id_religion++;
			break;
		case "item":
			result = id_item++;
			break;
		case "family":
			result = id_family++;
			break;
		case "army":
			result = id_army++;
			break;
		case "diplomacy":
			result = id_diplomacy++;
			break;
		default:
			Debug.LogError((object)("NO pType for id " + pType));
			break;
		}
		return result;
	}

	public static string formatId(string pType, long pID)
	{
		switch (pType)
		{
		case "projectile":
			return "pr_" + pID;
		case "statuses":
			return "st_" + pID;
		case "war":
			return "w_" + pID;
		case "alliance":
			return "a_" + pID;
		case "culture":
			return "c_" + pID;
		case "unit":
			return "u_" + pID;
		case "building":
			return "b_" + pID;
		case "kingdom":
			return "k_" + pID;
		case "city":
			return "c_" + pID;
		case "clan":
			return "cl_" + pID;
		case "plot":
			return "p_" + pID;
		case "book":
			return "bo_" + pID;
		case "subspecies":
			return "sp_" + pID;
		case "language":
			return "lang_" + pID;
		case "religion":
			return "rel_" + pID;
		case "item":
			return "it_" + pID;
		case "family":
			return "fa_" + pID;
		case "army":
			return "army_" + pID;
		case "diplomacy":
			return "d_" + pID;
		default:
			Debug.LogError((object)("NO pType for id " + pType));
			return "???_" + pID;
		}
	}

	public void debug(DebugTool pTool)
	{
		pTool.setText("(d)worldTime:", world_time, 0f, pShowBar: false, 0L);
		pTool.setText("(f)worldTime:", getWorldTime(), 0f, pShowBar: false, 0L);
		pTool.setText("cur month:", Date.getCurrentMonth(), 0f, pShowBar: false, 0L);
		pTool.setText("cur year:", Date.getCurrentYear(), 0f, pShowBar: false, 0L);
		pTool.setText("last_year:", _last_year, 0f, pShowBar: false, 0L);
		pTool.setText("last_month:", _last_month, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("months since 0:", Date.getMonthsSince(0.0), 0f, pShowBar: false, 0L);
		pTool.setText("years since 0:", Date.getYearsSince(0.0), 0f, pShowBar: false, 0L);
		pTool.setText("months since now:", Date.getMonthsSince(world_time), 0f, pShowBar: false, 0L);
		pTool.setText("years since now:", Date.getYearsSince(world_time), 0f, pShowBar: false, 0L);
		pTool.setText("month time:", Date.getMonthTime(), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("getDate 0:", Date.getDate(0.0), 0f, pShowBar: false, 0L);
		pTool.setText("getYearDate 0:", Date.getYearDate(0.0), 0f, pShowBar: false, 0L);
		pTool.setText("getYear 0:", Date.getYear(0.0), 0f, pShowBar: false, 0L);
		pTool.setText("getYear0 0:", Date.getYear0(0.0), 0f, pShowBar: false, 0L);
		pTool.setText("getDate now:", Date.getDate(world_time), 0f, pShowBar: false, 0L);
		pTool.setText("getYearDate now:", Date.getYearDate(world_time), 0f, pShowBar: false, 0L);
		pTool.setText("getYear now:", Date.getYear(world_time), 0f, pShowBar: false, 0L);
		pTool.setText("getYear0 now:", Date.getYear0(world_time), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("max_float:", float.MaxValue, 0f, pShowBar: false, 0L);
	}

	public float getWorldTime()
	{
		return (float)world_time;
	}

	public void initNewWorld()
	{
		generateLifeDNA();
		generatePlayerName();
		setDefaultMood();
		name = NameGenerator.getName("world_name");
		AssetManager.gene_library.regenerateBasicDNACodesWithLifeSeed(life_dna);
	}

	private void generatePlayerName()
	{
		player_name = NameGenerator.getName("player_name", ActorSex.Male, pForceLegacy: false, null, null, pIgnoreBlackList: true);
	}

	private void setDefaultMood()
	{
		player_mood = "serene";
	}

	public ArchitectMood getArchitectMood()
	{
		if (string.IsNullOrEmpty(player_mood))
		{
			player_mood = "serene";
		}
		ArchitectMood architectMood = AssetManager.architect_mood_library.get(player_mood);
		if (architectMood == null)
		{
			architectMood = AssetManager.architect_mood_library.get("serene");
		}
		return architectMood;
	}
}
// --- End of File: MapStats.cs ---



// --- Start of File: MapTag.cs ---
using UnityEngine;

public class MapTag : MonoBehaviour
{
	public bool tagEnabled;

	public MapTagType tagType;

	public Sprite buttonOn;

	public Sprite buttonOff;

	public string icon;

	public CanvasGroup tagGroup;

	private void Start()
	{
		updateSprite();
	}

	public void clickButton()
	{
	}

	public void clickListWorldsButton()
	{
	}

	private void updateSprite()
	{
	}
}
// --- End of File: MapTag.cs ---



// --- Start of File: MapTagButton.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapTagButton : MonoBehaviour
{
	public Text text;

	public Image icon;
}
// --- End of File: MapTagButton.cs ---



// --- Start of File: MapTagType.cs ---
public enum MapTagType
{
	General,
	Realistic,
	Earth,
	Fantasy,
	Populated,
	Unpopulated,
	Country,
	Continent,
	Natural,
	Unnatural,
	Civilizations,
	Battle,
	WorldWar,
	SciFi,
	ArtToMap,
	PerfectBalance,
	Disasters,
	Magic,
	Anime,
	Other
}
// --- End of File: MapTagType.cs ---



// --- Start of File: MapTagWindow.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapTagWindow : MonoBehaviour
{
	public Button continueButton;

	public Sprite buttonOn;

	public Sprite buttonOff;

	public CanvasGroup tagGroup;

	public Text statusMessage;

	public MapTagButton mapTagButtonPrefab;

	public Transform transformContent;
}
// --- End of File: MapTagWindow.cs ---



// --- Start of File: MapUploader.cs ---
using System;
using RSG;

public static class MapUploader
{
	public static Promise<string> uploadMap()
	{
		string text = DateTime.UtcNow.ToString("yyyyMMdd");
		return S3Manager.instance.uploadFileToAWS3("wbox/" + text.ToString() + "/" + Auth.userId + "_" + Guid.NewGuid().ToString() + ".wbox", getMapData());
	}

	private static byte[] getMapData()
	{
		return SaveManager.getMapFromPath(SaveManager.currentSavePath).toZip();
	}
}
// --- End of File: MapUploader.cs ---



// --- Start of File: MapUploadingWindow.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapUploadingWindow : MonoBehaviour
{
	public Button doneButton;

	public Image loadingImage;

	public Image doneImage;

	public GameObject mapIDGroup;

	public Text mapIDText;

	public Text statusMessage;

	public Text percents;

	public Image bar;

	public Image mask;

	public static bool uploading;
}
// --- End of File: MapUploadingWindow.cs ---



// --- Start of File: MapUploadReadyWindow.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MapUploadReadyWindow : MonoBehaviour
{
	public Button uploadButton;

	public Text statusMessage;

	public WorldElement worldElementPrefab;

	public WorldElement element;

	public Transform transformContent;
}
// --- End of File: MapUploadReadyWindow.cs ---



// --- Start of File: MaskAutoEnabler.cs ---
using UnityEngine;
using UnityEngine.UI;

public class MaskAutoEnabler : MonoBehaviour
{
	private void Awake()
	{
		((Behaviour)((Component)this).GetComponent<Mask>()).enabled = true;
		((Behaviour)((Component)this).GetComponent<Image>()).enabled = true;
	}
}
// --- End of File: MaskAutoEnabler.cs ---



// --- Start of File: MB.cs ---
public static class MB
{
	public const string Menu = "Menu";

	public const string New_World = "New_World";

	public const string Neutral_001 = "Neutral_001";

	public const string Locations_Forest = "Locations_Forest";

	public const string Locations_Desert = "Locations_Desert";

	public const string Locations_Mountains = "Locations_Mountains";

	public const string Locations_Ocean = "Locations_Ocean";

	public const string Locations_Snow = "Locations_Snow";

	public const string Nature_RainCloud = "Nature_RainCloud";

	public const string Nature_AcidCloud = "Nature_AcidCloud";

	public const string Nature_LavaCloud = "Nature_LavaCloud";

	public const string Nature_SnowCloud = "Nature_SnowCloud";

	public const string Humans_Neutral = "Humans_Neutral";

	public const string Elves_Neutral = "Elves_Neutral";

	public const string Dwarves_Neutral = "Dwarves_Neutral";

	public const string Orcs_Neutral = "Orcs_Neutral";

	public const string Humans_Aggression = "Humans_Aggression";

	public const string Elves_Aggression = "Elves_Aggression";

	public const string Dwarves_Aggression = "Dwarves_Aggression";

	public const string Orcs_Aggression = "Orcs_Aggression";

	public const string Units_ColdOne = "Units_ColdOne";

	public const string Units_Bandits = "Units_Bandits";

	public const string Units_Zombie = "Units_Zombie";

	public const string Units_Demon = "Units_Demon";

	public const string Units_Snowman = "Units_Snowman";

	public const string Units_Skeleton = "Units_Skeleton";

	public const string Units_GodFinger = "Units_GodFinger";

	public const string Units_Dragon = "Units_Dragon";

	public const string Units_Santa = "Units_Santa";

	public const string Units_UFO = "Units_UFO";

	public const string Units_Fairy = "Units_Fairy";

	public const string Units_LivingPlants = "Units_LivingPlants";

	public const string Units_BeeHive = "Units_BeeHive";

	public const string Units_Sheep = "Units_Sheep";

	public const string Units_Rabbit = "Units_Rabbit";

	public const string Units_Rat = "Units_Rat";

	public const string Units_Bear = "Units_Bear";

	public const string Units_Piranha = "Units_Piranha";

	public const string Units_Chicken = "Units_Chicken";

	public const string Units_Cat = "Units_Cat";

	public const string Units_Wolf = "Units_Wolf";

	public const string Units_Worm = "Units_Worm";

	public const string Buildings_Tumor = "Buildings_Tumor";

	public const string ParamGrayGoo = "GreyGoo";

	public const string CrabzillaParam = "Crabzilla";

	public const string Unique_ZombieInfection = "Unique_ZombieInfection";

	public const string consolidated_music_event = "event:/MUSIC/ConsolidatedMusicEvent";

	public const string Ocean = "event:/SFX/ENVIRONMENT/Ocean";

	public const string Sea = "event:/SFX/ENVIRONMENT/Sea";

	public const string Waterplace = "event:/SFX/ENVIRONMENT/Waterplace";

	public const string ForestBirds = "event:/SFX/ENVIRONMENT/ForestBirds";

	public const string ForestCrickets = "event:/SFX/ENVIRONMENT/ForestCrickets";

	public const string DesertEnvironment = "event:/SFX/ENVIRONMENT/DesertEnvironment";

	public const string MountainsEnvironment = "event:/SFX/ENVIRONMENT/MountainsEnvironment";

	public const string SnowEnvironment = "event:/SFX/ENVIRONMENT/SnowEnvironment";

	public const string LavaEnvironment = "event:/SFX/ENVIRONMENT/LavaEnvironment";

	public const string MapEnvironment = "event:/SFX/ENVIRONMENT/MapEnvironment";

	public const string Choiser = "event:/SFX/UI/Choiser";

	public const string Counter = "event:/SFX/UI/Counter";

	public const string HintHighlight = "event:/SFX/UI/HintHighlight";

	public const string KnobRattleHint = "event:/SFX/UI/KnobRattleHint";

	public const string LargeKnob = "event:/SFX/UI/LargeKnob";

	public const string MediumlKnob = "event:/SFX/UI/MediumlKnob";

	public const string NoPoint = "event:/SFX/UI/NoPoint";

	public const string SimpleHighlight = "event:/SFX/UI/SimpleHighlight";

	public const string SmallKnob = "event:/SFX/UI/SmallKnob";

	public const string TabKnobOff = "event:/SFX/UI/TabKnobOff";

	public const string TabKnobOn = "event:/SFX/UI/TabKnobOn";

	public const string ThumbnailHighlight = "event:/SFX/UI/ThumbnailHighlight";

	public const string ThumbnailsSlide = "event:/SFX/UI/ThumbnailsSlide";

	public const string WindowClose = "event:/SFX/UI/WindowClose";

	public const string WindowWhoosh = "event:/SFX/UI/WindowWhoosh";

	public const string YesPoint = "event:/SFX/UI/YesPoint";

	public const string BitScaleWhooshIn = "event:/SFX/MAP/BitScaleWhooshIn";

	public const string BitScaleWhooshOut = "event:/SFX/MAP/BitScaleWhooshOut";

	public const string MapMovementWhoosh = "event:/SFX/MAP/MapMovementWhoosh";

	public const string DestroyBuildingStone = "event:/SFX/BUILDINGS/DestroyBuildingStone";

	public const string DestroyBuildingWood = "event:/SFX/BUILDINGS/DestroyBuildingWood";

	public const string DestroyBuildingGeneric = "event:/SFX/BUILDINGS/DestroyBuildingGeneric";

	public const string DestroyBuildingFlesh = "event:/SFX/BUILDINGS/DestroyBuildingFlesh";

	public const string DestroyBuildingMetal = "event:/SFX/BUILDINGS/DestroyBuildingMetal";

	public const string DestroyBuildingRobotic = "event:/SFX/BUILDINGS/DestroyBuildingRobotic";

	public const string onstructionBuildingStone = "event:/SFX/BUILDINGS/onstructionBuildingStone";

	public const string onstructionBuildingWood = "event:/SFX/BUILDINGS/onstructionBuildingWood";

	public const string onstructionBuildingGeneric = "event:/SFX/BUILDINGS/onstructionBuildingGeneric";

	public const string SpawnBuildingGeneric = "event:/SFX/BUILDINGS/SpawnBuildingGeneric";

	public const string SpawnBuildingStone = "event:/SFX/BUILDINGS/SpawnBuildingStone";

	public const string SpawnBuildingWood = "event:/SFX/BUILDINGS/SpawnBuildingWood";

	public const string SpawnBuildingFlesh = "event:/SFX/BUILDINGS/SpawnBuildingFlesh";

	public const string SpawnBuildingRobotic = "event:/SFX/BUILDINGS/SpawnBuildingRobotic";

	public const string SpawnBuildingMetal = "event:/SFX/BUILDINGS/SpawnBuildingMetal";

	public const string CollectFruits = "event:/SFX/CIVILIZATIONS/CollectFruits";

	public const string CollectHerbs = "event:/SFX/CIVILIZATIONS/CollectHerbs";

	public const string ChopTree = "event:/SFX/CIVILIZATIONS/ChopTree";

	public const string MakeFarmField = "event:/SFX/CIVILIZATIONS/MakeFarmField";

	public const string PlantCrops = "event:/SFX/CIVILIZATIONS/PlantCrops";

	public const string CropsGrow = "event:/SFX/CIVILIZATIONS/CropsGrow";

	public const string HarvestCrops = "event:/SFX/CIVILIZATIONS/HarvestCrops";

	public const string CleanRuins = "event:/SFX/CIVILIZATIONS/CleanRuins";

	public const string BuildRoad = "event:/SFX/CIVILIZATIONS/BuildRoad";

	public const string AnimalEatPlant = "event:/SFX/NATURE/AnimalEatPlant";

	public const string MiningMineral = "event:/SFX/CIVILIZATIONS/MiningMineral";

	public const string SpawnFishnet = "event:/SFX/CIVILIZATIONS/SpawnFishnet";

	public const string HitGeneric = "event:/SFX/HIT/HitGeneric";

	public const string HitWood = "event:/SFX/HIT/HitWood";

	public const string HitStone = "event:/SFX/HIT/HitStone";

	public const string HitMetal = "event:/SFX/HIT/HitMetal";

	public const string HitFlesh = "event:/SFX/HIT/HitFlesh";

	public const string HitBone = "event:/SFX/HIT/HitBone";

	public const string HitSwordShield = "event:/SFX/HIT/HitSwordShield";

	public const string HitSwordSword = "event:/SFX/HIT/HitSwordSword";

	public const string WeaponStartArrow = "event:/SFX/WEAPONS/WeaponStartArrow";

	public const string WeaponStartThrow = "event:/SFX/WEAPONS/WeaponStartThrow";

	public const string WeaponSnowballLand = "event:/SFX/WEAPONS/WeaponSnowballLand";

	public const string WeaponTorchLand = "event:/SFX/WEAPONS/WeaponTorchLand";

	public const string WeaponRedOrbStart = "event:/SFX/WEAPONS/WeaponRedOrbStart";

	public const string WeaponRedOrbLand = "event:/SFX/WEAPONS/WeaponRedOrbLand";

	public const string WeaponFreezeOrbStart = "event:/SFX/WEAPONS/WeaponFreezeOrbStart";

	public const string WeaponFreezeOrbLand = "event:/SFX/WEAPONS/WeaponFreezeOrbLand";

	public const string WeaponGreenOrbStart = "event:/SFX/WEAPONS/WeaponGreenOrbStart";

	public const string WeaponGreenOrbLand = "event:/SFX/WEAPONS/WeaponGreenOrbLand";

	public const string WeaponBoneProjectileStart = "event:/SFX/WEAPONS/WeaponBoneProjectileStart";

	public const string WeaponBoneProjectileLand = "event:/SFX/WEAPONS/WeaponBoneProjectileLand";

	public const string WeaponPlasmaBallStart = "event:/SFX/WEAPONS/WeaponPlasmaBallStart";

	public const string WeaponPlasmaBallLand = "event:/SFX/WEAPONS/WeaponPlasmaBallLand";

	public const string WeaponFireballStart = "event:/SFX/WEAPONS/WeaponFireballStart";

	public const string WeaponFireballLand = "event:/SFX/WEAPONS/WeaponFireballLand";

	public const string WeaponMadnessBallStart = "event:/SFX/WEAPONS/WeaponMadnessBallStart";

	public const string WeaponMadnessBallLand = "event:/SFX/WEAPONS/WeaponMadnessBallLand";

	public const string WeaponRockStart = "event:/SFX/WEAPONS/WeaponRockStart";

	public const string WeaponRockLand = "event:/SFX/WEAPONS/WeaponRockLand";

	public const string WeaponShotgunStart = "event:/SFX/WEAPONS/WeaponShotgunStart";

	public const string WeaponShotgunLand = "event:/SFX/WEAPONS/WeaponShotgunLand";

	public const string IncreaseTemperature = "event:/SFX/POWERS/IncreaseTemperature";

	public const string DecreaseTemperature = "event:/SFX/POWERS/DecreaseTemperature";

	public const string Inspiration = "event:/SFX/POWERS/Inspiration";

	public const string Friendship = "event:/SFX/POWERS/Friendship";

	public const string Spite = "event:/SFX/POWERS/Spite";

	public const string Minerals = "event:/SFX/POWERS/Minerals";

	public const string Lava = "event:/SFX/POWERS/Lava";

	public const string Acid = "event:/SFX/POWERS/Acid";

	public const string Rain = "event:/SFX/POWERS/Rain";

	public const string BloodRain = "event:/SFX/POWERS/BloodRain";

	public const string Madness = "event:/SFX/POWERS/Madness";

	public const string Blessing = "event:/SFX/POWERS/Blessing";

	public const string Curse = "event:/SFX/POWERS/Curse";

	public const string Plague = "event:/SFX/POWERS/Plague";

	public const string ZombieInfection = "event:/SFX/POWERS/ZombieInfection";

	public const string MushSpores = "event:/SFX/POWERS/MushSpores";

	public const string Shield = "event:/SFX/POWERS/Shield";

	public const string Coffee = "event:/SFX/POWERS/Coffee";

	public const string Powerup = "event:/SFX/POWERS/Powerup";

	public const string GammaRain = "event:/SFX/POWERS/GammaRain";

	public const string OmegaRain = "event:/SFX/POWERS/OmegaRain";

	public const string DeltaRain = "event:/SFX/POWERS/DeltaRain";

	public const string LivingPlants = "event:/SFX/POWERS/LivingPlants";

	public const string LivingHouses = "event:/SFX/POWERS/LivingHouses";

	public const string Tnt = "event:/SFX/POWERS/Tnt";

	public const string TntTimed = "event:/SFX/POWERS/TntTimed";

	public const string WaterBomb = "event:/SFX/POWERS/WaterBomb";

	public const string LandMine = "event:/SFX/POWERS/LandMine";

	public const string Fireworks = "event:/SFX/POWERS/Fireworks";

	public const string Bomb = "event:/SFX/POWERS/Bomb";

	public const string Grenade = "event:/SFX/POWERS/Grenade";

	public const string NapalmBomb = "event:/SFX/POWERS/NapalmBomb";

	public const string AtomicBomb = "event:/SFX/POWERS/AtomicBomb";

	public const string AntimatterBomb = "event:/SFX/POWERS/AntimatterBomb";

	public const string TsarBomb = "event:/SFX/POWERS/TsarBomb";

	public const string CrabBomb = "event:/SFX/POWERS/CrabBomb";

	public const string Fire = "event:/SFX/POWERS/Fire";

	public const string SeedsGrass = "event:/SFX/POWERS/SeedsGrass";

	public const string SeedsSavanna = "event:/SFX/POWERS/SeedsSavanna";

	public const string SeedsMushroom = "event:/SFX/POWERS/SeedsMushroom";

	public const string SeedsEnchanted = "event:/SFX/POWERS/SeedsEnchanted";

	public const string SeedsCorrupted = "event:/SFX/POWERS/SeedsCorrupted";

	public const string SeedsSwamp = "event:/SFX/POWERS/SeedsSwamp";

	public const string SeedsInfernal = "event:/SFX/POWERS/SeedsInfernal";

	public const string SeedsJungle = "event:/SFX/POWERS/SeedsJungle";

	public const string SeedsCandy = "event:/SFX/POWERS/SeedsCandy";

	public const string SeedsDesert = "event:/SFX/POWERS/SeedsDesert";

	public const string SeedsCrystal = "event:/SFX/POWERS/SeedsCrystal";

	public const string SeedsLemon = "event:/SFX/POWERS/SeedsLemon";

	public const string SeedsPermafrost = "event:/SFX/POWERS/SeedsPermafrost";

	public const string SeedsFlower = "event:/SFX/POWERS/SeedsFlower";

	public const string FruitBush = "event:/SFX/POWERS/FruitBush";

	public const string FertilizerPlants = "event:/SFX/POWERS/FertilizerPlants";

	public const string FertilizerTrees = "event:/SFX/POWERS/FertilizerTrees";

	public const string SoilLow = "event:/SFX/POWERS/SoilLow";

	public const string Sand = "event:/SFX/POWERS/Sand";

	public const string SoilHigh = "event:/SFX/POWERS/SoilHigh";

	public const string Mountains = "event:/SFX/POWERS/Mountains";

	public const string Hills = "event:/SFX/POWERS/Hills";

	public const string IncreaseGroundLevel = "event:/SFX/POWERS/IncreaseGroundLevel";

	public const string DecreaseGroundLevel = "event:/SFX/POWERS/DecreaseGroundLevel";

	public const string Vortex = "event:/SFX/POWERS/Vortex";

	public const string GreyGoo = "event:/SFX/POWERS/GreyGoo";

	public const string Conway = "event:/SFX/POWERS/Conway";

	public const string Finger = "event:/SFX/POWERS/Finger";

	public const string Sponge = "event:/SFX/POWERS/Sponge";

	public const string Bucket = "event:/SFX/POWERS/Bucket";

	public const string Sickle = "event:/SFX/POWERS/Sickle";

	public const string Spade = "event:/SFX/POWERS/Spade";

	public const string Pickaxe = "event:/SFX/POWERS/Pickaxe";

	public const string Pit = "event:/SFX/POWERS/Pit";

	public const string ShovelPlus = "event:/SFX/POWERS/ShovelPlus";

	public const string ShovelMinus = "event:/SFX/POWERS/ShovelMinus";

	public const string Axe = "event:/SFX/POWERS/Axe";

	public const string Demolish = "event:/SFX/POWERS/Demolish";

	public const string LifeEraser = "event:/SFX/POWERS/LifeEraser";

	public const string Fuse = "event:/SFX/POWERS/Fuse";

	public const string SpawnCloud = "event:/SFX/UNIQUE/SpawnCloud";

	public const string SpawnWhoosh = "event:/SFX/UNIQUE/SpawnWhoosh";

	public const string RoboSantaIdleLoop = "event:/SFX/OTHER/RoboSanta/RoboSantaIdleLoop";

	public const string RoboSantaVoice = "event:/SFX/OTHER/RoboSanta/RoboSantaVoice";

	public const string RoboSantaBombLaunch = "event:/SFX/DROPS/DropLaunchSantaBomb";

	public const string DragonFirebreath = "event:/SFX/UNITS/dragon/fire_breath";

	public const string DragonSwoop = "event:/SFX/UNITS/dragon/swoop";

	public const string DivineMagnet = "event:/SFX/POWERS/DivineMagnet";

	public const string HeatRayMelts = "event:/SFX/POWERS/HeatRayMelts";

	public const string DivineLight = "event:/SFX/POWERS/DivineLight";

	public const string PrinterStep = "event:/SFX/UNIQUE/PrinterStep";

	public const string AntStep = "event:/SFX/UNIQUE/langton/ant_step";

	public const string ConwayMove = "event:/SFX/UNIQUE/ConwayMove";

	public const string IdleBiomass = "event:/SFX/BUILDINGS_IDLE/IdleBiomass";

	public const string IdleSuperPumpkin = "event:/SFX/BUILDINGS_IDLE/IdleSuperPumpkin";

	public const string IdleCybercore = "event:/SFX/BUILDINGS_IDLE/IdleCybercore";

	public const string IdleTumor = "event:/SFX/BUILDINGS_IDLE/IdleTumor";

	public const string IdleFlameTower = "event:/SFX/BUILDINGS_IDLE/IdleFlameTower";

	public const string IdleIceTower = "event:/SFX/BUILDINGS_IDLE/IdleIceTower";

	public const string IdleGoldenBrain = "event:/SFX/BUILDINGS_IDLE/IdleGoldenBrain";

	public const string IdleCorruptedBrain = "event:/SFX/BUILDINGS_IDLE/IdleCorruptedBrain";

	public const string IdleGeyser = "event:/SFX/BUILDINGS_IDLE/IdleGeyser";

	public const string IdleAcidGeyser = "event:/SFX/BUILDINGS_IDLE/IdleAcidGeyser";

	public const string IdleVolcano = "event:/SFX/BUILDINGS_IDLE/IdleVolcano";

	public const string IdleBonfire = "event:/SFX/BUILDINGS_IDLE/IdleBonfire";

	public const string IdleBeehive = "event:/SFX/BUILDINGS_IDLE/IdleBeehive";

	public const string IdleFishingDocks = "event:/SFX/BUILDINGS_IDLE/IdleFishingDocks";

	public const string IdleDocks = "event:/SFX/BUILDINGS_IDLE/IdleDocks";

	public const string IdleWindmill = "event:/SFX/BUILDINGS_IDLE/IdleWindmill";

	public const string IdleMine = "event:/SFX/BUILDINGS_IDLE/IdleMine";

	public const string IdleTemple = "event:/SFX/BUILDINGS_IDLE/IdleTemple";

	public const string IdleBarracks = "event:/SFX/BUILDINGS_IDLE/IdleBarracks";

	public const string IdleEnchantedTree = "event:/SFX/BUILDINGS_IDLE/IdleEnchantedTree";

	public const string IdleCorruptedTree = "event:/SFX/BUILDINGS_IDLE/IdleCorruptedTree";

	public const string IdleWell = "event:/SFX/BUILDINGS_IDLE/IdleWell";

	public const string IdleStatue = "event:/SFX/BUILDINGS_IDLE/IdleStatue";

	public const string IdleWatchTower = "event:/SFX/BUILDINGS_IDLE/IdleWatchTower";

	public const string CrabzillaSpawn = "event:/SFX/UNIQUE/Crabzilla/CrabzillaSpawn";

	public const string CrabzillaLazer = "event:/SFX/UNIQUE/Crabzilla/CrabzillaLazer";

	public const string CrabzillaFootsteps = "event:/SFX/UNIQUE/Crabzilla/CrabzillaFootsteps";

	public const string CrabzillaVoice = "event:/SFX/UNIQUE/Crabzilla/CrabzillaVoice";

	public const string DropFriendship = "event:/SFX/DROPS/DropFriendship";

	public const string DropSpite = "event:/SFX/DROPS/DropSpite";

	public const string DropInspiration = "event:/SFX/DROPS/DropInspiration";

	public const string DropDiscord = "event:/SFX/DROPS/DropDiscord";

	public const string DropUnity = "event:/SFX/DROPS/DropUnity";

	public const string DropAcid = "event:/SFX/DROPS/DropAcid";

	public const string DropRain = "event:/SFX/DROPS/DropRain";

	public const string DropLava = "event:/SFX/DROPS/DropLava";

	public const string DropGold = "event:/SFX/DROPS/DropGold";

	public const string DropStone = "event:/SFX/DROPS/DropStone";

	public const string DropMineral = "event:/SFX/DROPS/DropMineral";

	public const string DropGeyser = "event:/SFX/DROPS/DropGeyser";

	public const string DropVolcano = "event:/SFX/DROPS/DropVolcano";

	public const string DropBlessing = "event:/SFX/DROPS/DropBlessing";

	public const string DropBloodRain = "event:/SFX/DROPS/DropBloodRain";

	public const string DropCurse = "event:/SFX/DROPS/DropCurse";

	public const string DropCure = "event:/SFX/DROPS/DropCure";

	public const string DropMadness = "event:/SFX/DROPS/DropMadness";

	public const string DropPlague = "event:/SFX/DROPS/DropPlague";

	public const string DropTnt = "event:/SFX/DROPS/DropTnt";

	public const string DropWaterBomb = "event:/SFX/DROPS/DropWaterBomb";

	public const string DropLandmine = "event:/SFX/DROPS/DropLandmine";

	public const string DropFireworks = "event:/SFX/DROPS/DropFireworks";

	public const string DropFire = "event:/SFX/DROPS/DropFire";

	public const string DropSeedGrass = "event:/SFX/DROPS/DropSeedGrass";

	public const string DropSeedSavanna = "event:/SFX/DROPS/DropSeedSavanna";

	public const string DropSeedMushroom = "event:/SFX/DROPS/DropSeedMushroom";

	public const string DropSeedEnchanted = "event:/SFX/DROPS/DropSeedEnchanted";

	public const string DropSeedCorrupted = "event:/SFX/DROPS/DropSeedCorrupted";

	public const string DropSeedSwamp = "event:/SFX/DROPS/DropSeedSwamp";

	public const string DropSeedInfernal = "event:/SFX/DROPS/DropSeedInfernal";

	public const string DropSeedJungle = "event:/SFX/DROPS/DropSeedJungle";

	public const string DropSeedCandy = "event:/SFX/DROPS/DropSeedCandy";

	public const string DropSeedDesert = "event:/SFX/DROPS/DropSeedDesert";

	public const string DropSeedCrystal = "event:/SFX/DROPS/DropSeedCrystal";

	public const string DropSeedLemon = "event:/SFX/DROPS/DropSeedLemon";

	public const string DropSeedPermafrost = "event:/SFX/DROPS/DropSeedPermafrost";

	public const string DropFertilizerPlants = "event:/SFX/DROPS/DropFertilizerPlants";

	public const string DropBush = "event:/SFX/DROPS/DropBush";

	public const string DropZombieInfection = "event:/SFX/DROPS/DropZombieInfection";

	public const string DropMushSpores = "event:/SFX/DROPS/DropMushSpores";

	public const string DropShield = "event:/SFX/DROPS/DropShield";

	public const string DropCoffee = "event:/SFX/DROPS/DropCoffee";

	public const string DropPowerup = "event:/SFX/DROPS/DropPowerup";

	public const string DropRainGamma = "event:/SFX/DROPS/DropRainGamma";

	public const string DropRainOmeaga = "event:/SFX/DROPS/DropRainOmeaga";

	public const string DropRainDelta = "event:/SFX/DROPS/DropRainDelta";

	public const string DropLivingPlants = "event:/SFX/DROPS/DropLivingPlants";

	public const string DropLivingHouse = "event:/SFX/DROPS/DropLivingHouse";

	public const string DropSnow = "event:/SFX/DROPS/DropSnow";

	public const string DropAsh = "event:/SFX/DROPS/DropAsh";

	public const string DropMagicRain = "event:/SFX/DROPS/DropMagicRain";

	public const string DropRage = "event:/SFX/DROPS/DropRage";

	public const string DropTumor = "event:/SFX/DROPS/DropTumor";

	public const string DropBiomass = "event:/SFX/DROPS/DropBiomass";

	public const string DropCybercore = "event:/SFX/DROPS/DropCybercore";

	public const string DropSuperPumpkin = "event:/SFX/DROPS/DropSuperPumpkin";

	public const string DropGoldenBrain = "event:/SFX/DROPS/DropGoldenBrain";

	public const string DropMonolith = "event:/SFX/DROPS/DropMonolith";

	public const string DropCorruptedBrain = "event:/SFX/DROPS/DropCorruptedBrain";

	public const string DropIceTower = "event:/SFX/DROPS/DropIceTower";

	public const string DropBeehive = "event:/SFX/DROPS/DropBeehive";

	public const string DropFlameTower = "event:/SFX/DROPS/DropFlameTower";

	public const string DropLaunchGrenade = "event:/SFX/DROPS/DropLaunchGrenade";

	public const string DropLaunchBombSmall = "event:/SFX/DROPS/DropLaunchBombSmall";

	public const string DropLaunchGrenadeHuge = "event:/SFX/DROPS/DropLaunchGrenadeHuge";

	public const string DropLaunchCrabBomb = "event:/SFX/DROPS/DropLaunchCrabBomb";

	public const string ExplosionForce = "event:/SFX/EXPLOSIONS/ExplosionForce";

	public const string ExplosionCrabBomb = "event:/SFX/EXPLOSIONS/ExplosionCrabBomb";

	public const string ExplosionTiny = "event:/SFX/EXPLOSIONS/ExplosionTiny";

	public const string ExplosionSmall = "event:/SFX/EXPLOSIONS/ExplosionSmall";

	public const string ExplosionMiddle = "event:/SFX/EXPLOSIONS/ExplosionMiddle";

	public const string ExplosionBig = "event:/SFX/EXPLOSIONS/ExplosionBig";

	public const string ExplosionHuge = "event:/SFX/EXPLOSIONS/ExplosionHuge";

	public const string ExplosionUFO = "event:/SFX/EXPLOSIONS/ExplosionUFO";

	public const string ExplosionMeteorite = "event:/SFX/EXPLOSIONS/ExplosionMeteorite";

	public const string ExplosionBombNapalm = "event:/SFX/EXPLOSIONS/ExplosionGrenade";

	public const string ExplosionAntimatterBomb = "event:/SFX/EXPLOSIONS/ExplosionAntimatterBomb";

	public const string ExplosionBombCrab = "event:/SFX/EXPLOSIONS/ExplosionGrenade";

	public const string ExplosionFireworks = "event:/SFX/EXPLOSIONS/ExplosionFireworks";

	public const string ExplosionLightningStrike = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike";

	public const string ExplosionBowlingBall = "event:/SFX/EXPLOSIONS/ExplosionBowlingBall";

	public const string ExplosionRoboSantaBomb = "event:/SFX/EXPLOSIONS/ExplosionRoboSantaBomb";

	public const string DropSimpleImpact = "event:/SFX/DESTRUCTION/DropSimpleImpact";

	public const string InfinityCoin = "event:/SFX/DESTRUCTION/InfinityCoin";

	public const string FallMeteorite = "event:/SFX/DESTRUCTION/FallMeteorite";

	public const string CrabBombImpact = "event:/SFX/DESTRUCTION/CrabBombImpact";

	public const string GreyGooEat = "event:/SFX/DESTRUCTION/GreyGooEat";

	public const string BurningTile = "event:/SFX/NATURE/BurningTile";

	public const string StatusBurningUnit = "event:/SFX/STATUS/StatusBurningUnit";

	public const string StatusBurningBuilding = "event:/SFX/STATUS/StatusBurningBuilding";

	public const string StatusShield = "event:/SFX/STATUS/StatusShield";

	public const string StatusFrozen = "event:/SFX/STATUS/StatusFrozen";

	public const string FillWaterTile = "event:/SFX/NATURE/FillWaterTile";

	public const string ForestFire = "event:/SFX/NATURE/ForestFire";

	public const string EarthQuake = "event:/SFX/NATURE/EarthQuake";

	public const string TornadoIdleLoop = "event:/SFX/NATURE/TornadoIdleLoop";

	public const string RainCloudSpawn = "event:/SFX/NATURE/RainCloudSpawn";

	public const string AcidCloudSpawn = " event:/SFX/NATURE/AcidCloudSpawn";

	public const string LavaCloudSpawn = "event:/SFX/NATURE/LavaCloudSpawn";

	public const string SnowCloudSpawn = "event:/SFX/NATURE/SnowCloudSpawn";

	public const string BaseFloraSpawn = "event:/SFX/NATURE/BaseFloraSpawn";

	public const string BushSpawn = "event:/SFX/NATURE/BushSpawn";

	public const string CactusSpawn = "event:/SFX/NATURE/CactusSpawn";

	public const string TreeDeath = "event:/SFX/NATURE/TreeDeath";

	public const string TreeFall = "event:/SFX/NATURE/TreeFall";

	public const string GrassSpawn = "event:/SFX/NATURE/GrassSpawn";

	public const string WilhelmScream = "event:/SFX/OTHER/WilhelmScream";

	public const string Punch = "event:/SFX/OTHER/Punch";

	public const string ClickOriginal = "event:/SFX/Ui/Click";
}
// --- End of File: MB.cs ---



// --- Start of File: MeatTargetType.cs ---
namespace ai.behaviours;

public enum MeatTargetType
{
	Meat,
	MeatSameSpecies,
	Insect
}
// --- End of File: MeatTargetType.cs ---



// --- Start of File: MetaBanner.cs ---
using UnityEngine;

public delegate IBanner MetaBanner(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent);
// --- End of File: MetaBanner.cs ---



// --- Start of File: MetaBannerElement.cs ---
using System;

public class MetaBannerElement
{
	public BannerBase banner;

	public Func<bool> check;

	public MetaSelectedGetter nano;
}
// --- End of File: MetaBannerElement.cs ---



// --- Start of File: MetaCheckUnitWindowAction.cs ---
public delegate bool MetaCheckUnitWindowAction(Actor pUnit);
// --- End of File: MetaCheckUnitWindowAction.cs ---



// --- Start of File: MetaCustomization.cs ---
public delegate void MetaCustomization();
// --- End of File: MetaCustomization.cs ---



// --- Start of File: MetaCustomizationAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class MetaCustomizationAsset : Asset, IMultiLocalesAsset
{
	public string localization_title;

	public MetaType meta_type;

	public string banner_prefab_id;

	public MetaBanner get_banner;

	public bool editable = true;

	public bool option_1_editable = true;

	public bool option_2_editable = true;

	public bool option_2_color_editable = true;

	public bool color_editable = true;

	public MetaCustomizationComponent customize_component;

	public string customize_window_id;

	public MetaCustomizationOptionGet option_1_get;

	public MetaCustomizationOptionSet option_1_set;

	public MetaCustomizationOptionGet option_2_get;

	public MetaCustomizationOptionSet option_2_set;

	public MetaCustomizationOptionGet color_get;

	public MetaCustomizationOptionSet color_set;

	public MetaCustomizationCounter option_1_count;

	public MetaCustomizationCounter option_2_count;

	public MetaCustomizationCounter color_count;

	public MetaCustomizationColorLibrary color_library;

	public MetaCustomization on_new_color = delegate
	{
		World.world.zone_calculator.dirtyAndClear();
	};

	public string title_locale;

	public string option_1_locale;

	public string option_2_locale;

	public string color_locale;

	public string icon_banner;

	public string icon_creature;

	public IEnumerable<string> getLocaleIDs()
	{
		if (editable)
		{
			yield return localization_title;
			yield return title_locale;
			yield return option_1_locale;
			yield return option_2_locale;
			yield return color_locale;
		}
	}
}
// --- End of File: MetaCustomizationAsset.cs ---



// --- Start of File: MetaCustomizationColorLibrary.cs ---
public delegate ColorLibrary MetaCustomizationColorLibrary();
// --- End of File: MetaCustomizationColorLibrary.cs ---



// --- Start of File: MetaCustomizationComponent.cs ---
using UnityEngine;

public delegate void MetaCustomizationComponent(GameObject pGameObject);
// --- End of File: MetaCustomizationComponent.cs ---



// --- Start of File: MetaCustomizationCounter.cs ---
public delegate int MetaCustomizationCounter();
// --- End of File: MetaCustomizationCounter.cs ---



// --- Start of File: MetaCustomizationLibrary.cs ---
using UnityEngine;

public class MetaCustomizationLibrary : AssetLibrary<MetaCustomizationAsset>
{
	public override void init()
	{
		base.init();
		add(new MetaCustomizationAsset
		{
			id = "religion",
			meta_type = MetaType.Religion,
			banner_prefab_id = "ui/PrefabBannerReligion",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				ReligionBanner religionBanner = Object.Instantiate<ReligionBanner>(Resources.Load<ReligionBanner>(pAsset.banner_prefab_id), pParent);
				religionBanner.enable_default_click = false;
				religionBanner.load(pNanoObject as Religion);
				return religionBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<ReligionCustomizeWindow>();
			},
			customize_window_id = "religion_customize",
			option_1_get = () => SelectedMetas.selected_religion.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_religion.data.banner_background_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_religion.data.banner_icon_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_religion.data.banner_icon_id = pValue;
			},
			color_get = () => SelectedMetas.selected_religion.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_religion.data.setColorID(pValue);
			},
			color_library = () => AssetManager.religion_colors_library,
			option_1_count = () => AssetManager.religion_banners_library.getCurrentAsset().backgrounds.Count,
			option_2_count = () => AssetManager.religion_banners_library.getCurrentAsset().icons.Count,
			title_locale = "customize_religion",
			option_1_locale = "religion_background",
			option_2_locale = "religion_element",
			color_locale = "religion_color",
			icon_banner = "iconReligion",
			icon_creature = "iconLivingPlants"
		});
		add(new MetaCustomizationAsset
		{
			id = "culture",
			meta_type = MetaType.Culture,
			banner_prefab_id = "ui/PrefabBannerCulture",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				CultureBanner cultureBanner = Object.Instantiate<CultureBanner>(Resources.Load<CultureBanner>(pAsset.banner_prefab_id), pParent);
				cultureBanner.enable_default_click = false;
				cultureBanner.load(pNanoObject as Culture);
				return cultureBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<CultureCustomizeWindow>();
			},
			customize_window_id = "culture_customize",
			option_1_get = () => SelectedMetas.selected_culture.data.banner_decor_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_culture.data.banner_decor_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_culture.data.banner_element_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_culture.data.banner_element_id = pValue;
			},
			color_get = () => SelectedMetas.selected_culture.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_culture.data.setColorID(pValue);
			},
			color_library = () => AssetManager.culture_colors_library,
			option_1_count = () => AssetManager.culture_banners_library.getCurrentAsset().backgrounds.Count,
			option_2_count = () => AssetManager.culture_banners_library.getCurrentAsset().icons.Count,
			title_locale = "customize_culture",
			option_1_locale = "culture_decor",
			option_2_locale = "culture_element",
			color_locale = "culture_color",
			icon_banner = "iconCulture",
			icon_creature = "iconSuperPumpkin"
		});
		add(new MetaCustomizationAsset
		{
			id = "family",
			meta_type = MetaType.Family,
			banner_prefab_id = "ui/PrefabBannerFamily",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				FamilyBanner familyBanner = Object.Instantiate<FamilyBanner>(Resources.Load<FamilyBanner>(pAsset.banner_prefab_id), pParent);
				familyBanner.enable_default_click = false;
				familyBanner.load(pNanoObject as Family);
				return familyBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<FamilyCustomizeWindow>();
			},
			customize_window_id = "family_customize",
			option_1_get = () => SelectedMetas.selected_family.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_family.data.banner_background_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_family.data.banner_frame_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_family.data.banner_frame_id = pValue;
			},
			option_2_color_editable = false,
			color_get = () => SelectedMetas.selected_family.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_family.data.setColorID(pValue);
			},
			color_library = () => AssetManager.families_colors_library,
			option_1_count = () => AssetManager.family_banners_library.getCurrentAsset().backgrounds.Count,
			option_2_count = () => AssetManager.family_banners_library.getCurrentAsset().frames.Count,
			title_locale = "customize_family",
			option_1_locale = "family_background",
			option_2_locale = "family_frame",
			color_locale = "family_color",
			icon_banner = "iconFamily",
			icon_creature = "iconLivingPlants"
		});
		add(new MetaCustomizationAsset
		{
			id = "language",
			meta_type = MetaType.Language,
			banner_prefab_id = "ui/PrefabBannerLanguage",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				LanguageBanner languageBanner = Object.Instantiate<LanguageBanner>(Resources.Load<LanguageBanner>(pAsset.banner_prefab_id), pParent);
				languageBanner.enable_default_click = false;
				languageBanner.load(pNanoObject as Language);
				return languageBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<LanguageCustomizeWindow>();
			},
			customize_window_id = "language_customize",
			option_1_get = () => SelectedMetas.selected_language.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_language.data.banner_background_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_language.data.banner_icon_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_language.data.banner_icon_id = pValue;
			},
			color_get = () => SelectedMetas.selected_language.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_language.data.setColorID(pValue);
			},
			color_library = () => AssetManager.languages_colors_library,
			option_1_count = () => AssetManager.language_banners_library.getCurrentAsset().backgrounds.Count,
			option_2_count = () => AssetManager.language_banners_library.getCurrentAsset().icons.Count,
			title_locale = "customize_language",
			option_1_locale = "language_background",
			option_2_locale = "language_element",
			color_locale = "language_color",
			icon_banner = "iconLanguage",
			icon_creature = "iconLivingPlants"
		});
		add(new MetaCustomizationAsset
		{
			id = "subspecies",
			meta_type = MetaType.Subspecies,
			banner_prefab_id = "ui/PrefabBannerSubspecies",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				SubspeciesBanner subspeciesBanner = Object.Instantiate<SubspeciesBanner>(Resources.Load<SubspeciesBanner>(pAsset.banner_prefab_id), pParent);
				subspeciesBanner.enable_default_click = false;
				subspeciesBanner.load(pNanoObject as Subspecies);
				return subspeciesBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<SubspeciesCustomizeWindow>();
			},
			customize_window_id = "subspecies_customize",
			option_1_get = () => SelectedMetas.selected_subspecies.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_subspecies.data.banner_background_id = pValue;
			},
			color_get = () => SelectedMetas.selected_subspecies.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_subspecies.data.setColorID(pValue);
			},
			color_library = () => AssetManager.subspecies_colors_library,
			option_1_count = () => AssetManager.subspecies_banners_library.getCurrentAsset().backgrounds.Count,
			option_2_editable = false,
			title_locale = "customize_subspecies",
			option_1_locale = "subspecies_background",
			color_locale = "subspecies_color",
			icon_banner = "iconSubspeciesList",
			icon_creature = "iconLivingPlants"
		});
		add(new MetaCustomizationAsset
		{
			id = "kingdom",
			meta_type = MetaType.Kingdom,
			banner_prefab_id = "ui/PrefabBannerKingdom",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				KingdomBanner kingdomBanner = Object.Instantiate<KingdomBanner>(Resources.Load<KingdomBanner>(pAsset.banner_prefab_id), pParent);
				kingdomBanner.enable_default_click = false;
				kingdomBanner.load(pNanoObject as Kingdom);
				return kingdomBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<KingdomCustomizeWindow>();
			},
			customize_window_id = "kingdom_customize",
			option_1_get = () => SelectedMetas.selected_kingdom.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_kingdom.data.banner_background_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_kingdom.data.banner_icon_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_kingdom.data.banner_icon_id = pValue;
			},
			color_get = () => SelectedMetas.selected_kingdom.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_kingdom.data.setColorID(pValue);
			},
			color_library = () => AssetManager.kingdom_colors_library,
			option_1_count = () => AssetManager.kingdom_banners_library.get(SelectedMetas.selected_kingdom.getActorAsset().banner_id).backgrounds.Count,
			option_2_count = () => AssetManager.kingdom_banners_library.get(SelectedMetas.selected_kingdom.getActorAsset().banner_id).icons.Count,
			title_locale = "customize_kingdom",
			option_1_locale = "banner_design",
			option_2_locale = "banner_emblem",
			color_locale = "kingdom_color",
			icon_banner = "iconCrown",
			icon_creature = "iconBiomass"
		});
		add(new MetaCustomizationAsset
		{
			id = "city",
			meta_type = MetaType.City,
			localization_title = "village",
			option_1_editable = false,
			option_2_editable = false,
			banner_prefab_id = "ui/PrefabBannerCity",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				CityBanner cityBanner = Object.Instantiate<CityBanner>(Resources.Load<CityBanner>(pAsset.banner_prefab_id), pParent);
				cityBanner.enable_default_click = false;
				cityBanner.load(pNanoObject as City);
				return cityBanner;
			},
			customize_window_id = "kingdom_customize"
		});
		add(new MetaCustomizationAsset
		{
			id = "army",
			meta_type = MetaType.Army,
			localization_title = "army",
			option_1_editable = false,
			option_2_editable = false,
			banner_prefab_id = "ui/PrefabBannerArmy",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				ArmyBanner armyBanner = Object.Instantiate<ArmyBanner>(Resources.Load<ArmyBanner>(pAsset.banner_prefab_id), pParent);
				armyBanner.enable_default_click = false;
				armyBanner.load(pNanoObject as Army);
				return armyBanner;
			},
			color_library = () => AssetManager.kingdom_colors_library,
			customize_window_id = "kingdom_customize"
		});
		add(new MetaCustomizationAsset
		{
			id = "clan",
			meta_type = MetaType.Clan,
			banner_prefab_id = "ui/PrefabBannerClan",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				ClanBanner clanBanner = Object.Instantiate<ClanBanner>(Resources.Load<ClanBanner>(pAsset.banner_prefab_id), pParent);
				clanBanner.enable_default_click = false;
				clanBanner.load(pNanoObject as Clan);
				return clanBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<ClanCustomizeWindow>();
			},
			customize_window_id = "clan_customize",
			option_1_get = () => SelectedMetas.selected_clan.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_clan.data.banner_background_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_clan.data.banner_icon_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_clan.data.banner_icon_id = pValue;
			},
			color_get = () => SelectedMetas.selected_clan.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_clan.data.setColorID(pValue);
			},
			color_library = () => AssetManager.clan_colors_library,
			option_1_count = () => AssetManager.clan_banners_library.getCurrentAsset().backgrounds.Count,
			option_2_count = () => AssetManager.clan_banners_library.getCurrentAsset().icons.Count,
			title_locale = "customize_clan",
			option_1_locale = "clan_background",
			option_2_locale = "clan_icon",
			color_locale = "clan_color",
			icon_banner = "iconClan",
			icon_creature = "iconSuperPumpkin"
		});
		add(new MetaCustomizationAsset
		{
			id = "alliance",
			meta_type = MetaType.Alliance,
			banner_prefab_id = "ui/PrefabBannerAlliance",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				AllianceBanner allianceBanner = Object.Instantiate<AllianceBanner>(Resources.Load<AllianceBanner>(pAsset.banner_prefab_id), pParent);
				allianceBanner.enable_default_click = false;
				allianceBanner.load(pNanoObject as Alliance);
				return allianceBanner;
			},
			customize_component = delegate(GameObject pGameObject)
			{
				pGameObject.AddComponent<AllianceCustomizeWindow>();
			},
			customize_window_id = "alliance_customize",
			option_1_get = () => SelectedMetas.selected_alliance.data.banner_background_id,
			option_1_set = delegate(int pValue)
			{
				SelectedMetas.selected_alliance.data.banner_background_id = pValue;
			},
			option_2_get = () => SelectedMetas.selected_alliance.data.banner_icon_id,
			option_2_set = delegate(int pValue)
			{
				SelectedMetas.selected_alliance.data.banner_icon_id = pValue;
			},
			color_get = () => SelectedMetas.selected_alliance.data.color_id,
			color_set = delegate(int pValue)
			{
				SelectedMetas.selected_alliance.data.setColorID(pValue);
			},
			color_library = () => AssetManager.kingdom_colors_library,
			option_1_count = () => World.world.alliances.getBackgroundsList().Length,
			option_2_count = () => World.world.alliances.getIconsList().Length,
			title_locale = "customize_alliance",
			option_1_locale = "alliance_background",
			option_2_locale = "alliance_icon",
			color_locale = "alliance_color",
			icon_banner = "iconAlliance",
			icon_creature = "iconSuperPumpkin"
		});
		add(new MetaCustomizationAsset
		{
			id = "plot",
			meta_type = MetaType.Plot,
			editable = false,
			banner_prefab_id = "ui/PrefabBannerPlot",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				PlotBanner plotBanner = Object.Instantiate<PlotBanner>(Resources.Load<PlotBanner>(pAsset.banner_prefab_id), pParent);
				plotBanner.load(pNanoObject);
				return plotBanner;
			}
		});
		add(new MetaCustomizationAsset
		{
			id = "war",
			meta_type = MetaType.War,
			editable = false,
			banner_prefab_id = "ui/PrefabBannerWar",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				WarBanner warBanner = Object.Instantiate<WarBanner>(Resources.Load<WarBanner>(pAsset.banner_prefab_id), pParent);
				warBanner.load(pNanoObject);
				return warBanner;
			}
		});
		add(new MetaCustomizationAsset
		{
			id = "unit",
			meta_type = MetaType.Unit,
			editable = false,
			banner_prefab_id = "ui/UnitAvatarElement",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				//IL_002d: Unknown result type (might be due to invalid IL or missing references)
				UiUnitAvatarElement uiUnitAvatarElement = Object.Instantiate<UiUnitAvatarElement>(Resources.Load<UiUnitAvatarElement>(pAsset.banner_prefab_id), pParent);
				uiUnitAvatarElement.load(pNanoObject);
				((Component)uiUnitAvatarElement).transform.localScale = new Vector3(0.8f, 0.8f, 0.8f);
				return uiUnitAvatarElement;
			}
		});
		add(new MetaCustomizationAsset
		{
			id = "item",
			meta_type = MetaType.Item,
			editable = false,
			banner_prefab_id = "ui/EquipmentButton",
			get_banner = delegate(MetaCustomizationAsset pAsset, NanoObject pNanoObject, Transform pParent)
			{
				EquipmentButton equipmentButton = Object.Instantiate<EquipmentButton>(Resources.Load<EquipmentButton>(pAsset.banner_prefab_id), pParent);
				equipmentButton.load(pNanoObject);
				return equipmentButton;
			}
		});
		add(new MetaCustomizationAsset
		{
			id = "world",
			meta_type = MetaType.World,
			editable = false,
			option_1_editable = false,
			option_2_editable = false,
			color_editable = false
		});
	}

	public MetaCustomizationAsset getAsset(MetaType pType)
	{
		return get(pType.AsString());
	}

	public override void post_init()
	{
		base.post_init();
		foreach (MetaCustomizationAsset item in list)
		{
			if (item.localization_title == null)
			{
				item.localization_title = item.id;
			}
		}
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (MetaCustomizationAsset tAsset in list)
		{
			if (tAsset.color_count == null)
			{
				tAsset.color_count = () => tAsset.color_library().list.Count;
			}
		}
	}

	public override void editorDiagnostic()
	{
		foreach (MetaCustomizationAsset item in list)
		{
			if (item.editable)
			{
				if (item.color_count == null)
				{
					BaseAssetLibrary.logAssetError("Missing <e>color_count</e>", item.id);
				}
				if (item.option_1_editable && item.option_1_count == null)
				{
					BaseAssetLibrary.logAssetError("Missing <e>option_1_count</e>", item.id);
				}
				if (item.option_2_editable && item.option_2_count == null)
				{
					BaseAssetLibrary.logAssetError("Missing <e>option_2_count</e>", item.id);
				}
			}
		}
		base.editorDiagnostic();
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (MetaCustomizationAsset item in list)
		{
			if (!item.editable)
			{
				continue;
			}
			foreach (string localeID in item.getLocaleIDs())
			{
				checkLocale(item, localeID);
			}
		}
	}
}
// --- End of File: MetaCustomizationLibrary.cs ---



// --- Start of File: MetaCustomizationOptionGet.cs ---
public delegate int MetaCustomizationOptionGet();
// --- End of File: MetaCustomizationOptionGet.cs ---



// --- Start of File: MetaCustomizationOptionSet.cs ---
public delegate void MetaCustomizationOptionSet(int pValue);
// --- End of File: MetaCustomizationOptionSet.cs ---



// --- Start of File: MetaDialogueElement.cs ---
public class MetaDialogueElement : MetaNeedsElementBase
{
	protected override string getText(IMetaObject pMeta, out Actor pActorResult)
	{
		pActorResult = null;
		return MetaTextReportHelper.addSingleUnitTextRandomUnit(pMeta, out pActorResult);
	}
}
// --- End of File: MetaDialogueElement.cs ---



// --- Start of File: MetaGetter.cs ---
public delegate NanoObject MetaGetter(long pId);
// --- End of File: MetaGetter.cs ---



// --- Start of File: MetaHelper.cs ---
public static class MetaHelper
{
	public static void addRandomTrait<TTrait>(ITraitsOwner<TTrait> pMetaObject, BaseTraitLibrary<TTrait> pLibrary) where TTrait : BaseTrait<TTrait>
	{
		int pMinInclusive = 1;
		int pMaxExclusive = 3;
		if (WorldLawLibrary.world_law_glitched_noosphere.isEnabled())
		{
			pMinInclusive = 3;
			pMaxExclusive = 6;
		}
		int num = Randy.randomInt(pMinInclusive, pMaxExclusive);
		for (int i = 0; i < num; i++)
		{
			TTrait randomSpawnTrait = pLibrary.getRandomSpawnTrait();
			if (randomSpawnTrait.isAvailable())
			{
				pMetaObject.addTrait(randomSpawnTrait, pRemoveOpposites: true);
			}
		}
	}
}
// --- End of File: MetaHelper.cs ---



// --- Start of File: MetaIdGetter.cs ---
public delegate long MetaIdGetter(StatisticsAsset pAsset);
// --- End of File: MetaIdGetter.cs ---



// --- Start of File: MetaIncreaseRenown.cs ---
public delegate void MetaIncreaseRenown(int pAmount, MetaObjectData pObjectData);
// --- End of File: MetaIncreaseRenown.cs ---



// --- Start of File: MetaListNoItems.cs ---
using System;
using UnityEngine;

public class MetaListNoItems : MonoBehaviour
{
	private GameObject _inner;

	private IMetaWindow _window;

	protected IMetaObject meta_object => _window.getCoreObject() as IMetaObject;

	private void Awake()
	{
		_inner = ((Component)((Component)this).transform.GetChild(0)).gameObject;
		_window = ((Component)this).GetComponentInParent<IMetaWindow>();
	}

	private void OnEnable()
	{
		_inner.SetActive(!hasMetas());
	}

	protected virtual bool hasMetas()
	{
		throw new NotImplementedException();
	}
}
// --- End of File: MetaListNoItems.cs ---



// --- Start of File: MetaNeedsAndDialogueElement.cs ---
public class MetaNeedsAndDialogueElement : MetaNeedsElementBase
{
	protected override string getText(IMetaObject pMeta, out Actor pActorResult)
	{
		pActorResult = null;
		if (pMeta.countUnits() < 5)
		{
			return string.Empty;
		}
		return MetaTextReportHelper.getText(pMeta, pMeta.getMetaTypeAsset(), out pActorResult);
	}
}
// --- End of File: MetaNeedsAndDialogueElement.cs ---



// --- Start of File: MetaNeedsElementBase.cs ---
using System;
using System.Collections;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class MetaNeedsElementBase : WindowMetaElementBase, IRefreshElement
{
	[SerializeField]
	private GameObject _container;

	[SerializeField]
	private Text _text;

	private Actor _actor;

	private IMetaWindow _window;

	protected override void Awake()
	{
		base.Awake();
		setupTooltip();
		setupClickAction();
		_window = ((Component)this).GetComponentInParent<IMetaWindow>();
	}

	protected override IEnumerator showContent()
	{
		if (_window.getCoreObject() is IMetaObject metaObject && metaObject.isAlive())
		{
			Actor pActorResult;
			string text = getText(metaObject, out pActorResult);
			_text.text = text;
			_actor = pActorResult;
			if (!string.IsNullOrEmpty(text))
			{
				_container.gameObject.SetActive(true);
			}
		}
		yield break;
	}

	protected virtual string getText(IMetaObject pMeta, out Actor pActorResult)
	{
		throw new NotImplementedException();
	}

	private void setupTooltip()
	{
		TipButton tipButton = default(TipButton);
		if (_container.TryGetComponent<TipButton>(ref tipButton))
		{
			tipButton.hoverAction = tooltipAction;
		}
	}

	private void setupClickAction()
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Expected O, but got Unknown
		Button val = default(Button);
		if (_container.TryGetComponent<Button>(ref val))
		{
			((UnityEvent)val.onClick).AddListener(new UnityAction(buttonAction));
		}
	}

	private void tooltipAction()
	{
		if (!_actor.isRekt())
		{
			_actor.showTooltip(this);
		}
	}

	private void buttonAction()
	{
		if (!_actor.isRekt())
		{
			ActionLibrary.openUnitWindow(_actor);
		}
	}

	protected override void clear()
	{
		base.clear();
		_container.gameObject.SetActive(false);
	}
}
// --- End of File: MetaNeedsElementBase.cs ---



// --- Start of File: MetaNeedsElementUnit.cs ---
using System.Collections;
using UnityEngine;
using UnityEngine.UI;

public class MetaNeedsElementUnit : UnitElement
{
	[SerializeField]
	private GameObject _container;

	[SerializeField]
	private Text _text;

	protected override IEnumerator showContent()
	{
		Actor unit = SelectedUnit.unit;
		if (unit != null && unit.isAlive())
		{
			string text = MetaTextReportHelper.addSingleUnitText(unit, pAddGap: false, pAddNameQuote: false);
			_text.text = text;
			if (!string.IsNullOrEmpty(text))
			{
				_container.gameObject.SetActive(true);
			}
		}
		yield break;
	}

	protected override void clear()
	{
		base.clear();
		_container.gameObject.SetActive(false);
	}
}
// --- End of File: MetaNeedsElementUnit.cs ---



// --- Start of File: MetaObject.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public abstract class MetaObject<TData> : CoreSystemObject<TData>, IMetaObject, ICoreObject where TData : MetaObjectData
{
	private bool _units_dirty;

	protected static readonly HashSet<Family> _family_counter = new HashSet<Family>();

	private ColorAsset _cached_color;

	private bool _force_preserve_alive;

	private int _cursor_over;

	private double _timestamp_last_visible = -1.0;

	private Actor _cached_visible_unit;

	private long _cached_visible_unit_id;

	protected virtual bool track_death_types => false;

	public List<Actor> units { get; } = new List<Actor>();


	public MetaTypeAsset meta_type_asset => AssetManager.meta_type_library.getAsset(meta_type);

	public void preserveAlive()
	{
		_force_preserve_alive = true;
	}

	protected override void setDefaultValues()
	{
		base.setDefaultValues();
		_units_dirty = true;
		_force_preserve_alive = true;
	}

	public virtual bool isReadyForRemoval()
	{
		if (_force_preserve_alive)
		{
			return false;
		}
		if (units.Count > 0)
		{
			return false;
		}
		return true;
	}

	internal virtual void clearListUnits()
	{
		_force_preserve_alive = false;
		units.Clear();
	}

	public virtual void listUnit(Actor pActor)
	{
		units.Add(pActor);
	}

	public bool isLocked()
	{
		return isDirtyUnits();
	}

	public bool isDirtyUnits()
	{
		return _units_dirty;
	}

	public void unDirty()
	{
		stats_dirty_version++;
		_units_dirty = false;
	}

	public void setDirty()
	{
		_units_dirty = true;
	}

	public virtual void updateDirty()
	{
	}

	public override void Dispose()
	{
		if (!Config.disable_dispose_logs)
		{
			Debug.Log((object)("MetaObject::Dispose " + data.id + " " + data.name));
		}
		clearListUnits();
		_cached_color = null;
		clearCachedVisibleUnit();
		base.Dispose();
	}

	protected virtual ColorLibrary getColorLibrary()
	{
		throw new NotImplementedException(GetType().Name);
	}

	public override bool updateColor(ColorAsset pColor)
	{
		if (getColor() == pColor)
		{
			return false;
		}
		data.setColorID(getColorLibrary().list.IndexOf(pColor));
		_cached_color = null;
		return true;
	}

	public bool isCursorOver()
	{
		return _cursor_over > 0;
	}

	public void setCursorOver()
	{
		_cursor_over = 3;
	}

	public void clearCursorOver()
	{
		if (_cursor_over > 0)
		{
			_cursor_over--;
		}
	}

	public override ColorAsset getColor()
	{
		if (_cached_color == null)
		{
			_cached_color = getColorLibrary().list[data.color_id];
		}
		return _cached_color;
	}

	public override void trackName(bool pPostChange = false)
	{
		if (!string.IsNullOrEmpty(data.name) && (!pPostChange || (data.past_names != null && data.past_names.Count != 0)))
		{
			BaseSystemData baseSystemData = data;
			if (baseSystemData.past_names == null)
			{
				baseSystemData.past_names = new List<NameEntry>();
			}
			if (data.past_names.Count == 0)
			{
				NameEntry item = new NameEntry(data.name, pCustom: false, data.original_color_id, data.created_time);
				data.past_names.Add(item);
			}
			else if (!(data.past_names.Last().name == data.name))
			{
				NameEntry item2 = new NameEntry(data.name, data.custom_name, data.color_id);
				data.past_names.Add(item2);
			}
		}
	}

	protected virtual void generateNewMetaObject(bool pAddDefaultTraits)
	{
		generateNewMetaObject();
	}

	protected virtual void generateNewMetaObject()
	{
		generateColor();
		generateBanner();
	}

	public virtual void generateBanner()
	{
		throw new NotImplementedException(GetType().Name);
	}

	protected virtual void generateColor()
	{
		ActorAsset actorAsset = getActorAsset();
		int nextColorIndex = getColorLibrary().getNextColorIndex(actorAsset);
		data.setColorID(nextColorIndex);
	}

	public bool isSelected()
	{
		return SelectedObjects.isNanoObjectSelected(this);
	}

	public virtual int countUnits()
	{
		return units.Count;
	}

	public virtual IEnumerable<Actor> getUnits()
	{
		return units;
	}

	public virtual Actor getRandomUnit()
	{
		return Randy.getRandom(units);
	}

	public Actor getRandomActorForReaper()
	{
		foreach (Actor item in units.LoopRandom())
		{
			if (item.isAlive())
			{
				return item;
			}
		}
		return null;
	}

	public virtual int countHappyUnits()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (!unit.asset.is_boat && unit.isHappy())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countUnhappyUnits()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (!unit.asset.is_boat && unit.isUnhappy())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countSingleMales()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isBreedingAge() && unit.isSexMale() && !unit.hasLover())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countCouples()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.hasLover())
			{
				num++;
			}
		}
		return num / 2;
	}

	public virtual int countSingleFemales()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isBreedingAge() && unit.isSexFemale() && !unit.hasLover())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countHoused()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (!unit.asset.is_boat && unit.hasHouse())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countHomeless()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (!unit.asset.is_boat && !unit.hasHouse())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countStarving()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isStarving())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countHungry()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isHungry())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countSick()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isSick())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countAdults()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAlive() && !unit.asset.is_boat && unit.isAdult())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countTotalMoney()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAlive())
			{
				num += unit.money;
			}
		}
		return num;
	}

	public int countPotentialParents(ActorSex pSex)
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAlive() && !unit.asset.is_boat && unit.data.sex == pSex && unit.canBreed() && !unit.hasReachedOffspringLimit())
			{
				num++;
			}
		}
		return num;
	}

	public int countUnitsWithStatus(string pStatusID)
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAlive() && unit.hasStatus(pStatusID))
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countChildren()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (!unit.asset.is_boat && unit.isAlive() && unit.isBaby())
			{
				num++;
			}
		}
		return num;
	}

	public virtual IEnumerable<Family> getFamilies()
	{
		_family_counter.Clear();
		try
		{
			foreach (Actor unit in getUnits())
			{
				if (unit.hasFamily() && _family_counter.Add(unit.family))
				{
					yield return unit.family;
				}
			}
		}
		finally
		{
			_family_counter.Clear();
		}
	}

	public virtual bool hasFamilies()
	{
		foreach (Actor unit in getUnits())
		{
			if (unit.hasFamily())
			{
				return true;
			}
		}
		return false;
	}

	public virtual int countFamilies()
	{
		int num = 0;
		foreach (Family family in getFamilies())
		{
			_ = family;
			num++;
		}
		return num;
	}

	public int countKings()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isKing())
			{
				num++;
			}
		}
		return num;
	}

	public int countLeaders()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isCityLeader())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countMales()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAlive() && unit.isSexMale())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countFemales()
	{
		int num = 0;
		foreach (Actor unit in getUnits())
		{
			if (unit.isAlive() && unit.isSexFemale())
			{
				num++;
			}
		}
		return num;
	}

	public virtual int countPopulationPercentage()
	{
		int num = countUnits();
		int count = World.world.units.Count;
		return (int)((float)num / (float)count * 100f);
	}

	public virtual void increaseDeaths(AttackType pType)
	{
		if (!isAlive())
		{
			return;
		}
		data.total_deaths++;
		if (track_death_types)
		{
			switch (pType)
			{
			case AttackType.Plague:
				data.deaths_plague++;
				break;
			case AttackType.Starvation:
				data.deaths_hunger++;
				break;
			case AttackType.Eaten:
				data.deaths_eaten++;
				break;
			case AttackType.Age:
				data.deaths_natural++;
				break;
			case AttackType.Poison:
				data.deaths_poison++;
				break;
			case AttackType.Infection:
				data.deaths_infection++;
				break;
			case AttackType.Tumor:
				data.deaths_tumor++;
				break;
			case AttackType.Acid:
				data.deaths_acid++;
				break;
			case AttackType.Fire:
				data.deaths_fire++;
				break;
			case AttackType.Divine:
				data.deaths_divine++;
				break;
			case AttackType.Metamorphosis:
				data.metamorphosis++;
				break;
			case AttackType.Weapon:
				data.deaths_weapon++;
				break;
			case AttackType.Gravity:
				data.deaths_gravity++;
				break;
			case AttackType.Drowning:
				data.deaths_drowning++;
				break;
			case AttackType.Water:
				data.deaths_water++;
				break;
			case AttackType.Explosion:
				data.deaths_explosion++;
				break;
			default:
				data.deaths_other++;
				break;
			}
		}
	}

	public virtual void increaseBirths()
	{
		if (isAlive())
		{
			data.total_births++;
		}
	}

	public virtual void increaseKills()
	{
		if (isAlive())
		{
			data.total_kills++;
		}
	}

	private void clearCachedVisibleUnit()
	{
		_cached_visible_unit = null;
		_cached_visible_unit_id = -1L;
		_timestamp_last_visible = -1.0;
	}

	public Actor getOldestVisibleUnitForNameplatesCached()
	{
		if (World.world.getWorldTimeElapsedSince(_timestamp_last_visible) > 5f)
		{
			_cached_visible_unit = null;
		}
		if (!_cached_visible_unit.isRekt() && (!_cached_visible_unit.current_zone.visible_main_centered || _cached_visible_unit.id != _cached_visible_unit_id))
		{
			clearCachedVisibleUnit();
		}
		if (_cached_visible_unit != null)
		{
			return _cached_visible_unit;
		}
		_timestamp_last_visible = World.world.getCurWorldTime();
		_cached_visible_unit = getOldestVisibleUnit();
		if (_cached_visible_unit != null)
		{
			_cached_visible_unit_id = _cached_visible_unit.data.id;
		}
		else
		{
			clearCachedVisibleUnit();
		}
		return _cached_visible_unit;
	}

	public Actor getOldestVisibleUnit()
	{
		Actor actor = null;
		foreach (Actor unit in units)
		{
			if (!unit.asset.is_boat && unit.isAlive() && unit.current_zone.visible_main_centered && (actor == null || unit.data.created_time < actor.data.created_time))
			{
				actor = unit;
			}
		}
		return actor;
	}

	public virtual Sprite getTopicSprite()
	{
		throw new NotImplementedException();
	}

	public long getTotalDeaths()
	{
		return data.total_deaths;
	}

	public long getTotalBirths()
	{
		return data.total_births;
	}

	public long getTotalKills()
	{
		return data.total_kills;
	}

	public long getEvolutions()
	{
		return data.evolutions;
	}

	public void increaseEvolutions()
	{
		data.evolutions++;
	}

	public long getDeaths(AttackType pType)
	{
		switch (pType)
		{
		case AttackType.Plague:
			return data.deaths_plague;
		case AttackType.Starvation:
			return data.deaths_hunger;
		case AttackType.Eaten:
			return data.deaths_eaten;
		case AttackType.Age:
			return data.deaths_natural;
		case AttackType.Poison:
			return data.deaths_poison;
		case AttackType.Infection:
			return data.deaths_infection;
		case AttackType.Tumor:
			return data.deaths_tumor;
		case AttackType.Acid:
			return data.deaths_acid;
		case AttackType.Fire:
			return data.deaths_fire;
		case AttackType.Divine:
			return data.deaths_divine;
		case AttackType.Metamorphosis:
			return data.metamorphosis;
		case AttackType.Weapon:
			return data.deaths_weapon;
		case AttackType.Gravity:
			return data.deaths_gravity;
		case AttackType.Drowning:
			return data.deaths_drowning;
		case AttackType.Water:
			return data.deaths_water;
		case AttackType.Explosion:
			return data.deaths_explosion;
		case AttackType.Other:
		case AttackType.AshFever:
		case AttackType.None:
			return data.deaths_other;
		default:
			throw new ArgumentOutOfRangeException($"Unknown attack type: {pType}");
		}
	}

	public void addRenown(int pAmount)
	{
		data.renown += pAmount;
	}

	public void addRenown(int pAmount, float pPercent)
	{
		int pAmount2 = (int)((float)pAmount * pPercent);
		addRenown(pAmount2);
	}

	public virtual void clearLastYearStats()
	{
	}

	public virtual void convertSameSpeciesAroundUnit(Actor pActorMain, bool pOverrideExisting = false)
	{
		throw new NotImplementedException(GetType().Name);
	}

	public virtual void forceConvertSameSpeciesAroundUnit(Actor pActorMain)
	{
		throw new NotImplementedException(GetType().Name);
	}

	public virtual ActorAsset getActorAsset()
	{
		return null;
	}

	public IEnumerable<Actor> getUnitFromChunkForConversion(Actor pActorMain)
	{
		foreach (Actor item in Finder.getUnitsFromChunk(pActorMain.current_tile, 1))
		{
			if (item.isSameSpecies(pActorMain) && (!item.hasCity() || item.hasSameCity(pActorMain)))
			{
				yield return item;
			}
		}
	}

	public Sprite getSpriteIcon()
	{
		return getActorAsset().getSpriteIcon();
	}

	public void allAngryAt(Actor pActorTarget, float pDistance)
	{
		float num = pDistance * pDistance;
		WorldTile current_tile = pActorTarget.current_tile;
		bool flag = pActorTarget.hasStatus("possessed");
		foreach (Actor unit in getUnits())
		{
			if (unit != pActorTarget && !unit.isRekt() && !((float)Toolbox.SquaredDistTile(unit.current_tile, current_tile) > num) && (!flag || !unit.hasStatus("possessed_follower")))
			{
				unit.addAggro(pActorTarget);
			}
		}
	}

	public virtual bool hasUnits()
	{
		foreach (Actor unit in getUnits())
		{
			if (!unit.isRekt() && !unit.asset.is_boat)
			{
				return true;
			}
		}
		return false;
	}

	public virtual void triggerOnRemoveObject()
	{
	}

	public MetaObjectData getMetaData()
	{
		return data;
	}

	public int getRenown()
	{
		return data.renown;
	}

	public virtual int getPopulationPeople()
	{
		return units.Count;
	}

	public virtual bool hasCities()
	{
		throw new NotImplementedException();
	}

	public virtual IEnumerable<City> getCities()
	{
		throw new NotImplementedException();
	}

	public virtual bool hasKingdoms()
	{
		throw new NotImplementedException();
	}

	public virtual IEnumerable<Kingdom> getKingdoms()
	{
		throw new NotImplementedException();
	}
}
// --- End of File: MetaObject.cs ---



// --- Start of File: MetaObjectCounter.cs ---
public class MetaObjectCounter<TObject, TData> where TObject : MetaObject<TData> where TData : MetaObjectData
{
	public TObject meta_object;

	public int amount;

	public MetaObjectCounter(TObject pMetaObject)
	{
		meta_object = pMetaObject;
	}
}
// --- End of File: MetaObjectCounter.cs ---



// --- Start of File: MetaObjectData.cs ---
using System.ComponentModel;
using Newtonsoft.Json;

public class MetaObjectData : BaseSystemData
{
	[JsonProperty(/*Could not decode attribute arguments.*/)]
	public int color_id { get; set; }

	[DefaultValue(-1)]
	public int original_color_id { get; set; } = -1;


	public long total_deaths { get; set; }

	public long total_births { get; set; }

	public long total_kills { get; set; }

	public long deaths_natural { get; set; }

	public long deaths_hunger { get; set; }

	public long deaths_eaten { get; set; }

	public long deaths_plague { get; set; }

	public long deaths_poison { get; set; }

	public long deaths_infection { get; set; }

	public long deaths_tumor { get; set; }

	public long deaths_acid { get; set; }

	public long deaths_fire { get; set; }

	public long deaths_divine { get; set; }

	public long deaths_weapon { get; set; }

	public long deaths_gravity { get; set; }

	public long deaths_drowning { get; set; }

	public long deaths_water { get; set; }

	public long deaths_explosion { get; set; }

	public long deaths_other { get; set; }

	public long metamorphosis { get; set; }

	public long evolutions { get; set; }

	public int renown { get; set; }

	public void setColorID(int pColorID)
	{
		color_id = pColorID;
		if (original_color_id == -1)
		{
			original_color_id = color_id;
		}
	}
}
// --- End of File: MetaObjectData.cs ---



// --- Start of File: MetaObjectWithTraits.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class MetaObjectWithTraits<TData, TBaseTrait> : MetaObject<TData>, ITraitsOwner<TBaseTrait> where TData : MetaObjectData where TBaseTrait : BaseTrait<TBaseTrait>
{
	private readonly HashSet<TBaseTrait> _traits = new HashSet<TBaseTrait>();

	public readonly BaseStats base_stats = new BaseStats();

	public readonly BaseStats base_stats_meta = new BaseStats();

	private ActorAsset _species_asset;

	public readonly List<BaseAugmentationAsset> all_actions_actor_special_effect = new List<BaseAugmentationAsset>();

	public AttackAction all_actions_actor_attack_target;

	public GetHitAction all_actions_actor_get_hit;

	public WorldAction all_actions_actor_death;

	public WorldAction all_actions_actor_growth;

	public WorldAction all_actions_actor_birth;

	public readonly List<DecisionAsset> decisions_assets = new List<DecisionAsset>();

	public readonly CombatActionHolder combat_actions = new CombatActionHolder();

	public readonly SpellHolder spells = new SpellHolder();

	protected virtual AssetLibrary<TBaseTrait> trait_library
	{
		get
		{
			throw new NotImplementedException(GetType().Name);
		}
	}

	protected virtual List<string> default_traits => null;

	protected virtual List<string> saved_traits => null;

	protected virtual string species_id => "human";

	public override void loadData(TData pData)
	{
		base.loadData(pData);
		loadTraits();
	}

	private void resetStatsAndCallbacks()
	{
		all_actions_actor_death = null;
		all_actions_actor_growth = null;
		all_actions_actor_birth = null;
		all_actions_actor_attack_target = null;
		all_actions_actor_get_hit = null;
		all_actions_actor_special_effect.Clear();
		base_stats.clear();
		base_stats_meta.clear();
		decisions_assets.Clear();
		combat_actions.reset();
		spells.reset();
	}

	public void forceRecalcBaseStats()
	{
		recalcBaseStats();
	}

	protected virtual void recalcBaseStats()
	{
		resetStatsAndCallbacks();
		foreach (TBaseTrait trait in _traits)
		{
			base_stats.mergeStats(trait.base_stats);
			base_stats_meta.mergeStats(trait.base_stats_meta);
			all_actions_actor_death = (WorldAction)Delegate.Combine(all_actions_actor_death, trait.action_death);
			all_actions_actor_growth = (WorldAction)Delegate.Combine(all_actions_actor_growth, trait.action_growth);
			all_actions_actor_birth = (WorldAction)Delegate.Combine(all_actions_actor_birth, trait.action_birth);
			all_actions_actor_attack_target = (AttackAction)Delegate.Combine(all_actions_actor_attack_target, trait.action_attack_target);
			all_actions_actor_get_hit = (GetHitAction)Delegate.Combine(all_actions_actor_get_hit, trait.action_get_hit);
			if (trait.action_special_effect != null)
			{
				all_actions_actor_special_effect.Add(trait);
			}
			if (trait.hasDecisions())
			{
				decisions_assets.AddRange(trait.decisions_assets);
			}
			if (trait.hasCombatActions())
			{
				combat_actions.mergeWith(trait.combat_actions);
			}
			if (!trait.hasSpells())
			{
				continue;
			}
			spells.mergeWith(trait.spells);
			foreach (SpellAsset spell in trait.spells)
			{
				if (spell.hasDecisions())
				{
					decisions_assets.AddRange(spell.decisions_assets);
				}
			}
		}
		setUnitStatsDirty();
	}

	private void setUnitStatsDirty()
	{
		List<Actor> list = base.units;
		int count = list.Count;
		for (int i = 0; i < count; i++)
		{
			list[i].setStatsDirty();
		}
	}

	private void loadTraits()
	{
		if (saved_traits == null)
		{
			return;
		}
		fillTraitAssetsFromStringList(saved_traits);
		foreach (TBaseTrait trait in _traits)
		{
			trait.action_on_augmentation_load?.Invoke(this, trait);
		}
	}

	protected void fillTraitAssetsFromStringList(List<string> pList)
	{
		foreach (string item in pList.LoopRandom())
		{
			TBaseTrait val = trait_library.get(item);
			if (val != null && !hasOppositeTrait(val))
			{
				_traits.Add(val);
			}
		}
		recalcBaseStats();
	}

	protected override void generateNewMetaObject()
	{
		base.generateNewMetaObject();
		if (default_traits != null)
		{
			fillTraitAssetsFromStringList(default_traits);
		}
	}

	protected override void generateNewMetaObject(bool pAddDefaultTraits)
	{
		base.generateNewMetaObject();
		if (default_traits != null && pAddDefaultTraits)
		{
			fillTraitAssetsFromStringList(default_traits);
		}
	}

	public List<string> getTraitsAsStrings()
	{
		return Toolbox.getListForSave(_traits);
	}

	public string getTraitsAsLocalizedString()
	{
		string text = "";
		foreach (TBaseTrait trait in _traits)
		{
			text = text + trait.getTranslatedName() + ", ";
		}
		return text;
	}

	public void copyTraits(IReadOnlyCollection<TBaseTrait> pTraitsToCopy)
	{
		foreach (TBaseTrait item in pTraitsToCopy)
		{
			if (!hasOppositeTrait(item))
			{
				_traits.Add(item);
			}
		}
		recalcBaseStats();
	}

	protected void clearTraits()
	{
		if (_traits.Count != 0)
		{
			_traits.Clear();
		}
	}

	public IReadOnlyCollection<TBaseTrait> getTraits()
	{
		return _traits;
	}

	public void sortTraits(IReadOnlyCollection<TBaseTrait> pTraits)
	{
		if (!_traits.SetEquals(pTraits))
		{
			return;
		}
		_traits.Clear();
		foreach (TBaseTrait pTrait in pTraits)
		{
			_traits.Add(pTrait);
		}
	}

	public virtual void traitModifiedEvent()
	{
	}

	public override void triggerOnRemoveObject()
	{
		base.triggerOnRemoveObject();
		foreach (TBaseTrait trait in _traits)
		{
			trait.action_on_object_remove?.Invoke(this, trait);
		}
	}

	public void removeTrait(string pTraitID)
	{
		TBaseTrait pTrait = trait_library.get(pTraitID);
		removeTrait(pTrait);
	}

	public bool hasTrait(string pTrait)
	{
		TBaseTrait pTrait2 = trait_library.get(pTrait);
		return hasTrait(pTrait2);
	}

	public bool hasMetaTag(string pTag)
	{
		return base_stats_meta.hasTag(pTag);
	}

	public bool hasTraits()
	{
		return _traits.Count > 0;
	}

	public bool hasTrait(TBaseTrait pTrait)
	{
		if (_traits.Contains(pTrait))
		{
			return true;
		}
		return false;
	}

	public void removeTraits(ListPool<string> pTraits)
	{
		bool flag = false;
		foreach (ref string pTrait in pTraits)
		{
			string current = pTrait;
			TBaseTrait val = trait_library.get(current);
			if (_traits.Remove(val))
			{
				val.action_on_augmentation_remove?.Invoke(this, val);
				flag = true;
			}
		}
		if (flag)
		{
			recalcBaseStats();
		}
	}

	public virtual bool removeTrait(TBaseTrait pTrait)
	{
		bool num = _traits.Remove(pTrait);
		if (num)
		{
			pTrait.action_on_augmentation_remove?.Invoke(this, pTrait);
			recalcBaseStats();
		}
		return num;
	}

	private void removeOppositeTraits(TBaseTrait pTrait)
	{
		if (!pTrait.hasOppositeTraits())
		{
			return;
		}
		foreach (TBaseTrait opposite_trait in pTrait.opposite_traits)
		{
			removeTrait(opposite_trait);
		}
	}

	public virtual bool addTrait(string pTraitID, bool pRemoveOpposites = false)
	{
		TBaseTrait val = trait_library.get(pTraitID);
		if (val == null)
		{
			return false;
		}
		return addTrait(val, pRemoveOpposites);
	}

	public virtual bool addTrait(TBaseTrait pTrait, bool pRemoveOpposites = false)
	{
		if (hasTrait(pTrait))
		{
			return false;
		}
		if (pRemoveOpposites)
		{
			removeOppositeTraits(pTrait);
		}
		if (hasOppositeTrait(pTrait))
		{
			return false;
		}
		_traits.Add(pTrait);
		pTrait.action_on_augmentation_add?.Invoke(this, pTrait);
		recalcBaseStats();
		return true;
	}

	public override Sprite getTopicSprite()
	{
		if (_traits.Count == 0)
		{
			return null;
		}
		return _traits.GetRandom().getSprite();
	}

	internal bool hasOppositeTrait(TBaseTrait pTrait)
	{
		return pTrait.hasOppositeTrait(_traits);
	}

	public override ActorAsset getActorAsset()
	{
		if (_species_asset == null)
		{
			string pID = species_id;
			_species_asset = AssetManager.actor_library.get(pID);
		}
		return _species_asset;
	}

	public bool isSameActorAsset(ActorAsset pAsset)
	{
		return getActorAsset() == pAsset;
	}

	public void addRandomTraitFromBiome<T>(WorldTile pTile, List<string> pTraitList, AssetLibrary<T> pTraitLibrary) where T : BaseTrait<TBaseTrait>
	{
		if (!pTile.Type.is_biome || pTraitList == null || pTraitList.Count == 0)
		{
			return;
		}
		int count = pTraitList.Count;
		for (int i = 0; i < count; i++)
		{
			if (!Randy.randomBool())
			{
				string random = pTraitList.GetRandom();
				Asset asset = pTraitLibrary.get(random);
				addTrait((TBaseTrait)asset, pRemoveOpposites: true);
			}
		}
	}

	public void addTraitFromBiome<T>(WorldTile pTile, List<string> pTraitList, AssetLibrary<T> pTraitLibrary) where T : BaseTrait<TBaseTrait>
	{
		if (pTile.Type.is_biome && pTraitList != null && pTraitList.Count != 0)
		{
			for (int i = 0; i < pTraitList.Count; i++)
			{
				Asset asset = pTraitLibrary.get(pTraitList[i]);
				addTrait((TBaseTrait)asset, pRemoveOpposites: true);
			}
		}
	}

	public TBaseTrait getTraitForBook()
	{
		IReadOnlyCollection<TBaseTrait> traits = getTraits();
		using ListPool<TBaseTrait> listPool = new ListPool<TBaseTrait>(traits.Count);
		foreach (TBaseTrait item in traits)
		{
			if (item.can_be_in_book)
			{
				listPool.Add(item);
			}
		}
		if (listPool.Count == 0)
		{
			return null;
		}
		return listPool.GetRandom();
	}

	public override void Dispose()
	{
		_species_asset = null;
		clearTraits();
		resetStatsAndCallbacks();
		base.Dispose();
	}
}
// --- End of File: MetaObjectWithTraits.cs ---



// --- Start of File: MetaRepresentationAsset.cs ---
using System;
using System.ComponentModel;

[Serializable]
public class MetaRepresentationAsset : Asset, ILocalizedAsset
{
	public MetaType meta_type;

	public string title_locale;

	public IconPathGetter icon_getter;

	public CheckActorHasMeta check_has_meta;

	public GetMetaFromActor meta_getter;

	public GetMetaTotalFromActor meta_getter_total;

	public GetWorldUnits world_units_getter;

	public string general_icon_path;

	public bool show_none_percent;

	[DefaultValue(true)]
	public bool show_none_percent_for_total = true;

	[DefaultValue(true)]
	public bool show_species_icon = true;

	public string getLocaleID()
	{
		return title_locale;
	}
}
// --- End of File: MetaRepresentationAsset.cs ---



// --- Start of File: MetaRepresentationContainer.cs ---
using System.Collections.Generic;
using UnityEngine;

public class MetaRepresentationContainer : MetaRepresentationContainerBase
{
	private IMetaWindow _meta_window;

	protected override void init()
	{
		base.init();
		_meta_window = ((Component)this).GetComponentInParent<IMetaWindow>();
	}

	protected override void fillDict(ref int pTotal, ref bool pAny, Dictionary<IMetaObject, int> pDict)
	{
		foreach (Actor unit in getMetaObject().getUnits())
		{
			pTotal++;
			if (asset.check_has_meta(unit))
			{
				pAny = true;
				IMetaObject key = asset.meta_getter(unit);
				if (!pDict.ContainsKey(key))
				{
					pDict.Add(key, 0);
				}
				pDict[key]++;
			}
		}
	}

	protected override void checkShowNone(bool pAny, int pNone, int pTotal)
	{
		if (pAny && asset.show_none_percent && pNone > 0)
		{
			string pValue = amountWithPercent(pNone, pTotal);
			KeyValueField pField = showStatRow("statistics_breakdown_none", pValue, ColorStyleLibrary.m.color_text_grey, MetaType.None, -1L, pColorText: true, asset.general_icon_path);
			showBar(pField, pNone, pTotal, ColorStyleLibrary.m.color_text_grey);
		}
	}

	private IMetaObject getMetaObject()
	{
		return _meta_window.getCoreObject() as IMetaObject;
	}
}
// --- End of File: MetaRepresentationContainer.cs ---



// --- Start of File: MetaRepresentationContainerBase.cs ---
using System;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;
using UnityEngine.UI;
using UnityPools;

public class MetaRepresentationContainerBase : StatsRowsContainer
{
	[SerializeField]
	protected MetaType _meta_type;

	[SerializeField]
	private LocalizedText _title;

	[SerializeField]
	private Image _background;

	[SerializeField]
	private Image _prefab_bar;

	[SerializeField]
	private LayoutElement _layout_element;

	protected MetaRepresentationAsset asset;

	protected override void init()
	{
		base.init();
		asset = AssetManager.meta_representation_library.getAsset(_meta_type);
		((Component)_prefab_bar).gameObject.SetActive(false);
		_title.setKeyAndUpdate(asset.getLocaleID());
	}

	protected override void showStats()
	{
		int pTotal = 0;
		bool pAny = false;
		Dictionary<IMetaObject, int> dictionary = UnsafeCollectionPool<Dictionary<IMetaObject, int>, KeyValuePair<IMetaObject, int>>.Get();
		fillDict(ref pTotal, ref pAny, dictionary);
		int num = pTotal;
		foreach (KeyValuePair<IMetaObject, int> item in dictionary.OrderByDescending((KeyValuePair<IMetaObject, int> p) => p.Value))
		{
			IMetaObject key = item.Key;
			int value = item.Value;
			num -= value;
			string pValue = amountWithPercent(value, pTotal);
			string pIconPath = asset.icon_getter(key);
			string pIconSecondaryPath = (asset.show_species_icon ? key.getActorAsset().icon : null);
			string name = key.name;
			name += Toolbox.coloredGreyPart(value, key.getColor().color_text);
			KeyValueField pField = showStatRowTwoIcons(name, pValue, key.getColor().color_text, asset.meta_type, key.getID(), pColorText: true, pIconPath, pIconSecondaryPath, null, null, pLocalize: false);
			showBar(pField, value, pTotal, key.getColor().color_text);
		}
		checkShowNone(pAny, num, pTotal);
		UnsafeCollectionPool<Dictionary<IMetaObject, int>, KeyValuePair<IMetaObject, int>>.Release(dictionary);
		_layout_element.ignoreLayout = !pAny;
		((Behaviour)_background).enabled = pAny;
		((Component)_title).gameObject.SetActive(pAny);
	}

	protected virtual void fillDict(ref int pTotal, ref bool pAny, Dictionary<IMetaObject, int> pDict)
	{
		throw new NotImplementedException();
	}

	protected virtual void checkShowNone(bool pAny, int pNone, int pTotal)
	{
		throw new NotImplementedException();
	}

	protected void showBar(KeyValueField pField, int pAmount, int pTotal, string pColorHex)
	{
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		float num = ((pTotal > 0) ? ((float)pAmount / (float)pTotal) : 0f);
		Transform obj = ((Component)pField).transform.Find("gen_percent_bar");
		Image val = ((obj != null) ? ((Component)obj).GetComponent<Image>() : null);
		if ((Object)(object)val == (Object)null)
		{
			val = Object.Instantiate<GameObject>(((Component)_prefab_bar).gameObject, ((Component)pField).transform).GetComponent<Image>();
			((Component)val).gameObject.SetActive(true);
			((Object)val).name = "gen_percent_bar";
		}
		float num2 = 100f * num * 0.5f;
		Vector2 sizeDelta = default(Vector2);
		((Vector2)(ref sizeDelta))._002Ector(num2, 8.5f);
		((Component)val).GetComponent<RectTransform>().sizeDelta = sizeDelta;
		((Component)val).GetComponent<RectTransform>().anchoredPosition = new Vector2(-2f, 0f);
		((Component)val).transform.SetAsFirstSibling();
		Color color = Toolbox.makeColor(pColorHex);
		color.a = 0.4f;
		((Graphic)val).color = color;
	}

	protected string amountWithPercent(int pAmount, int pTotal)
	{
		float pFloat = ((pTotal > 0) ? ((float)pAmount / (float)pTotal * 100f) : 0f);
		if (pTotal == pAmount)
		{
			pFloat = 100f;
		}
		return pFloat.ToText() + "%";
	}

	internal KeyValueField showStatRowTwoIcons(string pId, object pValue, string pColor, MetaType pMetaType = MetaType.None, long pMetaId = -1L, bool pColorText = false, string pIconPath = null, string pIconSecondaryPath = null, string pTooltipId = null, TooltipDataGetter pTooltipData = null, bool pLocalize = true)
	{
		KeyValueField keyValueField = showStatRow(pId, pValue, pColor, pMetaType, pMetaId, pColorText, pIconPath, pTooltipId, pTooltipData, pLocalize);
		bool flag = !string.IsNullOrEmpty(pIconSecondaryPath);
		if (flag)
		{
			Sprite sprite = SpriteTextureLoader.getSprite("ui/Icons/" + pIconSecondaryPath);
			keyValueField.icon_secondary.sprite = sprite;
		}
		((Component)keyValueField.icon_secondary).gameObject.SetActive(flag);
		return keyValueField;
	}

	public void setMetaType(MetaType pType)
	{
		_meta_type = pType;
	}
}
// --- End of File: MetaRepresentationContainerBase.cs ---



// --- Start of File: MetaRepresentationLibrary.cs ---
public class MetaRepresentationLibrary : AssetLibrary<MetaRepresentationAsset>
{
	public override void init()
	{
		base.init();
		add(new MetaRepresentationAsset
		{
			id = "alliance",
			meta_type = MetaType.Alliance,
			title_locale = "statistics_breakdown_alliances",
			icon_getter = (IMetaObject _) => "iconAlliance",
			check_has_meta = (Actor pActor) => pActor.hasKingdom() && pActor.kingdom.isCiv() && pActor.kingdom.hasAlliance(),
			meta_getter = (Actor pActor) => pActor.kingdom.getAlliance(),
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.kingdom.getAlliance() },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconAlliance",
			show_species_icon = false
		});
		add(new MetaRepresentationAsset
		{
			id = "army",
			meta_type = MetaType.Army,
			title_locale = "statistics_breakdown_armies",
			icon_getter = (IMetaObject _) => "iconArmy",
			check_has_meta = (Actor pActor) => pActor.hasArmy(),
			meta_getter = (Actor pActor) => pActor.city.getArmy(),
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.city.getArmy() },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconArmy"
		});
		add(new MetaRepresentationAsset
		{
			id = "city",
			meta_type = MetaType.City,
			title_locale = "statistics_breakdown_cities",
			icon_getter = (IMetaObject _) => "iconCity",
			check_has_meta = (Actor pActor) => pActor.hasCity(),
			meta_getter = (Actor pActor) => pActor.city,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.city },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconCity"
		});
		add(new MetaRepresentationAsset
		{
			id = "clan",
			meta_type = MetaType.Clan,
			title_locale = "statistics_breakdown_clans",
			icon_getter = (IMetaObject _) => "iconClan",
			check_has_meta = (Actor pActor) => pActor.hasClan(),
			meta_getter = (Actor pActor) => pActor.clan,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.clan },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconClan"
		});
		add(new MetaRepresentationAsset
		{
			id = "culture",
			meta_type = MetaType.Culture,
			title_locale = "statistics_breakdown_cultures",
			icon_getter = (IMetaObject _) => "iconCulture",
			check_has_meta = (Actor pActor) => pActor.hasCulture(),
			meta_getter = (Actor pActor) => pActor.culture,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.culture },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconCulture",
			show_none_percent = true
		});
		add(new MetaRepresentationAsset
		{
			id = "kingdom",
			meta_type = MetaType.Kingdom,
			title_locale = "statistics_breakdown_kingdoms",
			icon_getter = (IMetaObject _) => "iconKingdom",
			check_has_meta = (Actor pActor) => pActor.hasKingdom() && pActor.kingdom.isCiv(),
			meta_getter = (Actor pActor) => pActor.kingdom,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.kingdom },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconKingdom"
		});
		add(new MetaRepresentationAsset
		{
			id = "language",
			meta_type = MetaType.Language,
			title_locale = "statistics_breakdown_languages",
			icon_getter = (IMetaObject _) => "iconLanguage",
			check_has_meta = (Actor pActor) => pActor.hasLanguage(),
			meta_getter = (Actor pActor) => pActor.language,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.language },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconLanguage",
			show_none_percent = true
		});
		add(new MetaRepresentationAsset
		{
			id = "religion",
			meta_type = MetaType.Religion,
			title_locale = "statistics_breakdown_religions",
			icon_getter = (IMetaObject _) => "iconReligion",
			check_has_meta = (Actor pActor) => pActor.hasReligion(),
			meta_getter = (Actor pActor) => pActor.religion,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.religion },
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconReligion",
			show_none_percent = true
		});
		add(new MetaRepresentationAsset
		{
			id = "subspecies",
			meta_type = MetaType.Subspecies,
			title_locale = "statistics_breakdown_subspecies",
			icon_getter = (IMetaObject pMeta) => pMeta.getActorAsset().icon,
			check_has_meta = (Actor pActor) => pActor.hasSubspecies(),
			meta_getter = (Actor pActor) => pActor.subspecies,
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject> { pActor.subspecies },
			world_units_getter = () => World.world.units.units_only_alive,
			general_icon_path = "iconSubspecies",
			show_species_icon = false,
			show_none_percent_for_total = false
		});
		add(new MetaRepresentationAsset
		{
			id = "war",
			meta_type = MetaType.War,
			title_locale = "statistics_breakdown_wars",
			icon_getter = (IMetaObject _) => "iconWar",
			check_has_meta = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom() || !pActor.kingdom.isCiv())
				{
					return false;
				}
				foreach (War war in pActor.kingdom.getWars())
				{
					if (!war.hasEnded())
					{
						return true;
					}
				}
				return false;
			},
			meta_getter_total = (Actor pActor) => new ListPool<IMetaObject>(pActor.kingdom.getWars()),
			world_units_getter = () => World.world.units.units_only_civ,
			general_icon_path = "iconWar",
			show_species_icon = false
		});
	}

	public MetaRepresentationAsset getAsset(MetaType pType)
	{
		return get(pType.AsString());
	}

	public bool hasAsset(MetaType pType)
	{
		return has(pType.AsString());
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (MetaRepresentationAsset item in list)
		{
			checkLocale(item, item.title_locale);
		}
	}
}
// --- End of File: MetaRepresentationLibrary.cs ---



// --- Start of File: MetaRepresentationTotal.cs ---
using System.Collections.Generic;

public class MetaRepresentationTotal : MetaRepresentationContainerBase
{
	protected override void fillDict(ref int pTotal, ref bool pAny, Dictionary<IMetaObject, int> pDict)
	{
		List<Actor> list = asset.world_units_getter();
		pTotal = list.Count;
		foreach (Actor item in list)
		{
			if (!asset.check_has_meta(item))
			{
				if (!asset.show_none_percent_for_total)
				{
					pTotal--;
				}
				continue;
			}
			pAny = true;
			using ListPool<IMetaObject> listPool = asset.meta_getter_total(item);
			foreach (ref IMetaObject item2 in listPool)
			{
				IMetaObject current2 = item2;
				if (!pDict.ContainsKey(current2))
				{
					pDict.Add(current2, 0);
				}
				pDict[current2]++;
			}
		}
	}

	protected override void checkShowNone(bool pAny, int pNone, int pTotal)
	{
		if (asset.show_none_percent_for_total && pAny && pNone > 0)
		{
			string text = "statistics_breakdown_none_list".Localize();
			text += Toolbox.coloredGreyPart(pNone, ColorStyleLibrary.m.color_text_grey);
			string pValue = amountWithPercent(pNone, pTotal);
			KeyValueField pField = showStatRow(text, pValue, ColorStyleLibrary.m.color_text_grey, MetaType.None, -1L, pColorText: true, asset.general_icon_path, null, null, pLocalize: false);
			showBar(pField, pNone, pTotal, ColorStyleLibrary.m.color_text_grey);
		}
	}
}
// --- End of File: MetaRepresentationTotal.cs ---



// --- Start of File: MetaSelectedGetter.cs ---
public delegate NanoObject MetaSelectedGetter();
// --- End of File: MetaSelectedGetter.cs ---



// --- Start of File: MetaSelectedSetter.cs ---
public delegate void MetaSelectedSetter(NanoObject pElement);
// --- End of File: MetaSelectedSetter.cs ---



// --- Start of File: MetaSpriteSwitcher.cs ---
public class MetaSpriteSwitcher : SpriteSwitcher
{
	public MetaType meta_type;

	protected override bool hasAny()
	{
		return AssetManager.meta_type_library.getAsset(meta_type).has_any();
	}
}
// --- End of File: MetaSpriteSwitcher.cs ---



// --- Start of File: MetaStatAction.cs ---
using UnityEngine;

public delegate void MetaStatAction(long pMetaId, MonoBehaviour pField);
// --- End of File: MetaStatAction.cs ---



// --- Start of File: MetaSwitchButton.cs ---
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class MetaSwitchButton : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	public Button button;

	public Text meta_name;

	public Transform banner_parent;

	private IBanner _banner;

	private MultiBannerPool _pool;

	private MetaSwitchManager.Direction _direction;

	public void init(MetaSwitchManager.Direction pDirection, SwitchWindowsAction pAction)
	{
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Expected O, but got Unknown
		_direction = pDirection;
		_pool = new MultiBannerPool(banner_parent);
		((UnityEvent)button.onClick).AddListener((UnityAction)delegate
		{
			pAction(_direction);
		});
	}

	public void setBanner(IBanner pBanner)
	{
		_banner = pBanner;
	}

	public MultiBannerPool getPool()
	{
		return _pool;
	}

	public void clear()
	{
		_pool.clear();
	}

	public void OnPointerEnter(PointerEventData pEventData)
	{
		if (InputHelpers.mouseSupported)
		{
			showTooltip();
		}
	}

	public void OnPointerExit(PointerEventData pEventData)
	{
		if (InputHelpers.mouseSupported)
		{
			Tooltip.hideTooltip();
		}
	}

	private void showTooltip()
	{
		if (MetaSwitchManager.isSwitcherEnabled())
		{
			_banner.meta_type_asset.stat_hover(_banner.GetNanoObject().getID(), (MonoBehaviour)(object)this);
		}
	}
}
// --- End of File: MetaSwitchButton.cs ---



// --- Start of File: MetaSwitchManager.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.UI;

public class MetaSwitchManager : MonoBehaviour
{
	public enum Direction
	{
		Left,
		Right
	}

	private const float POSITION_SHOW = 0f;

	private const float POSITION_HIDE = -44f;

	private const float WINDOW_MAX_SIZE_PERCENT = 100f;

	private const float WINDOW_SIZE_PORTRAIT_START = 100f;

	private const float WINDOW_SIZE_PORTRAIT_END = 115f;

	private const float WINDOW_SIZE_PORTRAIT_RATIO_MIN = 1.275f;

	private const float WINDOW_SIZE_PORTRAIT_RATIO_MAX = 1.45f;

	private const float ANIMATION_DURATION = 0.35f;

	[SerializeField]
	private MetaSwitchButton _button_left;

	[SerializeField]
	private MetaSwitchButton _button_right;

	[SerializeField]
	private Text _window_number_current;

	[SerializeField]
	private Text _window_number_total;

	[SerializeField]
	private GameObject _container;

	private StatsWindow _stats_window;

	private MetaTypeAsset _meta_type_asset;

	private ListPool<NanoObject> _list;

	private static MetaSwitchManager _instance;

	private bool _is_switching_enabled;

	private bool _was_just_opened;

	private bool _is_enabled;

	private Tweener _tweener;

	private void Awake()
	{
		_instance = this;
		ScrollWindow.addCallbackOpen(delegate
		{
			_was_just_opened = true;
			enable(pOpen: true);
		});
		ScrollWindow.addCallbackShow(delegate
		{
			if (_was_just_opened)
			{
				_was_just_opened = false;
			}
			else
			{
				enable(pOpen: false);
			}
		});
		ScrollWindow.addCallbackClose(delegate
		{
			disable();
		});
		_button_left.init(Direction.Left, switchWindowsWithCheck);
		_button_right.init(Direction.Right, switchWindowsWithCheck);
	}

	private void Start()
	{
		CanvasMain.instance.addCallbackResize(delegate
		{
			if (!_is_enabled)
			{
				enable(pOpen: false, pCompleteOnDisable: false);
			}
			else
			{
				refresh(pCompleteTween: false, pCompleteOnDisable: false);
			}
		});
	}

	private void enable(bool pOpen, bool pCompleteOnDisable = true)
	{
		_is_enabled = true;
		ScrollWindow currentWindow = ScrollWindow.getCurrentWindow();
		StatsWindow statsWindow = ((currentWindow != null) ? ((Component)currentWindow).GetComponent<StatsWindow>() : null);
		if ((Object)(object)statsWindow == (Object)(object)_stats_window && (Object)(object)_stats_window != (Object)null)
		{
			updateShowingData();
			return;
		}
		if ((Object)(object)statsWindow == (Object)null)
		{
			disable(!pOpen);
			return;
		}
		_stats_window = statsWindow;
		_meta_type_asset = AssetManager.meta_type_library.getAsset(_stats_window.meta_type);
		refresh(pCompleteTween: true, pCompleteOnDisable);
	}

	private void disable(bool pAnimated = true, bool pCompleteTween = true)
	{
		_is_enabled = false;
		if (pAnimated)
		{
			toggleControlsPosition(pState: false, pCompleteTween);
		}
		else
		{
			toggleControls(pState: false);
		}
		_stats_window = null;
		_list?.Dispose();
		_list = null;
	}

	public static void checkAndRefresh()
	{
		_instance.checkRefresh();
	}

	public static void refresh()
	{
		_instance.refresh(pCompleteTween: true, pCompleteOnDisable: true);
	}

	public static void refreshWithoutComplete()
	{
		_instance.refresh(pCompleteTween: false);
	}

	private void checkRefresh()
	{
		if (_is_enabled)
		{
			refresh(pCompleteTween: false);
		}
	}

	internal void refresh(bool pCompleteTween = true, bool pCompleteOnDisable = true)
	{
		int optionInt = PlayerConfig.getOptionInt("ui_size_windows");
		if ((float)optionInt > 100f)
		{
			float num = Mathf.Lerp(1.275f, 1.45f, 1f - Mathf.InverseLerp(100f, 115f, (float)optionInt));
			float num2 = (float)Screen.width / (float)Screen.height * num;
			if ((float)optionInt * num2 > 100f)
			{
				disable(pAnimated: true, pCompleteOnDisable);
				return;
			}
		}
		_list?.Dispose();
		_list = _meta_type_asset.getSortedList();
		bool flag = (_is_switching_enabled = _list.Count >= 2);
		toggleControlsPosition(flag, pCompleteTween);
		if (flag)
		{
			updateShowingData();
		}
	}

	private static void switchWindowsWithCheck(Direction pDirection)
	{
		if (ScrollWindow.isWindowActive() && !ScrollWindow.isAnimationActive())
		{
			switchWindows(pDirection);
		}
	}

	public static void switchWindows(Direction pDirection)
	{
		_instance.switchWindow(pDirection);
	}

	private int getCurrentMetaIndex()
	{
		NanoObject item = _meta_type_asset.get_selected();
		int num = _list.IndexOf(item);
		if (num == -1)
		{
			_list.Add(item);
			num = _list.IndexOf(item);
		}
		return num;
	}

	private void switchWindow(Direction pDirection)
	{
		if (_is_switching_enabled && !((Object)(object)_stats_window == (Object)null) && _list.Count >= 2)
		{
			NanoObject element = getElement(pDirection);
			_meta_type_asset.set_selected(element);
			WindowHistory.popHistory();
			ScrollWindow.showWindow(_meta_type_asset.window_name);
			updateShowingData();
		}
	}

	private void updateShowingData()
	{
		updateWindowNumber();
		showBannersAndNames();
	}

	private void updateWindowNumber()
	{
		if (_list == null)
		{
			_window_number_current.text = "";
			_window_number_total.text = "";
			return;
		}
		int num = getCurrentMetaIndex() + 1;
		int count = _list.Count;
		_window_number_current.text = $"{num}";
		_window_number_total.text = $"{count}";
	}

	private void showBannersAndNames()
	{
		clear();
		showBanner(getIndex(Direction.Left), _button_left);
		showBanner(getIndex(Direction.Right), _button_right);
	}

	private IBanner showBanner(int pIndex, MetaSwitchButton pButton)
	{
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		NanoObject nanoObject = _list[pIndex];
		IBanner next = pButton.getPool().getNext(nanoObject);
		next.load(nanoObject);
		Button val = default(Button);
		if (next.gameObject.TryGetComponent<Button>(ref val))
		{
			((Behaviour)val).enabled = false;
		}
		pButton.setBanner(next);
		Transform transform = next.transform;
		Transform parent = transform.parent;
		parent.localPosition = Vector3.zero;
		parent.localScale = Vector3.one;
		transform.localPosition = Vector3.zero;
		ColorAsset color = nanoObject.getColor();
		if (color != null)
		{
			string color_text = color.color_text;
			pButton.meta_name.text = nanoObject.name.ColorHex(color_text);
		}
		return next;
	}

	private void toggleControlsPosition(bool pState, bool pCompleteTween = true)
	{
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Expected O, but got Unknown
		TweenExtensions.Kill((Tween)(object)_tweener, pCompleteTween);
		float num = (pState ? 0f : (-44f));
		if (pState)
		{
			toggleControls(pState: true);
		}
		if (Mathf.Approximately(((Component)this).transform.localPosition.y, num))
		{
			return;
		}
		_tweener = (Tweener)(object)TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMoveY(((Component)this).transform, num, 0.35f, false), (Ease)10), (TweenCallback)delegate
		{
			if (!pState)
			{
				toggleControls(pState: false);
			}
			checkRefresh();
		});
	}

	private void toggleControls(bool pState)
	{
		_container.SetActive(pState);
	}

	private void clear()
	{
		_button_left.clear();
		_button_right.clear();
	}

	private NanoObject getElement(Direction pDirection)
	{
		int index = getIndex(pDirection);
		return _list[index];
	}

	private int getIndex(Direction pDirection)
	{
		int currentMetaIndex = getCurrentMetaIndex();
		return Toolbox.loopIndex((pDirection == Direction.Left) ? (currentMetaIndex - 1) : (currentMetaIndex + 1), _list.Count);
	}

	public static bool isAnimationActive()
	{
		return TweenExtensions.IsActive((Tween)(object)_instance._tweener);
	}

	public static bool isSwitcherEnabled()
	{
		return _instance._is_enabled;
	}

	public static MetaSwitchButton getLeftbutton()
	{
		return _instance._button_left;
	}

	public static MetaSwitchButton getRightButton()
	{
		return _instance._button_right;
	}
}
// --- End of File: MetaSwitchManager.cs ---



// --- Start of File: MetaSystemManager.cs ---
using System;
using System.Collections.Generic;
using db;
using db.tables;

public abstract class MetaSystemManager<TObject, TData> : CoreSystemManager<TObject, TData> where TObject : MetaObject<TData>, new() where TData : MetaObjectData, new()
{
	private bool _dirty_units;

	protected Dictionary<TObject, MetaObjectCounter<TObject, TData>> _counters_dict = new Dictionary<TObject, MetaObjectCounter<TObject, TData>>();

	protected List<MetaObjectCounter<TObject, TData>> _counters_list = new List<MetaObjectCounter<TObject, TData>>();

	private List<TObject> _to_remove = new List<TObject>();

	protected void countMetaObject(TObject pMetaObject)
	{
		if (!_counters_dict.TryGetValue(pMetaObject, out var value))
		{
			value = new MetaObjectCounter<TObject, TData>(pMetaObject);
			_counters_dict.Add(pMetaObject, value);
			_counters_list.Add(value);
		}
		_counters_dict[pMetaObject].amount++;
	}

	protected TObject getMostUsedMetaObject()
	{
		if (!_counters_list.Any())
		{
			return null;
		}
		_counters_list.Sort(sortByAmount);
		TObject meta_object = _counters_list[0].meta_object;
		clearCounters();
		return meta_object;
	}

	private int sortByAmount(MetaObjectCounter<TObject, TData> pO1, MetaObjectCounter<TObject, TData> pO2)
	{
		return pO2.amount.CompareTo(pO1.amount);
	}

	private void clearCounters()
	{
		_counters_dict.Clear();
		_counters_list.Clear();
	}

	public override void parallelDirtyUnitsCheck()
	{
		beginChecksUnits();
	}

	public void beginChecksUnits()
	{
		if (_dirty_units)
		{
			clearAllUnitLists();
			updateDirtyUnits();
			finishDirtyUnits();
		}
	}

	public override void startCollectHistoryData()
	{
		HistoryMetaDataAsset historyMetaDataAsset = AssetManager.history_meta_data_library.get(type_id);
		if (historyMetaDataAsset.collector == null)
		{
			return;
		}
		using IEnumerator<TObject> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			TObject current = enumerator.Current;
			Delegate[] invocationList = historyMetaDataAsset.collector.GetInvocationList();
			for (int i = 0; i < invocationList.Length; i++)
			{
				HistoryTable obj = ((HistoryDataCollector)invocationList[i])(current);
				obj.timestamp = World.world.map_stats.history_current_year;
				DBInserter.insertData(obj, type_id);
			}
		}
	}

	public override void clearLastYearStats()
	{
		using IEnumerator<TObject> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.clearLastYearStats();
		}
	}

	public override bool isUnitsDirty()
	{
		return _dirty_units;
	}

	protected virtual void finishDirtyUnits()
	{
		_dirty_units = false;
		using IEnumerator<TObject> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			TObject current = enumerator.Current;
			if (current.isDirtyUnits())
			{
				current.unDirty();
			}
		}
	}

	public override void checkDeadObjects()
	{
		base.checkDeadObjects();
		using (IEnumerator<TObject> enumerator = GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				TObject current = enumerator.Current;
				if (current.isReadyForRemoval())
				{
					_to_remove.Add(current);
				}
			}
		}
		foreach (TObject item in _to_remove)
		{
			item.triggerOnRemoveObject();
			removeObject(item);
		}
		_to_remove.Clear();
	}

	protected abstract void updateDirtyUnits();

	public virtual void unitDied(TObject pObject)
	{
		setDirtyUnits(pObject);
	}

	public virtual void unitAdded(TObject pObject)
	{
		setDirtyUnits(pObject);
	}

	protected override void addObject(TObject pObject)
	{
		base.addObject(pObject);
		setDirtyUnits(pObject);
	}

	public void setDirtyUnits(TObject pObject)
	{
		pObject?.setDirty();
		_dirty_units = true;
	}

	private void clearAllUnitLists()
	{
		using IEnumerator<TObject> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			TObject current = enumerator.Current;
			if (current.isDirtyUnits())
			{
				current.clearListUnits();
			}
		}
	}
}
// --- End of File: MetaSystemManager.cs ---



// --- Start of File: MetaTextReportAction.cs ---
public delegate bool MetaTextReportAction(IMetaObject pMetaObject);
// --- End of File: MetaTextReportAction.cs ---



// --- Start of File: MetaTextReportAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class MetaTextReportAsset : Asset, IMultiLocalesAsset
{
	public MetaTextReportAction report_action;

	public string color;

	public int amount = 5;

	internal string get_locale_id => "meta_report_" + id + "_";

	internal string get_random_text
	{
		get
		{
			int num = Randy.randomInt(0, amount);
			return LocalizedTextManager.getText($"{get_locale_id}{num}");
		}
	}

	public IEnumerable<string> getLocaleIDs()
	{
		for (int i = 0; i < amount; i++)
		{
			yield return $"{get_locale_id}{i}";
		}
	}
}
// --- End of File: MetaTextReportAsset.cs ---



// --- Start of File: MetaTextReportHelper.cs ---
public class MetaTextReportHelper
{
	public static string color_text_main => ColorStyleLibrary.m.color_text_grey;

	public static string color_text_quote => ColorStyleLibrary.m.color_text_grey_dark;

	public static string addSingleUnitText(Actor pActor, bool pAddGap = true, bool pAddNameQuote = true)
	{
		if (!pActor.hasHappinessHistory())
		{
			return string.Empty;
		}
		using ListPool<HappinessHistory> list = new ListPool<HappinessHistory>(pActor.happiness_change_history);
		HappinessHistory random = list.GetRandom();
		string randomTextSingleReportLocalized = random.asset.getRandomTextSingleReportLocalized();
		string pString = "<i>\"" + randomTextSingleReportLocalized + "\"</i>";
		string pString2 = "\n " + pActor.name;
		string text = pActor.getAge().ToString();
		text = ((!pActor.isSexFemale()) ? (text + " M") : (text + " F"));
		string text2 = random.getAgoString().ColorHex(ColorStyleLibrary.m.color_text_grey_dark);
		string text3 = "";
		if (pAddGap)
		{
			text3 = "\n\n";
		}
		text3 = text3 + pString.ColorHex(color_text_quote) + "  " + text2;
		if (pAddNameQuote)
		{
			text3 = text3 + pString2.ColorHex(pActor.kingdom.getColor().color_text) + "  " + text.ColorHex(ColorStyleLibrary.m.color_text_grey_dark);
		}
		return text3;
	}

	public static string addSingleUnitTextRandomUnit(IMetaObject pMetaObject, out Actor pActorResult)
	{
		pActorResult = null;
		int num = 10;
		while (num-- > 0)
		{
			Actor randomUnit = pMetaObject.getRandomUnit();
			if (randomUnit != null && randomUnit.isAlive() && randomUnit.hasHappinessHistory())
			{
				string text = addSingleUnitText(randomUnit);
				if (!string.IsNullOrEmpty(text))
				{
					pActorResult = randomUnit;
					return text;
				}
			}
		}
		return string.Empty;
	}

	public static string getText(IMetaObject pMetaObject, MetaTypeAsset pAsset, out Actor pActorResult)
	{
		pActorResult = null;
		string text = string.Empty;
		bool flag = false;
		string[] reports = pAsset.reports;
		foreach (string pID in reports)
		{
			MetaTextReportAsset metaTextReportAsset = AssetManager.meta_text_report_library.get(pID);
			if (metaTextReportAsset.report_action(pMetaObject))
			{
				if (flag)
				{
					text += " ";
				}
				flag = true;
				string text2 = metaTextReportAsset.get_random_text;
				if (metaTextReportAsset.color != null)
				{
					text2 = text2.ColorHex(metaTextReportAsset.color);
				}
				text += text2;
			}
		}
		if (flag)
		{
			text += addSingleUnitTextRandomUnit(pMetaObject, out var pActorResult2);
			pActorResult = pActorResult2;
			text = text.ColorHex(color_text_main);
		}
		return text;
	}
}
// --- End of File: MetaTextReportHelper.cs ---



// --- Start of File: MetaTextReportLibrary.cs ---
public class MetaTextReportLibrary : AssetLibrary<MetaTextReportAsset>
{
	public override void init()
	{
		base.init();
		addGeneralMeta();
		addCity();
	}

	private void addCity()
	{
		add(new MetaTextReportAsset
		{
			id = "happy",
			color = "#ADADAD",
			report_action = (IMetaObject pObject) => pObject.getRatioHappy() > 0.8f
		});
		add(new MetaTextReportAsset
		{
			id = "unhappy",
			color = "#919191",
			report_action = (IMetaObject pObject) => pObject.getRatioUnhappy() > 0.8f
		});
		add(new MetaTextReportAsset
		{
			id = "many_children",
			color = "#ADADAD",
			report_action = delegate(IMetaObject pObject)
			{
				if (pObject.countUnits() < 20)
				{
					return false;
				}
				return pObject.getRatioChildren() > 0.7f;
			}
		});
		add(new MetaTextReportAsset
		{
			id = "many_homeless",
			color = "#919191",
			report_action = delegate(IMetaObject pObject)
			{
				if (pObject.countUnits() < 20)
				{
					return false;
				}
				return pObject.getRatioHomeless() > 0.8f;
			}
		});
		add(new MetaTextReportAsset
		{
			id = "food_plenty",
			color = "#ADADAD",
			report_action = delegate(IMetaObject pObject)
			{
				City obj = pObject as City;
				int num2 = obj.countFoodTotal();
				int populationPeople2 = obj.getPopulationPeople();
				return (num2 > populationPeople2 * 4) ? true : false;
			}
		});
		add(new MetaTextReportAsset
		{
			id = "food_running_out",
			color = "#919191",
			report_action = delegate(IMetaObject pObject)
			{
				City city = pObject as City;
				int num = city.countFoodTotal();
				if (num == 0)
				{
					return false;
				}
				int populationPeople = city.getPopulationPeople();
				return (num < populationPeople * 2) ? true : false;
			}
		});
		add(new MetaTextReportAsset
		{
			id = "food_none",
			color = "#919191",
			report_action = (IMetaObject pObject) => (pObject as City).countFoodTotal() == 0
		});
		add(new MetaTextReportAsset
		{
			id = "stone_none",
			color = "#919191",
			report_action = (IMetaObject pObject) => (pObject as City).amount_stone == 0
		});
		add(new MetaTextReportAsset
		{
			id = "wood_none",
			color = "#919191",
			report_action = (IMetaObject pObject) => (pObject as City).amount_wood == 0
		});
		add(new MetaTextReportAsset
		{
			id = "metal_none",
			color = "#919191",
			report_action = (IMetaObject pObject) => (pObject as City).amount_common_metals == 0
		});
		add(new MetaTextReportAsset
		{
			id = "gold_none",
			color = "#919191",
			report_action = (IMetaObject pObject) => (pObject as City).amount_gold == 0
		});
		add(new MetaTextReportAsset
		{
			id = "war_high_casualties",
			color = "#919191",
			report_action = (IMetaObject pObject) => (pObject as War).getTotalDeaths() > 100
		});
		add(new MetaTextReportAsset
		{
			id = "war_long",
			color = "#919191",
			report_action = (IMetaObject pObject) => pObject.getAge() > 100
		});
		add(new MetaTextReportAsset
		{
			id = "war_fresh",
			color = "#ADADAD",
			report_action = (IMetaObject pObject) => pObject.getAge() < 5
		});
		add(new MetaTextReportAsset
		{
			id = "war_defenders_getting_captured",
			color = "#ADADAD",
			report_action = delegate(IMetaObject pObject)
			{
				War pWar4 = pObject as War;
				if (!pWar4.areDefendersGettingCaptured())
				{
					return false;
				}
				return !pWar4.areAttackersGettingCaptured();
			}
		});
		add(new MetaTextReportAsset
		{
			id = "war_attackers_getting_captured",
			color = "#ADADAD",
			report_action = delegate(IMetaObject pObject)
			{
				War pWar3 = pObject as War;
				if (!pWar3.areAttackersGettingCaptured())
				{
					return false;
				}
				return !pWar3.areDefendersGettingCaptured();
			}
		});
		add(new MetaTextReportAsset
		{
			id = "war_quiet",
			color = "#ADADAD",
			report_action = delegate(IMetaObject pObject)
			{
				War pWar2 = pObject as War;
				if (pWar2.areAttackersGettingCaptured())
				{
					return false;
				}
				return !pWar2.areDefendersGettingCaptured();
			}
		});
		add(new MetaTextReportAsset
		{
			id = "war_full_on_battle",
			color = "#ADADAD",
			report_action = delegate(IMetaObject pObject)
			{
				War pWar = pObject as War;
				if (!pWar.areAttackersGettingCaptured())
				{
					return false;
				}
				return pWar.areDefendersGettingCaptured() ? true : false;
			}
		});
	}

	private void addGeneralMeta()
	{
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (MetaTextReportAsset item in list)
		{
			foreach (string localeID in item.getLocaleIDs())
			{
				checkLocale(item, localeID);
			}
		}
	}
}
// --- End of File: MetaTextReportLibrary.cs ---



// --- Start of File: MetaTooltipShowAction.cs ---
public delegate void MetaTooltipShowAction(NanoObject pType);
// --- End of File: MetaTooltipShowAction.cs ---



// --- Start of File: MetaType.cs ---
public enum MetaType
{
	None,
	Subspecies,
	Family,
	Language,
	Culture,
	Religion,
	Clan,
	City,
	Kingdom,
	Alliance,
	War,
	Plot,
	Unit,
	Building,
	Item,
	World,
	Special,
	Army
}
// --- End of File: MetaType.cs ---



// --- Start of File: MetaTypeAction.cs ---
public delegate void MetaTypeAction();
// --- End of File: MetaTypeAction.cs ---



// --- Start of File: MetaTypeActionAsset.cs ---
public delegate void MetaTypeActionAsset(MetaTypeAsset pAsset);
// --- End of File: MetaTypeActionAsset.cs ---



// --- Start of File: MetaTypeAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class MetaTypeAsset : Asset
{
	public MetaType map_mode;

	public string option_id = string.Empty;

	public string power_option_zone_id = string.Empty;

	public string power_tab_id = string.Empty;

	public string window_name;

	public bool force_zone_when_selected;

	public int[] ranks;

	public string[] reports;

	public MetaCheckUnitWindowAction check_unit_has_meta;

	public MetaUnitSetMetaForWindow set_unit_set_meta_for_meta_for_window;

	public MetaZoneDrawAction draw_zones;

	public MetaZoneClickAction click_action_zone;

	public MetaZoneHighlightAction check_cursor_highlight;

	public MetaZoneGetMeta tile_get_metaobject;

	public MetaZoneGetMetaSimple tile_get_metaobject_0;

	public MetaZoneGetMetaSimple tile_get_metaobject_1;

	public MetaZoneGetMetaSimple tile_get_metaobject_2;

	public MetaZoneTooltipAction check_tile_has_meta;

	public MetaZoneTooltipAction check_cursor_tooltip;

	public MetaTooltipShowAction cursor_tooltip_action;

	public MetaZoneDynamicAction dynamic_zones;

	public MetaTypeAction window_action_clear;

	public MetaTypeAction selected_tab_action;

	public MetaTypeActionAsset selected_tab_action_meta;

	public MetaTypeHistoryAction window_history_action_update;

	public MetaTypeHistoryAction window_history_action_restore;

	public int dynamic_zone_option = 2;

	public bool has_dynamic_zones;

	public string icon_list;

	public string icon_single_path;

	public MetaTypeListAction get_list;

	public MetaTypeListPoolAction get_sorted_list;

	public MetaTypeListHasAction has_any;

	public MetaSelectedGetter get_selected;

	public MetaSelectedSetter set_selected;

	public MetaGetter get;

	public MetaStatAction stat_hover;

	public MetaStatAction stat_click;

	public MetaTypeListPoolAction custom_sorted_list;

	public string[] decision_ids;

	[NonSerialized]
	public DecisionAsset[] decisions_assets;

	[NonSerialized]
	public OptionAsset option_asset;

	public bool unit_amount_alpha;

	public bool set_icon_for_cancel_button;

	private static int _last_call_frame = -1;

	public static string last_meta_type;

	public bool hasDecisions()
	{
		string[] array = decision_ids;
		if (array == null)
		{
			return false;
		}
		return array.Length != 0;
	}

	public int getZoneOptionState()
	{
		if (!Zones.getForcedMapMode().isNone() && Zones.isPowerForcedMapModeEnabled())
		{
			return 0;
		}
		return option_asset.current_int_value;
	}

	internal void toggleOptionZone(GodPower pPower, int pDirection = 1, bool pDisable = true)
	{
		PlayerOptionData data = option_asset.data;
		if (data.boolVal)
		{
			data.intVal += pDirection;
			if (data.intVal > option_asset.max_value)
			{
				data.intVal = 0;
				if (pDisable)
				{
					data.boolVal = false;
				}
			}
			if (data.intVal < 0)
			{
				data.intVal = option_asset.max_value;
			}
		}
		else
		{
			data.boolVal = true;
		}
		if (pPower.map_modes_switch)
		{
			if (data.boolVal)
			{
				PowerLibrary.disableAllOtherMapModes(pPower.id);
			}
			else
			{
				WorldTip.instance.startHide();
			}
		}
		PlayerConfig.saveData();
		string translatedName = pPower.getTranslatedName();
		string translatedDescription = pPower.getTranslatedDescription();
		string translatedOption = option_asset.getTranslatedOption();
		if (data.boolVal)
		{
			WorldTip.instance.showToolbarText(translatedName + " - " + translatedOption, translatedDescription);
		}
	}

	public bool isMetaZoneOptionSelectedFluid()
	{
		return getZoneOptionState() == dynamic_zone_option;
	}

	public bool isActive(bool pOnlyOption = false)
	{
		if (pOnlyOption)
		{
			return isOptionActive();
		}
		if (!isOptionActive())
		{
			return Zones.isPowerForceMapMode(map_mode);
		}
		return true;
	}

	public bool isOptionActive()
	{
		return PlayerConfig.optionBoolEnabled(option_id);
	}

	public ListPool<NanoObject> getSortedList()
	{
		if (get_sorted_list != null)
		{
			return get_sorted_list();
		}
		if (custom_sorted_list != null)
		{
			return custom_sorted_list();
		}
		return new ListPool<NanoObject>(get_list());
	}

	public bool hasRanks()
	{
		return ranks != null;
	}

	public void setListGetter(MetaTypeListPoolAction pListAction)
	{
		get_sorted_list = pListAction;
	}

	public void selectAndInspect(NanoObject pNewNanoObject, bool pFromNameplate = false, bool pCheckNameplate = true, bool pClearAction = false)
	{
		int frameCount = Time.frameCount;
		if (_last_call_frame == frameCount)
		{
			return;
		}
		_last_call_frame = frameCount;
		if (pCheckNameplate && World.world.nameplate_manager.isOverNameplate() && !pFromNameplate)
		{
			return;
		}
		NanoObject nanoObject = get_selected();
		string text = last_meta_type;
		set_selected(pNewNanoObject);
		SelectedObjects.setNanoObject(pNewNanoObject);
		bool flag = nanoObject.isRekt();
		bool flag2 = nanoObject == pNewNanoObject;
		bool flag3 = text == last_meta_type;
		bool flag4 = power_tab_id == PowersTab.getActiveTab().getAsset().id;
		if (HotkeyLibrary.isHoldingAnyMod())
		{
			ScrollWindow.showWindow(window_name);
			return;
		}
		if (!flag && flag2 && flag3 && flag4 && !pClearAction)
		{
			ScrollWindow.showWindow(window_name);
			return;
		}
		SelectedTabsHistory.addToHistory(pNewNanoObject);
		if (selected_tab_action != null)
		{
			selected_tab_action();
		}
		else if (selected_tab_action_meta != null)
		{
			SelectedUnit.clear();
			selected_tab_action_meta(this);
		}
		else if (!pClearAction)
		{
			ScrollWindow.showWindow(window_name);
		}
		else
		{
			SelectedTabsHistory.showPreviousTab();
		}
	}

	public Sprite getIconSprite()
	{
		return SpriteTextureLoader.getSprite(icon_single_path);
	}
}
// --- End of File: MetaTypeAsset.cs ---



// --- Start of File: MetaTypeExtensions.cs ---
using UnityEngine;

public static class MetaTypeExtensions
{
	public static MetaTypeAsset getAsset(this MetaType pType)
	{
		return AssetManager.meta_type_library.getAsset(pType);
	}

	public static bool isNone(this MetaType pType)
	{
		return pType == MetaType.None;
	}

	public static int getZoneState(this MetaType pType)
	{
		return AssetManager.meta_type_library.getAsset(pType).getZoneOptionState();
	}

	public static string AsString(this MetaType pType)
	{
		switch (pType)
		{
		case MetaType.World:
			return "world";
		case MetaType.Subspecies:
			return "subspecies";
		case MetaType.Family:
			return "family";
		case MetaType.Army:
			return "army";
		case MetaType.Language:
			return "language";
		case MetaType.Culture:
			return "culture";
		case MetaType.Religion:
			return "religion";
		case MetaType.Clan:
			return "clan";
		case MetaType.City:
			return "city";
		case MetaType.Kingdom:
			return "kingdom";
		case MetaType.Alliance:
			return "alliance";
		case MetaType.War:
			return "war";
		case MetaType.Plot:
			return "plot";
		case MetaType.Unit:
			return "unit";
		case MetaType.Building:
			return "building";
		case MetaType.Item:
			return "item";
		case MetaType.Special:
			return "special";
		case MetaType.None:
			return "none";
		default:
			Debug.LogError((object)("MetaTypeExtensions.AsString missing option for : " + pType));
			return pType.ToString().ToLower();
		}
	}
}
// --- End of File: MetaTypeExtensions.cs ---



// --- Start of File: MetaTypeHistoryAction.cs ---
public delegate void MetaTypeHistoryAction(ref WindowHistoryData pHistoryData);
// --- End of File: MetaTypeHistoryAction.cs ---



// --- Start of File: MetaTypeLibrary.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class MetaTypeLibrary : AssetLibrary<MetaTypeAsset>
{
	[NonSerialized]
	public static MetaTypeAsset alliance;

	[NonSerialized]
	public static MetaTypeAsset city;

	[NonSerialized]
	public static MetaTypeAsset clan;

	[NonSerialized]
	public static MetaTypeAsset culture;

	[NonSerialized]
	public static MetaTypeAsset family;

	[NonSerialized]
	public static MetaTypeAsset army;

	[NonSerialized]
	public static MetaTypeAsset kingdom;

	[NonSerialized]
	public static MetaTypeAsset language;

	[NonSerialized]
	public static MetaTypeAsset plot;

	[NonSerialized]
	public static MetaTypeAsset religion;

	[NonSerialized]
	public static MetaTypeAsset subspecies;

	[NonSerialized]
	public static MetaTypeAsset unit;

	[NonSerialized]
	public static MetaTypeAsset war;

	[NonSerialized]
	public static MetaTypeAsset item;

	private ZoneCalculator zone_manager => World.world.zone_calculator;

	public override void init()
	{
		base.init();
		add(new MetaTypeAsset
		{
			id = "world",
			window_name = "world_info",
			get_list = () => new NanoObject[0],
			has_any = () => false,
			get_selected = () => World.world.world_object,
			set_selected = delegate(NanoObject pElement)
			{
				World.world.world_object = pElement as WorldObject;
			},
			get = (long _) => World.world.world_object
		});
		item = add(new MetaTypeAsset
		{
			id = "item",
			window_name = "item",
			window_action_clear = delegate
			{
				SelectedMetas.selected_item = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.item = SelectedMetas.selected_item;
				if (WindowHistory.hasHistory() && ((Component)WindowHistory.list.Last().window).GetComponent<ItemWindow>() != null)
				{
					ScrollWindow.setPreviousWindowSprite(pHistoryData.item.getSprite());
				}
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_item = pHistoryData.item;
			},
			get_list = () => World.world.items,
			custom_sorted_list = delegate
			{
				ListPool<NanoObject> listPool2 = new ListPool<NanoObject>(64);
				foreach (Item item2 in World.world.items)
				{
					if (item2.isFavorite())
					{
						listPool2.Add(item2);
					}
				}
				return listPool2;
			},
			has_any = () => World.world.items.hasAny(),
			get_selected = () => SelectedMetas.selected_item,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_item = pElement as Item;
			},
			get = (long pId) => World.world.items.get(pId),
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Item pObject12 = World.world.items.get(pMetaId);
				if (!pObject12.isRekt())
				{
					Tooltip.show(pField, "equipment", new TooltipData
					{
						item = pObject12
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Item item = World.world.items.get(pMetaId);
				if (!item.isRekt())
				{
					SelectedMetas.selected_item = item;
					ScrollWindow.showWindow("item");
				}
			}
		});
		unit = add(new MetaTypeAsset
		{
			id = "unit",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "unit",
			power_tab_id = "selected_unit",
			icon_single_path = "ui/icons/iconSpecies",
			window_action_clear = delegate
			{
				if (SelectedUnit.isSet() && SelectedObjects.getSelectedNanoObject() is Actor)
				{
					PowerTabController.showTabSelectedUnit();
				}
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				if (SelectedUnit.isSet())
				{
					pHistoryData.unit = SelectedUnit.unit;
					if (WindowHistory.hasHistory())
					{
						WindowHistoryData windowHistoryData = WindowHistory.list.Last();
						if (((Component)windowHistoryData.window).GetComponent<UnitWindow>() != null && !windowHistoryData.unit.isRekt())
						{
							ScrollWindow.setPreviousWindowSprite(windowHistoryData.unit.asset.getSpriteIcon());
						}
					}
				}
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				if (!pHistoryData.unit.isRekt())
				{
					SelectedUnit.clear();
					SelectedUnit.select(pHistoryData.unit);
				}
				else
				{
					SelectedUnit.clear();
				}
			},
			get_list = () => World.world.units,
			custom_sorted_list = delegate
			{
				ListPool<NanoObject> listPool = new ListPool<NanoObject>(64);
				foreach (Actor unit in World.world.units)
				{
					if (!unit.isRekt() && unit.isFavorite())
					{
						listPool.Add(unit);
					}
				}
				return listPool;
			},
			has_any = () => World.world.units.Count > 0,
			get_selected = () => SelectedUnit.unit,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedUnit.select(pElement as Actor);
			},
			get = (long pId) => World.world.units.get(pId),
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Actor actor11 = World.world.units.get(pMetaId);
				if (!actor11.isRekt())
				{
					string pType = "actor";
					if (actor11.isKing())
					{
						pType = "actor_king";
					}
					if (actor11.isCityLeader())
					{
						pType = "actor_leader";
					}
					Tooltip.show(pField, pType, new TooltipData
					{
						actor = actor11
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Actor actor10 = World.world.units.get(pMetaId);
				if (!actor10.isRekt())
				{
					ActionLibrary.openUnitWindow(actor10);
				}
			}
		});
		war = add(new MetaTypeAsset
		{
			id = "war",
			window_name = "war",
			icon_list = "iconWarList",
			window_action_clear = delegate
			{
				SelectedMetas.selected_war = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.war = SelectedMetas.selected_war;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_war = pHistoryData.war;
			},
			reports = new string[7] { "war_high_casualties", "war_long", "war_fresh", "war_defenders_getting_captured", "war_attackers_getting_captured", "war_quiet", "war_full_on_battle" },
			get_list = () => World.world.wars,
			has_any = () => World.world.wars.hasAny(),
			get_selected = () => SelectedMetas.selected_war,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_war = pElement as War;
			},
			get = (long pId) => World.world.wars.get(pId),
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				War pObject11 = World.world.wars.get(pMetaId);
				if (!pObject11.isRekt())
				{
					Tooltip.show(pField, "war", new TooltipData
					{
						war = pObject11
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				War war = World.world.wars.get(pMetaId);
				if (!war.isRekt())
				{
					SelectedMetas.selected_war = war;
					ScrollWindow.showWindow("war");
				}
			}
		});
		plot = add(new MetaTypeAsset
		{
			id = "plot",
			window_name = "plot",
			icon_list = "iconPlotList",
			window_action_clear = delegate
			{
				SelectedMetas.selected_plot = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.plot = SelectedMetas.selected_plot;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_plot = pHistoryData.plot;
			},
			get_list = () => World.world.plots,
			has_any = () => World.world.plots.hasAny(),
			get_selected = () => SelectedMetas.selected_plot,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_plot = pElement as Plot;
			},
			get = (long pId) => World.world.plots.get(pId),
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Plot pObject10 = World.world.plots.get(pMetaId);
				if (!pObject10.isRekt())
				{
					Tooltip.show(pField, "plot", new TooltipData
					{
						plot = pObject10
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Plot plot = World.world.plots.get(pMetaId);
				if (!plot.isRekt())
				{
					SelectedMetas.selected_plot = plot;
					ScrollWindow.showWindow("plot");
				}
			},
			decision_ids = new string[1] { "check_plot" }
		});
		religion = add(new MetaTypeAsset
		{
			id = "religion",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "religion",
			power_tab_id = "selected_religion",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconReligionList",
			icon_single_path = "ui/icons/iconReligion",
			window_action_clear = delegate
			{
				SelectedMetas.selected_religion = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.religion = SelectedMetas.selected_religion;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_religion = pHistoryData.religion;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.religions,
			has_any = () => World.world.religions.hasAny(),
			get_selected = () => SelectedMetas.selected_religion,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_religion = pElement as Religion;
			},
			get = (long pId) => World.world.religions.get(pId),
			map_mode = MetaType.Religion,
			option_id = "map_religion_layer",
			power_option_zone_id = "religion_layer",
			has_dynamic_zones = true,
			click_action_zone = ActionLibrary.inspectReligion,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasReligion(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_religion = pActor.religion;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (religion.getZoneOptionState() == 2)
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
				//IL_006c: Unknown result type (might be due to invalid IL or missing references)
				//IL_00df: Unknown result type (might be due to invalid IL or missing references)
				Color color9 = pQAsset.color;
				switch (pMetaTypeAsset.getZoneOptionState())
				{
				case 0:
				{
					City city18 = pTile.zone.city;
					if (!city18.isRekt())
					{
						Religion religion3 = city18.kingdom.getReligion();
						if (!religion3.isRekt())
						{
							{
								foreach (City city19 in city18.kingdom.getCities())
								{
									QuantumSpriteLibrary.colorZones(pQAsset, city19.zones, color9);
								}
								break;
							}
						}
					}
					break;
				}
				case 1:
				{
					City city17 = pTile.zone.city;
					if (!city17.isRekt())
					{
						Religion religion3 = city17.getReligion();
						if (!religion3.isRekt())
						{
							{
								foreach (City city20 in World.world.cities)
								{
									if (city20.getReligion() == religion3)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city20.zones, color9);
									}
								}
								break;
							}
						}
					}
					break;
				}
				default:
					highlightDefault(pTile, pQAsset, color9);
					break;
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getReligionOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom.religion,
			tile_get_metaobject_1 = (TileZone pZone) => pZone.city?.religion,
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Religion religion2 = pMeta as Religion;
				if (!religion2.isRekt())
				{
					string text10 = "religion";
					Tooltip.hideTooltip(religion2, pOnlySimObjects: true, text10);
					Tooltip.show(religion2, text10, new TooltipData
					{
						religion = religion2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList9 = World.world.units.getSimpleList();
				double curWorldTime9 = World.world.getCurWorldTime();
				int num3 = 0;
				for (int count9 = simpleList9.Count; num3 < count9; num3++)
				{
					Actor actor9 = simpleList9[num3];
					if (actor9.asset.show_on_meta_layer)
					{
						TileZone zone9 = actor9.current_tile.zone;
						if (actor9.hasReligion())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone9, actor9.religion, curWorldTime9);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Religion pObject9 = World.world.religions.get(pMetaId);
				if (!pObject9.isRekt())
				{
					Tooltip.show(pField, "religion", new TooltipData
					{
						religion = pObject9
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Religion religion = World.world.religions.get(pMetaId);
				if (!religion.isRekt())
				{
					SelectedMetas.selected_religion = religion;
					ScrollWindow.showWindow("religion");
				}
			}
		});
		culture = add(new MetaTypeAsset
		{
			id = "culture",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "culture",
			power_tab_id = "selected_culture",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconCultureList",
			icon_single_path = "ui/icons/iconCulture",
			window_action_clear = delegate
			{
				SelectedMetas.selected_culture = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.culture = SelectedMetas.selected_culture;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_culture = pHistoryData.culture;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.cultures,
			has_any = () => World.world.cultures.hasAny(),
			get_selected = () => SelectedMetas.selected_culture,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_culture = pElement as Culture;
			},
			get = (long pId) => World.world.cultures.get(pId),
			map_mode = MetaType.Culture,
			option_id = "map_culture_layer",
			power_option_zone_id = "culture_layer",
			has_dynamic_zones = true,
			click_action_zone = ActionLibrary.inspectCulture,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasCulture(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_culture = pActor.culture;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
				//IL_006c: Unknown result type (might be due to invalid IL or missing references)
				//IL_00df: Unknown result type (might be due to invalid IL or missing references)
				Color color8 = pQAsset.color;
				switch (pMetaTypeAsset.getZoneOptionState())
				{
				case 0:
				{
					City city16 = pTile.zone.city;
					if (!city16.isRekt())
					{
						Culture culture3 = city16.kingdom.getCulture();
						if (!culture3.isRekt())
						{
							{
								foreach (City city21 in city16.kingdom.getCities())
								{
									QuantumSpriteLibrary.colorZones(pQAsset, city21.zones, color8);
								}
								break;
							}
						}
					}
					break;
				}
				case 1:
				{
					City city15 = pTile.zone.city;
					if (!city15.isRekt())
					{
						Culture culture3 = city15.getCulture();
						if (!culture3.isRekt())
						{
							{
								foreach (City city22 in World.world.cities)
								{
									if (city22.getCulture() == culture3)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city22.zones, color8);
									}
								}
								break;
							}
						}
					}
					break;
				}
				default:
					highlightDefault(pTile, pQAsset, color8);
					break;
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getCultureOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom.culture,
			tile_get_metaobject_1 = (TileZone pZone) => pZone.city?.culture,
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Culture culture2 = pMeta as Culture;
				if (!culture2.isRekt())
				{
					string text9 = "culture";
					Tooltip.hideTooltip(culture2, pOnlySimObjects: true, text9);
					Tooltip.show(culture2, text9, new TooltipData
					{
						culture = culture2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList8 = World.world.units.getSimpleList();
				double curWorldTime8 = World.world.getCurWorldTime();
				int num2 = 0;
				for (int count8 = simpleList8.Count; num2 < count8; num2++)
				{
					Actor actor8 = simpleList8[num2];
					if (actor8.asset.show_on_meta_layer)
					{
						TileZone zone8 = actor8.current_tile.zone;
						if (actor8.hasCulture())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone8, actor8.culture, curWorldTime8);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Culture pObject8 = World.world.cultures.get(pMetaId);
				if (!pObject8.isRekt())
				{
					Tooltip.show(pField, "culture", new TooltipData
					{
						culture = pObject8
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Culture culture = World.world.cultures.get(pMetaId);
				if (!culture.isRekt())
				{
					SelectedMetas.selected_culture = culture;
					ScrollWindow.showWindow("culture");
				}
			}
		});
		family = add(new MetaTypeAsset
		{
			id = "family",
			window_name = "family",
			power_tab_id = "selected_family",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			unit_amount_alpha = true,
			icon_list = "iconFamilyList",
			icon_single_path = "ui/icons/iconFamily",
			window_action_clear = delegate
			{
				SelectedMetas.selected_family = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.family = SelectedMetas.selected_family;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_family = pHistoryData.family;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.families,
			has_any = () => World.world.families.hasAny(),
			get_selected = () => SelectedMetas.selected_family,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_family = pElement as Family;
			},
			get = (long pId) => World.world.families.get(pId),
			map_mode = MetaType.Family,
			option_id = "map_family_layer",
			power_option_zone_id = "family_layer",
			has_dynamic_zones = true,
			decision_ids = new string[5] { "family_check_existence", "family_alpha_move", "family_group_follow", "family_group_leave", "child_follow_parent" },
			click_action_zone = ActionLibrary.inspectFamily,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasFamily(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_family = pActor.family;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_0164: Unknown result type (might be due to invalid IL or missing references)
				//IL_0095: Unknown result type (might be due to invalid IL or missing references)
				//IL_0144: Unknown result type (might be due to invalid IL or missing references)
				Color color7 = pQAsset.color;
				switch (pMetaTypeAsset.getZoneOptionState())
				{
				case 0:
				{
					City city14 = pTile.zone.city;
					if (!city14.isRekt() && city14.kingdom.hasKing() && city14.kingdom.king.hasFamily())
					{
						Family family3 = city14.kingdom.king.family;
						if (!family3.isRekt())
						{
							{
								foreach (City city23 in city14.kingdom.getCities())
								{
									QuantumSpriteLibrary.colorZones(pQAsset, city23.zones, color7);
								}
								break;
							}
						}
					}
					break;
				}
				case 1:
				{
					City city13 = pTile.zone.city;
					if (!city13.isRekt() && city13.hasLeader() && city13.leader.hasFamily())
					{
						Family family3 = city13.leader.family;
						if (!family3.isRekt())
						{
							{
								foreach (City city24 in World.world.cities)
								{
									if (!city24.hasLeader() || !city24.leader.hasFamily())
									{
										break;
									}
									if (city24.leader.family == family3)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city24.zones, color7);
									}
								}
								break;
							}
						}
					}
					break;
				}
				default:
					highlightDefault(pTile, pQAsset, color7);
					break;
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getFamilyOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom.king?.family,
			tile_get_metaobject_1 = (TileZone pZone) => pZone.city?.leader?.family,
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Family family2 = pMeta as Family;
				if (!family2.isRekt())
				{
					string text8 = "family";
					Tooltip.hideTooltip(family2, pOnlySimObjects: true, text8);
					Tooltip.show(family2, text8, new TooltipData
					{
						family = family2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList7 = World.world.units.getSimpleList();
				double curWorldTime7 = World.world.getCurWorldTime();
				int num = 0;
				for (int count7 = simpleList7.Count; num < count7; num++)
				{
					Actor actor7 = simpleList7[num];
					if (actor7.asset.show_on_meta_layer)
					{
						TileZone zone7 = actor7.current_tile.zone;
						if (actor7.hasFamily() && actor7.family.units.Count >= 2)
						{
							ZoneMetaDataVisualizer.countMetaZone(zone7, actor7.family, curWorldTime7);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Family pObject7 = World.world.families.get(pMetaId);
				if (!pObject7.isRekt())
				{
					Tooltip.show(pField, "family", new TooltipData
					{
						family = pObject7
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Family family = World.world.families.get(pMetaId);
				if (!family.isRekt())
				{
					SelectedMetas.selected_family = family;
					ScrollWindow.showWindow("family");
				}
			}
		});
		army = add(new MetaTypeAsset
		{
			id = "army",
			window_name = "army",
			power_tab_id = "selected_army",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconArmyList",
			icon_single_path = "ui/icons/iconArmy",
			window_action_clear = delegate
			{
				SelectedMetas.selected_army = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.army = SelectedMetas.selected_army;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_army = pHistoryData.army;
			},
			get_list = () => World.world.armies,
			has_any = () => World.world.armies.hasAny(),
			get_selected = () => SelectedMetas.selected_army,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_army = pElement as Army;
			},
			get = (long pId) => World.world.armies.get(pId),
			map_mode = MetaType.Army,
			option_id = "map_army_layer",
			power_option_zone_id = "army_layer",
			has_dynamic_zones = true,
			dynamic_zone_option = 0,
			click_action_zone = ActionLibrary.inspectArmy,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasArmy(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_army = pActor.army;
			},
			reports = new string[2] { "happy", "unhappy" },
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_0011: Unknown result type (might be due to invalid IL or missing references)
				Color color6 = pQAsset.color;
				pMetaTypeAsset.getZoneOptionState();
				highlightDefault(pTile, pQAsset, color6);
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getArmyOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone _) => (IMetaObject)null,
			tile_get_metaobject_1 = (TileZone _) => (IMetaObject)null,
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Army army2 = pMeta as Army;
				if (!army2.isRekt())
				{
					string text7 = "army";
					Tooltip.hideTooltip(army2, pOnlySimObjects: true, text7);
					Tooltip.show(army2, text7, new TooltipData
					{
						army = army2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList6 = World.world.units.getSimpleList();
				double curWorldTime6 = World.world.getCurWorldTime();
				int n = 0;
				for (int count6 = simpleList6.Count; n < count6; n++)
				{
					Actor actor6 = simpleList6[n];
					if (actor6.asset.show_on_meta_layer)
					{
						TileZone zone6 = actor6.current_tile.zone;
						if (actor6.hasArmy())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone6, actor6.army, curWorldTime6);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Army pObject6 = World.world.armies.get(pMetaId);
				if (!pObject6.isRekt())
				{
					Tooltip.show(pField, "army", new TooltipData
					{
						army = pObject6
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Army army = World.world.armies.get(pMetaId);
				if (!army.isRekt())
				{
					SelectedMetas.selected_army = army;
					ScrollWindow.showWindow("army");
				}
			}
		});
		language = add(new MetaTypeAsset
		{
			id = "language",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "language",
			power_tab_id = "selected_language",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconLanguageList",
			icon_single_path = "ui/icons/iconLanguage",
			window_action_clear = delegate
			{
				SelectedMetas.selected_language = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.language = SelectedMetas.selected_language;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_language = pHistoryData.language;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.languages,
			has_any = () => World.world.languages.hasAny(),
			get_selected = () => SelectedMetas.selected_language,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_language = pElement as Language;
			},
			get = (long pId) => World.world.languages.get(pId),
			map_mode = MetaType.Language,
			option_id = "map_language_layer",
			power_option_zone_id = "language_layer",
			has_dynamic_zones = true,
			click_action_zone = ActionLibrary.inspectLanguage,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasLanguage(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_language = pActor.language;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
				//IL_006c: Unknown result type (might be due to invalid IL or missing references)
				//IL_00df: Unknown result type (might be due to invalid IL or missing references)
				Color color5 = pQAsset.color;
				switch (pMetaTypeAsset.getZoneOptionState())
				{
				case 0:
				{
					City city12 = pTile.zone.city;
					if (!city12.isRekt())
					{
						Language language3 = city12.kingdom.getLanguage();
						if (!language3.isRekt())
						{
							{
								foreach (City city25 in city12.kingdom.getCities())
								{
									QuantumSpriteLibrary.colorZones(pQAsset, city25.zones, color5);
								}
								break;
							}
						}
					}
					break;
				}
				case 1:
				{
					City city11 = pTile.zone.city;
					if (!city11.isRekt())
					{
						Language language3 = city11.getLanguage();
						if (!language3.isRekt())
						{
							{
								foreach (City city26 in World.world.cities)
								{
									if (city26.getLanguage() == language3)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city26.zones, color5);
									}
								}
								break;
							}
						}
					}
					break;
				}
				default:
					highlightDefault(pTile, pQAsset, color5);
					break;
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getLanguageOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom.getLanguage(),
			tile_get_metaobject_1 = (TileZone pZone) => pZone.city?.getLanguage(),
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Language language2 = pMeta as Language;
				if (!language2.isRekt())
				{
					string text6 = "language";
					Tooltip.hideTooltip(language2, pOnlySimObjects: true, text6);
					Tooltip.show(language2, text6, new TooltipData
					{
						language = language2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList5 = World.world.units.getSimpleList();
				double curWorldTime5 = World.world.getCurWorldTime();
				int m = 0;
				for (int count5 = simpleList5.Count; m < count5; m++)
				{
					Actor actor5 = simpleList5[m];
					if (actor5.asset.show_on_meta_layer)
					{
						TileZone zone5 = actor5.current_tile.zone;
						if (actor5.hasLanguage())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone5, actor5.language, curWorldTime5);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Language pObject5 = World.world.languages.get(pMetaId);
				if (!pObject5.isRekt())
				{
					Tooltip.show(pField, "language", new TooltipData
					{
						language = pObject5
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Language language = World.world.languages.get(pMetaId);
				if (!language.isRekt())
				{
					SelectedMetas.selected_language = language;
					ScrollWindow.showWindow("language");
				}
			}
		});
		subspecies = add(new MetaTypeAsset
		{
			id = "subspecies",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "subspecies",
			power_tab_id = "selected_subspecies",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			unit_amount_alpha = true,
			icon_list = "iconSubspeciesList",
			icon_single_path = "ui/icons/iconSpecies",
			window_action_clear = delegate
			{
				SelectedMetas.selected_subspecies = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.subspecies = SelectedMetas.selected_subspecies;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_subspecies = pHistoryData.subspecies;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.subspecies,
			has_any = () => World.world.subspecies.hasAny(),
			get_selected = () => SelectedMetas.selected_subspecies,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_subspecies = pElement as Subspecies;
			},
			get = (long pId) => World.world.subspecies.get(pId),
			map_mode = MetaType.Subspecies,
			option_id = "map_subspecies_layer",
			power_option_zone_id = "subspecies_layer",
			has_dynamic_zones = true,
			click_action_zone = ActionLibrary.inspectSubspecies,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasSubspecies(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_subspecies = pActor.subspecies;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_0108: Unknown result type (might be due to invalid IL or missing references)
				//IL_0075: Unknown result type (might be due to invalid IL or missing references)
				//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
				Color color4 = pQAsset.color;
				switch (pMetaTypeAsset.getZoneOptionState())
				{
				case 0:
				{
					City city10 = pTile.zone.city;
					if (!city10.isRekt())
					{
						Subspecies mainSubspecies = city10.kingdom.getMainSubspecies();
						if (!mainSubspecies.isRekt())
						{
							{
								foreach (City city27 in World.world.cities)
								{
									if (city27.getMainSubspecies() == mainSubspecies)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city27.zones, color4);
									}
								}
								break;
							}
						}
					}
					break;
				}
				case 1:
				{
					City city9 = pTile.zone.city;
					if (!city9.isRekt())
					{
						Subspecies mainSubspecies = city9.getMainSubspecies();
						if (!mainSubspecies.isRekt())
						{
							{
								foreach (City city28 in World.world.cities)
								{
									if (city28.getMainSubspecies() == mainSubspecies)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city28.zones, color4);
									}
								}
								break;
							}
						}
					}
					break;
				}
				default:
					highlightDefault(pTile, pQAsset, color4);
					break;
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getSubspeciesOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom.getMainSubspecies(),
			tile_get_metaobject_1 = (TileZone pZone) => pZone.city?.getMainSubspecies(),
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Subspecies subspecies2 = pMeta as Subspecies;
				if (!subspecies2.isRekt())
				{
					string text5 = "subspecies";
					Tooltip.hideTooltip(subspecies2, pOnlySimObjects: true, text5);
					Tooltip.show(subspecies2, text5, new TooltipData
					{
						subspecies = subspecies2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList4 = World.world.units.getSimpleList();
				double curWorldTime4 = World.world.getCurWorldTime();
				int l = 0;
				for (int count4 = simpleList4.Count; l < count4; l++)
				{
					Actor actor4 = simpleList4[l];
					if (actor4.asset.show_on_meta_layer)
					{
						TileZone zone4 = actor4.current_tile.zone;
						if (actor4.hasSubspecies())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone4, actor4.subspecies, curWorldTime4);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Subspecies pObject4 = World.world.subspecies.get(pMetaId);
				if (!pObject4.isRekt())
				{
					Tooltip.show(pField, "subspecies", new TooltipData
					{
						subspecies = pObject4
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Subspecies subspecies = World.world.subspecies.get(pMetaId);
				if (!subspecies.isRekt())
				{
					SelectedMetas.selected_subspecies = subspecies;
					ScrollWindow.showWindow("subspecies");
				}
			}
		});
		city = add(new MetaTypeAsset
		{
			id = "city",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "city",
			power_tab_id = "selected_city",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconCityList",
			icon_single_path = "ui/icons/iconCity",
			window_action_clear = delegate
			{
				SelectedMetas.selected_city = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.city = SelectedMetas.selected_city;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_city = pHistoryData.city;
			},
			has_dynamic_zones = true,
			dynamic_zone_option = 1,
			reports = new string[11]
			{
				"happy", "unhappy", "food_none", "food_plenty", "food_running_out", "wood_none", "stone_none", "gold_none", "metal_none", "many_children",
				"many_homeless"
			},
			get_list = () => World.world.cities,
			has_any = () => World.world.cities.hasAny(),
			get_selected = () => SelectedMetas.selected_city,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_city = pElement as City;
			},
			get = (long pId) => World.world.cities.get(pId),
			map_mode = MetaType.City,
			option_id = "map_city_layer",
			power_option_zone_id = "city_layer",
			decision_ids = new string[9] { "give_tax", "store_resources", "make_items", "find_house", "try_to_take_city_item", "repair_equipment", "city_idle_walking", "replenish_energy", "put_out_fire" },
			click_action_zone = ActionLibrary.inspectCity,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasCity(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_city = pActor.city;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
					drawForCities(pMetaTypeAsset, WildKingdomsManager.neutral.getCities(), getZoneDelegate(pMetaTypeAsset));
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList3 = World.world.units.getSimpleList();
				double curWorldTime3 = World.world.getCurWorldTime();
				int k = 0;
				for (int count3 = simpleList3.Count; k < count3; k++)
				{
					Actor actor3 = simpleList3[k];
					if (actor3.asset.show_on_meta_layer)
					{
						TileZone zone3 = actor3.current_tile.zone;
						if (actor3.hasCity() && actor3.isKingdomCiv())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone3, actor3.city, curWorldTime3);
						}
					}
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0060: Unknown result type (might be due to invalid IL or missing references)
				//IL_0038: Unknown result type (might be due to invalid IL or missing references)
				bool flag3 = PlayerConfig.optionBoolEnabled("highlight_kingdom_enemies");
				if (pMetaTypeAsset.getZoneOptionState() == 0)
				{
					if (!pTile.zone.city.isRekt())
					{
						QuantumSpriteLibrary.colorZones(pQAsset, pTile.zone.city.zones, pQAsset.color);
						if (flag3)
						{
							QuantumSpriteLibrary.colorEnemies(pQAsset, pTile.zone.city.kingdom);
						}
					}
				}
				else
				{
					highlightDefault(pTile, pQAsset, pQAsset.color);
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getCityOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city,
			tile_get_metaobject_1 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = (TileZone pZone, MetaTypeAsset pAsset, int pZoneOption) => pAsset.tile_get_metaobject(pZone, pZoneOption) != null,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				City city8 = pMeta as City;
				if (!city8.isRekt())
				{
					string text4 = "city";
					Tooltip.hideTooltip(city8, pOnlySimObjects: true, text4);
					Tooltip.show(city8, text4, new TooltipData
					{
						city = city8,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				City pObject3 = World.world.cities.get(pMetaId);
				if (!pObject3.isRekt())
				{
					Tooltip.show(pField, "city", new TooltipData
					{
						city = pObject3
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				City city7 = World.world.cities.get(pMetaId);
				if (!city7.isRekt())
				{
					SelectedMetas.selected_city = city7;
					ScrollWindow.showWindow("city");
				}
			}
		});
		kingdom = add(new MetaTypeAsset
		{
			id = "kingdom",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "kingdom",
			power_tab_id = "selected_kingdom",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconKingdomList",
			icon_single_path = "ui/icons/iconKingdom",
			window_action_clear = delegate
			{
				SelectedMetas.selected_kingdom = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.kingdom = SelectedMetas.selected_kingdom;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_kingdom = pHistoryData.kingdom;
			},
			has_dynamic_zones = true,
			dynamic_zone_option = 1,
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.kingdoms,
			has_any = () => World.world.kingdoms.hasAny(),
			get_selected = () => SelectedMetas.selected_kingdom,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_kingdom = pElement as Kingdom;
			},
			get = (long pId) => World.world.kingdoms.get(pId),
			map_mode = MetaType.Kingdom,
			option_id = "map_kingdom_layer",
			power_option_zone_id = "kingdom_layer",
			click_action_zone = ActionLibrary.inspectKingdom,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.isKingdomCiv(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_kingdom = pActor.kingdom;
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
					drawForCities(pMetaTypeAsset, WildKingdomsManager.neutral.getCities(), getZoneDelegate(pMetaTypeAsset));
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList2 = World.world.units.getSimpleList();
				double curWorldTime2 = World.world.getCurWorldTime();
				int j = 0;
				for (int count2 = simpleList2.Count; j < count2; j++)
				{
					Actor actor2 = simpleList2[j];
					if (actor2.asset.show_on_meta_layer)
					{
						TileZone zone2 = actor2.current_tile.zone;
						if (actor2.hasKingdom() && actor2.isKingdomCiv())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone2, actor2.kingdom, curWorldTime2);
						}
					}
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_000c: Unknown result type (might be due to invalid IL or missing references)
				//IL_0011: Unknown result type (might be due to invalid IL or missing references)
				//IL_007f: Unknown result type (might be due to invalid IL or missing references)
				//IL_0052: Unknown result type (might be due to invalid IL or missing references)
				bool flag2 = PlayerConfig.optionBoolEnabled("highlight_kingdom_enemies");
				Color color3 = pQAsset.color;
				if (pMetaTypeAsset.getZoneOptionState() == 0)
				{
					City city6 = pTile.zone.city;
					if (!city6.isRekt())
					{
						foreach (City city29 in city6.kingdom.getCities())
						{
							QuantumSpriteLibrary.colorZones(pQAsset, city29.zones, color3);
						}
						if (flag2)
						{
							QuantumSpriteLibrary.colorEnemies(pQAsset, city6.kingdom);
						}
					}
				}
				else
				{
					highlightDefault(pTile, pQAsset, color3);
				}
			},
			tile_get_metaobject = delegate(TileZone pZone, int pZoneOption)
			{
				IMetaObject kingdomOnZone = pZone.getKingdomOnZone(pZoneOption);
				if (kingdomOnZone == null)
				{
					return (IMetaObject)null;
				}
				return ((Kingdom)kingdomOnZone).isNeutral() ? null : kingdomOnZone;
			},
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom,
			tile_get_metaobject_1 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = delegate(TileZone pZone, MetaTypeAsset pAsset, int pZoneOption)
			{
				IMetaObject metaObject = pAsset.tile_get_metaobject(pZone, pZoneOption);
				if (metaObject == null)
				{
					return false;
				}
				return !((Kingdom)metaObject).isNeutral();
			},
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Kingdom kingdom4 = pMeta as Kingdom;
				if (!kingdom4.isRekt())
				{
					string text3 = "kingdom";
					Tooltip.hideTooltip(kingdom4, pOnlySimObjects: true, text3);
					Tooltip.show(kingdom4, text3, new TooltipData
					{
						kingdom = kingdom4,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Kingdom kingdom3 = World.world.kingdoms.get(pMetaId);
				if (!kingdom3.isRekt() && !kingdom3.isNeutral())
				{
					Tooltip.show(pField, "kingdom", new TooltipData
					{
						kingdom = kingdom3
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Kingdom kingdom2 = World.world.kingdoms.get(pMetaId);
				if (!kingdom2.isRekt() && !kingdom2.isNeutral())
				{
					SelectedMetas.selected_kingdom = kingdom2;
					ScrollWindow.showWindow("kingdom");
				}
			}
		});
		clan = add(new MetaTypeAsset
		{
			id = "clan",
			ranks = generateExponentialRanks(100.0, 1.5),
			window_name = "clan",
			power_tab_id = "selected_clan",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconClanList",
			icon_single_path = "ui/icons/iconClan",
			window_action_clear = delegate
			{
				SelectedMetas.selected_clan = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.clan = SelectedMetas.selected_clan;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_clan = pHistoryData.clan;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.clans,
			has_any = () => World.world.clans.hasAny(),
			get_selected = () => SelectedMetas.selected_clan,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_clan = pElement as Clan;
			},
			get = (long pId) => World.world.clans.get(pId),
			map_mode = MetaType.Clan,
			option_id = "map_clan_layer",
			power_option_zone_id = "clan_layer",
			has_dynamic_zones = true,
			dynamic_zone_option = 2,
			click_action_zone = ActionLibrary.inspectClan,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.hasClan(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_clan = pActor.clan;
			},
			decision_ids = new string[1] { "try_new_plot" },
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				if (pMetaTypeAsset.isMetaZoneOptionSelectedFluid())
				{
					drawDefaultFluid(pMetaTypeAsset);
				}
				else
				{
					drawDefaultMeta(pMetaTypeAsset);
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_0001: Unknown result type (might be due to invalid IL or missing references)
				//IL_0006: Unknown result type (might be due to invalid IL or missing references)
				//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
				//IL_006c: Unknown result type (might be due to invalid IL or missing references)
				//IL_00df: Unknown result type (might be due to invalid IL or missing references)
				Color color2 = pQAsset.color;
				switch (pMetaTypeAsset.getZoneOptionState())
				{
				case 0:
				{
					City city5 = pTile.zone.city;
					if (!city5.isRekt())
					{
						Clan royalClan = city5.kingdom.getKingClan();
						if (!royalClan.isRekt())
						{
							{
								foreach (City city30 in city5.kingdom.getCities())
								{
									QuantumSpriteLibrary.colorZones(pQAsset, city30.zones, color2);
								}
								break;
							}
						}
					}
					break;
				}
				case 1:
				{
					City city4 = pTile.zone.city;
					if (!city4.isRekt())
					{
						Clan royalClan = city4.getRoyalClan();
						if (!royalClan.isRekt())
						{
							{
								foreach (City city31 in World.world.cities)
								{
									if (city31.getRoyalClan() == royalClan)
									{
										QuantumSpriteLibrary.colorZones(pQAsset, city31.zones, color2);
									}
								}
								break;
							}
						}
					}
					break;
				}
				default:
					highlightDefault(pTile, pQAsset, color2);
					break;
				}
			},
			tile_get_metaobject = (TileZone pZone, int pZoneOption) => pZone.getClanOnZone(pZoneOption),
			tile_get_metaobject_0 = (TileZone pZone) => pZone.city?.kingdom.getKingClan(),
			tile_get_metaobject_1 = (TileZone pZone) => pZone.city?.getRoyalClan(),
			tile_get_metaobject_2 = (TileZone pZone) => ZoneMetaDataVisualizer.getZoneMetaData(pZone).meta_object,
			check_tile_has_meta = checkTileHasMetaDefault,
			check_cursor_tooltip = checkCursorTooltipDefault,
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Clan clan2 = pMeta as Clan;
				if (!clan2.isRekt())
				{
					string text2 = "clan";
					Tooltip.hideTooltip(clan2, pOnlySimObjects: true, text2);
					Tooltip.show(clan2, text2, new TooltipData
					{
						clan = clan2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			dynamic_zones = delegate
			{
				List<Actor> simpleList = World.world.units.getSimpleList();
				double curWorldTime = World.world.getCurWorldTime();
				int i = 0;
				for (int count = simpleList.Count; i < count; i++)
				{
					Actor actor = simpleList[i];
					if (actor.asset.show_on_meta_layer)
					{
						TileZone zone = actor.current_tile.zone;
						if (actor.hasClan())
						{
							ZoneMetaDataVisualizer.countMetaZone(zone, actor.clan, curWorldTime);
						}
					}
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Clan pObject2 = World.world.clans.get(pMetaId);
				if (!pObject2.isRekt())
				{
					Tooltip.show(pField, "clan", new TooltipData
					{
						clan = pObject2
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Clan clan = World.world.clans.get(pMetaId);
				if (!clan.isRekt())
				{
					SelectedMetas.selected_clan = clan;
					ScrollWindow.showWindow("clan");
				}
			}
		});
		alliance = add(new MetaTypeAsset
		{
			id = "alliance",
			window_name = "alliance",
			power_tab_id = "selected_alliance",
			force_zone_when_selected = true,
			set_icon_for_cancel_button = true,
			icon_list = "iconAllianceList",
			icon_single_path = "ui/icons/iconAlliance",
			window_action_clear = delegate
			{
				SelectedMetas.selected_alliance = null;
			},
			window_history_action_update = delegate(ref WindowHistoryData pHistoryData)
			{
				pHistoryData.alliance = SelectedMetas.selected_alliance;
			},
			window_history_action_restore = delegate(ref WindowHistoryData pHistoryData)
			{
				SelectedMetas.selected_alliance = pHistoryData.alliance;
			},
			reports = new string[4] { "happy", "unhappy", "many_children", "many_homeless" },
			get_list = () => World.world.alliances,
			has_any = () => World.world.alliances.hasAny(),
			get_selected = () => SelectedMetas.selected_alliance,
			set_selected = delegate(NanoObject pElement)
			{
				SelectedMetas.selected_alliance = pElement as Alliance;
			},
			get = (long pId) => World.world.alliances.get(pId),
			map_mode = MetaType.Alliance,
			option_id = "map_alliance_layer",
			power_option_zone_id = "alliance_layer",
			click_action_zone = ActionLibrary.inspectAlliance,
			selected_tab_action_meta = defaultClickActionZone,
			check_unit_has_meta = (Actor pActor) => pActor.kingdom.hasAlliance(),
			set_unit_set_meta_for_meta_for_window = delegate(Actor pActor)
			{
				SelectedMetas.selected_alliance = pActor.kingdom.getAlliance();
			},
			draw_zones = delegate(MetaTypeAsset pMetaTypeAsset)
			{
				int zoneOptionState = pMetaTypeAsset.getZoneOptionState();
				foreach (Alliance alliance4 in World.world.alliances)
				{
					foreach (Kingdom item3 in alliance4.kingdoms_hashset)
					{
						foreach (City city32 in item3.getCities())
						{
							foreach (TileZone zone10 in city32.zones)
							{
								zone_manager.drawBegin();
								zone_manager.drawZoneAlliance(zone10, zoneOptionState);
								zone_manager.drawEnd(zone10);
							}
						}
					}
				}
				foreach (Kingdom kingdom5 in World.world.kingdoms)
				{
					if (!kingdom5.hasAlliance())
					{
						foreach (City city33 in kingdom5.getCities())
						{
							foreach (TileZone zone11 in city33.zones)
							{
								zone_manager.drawBegin();
								zone_manager.drawZoneCity(zone11);
								zone_manager.drawEnd(zone11);
							}
						}
					}
				}
			},
			check_cursor_highlight = delegate(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pQAsset)
			{
				//IL_000c: Unknown result type (might be due to invalid IL or missing references)
				//IL_0011: Unknown result type (might be due to invalid IL or missing references)
				//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
				//IL_0070: Unknown result type (might be due to invalid IL or missing references)
				bool flag = PlayerConfig.optionBoolEnabled("highlight_kingdom_enemies");
				Color color = pQAsset.color;
				City city3 = pTile.zone.city;
				if (!city3.isRekt())
				{
					Kingdom kingdom = city3.kingdom;
					if (kingdom.hasAlliance())
					{
						foreach (Kingdom item4 in kingdom.getAlliance().kingdoms_hashset)
						{
							foreach (City city34 in item4.getCities())
							{
								QuantumSpriteLibrary.colorZones(pQAsset, city34.zones, color);
							}
						}
					}
					else
					{
						foreach (City city35 in city3.kingdom.getCities())
						{
							QuantumSpriteLibrary.colorZones(pQAsset, city35.zones, color);
						}
					}
					if (flag)
					{
						QuantumSpriteLibrary.colorEnemies(pQAsset, kingdom);
					}
				}
			},
			check_tile_has_meta = delegate(TileZone pZone, MetaTypeAsset pAsset, int pZoneOption)
			{
				City city2 = pZone.city;
				if (city2.isRekt())
				{
					return false;
				}
				return !city2.kingdom.getAlliance().isRekt();
			},
			check_cursor_tooltip = delegate(TileZone pZone, MetaTypeAsset pAsset, int pZoneOption)
			{
				City city = pZone.city;
				if (city.isRekt())
				{
					return false;
				}
				Alliance alliance3 = city.kingdom.getAlliance();
				if (alliance3.isRekt())
				{
					return kingdom.check_cursor_tooltip(pZone, kingdom, pZoneOption);
				}
				alliance3.meta_type_asset.cursor_tooltip_action(alliance3);
				return true;
			},
			cursor_tooltip_action = delegate(NanoObject pMeta)
			{
				Alliance alliance2 = pMeta as Alliance;
				if (!alliance2.isRekt())
				{
					string text = "alliance";
					Tooltip.hideTooltip(alliance2, pOnlySimObjects: true, text);
					Tooltip.show(alliance2, text, new TooltipData
					{
						alliance = alliance2,
						tooltip_scale = 0.7f,
						is_sim_tooltip = true
					});
				}
			},
			stat_hover = delegate(long pMetaId, MonoBehaviour pField)
			{
				Alliance pObject = World.world.alliances.get(pMetaId);
				if (!pObject.isRekt())
				{
					Tooltip.show(pField, "alliance", new TooltipData
					{
						alliance = pObject
					});
				}
			},
			stat_click = delegate(long pMetaId, MonoBehaviour _)
			{
				Alliance alliance = World.world.alliances.get(pMetaId);
				if (!alliance.isRekt())
				{
					SelectedMetas.selected_alliance = alliance;
					ScrollWindow.showWindow("alliance");
				}
			}
		});
	}

	private MetaZoneGetMetaSimple getZoneDelegate(MetaTypeAsset pMetaTypeAsset)
	{
		return pMetaTypeAsset.getZoneOptionState() switch
		{
			0 => pMetaTypeAsset.tile_get_metaobject_0, 
			1 => pMetaTypeAsset.tile_get_metaobject_1, 
			2 => pMetaTypeAsset.tile_get_metaobject_2, 
			_ => pMetaTypeAsset.tile_get_metaobject_2, 
		};
	}

	private void drawDefaultFluid(MetaTypeAsset pMetaTypeAsset)
	{
		foreach (ZoneMetaData value in ZoneMetaDataVisualizer.zone_data_dict.Values)
		{
			if (value.meta_object != null && value.meta_object.isAlive())
			{
				zone_manager.drawBegin();
				zone_manager.drawGenericFluid(value, pMetaTypeAsset);
				zone_manager.drawEnd(value.zone);
			}
		}
	}

	private void drawDefaultMeta(MetaTypeAsset pMetaTypeAsset)
	{
		MetaZoneGetMetaSimple zoneDelegate = getZoneDelegate(pMetaTypeAsset);
		foreach (Kingdom kingdom in World.world.kingdoms)
		{
			drawForCities(pMetaTypeAsset, kingdom.getCities(), zoneDelegate);
		}
	}

	private void drawForCities(MetaTypeAsset pMetaTypeAsset, IEnumerable<City> pListCities, MetaZoneGetMetaSimple pZoneGetDelegate)
	{
		foreach (City pListCity in pListCities)
		{
			drawZonesForMeta(pMetaTypeAsset, pListCity.zones, pZoneGetDelegate);
		}
	}

	private void drawZonesForMeta(MetaTypeAsset pMetaTypeAsset, List<TileZone> pZones, MetaZoneGetMetaSimple pZoneGetDelegate)
	{
		foreach (TileZone pZone in pZones)
		{
			zone_manager.drawBegin();
			zone_manager.drawZoneMeta(pZone, pMetaTypeAsset, pZoneGetDelegate);
			zone_manager.drawEnd(pZone);
		}
	}

	private void defaultClickActionZone(MetaTypeAsset pMetaTypeAsset)
	{
		PowerTabController.showTabSelectedMeta(pMetaTypeAsset);
	}

	private bool checkCursorTooltipDefault(TileZone pTile, MetaTypeAsset pAsset, int pZoneOption)
	{
		IMetaObject metaObject = pAsset.tile_get_metaobject(pTile, pZoneOption);
		if (metaObject == null)
		{
			return false;
		}
		pAsset.cursor_tooltip_action(metaObject as NanoObject);
		return true;
	}

	private bool checkTileHasMetaDefault(TileZone pZone, MetaTypeAsset pAsset, int pZoneOption)
	{
		return pAsset.tile_get_metaobject(pZone, pZoneOption) != null;
	}

	private void highlightDefault(WorldTile pTile, QuantumSpriteAsset pQAsset, Color pColorAnimated)
	{
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		ZoneMetaData zoneMetaData = ZoneMetaDataVisualizer.getZoneMetaData(pTile.zone);
		if (zoneMetaData.meta_object == null || !zoneMetaData.meta_object.isAlive())
		{
			return;
		}
		using ListPool<TileZone> pZones = ZoneMetaDataVisualizer.getZonesWithMeta(zoneMetaData.meta_object);
		QuantumSpriteLibrary.colorZones(pQAsset, pZones, pColorAnimated);
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (MetaTypeAsset item in list)
		{
			if (item.decision_ids != null)
			{
				item.decisions_assets = new DecisionAsset[item.decision_ids.Length];
				for (int i = 0; i < item.decision_ids.Length; i++)
				{
					string pID = item.decision_ids[i];
					DecisionAsset decisionAsset = AssetManager.decisions_library.get(pID);
					item.decisions_assets[i] = decisionAsset;
				}
			}
			if (!string.IsNullOrEmpty(item.option_id))
			{
				item.option_asset = AssetManager.options_library.get(item.option_id);
			}
		}
	}

	public override void editorDiagnostic()
	{
		base.editorDiagnostic();
	}

	public static int[] generateExponentialRanks(double pBasePoints, double pGrowthFactor)
	{
		int[] array = new int[10];
		double num = pBasePoints;
		for (int i = 1; i <= 10; i++)
		{
			array[i - 1] = roundToNiceNumber(num);
			num += pBasePoints * Math.Pow(pGrowthFactor, i - 1);
		}
		return array;
	}

	private static int roundToNiceNumber(double value)
	{
		if (value < 1000.0)
		{
			return (int)(Math.Round(value / 100.0) * 100.0);
		}
		return (int)(Math.Round(value / 500.0) * 500.0);
	}

	public MetaTypeAsset getAsset(MetaType pType)
	{
		return get(pType.AsString());
	}

	public MetaTypeAsset getFromPower(string pPower)
	{
		GodPower pPower2 = AssetManager.powers.get(pPower);
		return getFromPower(pPower2);
	}

	public MetaTypeAsset getFromPower(GodPower pPower)
	{
		foreach (MetaTypeAsset item in list)
		{
			if (item.power_option_zone_id == pPower.id)
			{
				return item;
			}
		}
		return null;
	}

	public void debug(DebugTool pTool)
	{
		foreach (MetaTypeAsset item in AssetManager.meta_type_library.list)
		{
			NanoObject nanoObject = item.get_selected();
			if (!nanoObject.isRekt())
			{
				pTool.setText(item.id + ":", nanoObject.getTypeID(), 0f, pShowBar: false, 0L);
			}
			else
			{
				pTool.setText(item.id + ":", "-", 0f, pShowBar: false, 0L);
			}
		}
	}
}
// --- End of File: MetaTypeLibrary.cs ---



// --- Start of File: MetaTypeListAction.cs ---
using System.Collections.Generic;

public delegate IEnumerable<NanoObject> MetaTypeListAction();
// --- End of File: MetaTypeListAction.cs ---



// --- Start of File: MetaTypeListHasAction.cs ---
public delegate bool MetaTypeListHasAction();
// --- End of File: MetaTypeListHasAction.cs ---



// --- Start of File: MetaTypeListPoolAction.cs ---
public delegate ListPool<NanoObject> MetaTypeListPoolAction();
// --- End of File: MetaTypeListPoolAction.cs ---



// --- Start of File: MetaUnitSetMetaForWindow.cs ---
public delegate void MetaUnitSetMetaForWindow(Actor pUnit);
// --- End of File: MetaUnitSetMetaForWindow.cs ---



// --- Start of File: MetaZoneClickAction.cs ---
public delegate bool MetaZoneClickAction(WorldTile pTile, string pPower = null);
// --- End of File: MetaZoneClickAction.cs ---



// --- Start of File: MetaZoneDrawAction.cs ---
public delegate void MetaZoneDrawAction(MetaTypeAsset pAsset);
// --- End of File: MetaZoneDrawAction.cs ---



// --- Start of File: MetaZoneDynamicAction.cs ---
public delegate void MetaZoneDynamicAction();
// --- End of File: MetaZoneDynamicAction.cs ---



// --- Start of File: MetaZoneGetMeta.cs ---
public delegate IMetaObject MetaZoneGetMeta(TileZone pZone, int pZoneOption);
// --- End of File: MetaZoneGetMeta.cs ---



// --- Start of File: MetaZoneGetMetaSimple.cs ---
public delegate IMetaObject MetaZoneGetMetaSimple(TileZone pZone);
// --- End of File: MetaZoneGetMetaSimple.cs ---



// --- Start of File: MetaZoneHighlightAction.cs ---
public delegate void MetaZoneHighlightAction(MetaTypeAsset pMetaTypeAsset, WorldTile pTile, QuantumSpriteAsset pAsset);
// --- End of File: MetaZoneHighlightAction.cs ---



// --- Start of File: MetaZoneTooltipAction.cs ---
public delegate bool MetaZoneTooltipAction(TileZone pZone, MetaTypeAsset pAsset, int pZoneOption);
// --- End of File: MetaZoneTooltipAction.cs ---



// --- Start of File: Meteorite.cs ---
using UnityEngine;

public class Meteorite : BaseEffect
{
	private SpriteRenderer _shadow_renderer;

	public Vector3 rotationSpeed = new Vector3(0f, 0f, 50f);

	private float _falling_speed = 200f;

	public GameObject mainSprite;

	public GameObject shadowSprite;

	private int _radius;

	private float _shadow_alpha;

	private float _timer_smoke = 0.01f;

	public string terraform_asset = "meteorite";

	private Actor _owner;

	public override void Awake()
	{
		base.Awake();
		_shadow_renderer = shadowSprite.GetComponent<SpriteRenderer>();
	}

	internal override void create()
	{
		base.create();
	}

	public void spawnOn(WorldTile pTile, string pTerraformId, Actor pActor)
	{
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		terraform_asset = pTerraformId;
		tile = pTile;
		_radius = 20;
		((Component)this).transform.position = new Vector3(pTile.posV3.x, pTile.posV3.y);
		current_position.x = Randy.randomFloat(-200f, 200f);
		current_position.y = Randy.randomFloat(200f, 250f);
		updateMainSpritePos();
		setShadowAlpha(0f);
	}

	private void updateMainSpritePos()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		Vector3 localPosition = default(Vector3);
		localPosition.x = current_position.x;
		localPosition.y = current_position.y;
		float y = current_position.y;
		localPosition.z = y;
		mainSprite.transform.localPosition = localPosition;
	}

	protected void smoothMovement(Vector2 end, float pElapsed)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = current_position - end;
		if (((Vector2)(ref val)).sqrMagnitude > float.Epsilon)
		{
			current_position = Vector2.MoveTowards(current_position, end, _falling_speed * pElapsed);
			updateMainSpritePos();
			shadowSprite.transform.localPosition = Vector2.op_Implicit(new Vector2(current_position.x, shadowSprite.transform.localPosition.y));
		}
		else
		{
			explode();
		}
	}

	public override void update(float pElapsed)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		smoothMovement(Vector2.zero, pElapsed);
		_shadow_alpha += World.world.elapsed * 0.2f;
		setShadowAlpha(_shadow_alpha);
		mainSprite.transform.Rotate(rotationSpeed * World.world.elapsed);
		shadowSprite.transform.Rotate(rotationSpeed * World.world.elapsed);
		if (_timer_smoke > 0f)
		{
			_timer_smoke -= World.world.elapsed;
			return;
		}
		EffectsLibrary.spawnAt("fx_fire_smoke", mainSprite.transform.position, 1f);
		_timer_smoke = 0.05f;
	}

	protected void setShadowAlpha(float pVal)
	{
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		_shadow_alpha = pVal;
		if (_shadow_alpha < 0f)
		{
			_shadow_alpha = 0f;
		}
		Color color = _shadow_renderer.color;
		color.a = _shadow_alpha;
		_shadow_renderer.color = color;
	}

	private void explode()
	{
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		World.world.game_stats.data.meteoritesLaunched++;
		MapAction.damageWorld(tile, _radius, AssetManager.terraform.get(terraform_asset), _owner);
		EffectsLibrary.spawnExplosionWave(tile.posV3, _radius);
		Vector2Int pos = tile.pos;
		float num = ((Vector2Int)(ref pos)).x;
		pos = tile.pos;
		Vector3 pPos = default(Vector3);
		((Vector3)(ref pPos))._002Ector(num, (float)(((Vector2Int)(ref pos)).y - 2));
		float pScale = Randy.randomFloat(0.8f, 0.9f);
		EffectsLibrary.spawnAt("fx_explosion_meteorite", pPos, pScale);
		addRandomMineral(tile);
		addRandomMineral(tile.zone.getRandomTile());
		addRandomMineral(tile.zone.getRandomTile());
		addRandomMineral(tile.zone.getRandomTile());
		addRandomMineral(tile.zone.getRandomTile());
		controller.killObject(this);
	}

	private void addRandomMineral(WorldTile pTile)
	{
		if (pTile != null)
		{
			World.world.buildings.addBuilding("mineral_adamantine", pTile, pCheckForBuild: true);
		}
	}

	public static void spawnMeteoriteDisaster(WorldTile pTile, Actor pActor = null)
	{
		EffectsLibrary.spawn("fx_meteorite", pTile, "meteorite_disaster", null, 0f, -1f, -1f, pActor);
	}

	public static void spawnMeteorite(WorldTile pTile, Actor pActor = null)
	{
		EffectsLibrary.spawn("fx_meteorite", pTile, "meteorite", null, 0f, -1f, -1f, pActor);
	}
}
// --- End of File: Meteorite.cs ---



// --- Start of File: MindLibrary.cs ---
namespace ai.behaviours;

public class MindLibrary : BehaviourTaskActorLibrary
{
}
// --- End of File: MindLibrary.cs ---



// --- Start of File: MiniBench.cs ---
using System;
using System.Diagnostics;
using UnityEngine;

public readonly struct MiniBench : IDisposable
{
	private readonly string _id;

	private readonly Stopwatch _sw;

	private readonly long _dont_show_below_ms;

	private const string _COLOR_WARN = "<color=yellow>";

	private const string _COLOR_SLOW = "<color=red>";

	private static int MAX_LOG_LENGTH = 38;

	public MiniBench(string pID)
	{
		_id = pID;
		_sw = new Stopwatch();
		_sw.Start();
		_dont_show_below_ms = 0L;
	}

	public MiniBench(string pID, long pDontShowBelowMs)
	{
		_id = pID;
		_sw = new Stopwatch();
		_sw.Start();
		_dont_show_below_ms = pDontShowBelowMs;
	}

	public void Dispose()
	{
		_sw.Stop();
		long elapsedMilliseconds = _sw.ElapsedMilliseconds;
		if (elapsedMilliseconds >= _dont_show_below_ms)
		{
			string text = ((elapsedMilliseconds > 999) ? "<color=red>" : ((elapsedMilliseconds <= 499) ? "" : "<color=yellow>"));
			string text2 = text;
			string text3 = ((elapsedMilliseconds > 499) ? "</color>" : "");
			double totalSeconds = _sw.Elapsed.TotalSeconds;
			if (_id.Length + 2 > MAX_LOG_LENGTH)
			{
				MAX_LOG_LENGTH = _id.Length + 2;
			}
			Debug.Log((object)(Toolbox.fillRight("[" + _id + "]", MAX_LOG_LENGTH) + " = " + text2 + totalSeconds.ToString("F6") + text3));
		}
	}
}
// --- End of File: MiniBench.cs ---



// --- Start of File: MinMax.cs ---
public readonly struct MinMax
{
	public readonly long min;

	public readonly long max;

	public MinMax(long pMin, long pMax)
	{
		min = pMin;
		max = pMax;
	}
}
// --- End of File: MinMax.cs ---



// --- Start of File: ModLoader.cs ---
using System;
using System.Collections.Generic;
using System.IO;
using System.Reflection;
using UnityEngine;

public class ModLoader : MonoBehaviour
{
	private bool initialized;

	private static List<string> modsLoaded = new List<string>();

	private const string MODS_FOLDER = "mods";

	public void Update()
	{
		if (Config.game_loaded && Config.experimental_mode && !initialized)
		{
			initialized = true;
			Initialize();
			((Behaviour)this).enabled = false;
		}
	}

	internal static List<string> getModsLoaded()
	{
		return modsLoaded;
	}

	public void Initialize()
	{
		//IL_0329: Unknown result type (might be due to invalid IL or missing references)
		//IL_032e: Unknown result type (might be due to invalid IL or missing references)
		string path = Path.Combine(Application.streamingAssetsPath, "mods");
		if (!Directory.Exists(path))
		{
			Debug.LogError((object)"Can not find mod dlls - there is no 'Mods' folder");
			return;
		}
		using ListPool<FileInfo> listPool = new ListPool<FileInfo>(new DirectoryInfo(path).GetFiles());
		listPool.RemoveAll((FileInfo file) => !file.Name.ToLower().EndsWith(".dll"));
		HashSet<string> tCheckFilenames = new HashSet<string>();
		foreach (ref FileInfo item3 in listPool)
		{
			string item = item3.Name.ToLower();
			tCheckFilenames.Add(item);
		}
		listPool.RemoveAll(delegate(FileInfo tFileInfo)
		{
			string text6 = tFileInfo.Name.ToLower();
			if (!text6.EndsWith("_memload.dll"))
			{
				return false;
			}
			string item2 = text6.Replace("_memload.dll", ".dll");
			return tCheckFilenames.Contains(item2) ? true : false;
		});
		listPool.Shuffle();
		foreach (ref FileInfo item4 in listPool)
		{
			FileInfo current = item4;
			bool flag = false;
			if (!current.Name.ToLower().EndsWith(".dll"))
			{
				continue;
			}
			string text = current.FullName;
			string? directoryName = Path.GetDirectoryName(text);
			string text2 = Path.GetFileNameWithoutExtension(current.Name).Replace("_memload", "");
			string text3 = text2;
			string text4 = text2 + "_memload.dll";
			string text5 = Path.Combine(directoryName, text4);
			if (File.Exists(text5))
			{
				flag = true;
				text3 = Path.GetFileNameWithoutExtension(text4);
				text = text5;
				Debug.Log((object)("[" + text2 + "] Loading " + current.Name + " into memory"));
			}
			else
			{
				flag = false;
				Debug.Log((object)("[" + text2 + "] Loading " + current.Name));
			}
			try
			{
				Assembly assembly;
				if (!flag)
				{
					assembly = Assembly.LoadFile(text);
				}
				else
				{
					byte[] rawAssembly = File.ReadAllBytes(text);
					string path2 = Path.Combine(Path.GetDirectoryName(text), text3 + ".pdb");
					if (File.Exists(path2))
					{
						Debug.Log((object)("[" + text2 + "] .pdb symbol file found"));
						try
						{
							byte[] rawSymbolStore = File.ReadAllBytes(path2);
							assembly = Assembly.Load(rawAssembly, rawSymbolStore);
						}
						catch (Exception ex)
						{
							Debug.LogError((object)("[" + text2 + "] Failed to load with .pdb symbol file"));
							Debug.LogError((object)ex.Message);
							assembly = Assembly.Load(rawAssembly);
						}
					}
					else
					{
						assembly = Assembly.Load(rawAssembly);
					}
				}
				Debug.Log((object)("[" + text2 + "] Assembly: " + assembly));
				Debug.Log((object)("[" + text2 + "] classes inside the mod:"));
				Type[] types = assembly.GetTypes();
				for (int i = 0; i < types.Length; i++)
				{
					Debug.Log((object)("[" + text2 + "] " + types[i]));
				}
				Debug.Log((object)("[" + text2 + "] Attempting to load " + text2 + ".WorldBoxMod"));
				Type type = assembly.GetType(text2 + ".WorldBoxMod");
				if (type != null)
				{
					GameObject val = new GameObject(text2);
					val.transform.parent = ((Component)this).transform;
					val.AddComponent(type);
					modsLoaded.Add(text2);
					Config.MODDED = true;
					Debug.Log((object)("[" + text2 + "] Was added"));
				}
				else
				{
					Debug.LogError((object)("[" + text2 + "] Missing className: " + text2 + ".WorldBoxMod"));
				}
			}
			catch (Exception ex2)
			{
				Debug.Log((object)("[" + text2 + "] Failed to load mod from path : "));
				Debug.Log((object)("[" + text2 + "] " + text));
				Debug.LogError((object)ex2.Message);
			}
		}
	}
}
// --- End of File: ModLoader.cs ---



// --- Start of File: MonthAsset.cs ---
using System;

[Serializable]
public class MonthAsset : Asset, IDescriptionAsset, ILocalizedAsset
{
	public string english_name;

	public int month_index;

	public string getLocaleID()
	{
		return id;
	}

	public string getDescriptionID()
	{
		return "inflected_" + id;
	}
}
// --- End of File: MonthAsset.cs ---



// --- Start of File: MonthLibrary.cs ---
using System.Collections.Generic;

public class MonthLibrary : AssetLibrary<MonthAsset>
{
	private Dictionary<int, MonthAsset> _month_indexes;

	public override void init()
	{
		base.init();
		add(new MonthAsset
		{
			id = "month_1",
			english_name = "january",
			month_index = 1
		});
		add(new MonthAsset
		{
			id = "month_2",
			english_name = "february",
			month_index = 2
		});
		add(new MonthAsset
		{
			id = "month_3",
			english_name = "march",
			month_index = 3
		});
		add(new MonthAsset
		{
			id = "month_4",
			english_name = "april",
			month_index = 4
		});
		add(new MonthAsset
		{
			id = "month_5",
			english_name = "may",
			month_index = 5
		});
		add(new MonthAsset
		{
			id = "month_6",
			english_name = "june",
			month_index = 6
		});
		add(new MonthAsset
		{
			id = "month_7",
			english_name = "july",
			month_index = 7
		});
		add(new MonthAsset
		{
			id = "month_8",
			english_name = "august",
			month_index = 8
		});
		add(new MonthAsset
		{
			id = "month_9",
			english_name = "september",
			month_index = 9
		});
		add(new MonthAsset
		{
			id = "month_10",
			english_name = "october",
			month_index = 10
		});
		add(new MonthAsset
		{
			id = "month_11",
			english_name = "november",
			month_index = 11
		});
		add(new MonthAsset
		{
			id = "month_12",
			english_name = "december",
			month_index = 12
		});
	}

	public override void linkAssets()
	{
		base.linkAssets();
		_month_indexes = new Dictionary<int, MonthAsset>();
		foreach (MonthAsset item in list)
		{
			_month_indexes.Add(item.month_index, item);
		}
	}

	public MonthAsset getMonth(int pMonthIndex)
	{
		return _month_indexes[pMonthIndex];
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (MonthAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
	}
}
// --- End of File: MonthLibrary.cs ---



// --- Start of File: MoodAsset.cs ---
using System;
using Beebyte.Obfuscator;
using UnityEngine;

[Serializable]
[ObfuscateLiterals]
public class MoodAsset : Asset
{
	public BaseStats base_stats = new BaseStats();

	public string icon;

	[NonSerialized]
	public Sprite sprite;

	public Sprite getSprite()
	{
		if ((Object)(object)sprite == (Object)null)
		{
			sprite = SpriteTextureLoader.getSprite("ui/Icons/" + icon);
		}
		return sprite;
	}
}
// --- End of File: MoodAsset.cs ---



// --- Start of File: MoodLibrary.cs ---
public class MoodLibrary : AssetLibrary<MoodAsset>
{
	public override void init()
	{
		base.init();
		add(new MoodAsset
		{
			id = "sad",
			icon = "iconMoodSad"
		});
		t.base_stats["multiplier_speed"] = -0.2f;
		t.base_stats["multiplier_diplomacy"] = -0.1f;
		t.base_stats["loyalty_mood"] = -5f;
		t.base_stats["opinion"] = -5f;
		add(new MoodAsset
		{
			id = "normal",
			icon = "iconMoodNormal"
		});
		add(new MoodAsset
		{
			id = "happy",
			icon = "iconMoodHappy"
		});
		t.base_stats["multiplier_speed"] = 0.1f;
		t.base_stats["multiplier_diplomacy"] = 0.1f;
		t.base_stats["loyalty_mood"] = 10f;
		t.base_stats["opinion"] = 10f;
		add(new MoodAsset
		{
			id = "angry",
			icon = "iconMoodAngry"
		});
		t.base_stats["multiplier_speed"] = 0.1f;
		t.base_stats["multiplier_diplomacy"] = -0.3f;
		t.base_stats["loyalty_mood"] = -15f;
		t.base_stats["opinion"] = -15f;
		add(new MoodAsset
		{
			id = "dark"
		});
		t.base_stats["loyalty_mood"] = -20f;
		t.base_stats["opinion"] = -20f;
	}
}
// --- End of File: MoodLibrary.cs ---



// --- Start of File: MouseCursor.cs ---
using UnityEngine;

public class MouseCursor : MonoBehaviour
{
	private const int CURSOR_DEFAULT_0 = 0;

	private const int CURSOR_DOWN_1 = 1;

	private const int CURSOR_UP_2 = 2;

	private const int CURSOR_HOLD_6 = 6;

	private const int CURSOR_DRAG_7 = 7;

	private const int CURSOR_PINKIE_8 = 8;

	private const int CURSOR_SPRINKLE_13 = 13;

	private const int CURSOR_DRAW_17 = 17;

	private const int CURSOR_ATTACK = 22;

	private const int CURSOR_INSPECT = 26;

	private const int CURSOR_OVER_UI = 27;

	private const int CLICK_FRAMES = 6;

	private const int UP_FRAMES = 4;

	private const int PINKIE_FRAMES = 5;

	private const int SPRINKLE_FRAMES = 4;

	private const int DRAW_FRAMES = 5;

	private const int ATTACK_FRAMES = 4;

	private const int ANIM_SPEED = 5;

	public Texture2D mouseCursorDefault;

	public Texture2D mouseCursorDown;

	public Texture2D mouseCursorUp1;

	public Texture2D mouseCursorUp2;

	public Texture2D mouseCursorUp3;

	public Texture2D mouseCursorUp4;

	public Texture2D mouseCursorHold;

	public Texture2D mouseCursorDrag;

	public Texture2D mouseCursorPinkie1;

	public Texture2D mouseCursorPinkie2;

	public Texture2D mouseCursorPinkie3;

	public Texture2D mouseCursorPinkie4;

	public Texture2D mouseCursorPinkie5;

	public Texture2D mouseCursorSprinkle1;

	public Texture2D mouseCursorSprinkle2;

	public Texture2D mouseCursorSprinkle3;

	public Texture2D mouseCursorSprinkle4;

	public Texture2D mouseCursorDraw1;

	public Texture2D mouseCursorDraw2;

	public Texture2D mouseCursorDraw3;

	public Texture2D mouseCursorDraw4;

	public Texture2D mouseCursorDraw5;

	public Texture2D mouseCursorAttack1;

	public Texture2D mouseCursorAttack2;

	public Texture2D mouseCursorAttack3;

	public Texture2D mouseCursorAttack4;

	public Texture2D mouseCursorInspect;

	public Texture2D mouseCursorOverUI;

	private static int _counter = 0;

	private static bool _pressed = false;

	private static int _pressing = 0;

	private static int _dragged = 0;

	private static bool _right = false;

	private static bool _middle = false;

	private static bool _anim_done = true;

	private static int _cur_cursor = -1;

	private static Texture2D[] _cursors;

	private static int _last_texture_id = -1;

	private static bool _can_drag = false;

	private static bool _selected_unit_attack = false;

	private static MouseHoldAnimation _mouse_hold_animation = MouseHoldAnimation.Default;

	private static Texture2D _selected_cursor_texture;

	private void Awake()
	{
		if (!Input.mousePresent)
		{
			Object.Destroy((Object)(object)this);
			return;
		}
		_cursors = (Texture2D[])(object)new Texture2D[28]
		{
			mouseCursorDefault, mouseCursorDown, mouseCursorUp1, mouseCursorUp2, mouseCursorUp3, mouseCursorUp4, mouseCursorHold, mouseCursorDrag, mouseCursorPinkie1, mouseCursorPinkie2,
			mouseCursorPinkie3, mouseCursorPinkie4, mouseCursorPinkie5, mouseCursorSprinkle1, mouseCursorSprinkle2, mouseCursorSprinkle3, mouseCursorSprinkle4, mouseCursorDraw1, mouseCursorDraw2, mouseCursorDraw3,
			mouseCursorDraw4, mouseCursorDraw5, mouseCursorAttack1, mouseCursorAttack2, mouseCursorAttack3, mouseCursorAttack4, mouseCursorInspect, mouseCursorOverUI
		};
	}

	private void OnEnable()
	{
		setCursorDefault();
	}

	private void Update()
	{
		if (Input.GetMouseButtonDown(0) || Input.GetMouseButtonDown(1) || Input.GetMouseButtonDown(2))
		{
			if (!_pressed)
			{
				_pressing = 0;
				_dragged = 0;
				_counter = 0;
			}
			_pressed = true;
			_anim_done = false;
			_right = Input.GetMouseButtonDown(1);
			_middle = Input.GetMouseButtonDown(2);
		}
		else if (Input.GetMouseButtonUp(0) || Input.GetMouseButtonUp(1) || Input.GetMouseButtonUp(2))
		{
			if (!Input.anyKey)
			{
				_pressed = false;
				_pressing = 0;
				_dragged = 0;
				_right = Input.GetMouseButtonUp(1);
				_middle = Input.GetMouseButtonUp(2);
			}
			else
			{
				_right = Input.GetMouseButton(1);
				_middle = Input.GetMouseButton(2);
			}
		}
		else if (_pressed)
		{
			if (!Input.anyKey)
			{
				_pressed = false;
				_pressing = 0;
				_dragged = 0;
				_right = false;
				_middle = false;
			}
			else
			{
				_right = Input.GetMouseButton(1);
				_middle = Input.GetMouseButton(2);
				_pressing++;
				if (Config.isDraggingItem())
				{
					_dragged++;
				}
			}
		}
		_can_drag = World.world.isOverUI() || World.world.canDragMap();
		_selected_unit_attack = ControllableUnit.isControllingUnit();
		_mouse_hold_animation = World.world.getSelectedPowerHoldAnimation();
		if (_selected_unit_attack)
		{
			setCursor(22);
		}
		else if (_can_drag && Config.isDraggingItem() && _pressed && _dragged > 3)
		{
			if (_dragged < 10)
			{
				setCursor(6);
			}
			else
			{
				setCursor(7);
			}
		}
		else if (!_pressed && _anim_done)
		{
			if (shouldShowInspectCursor())
			{
				setCursorInspect();
			}
			else if (_right)
			{
				setCursor(8);
			}
			else
			{
				setCursorDefault();
			}
			_counter = 0;
		}
		else if (_can_drag && _pressed && _pressing > 3)
		{
			if (!World.world.isOverUI() || World.world.player_control.isPointerOverUIScroll())
			{
				if (_pressing < 10)
				{
					setCursor(6);
				}
				else
				{
					setCursor(7);
				}
			}
			else if (_right)
			{
				setCursor(8);
			}
			else
			{
				setCursor(1);
			}
		}
		else if (!_pressed && shouldShowInspectCursor())
		{
			setCursorInspect();
		}
		else if (_right)
		{
			int num = Mathf.CeilToInt((float)(_counter / 5));
			if (num > 0 && num < 5)
			{
				setCursor(num + 8);
			}
			else
			{
				setCursor(8);
			}
			_counter++;
			if (_counter > 40)
			{
				_counter = 0;
				if (!_pressed)
				{
					_anim_done = true;
				}
			}
		}
		else
		{
			int num2 = 10;
			int num3 = 0;
			switch (_mouse_hold_animation)
			{
			case MouseHoldAnimation.Sprinkle:
				num2 = 4;
				num3 = Mathf.CeilToInt((float)(_counter / 5)) % 4;
				setCursor(13 + num3);
				break;
			case MouseHoldAnimation.Draw:
				num2 = 5;
				num3 = Mathf.CeilToInt((float)(_counter / 5)) % 5;
				setCursor(17 + num3);
				break;
			default:
				num2 = 6;
				num3 = Mathf.CeilToInt((float)(_counter / 5));
				if (num3 < 6)
				{
					setCursor(num3);
				}
				else
				{
					setCursorDefault();
				}
				break;
			}
			_counter++;
			if (_counter >= num2 * 5 && !_pressed)
			{
				_anim_done = true;
			}
		}
		renderCursor();
	}

	private void renderCursor()
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		int num = -1;
		if ((Object)(object)_selected_cursor_texture != (Object)null)
		{
			num = ((object)_selected_cursor_texture).GetHashCode();
		}
		if (_last_texture_id != num)
		{
			Cursor.SetCursor(_selected_cursor_texture, Vector2.zero, (CursorMode)0);
			_last_texture_id = num;
		}
	}

	private void setCursor(int pCursor = -1)
	{
		_cur_cursor = pCursor;
		_selected_cursor_texture = _cursors[pCursor];
		if ((Object)(object)_selected_cursor_texture == (Object)null)
		{
			_selected_cursor_texture = mouseCursorDefault;
		}
	}

	private bool shouldShowInspectCursor()
	{
		if (UnitSelectionEffect.last_actor != null)
		{
			return true;
		}
		if (World.world.isOverUI())
		{
			return false;
		}
		if (ScrollWindow.isWindowActive())
		{
			return false;
		}
		if (World.world.quality_changer.isLowRes())
		{
			WorldTile mouseTilePosCachedFrame = World.world.getMouseTilePosCachedFrame();
			if (mouseTilePosCachedFrame == null)
			{
				return false;
			}
			if (Zones.showMapBorders())
			{
				MetaTypeAsset cachedMapMetaAsset = World.world.getCachedMapMetaAsset();
				if (cachedMapMetaAsset == null)
				{
					return false;
				}
				if (cachedMapMetaAsset.check_tile_has_meta(mouseTilePosCachedFrame.zone, cachedMapMetaAsset, cachedMapMetaAsset.getZoneOptionState()))
				{
					return true;
				}
			}
		}
		if (World.world.nameplate_manager.isOverNameplate())
		{
			return true;
		}
		return false;
	}

	private void setCursorDefault()
	{
		MapBox world = World.world;
		if (world != null && world.isOverUiButton())
		{
			setCursor(27);
		}
		else
		{
			setCursor(0);
		}
	}

	private void setCursorInspect()
	{
		setCursor(26);
	}

	public static void debug(DebugTool pTool)
	{
		pTool.setText("_counter:", _counter, 0f, pShowBar: false, 0L);
		pTool.setText("_cur_cursor:", _cur_cursor, 0f, pShowBar: false, 0L);
		string text = "null";
		pTool.setText("_cur_cursor:", _cur_cursor switch
		{
			0 => "mouseCursorDefault", 
			1 => "mouseCursorDown", 
			2 => "mouseCursorUp1", 
			3 => "mouseCursorUp2", 
			4 => "mouseCursorUp3", 
			5 => "mouseCursorUp4", 
			6 => "mouseCursorHold", 
			7 => "mouseCursorDrag", 
			8 => "mouseCursorPinkie1", 
			9 => "mouseCursorPinkie2", 
			10 => "mouseCursorPinkie3", 
			11 => "mouseCursorPinkie4", 
			12 => "mouseCursorPinkie5", 
			13 => "mouseCursorSprinkle1", 
			14 => "mouseCursorSprinkle2", 
			15 => "mouseCursorSprinkle3", 
			16 => "mouseCursorSprinkle4", 
			17 => "mouseCursorDraw1", 
			18 => "mouseCursorDraw2", 
			19 => "mouseCursorDraw3", 
			20 => "mouseCursorDraw4", 
			21 => "mouseCursorDraw5", 
			_ => _cur_cursor.ToString(), 
		}, 0f, pShowBar: false, 0L);
		pTool.setText("_pressed:", _pressed, 0f, pShowBar: false, 0L);
		pTool.setText("_pressing:", _pressing, 0f, pShowBar: false, 0L);
		pTool.setText("_dragged:", _dragged, 0f, pShowBar: false, 0L);
		pTool.setText("_right:", _right, 0f, pShowBar: false, 0L);
		pTool.setText("_middle:", _middle, 0f, pShowBar: false, 0L);
		pTool.setText("_anim_done:", _anim_done, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("_can_drag:", _can_drag, 0f, pShowBar: false, 0L);
		pTool.setText("_hold_animation:", _mouse_hold_animation, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("_last_texture_id:", _last_texture_id, 0f, pShowBar: false, 0L);
		pTool.setText("_selected_cursor_texture:", ((object)_selected_cursor_texture).GetHashCode().ToString(), 0f, pShowBar: false, 0L);
	}
}
// --- End of File: MouseCursor.cs ---



// --- Start of File: MouseHoldAnimation.cs ---
public enum MouseHoldAnimation
{
	Default,
	Sprinkle,
	Draw
}
// --- End of File: MouseHoldAnimation.cs ---



// --- Start of File: MoveCamera.cs ---
using System;
using System.Runtime.CompilerServices;
using UnityEngine;

public class MoveCamera : BaseMapObject
{
	private Vector3 _origin;

	private bool _is_zooming;

	internal const float ORTHOGRAPHIC_SIZE_MIN = 10f;

	internal float orthographic_size_max = 130f;

	private float _target_zoom;

	private Vector3 _first_touch;

	internal Camera main_camera;

	internal static MoveCamera instance;

	private WhooshState _whoosh_state;

	private Action _focus_reached_callback;

	private Action _focus_cancel_callback;

	private float _focus_zoom = -1000000f;

	private float _focus_timer;

	private static Actor _focus_unit;

	private static bool _spectator_mode;

	private static float _touch_dist;

	public static bool camera_drag_activated;

	public static int camera_drag_activated_frame;

	public static bool camera_drag_run;

	private float _last_width;

	private float _last_height;

	private bool _first_touch_on_ui;

	internal float camera_zoom_speed = 5f;

	internal float camera_move_speed = 0.01f;

	internal float camera_move_max = 0.06f;

	private Vector2 _move_velocity;

	private readonly Vector2?[] _old_touch_positions = new Vector2?[2];

	private Vector2 _old_touch_vector;

	private float _old_touch_distance;

	private Rect _visible_bounds;

	private Rect _visible_bounds_without_power_bar;

	public float power_bar_position_y;

	private bool _skip_reset_zoom;

	private bool _mouse_controls_used_last;

	private void Awake()
	{
		instance = this;
		main_camera = Camera.main;
	}

	internal override void create()
	{
		base.create();
		resetZoom();
		_target_zoom = main_camera.orthographicSize;
	}

	public static Actor getFocusUnit()
	{
		return _focus_unit;
	}

	public static void setFocusUnit(Actor pActor)
	{
		_focus_unit = pActor;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool hasFocusUnit()
	{
		return _focus_unit != null;
	}

	public static bool isCameraFollowingUnit(Actor pActor)
	{
		return _focus_unit == pActor;
	}

	internal void focusOn(Vector3 pPos)
	{
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		clearFocusUnitAndUnselect();
		_target_zoom = 15f;
		_focus_zoom = _target_zoom;
		pPos.z = ((Component)this).transform.position.z;
		((Component)this).transform.position = pPos;
	}

	internal void focusOn(Vector3 pPos, Action pFocusReachedCallback, Action pFocusCancelCallback)
	{
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		clearFocusUnitAndUnselect();
		_target_zoom = 15f;
		_focus_zoom = _target_zoom;
		_focus_reached_callback = pFocusReachedCallback;
		_focus_cancel_callback = pFocusCancelCallback;
		pPos.z = ((Component)this).transform.position.z;
		((Component)this).transform.position = pPos;
	}

	internal void focusOnAndFollow(Actor pActor, Action pFocusReachedCallback, Action pFocusCancelCallback)
	{
		clearFocusUnitAndUnselect();
		Config.ui_main_hidden = false;
		_target_zoom = 15f;
		_focus_zoom = _target_zoom;
		_focus_reached_callback = pFocusReachedCallback;
		_focus_cancel_callback = pFocusCancelCallback;
		_focus_unit = pActor;
		_focus_timer = 0f;
		WorldTip.addWordReplacement("$name$", _focus_unit.coloredName);
		WorldTip.showNowTop("tip_following_unit");
		PowerTracker.spectatingUnit(_focus_unit.getName());
		PowerButtonSelector.instance.setPower(PowerButtonSelector.instance.followUnit);
	}

	internal void resetZoom()
	{
		int num = ((Screen.width >= Screen.height) ? (Screen.height / 4) : (Screen.width / 4));
		if (MapBox.width > MapBox.height)
		{
			orthographic_size_max = (int)((float)MapBox.width * 1.1f);
		}
		else
		{
			orthographic_size_max = (int)((float)MapBox.height * 1.1f);
		}
		if ((float)num > orthographic_size_max)
		{
			num = (int)orthographic_size_max;
		}
		_target_zoom = num;
		main_camera.orthographicSize = Mathf.Clamp(_target_zoom, 10f, orthographic_size_max);
		World.world.setZoomOrthographic(main_camera.orthographicSize);
		_mouse_controls_used_last = false;
		main_camera.farClipPlane = (float)MapBox.height * 1.1f;
	}

	public void forceZoom(float pZoom)
	{
		_target_zoom = pZoom;
		zoomToBounds(pForce: true);
	}

	public void setTargetZoom(float pValue)
	{
		_target_zoom = pValue;
	}

	public float getTargetZoom()
	{
		return _target_zoom;
	}

	private void updateZoomControls()
	{
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.touchSupported)
		{
			bool flag = false;
			if (UltimateJoystick.getJoyCount() == 2)
			{
				flag = UltimateJoystick.GetJoystickState("JoyRight") || UltimateJoystick.GetJoystickState("JoyLeft");
			}
			if (flag)
			{
				return;
			}
			bool flag2 = !World.world.player_control.already_used_power || ControllableUnit.isControllingUnit();
			if (InputHelpers.touchCount == 2 && flag2)
			{
				World.world.player_control.already_used_zoom = true;
				Touch touch = Input.GetTouch(0);
				Touch touch2 = Input.GetTouch(1);
				Vector2 val = ((Touch)(ref touch)).position - ((Touch)(ref touch)).deltaPosition;
				Vector2 val2 = ((Touch)(ref touch2)).position - ((Touch)(ref touch2)).deltaPosition;
				Vector2 val3 = val - val2;
				float magnitude = ((Vector2)(ref val3)).magnitude;
				val3 = ((Touch)(ref touch)).position - ((Touch)(ref touch2)).position;
				float magnitude2 = ((Vector2)(ref val3)).magnitude;
				float num = magnitude - magnitude2;
				_target_zoom += num * 0.2f * (main_camera.orthographicSize * 0.015f);
			}
		}
		if (inSpectatorMode())
		{
			followFocusUnit();
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool inSpectatorMode()
	{
		if (_spectator_mode && !hasFocusUnit())
		{
			instance.clearFocusUnitAndUnselect();
		}
		_spectator_mode = hasFocusUnit();
		return _spectator_mode;
	}

	private void checkFocusReached()
	{
		if (main_camera.orthographicSize == _focus_zoom)
		{
			if (_focus_reached_callback != null)
			{
				_focus_reached_callback();
			}
			clearFocus();
		}
		if (_target_zoom != _focus_zoom)
		{
			if (_focus_cancel_callback != null)
			{
				_focus_cancel_callback();
			}
			clearFocus();
		}
	}

	private void followFocusUnit()
	{
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0170: Unknown result type (might be due to invalid IL or missing references)
		//IL_0122: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_014a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0154: Unknown result type (might be due to invalid IL or missing references)
		if (!hasFocusUnit())
		{
			return;
		}
		Actor focus_unit = _focus_unit;
		if (!focus_unit.isAlive())
		{
			Actor actor = focus_unit.attackedBy?.a;
			if (actor != null && actor.isAlive())
			{
				WorldTip.addWordReplacement("$name$", focus_unit.coloredName);
				WorldTip.addWordReplacement("$killer$", actor.coloredName);
				WorldTip.showNowTop("tip_followed_unit_killed");
				Actor a = actor.a;
				focus_unit.attackedBy = null;
				setFocusUnit(a);
				_focus_timer = 0f;
			}
			else
			{
				WorldTip.addWordReplacement("$name$", focus_unit.coloredName);
				WorldTip.showNowTop("tip_followed_unit_died");
				clearFocusUnitAndUnselect();
			}
		}
		else if (camera_drag_run || InputHelpers.touchCount > 0)
		{
			_focus_timer = 0f;
		}
		else
		{
			Vector3 val = Vector2.op_Implicit(focus_unit.current_position);
			val.z = ((Component)this).transform.position.z;
			if (_focus_timer <= 1f)
			{
				_focus_timer += Time.deltaTime;
				_focus_timer = Mathf.Clamp(_focus_timer, 0f, 1f);
				val.x = iTween.easeOutCubic(((Component)this).transform.position.x, val.x, _focus_timer);
				val.y = iTween.easeOutCubic(((Component)this).transform.position.y, val.y, _focus_timer);
			}
			((Component)this).transform.position = val;
		}
	}

	private void clearFocus()
	{
		_focus_reached_callback = null;
		_focus_cancel_callback = null;
		_focus_zoom = -1000000f;
	}

	public static void clearFocusUnitOnly()
	{
		_focus_unit = null;
	}

	internal void clearFocusUnitAndUnselect()
	{
		clearFocusUnitOnly();
		_focus_timer = 0f;
		if (World.world.isSelectedPower("follow_unit"))
		{
			PowerButtonSelector.instance.unselectAll();
		}
	}

	private void zoomToBounds(bool pForce = false)
	{
		float num = (World.world.player_control.isSelectionHappens() ? World.world.quality_changer.getZoomRateBoundLow() : orthographic_size_max);
		_target_zoom = Mathf.Clamp(_target_zoom, 10f, num);
		if (main_camera.orthographicSize == _target_zoom)
		{
			return;
		}
		if (_target_zoom > main_camera.orthographicSize)
		{
			Camera obj = main_camera;
			obj.orthographicSize += Time.deltaTime * camera_zoom_speed * (Mathf.Abs(main_camera.orthographicSize - _target_zoom) + 5f);
			if (main_camera.orthographicSize > _target_zoom)
			{
				main_camera.orthographicSize = Mathf.Clamp(_target_zoom, 10f, orthographic_size_max);
			}
		}
		else if (_target_zoom < main_camera.orthographicSize)
		{
			Camera obj2 = main_camera;
			obj2.orthographicSize -= Time.deltaTime * camera_zoom_speed * (Mathf.Abs(main_camera.orthographicSize - _target_zoom) + 5f);
			if (main_camera.orthographicSize < _target_zoom)
			{
				main_camera.orthographicSize = Mathf.Clamp(_target_zoom, 10f, orthographic_size_max);
			}
		}
		if (pForce)
		{
			main_camera.orthographicSize = _target_zoom;
		}
		World.world.setZoomOrthographic(main_camera.orthographicSize);
	}

	private void updateMouseCameraDrag()
	{
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_010b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0110: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_0116: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0133: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01be: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0204: Unknown result type (might be due to invalid IL or missing references)
		//IL_0209: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01df: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_020f: Unknown result type (might be due to invalid IL or missing references)
		if (ControllableUnit.isControllingUnit())
		{
			return;
		}
		camera_drag_run = false;
		bool flag = false;
		bool flag2 = false;
		if (InputHelpers.mouseSupported)
		{
			flag = checkMouseInputDown();
			flag2 = checkMouseInput();
		}
		if (!flag2)
		{
			clearTouches();
			return;
		}
		if (flag && World.world.isOverUI())
		{
			clearTouches();
			return;
		}
		if (flag && _origin.x == -1f && _origin.z == -1f)
		{
			_origin = getMousePos();
		}
		if ((_origin.x == -1f && _origin.y == -1f && _origin.z == -1f) || !flag2)
		{
			return;
		}
		camera_drag_run = true;
		Vector3 position = ((Component)this).transform.position;
		position.z = 0f;
		Vector3 val = getMousePos() - position;
		if (Toolbox.DistVec3(_origin, getMousePos()) > 0.1f)
		{
			camera_drag_activated = true;
			camera_drag_activated_frame = Time.frameCount;
		}
		Vector3 val2 = _origin - val;
		val2.z = 0f;
		if (InputHelpers.touchSupported)
		{
			_touch_dist = Toolbox.DistVec3(_first_touch, getTouchPos(pScreenCoords: true));
			if (World.world.player_control.touch_ticks_skip > 5)
			{
				if (_touch_dist >= 20f || (float)World.world.player_control.touch_ticks_skip > 0.3f)
				{
					World.world.player_control.already_used_zoom = true;
					World.world.player_control.already_used_power = false;
				}
			}
			else if (InputHelpers.touchCount == 1)
			{
				return;
			}
		}
		if (InputHelpers.mouseSupported)
		{
			Vector3 val3 = position;
			((Component)this).transform.position = val2;
			Vector2 val4 = Vector2.op_Implicit(val2 - val3);
			if (((Vector2)(ref val4)).magnitude > 0.01f)
			{
				Vector2 val5 = val4 * 0.2f;
				addVelocity(val5.x, val5.y);
				_mouse_controls_used_last = true;
			}
			else
			{
				_move_velocity = Vector2.zero;
			}
			checkDistanceMoved(val3);
			cameraToBounds();
		}
	}

	private void updateVelocity()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		Vector2 move_velocity = _move_velocity;
		if (move_velocity.x != 0f || move_velocity.y != 0f)
		{
			float decayFactor = getDecayFactor();
			_move_velocity *= decayFactor;
			if (Mathf.Abs(_move_velocity.x) < 0.01f)
			{
				_move_velocity.x = 0f;
			}
			if (Mathf.Abs(_move_velocity.y) < 0.01f)
			{
				_move_velocity.y = 0f;
			}
			if (!InputHelpers.mouseSupported || !InputHelpers.GetMouseButton(1))
			{
				Vector3 val = Vector2.op_Implicit(_move_velocity);
				Transform transform = ((Component)this).transform;
				transform.position += val;
				setWhooshState(WhooshState.NeedWhoosh);
				cameraToBounds();
			}
		}
	}

	private float getDecayFactor()
	{
		if (_mouse_controls_used_last)
		{
			return Mathf.Pow(0.8f, Time.deltaTime / (1f / 60f));
		}
		return 0.8f;
	}

	private void checkDistanceMoved(Vector3 pOldPosition)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		float num = Toolbox.DistVec3(((Component)this).transform.position, pOldPosition);
		Vector3 val = main_camera.ScreenToWorldPoint(new Vector3(0f, 0f, main_camera.nearClipPlane));
		Vector3 val2 = main_camera.ScreenToWorldPoint(new Vector3((float)Screen.width, (float)Screen.height, main_camera.nearClipPlane)) - val;
		float num2 = ((Vector3)(ref val2)).magnitude * 0.007f;
		if (num > num2)
		{
			GodPower selected_power = World.world.selected_power;
			if (selected_power != null && selected_power.set_used_camera_drag_on_long_move)
			{
				World.world.player_control.already_used_camera_drag = true;
			}
		}
		if (num > num2 * 1.2f)
		{
			setWhooshState(WhooshState.NeedWhoosh);
		}
	}

	private bool checkMouseInputDown()
	{
		if (InputHelpers.GetMouseButtonDown(1))
		{
			return true;
		}
		if (InputHelpers.GetMouseButtonDown(2))
		{
			return true;
		}
		if (InputHelpers.GetMouseButtonDown(0))
		{
			if (!Input.mousePresent)
			{
				return true;
			}
			if (MapBox.isRenderMiniMap())
			{
				return true;
			}
			return false;
		}
		return false;
	}

	private bool checkMouseInput()
	{
		if (InputHelpers.GetMouseButton(1))
		{
			return true;
		}
		if (InputHelpers.GetMouseButton(2))
		{
			return true;
		}
		if (InputHelpers.GetMouseButton(0))
		{
			if (!Input.mousePresent)
			{
				return true;
			}
			return false;
		}
		return false;
	}

	private void clearTouches()
	{
		((Vector3)(ref _first_touch)).Set(-1f, -1f, -1f);
		((Vector3)(ref _origin)).Set(-1f, -1f, -1f);
		if (camera_drag_activated && Time.frameCount > camera_drag_activated_frame + 2)
		{
			camera_drag_activated = false;
		}
	}

	private void cameraToBounds()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		Vector3 position = default(Vector3);
		position.x = Mathf.Clamp(((Component)this).transform.position.x, 0f, (float)MapBox.width);
		position.y = Mathf.Clamp(((Component)this).transform.position.y, 0f, (float)MapBox.height);
		position.z = -0.5f;
		((Component)this).transform.position = position;
		World.world.nameplate_manager.update();
	}

	private Vector3 getTouchPos(bool pScreenCoords = false)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Invalid comparison between Unknown and I4
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Invalid comparison between Unknown and I4
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = default(Vector2);
		int num = 0;
		int touchCount = InputHelpers.touchCount;
		for (int i = 0; i < touchCount; i++)
		{
			Touch touch = Input.GetTouch(i);
			if ((int)((Touch)(ref touch)).phase != 4 && (int)((Touch)(ref touch)).phase != 3)
			{
				val += ((Touch)(ref touch)).position;
				num++;
			}
		}
		Vector3 val2 = Vector2.op_Implicit(val / (float)num);
		if (pScreenCoords)
		{
			return val2;
		}
		return main_camera.ScreenToWorldPoint(val2);
	}

	private Vector3 getMousePos()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.mouseSupported)
		{
			return Vector2.op_Implicit(World.world.getMousePos());
		}
		return Vector3.one;
	}

	private void setWhooshState(WhooshState pState)
	{
		if (pState != WhooshState.NeedWhoosh || _whoosh_state != WhooshState.WhooshPlayed)
		{
			_whoosh_state = pState;
		}
	}

	private bool isNoInputDetected()
	{
		if (_move_velocity.x == 0f && _move_velocity.y == 0f && InputHelpers.touchCount == 0)
		{
			if (!InputHelpers.GetMouseButton(0) && !InputHelpers.GetMouseButton(1))
			{
				return !InputHelpers.GetMouseButton(2);
			}
			return false;
		}
		return false;
	}

	private void LateUpdate()
	{
		updateVisibleBounds();
		if (!World.world.tutorial.isActive())
		{
			if (_whoosh_state == WhooshState.NeedWhoosh)
			{
				setWhooshState(WhooshState.WhooshPlayed);
			}
			if (isNoInputDetected())
			{
				setWhooshState(WhooshState.Idle);
			}
		}
	}

	private void updateVisibleBounds()
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0106: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		Vector3 powerBarLeftCornerViewportPos = ToolbarButtons.instance.getPowerBarLeftCornerViewportPos();
		Vector2 val = Vector2.op_Implicit(World.world.camera.ScreenToWorldPoint(powerBarLeftCornerViewportPos));
		power_bar_position_y = val.y;
		if (power_bar_position_y < 0f)
		{
			power_bar_position_y = 0f;
		}
		Camera obj = main_camera;
		float nearClipPlane = obj.nearClipPlane;
		Vector3 val2 = obj.ViewportToWorldPoint(new Vector3(0f, 0f, nearClipPlane));
		Vector3 val3 = obj.ViewportToWorldPoint(new Vector3(1f, 1f, nearClipPlane));
		((Rect)(ref _visible_bounds)).x = val2.x;
		((Rect)(ref _visible_bounds)).y = val2.y;
		((Rect)(ref _visible_bounds)).width = val3.x - ((Rect)(ref _visible_bounds)).x;
		((Rect)(ref _visible_bounds)).height = val3.y - ((Rect)(ref _visible_bounds)).y;
		((Rect)(ref _visible_bounds_without_power_bar)).x = val2.x;
		((Rect)(ref _visible_bounds_without_power_bar)).y = power_bar_position_y;
		((Rect)(ref _visible_bounds_without_power_bar)).width = val3.x - ((Rect)(ref _visible_bounds_without_power_bar)).x;
		((Rect)(ref _visible_bounds_without_power_bar)).height = val3.y - ((Rect)(ref _visible_bounds_without_power_bar)).y;
	}

	public bool isWithinCameraView(Vector2 pPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		Rect visible_bounds = _visible_bounds;
		return checkBounds(pPos, visible_bounds);
	}

	public bool isWithinCameraViewNotPowerBar(Vector2 pPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		Rect visible_bounds_without_power_bar = _visible_bounds_without_power_bar;
		return checkBounds(pPos, visible_bounds_without_power_bar);
	}

	private bool checkBounds(Vector2 pPos, Rect pBounds)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		return ((Rect)(ref pBounds)).Contains(pPos);
	}

	public void update()
	{
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		if (World.world.tutorial.isActive())
		{
			return;
		}
		int pixelWidth = main_camera.pixelWidth;
		int pixelHeight = main_camera.pixelHeight;
		if (_last_width != (float)pixelWidth || _last_height != (float)pixelHeight)
		{
			_last_width = pixelWidth;
			_last_height = pixelHeight;
			if (_skip_reset_zoom)
			{
				_skip_reset_zoom = false;
			}
			else
			{
				resetZoom();
			}
			return;
		}
		if (Globals.TRAILER_MODE)
		{
			updateTrailerMode();
		}
		if (InputHelpers.touchCount > 0)
		{
			Touch touch = Input.GetTouch(0);
			if ((int)((Touch)(ref touch)).phase == 0 && World.world.isOverUI())
			{
				_first_touch_on_ui = true;
			}
		}
		else
		{
			_first_touch_on_ui = false;
		}
		if (!ScrollWindow.isWindowActive() && (!World.world.isOverUI() || inSpectatorMode()))
		{
			updateZoomControls();
		}
		if (_target_zoom != main_camera.orthographicSize)
		{
			zoomToBounds();
		}
		if (_focus_zoom > -1000000f)
		{
			checkFocusReached();
		}
		if (World.world.isGameplayControlsLocked() || ScrollWindow.isAnimationActive() || _first_touch_on_ui)
		{
			clearTouches();
			_old_touch_positions[0] = null;
			_old_touch_positions[1] = null;
			return;
		}
		if (InputHelpers.touchSupported)
		{
			updateMobileCamera();
		}
		if (InputHelpers.mouseSupported && (!InputHelpers.touchSupported || InputHelpers.touchCount <= 0))
		{
			updateMouseCameraDrag();
			if (!ScrollWindow.isWindowActive() && !ControllableUnit.isControllingUnit())
			{
				updateVelocity();
			}
		}
	}

	public Vector2 getVelocity()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		return _move_velocity;
	}

	private bool ignoreTouchControls()
	{
		if (!World.world.isOverUI() && !ScrollWindow.isWindowActive())
		{
			return ScrollWindow.isAnimationActive();
		}
		return true;
	}

	private void updateMobileCamera()
	{
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_02fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0303: Unknown result type (might be due to invalid IL or missing references)
		//IL_0306: Unknown result type (might be due to invalid IL or missing references)
		//IL_030b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0315: Unknown result type (might be due to invalid IL or missing references)
		//IL_031d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0322: Unknown result type (might be due to invalid IL or missing references)
		//IL_0327: Unknown result type (might be due to invalid IL or missing references)
		//IL_0339: Unknown result type (might be due to invalid IL or missing references)
		//IL_0215: Unknown result type (might be due to invalid IL or missing references)
		//IL_021a: Unknown result type (might be due to invalid IL or missing references)
		//IL_021d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0234: Unknown result type (might be due to invalid IL or missing references)
		//IL_0239: Unknown result type (might be due to invalid IL or missing references)
		//IL_023c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_037f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0386: Unknown result type (might be due to invalid IL or missing references)
		//IL_038b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0287: Unknown result type (might be due to invalid IL or missing references)
		//IL_028e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0293: Unknown result type (might be due to invalid IL or missing references)
		//IL_0559: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_010e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0397: Unknown result type (might be due to invalid IL or missing references)
		//IL_0399: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		//IL_03b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_03b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_03b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_015e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0165: Unknown result type (might be due to invalid IL or missing references)
		//IL_03e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_03f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_03fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0196: Unknown result type (might be due to invalid IL or missing references)
		//IL_019d: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_041c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0423: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0431: Unknown result type (might be due to invalid IL or missing references)
		//IL_0436: Unknown result type (might be due to invalid IL or missing references)
		//IL_043b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0440: Unknown result type (might be due to invalid IL or missing references)
		//IL_04a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_04b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_04bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_04c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_04c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_04cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_04db: Unknown result type (might be due to invalid IL or missing references)
		//IL_04e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_04e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_04ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_04f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_04f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0510: Unknown result type (might be due to invalid IL or missing references)
		//IL_0529: Unknown result type (might be due to invalid IL or missing references)
		//IL_0539: Unknown result type (might be due to invalid IL or missing references)
		//IL_053b: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.touchCount == 0)
		{
			_old_touch_positions[0] = null;
			_old_touch_positions[1] = null;
		}
		else
		{
			if ((World.world.isAnyPowerSelected() && World.world.selected_power.hold_action && InputHelpers.touchCount == 1) || World.world.player_control.already_used_power || ControllableUnit.isControllingUnit())
			{
				return;
			}
			Vector3 position = ((Component)this).transform.position;
			Touch touch;
			if (InputHelpers.touchCount == 1)
			{
				if (!_old_touch_positions[0].HasValue || _old_touch_positions[1].HasValue)
				{
					Vector2?[] old_touch_positions = _old_touch_positions;
					touch = Input.GetTouch(0);
					old_touch_positions[0] = ((Touch)(ref touch)).position;
					_old_touch_positions[1] = null;
				}
				else
				{
					touch = Input.GetTouch(0);
					Vector2 position2 = ((Touch)(ref touch)).position;
					Vector3 position3 = ((Component)this).transform.position;
					Transform transform = ((Component)this).transform;
					Vector2? val = _old_touch_positions[0];
					Vector2 val2 = position2;
					Vector2? val3 = (val.HasValue ? new Vector2?(val.GetValueOrDefault() - val2) : null);
					float orthographicSize = main_camera.orthographicSize;
					Vector2? val4 = (val3.HasValue ? new Vector2?(val3.GetValueOrDefault() * orthographicSize) : null);
					float num = main_camera.pixelHeight;
					Vector3 val5 = transform.TransformDirection(Vector2.op_Implicit((val4.HasValue ? new Vector2?(val4.GetValueOrDefault() / num * 2f) : null).Value));
					Vector3 position4 = position3 + val5;
					((Component)this).transform.position = position4;
					_old_touch_positions[0] = position2;
					cameraToBounds();
				}
			}
			else if (!_old_touch_positions[1].HasValue)
			{
				Vector2?[] old_touch_positions2 = _old_touch_positions;
				touch = Input.GetTouch(0);
				old_touch_positions2[0] = ((Touch)(ref touch)).position;
				Vector2?[] old_touch_positions3 = _old_touch_positions;
				touch = Input.GetTouch(1);
				old_touch_positions3[1] = ((Touch)(ref touch)).position;
				Vector2? val4 = _old_touch_positions[0];
				Vector2? val3 = _old_touch_positions[1];
				_old_touch_vector = ((val4.HasValue & val3.HasValue) ? new Vector2?(val4.GetValueOrDefault() - val3.GetValueOrDefault()) : null).Value;
				_old_touch_distance = ((Vector2)(ref _old_touch_vector)).magnitude;
			}
			else
			{
				Vector2 val6 = default(Vector2);
				((Vector2)(ref val6))._002Ector((float)main_camera.pixelWidth, (float)main_camera.pixelHeight);
				Vector2[] array = new Vector2[2];
				touch = Input.GetTouch(0);
				array[0] = ((Touch)(ref touch)).position;
				touch = Input.GetTouch(1);
				array[1] = ((Touch)(ref touch)).position;
				Vector2[] array2 = (Vector2[])(object)array;
				Vector2 old_touch_vector = array2[0] - array2[1];
				float magnitude = ((Vector2)(ref old_touch_vector)).magnitude;
				Transform transform2 = ((Component)this).transform;
				Vector3 position5 = transform2.position;
				Transform transform3 = ((Component)this).transform;
				Vector2? val7 = _old_touch_positions[0];
				Vector2? val8 = _old_touch_positions[1];
				Vector2? val = ((val7.HasValue & val8.HasValue) ? new Vector2?(val7.GetValueOrDefault() + val8.GetValueOrDefault()) : null);
				Vector2 val2 = val6;
				Vector2? val3 = (val.HasValue ? new Vector2?(val.GetValueOrDefault() - val2) : null);
				float orthographicSize = main_camera.orthographicSize;
				Vector2? val4 = (val3.HasValue ? new Vector2?(val3.GetValueOrDefault() * orthographicSize) : null);
				float num = val6.y;
				transform2.position = position5 + transform3.TransformDirection(Vector2.op_Implicit((val4.HasValue ? new Vector2?(val4.GetValueOrDefault() / num) : null).Value));
				if (magnitude != 0f && _old_touch_distance != magnitude)
				{
					main_camera.orthographicSize = Mathf.Clamp(main_camera.orthographicSize * (_old_touch_distance / magnitude), 10f, orthographic_size_max);
				}
				World.world.setZoomOrthographic(main_camera.orthographicSize);
				Transform transform4 = ((Component)this).transform;
				transform4.position -= ((Component)this).transform.TransformDirection(Vector2.op_Implicit((array2[0] + array2[1] - val6) * main_camera.orthographicSize / val6.y));
				cameraToBounds();
				_old_touch_positions[0] = array2[0];
				_old_touch_positions[1] = array2[1];
				_old_touch_vector = old_touch_vector;
				_old_touch_distance = magnitude;
				World.world.player_control.already_used_zoom = true;
			}
			checkDistanceMoved(position);
		}
	}

	private static float getMoveDistance(bool pFast = false)
	{
		float num = Time.deltaTime * 55f;
		if (pFast)
		{
			num *= 2.5f;
		}
		return num * instance._target_zoom * instance.camera_move_speed;
	}

	public static void move(HotkeyAsset pAsset)
	{
		float moveDistance = getMoveDistance(pAsset.id.StartsWith("fast_"));
		switch (pAsset.id)
		{
		case "up":
		case "fast_up":
			instance.addVelocity(0f, moveDistance);
			break;
		case "down":
		case "fast_down":
			instance.addVelocity(0f, 0f - moveDistance);
			break;
		case "right":
		case "fast_right":
			instance.addVelocity(moveDistance, 0f);
			break;
		case "left":
		case "fast_left":
			instance.addVelocity(0f - moveDistance, 0f);
			break;
		}
		instance.clampVelocity();
		instance._mouse_controls_used_last = false;
	}

	private void addVelocity(float pX, float pY)
	{
		_move_velocity.x += pX;
		_move_velocity.y += pY;
	}

	private void clampVelocity()
	{
		float num = (0f - _target_zoom) * camera_move_max;
		float num2 = _target_zoom * camera_move_max;
		_move_velocity.y = Mathf.Clamp(_move_velocity.y, num, num2);
		_move_velocity.x = Mathf.Clamp(_move_velocity.x, num, num2);
	}

	public static void zoomIn(HotkeyAsset pAsset)
	{
		instance._target_zoom -= instance.main_camera.orthographicSize * 0.05f;
	}

	public static void zoomOut(HotkeyAsset pAsset)
	{
		instance._target_zoom += instance.main_camera.orthographicSize * 0.05f;
	}

	public static void zoomInWheel(HotkeyAsset pAsset)
	{
		instance._target_zoom -= instance.main_camera.orthographicSize * 0.2f;
	}

	public static void zoomOutWheel(HotkeyAsset pAsset)
	{
		instance._target_zoom += instance.main_camera.orthographicSize * 0.2f;
	}

	private void updateTrailerMode()
	{
		if (Input.GetKeyUp((KeyCode)291))
		{
			camera_zoom_speed -= 0.2f;
			if (camera_zoom_speed < 0f)
			{
				camera_zoom_speed = 0.2f;
			}
		}
		if (Input.GetKeyUp((KeyCode)292))
		{
			camera_zoom_speed += 0.2f;
		}
		if (Input.GetKeyUp((KeyCode)111))
		{
			camera_move_max -= 0.1f;
			if (camera_move_max < 0.01f)
			{
				camera_move_max = 0.01f;
			}
		}
		if (Input.GetKeyUp((KeyCode)112))
		{
			camera_move_max += 0.1f;
		}
		if (Input.GetKeyUp((KeyCode)107))
		{
			camera_move_speed -= 0.01f;
			if (camera_move_speed < 0.01f)
			{
				camera_move_speed = 0.01f;
			}
		}
		if (Input.GetKeyUp((KeyCode)108))
		{
			camera_move_speed += 0.01f;
		}
		if (Input.GetKeyDown((KeyCode)114) && _target_zoom != main_camera.orthographicSize)
		{
			if (_target_zoom > main_camera.orthographicSize)
			{
				_target_zoom = main_camera.orthographicSize + _target_zoom * 0.1f;
			}
			else
			{
				_target_zoom = main_camera.orthographicSize - _target_zoom * 0.1f;
			}
		}
	}

	public void debug(DebugTool pTool)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		pTool.setText("bounds_normal:", _visible_bounds, 0f, pShowBar: false, 0L);
		pTool.setText("bounds_wth_power_bar:", _visible_bounds_without_power_bar, 0f, pShowBar: false, 0L);
		pTool.setText("is_no_input_detected:", isNoInputDetected(), 0f, pShowBar: false, 0L);
		pTool.setText("_whooshState:", _whoosh_state, 0f, pShowBar: false, 0L);
		pTool.setText("InputHelpers.touchCount:", InputHelpers.touchCount, 0f, pShowBar: false, 0L);
		pTool.setText("world.isGameplayControlsLocked():", World.world.isGameplayControlsLocked(), 0f, pShowBar: false, 0L);
		pTool.setText("ScrollWindow.animationActive:", ScrollWindow.isAnimationActive(), 0f, pShowBar: false, 0L);
		pTool.setText("firstTouchOnUI", _first_touch_on_ui, 0f, pShowBar: false, 0L);
		pTool.setText("world.alreadyUsedZoom", World.world.player_control.already_used_zoom, 0f, pShowBar: false, 0L);
		pTool.setText("world.alreadyUsedPower", World.world.player_control.already_used_power, 0f, pShowBar: false, 0L);
		pTool.setText("world.already_used_camera_drag", World.world.player_control.already_used_camera_drag, 0f, pShowBar: false, 0L);
		pTool.setText("_touch_dist", _touch_dist, 0f, pShowBar: false, 0L);
		pTool.setText("cameraDragRun", camera_drag_run, 0f, pShowBar: false, 0L);
		pTool.setText("camera_drag_activated", camera_drag_activated, 0f, pShowBar: false, 0L);
		if (UltimateJoystick.getJoyCount() == 2)
		{
			pTool.setText("JoyRight", UltimateJoystick.GetJoystickState("JoyRight"), 0f, pShowBar: false, 0L);
			pTool.setText("JoyLeft", UltimateJoystick.GetJoystickState("JoyLeft"), 0f, pShowBar: false, 0L);
		}
	}

	public void skipResetZoom()
	{
		_skip_reset_zoom = true;
	}
}
// --- End of File: MoveCamera.cs ---



// --- Start of File: MultiBannerPool.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class MultiBannerPool
{
	private Dictionary<string, ObjectPoolGenericMono<MonoBehaviour>> _pool_banners;

	private Transform _pool_container;

	private Transform _prefab_area;

	public MultiBannerPool(Transform pPoolContainer)
	{
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Expected O, but got Unknown
		_pool_banners = new Dictionary<string, ObjectPoolGenericMono<MonoBehaviour>>();
		_pool_container = pPoolContainer;
		GameObject val = new GameObject("PrefabArea", new Type[1] { typeof(RectTransform) });
		val.transform.SetParent(_pool_container);
		_prefab_area = val.transform;
		((Component)_prefab_area).gameObject.SetActive(false);
	}

	public IBanner getNext(NanoObject pObject)
	{
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Expected O, but got Unknown
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Expected O, but got Unknown
		string type = pObject.getType();
		MetaCustomizationAsset metaCustomizationAsset = AssetManager.meta_customization_library.get(type);
		if (!_pool_banners.TryGetValue(type, out var value))
		{
			GameObject val = new GameObject("BannerArea " + type, new Type[1] { typeof(RectTransform) });
			val.transform.SetParent(_pool_container, false);
			MonoBehaviour val2 = (MonoBehaviour)metaCustomizationAsset.get_banner(metaCustomizationAsset, pObject, _prefab_area);
			((Object)((Component)val2).gameObject).name = type;
			_pool_banners.Add(type, new ObjectPoolGenericMono<MonoBehaviour>(val2, val.transform));
			value = _pool_banners[type];
		}
		return value.getNext() as IBanner;
	}

	public void release(IBanner pItem)
	{
		getItemPool(pItem).release((MonoBehaviour)((pItem is MonoBehaviour) ? pItem : null));
	}

	public void resetParent(IBanner pItem)
	{
		getItemPool(pItem).resetParent((MonoBehaviour)((pItem is MonoBehaviour) ? pItem : null));
	}

	private ObjectPoolGenericMono<MonoBehaviour> getItemPool(IBanner pItem)
	{
		MetaCustomizationAsset meta_asset = pItem.meta_asset;
		if (_pool_banners.TryGetValue(meta_asset.id, out var value))
		{
			return value;
		}
		return null;
	}

	public void clear()
	{
		foreach (ObjectPoolGenericMono<MonoBehaviour> value in _pool_banners.Values)
		{
			value.clear();
			value.resetParent();
		}
	}
}
// --- End of File: MultiBannerPool.cs ---



// --- Start of File: MultiStackPool.cs ---
using System;
using System.Collections.Generic;

public class MultiStackPool<T> where T : new()
{
	private Dictionary<Type, StackPool<T>> _pools = new Dictionary<Type, StackPool<T>>();

	public U get<U>() where U : T, new()
	{
		Type typeFromHandle = typeof(U);
		if (!_pools.TryGetValue(typeFromHandle, out var value))
		{
			value = new StackPool<T>();
			_pools.Add(typeFromHandle, value);
		}
		return value.get<U>();
	}

	public void release(T pObject)
	{
		Type type = pObject.GetType();
		if (_pools.TryGetValue(type, out var value))
		{
			value.release(pObject);
		}
	}

	public void clear()
	{
		foreach (StackPool<T> value in _pools.Values)
		{
			value.clear();
		}
		_pools.Clear();
	}
}
// --- End of File: MultiStackPool.cs ---



// --- Start of File: MusicAsset.cs ---
using System;

[Serializable]
public class MusicAsset : Asset
{
	public int need_amount;

	public bool marker_same = true;

	public string marker_different = string.Empty;

	public bool disable_param_after_start = true;

	public float min_zoom = 70f;

	public int min_tiles_to_play;

	public bool is_environment;

	public bool is_param;

	public bool is_faction;

	public bool is_unit_param;

	public MusicAssetDelegate special_delegate_units;

	public string fmod_path;

	public bool mini_map_only;

	public bool civilization;

	[NonSerialized]
	public MusicBoxContainerTiles container_tiles;

	[NonSerialized]
	public TileTypeBase[] tile_types;

	public string[] tile_type_strings;

	public FmodAction action;

	public MusicLayerPriority priority;

	public void setTileTypes(params string[] pTileTypes)
	{
		tile_type_strings = pTileTypes;
	}
}
// --- End of File: MusicAsset.cs ---



// --- Start of File: MusicAssetDelegate.cs ---
public delegate void MusicAssetDelegate(MusicBoxContainerUnits pContainer);
// --- End of File: MusicAssetDelegate.cs ---



// --- Start of File: MusicBox.cs ---
using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using AOT;
using FMOD;
using FMOD.Studio;
using FMODUnity;
using UnityEngine;

public class MusicBox : MonoBehaviour
{
	private const int MUSIC_ZONES_SIZE = 3;

	private const int IDLE_SOUND_TIMER_MIN = 5;

	private const int IDLE_SOUND_TIMER_MAX = 12;

	public static MusicBox inst;

	private readonly HashSet<string> _flags_to_enable = new HashSet<string>();

	private EventInstance _music_event;

	internal MusicBoxDebug debug_box;

	private float _timer;

	private const float INTERVAL_UPDATE = 1f;

	public static bool music_on = true;

	public static bool sounds_on = true;

	public static bool debug_sounds = true;

	private VCA _vca_sound_effects;

	private VCA _vca_music;

	private VCA _vca_ui;

	private Bus _bus_master;

	private Bus _bus_idle;

	private float _volume_idle = 1f;

	private EVENT_CALLBACK _music_callback;

	private TimelineInfo _timeline_info;

	private GCHandle _timeline_handle;

	public static bool new_world_on_start_played = false;

	private readonly Dictionary<string, EventInstance> _environment_sounds = new Dictionary<string, EventInstance>();

	private readonly Dictionary<string, EventInstance> _drawing_sounds = new Dictionary<string, EventInstance>();

	private static readonly Dictionary<string, bool> _events_cache = new Dictionary<string, bool>();

	private static readonly Dictionary<string, GUID> _events_guids = new Dictionary<string, GUID>();

	private static GameObject _sound_object;

	private int _tiles_sand;

	private int _tiles_shallow_water;

	public MusicState music_state;

	private MusicBoxLibrary _lib;

	public MusicBoxIdle idle;

	private GameObject _camera_listener;

	private bool _created;

	private static System _studio_system => RuntimeManager.StudioSystem;

	private static bool fmod_disabled
	{
		get
		{
			if (!music_on)
			{
				return !sounds_on;
			}
			return false;
		}
	}

	private void Awake()
	{
		create();
	}

	internal void create()
	{
		//IL_012d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Expected O, but got Unknown
		//IL_013d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Expected O, but got Unknown
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		if (_created)
		{
			return;
		}
		_created = true;
		inst = this;
		debug_box = new MusicBoxDebug();
		_lib = AssetManager.music_box;
		idle = new MusicBoxIdle();
		ScrollWindow.addCallbackHide(hideWindowCallback);
		if (!fmod_disabled)
		{
			try
			{
				_bus_master = RuntimeManager.GetBus("bus:/");
				if (((Bus)(ref _bus_master)).isValid())
				{
					((Bus)(ref _bus_master)).setVolume(0f);
				}
			}
			catch (Exception ex)
			{
				Debug.LogError((object)("MusicBox failed to init: " + ex));
				music_on = false;
				sounds_on = false;
				return;
			}
			Platform val = Settings.Instance.FindCurrentPlatform();
			if (debug_sounds)
			{
				PropertyAccessor<TriStateBool> liveUpdate = PropertyAccessors.LiveUpdate;
				liveUpdate.Set(val, (TriStateBool)1);
				liveUpdate = PropertyAccessors.Overlay;
				liveUpdate.Set(val, (TriStateBool)2);
			}
			else
			{
				PropertyAccessor<TriStateBool> liveUpdate = PropertyAccessors.LiveUpdate;
				liveUpdate.Set(val, (TriStateBool)0);
				liveUpdate = PropertyAccessors.Overlay;
				liveUpdate.Set(val, (TriStateBool)0);
			}
			createMusicEvent();
			assignCallback();
			startMusic();
		}
		reserveFlag(MusicBoxLibrary.Neutral_001.id);
		clearParams();
		_sound_object = new GameObject("musicbox_pan");
		_camera_listener = new GameObject("fmod_listener");
		_camera_listener.transform.parent = ((Component)Camera.main).transform;
		_camera_listener.AddComponent<StudioListener>();
	}

	private void setMusicState(MusicState pState)
	{
		music_state = pState;
		if (pState == MusicState.Menu)
		{
			reserveFlag("Menu");
		}
	}

	private void checkDrawingSounds()
	{
		if (!sounds_on)
		{
			return;
		}
		bool flag = false;
		if (InputHelpers.mouseSupported)
		{
			if (!Input.GetMouseButton(0))
			{
				flag = true;
			}
			else if (!ControllableUnit.isControllingUnit() && World.world.isOverUI())
			{
				flag = true;
			}
		}
		else if (Input.touchCount == 0)
		{
			flag = true;
		}
		if (flag)
		{
			inst.stopDrawingSounds();
		}
	}

	private void checkIdleVolume()
	{
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		if (World.world.isPaused())
		{
			_volume_idle -= Time.deltaTime;
			if (_volume_idle < 0f)
			{
				_volume_idle = 0f;
			}
		}
		else
		{
			_volume_idle += Time.deltaTime;
			if (_volume_idle > 1f)
			{
				_volume_idle = 1f;
			}
		}
		if (!((Bus)(ref _bus_idle)).isValid())
		{
			_bus_idle = RuntimeManager.GetBus("bus:/Idle");
		}
		checkBusVolume(_volume_idle, _bus_idle);
	}

	private void checkVolumes()
	{
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		bool flag = ((VCA)(ref _vca_sound_effects)).isValid();
		if (!flag)
		{
			_vca_sound_effects = RuntimeManager.GetVCA("vca:/Sound Effects");
			_vca_music = RuntimeManager.GetVCA("vca:/Music");
			_vca_ui = RuntimeManager.GetVCA("vca:/UI");
			_bus_master = RuntimeManager.GetBus("bus:/");
			if (!flag)
			{
				return;
			}
		}
		checkBusVolume("volume_master_sound", _bus_master);
		checkVcaVolume("volume_sound_effects", _vca_sound_effects);
		checkVcaVolume("volume_music", _vca_music);
		checkVcaVolume("volume_ui", _vca_ui);
	}

	private void checkBusVolume(float pVolume, Bus pBus)
	{
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		float num = default(float);
		((Bus)(ref pBus)).getVolume(ref num);
		if (num != pVolume)
		{
			((Bus)(ref pBus)).setVolume(pVolume);
		}
	}

	private void checkBusVolume(string pOptionParam, Bus pBus)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		float num = (float)PlayerConfig.getIntValue(pOptionParam) / 100f;
		float num2 = default(float);
		((Bus)(ref pBus)).getVolume(ref num2);
		if (num2 != num)
		{
			((Bus)(ref pBus)).setVolume(num);
		}
	}

	private void checkVcaVolume(string pOptionParam, VCA pVCA)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		float num = (float)PlayerConfig.getIntValue(pOptionParam) / 100f;
		float num2 = default(float);
		((VCA)(ref pVCA)).getVolume(ref num2);
		if (num2 != num)
		{
			((VCA)(ref pVCA)).setVolume(num);
		}
	}

	public void update(float pElapsed)
	{
		//IL_0118: Unknown result type (might be due to invalid IL or missing references)
		if (fmod_disabled)
		{
			return;
		}
		Bench.bench("music_box", "music_box_total");
		Bench.bench("check_volume", "music_box");
		checkVolumes();
		checkIdleVolume();
		Bench.benchEnd("check_volume", "music_box", pSaveCounter: false, 0L);
		Bench.bench("update_idle", "music_box");
		idle.update(pElapsed);
		Bench.benchEnd("update_idle", "music_box", pSaveCounter: false, 0L);
		Bench.bench("update_debug", "music_box");
		debug_box.update();
		Bench.benchEnd("update_debug", "music_box", pSaveCounter: false, 0L);
		Bench.bench("update_drawing", "music_box");
		checkDrawingSounds();
		Bench.benchEnd("update_drawing", "music_box", pSaveCounter: false, 0L);
		Bench.bench("update_fmod_params", "music_box");
		Vector3 localPosition = default(Vector3);
		((Vector3)(ref localPosition))._002Ector(0f, 0f, World.world.camera.orthographicSize * 1.5f);
		_camera_listener.transform.localPosition = localPosition;
		updateMainFmodParams();
		Bench.benchEnd("update_fmod_params", "music_box", pSaveCounter: false, 0L);
		if (_timer > 0f)
		{
			_timer -= pElapsed;
			return;
		}
		_timer = 1f;
		Bench.bench("clearParams", "music_box");
		clearParams();
		Bench.benchEnd("clearParams", "music_box", pSaveCounter: false, 0L);
		Bench.bench("drawFmodDebugZones", "music_box");
		drawFmodDebugZones();
		Bench.benchEnd("drawFmodDebugZones", "music_box", pSaveCounter: false, 0L);
		Bench.bench("countZonesUnits", "music_box");
		countUnitsInZones();
		Bench.benchEnd("countZonesUnits", "music_box", pSaveCounter: false, 0L);
		Bench.bench("countSpecialTiles", "music_box");
		countSpecialTilesInChunks();
		Bench.benchEnd("countSpecialTiles", "music_box", pSaveCounter: false, 0L);
		Bench.bench("checkUnitsParams", "music_box");
		checkUnitsParams();
		Bench.benchEnd("checkUnitsParams", "music_box", pSaveCounter: false, 0L);
		Bench.bench("checkCamera", "music_box");
		checkCamera();
		Bench.benchEnd("checkCamera", "music_box", pSaveCounter: false, 0L);
		Bench.bench("music_params_1", "music_box");
		foreach (MusicBoxContainerTiles c_list_param in _lib.c_list_params)
		{
			if (c_list_param.enabled)
			{
				enableMusicParameter(c_list_param.asset.id);
			}
			else
			{
				disableMusicParameter(c_list_param.asset.id);
			}
		}
		Bench.benchEnd("music_params_1", "music_box", pSaveCounter: false, 0L);
		Bench.bench("music_params_2", "music_box");
		foreach (MusicBoxContainerUnits value in _lib.c_dict_units.Values)
		{
			if (value.enabled)
			{
				enableMusicParameter(value.asset.id);
			}
			else
			{
				disableMusicParameter(value.asset.id);
			}
		}
		Bench.benchEnd("music_params_2", "music_box", pSaveCounter: false, 0L);
		Bench.bench("flags", "music_box");
		if (_flags_to_enable.Any())
		{
			foreach (string item in _flags_to_enable)
			{
				enableMusicParameter(item);
			}
			_flags_to_enable.Clear();
		}
		Bench.benchEnd("flags", "music_box", pSaveCounter: false, 0L);
		Bench.bench("check_environment", "music_box");
		foreach (MusicBoxContainerTiles c_list_environment in _lib.c_list_environments)
		{
			checkEnvironmentSound(c_list_environment);
		}
		Bench.benchEnd("check_environment", "music_box", pSaveCounter: false, 0L);
		Bench.benchEnd("music_box", "music_box_total", pSaveCounter: false, 0L);
	}

	private void updateMainFmodParams()
	{
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		System studio_system;
		if (World.world.quality_changer.isLowRes())
		{
			studio_system = _studio_system;
			((System)(ref studio_system)).setParameterByName("MiniMap", 1f, false);
		}
		else
		{
			studio_system = _studio_system;
			((System)(ref studio_system)).setParameterByName("MiniMap", 0f, false);
		}
		float zoomRatioLow = World.world.quality_changer.getZoomRatioLow();
		float zoomRatioHigh = World.world.quality_changer.getZoomRatioHigh();
		float zoomRatioFull = World.world.quality_changer.getZoomRatioFull();
		studio_system = _studio_system;
		((System)(ref studio_system)).setParameterByName("Zoom_Low", zoomRatioLow, false);
		studio_system = _studio_system;
		((System)(ref studio_system)).setParameterByName("Zoom_High", zoomRatioHigh, false);
		studio_system = _studio_system;
		((System)(ref studio_system)).setParameterByName("Zoom_Full", zoomRatioFull, false);
	}

	public static void clearAllSounds()
	{
		if (!fmod_disabled)
		{
			inst.idle.clearAllSounds();
			inst.debug_box.clear();
		}
	}

	public void clearParams()
	{
		foreach (Kingdom kingdom in World.world.kingdoms)
		{
			if (_lib.c_dict_civs.TryGetValue(kingdom.getSpecies(), out var value))
			{
				value.kingdom_exists = true;
			}
		}
		_tiles_sand = 0;
		_tiles_shallow_water = 0;
		foreach (MusicBoxContainerCivs value2 in _lib.c_dict_civs.Values)
		{
			value2.clear();
		}
		foreach (MusicAsset item in _lib.list)
		{
			item.container_tiles?.clear();
		}
		foreach (MusicBoxContainerUnits value3 in _lib.c_dict_units.Values)
		{
			value3.clear();
		}
		DebugLayer.fmod_zones_to_draw.Clear();
	}

	private void hideWindowCallback(string pWindowID)
	{
	}

	private void assignCallback()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Expected O, but got Unknown
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		_music_callback = new EVENT_CALLBACK(beatEventCallback);
		_timeline_info = new TimelineInfo();
		_timeline_handle = GCHandle.Alloc(_timeline_info, GCHandleType.Pinned);
		((EventInstance)(ref _music_event)).setUserData(GCHandle.ToIntPtr(_timeline_handle));
		((EventInstance)(ref _music_event)).setCallback(_music_callback, (EVENT_CALLBACK_TYPE)6144);
	}

	public static EventInstance getNewInstance(string pID)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		return RuntimeManager.CreateInstance(pID);
	}

	public static EventInstance attachToObject(string pID, GameObject pObject, bool pPlay = true)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		if (!sounds_on)
		{
			return default(EventInstance);
		}
		EventInstance newInstance = getNewInstance(pID);
		RuntimeManager.AttachInstanceToGameObject(newInstance, pObject.transform, false);
		if (pPlay)
		{
			((EventInstance)(ref newInstance)).start();
		}
		return newInstance;
	}

	private void createMusicEvent()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		_music_event = getNewInstance("event:/MUSIC/ConsolidatedMusicEvent");
	}

	private void startMusic()
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		if (music_on)
		{
			((EventInstance)(ref _music_event)).start();
		}
	}

	[MonoPInvokeCallback(typeof(EVENT_CALLBACK))]
	private static RESULT beatEventCallback(EVENT_CALLBACK_TYPE pType, IntPtr pInstancePtr, IntPtr pParameterPtr)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Invalid comparison between Unknown and I4
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		IntPtr intPtr = default(IntPtr);
		RESULT userData = ((EventInstance)(ref inst._music_event)).getUserData(ref intPtr);
		if ((int)userData != 0)
		{
			Debug.LogError((object)("Timeline Callback error: " + ((object)(RESULT)(ref userData)).ToString()));
		}
		else if (intPtr != IntPtr.Zero)
		{
			TimelineInfo timelineInfo = (TimelineInfo)GCHandle.FromIntPtr(intPtr).Target;
			if ((int)pType == 2048)
			{
				TIMELINE_MARKER_PROPERTIES val = (TIMELINE_MARKER_PROPERTIES)Marshal.PtrToStructure(pParameterPtr, typeof(TIMELINE_MARKER_PROPERTIES));
				timelineInfo.lastMarker = val.name;
				inst.markerReached(StringWrapper.op_Implicit(timelineInfo.lastMarker));
			}
		}
		return (RESULT)0;
	}

	private void loadBanks()
	{
	}

	private void checkEnvironmentSound(MusicBoxContainerTiles pContainer)
	{
		MusicAsset asset = pContainer.asset;
		bool flag = true;
		if (asset.mini_map_only)
		{
			if (!World.world.quality_changer.isLowRes())
			{
				flag = false;
			}
		}
		else if (World.world.quality_changer.isLowRes())
		{
			flag = false;
		}
		else if (asset.min_zoom <= World.world.camera.orthographicSize)
		{
			flag = false;
		}
		if (flag && asset.min_tiles_to_play != 0 && pContainer.amount < asset.min_tiles_to_play)
		{
			flag = false;
		}
		pContainer.enabled = flag;
		if (flag)
		{
			playEnvironmentSound(pContainer);
		}
		else
		{
			stopEnvironmentSound(pContainer);
		}
	}

	public static void playIdleSoundVisibleOnly(string pSoundPath, WorldTile pTile)
	{
		if (sounds_on)
		{
			playSoundVisibleOnly(pSoundPath, pTile);
		}
	}

	public static void playSoundVisibleOnly(string pSoundPath, WorldTile pTile)
	{
		if (sounds_on)
		{
			playSound(pSoundPath, pTile, pGameViewOnly: true, pVisibleOnly: true);
		}
	}

	public static void playSound(string pSoundPath, WorldTile pTile, bool pGameViewOnly = false, bool pVisibleOnly = false)
	{
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		if (!string.IsNullOrEmpty(pSoundPath) && (!pVisibleOnly || pTile.zone.visible))
		{
			Vector2Int pos = pTile.pos;
			float pX = ((Vector2Int)(ref pos)).x;
			pos = pTile.pos;
			playSound(pSoundPath, pX, ((Vector2Int)(ref pos)).y, pGameViewOnly);
		}
	}

	public static void playSoundWorld(string pSoundPath)
	{
	}

	public static void playSoundUI(string pSoundPath)
	{
		playSound(pSoundPath);
	}

	public static EventInstance PlayOneShot(GUID pGuid, Vector3 pPosition, bool pSet3D = true)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		EventInstance result = RuntimeManager.CreateInstance(pGuid);
		if (pSet3D)
		{
			((EventInstance)(ref result)).set3DAttributes(RuntimeUtils.To3DAttributes(pPosition));
		}
		else
		{
			Vector3 position = ((Component)World.world.move_camera).transform.position;
			float orthographicSize = World.world.move_camera.main_camera.orthographicSize;
			Vector3 val = default(Vector3);
			((Vector3)(ref val))._002Ector(position.x, position.y, orthographicSize);
			((EventInstance)(ref result)).set3DAttributes(RuntimeUtils.To3DAttributes(val));
		}
		((EventInstance)(ref result)).start();
		((EventInstance)(ref result)).release();
		return result;
	}

	private static bool isEventExists(string pEventPath)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Invalid comparison between Unknown and I4
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		if (!_events_cache.TryGetValue(pEventPath, out var value))
		{
			System studioSystem = RuntimeManager.StudioSystem;
			EventDescription val = default(EventDescription);
			value = (int)((System)(ref studioSystem)).getEvent(pEventPath, ref val) == 0;
			_events_cache.Add(pEventPath, value);
			if (!value)
			{
				Debug.LogWarning((object)("[FMOD] Missing event : " + pEventPath));
			}
			else
			{
				_events_guids[pEventPath] = RuntimeManager.PathToGUID(pEventPath);
			}
		}
		return value;
	}

	public static void playSound(string pSoundPath, float pX = -1f, float pY = -1f, bool pGameViewOnly = false, bool pVisibleOnly = false)
	{
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		if (sounds_on && (!pGameViewOnly || !World.world.quality_changer.isLowRes()) && isEventExists(pSoundPath))
		{
			GUID pGuid = _events_guids[pSoundPath];
			EventInstance? val = null;
			try
			{
				val = ((pX == -1f || pY == -1f) ? new EventInstance?(PlayOneShot(pGuid, Vector3.zero, pSet3D: false)) : new EventInstance?(PlayOneShot(pGuid, new Vector3(pX, pY, 0f))));
			}
			catch (EventNotFoundException)
			{
			}
			if (DebugConfig.isOn(DebugOption.OverlaySounds) || DebugConfig.isOn(DebugOption.OverlaySoundsActive))
			{
				inst.debug_box.add(pSoundPath.Split('/').Last(), pX, pY, val.Value);
			}
		}
	}

	public void playEnvironmentSound(MusicBoxContainerTiles pContainer)
	{
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		if (sounds_on)
		{
			MusicAsset asset = pContainer.asset;
			EventInstance val;
			if (_environment_sounds.ContainsKey(asset.fmod_path))
			{
				val = _environment_sounds[asset.fmod_path];
			}
			else
			{
				val = getNewInstance(asset.fmod_path);
				_environment_sounds.Add(asset.fmod_path, val);
			}
			setPan(val, pContainer.cur_pan.x, pContainer.cur_pan.y);
			if (!isPlaying(val))
			{
				((EventInstance)(ref val)).start();
			}
		}
	}

	public void stopEnvironmentSound(MusicBoxContainerTiles pContainer)
	{
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		MusicAsset asset = pContainer.asset;
		if (_environment_sounds.ContainsKey(asset.fmod_path))
		{
			EventInstance pInstance = _environment_sounds[asset.fmod_path];
			if (isPlaying(pInstance))
			{
				((EventInstance)(ref pInstance)).stop((STOP_MODE)0);
			}
		}
	}

	public void playDrawingSound(string pSoundPath, float pX = -1f, float pY = -1f)
	{
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		if (sounds_on)
		{
			EventInstance val;
			if (_drawing_sounds.ContainsKey(pSoundPath))
			{
				val = _drawing_sounds[pSoundPath];
			}
			else
			{
				val = getNewInstance(pSoundPath);
				_drawing_sounds.Add(pSoundPath, val);
			}
			setPan(val, pX, pY);
			((EventInstance)(ref val)).setParameterByName("cursor_speed", MapBox.cursor_speed.fmod_speed, false);
			if (!isPlaying(val))
			{
				((EventInstance)(ref val)).start();
			}
		}
	}

	public static void setPan(EventInstance pInstance, float pX, float pY)
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		if (pX != -1f || pY != -1f)
		{
			float num = 0f;
			_sound_object.transform.position = new Vector3(pX, pY, num);
			ATTRIBUTES_3D val = RuntimeUtils.To3DAttributes(_sound_object);
			((EventInstance)(ref pInstance)).set3DAttributes(val);
		}
	}

	public void stopDrawingSound(string pID)
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		if (_drawing_sounds.ContainsKey(pID))
		{
			EventInstance pInstance = _drawing_sounds[pID];
			if (isPlaying(pInstance))
			{
				((EventInstance)(ref pInstance)).stop((STOP_MODE)0);
			}
		}
	}

	public void stopDrawingSounds()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		foreach (EventInstance value in _drawing_sounds.Values)
		{
			EventInstance current = value;
			if (isPlaying(current))
			{
				((EventInstance)(ref current)).stop((STOP_MODE)0);
			}
		}
	}

	public static bool isPlaying(EventInstance pInstance)
	{
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Invalid comparison between Unknown and I4
		PLAYBACK_STATE val = default(PLAYBACK_STATE);
		((EventInstance)(ref pInstance)).getPlaybackState(ref val);
		return (int)val != 2;
	}

	private void drawFmodDebugZones()
	{
	}

	private void countUnitsInZones()
	{
		foreach (MapChunk visibleChunk in World.world.zone_camera.getVisibleChunks())
		{
			if (!visibleChunk.objects.isEmpty())
			{
				countUnits(visibleChunk);
			}
		}
	}

	private void checkCamera()
	{
		if ((_tiles_sand < 50 || _tiles_shallow_water < 50) && _tiles_sand >= 100 && _tiles_shallow_water < 20)
		{
			MusicBoxLibrary.Locations_Desert.container_tiles.amount = _tiles_sand + _tiles_shallow_water;
		}
		_lib.c_list_params.Sort(sorter);
		float num = 0f;
		for (int i = 0; i < _lib.c_list_params.Count; i++)
		{
			MusicBoxContainerTiles musicBoxContainerTiles = _lib.c_list_params[i];
			musicBoxContainerTiles.enabled = false;
			num += (float)musicBoxContainerTiles.amount;
		}
		float num2 = 0f;
		int num3 = 0;
		for (int j = 0; j < _lib.c_list_params.Count; j++)
		{
			MusicBoxContainerTiles musicBoxContainerTiles2 = _lib.c_list_params[j];
			musicBoxContainerTiles2.calculatePan();
			musicBoxContainerTiles2.percent = (float)musicBoxContainerTiles2.amount / num;
			num2 += musicBoxContainerTiles2.percent;
			if (musicBoxContainerTiles2.amount > 50)
			{
				if (num3 >= 2)
				{
					break;
				}
				musicBoxContainerTiles2.enabled = true;
				num3++;
			}
		}
	}

	private void checkUnitsParams()
	{
		MusicBoxContainerUnits musicBoxContainerUnits = null;
		MusicBoxContainerUnits musicBoxContainerUnits2 = null;
		foreach (MusicBoxContainerUnits value in _lib.c_dict_units.Values)
		{
			value.asset.special_delegate_units?.Invoke(value);
			if (value.units > 0)
			{
				if (value.asset.priority == MusicLayerPriority.High)
				{
					musicBoxContainerUnits2 = value;
				}
				else if (value.asset.priority == MusicLayerPriority.Medium)
				{
					musicBoxContainerUnits = value;
				}
			}
		}
		if (musicBoxContainerUnits2 != null)
		{
			musicBoxContainerUnits = null;
		}
		if (musicBoxContainerUnits2 != null || musicBoxContainerUnits != null)
		{
			foreach (MusicBoxContainerUnits value2 in _lib.c_dict_units.Values)
			{
				if ((musicBoxContainerUnits2 == null || value2 != musicBoxContainerUnits2) && (musicBoxContainerUnits == null || value2 != musicBoxContainerUnits))
				{
					value2.units = 0;
				}
			}
		}
		foreach (MusicBoxContainerUnits value3 in _lib.c_dict_units.Values)
		{
			if (value3.units > 0)
			{
				value3.enabled = true;
			}
		}
	}

	public static int sorter(MusicBoxContainerTiles pV1, MusicBoxContainerTiles pV2)
	{
		return pV2.amount.CompareTo(pV1.amount);
	}

	private void countSpecialTilesInChunks()
	{
		List<MapChunk> visibleChunks = World.world.zone_camera.getVisibleChunks();
		int i = 0;
		for (int count = visibleChunks.Count; i < count; i++)
		{
			MapChunk pChunk = visibleChunks[i];
			countSpecialTilesForZone(pChunk);
		}
	}

	private void countSpecialTilesForZone(MapChunk pChunk)
	{
		List<MusicBoxTileData> simpleData = pChunk.getSimpleData();
		TileTypeBase[] array_tiles = TileLibrary.array_tiles;
		int i = 0;
		for (int count = simpleData.Count; i < count; i++)
		{
			MusicBoxTileData musicBoxTileData = simpleData[i];
			TileTypeBase tileTypeBase = array_tiles[musicBoxTileData.tile_type_id];
			int amount = musicBoxTileData.amount;
			if (amount == 0)
			{
				continue;
			}
			List<MusicAsset> music_assets = tileTypeBase.music_assets;
			if (music_assets != null)
			{
				int j = 0;
				for (int count2 = music_assets.Count; j < count2; j++)
				{
					music_assets[j].container_tiles.count(amount, pChunk.world_center_x, pChunk.world_center_y);
				}
			}
		}
	}

	private void countUnits(MapChunk pChunk)
	{
		foreach (long kingdom2 in pChunk.objects.kingdoms)
		{
			Kingdom kingdom = World.world.kingdoms.get(kingdom2);
			if (kingdom != null)
			{
				ActorAsset actorAsset = kingdom.getActorAsset();
				if (actorAsset != null && actorAsset.has_music_theme)
				{
					_lib.c_dict_units[actorAsset.music_theme].units++;
				}
			}
		}
	}

	private void enableMusicParameter(string pID)
	{
		setMusicParameter(pID, 1f);
	}

	private void disableMusicParameter(string pID)
	{
		setMusicParameter(pID, 0f);
	}

	private void setMusicParameter(string pID, float pValue)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		((EventInstance)(ref _music_event)).setParameterByName(pID, pValue, false);
	}

	private void markerReached(string pMarker)
	{
		if (pMarker == "Intro")
		{
			return;
		}
		MusicAsset musicAsset = _lib.get(pMarker);
		if (musicAsset != null)
		{
			if (musicAsset.disable_param_after_start)
			{
				disableMusicParameter(pMarker);
			}
			if (musicAsset.action != null)
			{
				musicAsset.action();
			}
		}
	}

	public static void reserveFlag(string pID, bool pValue = true)
	{
		if (music_on)
		{
			inst._timer = -1f;
			inst._flags_to_enable.Add(pID);
		}
	}

	public static void debug_fmod(DebugTool pTool)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		if (!fmod_disabled)
		{
			System studio_system = _studio_system;
			Bank[] array = default(Bank[]);
			((System)(ref studio_system)).getBankList(ref array);
			studio_system = _studio_system;
			EventDescription val = default(EventDescription);
			RESULT @event = ((System)(ref studio_system)).getEvent("event:/MUSIC/ConsolidatedMusicEvent", ref val);
			int num = -1;
			float num2 = -1f;
			PLAYBACK_STATE val2 = (PLAYBACK_STATE)3;
			((EventInstance)(ref inst._music_event)).getParameterByName("new_world", ref num2);
			((EventInstance)(ref inst._music_event)).getTimelinePosition(ref num);
			((EventInstance)(ref inst._music_event)).getPlaybackState(ref val2);
			pTool.setText("Zoom_Low:", World.world.quality_changer.getZoomRatioLow(), 0f, pShowBar: false, 0L);
			pTool.setText("Zoom_High:", World.world.quality_changer.getZoomRatioHigh(), 0f, pShowBar: false, 0L);
			pTool.setText("Zoom_Full:", World.world.quality_changer.getZoomRatioFull(), 0f, pShowBar: false, 0L);
			pTool.setSeparator();
			pTool.setText("idle_sim_objects:", inst.idle.CountCurrentSounds(), 0f, pShowBar: false, 0L);
			pTool.setText("music state:", inst.music_state, 0f, pShowBar: false, 0L);
			pTool.setText("IsInitialized:", RuntimeManager.IsInitialized, 0f, pShowBar: false, 0L);
			pTool.setText("Banks count:", array.Length, 0f, pShowBar: false, 0L);
			pTool.setText("AnySampleDataLoading:", RuntimeManager.AnySampleDataLoading(), 0f, pShowBar: false, 0L);
			pTool.setText("Bank Master:", RuntimeManager.HasBankLoaded("Master"), 0f, pShowBar: false, 0L);
			pTool.setText("Bank Master.strings:", RuntimeManager.HasBankLoaded("Master.strings"), 0f, pShowBar: false, 0L);
			pTool.setText("MUSIC_EVENT by name:", ((object)(RESULT)(ref @event)).ToString(), 0f, pShowBar: false, 0L);
			pTool.setText("tParam_new_world:", num2, 0f, pShowBar: false, 0L);
			pTool.setText("tTimelinePos:", num, 0f, pShowBar: false, 0L);
			pTool.setText("getPlaybackState:", ((object)(PLAYBACK_STATE)(ref val2)).ToString(), 0f, pShowBar: false, 0L);
		}
	}

	public void debug_params(DebugTool pTool)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		if (fmod_disabled)
		{
			return;
		}
		float num = 0f;
		for (int i = 0; i < _lib.list.Count; i++)
		{
			string id = _lib.list[i].id;
			((EventInstance)(ref inst._music_event)).getParameterByName(id, ref num);
			if (num == 1f)
			{
				pTool.setText(id + ":", num, 0f, pShowBar: false, 0L);
			}
		}
	}

	public void debug_world_params(DebugTool pTool)
	{
		if (fmod_disabled)
		{
			return;
		}
		foreach (MusicBoxContainerCivs value in _lib.c_dict_civs.Values)
		{
			if (value.active)
			{
				pTool.setText(value.asset.id, value.buildings + " " + value.kingdom_exists + " " + value.active, 0f, pShowBar: false, 0L);
			}
		}
		foreach (MusicAsset item in _lib.list)
		{
			MusicBoxContainerTiles container_tiles = item.container_tiles;
			if (container_tiles != null && container_tiles.enabled)
			{
				pTool.setText(container_tiles.asset.id, container_tiles.amount + " " + container_tiles.enabled + " " + container_tiles.percent.ToText() + "%", 0f, pShowBar: false, 0L);
			}
		}
		pTool.setText("", "", 0f, pShowBar: false, 0L);
	}

	public void debug_unit_params(DebugTool pTool)
	{
		if (fmod_disabled || _lib.c_dict_units.Count == 0)
		{
			return;
		}
		foreach (MusicBoxContainerUnits value in _lib.c_dict_units.Values)
		{
			if (value.units != 0)
			{
				pTool.setText(value.asset.id, value.units + " " + value.enabled, 0f, pShowBar: false, 0L);
			}
		}
		pTool.setText("", "", 0f, pShowBar: false, 0L);
	}
}
// --- End of File: MusicBox.cs ---



// --- Start of File: MusicBoxContainerCivs.cs ---
public class MusicBoxContainerCivs
{
	public MusicAsset asset;

	public int buildings;

	public bool kingdom_exists;

	public bool active;

	public void clear()
	{
		buildings = 0;
		kingdom_exists = false;
		active = false;
	}
}
// --- End of File: MusicBoxContainerCivs.cs ---



// --- Start of File: MusicBoxContainerTiles.cs ---
using UnityEngine;

public class MusicBoxContainerTiles
{
	public int amount;

	public float percent;

	public bool enabled;

	public Vector2 cur_pan;

	private Vector2 _last_pan;

	private float _chunks;

	public MusicAsset asset;

	public void clear()
	{
		amount = 0;
		((Vector2)(ref _last_pan)).Set(-1f, -1f);
		_chunks = 0f;
	}

	public void count(int pAmount, float pWhereFromX, float pWhereFromY)
	{
		amount += pAmount;
		_chunks += 1f;
		_last_pan.x += pWhereFromX;
		_last_pan.y += pWhereFromY;
	}

	public void calculatePan()
	{
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		_last_pan.x /= _chunks + 1f;
		_last_pan.y /= _chunks + 1f;
		if (_chunks == 0f)
		{
			((Vector2)(ref cur_pan)).Set(-1f, -1f);
		}
		else if (cur_pan.x == -1f && cur_pan.y == -1f)
		{
			((Vector2)(ref cur_pan)).Set(_last_pan.x, _last_pan.y);
		}
		else
		{
			cur_pan = Vector2.MoveTowards(cur_pan, _last_pan, 5f);
		}
	}
}
// --- End of File: MusicBoxContainerTiles.cs ---



// --- Start of File: MusicBoxContainerUnits.cs ---
public class MusicBoxContainerUnits
{
	public MusicAsset asset;

	public int units;

	public bool enabled;

	public void clear()
	{
		units = 0;
		enabled = false;
	}
}
// --- End of File: MusicBoxContainerUnits.cs ---



// --- Start of File: MusicBoxDebug.cs ---
using System.Collections.Generic;
using FMOD.Studio;
using UnityEngine;

public class MusicBoxDebug
{
	internal List<DebugMusicBoxData> list = new List<DebugMusicBoxData>();

	public void add(string pPath, float pX, float pY, EventInstance pInstance)
	{
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		pX += Randy.randomFloat(-0.5f, 0.5f);
		pY += Randy.randomFloat(-0.5f, 0.5f);
		list.Add(new DebugMusicBoxData
		{
			timer = 3f,
			path = pPath,
			x = pX,
			y = pY,
			instance = pInstance
		});
	}

	public void update()
	{
		for (int num = list.Count - 1; num >= 0; num--)
		{
			DebugMusicBoxData debugMusicBoxData = list[num];
			debugMusicBoxData.timer -= Time.deltaTime;
			if (debugMusicBoxData.timer <= 0f)
			{
				list.RemoveAt(num);
			}
		}
	}

	public void clear()
	{
		list.Clear();
	}
}
// --- End of File: MusicBoxDebug.cs ---



// --- Start of File: MusicBoxIdle.cs ---
using System.Collections.Generic;
using FMOD.Studio;

public class MusicBoxIdle
{
	private List<BaseSimObject> _toRemove = new List<BaseSimObject>();

	public Dictionary<BaseSimObject, EventInstance> currentAttachedSounds = new Dictionary<BaseSimObject, EventInstance>();

	private float _timer;

	public void update(float pElapsed)
	{
		if (_timer > 2f)
		{
			_timer -= pElapsed;
			return;
		}
		_timer = 2f;
		_toRemove.Clear();
		if (World.world.quality_changer.isLowRes())
		{
			clearAllSounds();
		}
		checkDeadSounds();
		if (!World.world.quality_changer.isLowRes())
		{
			updateBuildings();
		}
	}

	public virtual void checkDeadSounds()
	{
		foreach (BaseSimObject key in currentAttachedSounds.Keys)
		{
			bool flag = false;
			if (!key.isAlive())
			{
				flag = true;
			}
			if (flag)
			{
				_toRemove.Add(key);
			}
		}
		foreach (BaseSimObject item in _toRemove)
		{
			removeSound(item);
		}
	}

	private void updateBuildings()
	{
	}

	private void removeSound(BaseSimObject pObj)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		currentAttachedSounds.TryGetValue(pObj, out var value);
		if (((EventInstance)(ref value)).isValid())
		{
			((EventInstance)(ref value)).stop((STOP_MODE)0);
			((EventInstance)(ref value)).release();
			currentAttachedSounds.Remove(pObj);
		}
	}

	private void playAttachedSound(BaseSimObject pObject, string pSound)
	{
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		if (MusicBox.sounds_on)
		{
			currentAttachedSounds.TryGetValue(pObject, out var value);
			if (!((EventInstance)(ref value)).isValid())
			{
				currentAttachedSounds.Add(pObject, value);
			}
		}
	}

	private bool isPlaying(BaseSimObject pObject)
	{
		currentAttachedSounds.TryGetValue(pObject, out var value);
		if (((EventInstance)(ref value)).isValid())
		{
			return true;
		}
		return false;
	}

	public void clearAllSounds()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		foreach (EventInstance value in currentAttachedSounds.Values)
		{
			EventInstance current = value;
			((EventInstance)(ref current)).stop((STOP_MODE)0);
			((EventInstance)(ref current)).release();
		}
		currentAttachedSounds.Clear();
	}

	public int CountCurrentSounds()
	{
		return currentAttachedSounds.Count;
	}
}
// --- End of File: MusicBoxIdle.cs ---



// --- Start of File: MusicBoxLibrary.cs ---
using System.Collections.Generic;

public class MusicBoxLibrary : AssetLibrary<MusicAsset>
{
	internal readonly List<MusicBoxContainerTiles> c_list_params = new List<MusicBoxContainerTiles>();

	internal readonly Dictionary<string, MusicBoxContainerCivs> c_dict_civs = new Dictionary<string, MusicBoxContainerCivs>();

	internal readonly List<MusicBoxContainerTiles> c_list_environments = new List<MusicBoxContainerTiles>();

	internal readonly Dictionary<string, MusicBoxContainerUnits> c_dict_units = new Dictionary<string, MusicBoxContainerUnits>();

	public static MusicAsset New_World;

	public static MusicAsset Menu;

	public static MusicAsset Neutral_001;

	public static MusicAsset Locations_Desert;

	public override void init()
	{
		base.init();
		Menu = add(new MusicAsset
		{
			id = "Menu",
			disable_param_after_start = true
		});
		Neutral_001 = add(new MusicAsset
		{
			id = "Neutral_001",
			disable_param_after_start = true
		});
		New_World = add(new MusicAsset
		{
			id = "New_World",
			disable_param_after_start = true
		});
		add(new MusicAsset
		{
			id = "wea_rain"
		});
		add(new MusicAsset
		{
			id = "wea_snow"
		});
		addUnits();
		addUnique();
		addLoc();
		addEnv();
	}

	private void addEnv()
	{
		add(new MusicAsset
		{
			id = "LavaEnvironment",
			fmod_path = "event:/SFX/ENVIRONMENT/LavaEnvironment",
			is_environment = true,
			is_param = true,
			min_tiles_to_play = 30
		});
		t.setTileTypes("lava0", "lava1", "lava2", "lava3");
		add(new MusicAsset
		{
			id = "MapEnvironment",
			fmod_path = "event:/SFX/ENVIRONMENT/MapEnvironment",
			is_environment = true,
			is_param = true,
			mini_map_only = true
		});
		add(new MusicAsset
		{
			id = "Ocean",
			fmod_path = "event:/SFX/ENVIRONMENT/Ocean",
			is_environment = true,
			is_param = true,
			min_tiles_to_play = 100
		});
		t.setTileTypes("deep_ocean");
		add(new MusicAsset
		{
			id = "Sea",
			fmod_path = "event:/SFX/ENVIRONMENT/Sea",
			is_param = true,
			is_environment = true,
			min_tiles_to_play = 100
		});
		t.setTileTypes("close_ocean");
	}

	private void addLoc()
	{
		add(new MusicAsset
		{
			id = "Locations_Forest",
			is_param = true
		});
		t.setTileTypes("grass_high", "grass_low", "enchanted_low", "enchanted_high");
		Locations_Desert = add(new MusicAsset
		{
			id = "Locations_Desert",
			is_param = true
		});
		add(new MusicAsset
		{
			id = "Locations_Mountains",
			is_param = true
		});
		t.setTileTypes("hills", "mountains");
		add(new MusicAsset
		{
			id = "Locations_Ocean",
			is_param = true
		});
		t.setTileTypes("deep_ocean", "close_ocean");
		add(new MusicAsset
		{
			id = "Locations_Snow",
			is_param = true
		});
		t.setTileTypes("snow_block", "permafrost_high", "snow_hills", "permafrost_low", "snow_sand");
	}

	private void addUnique()
	{
		add(new MusicAsset
		{
			id = "Crabzilla",
			is_unit_param = true,
			special_delegate_units = delegate(MusicBoxContainerUnits pContainer)
			{
				if (ControllableUnit.isControllingCrabzilla())
				{
					pContainer.units = 1;
				}
			},
			priority = MusicLayerPriority.High
		});
		add(new MusicAsset
		{
			id = "GreyGoo",
			is_unit_param = true,
			special_delegate_units = delegate(MusicBoxContainerUnits pContainer)
			{
				if (World.world.grey_goo_layer.isActive())
				{
					if (!WorldLawLibrary.world_law_gaias_covenant.isEnabled() || MapBox.isRenderMiniMap())
					{
						pContainer.units = 1;
					}
					else
					{
						List<TileZone> visibleZones = World.world.zone_camera.getVisibleZones();
						for (int i = 0; i < visibleZones.Count; i++)
						{
							if (visibleZones[i].hasTilesOfType(TileLibrary.grey_goo))
							{
								pContainer.units = 1;
								break;
							}
						}
					}
				}
			},
			priority = MusicLayerPriority.Medium
		});
		add(new MusicAsset
		{
			id = "Unique_ZombieInfection",
			is_unit_param = true,
			special_delegate_units = delegate
			{
			},
			priority = MusicLayerPriority.Medium
		});
	}

	private void addUnits()
	{
		add(new MusicAsset
		{
			id = "_units_param",
			is_unit_param = true
		});
		clone("Units_Bandits", "_units_param");
		clone("Units_Bear", "_units_param");
		clone("Units_BeeHive", "_units_param");
		clone("Units_Cat", "_units_param");
		clone("Units_Chicken", "_units_param");
		clone("Units_ColdOne", "_units_param");
		clone("Units_Demon", "_units_param");
		clone("Units_Fairy", "_units_param");
		clone("Units_LivingPlants", "_units_param");
		clone("Units_Piranha", "_units_param");
		clone("Units_Rabbit", "_units_param");
		clone("Units_Rat", "_units_param");
		clone("Units_Skeleton", "_units_param");
		clone("Units_Sheep", "_units_param");
		clone("Units_Snowman", "_units_param");
		clone("Units_Wolf", "_units_param");
		clone("Units_Worm", "_units_param");
		clone("Units_Zombie", "_units_param");
		clone("Buildings_Tumor", "_units_param");
		clone("Humans_Neutral", "_units_param");
		clone("Elves_Neutral", "_units_param");
		clone("Orcs_Neutral", "_units_param");
		clone("Dwarves_Neutral", "_units_param");
		add(new MusicAsset
		{
			id = "Units_GodFinger",
			is_unit_param = true,
			special_delegate_units = special_god_finger
		});
		add(new MusicAsset
		{
			id = "Units_Dragon",
			is_unit_param = true,
			special_delegate_units = special_dragon
		});
		add(new MusicAsset
		{
			id = "Units_Santa",
			is_unit_param = true
		});
		add(new MusicAsset
		{
			id = "Units_UFO",
			is_unit_param = true,
			special_delegate_units = special_ufo
		});
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (MusicAsset item in list)
		{
			if (item.civilization)
			{
				addCivContainer(item);
			}
			if (item.is_param)
			{
				addTileContainer(item);
			}
			if (item.is_unit_param)
			{
				addUnitContainer(item);
			}
			string[] tile_type_strings = item.tile_type_strings;
			if (tile_type_strings == null || tile_type_strings.Length == 0)
			{
				continue;
			}
			using ListPool<TileTypeBase> listPool = new ListPool<TileTypeBase>(item.tile_type_strings.Length);
			string[] tile_type_strings2 = item.tile_type_strings;
			foreach (string text in tile_type_strings2)
			{
				if (AssetManager.top_tiles.has(text))
				{
					listPool.Add(AssetManager.top_tiles.get(text));
				}
				else if (AssetManager.tiles.has(text))
				{
					listPool.Add(AssetManager.tiles.get(text));
				}
				else
				{
					BaseAssetLibrary.logAssetError("MusicBoxLibrary: No matching Tile Type found for", text);
				}
			}
			item.tile_types = listPool.ToArray();
		}
		foreach (MusicAsset item2 in list)
		{
			if (item2.tile_types == null)
			{
				continue;
			}
			TileTypeBase[] tile_types = item2.tile_types;
			for (int i = 0; i < tile_types.Length; i++)
			{
				TileTypeBase tileTypeBase;
				TileTypeBase tileTypeBase2 = (tileTypeBase = tile_types[i]);
				if (tileTypeBase.music_assets == null)
				{
					tileTypeBase.music_assets = new List<MusicAsset>();
				}
				tileTypeBase2.music_assets.Add(item2);
			}
		}
	}

	private MusicBoxContainerUnits addUnitContainer(MusicAsset pAsset)
	{
		MusicBoxContainerUnits musicBoxContainerUnits = new MusicBoxContainerUnits();
		c_dict_units.Add(pAsset.id, musicBoxContainerUnits);
		musicBoxContainerUnits.asset = pAsset;
		return musicBoxContainerUnits;
	}

	private MusicBoxContainerCivs addCivContainer(MusicAsset pAsset)
	{
		MusicBoxContainerCivs musicBoxContainerCivs = new MusicBoxContainerCivs();
		c_dict_civs.Add(pAsset.id, musicBoxContainerCivs);
		musicBoxContainerCivs.asset = pAsset;
		return musicBoxContainerCivs;
	}

	private MusicBoxContainerTiles addTileContainer(MusicAsset pAsset)
	{
		MusicBoxContainerTiles musicBoxContainerTiles = new MusicBoxContainerTiles();
		musicBoxContainerTiles.asset = pAsset;
		pAsset.container_tiles = musicBoxContainerTiles;
		c_list_params.Add(musicBoxContainerTiles);
		if (pAsset.is_environment)
		{
			c_list_environments.Add(musicBoxContainerTiles);
		}
		return musicBoxContainerTiles;
	}

	private void special_god_finger(MusicBoxContainerUnits pContainer)
	{
		Kingdom kingdom = World.world.kingdoms_wild.get("godfinger");
		pContainer.units += kingdom.units.Count;
	}

	private void special_dragon(MusicBoxContainerUnits pContainer)
	{
		Kingdom kingdom = World.world.kingdoms_wild.get("dragons");
		pContainer.units += kingdom.units.Count;
	}

	private void special_ufo(MusicBoxContainerUnits pContainer)
	{
		ActorAsset actorAsset = AssetManager.actor_library.get("UFO");
		pContainer.units += actorAsset.units.Count;
	}
}
// --- End of File: MusicBoxLibrary.cs ---



// --- Start of File: MusicBoxTileData.cs ---
public struct MusicBoxTileData
{
	public int amount;

	public int tile_type_id;
}
// --- End of File: MusicBoxTileData.cs ---



// --- Start of File: MusicLayerPriority.cs ---
public enum MusicLayerPriority
{
	Low,
	Medium,
	High
}
// --- End of File: MusicLayerPriority.cs ---



// --- Start of File: MusicState.cs ---
public enum MusicState
{
	Intro,
	Menu,
	NewWorld
}
// --- End of File: MusicState.cs ---



// --- Start of File: NameEntry.cs ---
using Newtonsoft.Json;

public readonly struct NameEntry
{
	[JsonProperty]
	public readonly int color_id;

	[JsonProperty]
	public readonly string name;

	[JsonProperty]
	public readonly double timestamp;

	[JsonProperty]
	public readonly bool custom;

	public NameEntry(string pName, bool pCustom)
	{
		name = pName;
		color_id = -1;
		timestamp = (int)World.world.getCurWorldTime();
		custom = pCustom;
	}

	public NameEntry(string pName, bool pCustom, int pColorId)
	{
		name = pName;
		color_id = pColorId;
		timestamp = (int)World.world.getCurWorldTime();
		custom = pCustom;
	}

	public NameEntry(string pName, bool pCustom, double pTimestamp)
	{
		name = pName;
		color_id = -1;
		timestamp = (int)pTimestamp;
		custom = pCustom;
	}

	public NameEntry(string pName, bool pCustom, int pColorId, double pTimestamp)
	{
		name = pName;
		color_id = pColorId;
		timestamp = (int)pTimestamp;
		custom = pCustom;
	}
}
// --- End of File: NameEntry.cs ---



// --- Start of File: NameGenerator.cs ---
using System;
using System.Collections.Generic;
using UnityPools;

public class NameGenerator
{
	private static int _current_consonants = 0;

	private static int _current_vowels = 0;

	private static readonly char[] vowels_all = new char[6] { 'a', 'e', 'i', 'o', 'u', 'y' };

	private static readonly char[] consonants_all = new char[20]
	{
		'b', 'c', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'm',
		'n', 'p', 'q', 'r', 's', 't', 'v', 'w', 'x', 'z'
	};

	private static bool _initiated = false;

	[ThreadStatic]
	private static Dictionary<string, ListPool<string>> _dict_splitted_items;

	public static void init()
	{
		if (!_initiated)
		{
			_initiated = true;
			Blacklist.init();
		}
	}

	public static string generateName(Actor pActor, MetaType pType, long pSeed, ActorSex pSex = ActorSex.None)
	{
		string text = null;
		int hashCode = pType.GetHashCode();
		pSeed += hashCode;
		if (pActor.hasCulture())
		{
			OnomasticsData onomasticData = pActor.culture.getOnomasticData(pType);
			if (onomasticData != null)
			{
				return onomasticData.generateName(pSex, 0, pSeed);
			}
			text = pActor.culture.getNameTemplate(pType);
		}
		else
		{
			foreach (Actor parent in pActor.getParents())
			{
				if (parent.hasCulture())
				{
					OnomasticsData onomasticData2 = parent.culture.getOnomasticData(pType);
					if (onomasticData2 != null)
					{
						return onomasticData2.generateName(pSex, 0, pSeed);
					}
					text = parent.culture.getNameTemplate(pType);
					break;
				}
			}
		}
		if (string.IsNullOrEmpty(text))
		{
			text = pActor.asset.getNameTemplate(pType);
		}
		return getName(text, pSex, pForceLegacy: false, null, pSeed);
	}

	public static string getName(string pAssetID, ActorSex pSex = ActorSex.Male, bool pForceLegacy = false, string pTemplate = null, long? pSeed = null, bool pIgnoreBlackList = false)
	{
		init();
		NameGeneratorAsset nameGeneratorAsset = AssetManager.name_generator.get(pAssetID);
		_current_consonants = 0;
		_current_vowels = 0;
		string text = generateNameFromTemplate(nameGeneratorAsset, null, null, pForceLegacy, 0, pTemplate, null, pTestReplacer: false, pSeed, pSex, pIgnoreBlackList);
		if (!nameGeneratorAsset.hasOnomastics() && pSex == ActorSex.Female)
		{
			string strB = text.Substring(text.Length - 1, 1);
			bool flag = false;
			string[] vowels = nameGeneratorAsset.vowels;
			for (int i = 0; i < vowels.Length; i++)
			{
				if (vowels[i].CompareTo(strB) == 0)
				{
					flag = true;
					break;
				}
			}
			if (!flag)
			{
				text += Randy.getRandom(nameGeneratorAsset.vowels);
			}
		}
		return text;
	}

	private static string firstToUpper(string pString)
	{
		return pString.FirstToUpper();
	}

	private static string addVowel(string[] pList, bool pUppercase = false)
	{
		_current_consonants = 0;
		_current_vowels++;
		if (pUppercase)
		{
			return firstToUpper(Randy.getRandom(pList));
		}
		return Randy.getRandom(pList);
	}

	private static string addEnding(NameGeneratorAsset pTemplate, string pName)
	{
		string text = Randy.getRandom(pTemplate.parts);
		if (isConsonant(text[0]) && isConsonant(pName[pName.Length - 1]))
		{
			text = addVowel(pTemplate.vowels) + text;
		}
		else if (!isConsonant(text[0]) && !isConsonant(pName[pName.Length - 1]))
		{
			text = addConsonant(pTemplate.consonants) + text;
		}
		return text;
	}

	private static string addConsonant(string[] pList, bool pUppercase = false)
	{
		_current_consonants++;
		_current_vowels = 0;
		if (pUppercase)
		{
			return firstToUpper(Randy.getRandom(pList));
		}
		return Randy.getRandom(pList);
	}

	private static string addPart(string[] pArray, bool pUppercase = false)
	{
		string text = Randy.getRandom(pArray);
		if (isConsonant(text[text.Length - 1]))
		{
			_current_consonants++;
			_current_vowels = 0;
		}
		else
		{
			_current_consonants = 0;
			_current_vowels++;
		}
		if (pUppercase)
		{
			text = firstToUpper(text);
		}
		return text;
	}

	private static bool isConsonant(char pChar)
	{
		return consonants_all.IndexOf(pChar) > -1;
	}

	private static bool isVowel(char pChar)
	{
		return vowels_all.IndexOf(pChar) > -1;
	}

	public static string generateNameFromTemplate(string pAssetID, Actor pActor = null, Kingdom pKingdom = null, bool pForceLegacy = false)
	{
		return generateNameFromTemplate(AssetManager.name_generator.get(pAssetID), pActor, pKingdom, pForceLegacy);
	}

	public static string generateNameFromOnomastics(NameGeneratorAsset pAsset, string pTemplate = null, Actor pActor = null, long? pSeed = null, ActorSex pSex = ActorSex.None)
	{
		OnomasticsData onomasticsData = (string.IsNullOrEmpty(pTemplate) ? OnomasticsCache.getOriginalData(pAsset.onomastics_templates.GetRandom()) : OnomasticsCache.getOriginalData(pTemplate));
		ActorSex pSex2 = pSex;
		if (pActor != null)
		{
			pSex2 = pActor.data.sex;
		}
		return onomasticsData.generateName(pSex2, 0, pSeed);
	}

	public static string generateNamesFromTemplate(int pAmount, NameGeneratorAsset pAsset, Actor pActor = null, Kingdom pKingdom = null, bool pForceLegacy = false, bool pTestReplacer = false)
	{
		string text = "";
		HashSet<string> hashSet = new HashSet<string>();
		List<string> list = new List<string>();
		if (pAsset.hasOnomastics() && !pForceLegacy)
		{
			foreach (string onomastics_template in pAsset.onomastics_templates)
			{
				hashSet.Clear();
				list.Clear();
				for (int i = 0; i < 100; i++)
				{
					hashSet.Add(generateNameFromTemplate(pAsset, pActor, pKingdom, pForceLegacy: false, 0, onomastics_template, null, pTestReplacer));
				}
				text = text + "\n--- " + onomastics_template;
				text = text + "\n -- (" + hashSet.Count + " / " + 100 + ") \n";
				list.AddRange(hashSet);
				list.Shuffle();
				if (list.Count - pAmount > 0)
				{
					list.RemoveRange(pAmount, list.Count - pAmount);
				}
				list.Sort();
				foreach (string item in list)
				{
					text = text + item + "\n";
				}
			}
		}
		else
		{
			for (int j = 0; j < 100; j++)
			{
				hashSet.Add(generateNameFromTemplate(pAsset, pActor, pKingdom, pForceLegacy, 0, null, null, pTestReplacer));
			}
			text += "\n--- Legacy";
			text = text + "\n -- (" + hashSet.Count + " / " + 100 + ") \n";
			list.AddRange(hashSet);
			list.Shuffle();
			if (list.Count - pAmount > 0)
			{
				list.RemoveRange(pAmount, list.Count - pAmount);
			}
			list.Sort();
			foreach (string item2 in list)
			{
				text = text + item2 + "\n";
			}
		}
		return text;
	}

	public static string generateNameFromTemplate(NameGeneratorAsset pAsset, Actor pActor = null, Kingdom pKingdom = null, bool pForceLegacy = false, int pCalls = 0, string pOnomasticsTemplate = null, string[] pClassicTemplate = null, bool pTestReplacer = false, long? pSeed = null, ActorSex pSex = ActorSex.None, bool pIgnoreBlacklist = false)
	{
		if (pCalls > 50)
		{
			return string.Empty;
		}
		if (pAsset.hasOnomastics() && !pForceLegacy)
		{
			return generateNameFromOnomastics(pAsset, pOnomasticsTemplate, pActor, pSeed, pSex);
		}
		_current_consonants = 0;
		_current_vowels = 0;
		string pName = "";
		string[] obj = pClassicTemplate ?? pAsset.templates.GetRandom();
		bool flag = false;
		bool flag2 = false;
		string[] array = obj;
		foreach (string text in array)
		{
			string text2;
			string text3;
			if (text.Contains('#'))
			{
				string[] array2 = text.Split('#');
				text2 = array2[0];
				text3 = array2[1];
			}
			else
			{
				text2 = text;
				text3 = "";
			}
			if (pAsset.use_dictionary)
			{
				if (text2 == "$comma$")
				{
					pName += ", ";
					continue;
				}
				if (text2.Contains(';'))
				{
					text2 = text2.Split(';').GetRandom();
				}
				Dictionary<string, ListPool<string>> dict_splitted_items = _dict_splitted_items;
				if (dict_splitted_items == null || !dict_splitted_items.ContainsKey(text2))
				{
					if (_dict_splitted_items == null)
					{
						_dict_splitted_items = UnsafeCollectionPool<Dictionary<string, ListPool<string>>, KeyValuePair<string, ListPool<string>>>.Get();
					}
					ListPool<string> value = new ListPool<string>(pAsset.dict_parts[text2].Split(','));
					_dict_splitted_items.Add(text2, value);
				}
				_dict_splitted_items[text2].ShuffleLast();
				string text4 = _dict_splitted_items[text2].Last();
				if (_dict_splitted_items[text2].Count > 1)
				{
					_dict_splitted_items[text2].Pop();
				}
				pName += text4;
				continue;
			}
			switch (text2)
			{
			case "RANDOM_LETTER":
				pName = ((!Randy.randomBool()) ? (pName + addConsonant(pAsset.consonants, pUppercase: true)) : (pName + addVowel(pAsset.vowels, pUppercase: true)));
				break;
			case "space":
			case " ":
				pName += " ";
				break;
			case "letters":
			{
				string[] array4 = text3.Split('-');
				pName += addWord(pAsset, int.Parse(array4[0]), int.Parse(array4[1]));
				break;
			}
			case "Letters":
			{
				string[] array3 = text3.Split('-');
				pName += addWord(pAsset, int.Parse(array3[0]), int.Parse(array3[1]), pToUpperFirst: true);
				break;
			}
			case "part":
				pName += pAsset.parts.GetRandom();
				break;
			case "consonant":
				pName += addConsonant(pAsset.consonants);
				break;
			case "CONSONANT":
				pName += addConsonant(pAsset.consonants, pUppercase: true);
				break;
			case "vowel":
				pName += addVowel(pAsset.vowels);
				break;
			case "vowelchance":
				if (Randy.randomBool())
				{
					pName += addVowel(pAsset.vowels);
				}
				break;
			case "removalchance":
				if (Randy.randomBool())
				{
					pName.Remove(pName.Length - 1);
				}
				break;
			case "VOWEL":
				pName += addVowel(pAsset.vowels, pUppercase: true);
				break;
			case "special1":
				pName += pAsset.special1.GetRandom();
				break;
			case "special2":
				pName += pAsset.special2.GetRandom();
				break;
			case "Part":
			{
				string random = pAsset.parts.GetRandom();
				random = firstToUpper(random);
				pName += random;
				break;
			}
			case "number":
				pName += Randy.randomInt(0, 10);
				break;
			case "addition_start":
				if (!flag2 && Randy.randomChance(pAsset.add_addition_chance))
				{
					pName = pName + pAsset.addition_start.GetRandom() + " ";
					flag2 = true;
				}
				break;
			case "addition_ending":
				if (!flag2 && Randy.randomChance(pAsset.add_addition_chance))
				{
					pName = pName + " " + pAsset.addition_ending.GetRandom();
					flag2 = true;
				}
				break;
			case "part_group":
				foreach (string part_group in pAsset.part_groups)
				{
					string[] pArray6 = part_group.Split(',');
					pName += pArray6.GetRandom();
				}
				break;
			case "part_group2":
				foreach (string item in pAsset.part_groups2)
				{
					string[] pArray5 = item.Split(',');
					pName += pArray5.GetRandom();
				}
				break;
			case "part_group3":
				foreach (string item2 in pAsset.part_groups3)
				{
					string[] pArray4 = item2.Split(',');
					pName += pArray4.GetRandom();
				}
				break;
			case "Part_group":
				flag = true;
				foreach (string part_group2 in pAsset.part_groups)
				{
					string[] pArray3 = part_group2.Split(',');
					if (flag)
					{
						pName += firstToUpper(pArray3.GetRandom());
						flag = false;
					}
					else
					{
						pName += pArray3.GetRandom();
					}
				}
				break;
			case "Part_group2":
				flag = true;
				foreach (string item3 in pAsset.part_groups2)
				{
					string[] pArray2 = item3.Split(',');
					if (flag)
					{
						pName += firstToUpper(pArray2.GetRandom());
						flag = false;
					}
					else
					{
						pName += pArray2.GetRandom();
					}
				}
				break;
			case "Part_group3":
				flag = true;
				foreach (string item4 in pAsset.part_groups3)
				{
					string[] pArray = item4.Split(',');
					if (flag)
					{
						pName += firstToUpper(pArray.GetRandom());
						flag = false;
					}
					else
					{
						pName += pArray.GetRandom();
					}
				}
				break;
			}
		}
		if (pName.Contains('$'))
		{
			if (pTestReplacer)
			{
				NameGeneratorReplacers.replacer_debug(ref pName);
			}
			else
			{
				if (pAsset.replacer != null)
				{
					pAsset.replacer(ref pName, pActor);
				}
				if (pAsset.replacer_kingdom != null)
				{
					pAsset.replacer_kingdom(ref pName, pKingdom);
				}
			}
		}
		bool flag3 = false;
		if (string.IsNullOrEmpty(pName))
		{
			flag3 = true;
		}
		else if (!pAsset.use_dictionary && !pIgnoreBlacklist && Blacklist.checkBlackList(pName))
		{
			flag3 = true;
		}
		if (flag3)
		{
			return generateNameFromTemplate(pAsset, pActor, pKingdom, pForceLegacy, ++pCalls, pOnomasticsTemplate, pClassicTemplate, pTestReplacer);
		}
		pName = firstToUpper(pName);
		if (pAsset.finalizer != null)
		{
			pName = pAsset.finalizer(pName);
		}
		if (_dict_splitted_items != null)
		{
			foreach (ListPool<string> value2 in _dict_splitted_items.Values)
			{
				value2.Dispose();
			}
			_dict_splitted_items.Clear();
			UnsafeCollectionPool<Dictionary<string, ListPool<string>>, KeyValuePair<string, ListPool<string>>>.Release(_dict_splitted_items);
			_dict_splitted_items = null;
		}
		return pName;
	}

	private static string addWord(NameGeneratorAsset pAsset, int pMin, int pMax, bool pToUpperFirst = false)
	{
		string text = "";
		int num = Randy.randomInt(pMin, pMax);
		for (int i = 0; i < num; i++)
		{
			if (_current_consonants >= pAsset.max_consonants_in_row)
			{
				text += addVowel(pAsset.vowels, pToUpperFirst);
				pToUpperFirst = false;
			}
			else if (_current_vowels >= pAsset.max_vowels_in_row)
			{
				text += addConsonant(pAsset.consonants, pToUpperFirst);
				pToUpperFirst = false;
			}
			else if (Randy.randomBool())
			{
				text += addVowel(pAsset.vowels, pToUpperFirst);
				pToUpperFirst = false;
			}
			else
			{
				text += addConsonant(pAsset.consonants, pToUpperFirst);
				pToUpperFirst = false;
			}
		}
		return text;
	}
}
// --- End of File: NameGenerator.cs ---



// --- Start of File: NameGeneratorAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;

[Serializable]
public class NameGeneratorAsset : Asset
{
	public static string[] vowels_all = new string[6] { "a", "e", "i", "o", "u", "y" };

	public static string[] consonants_all = new string[20]
	{
		"b", "c", "d", "f", "g", "h", "j", "k", "l", "m",
		"n", "p", "q", "r", "s", "t", "v", "w", "x", "z"
	};

	public static string[] consonants_sounds = new string[19]
	{
		"b", "c", "d", "f", "g", "h", "ph", "ch", "k", "l",
		"m", "n", "p", "r", "s", "t", "v", "w", "sh"
	};

	public string[] special1;

	public string[] special2;

	public string[] vowels;

	public string[] consonants;

	public string[] parts;

	public string[] addition_start;

	public string[] addition_ending;

	public List<string> onomastics_templates = new List<string>();

	public List<string> part_groups;

	public List<string> part_groups2;

	public List<string> part_groups3;

	public Dictionary<string, string> dict_parts;

	public bool use_dictionary;

	public List<string[]> templates;

	[DefaultValue(1)]
	public int max_vowels_in_row = 1;

	[DefaultValue(1)]
	public int max_consonants_in_row = 1;

	[DefaultValue(0.5f)]
	public float add_addition_chance = 0.5f;

	public NameGeneratorCheck check;

	public NameGeneratorReplacer replacer;

	public NameGeneratorReplacerKingdom replacer_kingdom;

	public NameGeneratorFinalizer finalizer;

	public bool hasOnomastics()
	{
		return onomastics_templates.Count > 0;
	}

	public void addOnomastic(string pOnomastic)
	{
		if (onomastics_templates == null)
		{
			onomastics_templates = new List<string>();
		}
		onomastics_templates.Add(pOnomastic);
	}

	public void addTemplate(string pTemplateString)
	{
		if (templates == null)
		{
			templates = new List<string[]>();
		}
		string[] item = pTemplateString.Split(',');
		templates.Add(item);
	}

	public void addPartGroup(string pGroupString)
	{
		if (part_groups == null)
		{
			part_groups = new List<string>();
		}
		part_groups.Add(pGroupString);
	}

	public void addPartGroup2(string pGroupString)
	{
		if (part_groups2 == null)
		{
			part_groups2 = new List<string>();
		}
		part_groups2.Add(pGroupString);
	}

	public void addPartGroup3(string pGroupString)
	{
		if (part_groups3 == null)
		{
			part_groups3 = new List<string>();
		}
		part_groups3.Add(pGroupString);
	}

	public void addDictPart(string pID, string pListString)
	{
		if (dict_parts == null)
		{
			dict_parts = new Dictionary<string, string>();
		}
		dict_parts.Add(pID, pListString);
	}
}
// --- End of File: NameGeneratorAsset.cs ---



// --- Start of File: NameGeneratorCheck.cs ---
public delegate bool NameGeneratorCheck(Actor pActor);
// --- End of File: NameGeneratorCheck.cs ---



// --- Start of File: NameGeneratorChecks.cs ---
public static class NameGeneratorChecks
{
	public static bool hasLatinKing(Actor pActor)
	{
		if (!hasCivKingdom(pActor))
		{
			return false;
		}
		if (!pActor.kingdom.hasKing())
		{
			return false;
		}
		if (!Toolbox.isFirstLatin(pActor.kingdom.king.getName()))
		{
			return false;
		}
		return true;
	}

	public static bool hasEnemyLatinKing(Actor pActor)
	{
		if (!hasCivKingdom(pActor))
		{
			return false;
		}
		if (!pActor.kingdom.hasEnemies())
		{
			return false;
		}
		using ListPool<Kingdom> listPool = pActor.kingdom.getEnemiesKingdoms();
		foreach (ref Kingdom item in listPool)
		{
			Kingdom current = item;
			if (current.hasKing() && Toolbox.isFirstLatin(current.king.getName()))
			{
				return true;
			}
		}
		return false;
	}

	public static bool hasCivKingdom(Actor pActor)
	{
		if (pActor == null)
		{
			return false;
		}
		if (pActor.kingdom == null)
		{
			return false;
		}
		if (!pActor.isKingdomCiv())
		{
			return false;
		}
		return true;
	}

	public static bool hasLatinKingdom(Actor pActor)
	{
		if (!hasCivKingdom(pActor))
		{
			return false;
		}
		if (!Toolbox.isFirstLatin(pActor.kingdom.name))
		{
			return false;
		}
		return true;
	}

	public static bool hasEnemyLatinKingdom(Actor pActor)
	{
		if (!hasCivKingdom(pActor))
		{
			return false;
		}
		if (!pActor.kingdom.hasEnemies())
		{
			return false;
		}
		using ListPool<Kingdom> listPool = pActor.kingdom.getEnemiesKingdoms();
		foreach (ref Kingdom item in listPool)
		{
			if (Toolbox.isFirstLatin(item.name))
			{
				return true;
			}
		}
		return false;
	}

	public static bool hasLatinCity(Actor pActor)
	{
		if (pActor == null)
		{
			return false;
		}
		if (!pActor.hasCity())
		{
			return false;
		}
		if (!Toolbox.isFirstLatin(pActor.city.name))
		{
			return false;
		}
		return true;
	}

	public static bool hasLatinCulture(Actor pActor)
	{
		if (pActor == null)
		{
			return false;
		}
		if (!pActor.hasCulture())
		{
			return false;
		}
		if (!Toolbox.isFirstLatin(pActor.culture.name))
		{
			return false;
		}
		return true;
	}
}
// --- End of File: NameGeneratorChecks.cs ---



// --- Start of File: NameGeneratorFinalizer.cs ---
public delegate string NameGeneratorFinalizer(string pName);
// --- End of File: NameGeneratorFinalizer.cs ---



// --- Start of File: NameGeneratorLibrary.cs ---
using System;
using System.Collections.Generic;
using System.Globalization;

[Serializable]
public class NameGeneratorLibrary : AssetLibrary<NameGeneratorAsset>
{
	public const string ALLIANCE = "$alliance$";

	public const string CITY = "$city$";

	public const string CITY_RANDOM = "$city_random$";

	public const string CLAN = "$clan$";

	public const string CLAN_RANDOM = "$clan_random$";

	public const string CULTURE = "$culture$";

	public const string CULTURE_RANDOM = "$culture_random$";

	public const string KING = "$king$";

	public const string KINGDOM = "$kingdom$";

	public const string KINGDOM_RANDOM = "$kingdom_random$";

	public const string KING_LOVER = "$king_lover$";

	public const string KING_RANDOM = "$king_random$";

	public const string LANGUAGE = "$language$";

	public const string LANGUAGE_RANDOM = "$language_random$";

	public const string LEADER = "$leader$";

	public const string LEADER_LOVER = "$leader_lover$";

	public const string LEADER_RANDOM = "$leader_random$";

	public const string OWN_BEST_FRIEND = "$own_best_friend$";

	public const string OWN_LOVER = "$own_lover$";

	public const string RELIGION = "$religion$";

	public const string RELIGION_RANDOM = "$religion_random$";

	public const string FAMILY = "$family$";

	public const string FAMILY_FOUNDER_1 = "$family_founder_1$";

	public const string FAMILY_FOUNDER_2 = "$family_founder_2$";

	public const string FAMILY_RANDOM = "$family_random$";

	public const string FIGURE = "$figure$";

	public const string FOOD = "$food$";

	public const string ITEM = "$item$";

	public const string SUBSPECIES_RANDOM = "$random_subspecies$";

	public const string SUBSPECIES = "$subspecies$";

	public const string UNIT = "$unit$";

	public const string WARRIOR = "$warrior$";

	public const string ARCHITECT_NAME = "$architect_name$";

	public const string WORLD_NAME = "$world_name$";

	public const string COMMA = "$comma$";

	private const string BASE_BOOK_TEMPLATE = "$base_book_template$";

	private static readonly string[] _preps = new string[24]
	{
		"a", "and", "as", "at", "but", "by", "en", "for", "if", "in",
		"its", "nor", "of", "on", "or", "the", "their", "to", "v", "v.",
		"via", "vs", "vs.", "about"
	};

	public override void init()
	{
		base.init();
		addClanNames();
		addWarNames();
		addAllianceNames();
		addKingdomMottos();
		addClanMottos();
		addAllianceMottos();
		addCultureNames();
		addCivNames();
		addMobNames();
		addItemNames();
		addWorldNames();
		addPlayerNames();
		addAnimalCivsNames();
		addBookNames();
		addItemSpecial();
	}

	private void addAnimalCivsNames()
	{
		add(new NameGeneratorAsset
		{
			id = "tribe_generic_name"
		});
		addPartGroup("haka,ste,hvo,pa,ba,go");
		addPartGroup("r,d,f,d,v,tt,");
		addPartGroup("p,hb,,");
		addPartGroup("aa,e,o,,");
		addPartGroup("ich,hko,ov");
		addTemplate("Part_group");
	}

	private void addClanNames()
	{
		add(new NameGeneratorAsset
		{
			id = "human_clan"
		});
		addOnomastic("012f3f4|0:ka ste vo pa ba go;1:r d f d v t;2:p b;3:a e o;4:ich ko ov");
		add(new NameGeneratorAsset
		{
			id = "elf_clan"
		});
		addOnomastic("0f0ff1f1ff2/102|0:sy se fe fu au ae oe oa ea ey a e u;1:lva da ba fa va na ma fo ri ru;2:lis ari ri ori ere era eba eta ba ra las los les");
		add(new NameGeneratorAsset
		{
			id = "dwarf_clan"
		});
		addOnomastic("0_145f8/0_14548|0:dah fam fus ro;1:d dr h mr r rk t th tr;4:a e o;5:b bre bro d dre drede dri r roke;8:dock dok dr kc ken kon kor or rack reck rock");
		add(new NameGeneratorAsset
		{
			id = "orc_clan"
		});
		addOnomastic("01f_49f/4_01f9f/411f9f|0:ba da da de de ka ke ma me ra za ze zo;1:ba da da dada de de dede ka ke ma me ra za ze zo;4:baha baka daka daka deez deka deka deze doka doke kaka keka maka mako meka moko raka waha zaga zaza zega zoga zoko zomo;9:k z");
		addGroup("folk_clan", "0f2f3f42c|0:ash car rad wey ald brad win;2:o e i a;3:r l t n d g v;4:ton ford ley wood ham worth", "frankish_clan", "0f_12f3V4|0:de du la le;1:beu clau cour loix mont val vil;2:a e i o u;3:g l n r t v;4:bois clair court fleur font mont ville", "germanic_clan", "0f_1f2f3V45C6V|0:aus gud van von zu;1:arn aus eich hoh met neu;2:a e o u;3:b d l n r t;4:b b h k m st w;5:a a e e ei o oi u;6:f ff hl hn ld n nn rf rg", "iberian_clan", "0f_12f3Vf4C56|0:de de del dela la pe ra;1:al ar bal cal mar val zar;2:a e i o u;3:d g l n r v z;4:a e i i la o o;6:a o o o;5:d ll ll n r r z", "monolux_clan", "9f_V00f1c3Vf6|0:bel cl col con da de do du es fl gr he la le mar mon ne pel ra re ro ru st str vi we ze;1:a e i o u;3:ch ng sch;6:ange buerg cort don dorph fon gen in lux mer mont sur ton vil weila;9:d' de", "nordic_clan", "0125f789|0:Th Er Ol Har Sv Bj S G L;1:o i a a e o i u ei;2:r k f ld n rn g nn f;5:ar in al an en;7:s s ss d b str l;8:o e o otti e o u;9:n n n r rg m nd", "poly_clan", "06Vfff1f3f6Vfff3|0:ha hu hu ka koa ku la ma ngi nu nu ra ta;1:ho ka ka kai ku lu ma ma pua wa;3:ha hi ka la la loa na ni nui ra ra ta;6:'", "pomeranian_clan", "012f3f|0:bor gr kr pom stet sw szcz wol zem;1:an ar en er in ir ol on or un ur;2:ch cz k s sz w z;3:ak cki czyk ek icz owicz ski wicz", "posh_clan", "01f2f3|0:ard arr ash bar berk castor corlyn drake earl gray greth grey hall hill horn lyth mar mar rath star tar tarrow thorne varren wess weybrook white wynch;1:a e i o u;2:r l t s n;3:bourne cliffe croft dale down ford fort grove hal hall heath hill march mont moor reach ridge rock ryen stead ster stone tell thorne ton torn vale wood", "rome_clan", "0f_1f2Cf3V45|0:da del della di gi;1:bon bru cae car fal giu mal mar tor vin;2:a e i o u;3:g l n r s t;4:a a e e i o o;5:llo ne ni ni no nte r tti vi", "rus_clan", "01Cf2Vf3Cf7V5M6F|2:g k k l m n r r r t;3:a e i o u;4:g l m n r s t v z;5:enko ev ich in ivich ky ov ovich yev;6:aya eva evna ichna ina ivna ova;7:d g k r s sk v;0:ab ag al al an b br d gr ig iv k m n p s sh sm v vl yu;1:a e e e ev ex i i i o o", "slavic_clan", "01v2f3f4M5F|0:ko mly no li ku be kra pie maz mys;1:wie b ch w n cz sz li;2:e i y;3:cz sz rz;4:ski cki dzki ny ty jek tek rek;5:ska cka dzka na ta jka tka rka", "nomad_clan", "0125f|0:ab abd al asg asgh az bad bas bash bil bin daw far fas gad gh hab had hus ibn jab jaw jaz kad raf;1:a i u;2:b d f h k l m n r s t z;5:an in un", "sino_clan", "016V4Cf|0:ch g h l l m w w x y zh zh zh;1:ang ang ang ao ei en i ia in iu ou u u uo;4:a e i o u;6:b b ch d f g g h k k k m m m n n sh", "siam_clan", "012378|0:ad b b b b ch ch ch ch d j k k kr kr m n p pr r r r r r s sh sr sr t th th th ud v v w w y;1:a ai e i o oo u;2:ch d k l m n ng p r t;3:a e ee i o u;7:ch ch k k l m n p ph r r s s s sr t w;8:aew ai ak at i in oen on ong", "vishna_clan", "012Cf|0:abhi aho andhra anga anu asma ava ba bha bho bri bu ce cha che cho chu da de di do fu ga go gu ha he ho ikshva iksva ja ka ke kha khe khme ki ko ksha ku la li lo ma mi mu na ne oi pa po pra pu ra re ro sa se sha shi shu si so sri su ta tha to tri utpa va vi ya;1:b cchav d damb darbh dasam dav dir dnapor duk dura dyot ffn g gar ghel gvansh h hadaval hadrath haman han har harat hey hisapal hurip ilendr indhav ink jahnat janat japah japat jayanagar jjik jvapal k katiy ket kotta ky l labh labhr lachur lakanagar lav lingg ll llabh llal llav lon luky lw m mar marup mas matat mava mbuw mm mp n nagar nchal nd ndhar ndy nes ng ngar ngg nggal ngha ngka nind niw njav nl nmal nn nna nt nv p pal pt pur pur pur r rabha rasen rashiv rat rataraj rath rayang ripunjay rjaratr rkh rkot rn rtadi ruma ryank s sal sh shiv shm shnu shtrakut shunag sunur t ta tah tar tava tiy tr ts tsy tu tyur ud urav ury v vagang vd vijay y yak ysal;2:a a a a a a aj ak al al am an an an an an an an an an and ap ar ar arh as at e e e eddy en en er i i i i i i i indh ir it o och om or u u u u u uh uj um ur us", "nihon_clan", "02135/0245/02134/0254|0:h k m n s t y;1:h k m n s t;2:ai a e i o u;3:a e i o u;4:ha ka mo mu shi chi da ya;5:gu be ki ma mo ra to ta wa ya");
		addGroup("vishna_family", "01C3Vf4V6|0:ahlu apte ba ba ba ch cho da ga iye jo ka ka kha ku ma na pa ra sa sha si va;1:a e i o u;2:b ch d g h j k l m n p r s t v y;3:l ng;4:dar kar mar ng pal sh;6:a ar as e el i ingh ir o u u");
	}

	private void addWarNames()
	{
		add(new NameGeneratorAsset
		{
			id = "war_spite",
			use_dictionary = true,
			replacer_kingdom = NameGeneratorReplacers.replaceKingdom
		});
		addDictPart("kingdom_name", "$kingdom$");
		addDictPart(" ", " ");
		addDictPart("of", "of");
		addDictPart("anger", "Anger,Bloodshed,Insanity,Screaming,Yelling,Brawl,Rage,Fury,Wrath,Grudge,Hate");
		addDictPart("bloody", "Bloody,Red,Blue,Green,Screaming,Angry,Total,Worldwide,Insane");
		addDictPart("hatred", "Hatred,Dislike,Grudge,Detest,Despise,Death,Destruction,Oblivion,Silence,Obliteration");
		addTemplate("bloody, ,hatred");
		addTemplate("anger, ,of, ,kingdom_name");
		add(new NameGeneratorAsset
		{
			id = "war_rebellion",
			use_dictionary = true,
			replacer_kingdom = NameGeneratorReplacers.replaceKingdom
		});
		addDictPart("kingdom_name", "$kingdom$");
		addDictPart(" ", " ");
		addDictPart("of", "of");
		addDictPart("rebellion", "Rebellion,Uprising,Unrest,Rising,Insurgency,Trouble,Freedom");
		addDictPart("color", "Red,Yellow,Bloody,Dark,Nice,Pink,Brutal,Cruel,Ruby,Angry,Annoyed,Furious,Mad,Wild,Enraged,Violent");
		addTemplate("rebellion, ,of, ,kingdom_name");
		addTemplate("color, ,rebellion");
		add(new NameGeneratorAsset
		{
			id = "war_inspire",
			use_dictionary = true,
			replacer_kingdom = NameGeneratorReplacers.replaceKingdom
		});
		addDictPart("kingdom_name", "$kingdom$");
		addDictPart(" ", " ");
		addDictPart("of", "of");
		addDictPart("great", "Great,Forced,Amazing,Inspired,Shocking,Horrific,Serious");
		addDictPart("idea", "Idea,Thought,Plan,Goal");
		addTemplate("great, ,idea, ,of, ,kingdom_name");
		addTemplate("idea, ,of, ,kingdom_name");
		add(new NameGeneratorAsset
		{
			id = "war_whisper",
			use_dictionary = true,
			replacer_kingdom = NameGeneratorReplacers.replaceKingdom
		});
		addDictPart(" ", " ");
		addDictPart("kingdom_name", "$kingdom$");
		addDictPart("'s", "'s");
		addDictPart("of", "of");
		addDictPart("evil", "Evil,Horrible,Wicked,Bad,Corrupt,Forced,Wrong,Mad,Crazy");
		addDictPart("unprovoked", "Unprovoked,Unjustified,Groundless,Unfair,Rude");
		addDictPart("war", "War,Fight,Conquest,Battle");
		addTemplate("evil, ,war, ,of, ,kingdom_name");
		addTemplate("war, ,of, ,kingdom_name");
		addTemplate("unprovoked, ,war");
		addTemplate("evil, ,war");
		add(new NameGeneratorAsset
		{
			id = "war_conquest",
			use_dictionary = true,
			replacer_kingdom = NameGeneratorReplacers.replaceKingdom
		});
		addDictPart(" ", " ");
		addDictPart("kingdom_name", "$kingdom$");
		addDictPart("'s", "'s");
		addDictPart("of", "of");
		addDictPart("great", "Great,Big,Huge,Red,Bloody,Bad,Good,Horrible,Sudden");
		addDictPart("war", "Conquest,War,Clash");
		addDictPart("justice", "Justice,Iron,Dreams,Storm,Kings,Terror,Broken Bones,Broken Dreams,Broken Future,Broken Promises,Broken Words,Fools,Angels,Freedom,Steel");
		addTemplate("great, ,war, ,of, ,kingdom_name");
		addTemplate("war, ,of, ,justice");
		addTemplate("great, ,war");
	}

	private void addAllianceNames()
	{
		add(new NameGeneratorAsset
		{
			id = "alliance_name",
			use_dictionary = true
		});
		addDictPart("first", "Great,Steel,Holy,Eternal,Fancy,Strong,Big,Deadly,Mighty,Powerful,Serious,Nice,Supreme,Divine,Awesome,Epic,Brave,True,Wise,Ancient,Wild,Old,New,Golden");
		addDictPart(" ", " ");
		addDictPart("of", " of ");
		addDictPart("and", " and ");
		addDictPart("our", "Our");
		addDictPart("people", "People,Beings,Stars,Titans,Keepers,Eyes,Grains,Stares,Friends,Minds,Bellies,Hearts,Heads,Bodies,Lives,Folks,Eggs,Souls,Voices,Spirits,Guts,Noses,Skulls,Hopes,Roots,Flames,Bones,Dreams,Wills");
		addDictPart("second", "Alliance,Unity,Friendship,Union,League,Treaty,Coalition,Power,Accord,Pact,Club,Shield,Sword,Axe,Bond,Conclave,Order,Legion,Assembly");
		addDictPart("element", "Fire,Water,Earth,Air,Light,Darkness,Void,Thunder,Ice");
		addDictPart("creature", "Dragon,Turtle,Crab,Bear");
		addTemplate("first, ,second");
		addTemplate("first, ,people");
		addTemplate("second,of,first");
		addTemplate("second,of,people");
		addTemplate("people,and,people");
		addTemplate("our, ,second");
		addTemplate("people,of,element");
		addTemplate("first, ,people,of,element");
		addTemplate("creature, ,second");
	}

	private void addItemSpecial()
	{
		add(new NameGeneratorAsset
		{
			id = "reforged_item"
		});
		addPartGroup("sh,ste");
		addPartGroup("a,e,o,y,oo");
		addPartGroup("sh,ste,la");
		addPartGroup("b,m,l");
		addPartGroup("a,e,o,y,oo");
		addPartGroup("a,e,o,y,oo");
		addTemplate("Part_group");
	}

	private void addMobNames()
	{
		add(new NameGeneratorAsset
		{
			id = "sheep_name"
		});
		addOnomastic("012|0:b;1:a aa aaa o oo ooo y yy yyy;2:h");
		add(new NameGeneratorAsset
		{
			id = "penguin_name"
		});
		addOnomastic("0123|0:h w d t;1:u uu uuu a aa aaa;2:g gg d r z;3:o oo ooo a aa aaa");
		add(new NameGeneratorAsset
		{
			id = "turtle_name"
		});
		addOnomastic("012|0:l t g z;1:u uu a aa o oo;2:k kk;3:o oo ooo a aa aaa");
		add(new NameGeneratorAsset
		{
			id = "wolf_name"
		});
		addOnomastic("012|0:w;1:o oo oo a aa aaa;2:f;3:o oo ooo a aa aaa");
		add(new NameGeneratorAsset
		{
			id = "greg_name"
		});
		addOnomastic("0129|0:g;1:r r r r r r r r r r rr;2:e e e e e e e o;9:g gaz gef ges gim gis gonk gos");
		add(new NameGeneratorAsset
		{
			id = "chicken_name"
		});
		addOnomastic("o/oo/o_o_o/o_o|0:k g d b ka ko go keke koko kh kh;1:o a a");
		add(new NameGeneratorAsset
		{
			id = "alien_name"
		});
		addOnomastic("o/0_0|0:ze zo zo ze zog zag xag xeg xo xe;1:o oo oo a aa a y u;2:r d z ze tze tza n");
		add(new NameGeneratorAsset
		{
			id = "ufo_name"
		});
		addOnomastic("0-####f|0:tk xx yt z rt pp kl qr lol q rebr");
		add(new NameGeneratorAsset
		{
			id = "cold_one_name"
		});
		addOnomastic("o|0:ice icy co colo;1:m n mem non;2:e a o y;3:n c k brr b");
		add(new NameGeneratorAsset
		{
			id = "bug_name"
		});
		addOnomastic("o|0:e ee eee eeee;1:w ww www");
		add(new NameGeneratorAsset
		{
			id = "ant_name"
		});
		addOnomastic("o1|0:an ant ano;1:n o on");
		add(new NameGeneratorAsset
		{
			id = "demon_name"
		});
		addOnomastic("o/021|0:a'n e'r o'r o'h an am akan al bal fur d dev gar kra val;1:a i e;2:r vel v s on mon al");
		add(new NameGeneratorAsset
		{
			id = "angle_name"
		});
		addOnomastic("o/021|0:a'n e'r o'r o'h an am akan al bal fur d dev gar kra val;1:a i e;2:r vel v s on mon al");
		add(new NameGeneratorAsset
		{
			id = "fairy_name"
		});
		addOnomastic("o/01/010|0:ar er or ir;1:i a e;2:a e");
		add(new NameGeneratorAsset
		{
			id = "crab_name"
		});
		addOnomastic("o/0102/210|0:c cr;1:a aa aaa o o o;2:b be ba bo");
		add(new NameGeneratorAsset
		{
			id = "cow_name",
			parts = new string[1] { "moo oom mi" }
		});
		addOnomastic("o/9_o/o_9/o_o|0:m l d b mad daa moo;1:i o a y;2:d m;9:moo oom mi");
		add(new NameGeneratorAsset
		{
			id = "default_name",
			vowels = new string[7] { "a", "e", "i", "o", "u", "y", "oo" }
		});
		addOnomastic("031f2|0:pl p s l d b;1:mp rp rt b;2:kin tin le ee;3:a e i o u y oo");
		addPartGroup("Pl,P,S,L,D,B");
		addPartGroup2("mp,rp,rt,b,");
		addPartGroup3("kin,tin,le,ee");
		addTemplate("part_group,vowel,part_group2,part_group3");
		add(new NameGeneratorAsset
		{
			id = "evil_mage_name"
		});
		addOnomastic("9fo8cf/9f012/3f45/9f6_7|0:ru ur sp bl re bu;1:s t os ut ux oz az ez;2:t p k r ok at ap up op opo;3:o a e i;4:ra re ri ro;5:um us ux or;6:rust spore blight mold;7:ior ius mancer;9:a' o' ar' er';8:a o ata oto");
		add(new NameGeneratorAsset
		{
			id = "white_mage_name"
		});
		addOnomastic("9fo8cf/9f012/3f45|0:lu um sp gl my ag;1:s t os ut ux oz az ez;2:c p k r ok at ap up op opo;3:a e i o;4:ra re ri ro;5:um us ux or;7:ior ius mancer;9:a' e' ar' er';8:a o ata oto");
		add(new NameGeneratorAsset
		{
			id = "rhino_name"
		});
		addOnomastic("o/01_24/012|0:r g gr d t rh thr gro;1:o a oo aa u ar;2:k g rk rg;3:o a e;4:kh gr rk rh");
		add(new NameGeneratorAsset
		{
			id = "monkey_name"
		});
		addOnomastic("o/0123/010_01/012-012|0:m n k ch j p t;1:a e o i u;2:mp nk t ch;3:o ee ai oo");
		add(new NameGeneratorAsset
		{
			id = "armadillo_name"
		});
		addOnomastic("o/75/551c51c/9_o/9_75/77f7f9f|0:d t r m b;1:a i o u;2:l r d m;3:d t r m b;4:o a i u;5:sh l rm d;6:y ie oo a;7:lo do rmo;9:ar mor so lo mo dodo didi midi");
		add(new NameGeneratorAsset
		{
			id = "alpaca_name"
		});
		addOnomastic("o/012/3456/09f_02f|0:paca lama cito lomo poco pica lima lala lodo dima domo didi do pi ca li ma de do pa po ce;1:a u o i;2:c k f l m;3:c p l m h;4:o a u i;5:f m l p fof pop;6:y ie oo a;8:a o u i;9:sof flid fluf sofy hum cud wool hop");
		add(new NameGeneratorAsset
		{
			id = "capybara_name"
		});
		addOnomastic("o/012/345/678/43_3210|0:l m n s v z cap;1:a e i o u;2:r l m n v;3:ae ai oo ea ie;4:l m n r s b;5:a e i o u ara;6:th sh l m n;7:oo ia ea;8:n m l");
		add(new NameGeneratorAsset
		{
			id = "goat_name"
		});
		addOnomastic("o/012/3452f/6783f/67_o|0:kr gr thr dr br;1:a o u;2:nk rk x zz;3:ax ox ux;4:t k r d;5:o a u;6:kh gh th rr;7:or ar ur;8:x k r");
		add(new NameGeneratorAsset
		{
			id = "scorpion_name"
		});
		addOnomastic("9f9f_f99f_f9f|9:zek tek zkek zak qzo zok zip zez tak tik tek");
		add(new NameGeneratorAsset
		{
			id = "garlic_name"
		});
		addOnomastic("o/012/133f45/432/872|0:g l r b cl;1:a i o u;2:rl lc ck rv;3:ov al ic;4:k n m r;5:o a i;7:io eo;8:n k s");
		add(new NameGeneratorAsset
		{
			id = "necromancer_name"
		});
		addOnomastic("0f_0128f/3f_f245/6f786f/9_01f|0:thur kral nox;1:ae uo ei a;2:th x rn zt;3:nex lich zor;4:a i o u;5:n r s th;6:um or us;7:vex mur thrax;8:or ius;9:zar grim vox");
		add(new NameGeneratorAsset
		{
			id = "flower_name"
		});
		addOnomastic("o/012/7f_345/6f78|0:bl fl r p l;1:o a i e u;2:ss ll m n;3:pet ros blo;4:a o e i;5:l m n s;6:y ia um;7:bell lia ium;8:a e");
		add(new NameGeneratorAsset
		{
			id = "bandit_name"
		});
		addOnomastic("0M1F_23M4F/23M4F|0:don mr herr baron han;1:dona ms frau baroness hatun;2:nik nok nuk kin kon kun ni kan;3:on in un en;4:ona ina una na");
		add(new NameGeneratorAsset
		{
			id = "buffalo_name"
		});
		addOnomastic("o/0123/010_212/030|0:b d r g m;1:o a u e i;2:ff ll bb rr;3:oo aa uu");
		add(new NameGeneratorAsset
		{
			id = "fox_name"
		});
		addOnomastic("o/013|0:f ph v;1:o i u a;2:x xx xz;3:y in en");
		add(new NameGeneratorAsset
		{
			id = "hyena_name"
		});
		addOnomastic("0123/014_054/2354f/4_4|0:h y r l g;1:a e i o u;2:n r k t z;3:ah ek ik ak;4:gig gug dog geg kek kak kuk;5:aga");
		addOnomastic("01cf3vf6|0:bla chak dak gra hak kra lok nar rok ska tok zan vak zhak trak snok;1:a e o u i;3:k r l n t g z;6:aak raak fang klaa draa skaag naal raa kaz graak snaak rok daak");
		add(new NameGeneratorAsset
		{
			id = "hyena_city"
		});
		addOnomastic("01cf3vf6|0:bak kra gra hak jhak kaf klok vok gro skarn tok trak zan snok dra;1:a e o u i;3:k r n t l g;6:pit veld kraal draal fang prow cresh den rift klaaw rok fang skaag kop bay ridge");
		add(new NameGeneratorAsset
		{
			id = "crocodile_name"
		});
		addOnomastic("o/01_01/01_23/0f12v/34|0:g k r z gr kr;1:a o u;2:k zz rk kh rr kk;3:a o e;4:r z");
		add(new NameGeneratorAsset
		{
			id = "snake_name"
		});
		addOnomastic("o/010/o_01/01-01|0:s z ss zz sh sl sn sz;1:a e o u i;2:k x t h s z z;3:th zh ss ts ks");
		addOnomastic("01cf103vf|0:ss sz sl ss zh sh zz th;1:a e o u i;2:k x t h z r s;3:th zh ss ts ks zth kth ssh xth shh");
		add(new NameGeneratorAsset
		{
			id = "snake_city"
		});
		addOnomastic("0,01cf2vf6|0:ss zz zh sl sn sz;1:a e o u i;2:k x t h r l s z;6:ssa thra xiss kara ssith thar liss zath zhira kraza ssyl");
		addOnomastic("01cf3vf6|0:ash hiss kas liss nas ras shiss sith thass sliss zash ziss vass;1:a e o u i;3:s sh th l ss z;6:ssath thiss rassith zhass hissath lissra shaza zhaal sraal vashra");
		add(new NameGeneratorAsset
		{
			id = "frog_name"
		});
		addOnomastic("0123/456/7893|0:ri ry;1:b bb;2:it yt ot;3:er ing;4:j w y;5:imp mp ump;6:y er ing;7:kr cr;8:oa ee oe ea;9:q k c");
		add(new NameGeneratorAsset
		{
			id = "bioblob_name"
		});
		addOnomastic("01/230/0f1v2/45|0:b bl ooz gl;1:o oo u;2:z zz k q lk;3:o e y oo;4:b z r;5:eye ez ooz");
		add(new NameGeneratorAsset
		{
			id = "assimilator_name"
		});
		addOnomastic("0-###f#f#fu|0:tk xx yt z rt pp kl qr er");
		add(new NameGeneratorAsset
		{
			id = "lemon_name"
		});
		addOnomastic("o/41032/2100/010|0:l z c t li lo lo la;1:e i o a u;2:m n r t;3:o a i ar;4:x n d");
		add(new NameGeneratorAsset
		{
			id = "candy_name"
		});
		addOnomastic("o/01234/012/21_012|0:c s t g;1:a o u e i;2:n d f l;3:y o i;4:x r s");
		add(new NameGeneratorAsset
		{
			id = "crystal_sword_name"
		});
		addOnomastic("o/012/3f45/6_7|0:cr gl sp sh;1:y i a e;2:st l r z;3:t l m;4:al el il;5:ite ine yte;6:reef core shard;7:ium ite");
		add(new NameGeneratorAsset
		{
			id = "crystal_name"
		});
		addOnomastic("o/012/3f45/6_7|0:cr gl sp sh;1:y i a e;2:st l r z;3:t l m;4:al el il;5:ite ine yte;6:reef core shard cora shor;7:ium ite");
		add(new NameGeneratorAsset
		{
			id = "fire_skull_name"
		});
		addOnomastic("0124/21_5|0:f fl bl s th sk sks;1:i o a u e;2:r rk l t ch;3:oo oo ia ir ur ar aa;4:k ks c t;5:gor zor bor mor");
		add(new NameGeneratorAsset
		{
			id = "acid_blob_name"
		});
		addOnomastic("o/012/03|0:bl gl dr sl;1:a e er i o oo u y;2:b p m;3:er ir y i ster");
		add(new NameGeneratorAsset
		{
			id = "jumpy_skull_name"
		});
		addOnomastic("012/0f12|0:clack bone cr skull bony;1:e i o u le y er s;2:t d ck p n");
		add(new NameGeneratorAsset
		{
			id = "fire_elemental_name"
		});
		addOnomastic("o/012/3f45/6_7|0:fl bl cr fr;1:a e i o;2:r z m;3:e a o;4:mb rn bl zz;5:or ar er;6:ash ember blaze inferno;7:kin tor nix");
		add(new NameGeneratorAsset
		{
			id = "lil_pumpkin_name"
		});
		addOnomastic("o|0:m n x;1:a aa o oo y;2:x d z;3:i o a u;4:m n x z");
		add(new NameGeneratorAsset
		{
			id = "rat_name"
		});
		addOnomastic("o2c2c2c2c|0:ma ar a e i b c;1:v m n k rk x rt;2:o s a y e i;3:m n a d");
		add(new NameGeneratorAsset
		{
			id = "raccoon_name"
		});
		addOnomastic("o2c2c2c2c|0:ma ar a e i b c;1:v m n k rk x rt;2:o s a y e i;3:m n a d");
		add(new NameGeneratorAsset
		{
			id = "cat_name"
		});
		addOnomastic("o/o_o|0:m;1:e ee ee;2:o oo oo;3:w ww ww");
		add(new NameGeneratorAsset
		{
			id = "rabbit_name"
		});
		addOnomastic("o/o_o|0:j dj;1:a e o ae oe;2:t p m;3:o a y eke");
		add(new NameGeneratorAsset
		{
			id = "piranha_name"
		});
		addOnomastic("o/o_o|0:c;1:h;2:o a oe ae;3:p d b");
		add(new NameGeneratorAsset
		{
			id = "snowman_name"
		});
		addOnomastic("o/o_o|0:s z ss zz;1:o a o;2:s zz ss zzz;3:y e o");
		add(new NameGeneratorAsset
		{
			id = "bear_name"
		});
		addOnomastic("o/0124|0:h;1:o a e;2:n;3:y e o;4:a");
		add(new NameGeneratorAsset
		{
			id = "skeleton_name"
		});
		addOnomastic("5f012334|0:b;1:o a e;2:n;3:y e o;4:s;5:a o");
		add(new NameGeneratorAsset
		{
			id = "living_house_name"
		});
		addOnomastic("01234/012/012mf|0:h;1:o a e;2:m;3:i y e o;4:y e o");
		add(new NameGeneratorAsset
		{
			id = "living_plant_name"
		});
		addOnomastic("012345/0125/012mf|0:pl;1:o a e;2:n;3:t;4:i y e o;5:y e o");
	}

	private void addWorldNames()
	{
		add(new NameGeneratorAsset
		{
			id = "world_name",
			use_dictionary = true
		});
		addDictPart("first", "Forgotten,New,Red,Blue,Never,Green,Mirage,Ever,Hollow,Infinite,Empty,Ghost,Perfected,God's,Hidden,Stolen,Broken,Nightmare,Secret,Sacred,Cruel,Phantom,Free,Dragon,Demon,Thunder,Silent,Old,Ancient,Eternity,Flat,Dream,Greg's,Nefarious,Plain,Bygone,Medieval,Archaic,Inner,Crying,Bad");
		addDictPart(" ", " ");
		addDictPart("of", " of ");
		addDictPart("and", " and ");
		addDictPart("second", "Isles,Lands,Land,Realm,Box,Skulls,Memory,Earth,Sanctum,World,Planet,Archipelago,Territories");
		addDictPart("ofWords", "Souls,Hope,Sadness,Life,Sun,Moon,God,Blood,Dragons,Man,Greatness,Misery,Happiness,Death,Clouds,Rain,War,Despair,Mystery,Wizardry,Magic,Magnificence,Chaos,Madness,Sheep,Elders,Soup,Lemons,Coffee,Place");
		addTemplate("first, ,second");
		addTemplate("second,of,ofWords");
		addTemplate("second,and,ofWords");
		addTemplate("ofWords,and,ofWords");
	}

	private void addPlayerNames()
	{
		add(new NameGeneratorAsset
		{
			id = "player_name",
			use_dictionary = true
		});
		addDictPart("first", "Umom,Greg,Bre,The Architect,The One,The Creator,The Destroyer,Art Vandelay,The Great,The Wise,The Mighty,The Nope,Architect of the Evil,The Old,The Young,The Silent,The Loud,The Quiet,The Noisy,The Shy,The Fearful,The Scary,The Happy,The Angry,The Calm,The Furious,The Mad,The Daydreamer,The Lost,The Meme Lord,The Clumsy,The Forgetful,The Hungry,The Eternal,The Omnipotent,The Forgotten,The Shadow,The Light,The Dark,The Dreamer,The Keeper,The Watchful,The Insane,The Sane,The Crazy,The Normal,The Abnormal,The Weird,The Strange,The Odd,The Bad,The Beautiful,The Handsome,The Pretty,The Smart,The Arm,The Pointy,The Potato,The Awkward,The Overthinker,The Underthinker,The Procrastinator");
		addTemplate("first");
	}

	private void addCivNames()
	{
		add(new NameGeneratorAsset
		{
			id = "human_unit",
			vowels = new string[6] { "a", "e", "i", "o", "u", "y" },
			consonants = new string[18]
			{
				"b", "c", "d", "g", "h", "ph", "ch", "k", "l", "m",
				"n", "p", "r", "s", "t", "v", "w", "sh"
			}
		});
		addOnomastic("010f1f0f1f1c0v|0:b b d g k n r s;1:a o");
		addOnomastic("2f3232f3Vf2Cf3Vf|2:a e i o u y;3:b c ch d g h k l m n p ph r s sh t v w");
		addTemplate("Letters#3-8");
		addGroup("folk_unit", "0Mf,15CfDff9Mf8F|0:b d f g h h j k l n t w w;1:al al an ar ed ed ed el en en eo ern il il in on os ydn yn;9:by den gar ley lin ric son ton win;5:a e i o u;8:brya da dena gara leya lina na ra rica sana ta wina", "frankish_unit", "0127M8F|0:bl br ch cl fr gr j kr l m n p s t v;1:a e i o u;2:ch ld lf lm nd rd rn rt;7:ald an an ard el ent er ert ich ied in on;8:a e elle ette ia ild ine ine und", "germanic_unit", "01C2f5Cf7V9F8M|0:a ae ba be bru d ea eo fr ge go gu hi i si t th th th w w;1:a ae e ea eo o u y;2:d d d d dal g g g l ld ld ld lf lf lfr n n ng r r rn th;9:aed eith id ifu ild ind inda inna ith ith ud un und urg urh ynn;8:ald ar ar ard ed elm ert ik im in ith olf ulf ulf und;7:b b b fl fr fr fr g g g gr h h h h hr kn l l m m r r sk sw sw tr w w w w w w;5:ald ald and ar ar ard elm eod er ert ic ich id id im in is ulf und", "iberian_unit", "0bf1Cf3f5M7vM6F|0:al ant bea ben cle din dom el fel fer gar isa joa jua lor mar mig pal ped ric rodr sal sol val xav ysa;1:a ae e i ia io o u ua;3:bel ben cel dri fan gon lmo mar per ric sol ter val vid;5:a al ar el im ino io io is o o o o o o o or uel;6:a ela ela ena ia ina ina ira isa ita la ola ona;7:b m x", "monolux_unit", "01CM2CF5Cf8F9M|0:al bea ber cle cor dal dolf el fe fer gar ger har hel jon kar lau lis lor mal mar mel nel nor ol osk pe re san syl te val wim zin;1:a e i o u;2:a e i o u y;5:a ael an ar el er et ia ien ik ine is on or us wen yn;8:a el ela et ia ine ine ira is ora wen yn;9:ald an ar en er ik mond olf on or rik us win", "nordic_unit", "01f2Cf4f5CM6CF|0:bj br dr ei fe gr gu hr ing jar r sk st th ul v var ym;1:ad ald alf arn en ik im in ir orn ulf;2:a ae e ei i io o u y yr;4:bj br fr gr hr jar sk st st th th ul v;5:andr ar ard ein fr idr ik ildr im or orn ulf ylf yr yrn;6:a hild ida inna is la ra rin thrun yla yn yrn", "poly_unit", "042f6f8F9M|0:hau kai kea lua maka moa niu pua wai;2:';4:a e i o u;6:ha ka la ma na pa ra ta wa;8:a lani lei wahine;9:kane koa nui o", "pomeranian_unit", "01Cf2V1Cf3FC4MC|0:bor gri kasz kro mar mat pom sop stas stett swa tom wol zem;1:a e i o u;2:k l m n ph r t;3:a aczka anka eczka enka entz ia ilda ina inka oczka;4:an aus av aw ek iek im ir iu o or us y", "posh_unit", "01C23F4M|0:aeth al bea cha dar ead ed el fran geof har is jas;1:a e e e i o u;2:b c d f g h l m n p r s t;3:alda anna da elle ette ilda ina;4:ar bert der mond red ry son ward win", "rome_unit", "01Vf3V3v8M9F|0:a ae au ba ce clau co co do equ fla gai gla ju le lu ma ma octa pe qui sa tri tu ve vi;1:c ca co d di do gi gri ki la li li ll lo ma me mi mi mit na ne no nt nt pa pp ra rc ri rne ro sa se ta te ti to v v va xi;3:c d l n r s t;8:ar er es i ianus ius ius or or us us;9:a a ella ia ia ina is ita", "rus_unit", "022Cf5Vf8F9M3v|0:al d iv n ol p s vl;2:a a a e e e e i;3:ch d g k k n n rg tr;9:an ich in ov y;8:a eva ia ina ova;5:k l m n r t v", "slavic_unit", "0M1F4Cf5M6M8F9FV|0:bog bol bor borys bron dam dom drag fil i jac jar kaz mar mil miros oleg rad slav stan toma val ves vlad vol woj wojt zbign zbygn;1:an ce dan ela ew ire jul le lu mag mi mi na ni oks ola rad sla svet va ve vi ya zo;9:ka na na na na na na nia nka nka ra ra ra sa ta va va wa wka;8:a e e i i i i le li mi o o sa y y;4:a e i o u y;6:an an av aw ek ek ek ek iew ik ir o or or;5:b cz cz d g i isl k l l l m m m n r r r st sz sz s", "nomad_unit", "01234f5f|0:a ab ah am an as ba fa ha ka ma na ra sa ta ya za;1:a i u;2:b d f h k l m n r s t z;3:a i u;4:b d f h k l m n r s t z;5:al il ul", "sino_unit", "014Cfl/014Cf6f8C|0:ch g h l l m w w x y zh zh zh;1:ang ang ang ao ei en i ia in iu ou u u uo;4:a e i o u;6:b b ch d f g h k k m m n sh;8:a a ai an ei ei i o ua", "siam_unit", "04/42/032/032|0:b ch d f g k m p p s t t th v w;2:g h k m m n n n ng p r rn t t w;3:a a ae ai ai ao au e e ea ee ey i i ia o oo oy u ua;4:ae ai ai ao au ay ea ee ey ia oo oy ua", "vishna_unit", "0dVff1V5C2|0:an ar as ba de el esh ha in je ka ku ma na pa ra sa vi;1:dra j mar nt p sh t;2:b ch d g h j k l m n p r s t v y;5:a e i o u", "nihon_unit", "0f10f1C2M3F|0:b f h k m n r s t y;1:a e i o u;2:keo deo ki ro ji to shi su ta ya ke chi yu yo;3:ka ko mi na ri ra sa yo");
		clone("human_city", "human_unit");
		addOnomastic("010f1f0f1f1c0v|0:b b d g k n r s;1:a o");
		addOnomastic("2f3232f3Vf2Cf3Vf|2:a e i o u y;3:b c ch d g h k l m n p ph r s sh t v w");
		clone("human_religion", "human_unit");
		addOnomastic("010f1f0f1f1c0v|0:b b d g k n r s;1:a o");
		addOnomastic("2f3232f3Vf2Cf3Vf|2:a e i o u y;3:b c ch d g h k l m n p ph r s sh t v w");
		clone("human_language", "human_unit");
		addOnomastic("010f1f0f1f1c0v|0:b b d g k n r s;1:a o");
		addOnomastic("2f3232f3Vf2Cf3Vf|2:a e i o u y;3:b c ch d g h k l m n p ph r s sh t v w");
		t.parts = new string[28]
		{
			"ork", "ah", "ois", "nsin", "ona", "ina", "insk", "ovo", "va", "od",
			"irsk", "wa", "owo", "irk", "ow", "es", "go", "on", "owa", "dran",
			"drun", "be", "ka", "ama", "kyo", "ro", "poro", "to"
		};
		addTemplate("Letters#2-5,part");
		addGroup("folk_city", "0f1Vf5f89V5ef|0:a bra broo e gree hi tho we wi woo wre ye;1:d d k ll lm n n nd rn sh st w;9:d d dge ft k ld le ll m mbe n n rd rst;5:a e i o u;8:broo co cro da de fie fo ha hi hu ley ri stea to woo", "frankish_city", "0f1f2f3|0:char mon vill saint beau gren ver mont font val grand;1:a e i o u;2:b c d f g l m n p r s t v;3:bourg champ court fort lac mer pont sur val ville", "germanic_city", "03f6|0:al ba bla bro bu da dre do du elk ei ge gro ha he ka ko la le lo ma ne obe pu ro scho scha sta ste tru tra wal wa za ze;1:a e o u i;3:ch sch tsch dsch ech;6:ber stei dof au bah tal hem wal huf hus furt zel feld fut wiz rih bech sten ing", "iberian_city", "01Cf3f46v|0:alb arro bar cad cor del es grana ib jae las mad nav port sal se ter val zam;1:a e i o u;3:bor ce dri fort mir val zar;4:a ar es ia id or;6:m n x", "monolux_city", "00f1c3vf6|0:bel cl col con da do de du es fl gr he la le mar mon ne pel ra ro re ru st str vi we ze;1:a e o u i;3:ch ng sch;6:ange buerg weila mont vil fon sur mer ton dorph in gen cort don lux", "nordic_city", "013cf5vf8,9df|0:asg b b bj d eir f g gr h h ing j kn od r s skj sv th vl;1:ad ag ag agn al ar eir el en en ig ik im in ing irk old or or orn ulf un ylfr;3:a e i o u y;5:dr fjr ld rg rn sk st th;9:ad al ald and ard eim ell en ik ik ike og olm ord org und;8:b d fj fj g h h l r sk sk st st sv t v", "poly_city", "0f_f0lf4ff9|0:ahu ai ha ka ka la mai na pu wai wai;1:ba be ca co da de fa fe ga ge la le ma me na ne pa pe ra re sa se ta te va ve;9:au ea ea er ha hu ka la le li lo na ni ni nu ra te ua wa wa;4:'", "pomeranian_city", "0,11f3v6|0:b ch d g gr j k kr l m n p pl r st str sz szcz tr w z;1:a e i o u y;3:ch dz gr n rz st sz ;6:borg gard grd lin nek ni nik no staw swald saw w wice wice wno wy", "posh_city", "01f3C4|0:b b c h h k n qu r str t;1:am art at een el ich ing ourne ox;3:a e i o u;4:borou brig buro field ford hare haym ley meyr shyre steyd syde ting ton ton vylle well wood wyrth", "rome_city", "013C5Vf9Cf|0:aq c fl m n n p p r t v v v;3:al an en ent i in on u;5:dun num p tia tum;9:a ce e el ia ia ium na um;1:al ar as av eap ed edi er er er omp or or or or u", "rus_city", "024f8C|0:ek k kr m n n p s sam sv v vl;2:ad ara asno ater aza eli er etro in izh och os ovo;8:ad ad ara evo insk ir ol olo orod ov ovo ovo ovsk sk urg y;4:b g gr k m m p sk v", "slavic_city", "01cf3vf6|0:b cz d gd g k kr l m n p r sz szcz w z r t ch ;1:a e o u y i;3:cz sz rz dz  rz ch;6:w awa ice ek owa yno in lin anin zyn owic sk an skowo owice", "nomad_city", "212124|0:ba da fa ha ma na ra sa ta za;1:a i u;2:b d f h k l m n r s t z;4:ad adi ah al as asr i i i i", "sino_city", "0181f8V9|0:b b ch d g g k k l m m n n n p s sh t;1:a a a e e ei i o u u ua;8:h n n ng ng ng sh zh;9:ai an an ou", "siam_city", "03Cf4Vf3Cf4Vf5Vf6C_8f/04V_8|0:ban chi kru lae nak non om pat phu sam su udo udo;3:a e i o u y;4:ch g k l m n ng p r s t;5:b ch n th th;6:ai akhon ani ep et uri;8:hin kaen kret lao mai mui rai rat sot tao wan yai", "vishna_city", "03Cf2356Cf/03C24|0:ba bom cha del hy ja kan ko lu mum pu;2:b ch d g h j k l m n p r s t v;3:a e i o u;4:bad bay gar garg garh ghat halli kot nagar nam oor palli patt por prayag pur pur uru vada vaka valasa wada waka;5:bad bay gar garg garh ghat kot nagar nam patt por prayag pur pur;6:a e i", "nihon_city", "011f23f/011f32f|0:ga go hi ka kyo na osa ra ro sa shi to yo;1:ko ku ga go hi ka na ra ro sa shi shin to ya;2:bu ka ki ma ju wa yo;3:chi ha ku sa shi ra ta to ya");
		clone("human_kingdom", "human_unit");
		addOnomastic("010f1f0f1f1c0v_4f/3f_010f1f0f1f1c0v/010f1f0f1f1c0v_5_6|0:b b d g k n r s;1:a o;3:great holy the;4:dynasty empire hegemony imperium kingdom realm;5:of;6:dawn dusk dynasty moon sun");
		addOnomastic("0f1010f1Vf0Cf1Vf_4f/3f_0f1010f1Vf0Cf1Vf/0f1010f1Vf0Cf1Vf_5_6|0:a e i o u y;1:b c ch d g h k l m n p ph r s sh t v w;3:great holy the;4:dynasty empire hegemony imperium kingdom realm;5:of;6:dawn dusk dynasty moon sun");
		addGroup("folk_kingdom", "0f1V5Cf8f9C|0:a bra broo e gree hi tho we wi woo wre ye;1:d d k ll lm n n nd rn sh st w;9:and arch aven ead idge ield ire oft old orth;5:a e i o u;8:cr f h hav l m r sh st w", "frankish_kingdom", "0f12f4C5f68|0:b fr l n n s g;1:a au eu o o u;2:nk rg rm rr st str le n th ll;4:a e i o u;5:b c d f g l m n p r s t v;6:an l m r t;8:al an and ar ark ealm el en er ia ia in on on or urg om eim ed eich ia ium en er on un en an in un", "germanic_kingdom", "01C2f5Cf7V9|0:a ae ba be bru d ea el eo fr ge go gu hi i si stei t th th th w w;1:a ae e ea eo o u y;2:d d d d dal g g g l ld ld ld lf lf lfr n n ng r r rn th;9:ade adt ald ald all and ane ard ark eim ein eld ield old old olf one ord orf orpe ort ost own und une urg;7:b b b fl fr fr fr g g g gr h h h h hr kn l l m m r r sk sw sw tr w w w w w w;5:ald ald and ar ar ard elm eod er ert ic ich id id im in is ulf und", "iberian_kingdom", "01C2V9f7f|0:alta cast el la mont porto roca santo sierra tor val villa;1:a ae e ia io o u ua;7:ar el eth is th yn;2:d dr l n nt r rd s t v x;9:ales anza ario ente esta illo ion ium olo oncia ora", "monolux_kingdom", "00f1c6|0:bel cl col con da de do du es flo gr he hel la le lux mar mon ne pel ra re ro ru st str vi we ze;1:a e i o u;3:ch ng sch;6:ange buerg burg cort don dorph fon gen heim in land lux mer mont reux stein sur ton vald veld vic vil weila", "nordic_kingdom", "0f174Ef,89df|0:bj br dr eir f fr g gr hj r sk st th v;1:agn akk al ark arn arr enr igg ik imh okk orr ulfr unn yrk yrkr;4:a ae au e ei i io o u yr;9:dr l ld ld ll mr nd nd r rn;8:a a a a a e ei o o u;7:f g h h l r sk sk th v", "poly_kingdom", "019v01|0:a ae e eu i io o u y;1:am an ap ar at au en et ha he ho is it ka ke kh ma me mi mo na ne ni no ra re ri ro sa se si so ta te ti to tu;9:'", "pomeranian_kingdom", "01C2f3Cf|0:bub first flat grif grim grod kasz kosl naug pomer pyr rumm stett stol szczec used;1:a e o u;2:b ch d g gr l l m r st t th we;3:ad and au edt en ia in itz ium od om or um urch", "posh_kingdom", "01Cf2C3Vf5Cf|0:alb angl avin br cam corn er ess jer kent nor ox sher som suff sus vic war wick winds;1:ia ion itan or tor;2:a e i o u;3:d d h l n p r r sh t;5:am and e elm ia ish om on", "rome_kingdom", "019|0:a ae e eu i io o u y;1:cast flav fort lt luc magn mper r reg sol temp val vent;9:alis anth ar ariel arion arix ary ax el er eth ia iel ion ior is is ium ius iusm on or or orius ra thys tor um yn", "rus_kingdom", "013C6f|0:k m n p r sl ts v;1:ar av etro iev olga ov ys ysk;3:a e i o u;9:dom ire ity rdom;6:dal gorod grad land rod skaya ver zan", "slavic_kingdom", "015f8f9C|0:bel bul cr cz don kash lyh lyt pol rys ser sl sl syl ykr;1:at ech es gar i o on u y;3:a e i o u;5:b n r s t v v;8:and ansk ard en om orb ov sk stan us v;9:a a ia ia ia", "nomad_kingdom", "0f12125|0:ab al ay fa ma sa um;1:a i u;2:b d f h k l m n r s t z;5:a e ia ya", "sino_kingdom", "010f456ff|0:ch h m q q s t w y zh;1:an ang in ing ing ong ou u u uan;4:b ch d g g k l m m n n p s t w;5:a ao uo;6:n ng", "siam_kingdom", "03C4345|0:ayu ha lanna pa ra sri su sukh;3:a e i o u;4:b ch k kh l m n p r s t th y;5:ai ani aya on uri", "vishna_kingdom", "012Cf|0:abhi aho andhra anga anu asma ava ba bha bho bri bu ce cha che cho chu da de di do fu ga go gu ha he ho ikshva iksva ja ka ke kha khe khme ki ko ksha ku la li lo ma mi mu na ne oi pa po pra pu ra re ro sa se sha shi shu si so sri su ta tha to tri utpa va vi ya;1:b cchav d damb darbh dasam dav dir dnapor duk dura dyot ffn g gar ghel gvansh h hadaval hadrath haman han har harat hey hisapal hurip ilendr indhav ink jahnat janat japah japat jayanagar jjik jvapal k katiy ket kotta ky l labh labhr lachur lakanagar lav lingg ll llabh llal llav lon luky lw m mar marup mas matat mava mbuw mm mp n nagar nchal nd ndhar ndy nes ng ngar ngg nggal ngha ngka nind niw njav nl nmal nn nna nt nv p pal pt pur pur pur r rabha rasen rashiv rat rataraj rath rayang ripunjay rjaratr rkh rkot rn rtadi ruma ryank s sal sh shiv shm shnu shtrakut shunag sunur t ta tah tar tava tiy tr ts tsy tu tyur ud urav ury v vagang vd vijay y yak ysal;2:a a a a a a aj ak al al am an an an an an an an an an and ap ar ar arh as at e e e eddy en en er i i i i i i i indh ir it o och om or u u u u u uh uj um ur us", "nihon_kingdom", "01f1ff2fff2ff2|0:an chi ga he ka ku ma mu na ra ro shi su to wa ya;1:ga he ka ku ma ma ma mu na ra ro su to wa ya;2:ba dai fu gu ji ko ku na sho te cho chi kyo");
		add(new NameGeneratorAsset
		{
			id = "orc_unit",
			vowels = new string[3] { "a", "e", "o" },
			consonants = new string[8] { "d", "g", "k", "n", "p", "r", "t", "z" },
			parts = new string[15]
			{
				"igh", "ord", "uz", "duz", "rid", "ogh", "agh", "okh", "uh", "dzz",
				"ez", "az", "oz", "top", "urg"
			}
		});
		addTemplate("Letters#3-7");
		addTemplate("Part");
		addTemplate("Part,part");
		addTemplate("Part, ,Part");
		addOnomastic("010f_010f/0f91f_0f91f/101|0:d g k n p r t z;1:a e o;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		addOnomastic("0101fC0fV1fC/1010fV1fC0fV/9_f9f/91|0:d g k n p r t z;1:a e o;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		clone("orc_city", "orc_unit");
		t.templates = new List<string[]>();
		addTemplate("Part, ,Part");
		addTemplate("consonant,letters#3-5");
		addTemplate("consonant,letters#3-5,part");
		addTemplate("consonant,letters#1-3, ,CONSONANT,letters#2-3");
		addOnomastic("01010f9f/010f_010/9_9|0:d g k n p r t z;1:a e o;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		clone("orc_kingdom", "orc_unit");
		t.add_addition_chance = 0.5f;
		t.addition_start = new string[9] { "Bloody", "Axe of", "The", "Blood of", "Bad", "Strong", "Tall", "Red", "Green" };
		t.addition_ending = new string[9] { "Fighters", "Gang", "Band", "of Death", "Axes", "Brothers", "Warriors", "Boyz", "Horde" };
		t.templates = new List<string[]>();
		addTemplate("addition_start,CONSONANT,letters#2-3,part,addition_ending");
		addOnomastic("3_4_01010f9/01010f9/2f_01010f9/01010f9_5f/01010f9_4_6|0:d g k n p r t z;1:a e o;2:bloody the bad strong tall red green;3:axes axe blood club club;4:of;5:fighters gang band axes brothers warriors boyz horde;6:death glory blood;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		addTemplate("addition_start,Part,addition_ending");
		addTemplate("addition_start,Part,part,addition_ending");
		addTemplate("addition_start,Part, ,Part,addition_ending");
		addOnomastic("3_4_9_f9f/9_f9f/2f_9_f9f/9_f9f_5f/9_f9f_4_6|0:d g k n p r t z;1:a e o;2:bloody the bad strong tall red green;3:axes axe blood club club;4:of;5:fighters gang band axes brothers warriors boyz horde;6:death glory blood;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		addTemplate("addition_start,CONSONANT,letters#1-3, ,CONSONANT,letters#2-3,addition_ending");
		addOnomastic("3_4_010f_010/2f_010f_010/010f_010_5f/010f_010_4_6|0:d g k n p r t z;1:a e o;2:bloody the bad strong tall red green;3:axes axe blood club club;4:of;5:fighters gang band axes brothers warriors boyz horde;6:death glory blood;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		addTemplate("CONSONANT,letters#3-5,part");
		addTemplate("CONSONANT,letters#1-3, ,CONSONANT,letters#2-3");
		addOnomastic("01010f9/010f_010|0:d g k n p r t z;1:a e o;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz");
		clone("orc_language", "orc_unit");
		addOnomastic("0f1C97/010f97C/010f_0107C|0:d g k n p r t z;1:a e o;9:agh az duz dzz ez igh ogh okh ord oz rid top uh urg uz;7:ic ish ian");
		clone("orc_religion", "orc_unit");
		addOnomastic("9fff_45df6_l|4:d d d k k k z z z b gr vr wr;5:e e e a a a o;6:k g rg;9:Big");
		add(new NameGeneratorAsset
		{
			id = "dwarf_unit",
			vowels = new string[3] { "a", "e", "o" },
			special1 = new string[26]
			{
				"Dhun", "Dum", "Gor", "Ber", "Ger", "Kog", "Gul", "Ther", "Thor", "Von",
				"Gil", "Ver", "Vagh", "Gigh", "Deg", "Dig", "Bam", "Von", "Han", "Dhir",
				"Mugh", "Mul", "Gorn", "Gan", "Bol", "Gal"
			},
			consonants = new string[11]
			{
				"b", "d", "g", "h", "k", "m", "n", "p", "r", "s",
				"t"
			},
			parts = new string[11]
			{
				"ahl", "uhm", "ril", "til", "rim", "dum", "al", "or", "uhr", "ihr",
				"or"
			},
			max_consonants_in_row = 1,
			max_vowels_in_row = 1
		});
		addOnomastic("9f_1f01f0fV8|0:b d g h k m n p r s t;1:a e o;8:ahl uhm ril til rim dum al or uhr ihr or;9:dhun dum gor ber ger kog gul ther thor von gil ver vagh gigh deg dig bam von han dhir mugh mul gorn gan bol gal");
		addTemplate("special1, ,Letters#2-4,part");
		addTemplate("special1, ,Letters#2-4,part");
		addTemplate("Letters#1-4,part");
		addTemplate("Letters#1-4,part");
		clone("dwarf_city", "dwarf_unit");
		t.templates = new List<string[]>();
		addOnomastic("9f_1f01f0fV8|0:b d g h k m n p r s t;1:a e o;8:ahl uhm ril til rim dum al or uhr ihr or;9:dhun dum gor ber ger kog gul ther thor von gil ver vagh gigh deg dig bam von han dhir mugh mul gorn gan bol gal");
		addTemplate("special1, ,Letters#2-4,part");
		addTemplate("letters#2-4,part");
		addTemplate("letters#2-4,part");
		clone("dwarf_kingdom", "dwarf_unit");
		t.add_addition_chance = 0.5f;
		t.addition_start = new string[5] { "Miners of", "Great", "Rocky", "Spears of", "Ancient" };
		t.addition_ending = new string[10] { "Stones", "Rocks", "Boulders", "Mountain", "Mountains", "Miners", "Kingdom", "Shields", "Picks", "Drunks" };
		t.templates = new List<string[]>();
		addOnomastic("3_4_9f_1f0f1Cf0Vf8/9f_1f0f1Cf0Vf8/2f_9f_1f0f1Cf0Vf8/9f_1f0f1Cf0Vf8_5f|2:great rocky ancient;3:miners spears;4:of;5:stones rocks boulders mountain mountains miners kingdom shields picks drunks;0:b d g h k m n p r s t;1:a e o;8:ahl uhm ril til rim dum al or uhr ihr or;9:dhun dum gor ber ger kog gul ther thor von gil ver vagh gigh deg dig bam von han dhir mugh mul gorn gan bol gal");
		addTemplate("addition_start,special1, ,Letters#1-4,part,addition_ending");
		addTemplate("addition_start,Letters#1-4,part,addition_ending");
		addTemplate("addition_start,Letters#1-4,part,addition_ending");
		addTemplate("addition_start,Letters#1-4,part,addition_ending");
		clone("dwarf_language", "dwarf_unit");
		addOnomastic("97/87/1f01ff0Vff87C|0:b d g h k m n p r s t;1:a e o;8:ahl uhm ril til rim dum al or uhr ihr or;9:dhun dum gor ber ger kog gul ther thor von gil ver vagh gigh deg dig bam von han dhir mugh mul gorn gan bol gal;7:ic ish ian");
		clone("dwarf_religion", "dwarf_unit");
		addOnomastic("97/87/1f01ff0Vff87C|0:b d g h k m n p r s t;1:a e o;8:ahl uhm ril til rim dum al or uhr ihr or;9:dhun dum gor ber ger kog gul ther thor von gil ver vagh gigh deg dig bam von han dhir mugh mul gorn gan bol gal;7:ia ism ity ogy am to anta ancy iya aka i");
		add(new NameGeneratorAsset
		{
			id = "elf_unit",
			vowels = new string[3] { "a", "e", "o" },
			consonants = new string[10] { "c", "d", "f", "h", "l", "m", "n", "r", "s", "t" },
			special1 = new string[16]
			{
				"Ylh", "Emy", "Ny", "Ly", "If", "Se", "Am", "Yaa", "Omy", "Na",
				"Yg", "Yd", "Eo", "Yo", "O", "A"
			},
			special2 = new string[3] { "A'", "E'", "O'" },
			parts = new string[17]
			{
				"ua", "ra", "on", "ad", "nor", "ne", "hel", "on", "hil", "ore",
				"ora", "ona", "era", "eas", "ari", "adi", "ona"
			},
			max_consonants_in_row = 1,
			max_vowels_in_row = 1
		});
		addOnomastic("9f01f0fV4/9f10f1fC4/4m|0:c d f h l m n r s t;1:a e o;9:ylh emy ny ly if se am yaa omy na yg yd eo yo o a a' e' o';4:ua ra on ad nor ne hel on hil ore ora ona era eas ari adi ona");
		addTemplate("special1,letters#1-4,part");
		addTemplate("special2,Letters#1-4,part");
		addTemplate("letters#1-4,part");
		addTemplate("letters#1-4,part");
		clone("elf_city", "elf_unit");
		addOnomastic("9f01f0fV4/9f10f1fC4|0:c d f h l m n r s t;1:a e o;9:ylh emy ny ly if se am yaa omy na yg yd eo yo o a a' e' o';4:ua ra on ad nor ne hel on hil ore ora ona era eas ari adi ona");
		addTemplate("special1,letters#1-4,part");
		addTemplate("special2,Letters#1-4,part");
		addTemplate("letters#1-4,part");
		addTemplate("letters#1-4,part");
		addOnomastic("901f0fV_01f4/901f0fV_10f4/910f1fC_10f4/910f1fC_01f4|0:c d f h l m n r s t;1:a e o;9:ylh emy ny ly if se am yaa omy na yg yd eo yo o a;4:ua ra on ad nor ne hel on hil ore ora ona era eas ari adi ona");
		addTemplate("special1,letters#1-4, ,Letters#1-3,part");
		clone("elf_kingdom", "elf_unit");
		t.add_addition_chance = 0.5f;
		t.addition_start = new string[6] { "Great", "Green", "Arrows of", "Spears of", "Ancient", "Royal" };
		t.addition_ending = new string[9] { "Keepers", "Forest", "Children", "Brothers", "of Fire", "of Rain", "of Earth", "Kingdom", "Lands" };
		addOnomastic("9f01f0fV4/9f10f1fC4/4m|0:c d f h l m n r s t;1:a e o;9:ylh emy ny ly if se am yaa omy na yg yd eo yo o a a' e' o';4:ua ra on ad nor ne hel on hil ore ora ona era eas ari adi ona");
		addTemplate("addition_start,special1,letters#1-4,part,addition_ending");
		addTemplate("addition_start,special2,Letters#1-4,part,addition_ending");
		addTemplate("addition_start,special1,letters#1-4, ,Letters#1-3,part,addition_ending");
		addTemplate("addition_start,Letters#1-4,part,addition_ending");
		addTemplate("addition_start,Letters#1-4,part,addition_ending");
		clone("elf_language", "elf_unit");
		addOnomastic("95fff7/9f01f0fV45fff7/9f10f1fC45fff7/4m5fff7|0:c d f h l m n r s t;1:a e o;9:ylh emy ny ly if se am yaa omy na yg yd eo yo o a a' e' o';4:ua ra on ad nor ne hel on hil ore ora ona era eas ari adi ona;7:ic ish ian;5:'");
		clone("elf_religion", "elf_unit");
		addOnomastic("95fff7/9f01f0fV45fff7/9f10f1fC45fff7/4m5fff7|0:c d f h l m n r s t;1:a e o;9:ylh emy ny ly if se am yaa omy na yg yd eo yo o a a' e' o';4:ua ra on ad nor ne hel on hil ore ora ona era eas ari adi ona;7:ia ism ity ogy am to anta ancy iya aka i;5:'");
	}

	private void addCultureNames()
	{
		add(new NameGeneratorAsset
		{
			id = "human_culture"
		});
		addOnomastic("012|0:ne wa gi ca fo two ado ja ste sho klo e a ka ri wu to;1:ru ni too vo phu te ku ve su me du pe to ste o e a u oo;2:rab dab pab ian");
		add(new NameGeneratorAsset
		{
			id = "elf_culture"
		});
		addOnomastic("012/012/012/01|0:A' E' O' Yda Ifa Yaa Ia Oya Yra Na Ma Ya;1:dre dra de du te tre tra tro ti to tri na ma sa da pa;2:o e y a yo oi");
		add(new NameGeneratorAsset
		{
			id = "dwarf_culture"
		});
		addOnomastic("012/012/012/012/012/012/01|0:X Th Tr Gl H Dh Dum Dor Gor Ther Thor Gah Geh Ger Dur Der Dar Dig Deg Dag Ger Dhan Don Dan;1:i o a e odi adi edi ada idi uru udu igi egi oki oko;2:d ded dad dum gah geh h d b c gh th gh gagh digh dig dag dog");
		add(new NameGeneratorAsset
		{
			id = "orc_culture"
		});
		addOnomastic("0_1|0:Dek Kek Kak Dak Zeg Zog Zag Bak Dak Rak Dek Mek Mak;1:Dek Kek Kak Dak Zeg Zog Zag Bak Dak Rak Dek Mek Mak Bah Wah Waah");
	}

	private void addClanMottos()
	{
		add(new NameGeneratorAsset
		{
			id = "clan_mottos",
			use_dictionary = true
		});
		addDictPart("from", "from");
		addDictPart("we", "we");
		addDictPart("we_bring", "we bring");
		addDictPart("with", "with");
		addDictPart(" ", " ");
		addDictPart("bad_concept", "darkness,hell,war,unknown,abyss,nothing,void,blood");
		addDictPart("words_good", "light,updog,hope,power,pride,honor,strength,wisdom,skill,health,virtue,unity,valor,truth,peace,progress,prosperity,passion,compassion,duty,destiny,freedom,balance,pride,nature,justice,dignity,safety,vigilance,honesty,integrity,prosperity,purity");
		addDictPart("family_stuff", "Love,Live,Pray,Think,Dare,Kill,Sleep,Dream,Drink,Eat,Dance,Fight,Win,Build,Break,Conquere,Create,Rule,Worship,Adore,Laugh,Smile,Learn,Grow,Bite");
		addDictPart("family_stuff_lower_case", t.dict_parts["family_stuff"].ToLower());
		addTemplate("family_stuff,$comma$,family_stuff,$comma$,family_stuff");
		addTemplate("from, ,bad_concept,$comma$,we_bring, ,words_good");
		addTemplate("with, ,words_good,$comma$,we, ,family_stuff_lower_case");
	}

	private void addAllianceMottos()
	{
		add(new NameGeneratorAsset
		{
			id = "alliance_mottos",
			use_dictionary = true
		});
		addDictPart("we", "We");
		addDictPart("are", " are ");
		addDictPart("and", " and ");
		addDictPart("of", " of ");
		addDictPart("will", " will ");
		addDictPart("very", "very ");
		addDictPart(" ", " ");
		addDictPart("body_part", "heart,body,soul,brain,wings,mind");
		addDictPart("material_part", "steel,stone,ice,fire,silver,gold,iron");
		addDictPart("something_concept", "powerful,tough,stronk,strong,cool,eternal,kind,great,holy,fancy,nice,free,best,awesome");
		addDictPart("something_thing", "shield,brothers,power,alliance,together,sword,weapon,knife,axe,hammer,spear");
		addDictPart("protec", "protect,protec,atak,attack,defend,stand together,conquare,build,create,live forever,win,be,stay");
		addTemplate("body_part,of,material_part");
		addTemplate("we,are,something_thing");
		addTemplate("we,are,something_concept, ,body_part");
		addTemplate("we,are,very,something_concept, ,body_part");
		addTemplate("we,are,something_concept");
		addTemplate("we,are,very,something_concept");
		addTemplate("we,are,something_concept, ,something_thing");
		addTemplate("we,are,very,something_concept, ,something_thing");
		addTemplate("something_thing,of,material_part");
		addTemplate("we,will,protec");
		addTemplate("we,are,something_thing,and,something_concept");
	}

	private void addKingdomMottos()
	{
		add(new NameGeneratorAsset
		{
			id = "kingdom_mottos",
			use_dictionary = true
		});
		addDictPart("all_hail", "we follow ,all hail ,we believe in ,one and only ,our life for ,swords for ,all for ,blood for ,we fight for ");
		addDictPart("names", "Mastef,Hugo,Maxim,Jupe,Xiphos,Orange,Glonk,Nikon,Quicklast,Andrey,Sonja,Julia,Poncho,Faris,Cody,Jim,Steeam,Chicky,Chad,Luk,Midnight Blade,Luk,Half Chest,mountain,Airod,Astral,Little Glonk,Eye");
		addDictPart("concept", "life,death,sorrow,hope,awesome,tears,eternal,one,best");
		addDictPart("word_something", "nothing,love,spirits,death,life,truth,glory,wealth,roots");
		addDictPart("event", "victory,death,forgiveness,salvation,redemption,happiness,life");
		addDictPart("words_good", "updog,hope,power,pride,honor,strength,wisdom,skill,health,virtue,unity,valor,motherland,truth,peace,progress,prosperity,passion,compassion,duty,destiny,freedom,balance,pride,nature,justice,dignity,safety,vigilance,honesty,integrity,prosperity");
		addDictPart("words_bad", "fear,doubt,anger,frustration,failure,depression,contempt,pain,regrets,sadness,remorse");
		addDictPart("body_parts", "arm,leg,head,finger,body,heart,blood,tail,hell,neck,wings");
		addDictPart("weapon", "sword,axe,spear,bow");
		addDictPart("guided_by", "guided by ");
		addDictPart("forged_by", "forged by ");
		addDictPart("armor", "boots,shield,helmet,armor");
		addDictPart("items", "gold,coins,rock,stone");
		addDictPart("addition", "amazing,beatiful");
		addDictPart("foods", "food,fish,tea,beer,bread");
		addDictPart("elements", "fire,water,earth,air,magic,crystal,steel,poison,lightning,curse");
		addDictPart("we", "We");
		addDictPart("brings", " brings ");
		addDictPart("are", " are ");
		addDictPart("somewhere", " in Hell, in the Darkness, in the Shadows, in the Light, in the Sea, in the Land, in the Dreams, in the History, in the Heavens");
		addDictPart("ending_concept", "life,death,war,battle,sea,kingdom");
		addDictPart("bound", "bound,determined");
		addDictPart("this_is_ending", "fine,good");
		addDictPart("no", "no ,forget ,abandon ,destroy ,exterminate ,burn ");
		addDictPart("life", "love,life,death");
		addDictPart("we_ending", " we trust!, we believe!, we shine!");
		addDictPart("we_desire", " we desire, we believe, we want");
		addDictPart("is_the", " is the way, is the truth, is the destiny");
		addDictPart("we_like", "we like ,we love ");
		addDictPart("is", " is ");
		addDictPart("and", " and ");
		addDictPart("with", "With ");
		addDictPart("in", "In ");
		addDictPart("by", " by ");
		addDictPart("or", " or ");
		addDictPart("hold_our", "hold our ,hold my ");
		addDictPart("we_use_our", "we use our ");
		addDictPart("in_end", " in ");
		addDictPart("we_something", " we live, we go, we attack");
		addDictPart("through", " through ");
		addDictPart("only", "only ,always ,forever ");
		addDictPart("the", " the ");
		string text = "foods;weapon;armor;items;words_good;body_parts;elements";
		addTemplate("forged_by,names;foods;event;elements;words_good;words_bad");
		addTemplate("all_hail,names;foods;event");
		addTemplate("we_like,foods");
		addTemplate("event,through," + text);
		addTemplate("hold_our,foods;weapon;armor;items;words_good");
		addTemplate("words_good;foods;names,is,this_is_ending");
		addTemplate("in,words_good,we_ending");
		addTemplate("life,is,words_good");
		addTemplate("hold_our,weapon;armor;items");
		addTemplate("foods;weapon;armor;items;words_good,is_the");
		addTemplate("with," + text + ",somewhere");
		addTemplate("with," + text + ",we_something");
		addTemplate("with," + text + ",and," + text);
		addTemplate("with," + text + ",and," + text + ",we_something");
		addTemplate("we,are,concept");
		addTemplate("we,are,concept,somewhere");
		addTemplate("we,are,concept,somewhere");
		addTemplate("bound,by,word_something");
		addTemplate("no,words_bad,$comma$,no,words_bad,$comma$,only,words_good");
		addTemplate("words_good,$comma$,words_good,$comma$,words_good");
		addTemplate("words_good,and,words_good");
		addTemplate("in,word_something,we_ending");
		addTemplate("with,words_good,and,words_good");
		addTemplate("words_good;body_parts,somewhere");
		addTemplate("with,words_good;body_parts,and,words_good;body_parts");
		addTemplate("guided_by,words_good");
		addTemplate("words_good,brings,words_good");
		addTemplate("we_use_our,weapon;body_parts,in_end,ending_concept");
		addTemplate(text + ",or,words_bad");
	}

	private void addDictPart(string pID, string pListString)
	{
		t.addDictPart(pID, pListString);
	}

	private void addOnomastic(string pListString)
	{
		t.addOnomastic(pListString);
	}

	private void addTemplate(string pTemplate)
	{
		t.addTemplate(pTemplate);
	}

	private void addPartGroup(string pListString)
	{
		t.addPartGroup(pListString);
	}

	private void addPartGroup2(string pListString)
	{
		t.addPartGroup2(pListString);
	}

	private void addPartGroup3(string pListString)
	{
		t.addPartGroup3(pListString);
	}

	public NameGeneratorAsset add(string pID, string pOnomasticTemplate)
	{
		NameGeneratorAsset result = add(new NameGeneratorAsset
		{
			id = pID
		});
		addOnomastic(pOnomasticTemplate);
		return result;
	}

	public void addGroup(params string[] pSets)
	{
		if (pSets.Length % 2 != 0)
		{
			throw new ArgumentException("The number of parameters must be even.");
		}
		for (int i = 0; i < pSets.Length; i += 2)
		{
			string pID = pSets[i];
			string text = pSets[i + 1];
			if (!string.IsNullOrEmpty(text))
			{
				add(pID, text);
			}
		}
	}

	public override void post_init()
	{
		base.post_init();
		foreach (NameGeneratorAsset item in list)
		{
			if (!item.hasOnomastics() && !item.use_dictionary)
			{
				if (item.consonants == null)
				{
					item.consonants = NameGeneratorAsset.consonants_sounds;
				}
				if (item.vowels == null)
				{
					item.vowels = NameGeneratorAsset.vowels_all;
				}
			}
		}
	}

	public override void editorDiagnostic()
	{
		base.editorDiagnostic();
	}

	private void checkOnWorldLoad()
	{
		Actor actor = null;
		Kingdom kingdom = null;
		foreach (Actor unit in MapBox.instance.units)
		{
			if (NameGeneratorChecks.hasLatinKing(unit))
			{
				if (actor == null || unit.kingdom.king.hasLover())
				{
					actor = unit;
				}
				if (NameGeneratorChecks.hasEnemyLatinKing(unit))
				{
					actor = unit;
					break;
				}
			}
		}
		if (actor == null)
		{
			return;
		}
		kingdom = actor.kingdom;
		foreach (NameGeneratorAsset item in list)
		{
			List<string[]> templates = item.templates;
			if (templates == null || templates.Count <= 0)
			{
				continue;
			}
			if (item.check != null && !item.check(actor))
			{
				BaseAssetLibrary.logAssetLog("<e>AssetLibrary<NameGeneratorAsset></e>: <b>" + item.id + "</b> skipped test because check conditions failed");
				continue;
			}
			foreach (string[] template in item.templates)
			{
				string text = NameGenerator.generateNameFromTemplate(item, actor, kingdom, pForceLegacy: true, 0, null, template);
				if (string.IsNullOrEmpty(text))
				{
					BaseAssetLibrary.logAssetLog("<e>AssetLibrary<NameGeneratorAsset></e>: <b>" + item.id + "</b> had no result", string.Join(",", template));
				}
				else if (text.Contains('$'))
				{
					BaseAssetLibrary.logAssetError("<e>AssetLibrary<NameGeneratorAsset></e>: <b>" + item.id + "</b> seems to be missing a replacer : <b>" + text + "</b>", string.Join(",", template));
				}
			}
		}
		MapBox.on_world_loaded = (Action)Delegate.Remove(MapBox.on_world_loaded, new Action(checkOnWorldLoad));
	}

	public override NameGeneratorAsset clone(string pNew, string pFrom)
	{
		NameGeneratorAsset nameGeneratorAsset = base.clone(pNew, pFrom);
		nameGeneratorAsset.onomastics_templates = new List<string>();
		return nameGeneratorAsset;
	}

	private void addBookNames()
	{
		add(new NameGeneratorAsset
		{
			id = "$base_book_template$",
			use_dictionary = true
		});
		t.finalizer = finalizerBookName;
		addDictPart("$alliance$", "$alliance$");
		addDictPart("$architect_name$", "$architect_name$");
		addDictPart("$city$", "$city$");
		addDictPart("$city_random$", "$city_random$");
		addDictPart("$clan$", "$clan$");
		addDictPart("$clan_random$", "$clan_random$");
		addDictPart("$culture$", "$culture$");
		addDictPart("$culture_random$", "$culture_random$");
		addDictPart("$family$", "$family$");
		addDictPart("$family_founder_1$", "$family_founder_1$");
		addDictPart("$family_founder_2$", "$family_founder_2$");
		addDictPart("$family_random$", "$family_random$");
		addDictPart("$figure$", "$king$,$clan$,$leader$");
		addDictPart("$food$", "$food$");
		addDictPart("$king$", "$king$");
		addDictPart("$king_lover$", "$king_lover$");
		addDictPart("$kingdom$", "$kingdom$");
		addDictPart("$kingdom_random$", "$kingdom_random$");
		addDictPart("$king_random$", "$king_random$");
		addDictPart("$language$", "$language$");
		addDictPart("$leader$", "$leader$");
		addDictPart("$leader_random$", "$leader_random$");
		addDictPart("$random_subspecies$", "$random_subspecies$");
		addDictPart("$religion$", "$religion$");
		addDictPart("$subspecies$", "$subspecies$");
		addDictPart("$unit$", "$unit$");
		addDictPart("$warrior$", "$warrior$");
		addDictPart("$world_name$", "$world_name$");
		addDictPart("of", " of ");
		addDictPart("about", " about ");
		addDictPart("and", " and ");
		addDictPart("by", " by ");
		addDictPart("on", " on ");
		addDictPart("in", " in ");
		addDictPart("ofonbout", " of , about , on ");
		addDictPart("toon", " to , on ");
		addDictPart("their", "their");
		addDictPart("the", "the");
		addDictPart("to", "to");
		addDictPart("its", "its");
		addDictPart(" ", " ");
		clone("book_name_love_story", "$base_book_template$");
		t.replacer = NameGeneratorReplacers.replaceOwnFamily;
		NameGeneratorAsset nameGeneratorAsset = t;
		nameGeneratorAsset.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnFamilyFounders));
		NameGeneratorAsset nameGeneratorAsset2 = t;
		nameGeneratorAsset2.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset2.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKingLover));
		NameGeneratorAsset nameGeneratorAsset3 = t;
		nameGeneratorAsset3.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset3.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyCity));
		addDictPart("story", "adventure,adventures,ballad,story,stories,tale,tales,myths,novel,legend,romance,love story,lore,history,chronicle,chronicles,ballad,ballads,poem,poems,poetry");
		addDictPart("love", "when,how,where,why");
		addDictPart("met", "fell for,met,saw,encountered,found,desired,admired,missed,needed,searched for,looked for,waited for,searched for,seeked,pursued,found,discovered,spotted,noticed,observed,beheld,caught sight of,caught a glimpse of");
		addDictPart("days", "days");
		addDictPart("day_numbers", "two,three,four,five,six,seven,eight,nine,ten,eleven,twelve,thirteen,fourteen,fifteen,sixteen,seventeen,eighteen,nineteen,twenty");
		addDictPart("month_name", "Crabuary,Greguary,Musch,Monolith,Meow,Joon,Jooly,Citrust,Septbark,Makotober,Novembear,Endember");
		addTemplate("$family$, ,story");
		addTemplate("story,of,$family$");
		addTemplate("story,of,$family_founder_1$");
		addTemplate("story,of,$family_founder_2$");
		addTemplate("story,of,$family_founder_1$,and,$family_founder_2$");
		addTemplate("story,of,$family_founder_2$,and,$family_founder_1$");
		addTemplate("story,of,$king$,and,$king_lover$");
		addTemplate("love, ,$family_founder_1$, ,met, ,$family_founder_2$");
		addTemplate("love, ,$family_founder_2$, ,met, ,$family_founder_1$");
		addTemplate("love, ,$king$, ,met, ,$king_lover$");
		addTemplate("day_numbers, ,days,in,month_name");
		addTemplate("day_numbers, ,days,of,month_name");
		addTemplate("$family_founder_1$,in,$city_random$");
		addTemplate("$family_founder_2$,in,$city_random$");
		clone("book_name_bad_story", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset4 = t;
		nameGeneratorAsset4.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset4.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyLeader));
		NameGeneratorAsset nameGeneratorAsset5 = t;
		nameGeneratorAsset5.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset5.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyKing));
		NameGeneratorAsset nameGeneratorAsset6 = t;
		nameGeneratorAsset6.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset6.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyClan));
		NameGeneratorAsset nameGeneratorAsset7 = t;
		nameGeneratorAsset7.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset7.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyFamily));
		NameGeneratorAsset nameGeneratorAsset8 = t;
		nameGeneratorAsset8.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset8.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyFamilyFounders));
		addDictPart("story", "misadventure,failure,tragedy,disaster,folly,shame,farce,debacle");
		addDictPart("misdeeds", "sins,misdeeds,scandals,crimes,shames,faults,flaws,follies,regrets");
		addTemplate("misdeeds,of,$clan_random$");
		addTemplate("misdeeds,and,$clan_random$");
		addTemplate("misdeeds,of,$family_random$");
		addTemplate("misdeeds,and,$family_random$");
		addTemplate("misdeeds,of,$leader_random$");
		addTemplate("misdeeds,and,$leader_random$");
		addTemplate("misdeeds,of,$king_random$");
		addTemplate("misdeeds,and,$king_random$");
		addTemplate("story,of,$clan_random$");
		addTemplate("story,of,$family_random$");
		addTemplate("story,of,$leader_random$");
		addTemplate("story,of,$king_random$");
		addTemplate("story,of,$family_founder_1$,and,$family_founder_2$");
		addTemplate("story,of,$family_random$,and,their, ,misdeeds");
		addTemplate("story,of,misdeeds,of,$clan_random$");
		addTemplate("story,of,misdeeds,and,$clan_random$");
		addTemplate("story,of,misdeeds,of,$family_random$");
		addTemplate("story,of,misdeeds,and,$family_random$");
		addTemplate("story,of,misdeeds,of,$leader_random$");
		addTemplate("story,of,misdeeds,and,$leader_random$");
		addTemplate("story,of,misdeeds,of,$king_random$");
		addTemplate("story,of,misdeeds,and,$king_random$");
		addTemplate("story,of,$family_random$,and,their, ,misdeeds");
		addTemplate("story,of,$clan_random$,and,their, ,misdeeds");
		clone("book_name_fable", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset9 = t;
		nameGeneratorAsset9.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset9.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnName));
		NameGeneratorAsset nameGeneratorAsset10 = t;
		nameGeneratorAsset10.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset10.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnCity));
		NameGeneratorAsset nameGeneratorAsset11 = t;
		nameGeneratorAsset11.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset11.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKingdom));
		NameGeneratorAsset nameGeneratorAsset12 = t;
		nameGeneratorAsset12.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset12.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnAlliance));
		NameGeneratorAsset nameGeneratorAsset13 = t;
		nameGeneratorAsset13.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset13.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFigure));
		addDictPart("story", "fable,tale,myths,legend,lesson");
		addDictPart("folklore", "fables,tales,myths,legends,folklore,lessons");
		addDictPart("moral", "moral,virtue,lesson,teaching,warning,cautionary tale");
		addDictPart("virtue", "wisdom,kindness,courage,patience,humility,justice,friendship");
		addDictPart("vice", "greed,pride,foolishness,envy,anger,vanity,arrogance");
		addTemplate("story,of,$alliance$");
		addTemplate("story,of,$unit$");
		addTemplate("story,of,$city$,and,vice");
		addTemplate("story,of,$kingdom$");
		addTemplate("story,of,$figure$");
		addTemplate("folklore,of,$alliance$");
		addTemplate("folklore,of,$kingdom$");
		addTemplate("folklore,of,$clan$");
		addTemplate("folklore,of,$city$");
		addTemplate("story,of,$clan$,and,their, ,virtue");
		addTemplate("story,of,$clan$,and,their, ,vice");
		addTemplate("story,of,$unit$,and,the, ,moral");
		addTemplate("story,of,$unit$,and,the, ,$king$");
		addTemplate("story,of,$unit$,and,the, ,$leader$");
		addTemplate("story,of,$king$,and,the, ,moral");
		addTemplate("story,of,$king$,and,the, ,$kingdom$");
		addTemplate("story,of,$leader$,and,the, ,moral");
		addTemplate("story,of,$leader$,and,the, ,$city$");
		addTemplate("story,of,$unit$,and,their, ,virtue");
		addTemplate("virtue,and,vice,of,$unit$");
		addTemplate("virtue,of,$unit$");
		addTemplate("virtue,and,$unit$");
		addTemplate("vice,and,$unit$");
		addTemplate("virtue,and,vice,of,$figure$");
		addTemplate("virtue,of,$figure$");
		addTemplate("virtue,and,$figure$");
		addTemplate("vice,and,$figure$");
		clone("book_name_warfare_manual", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset14 = t;
		nameGeneratorAsset14.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset14.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFigure));
		NameGeneratorAsset nameGeneratorAsset15 = t;
		nameGeneratorAsset15.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset15.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKingdom));
		addDictPart("manual", "manual,guide,handbook,codex,compendium,treatise,doctrine,principles,lessons,teachings");
		addDictPart("warfare", "warfare,battle,combat,strategy,tactics,conquest,defense");
		addDictPart("attribute", "glory,honor,discipline,strategy,cunning,victory,chaos");
		addTemplate("manual,of,warfare,by,$figure$");
		addTemplate("manual,of,warfare,of,$figure$");
		addTemplate("manual,of,warfare,of,$kingdom$");
		addTemplate("$figure$,and,$figure$");
		addTemplate("manual,of,the, ,$figure$,and,their, ,attribute");
		addTemplate("manual,of,warfare,and,attribute,of,$figure$");
		addTemplate("manual,of,attribute,and,warfare,of,$figure$");
		clone("book_name_economy_manual", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset16 = t;
		nameGeneratorAsset16.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset16.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFavoriteFood));
		NameGeneratorAsset nameGeneratorAsset17 = t;
		nameGeneratorAsset17.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset17.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFigure));
		addDictPart("manual", "manual,guide,handbook,codex,compendium,treatise,doctrine,principles,lessons,teachings");
		addDictPart("concept", "economy,wealth,money,gold,trade,management,leadership,taxation,administration,tribute,toll,duty,levy,censure");
		addDictPart("attribute", "prosperity,riches,growth,efficiency,resources,change,progress,strategy");
		addDictPart("kingdom", "kingdom,realm,city,state,domain,empire");
		addTemplate("manual,ofonbout,$food$");
		addTemplate("concept,and,$food$");
		addTemplate("concept,and,attribute");
		addTemplate("$food$, ,concept");
		addTemplate("manual,ofonbout,concept,by,$figure$");
		addTemplate("manual,ofonbout,concept,of,$figure$");
		addTemplate("manual,ofonbout,concept,and,attribute,of,$figure$");
		addTemplate("manual,ofonbout,$figure$,and,their, ,attribute");
		addTemplate("manual,toon,concept,ofonbout,the, ,kingdom,by,$figure$");
		clone("book_name_stewardship_manual", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset18 = t;
		nameGeneratorAsset18.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset18.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFigure));
		addDictPart("manual", "manual,guide,handbook,codex,compendium,treatise,doctrine,principles,lessons,teachings");
		addDictPart("concept", "economy,wealth,money,gold,trade,management,leadership,taxation,administration,tribute,toll,duty,levy,censure");
		addDictPart("attribute", "prosperity,riches,growth,efficiency,resources,change,progress,strategy");
		addDictPart("kingdom", "kingdom,realm,city,state,domain,empire");
		addTemplate("manual,ofonbout,concept");
		addTemplate("manual,ofonbout,concept,by,$figure$");
		addTemplate("manual,ofonbout,concept,of,$figure$");
		addTemplate("manual,ofonbout,concept,and,attribute");
		addTemplate("manual,ofonbout,concept,and,attribute,of,$figure$");
		addTemplate("manual,ofonbout,attribute,and,concept");
		addTemplate("manual,ofonbout,attribute,and,concept,of,$figure$");
		addTemplate("manual,ofonbout,$figure$,and,their, ,attribute");
		addTemplate("manual,toon,concept,ofonbout,the, ,kingdom");
		addTemplate("manual,toon,concept,ofonbout,the, ,kingdom,by,$figure$");
		addTemplate("concept,and,the, ,kingdom");
		addTemplate("concept,and,the, ,kingdom,by,$figure$");
		addTemplate("concept, ,manual");
		addTemplate("concept,and,attribute, ,manual");
		addTemplate("attribute, ,manual");
		addTemplate("attribute,and,concept, ,manual");
		clone("book_name_diplomacy_manual", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset19 = t;
		nameGeneratorAsset19.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset19.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFigure));
		addDictPart("manual", "art,manual,guide,handbook,codex,compendium,treatise,doctrine,principles,lessons,teachings");
		addDictPart("concept", "diplomacy,negotiation,alliance,politics,relations,peacemaking,statesmanship");
		addDictPart("attribute", "cunning,grace,tact,patience,strategy,charisma,honor");
		addDictPart("kingdom", "kingdom,realm,state,empire,coalition,domain");
		addDictPart("kingdoms", "kingdoms,realms,states,empires,coalitions,domains");
		addTemplate("manual,ofonbout,concept");
		addTemplate("manual,ofonbout,concept,by,$figure$");
		addTemplate("manual,ofonbout,concept,of,$figure$");
		addTemplate("manual,ofonbout,concept,and,kingdom");
		addTemplate("manual,ofonbout,concept,and,attribute");
		addTemplate("manual,ofonbout,concept,and,attribute,of,$figure$");
		addTemplate("manual,ofonbout,concept,and,attribute,of,kingdoms");
		addTemplate("manual,ofonbout,attribute,and,concept");
		addTemplate("manual,ofonbout,attribute,and,concept,of,$figure$");
		addTemplate("manual,ofonbout,$figure$,and,their, ,attribute");
		addTemplate("manual,toon,concept,ofonbout,the, ,kingdom");
		addTemplate("manual,toon,concept,ofonbout,the, ,kingdom,by,$figure$");
		addTemplate("manual,ofonbout,attribute,and,concept");
		addTemplate("manual,ofonbout,attribute,and,concept,of,$figure$");
		addTemplate("manual,ofonbout,attribute,and,concept");
		addTemplate("manual,ofonbout,attribute,and,kingdom");
		addTemplate("manual,ofonbout,attribute,and,concept,of,kingdoms");
		addTemplate("concept,and,the, ,kingdom");
		addTemplate("concept,and,the, ,kingdom,by,$figure$");
		addTemplate("concept, ,manual");
		addTemplate("concept,and,attribute, ,manual");
		addTemplate("attribute, ,manual");
		addTemplate("attribute,and,concept, ,manual");
		addTemplate("concept,by,$figure$");
		addTemplate("concept,of,$figure$");
		addTemplate("concept,and,the, ,kingdom");
		addTemplate("kingdoms,and,concept");
		addTemplate("kingdoms,and,attribute");
		addTemplate("concept,and,attribute");
		addTemplate("concept,and,attribute,of,$figure$");
		addTemplate("concept,and,attribute,of,kingdoms");
		addTemplate("attribute,and,concept");
		addTemplate("attribute,and,concept,of,$figure$");
		addTemplate("$figure$,and,their, ,attribute");
		addTemplate("concept,ofonbout,the, ,kingdom");
		addTemplate("concept,ofonbout,the, ,kingdom,by,$figure$");
		addTemplate("attribute,and,concept");
		addTemplate("attribute,and,concept,of,$figure$");
		addTemplate("attribute,and,concept");
		addTemplate("attribute,of,kingdoms");
		addTemplate("attribute,and,kingdoms");
		addTemplate("attribute,and,the, ,kingdom");
		addTemplate("attribute,and,concept,of,kingdoms");
		clone("book_name_math", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset20 = t;
		nameGeneratorAsset20.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset20.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceFigure));
		NameGeneratorAsset nameGeneratorAsset21 = t;
		nameGeneratorAsset21.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset21.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnCulture));
		NameGeneratorAsset nameGeneratorAsset22 = t;
		nameGeneratorAsset22.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset22.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyCulture));
		addDictPart("manual", "manual,guide,treatise,handbook,codex,compendium,treatise,doctrine,principles,lessons,teachings");
		addDictPart("math", "mathematics,geometry,algebra,arithmetic,logic,numbers,equations,fractals,calculus");
		addDictPart("attribute", "precision,logic,beauty,symmetry,harmony,proof,reasoning,theory");
		addDictPart("theory", "theory,principles,axioms,formulas,truths");
		addDictPart("kingdom", "kingdom,realm,state,empire,domain");
		addTemplate("manual,of,math,by,$figure$");
		addTemplate("theory,of,math,of,$figure$");
		addTemplate("theory,of,math,of,$culture$");
		addTemplate("theory,of,math,of,$culture_random$");
		addTemplate("manual,of,math,and,attribute,of,$figure$");
		addTemplate("manual,of,attribute,and,math,by,$figure$");
		addTemplate("manual,of,math,and,math,by,$king$");
		addTemplate("manual, ,to, ,math,of,the, ,kingdom,by,$figure$");
		addTemplate("manual,of,the, ,attribute,of,math,by,$figure$");
		addTemplate("manual,on,attribute,and,math,of,$figure$");
		addTemplate("math,by,$figure$");
		addTemplate("math,of,$figure$");
		addTemplate("math,of,$culture$");
		addTemplate("math,of,$culture_random$");
		addTemplate("math,and,attribute,of,$figure$");
		addTemplate("attribute,and,math,by,$figure$");
		addTemplate("math,and,math,by,$king$");
		addTemplate("math,of,the, ,kingdom,by,$figure$");
		addTemplate("the, ,attribute,of,math,by,$figure$");
		addTemplate("attribute,and,math,of,$figure$");
		clone("book_name_biology", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset23 = t;
		nameGeneratorAsset23.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset23.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKingdom));
		NameGeneratorAsset nameGeneratorAsset24 = t;
		nameGeneratorAsset24.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset24.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyKingdom));
		NameGeneratorAsset nameGeneratorAsset25 = t;
		nameGeneratorAsset25.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset25.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnSubspecies));
		NameGeneratorAsset nameGeneratorAsset26 = t;
		nameGeneratorAsset26.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset26.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnySubspecies));
		NameGeneratorAsset nameGeneratorAsset27 = t;
		nameGeneratorAsset27.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset27.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnCity));
		NameGeneratorAsset nameGeneratorAsset28 = t;
		nameGeneratorAsset28.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset28.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceAnyCity));
		NameGeneratorAsset nameGeneratorAsset29 = t;
		nameGeneratorAsset29.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset29.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceWorldName));
		NameGeneratorAsset nameGeneratorAsset30 = t;
		nameGeneratorAsset30.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset30.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceArchitectName));
		addDictPart("manual", "Codex,Guide,Treatise,Handbook,Compendium");
		addDictPart("biology", "Life,Nature,Evolution,Anatomy,Biodiversity");
		addDictPart("attribute", "Origin,Growth,Evolution,Balance,Harmony,Complexity,Diversity,Physiology,Genetics,Symmetry,Adaptation,Resilience,Diet,Instincts,Mutations,Variations");
		addDictPart("event", "Extinction,Evolution,Adaptation,Migration,Domestication,Hybridization,Speciation,Invasion,Infection,Infestation,Parasitism,Commensalism,Mutualism,Cooperation,Competition,Predation,Decomposition,Respiration,Reproduction,Mutation,Selection,Variation,Inheritance,Expression,Regulation,Recombination,Divergence,Convergence");
		addDictPart("kingdom", "Realm,Domain,Empire,State");
		addDictPart("fauna", "Creatures,Beasts,Organisms,Flora,Fauna,Wildlife,Forms,Phenotypes,Oddities");
		addTemplate("event,of,biology");
		addTemplate("manual,of,biology");
		addTemplate("attribute,of,biology");
		addTemplate("kingdom,of,biology");
		addTemplate("biology,of,$world_name$");
		addTemplate("attribute,of,$world_name$");
		addTemplate("fauna,of,$world_name$");
		addTemplate("manual,of,$world_name$");
		addTemplate("fauna,of,$world_name$");
		addTemplate("fauna,of,$city_random$");
		addTemplate("biology,of,$random_subspecies$");
		addTemplate("fauna,of,$kingdom_random$");
		addTemplate("attribute,of,$random_subspecies$");
		addTemplate("$random_subspecies$,manual");
		addTemplate("$subspecies$,of,the, ,$kingdom$");
		addTemplate("$subspecies$,and,$city$");
		addTemplate("$subspecies$,and,biology");
		addTemplate("$random_subspecies$,and,biology");
		addTemplate("$random_subspecies$,of,$world_name$");
		addTemplate("$architect_name$,and,biology");
		addTemplate("$architect_name$,and,attribute");
		addTemplate("$architect_name$,and,$world_name$");
		clone("book_name_history", "$base_book_template$");
		NameGeneratorAsset nameGeneratorAsset31 = t;
		nameGeneratorAsset31.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset31.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnName));
		NameGeneratorAsset nameGeneratorAsset32 = t;
		nameGeneratorAsset32.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset32.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKing));
		NameGeneratorAsset nameGeneratorAsset33 = t;
		nameGeneratorAsset33.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset33.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKingClan));
		NameGeneratorAsset nameGeneratorAsset34 = t;
		nameGeneratorAsset34.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset34.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnLeader));
		NameGeneratorAsset nameGeneratorAsset35 = t;
		nameGeneratorAsset35.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset35.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnKingdom));
		NameGeneratorAsset nameGeneratorAsset36 = t;
		nameGeneratorAsset36.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset36.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnReligion));
		NameGeneratorAsset nameGeneratorAsset37 = t;
		nameGeneratorAsset37.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset37.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnCulture));
		NameGeneratorAsset nameGeneratorAsset38 = t;
		nameGeneratorAsset38.replacer = (NameGeneratorReplacer)Delegate.Combine(nameGeneratorAsset38.replacer, new NameGeneratorReplacer(NameGeneratorReplacers.replaceOwnLanguage));
		addDictPart("manual", "lessons,manual,guide,chronicle,chronicles,treatise,compendium,codex,account,record");
		addDictPart("history", "history,events,stories,legends,myths,lore");
		addDictPart("attribute", "truth,legacy,glory,memory,justice,honor");
		addDictPart("kingdom", "kingdom,realm,empire,state,domain,coalition");
		addDictPart("person", "$king$,$leader$,$unit$");
		addDictPart("subject", "$king$,$clan$,$leader$,$kingdom$,$religion$,$culture$,$language$");
		addTemplate("history,by,person");
		addTemplate("history,of,subject");
		addTemplate("history,and,attribute,by,person");
		addTemplate("history,and,attribute,of,subject");
		addTemplate("history,and,attribute");
		addTemplate("attribute,and,history");
		addTemplate("attribute,and,attribute");
		addTemplate("attribute,and,attribute,by,person");
		addTemplate("attribute,and,attribute,of,subject");
		addTemplate("kingdom,of,history");
		addTemplate("kingdom,and,history");
		addTemplate("kingdom,of,attribute");
		addTemplate("kingdom,and,attribute");
		addTemplate("kingdom,and,its, ,history");
		addTemplate("kingdom,and,its, ,history,by,person");
		addTemplate("manual,of,history,by,person");
		addTemplate("manual,of,history,of,subject");
		addTemplate("manual,of,the, ,history,of,subject");
		addTemplate("history,of,subject,and,its, ,kingdom");
		addTemplate("manual,of,history,and,attribute,by,person");
		addTemplate("manual,on,history,and,attribute,of,subject");
		addTemplate("manual,of,attribute,and,attribute,by,person");
		addTemplate("manual,of,kingdom,and,its, ,history");
		addTemplate("manual,of,kingdom,and,its, ,history,by,person");
	}

	private static string finalizerBookName(string pName)
	{
		if (string.IsNullOrEmpty(pName))
		{
			return pName;
		}
		pName = OnomasticsData.convertToCultureTitleCase(pName);
		TextInfo textInfo = CultureInfo.InvariantCulture.TextInfo;
		bool flag = false;
		string[] preps = _preps;
		foreach (string text in preps)
		{
			string text2 = textInfo.ToTitleCase(text);
			pName = pName.Replace(" " + text2 + " ", " " + text.ToLower() + " ");
			if (pName.StartsWith(text2))
			{
				flag = true;
			}
		}
		if (pName.StartsWith("You"))
		{
			flag = true;
		}
		if (pName.StartsWith("Our"))
		{
			flag = true;
		}
		if (pName.StartsWith("Wh"))
		{
			flag = true;
		}
		if (pName.StartsWith("How"))
		{
			flag = true;
		}
		if (!flag && Randy.randomBool())
		{
			if (Randy.randomBool())
			{
				pName = "The " + pName;
			}
			else
			{
				string[] array = pName.Split(' ');
				bool flag2 = true;
				if (array.Length != 0 && array[0].EndsWith("s"))
				{
					flag2 = false;
				}
				if (array.Length > 1 && array[1].EndsWith("s"))
				{
					flag2 = false;
				}
				if (flag2)
				{
					pName = ((pName[0] != 'A' && pName[0] != 'E' && pName[0] != 'I' && pName[0] != 'O' && pName[0] != 'U') ? ("A " + pName) : ("An " + pName));
				}
			}
		}
		return pName;
	}

	private void addItemNames()
	{
		add(new NameGeneratorAsset
		{
			id = "boots_name",
			use_dictionary = true
		});
		addDictPart("first", "Scruffy,Shabby,Sturdy,Bloody,Smooth,Worn,Savage,Broken,Suede,Fancy,Classic,Breezy,Elegant,Rugged,Ruched,Superior,Treaded");
		addDictPart("space", " ");
		addDictPart("second", "Waders,Kicks,Galoshes,Mukluks,Kamik,Brogans,Wellingtons,Boots,Heels,Cleats,Studs,Pumps,Slippers,Sneakers,Clogs,Moccasins");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "armor_name",
			use_dictionary = true
		});
		addDictPart("first", "Golden,Defensive,Complete,Splendid,Knightly,Rusty,Ponderous,Stiff,Breasted,Pocketed");
		addDictPart("space", " ");
		addDictPart("second", "Platiander,Platus,Plato,Plates,Platah,Plats,Platt,Plote,Plotete,Plute,Pluto,Plattmeister,Platander,Platitude,Platunder,Plattler,Plata");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "helmet_name",
			use_dictionary = true
		});
		addDictPart("first", "Glorified,Excruciating,Exceptional,Exquisite,Special,Don't Hit");
		addDictPart("space", " ");
		addDictPart("second", "Headhurt,Headpain,Herald,Hithead,Headbox,Brainbox,Hardhead,Hardhat,Hothat,Facesmash,Faceplate,Facemate,Headcrate,Hothead,Headhit,Brainpain,Migraine,Brainhat,Cephalalgium");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "ring_name",
			use_dictionary = true
		});
		addDictPart("first", "Stone of,Healing,Raven's,Harbinger of,Crafted,The,Butcher's,Queen's,King's,Behemoth's,Troll's,Stinky");
		addDictPart("space", " ");
		addDictPart("second", "Star,Apocalypse,Omen,Storm,Prophecy,Band,Doom,Wrath,Niceness,Apology,Courage,Shriek,Toy,Desire,Carrot,Contradiction");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "amulet_name",
			use_dictionary = true
		});
		addDictPart("first", "Eye of,Rising,Half Moon,Full Moon,Cat's,Harlequin's,Bloody,Smooth,Mysterious,Broken,Crooked,Declining,Tiny,Smol,Lil,Harmless,Nice");
		addDictPart("space", " ");
		addDictPart("second", "Chance,Sun,Stone,Obelisk,Wrath,Bottom,Earth,Vortex,Vertigo,Garden,Backyard,Field,Planet,Meteor,Volcano,Sinkhole");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "sword_name",
			use_dictionary = true
		});
		addDictPart("first", "Scary,Great,Battle,Legendary,Hero,Twisted,Bloody,Empathic,Smooth,War,Savage,Broken,Sinister,Smort,Sharp");
		addDictPart("space", " ");
		addDictPart("second", "Sworzenegger,Ignizherziander,Obliterator,Annihilator,Oblivion,Doomblade,Sculptor,Protector,Razorblade,Blade,Swordo,Swardo,Swyrd,Reaver,End,Defender,Slicer,Promise,Excaliander,Sworziander,Oblivionherziander");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "sword_name_king",
			use_dictionary = true,
			check = NameGeneratorChecks.hasLatinKing,
			replacer = NameGeneratorReplacers.replaceOwnKing
		});
		addDictPart("first", "$king$'s");
		addDictPart("space", " ");
		addDictPart("second", "Obliterator,Annihilator,Doomblade,Protector,Reaver,Defender,Wrath");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "weapon_name_enemy_king",
			use_dictionary = true,
			check = NameGeneratorChecks.hasEnemyLatinKing,
			replacer = NameGeneratorReplacers.replaceEnemyKing
		});
		addDictPart("firstKing", "$king$'s");
		addDictPart("first", "End of,Gift for,Tears of");
		addDictPart("space", " ");
		addDictPart("second", "End,Demise,Tears,Grave");
		addDictPart("secondKing", "$king$");
		addTemplate("firstKing,space,second");
		addTemplate("first,space,secondKing");
		add(new NameGeneratorAsset
		{
			id = "weapon_name_enemy_kingdom",
			use_dictionary = true,
			check = NameGeneratorChecks.hasEnemyLatinKingdom,
			replacer = NameGeneratorReplacers.replaceEnemyKingdom
		});
		addDictPart("firstKingdom", "$kingdom$'s");
		addDictPart("first", "End of,Gift for,Tears of");
		addDictPart("space", " ");
		addDictPart("second", "End,Demise,Tears,Annihilation");
		addDictPart("secondKingdom", "$kingdom$");
		addTemplate("firstKingdom,space,second");
		addTemplate("first,space,secondKingdom");
		add(new NameGeneratorAsset
		{
			id = "weapon_name_city",
			use_dictionary = true,
			check = NameGeneratorChecks.hasLatinCity,
			replacer = NameGeneratorReplacers.replaceOwnCity
		});
		addDictPart("first", "Hope of,Glory to,Defender of,Son of,Guard of,Soul of,Heart of");
		addDictPart("space", " ");
		addDictPart("second", "$city$");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "weapon_name_kingdom",
			use_dictionary = true,
			check = NameGeneratorChecks.hasLatinKingdom,
			replacer = NameGeneratorReplacers.replaceOwnKingdom
		});
		addDictPart("first", "Hope of,Glory to,Defender of,Son of,Guard of,Soul of,Heart of");
		addDictPart("space", " ");
		addDictPart("second", "$kingdom$");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "weapon_name_culture",
			use_dictionary = true,
			check = NameGeneratorChecks.hasLatinCulture,
			replacer = NameGeneratorReplacers.replaceOwnCulture
		});
		addDictPart("first", "Hope of,Glory to,Defender of,Son of,Guard of,Soul of,Heart of");
		addDictPart("space", " ");
		addDictPart("second", "$culture$");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "axe_name",
			use_dictionary = true
		});
		addDictPart("first", "Wicked,Stormy,War,Misfortune's,Gladiator's,War Battle,Eternal,King's,Cosmic");
		addDictPart("space", " ");
		addDictPart("second", "Aruba,Edge,Frostbite,Betrayer,Hope,Annihilation,Axe,Mercy,Chopper,Chopah,Blade,Reaver,Ravager");
		addTemplate("first,space,second");
		addTemplate("second");
		add(new NameGeneratorAsset
		{
			id = "axe_name_king",
			use_dictionary = true,
			check = NameGeneratorChecks.hasLatinKing,
			replacer = NameGeneratorReplacers.replaceOwnKing
		});
		addDictPart("first", "Cleaver of,Wrath of,Axe of,Blade of,Edge of");
		addDictPart("firstKing", "$king$'s");
		addDictPart("space", " ");
		addDictPart("secondKing", "$king$");
		addDictPart("second", "Cleaver,Battleaxe,Reaver,Axe,Bloodaxe");
		addTemplate("first,space,secondKing");
		addTemplate("firstKing,space,second");
		add(new NameGeneratorAsset
		{
			id = "hammer_name",
			use_dictionary = true
		});
		addDictPart("first", "Massive,Deluded,Hell's,Deluded,Guard's,Storm,Barbaric,Perfect");
		addDictPart("space", " ");
		addDictPart("second", "Mostef,Xiphos,Hatred,Hammertime,Agony,Denial,Terror,Scream,Battlehammer,Stonefist,Gatecrasher,Glory,Smasher,Ambassador");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "spear_name",
			use_dictionary = true
		});
		addDictPart("first", "Owl's,Ivan The,Glory's,Hatred's,Thirsty,Doomy,Long,Champion");
		addDictPart("space", " ");
		addDictPart("second", "Eye,Poncho,Supernova,Nightbane,Corpsemaker,Pike,Poke,Spike,Stinger,Regret,Point,Impaler");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "stick_name",
			use_dictionary = true
		});
		addDictPart("first", "Old,Curvy,Nice,Perfect,Memorable,Heavy,Big");
		addDictPart("space", " ");
		addDictPart("second", "Friend,Palka,Derevyashka,Derevo,Drevo,Woodstick,Toothpick,Cudgel,Club,The Whackmaker");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "bow_name",
			use_dictionary = true
		});
		addDictPart("first", "Wind's,Devil's,Wretched,Shadow");
		addDictPart("space", " ");
		addDictPart("second", "Pain,Irk,Bow,Shooter,Sun,Strike,Hatred,Pew,Eye,Heartbeat,Piercer,Might,Meteor,Vengeance,Avalance,Eagle,Aie");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "shotgun_name",
			use_dictionary = true
		});
		addDictPart("first", "Red,Black,Bloody,Dark,Big,Stunning");
		addDictPart("dash", "-,-");
		addDictPart("space", "-,-");
		addDictPart("name", "Anne,Betty,Emma,Ava,Mia,Amelia,Lisa,Julia,Sophia,Charvi,Layla,Jocelyn,Hannah,Dasha");
		addDictPart("numbers", "0,1,2,3,4,5,6,7,8,9,");
		addTemplate("first,dash,name,dash,numbers,numbers");
		addTemplate("first,dash,name,dash,numbers,numbers,numbers");
		addTemplate("first,dash,name,dash,numbers,numbers,numbers,numbers");
		addTemplate("name,dash,numbers,numbers");
		addTemplate("name,dash,numbers,numbers,numbers");
		addTemplate("name,dash,numbers,numbers,numbers,numbers");
		add(new NameGeneratorAsset
		{
			id = "blaster_name",
			use_dictionary = true
		});
		addDictPart("first", "X,Y,W,Alpha,Zeta,Omega");
		addDictPart("dash", "-,-");
		addDictPart("second", "404,101,69,111,420,25,96,LOL,LMAO,LULZ,RSRS,HOHO,55555");
		addTemplate("first,dash,second,dash,first");
		addTemplate("first,dash,second");
		addTemplate("second,dash,first");
		addTemplate("second,dash,second");
		addTemplate("first,dash,first,dash,first");
		addTemplate("first,dash,first,dash,second");
		add(new NameGeneratorAsset
		{
			id = "flame_sword_name",
			use_dictionary = true
		});
		addDictPart("first", "BURNING,FLAMING,SCREAMING,HELLISH,RED,ORANGE,HOT,FIERY");
		addDictPart("space", " ");
		addDictPart("second", "DESIRE,PASSION,KASAI,CRAVE,FLAME,CONSCIENCE,VOICE,WANTS,TONGUE,WORDS,LOVE,HEART,DEATH");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "flame_hammer_name",
			use_dictionary = true
		});
		addDictPart("first", "BURNING,FLAMING,SCREAMING,HELLISH,RED,ORANGE,HOT,FIERY");
		addDictPart("space", " ");
		addDictPart("second", "DESIRE,PASSION,CRAVE,FLAME,CONSCIENCE,VOICE,WANTS,TONGUE,WORDS,LOVE,HEART,DEATH");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "ice_hammer_name",
			use_dictionary = true
		});
		addDictPart("first", "FREEZING,FROSTING,SCREAMING,GLAZING,BLUE,WHITE,COLD,SHARP");
		addDictPart("space", " ");
		addDictPart("second", "DESIRE,PASSION,CRAVE,ICE,CONSCIENCE,VOICE,WANTS,TONGUE,WORDS,LOVE,HEART,DEATH");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "necromancer_staff_name",
			use_dictionary = true
		});
		addDictPart("first", "Witty,Sorrowful,Depressed,Jealous,Choleric,Wrathful");
		addDictPart("space", " ");
		addDictPart("second", "Monica,Rachel,Chandler,Bing,Ross,Joey,Gunther,Janice,Buffay,Phoebe");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "evil_staff_name",
			use_dictionary = true
		});
		addDictPart("first", "Absurd,Bitter,Desolate,Possessive,Angry,Loyal,Damned");
		addDictPart("space", " ");
		addDictPart("second", "Kramer,George,Costanza,Elaine,Susan,Newman,Jerry,Frank,Helen,Estelle");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "white_staff_name",
			use_dictionary = true
		});
		addDictPart("first", "Funny,Sad,Gloomy,Envious,Grudging,Friendly,Kind,Punchy");
		addDictPart("space", " ");
		addDictPart("second", "Marceline,Finn,Jake,Bomo,King,Bubblegum,Prismo,Space,Trunks,Bun,Ricardio");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "plague_doctor_staff_name",
			use_dictionary = true
		});
		addDictPart("first", "Second,Next,Green,Red,Lovely");
		addDictPart("space", " ");
		addDictPart("second", "Death,Hope,Anger,Chance,Heart");
		addTemplate("first,space,second");
		add(new NameGeneratorAsset
		{
			id = "druid_staff_name",
			use_dictionary = true
		});
		addDictPart("first", "Green,Forest's,Organic,Grassy,Lush,Leafy");
		addDictPart("space", " ");
		addDictPart("second", "Leaf,Focus,Edgar,Toad");
		addTemplate("first,space,second");
	}
}
// --- End of File: NameGeneratorLibrary.cs ---



// --- Start of File: NameGeneratorReplacer.cs ---
public delegate void NameGeneratorReplacer(ref string pName, Actor pActor);
// --- End of File: NameGeneratorReplacer.cs ---



// --- Start of File: NameGeneratorReplacerKingdom.cs ---
public delegate void NameGeneratorReplacerKingdom(ref string pName, Kingdom pKingdom);
// --- End of File: NameGeneratorReplacerKingdom.cs ---



// --- Start of File: NameGeneratorReplacers.cs ---
using UnityEngine;

public static class NameGeneratorReplacers
{
	public static void replaceKingdom(ref string pName, Kingdom pKingdom)
	{
		if (pName.Contains("$kingdom$"))
		{
			if (pKingdom == null)
			{
				pName = "";
			}
			else
			{
				pName = pName.Replace("$kingdom$", pKingdom.name);
			}
		}
	}

	public static void replaceEnemyKing(ref string pName, Actor pActor)
	{
		using ListPool<Kingdom> list = pActor.kingdom.getEnemiesKingdoms();
		foreach (Kingdom item in list.LoopRandom())
		{
			if (item.hasKing() && Toolbox.isFirstLatin(item.king.getName()))
			{
				pName = pName.Replace("$king$", "King " + item.king.getName());
				return;
			}
		}
		pName = "";
	}

	public static void replaceOwnKingdom(ref string pName, Actor pActor)
	{
		if (pName.Contains("$kingdom$"))
		{
			if (!pActor.hasKingdom())
			{
				pName = "";
				return;
			}
			Kingdom kingdom = pActor.kingdom;
			pName = pName.Replace("$kingdom$", kingdom.name);
		}
	}

	public static void replaceEnemyKingdom(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$kingdom$"))
		{
			return;
		}
		using ListPool<Kingdom> list = pActor.kingdom.getEnemiesKingdoms();
		foreach (Kingdom item in list.LoopRandom())
		{
			if (Toolbox.isFirstLatin(item.name))
			{
				pName = pName.Replace("$kingdom$", item.name);
				return;
			}
		}
		pName = "";
	}

	public static void replaceFavoriteFood(ref string pName, Actor pActor)
	{
		if (pName.Contains("$food$"))
		{
			Kingdom kingdom = pActor.kingdom;
			string newValue;
			if (kingdom != null && kingdom.king?.hasFavoriteFood() == true)
			{
				newValue = pActor.kingdom.king.favorite_food_asset.getTranslatedName();
			}
			else
			{
				City city = pActor.city;
				newValue = ((city != null && city.leader?.hasFavoriteFood() == true) ? pActor.city.leader.favorite_food_asset.getTranslatedName() : ((!pActor.hasFavoriteFood()) ? AssetManager.resources.list.GetRandom().getTranslatedName() : pActor.favorite_food_asset.getTranslatedName()));
			}
			pName = pName.Replace("$food$", newValue);
		}
	}

	public static void replaceOwnName(ref string pName, Actor pActor)
	{
		if (pName.Contains("$unit$"))
		{
			pName = pName.Replace("$unit$", pActor.getName());
		}
	}

	public static void replaceOwnCity(ref string pName, Actor pActor)
	{
		if (pName.Contains("$city$"))
		{
			if (!pActor.hasCity())
			{
				pName = "";
				return;
			}
			City city = pActor.city;
			pName = pName.Replace("$city$", city.name);
		}
	}

	public static void replaceOwnSubspecies(ref string pName, Actor pActor)
	{
		if (pName.Contains("$subspecies$"))
		{
			if (!pActor.hasSubspecies())
			{
				pName = "";
				return;
			}
			Subspecies subspecies = pActor.subspecies;
			pName = pName.Replace("$subspecies$", subspecies.name);
		}
	}

	public static void replaceOwnAlliance(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$alliance$"))
		{
			return;
		}
		if (!pActor.hasKingdom())
		{
			pName = "";
			return;
		}
		Kingdom kingdom = pActor.kingdom;
		if (!kingdom.hasAlliance())
		{
			pName = "";
			return;
		}
		Alliance alliance = kingdom.getAlliance();
		pName = pName.Replace("$alliance$", alliance.name);
	}

	public static void replaceOwnKingClan(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$clan$"))
		{
			return;
		}
		Kingdom kingdom = pActor.kingdom;
		if (!kingdom.hasKing())
		{
			pName = "";
			return;
		}
		Actor king = kingdom.king;
		if (!king.hasClan())
		{
			pName = "";
		}
		else
		{
			pName = pName.Replace("$clan$", king.clan.name);
		}
	}

	public static void replaceOwnLeader(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$leader$"))
		{
			return;
		}
		if (!pActor.hasCity())
		{
			pName = "";
			return;
		}
		City city = pActor.city;
		if (!city.hasLeader())
		{
			pName = "";
			return;
		}
		Actor leader = city.leader;
		pName = pName.Replace("$leader$", leader.getName());
	}

	public static void replaceFigure(ref string pName, Actor pActor)
	{
		replaceOwnLeader(ref pName, pActor);
		replaceOwnKing(ref pName, pActor);
		replaceOwnKingClan(ref pName, pActor);
	}

	public static void replaceAnyCity(ref string pName, Actor pActor)
	{
		if (pName.Contains("$city_random$"))
		{
			if (!World.world.cities.hasAny())
			{
				pName = "";
				return;
			}
			City random = World.world.cities.getRandom();
			pName = pName.Replace("$city_random$", random.name);
		}
	}

	public static void replaceAnyKingdom(ref string pName, Actor _)
	{
		if (pName.Contains("$kingdom_random$"))
		{
			if (!World.world.kingdoms.hasAny())
			{
				pName = "";
				return;
			}
			Kingdom random = World.world.kingdoms.getRandom();
			pName = pName.Replace("$kingdom_random$", random.name);
		}
	}

	public static void replaceAnyCulture(ref string pName, Actor _)
	{
		if (pName.Contains("$culture_random$"))
		{
			if (!World.world.cultures.hasAny())
			{
				pName = "";
				return;
			}
			Culture random = World.world.cultures.getRandom();
			pName = pName.Replace("$culture_random$", random.name);
		}
	}

	public static void replaceAnyFamily(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$family_random$"))
		{
			return;
		}
		if (!World.world.families.hasAny())
		{
			pName = "";
			return;
		}
		int count = World.world.families.Count;
		do
		{
			Family random = World.world.families.getRandom();
			if (random.isSameSpecies(pActor.asset.id))
			{
				Family family = random;
				pName = pName.Replace("$family_random$", family.name);
				return;
			}
		}
		while (count-- > 0);
		pName = "";
	}

	public static void replaceAnySubspecies(ref string pName, Actor pActor)
	{
		if (pName.Contains("$random_subspecies$"))
		{
			if (!World.world.subspecies.hasAny())
			{
				pName = "";
				return;
			}
			Subspecies random = World.world.subspecies.getRandom();
			pName = pName.Replace("$random_subspecies$", random.name);
		}
	}

	public static void replaceAnyClan(ref string pName, Actor pActor)
	{
		if (pName.Contains("$clan_random$"))
		{
			if (!World.world.clans.hasAny())
			{
				pName = "";
				return;
			}
			Clan random = World.world.clans.getRandom();
			pName = pName.Replace("$clan_random$", random.name);
		}
	}

	public static void replaceAnyKing(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$king_random$"))
		{
			return;
		}
		if (!World.world.kingdoms.hasAny())
		{
			pName = "";
			return;
		}
		int num = 0;
		Kingdom kingdom = null;
		while (kingdom == null || !kingdom.hasKing())
		{
			if (num++ > 10)
			{
				pName = "";
				return;
			}
			kingdom = World.world.kingdoms.getRandom();
		}
		Actor king = kingdom.king;
		pName = pName.Replace("$king_random$", king.getName());
	}

	public static void replaceAnyLeader(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$leader_random$"))
		{
			return;
		}
		if (!World.world.cities.hasAny())
		{
			pName = "";
			return;
		}
		int num = 0;
		City city = null;
		while (city == null || !city.hasLeader())
		{
			if (num++ > 10)
			{
				pName = "";
				return;
			}
			city = World.world.cities.getRandom();
		}
		Actor leader = city.leader;
		pName = pName.Replace("$leader_random$", leader.getName());
	}

	public static void replaceOwnKing(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$king$"))
		{
			return;
		}
		if (!pActor.hasKingdom())
		{
			pName = "";
			return;
		}
		Kingdom kingdom = pActor.kingdom;
		if (!kingdom.hasKing())
		{
			pName = "";
			return;
		}
		Actor king = kingdom.king;
		pName = pName.Replace("$king$", king.getName());
	}

	public static void replaceOwnKingLover(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$king_lover$"))
		{
			return;
		}
		if (!pActor.hasKingdom())
		{
			pName = "";
			return;
		}
		Kingdom kingdom = pActor.kingdom;
		if (!kingdom.hasKing())
		{
			pName = "";
			return;
		}
		Actor king = kingdom.king;
		if (!king.hasLover())
		{
			pName = "";
			return;
		}
		Actor lover = king.lover;
		pName = pName.Replace("$king$", king.getName());
		pName = pName.Replace("$king_lover$", lover.getName());
	}

	public static void replaceOwnCulture(ref string pName, Actor pActor)
	{
		if (pName.Contains("$culture$"))
		{
			if (!pActor.hasCulture())
			{
				pName = "";
				return;
			}
			Culture culture = pActor.culture;
			pName = pName.Replace("$culture$", culture.name);
		}
	}

	public static void replaceOwnLanguage(ref string pName, Actor pActor)
	{
		if (pName.Contains("$language$"))
		{
			if (!pActor.hasLanguage())
			{
				pName = "";
				return;
			}
			Language language = pActor.language;
			pName = pName.Replace("$language$", language.name);
		}
	}

	public static void replaceOwnReligion(ref string pName, Actor pActor)
	{
		if (pName.Contains("$religion$"))
		{
			if (!pActor.hasReligion())
			{
				pName = "";
				return;
			}
			Religion religion = pActor.religion;
			pName = pName.Replace("$religion$", religion.name);
		}
	}

	public static void replaceOwnFamily(ref string pName, Actor pActor)
	{
		if (pName.Contains("$family$"))
		{
			if (!pActor.hasFamily())
			{
				pName = "";
				return;
			}
			Family family = pActor.family;
			pName = pName.Replace("$family$", family.name);
		}
	}

	public static void replaceAnyFamilyFounders(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$family_founder_1$") && !pName.Contains("$family_founder_2$"))
		{
			return;
		}
		if (!World.world.families.hasAny())
		{
			pName = "";
			return;
		}
		int count = World.world.families.list.Count;
		do
		{
			Family random = World.world.families.getRandom();
			if (random.isSameSpecies(pActor.asset.id) && random.hasFounders())
			{
				Family family = random;
				replaceFamilyFounder1(ref pName, family.units[0]);
				replaceFamilyFounder2(ref pName, family.units[0]);
				return;
			}
		}
		while (count-- > 0);
		pName = "";
	}

	public static void replaceOwnFamilyFounders(ref string pName, Actor pActor)
	{
		if (pName.Contains("$family_founder_1$") || pName.Contains("$family_founder_2$"))
		{
			if (!pActor.hasFamily())
			{
				pName = "";
				return;
			}
			replaceFamilyFounder1(ref pName, pActor);
			replaceFamilyFounder2(ref pName, pActor);
		}
	}

	public static void replaceFamilyFounder1(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$family_founder_1$"))
		{
			return;
		}
		if (!pActor.hasFamily())
		{
			pName = "";
			return;
		}
		string founder_actor_name_ = pActor.family.data.founder_actor_name_1;
		if (string.IsNullOrEmpty(founder_actor_name_))
		{
			pName = "";
		}
		else
		{
			pName = pName.Replace("$family_founder_1$", founder_actor_name_);
		}
	}

	public static void replaceFamilyFounder2(ref string pName, Actor pActor)
	{
		if (!pName.Contains("$family_founder_2$"))
		{
			return;
		}
		if (!pActor.hasFamily())
		{
			pName = "";
			return;
		}
		string founder_actor_name_ = pActor.family.data.founder_actor_name_2;
		if (string.IsNullOrEmpty(founder_actor_name_))
		{
			pName = "";
		}
		else
		{
			pName = pName.Replace("$family_founder_2$", founder_actor_name_);
		}
	}

	public static void replaceWorldName(ref string pName, Actor pActor)
	{
		if (pName.Contains("$world_name$"))
		{
			pName = pName.Replace("$world_name$", World.world.map_stats.name);
		}
	}

	public static void replaceArchitectName(ref string pName, Actor pActor)
	{
		if (pName.Contains("$architect_name$"))
		{
			pName = pName.Replace("$architect_name$", World.world.map_stats.player_name);
		}
	}

	public static void replacer_debug(ref string pName)
	{
		pName = pName.Replace("$alliance$", "Pact of Gregs");
		pName = pName.Replace("$food$", "Tea");
		pName = pName.Replace("$family$", "Gregovich");
		pName = pName.Replace("$family_random$", "Urg Zurg");
		pName = pName.Replace("$family_founder_1$", "Greg");
		pName = pName.Replace("$family_founder_2$", "Gregia");
		pName = pName.Replace("$king$", "Gregor");
		pName = pName.Replace("$king_lover$", "Gregoria");
		pName = pName.Replace("$king_random$", "Zurg Gurg");
		pName = pName.Replace("$kingdom$", "Kingdom of Greg");
		pName = pName.Replace("$kingdom_random$", "Brothers of Wargh");
		pName = pName.Replace("$clan$", "Greg Clan");
		pName = pName.Replace("$clan_random$", "Deze Zaz");
		pName = pName.Replace("$leader$", "Gregoryl");
		pName = pName.Replace("$leader_random$", "Orcaryl");
		pName = pName.Replace("$culture$", "Gragian Culture");
		pName = pName.Replace("$culture_random$", "Orkian Kult");
		pName = pName.Replace("$city$", "Gregopolis");
		pName = pName.Replace("$city_random$", "Orcville");
		pName = pName.Replace("$unit$", "Greg the Great");
		pName = pName.Replace("$warrior$", "Greg the Warrior");
		pName = pName.Replace("$language$", "Gregian Language");
		pName = pName.Replace("$religion$", "Gregianity");
		pName = pName.Replace("$subspecies$", "Gregian Sapient");
		pName = pName.Replace("$random_subspecies$", "Weird Dudes");
		pName = pName.Replace("$world_name$", "The Bad Place");
		pName = pName.Replace("$architect_name$", "Your Mom");
		pName = pName.Replace("$item$", "Legendary Greg Axe");
		if (pName.Contains('$'))
		{
			Debug.LogWarning((object)("replacer_debug missing variable " + pName));
		}
	}
}
// --- End of File: NameGeneratorReplacers.cs ---



// --- Start of File: NameGeneratorTests.cs ---
using System.Collections.Generic;
using System.IO;
using System.Linq;
using UnityEngine;
using UnityPools;

public static class NameGeneratorTests
{
	private static string _test_string;

	public static void runTests()
	{
	}

	public static string testAllNamesForUniqueness()
	{
		string text = "";
		foreach (NameGeneratorAsset item2 in AssetManager.name_generator.list)
		{
			HashSet<string> hashSet = new HashSet<string>();
			for (int i = 0; i < 1000; i++)
			{
				string item = NameGenerator.generateNameFromTemplate(item2);
				if (!hashSet.Contains(item))
				{
					hashSet.Add(item);
				}
			}
			text = text + "Unique names for asset " + item2.id + ": " + hashSet.Count + "\n";
		}
		return writeResults("name_test3_uniq", text);
	}

	public static string testAllNamesOutput()
	{
		string text = "";
		foreach (NameGeneratorAsset item in AssetManager.name_generator.list)
		{
			text = text + "\n--- asset name: " + item.id + " ---\n";
			text = text + NameGenerator.generateNamesFromTemplate(20, item, null, null, pForceLegacy: false, pTestReplacer: true) + "\n";
		}
		return writeResults("name_test3", text);
	}

	public static string testNamesAlliances()
	{
		testNameStart();
		testName("alliance_name");
		return testNameEnd();
	}

	public static string testNamesWars()
	{
		testNameStart();
		testName("war_conquest");
		testName("war_rebellion");
		testName("war_spite");
		testName("war_inspire");
		testName("war_whisper");
		return testNameEnd();
	}

	public static string testNamesItems()
	{
		testNameStart();
		testName("boots_name");
		testName("armor_name");
		testName("helmet_name");
		testName("ring_name");
		testName("amulet_name");
		return testNameEnd();
	}

	public static string testNamesWeapons()
	{
		testNameStart();
		testName("sword_name");
		testName("axe_name");
		testName("hammer_name");
		testName("stick_name");
		testName("blaster_name");
		testName("spear_name");
		testName("bow_name");
		testName("flame_sword_name");
		testName("necromancer_staff_name");
		testName("evil_staff_name");
		testName("white_staff_name");
		testName("plague_doctor_staff_name");
		testName("druid_staff_name");
		return testNameEnd();
	}

	public static void testNameStart()
	{
		_test_string = "";
	}

	public static string testNameEnd()
	{
		return writeResults("name_test2", _test_string);
	}

	public static void testName(string pID, int pAmount = 20)
	{
		_test_string = _test_string + "\n--- " + pID + ":\n";
		NameGeneratorAsset pAsset = AssetManager.name_generator.get(pID);
		_test_string = _test_string + NameGenerator.generateNamesFromTemplate(100, pAsset, null, null, pForceLegacy: false, pTestReplacer: true) + "\n";
	}

	public static string testNamesBooks()
	{
		testNameStart();
		using ListPool<string> listPool = new ListPool<string> { "book_name_fable", "book_name_biology", "book_name_math", "book_name_diplomacy_manual", "book_name_love_story", "book_name_bad_story", "book_name_warfare_manual", "book_name_economy_manual", "book_name_stewardship_manual", "book_name_history" };
		listPool.Shuffle();
		foreach (ref string item in listPool)
		{
			testName(item);
		}
		return testNameEnd();
	}

	public static string testNamesDefault()
	{
		string text = "";
		text += "\n--- default - legacy:\n";
		for (int i = 0; i < 100; i++)
		{
			text = text + NameGenerator.getName("orc_unit", ActorSex.Male, pForceLegacy: true) + "\n";
		}
		text += "\n--- default_name - onomastics:\n";
		for (int j = 0; j < 100; j++)
		{
			text = text + NameGenerator.getName("orc_unit") + "\n";
		}
		return writeResults("name_test_default", text);
	}

	public static string testNamesClans()
	{
		string text = "";
		text += "\n--- human_clan name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_clan")) + "\n";
		text += "\n--- elf_clan name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_clan")) + "\n";
		text += "\n--- dwarf_clan name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_clan")) + "\n";
		text += "\n--- orc_clan name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_clan")) + "\n";
		return writeResults("name_test2", text);
	}

	public static string testNamesKingdoms()
	{
		string text = "";
		text += "\n--- human_kingdom name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_kingdom")) + "\n";
		text += "\n--- elf_kingdom name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_kingdom")) + "\n";
		text += "\n--- dwarf_kingdom name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_kingdom")) + "\n";
		text += "\n--- orc_kingdom name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_kingdom")) + "\n";
		return writeResults("name_test2", text);
	}

	public static string testNamesCities()
	{
		string text = "";
		text += "\n--- human_city name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_city")) + "\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_city"), null, null, pForceLegacy: true) + "\n";
		text += "\n--- elf_city name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_city")) + "\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_city"), null, null, pForceLegacy: true) + "\n";
		text += "\n--- dwarf_city name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_city")) + "\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_city"), null, null, pForceLegacy: true) + "\n";
		text += "\n--- orc_city name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_city")) + "\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_city"), null, null, pForceLegacy: true) + "\n";
		return writeResults("name_test2", text);
	}

	public static string testNamesCulture()
	{
		string text = "";
		text += "\n--- elf_culture name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_culture")) + "\n";
		text += "\n--- dwarf_culture name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_culture")) + "\n";
		text += "\n--- orc_culture name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_culture")) + "\n";
		text += "\n--- human_culture name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_culture")) + "\n";
		return writeResults("name_test2", text);
	}

	public static string testMottos()
	{
		string text = "";
		text += "\n--- Mottos:\n";
		text = text + NameGenerator.generateNamesFromTemplate(100, AssetManager.name_generator.get("clan_mottos")) + "\n";
		return writeResults("name_test_mottos", text);
	}

	public static string testNames()
	{
		string text = "";
		text += "\n--- elf name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_unit")) + "\n";
		text += "\n--- elf City:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_city")) + "\n";
		text += "\n--- elf Kingdom:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("elf_kingdom")) + "\n";
		text += "\n--- dwarf name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_unit")) + "\n";
		text += "\n--- dwarf City:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_city")) + "\n";
		text += "\n--- dwarf Kingdom:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("dwarf_kingdom")) + "\n";
		text += "\n--- orc name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_unit")) + "\n";
		text += "\n--- orc City:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_city")) + "\n";
		text += "\n--- orc Kingdom:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("orc_kingdom")) + "\n";
		text += "\n--- Human name:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_unit")) + "\n";
		text += "\n--- Human City:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_city")) + "\n";
		text += "\n--- Human Kingdom:\n";
		text = text + NameGenerator.generateNamesFromTemplate(20, AssetManager.name_generator.get("human_kingdom")) + "\n";
		return writeResults("name_test2", text);
	}

	public static string testShowOnomasticsVsLegacy()
	{
		string text = "";
		string text2 = "[<color=green>ONO</color>]";
		string text3 = "[<color=orange>LEG</color>]";
		string text4 = "[<color=red>---</color>]";
		string text5 = "[<color=yellow>DIC</color>]";
		foreach (NameGeneratorAsset item in AssetManager.name_generator.list)
		{
			if ((!string.IsNullOrEmpty("") && !item.id.Contains("")) || "".Contains(item.id))
			{
				continue;
			}
			string text6 = text4;
			string text7 = text4;
			string text8 = text4;
			string text9 = " ";
			string text10 = " ";
			if (item.hasOnomastics())
			{
				text9 = "+";
				text7 = text2;
			}
			if (item.use_dictionary)
			{
				text6 = text5;
			}
			List<string[]> templates = item.templates;
			if (templates != null && templates.Count > 0)
			{
				text10 = "-";
				text8 = text3;
			}
			text = text + text9 + text10 + " " + text6 + " " + text7 + " " + text8 + " " + item.id + "\n";
			if (item.hasOnomastics())
			{
				List<string[]> templates2 = item.templates;
				if (templates2 != null && templates2.Count > 0)
				{
					text += compareOnomasticsVsLegacy(item.id, 15000);
				}
			}
		}
		return writeResults("name_test_ono", text);
	}

	public static string compareOnomasticsVsLegacy(string pNameAssetID, int pRuns)
	{
		string text = "";
		Randy.resetSeed(Randy.randomInt(1, 500));
		NameGeneratorAsset pAsset = AssetManager.name_generator.get(pNameAssetID);
		HashSet<string> hashSet = UnsafeCollectionPool<HashSet<string>, string>.Get();
		HashSet<string> hashSet2 = UnsafeCollectionPool<HashSet<string>, string>.Get();
		HashSet<string> hashSet3 = UnsafeCollectionPool<HashSet<string>, string>.Get();
		float realtimeSinceStartup = Time.realtimeSinceStartup;
		for (int i = 0; i < pRuns; i++)
		{
			hashSet.Add(NameGenerator.generateNameFromTemplate(pAsset, null, null, pForceLegacy: true).ToLowerInvariant());
		}
		float realtimeSinceStartup2 = Time.realtimeSinceStartup;
		float realtimeSinceStartup3 = Time.realtimeSinceStartup;
		for (int j = 0; j < pRuns; j++)
		{
			hashSet2.Add(NameGenerator.generateNameFromTemplate(pAsset).ToLowerInvariant());
		}
		float realtimeSinceStartup4 = Time.realtimeSinceStartup;
		int num = 0;
		int num2 = 0;
		int num3 = 0;
		foreach (string item10 in hashSet)
		{
			if (hashSet2.Contains(item10))
			{
				num3++;
				hashSet3.Add(item10);
			}
			else
			{
				num++;
			}
		}
		foreach (string item11 in hashSet2)
		{
			if (!hashSet.Contains(item11))
			{
				num2++;
			}
		}
		Dictionary<int, int> dictionary = new Dictionary<int, int>();
		Dictionary<int, int> dictionary2 = new Dictionary<int, int>();
		int num4 = int.MaxValue;
		int num5 = 0;
		foreach (string item12 in hashSet)
		{
			int length = item12.Length;
			if (length < num4)
			{
				num4 = length;
			}
			if (length > num5)
			{
				num5 = length;
			}
		}
		int num6 = int.MaxValue;
		int num7 = 0;
		foreach (string item13 in hashSet2)
		{
			int length2 = item13.Length;
			if (length2 < num6)
			{
				num6 = length2;
			}
			if (length2 > num7)
			{
				num7 = length2;
			}
		}
		int num8 = Mathf.Min(num4, num6);
		int num9 = Mathf.Max(num5, num7);
		for (int k = num8; k <= num9; k++)
		{
			dictionary[k] = 0;
			dictionary2[k] = 0;
		}
		foreach (string item14 in hashSet)
		{
			dictionary[item14.Length]++;
		}
		foreach (string item15 in hashSet2)
		{
			dictionary2[item15.Length]++;
		}
		float num10 = 100f * (float)num / (float)hashSet.Count;
		float num11 = 100f * (float)num2 / (float)hashSet2.Count;
		float num12 = 100f * (float)num3 / (float)hashSet.Count;
		string text2 = ((num10 < 25f) ? ("<color=green>" + num10.ToString("F2") + "%</color>") : ((num10 < 70f) ? ("<color=orange>" + num10.ToString("F2") + "%</color>") : ("<color=red>" + num10.ToString("F2") + "%</color>")));
		string text3 = ((num11 < 25f) ? ("<color=green>" + num11.ToString("F2") + "%</color>") : ((num11 < 70f) ? ("<color=orange>" + num11.ToString("F2") + "%</color>") : ("<color=red>" + num11.ToString("F2") + "%</color>")));
		string text4 = ((num12 < 25f) ? ("<color=red>" + num12.ToString("F2") + "%</color>") : ((num12 < 70f) ? ("<color=orange>" + num12.ToString("F2") + "%</color>") : ("<color=green>" + num12.ToString("F2") + "%</color>")));
		using ListPool<string[]> listPool = new ListPool<string[]>();
		listPool.Add(new string[2]
		{
			"Unique " + pNameAssetID + " :",
			pRuns + " runs"
		});
		listPool.Add(new string[4]
		{
			"Legacy :",
			hashSet.Count.ToString() ?? "",
			100 * hashSet.Count / hashSet2.Count + "%",
			(realtimeSinceStartup2 - realtimeSinceStartup).ToString("F2") + "s"
		});
		listPool.Add(new string[4]
		{
			"Ono :",
			hashSet2.Count.ToString() ?? "",
			100 * hashSet2.Count / hashSet.Count + "%",
			(realtimeSinceStartup4 - realtimeSinceStartup3).ToString("F2") + "s"
		});
		listPool.Add(new string[3]
		{
			"names only in legacy :",
			num.ToString() ?? "",
			text2
		});
		listPool.Add(new string[3]
		{
			"names only in ono :",
			num2.ToString() ?? "",
			text3
		});
		listPool.Add(new string[3]
		{
			"names in both :",
			num3.ToString() ?? "",
			text4
		});
		string text5 = ((num4 < num6) ? ("<color=red>" + num4 + "</color>") : num4.ToString());
		string text6 = ((num6 < num4) ? ("<color=red>" + num6 + "</color>") : num6.ToString());
		string text7 = ((num5 > num7) ? ("<color=red>" + num5 + "</color>") : num5.ToString());
		string text8 = ((num7 > num5) ? ("<color=red>" + num7 + "</color>") : num7.ToString());
		listPool.Add(new string[2]
		{
			"min/max len legacy :",
			text5 + "-" + text7
		});
		listPool.Add(new string[2]
		{
			"min/max len ono :",
			text6 + "-" + text8
		});
		text = text + "\n" + Toolbox.printRows(listPool);
		listPool.Clear();
		string[] second = dictionary.Select((KeyValuePair<int, int> p) => p.Key.ToString()).ToArray();
		string[] second2 = dictionary.Select((KeyValuePair<int, int> p) => p.Value.ToString()).ToArray();
		string[] second3 = dictionary2.Select((KeyValuePair<int, int> p) => p.Value.ToString()).ToArray();
		string[] item = new string[1] { "len dist" }.Concat(second).ToArray();
		string[] item2 = new string[1] { "legacy :" }.Concat(second2).ToArray();
		string[] item3 = new string[1] { "ono :" }.Concat(second3).ToArray();
		listPool.Add(item);
		listPool.Add(item2);
		listPool.Add(item3);
		text = text + "\n" + Toolbox.printRows(listPool);
		HashSet<string> hashSet4 = UnsafeCollectionPool<HashSet<string>, string>.Get();
		hashSet4.UnionWith(hashSet);
		hashSet4.ExceptWith(hashSet2);
		using ListPool<string> listPool2 = new ListPool<string>(hashSet4);
		listPool2.Sort();
		using ListPool<string> listPool3 = new ListPool<string>(91);
		using ListPool<string> listPool5 = new ListPool<string>(91);
		using ListPool<string> listPool7 = new ListPool<string>(91);
		if (listPool2.Count > 0)
		{
			listPool3.Add("Legacy");
			(string, string) tuple = findShortestLongest(listPool2);
			string item4 = tuple.Item1;
			string item5 = tuple.Item2;
			for (int l = 0; l < Mathf.Min(listPool2.Count, 30); l++)
			{
				listPool3.Add(listPool2.Shift());
			}
			for (int m = 0; m < Mathf.Min(listPool2.Count, 30); m++)
			{
				listPool3.Insert(Mathf.Min(31, listPool3.Count), listPool2.Pop());
			}
			int num13 = Mathf.Max(listPool2.Count / 2 - 15, 0);
			for (int n = 0; n < Mathf.Min(listPool2.Count, 30); n++)
			{
				listPool3.Insert(Mathf.Min(30 + n + 1, listPool3.Count), listPool2[n + num13]);
			}
			listPool3.Add(Toolbox.fillLeft("", item5.Length, '='));
			listPool3.Add("Min/Max");
			listPool3.Add(Toolbox.fillLeft("", item5.Length, '='));
			listPool3.Add(item5);
			listPool3.Add(item4);
		}
		HashSet<string> hashSet5 = UnsafeCollectionPool<HashSet<string>, string>.Get();
		hashSet5.UnionWith(hashSet2);
		hashSet5.ExceptWith(hashSet);
		using ListPool<string> listPool4 = new ListPool<string>(hashSet5);
		listPool4.Sort();
		if (listPool4.Count > 0)
		{
			listPool5.Add("Ono");
			(string, string) tuple2 = findShortestLongest(listPool4);
			string item6 = tuple2.Item1;
			string item7 = tuple2.Item2;
			for (int num14 = 0; num14 < Mathf.Min(listPool4.Count, 30); num14++)
			{
				listPool5.Add(listPool4.Shift());
			}
			for (int num15 = 0; num15 < Mathf.Min(listPool4.Count, 30); num15++)
			{
				listPool5.Insert(Mathf.Min(31, listPool5.Count), listPool4.Pop());
			}
			int num16 = Mathf.Max(listPool4.Count / 2 - 15, 0);
			for (int num17 = 0; num17 < Mathf.Min(listPool4.Count, 30); num17++)
			{
				listPool5.Insert(Mathf.Min(30 + num17 + 1, listPool5.Count), listPool4[num17 + num16]);
			}
			listPool5.Add(Toolbox.fillLeft("", item7.Length, '='));
			listPool5.Add("Min/Max");
			listPool5.Add(Toolbox.fillLeft("", item7.Length, '='));
			listPool5.Add(item7);
			listPool5.Add(item6);
		}
		using ListPool<string> listPool6 = new ListPool<string>(hashSet3);
		listPool6.Sort();
		if (listPool6.Count > 0)
		{
			listPool7.Add("Both");
			(string, string) tuple3 = findShortestLongest(listPool6);
			string item8 = tuple3.Item1;
			string item9 = tuple3.Item2;
			for (int num18 = 0; num18 < Mathf.Min(listPool6.Count, 30); num18++)
			{
				listPool7.Add(listPool6.Shift());
			}
			for (int num19 = 0; num19 < Mathf.Min(listPool6.Count, 30); num19++)
			{
				listPool7.Insert(Mathf.Min(31, listPool6.Count), listPool6.Pop());
			}
			int num20 = Mathf.Max(listPool6.Count / 2 - 15, 0);
			for (int num21 = 0; num21 < Mathf.Min(listPool6.Count, 30); num21++)
			{
				listPool7.Insert(Mathf.Min(30 + num21 + 1, listPool6.Count), listPool6[num21 + num20]);
			}
			listPool7.Add(Toolbox.fillLeft("", item9.Length, '='));
			listPool7.Add("Min/Max");
			listPool7.Add(Toolbox.fillLeft("", item9.Length, '='));
			listPool7.Add(item9);
			listPool7.Add(item8);
		}
		text = text + "\n" + Toolbox.printColumns(listPool3, listPool5, listPool7);
		UnsafeCollectionPool<HashSet<string>, string>.Release(hashSet4);
		UnsafeCollectionPool<HashSet<string>, string>.Release(hashSet5);
		UnsafeCollectionPool<HashSet<string>, string>.Release(hashSet);
		UnsafeCollectionPool<HashSet<string>, string>.Release(hashSet2);
		UnsafeCollectionPool<HashSet<string>, string>.Release(hashSet3);
		return text;
	}

	private static (string, string) findShortestLongest(ListPool<string> pHashSet)
	{
		string item = null;
		string item2 = null;
		int num = int.MinValue;
		int num2 = int.MaxValue;
		foreach (ref string item3 in pHashSet)
		{
			string current = item3;
			int length = current.Length;
			if (length > num)
			{
				num = length;
				item = current;
			}
			if (length < num2)
			{
				num2 = length;
				item2 = current;
			}
		}
		return (item2, item);
	}

	public static string writeResults(string pFilename, string pResults)
	{
		File.WriteAllText(Application.persistentDataPath + "/" + pFilename, pResults);
		Debug.Log((object)("Written result to " + pFilename + " in " + Application.persistentDataPath));
		return pResults;
	}
}
// --- End of File: NameGeneratorTests.cs ---



// --- Start of File: NameInput.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class NameInput : MonoBehaviour
{
	public InputField inputField;

	public Text textField;

	private string LastValue;

	public bool can_be_empty;

	public bool is_onomastics;

	private Outline _outline;

	private void Start()
	{
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Expected O, but got Unknown
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Expected O, but got Unknown
		textField.horizontalOverflow = (HorizontalWrapMode)0;
		if (is_onomastics)
		{
			inputField.onValidateInput = new OnValidateInput(validateOnomastics);
		}
		else
		{
			inputField.onValidateInput = new OnValidateInput(validate);
		}
	}

	private char validate(string pText, int pCharIndex, char pAddedChar)
	{
		if (pAddedChar == '<' || pAddedChar == '>')
		{
			return '\0';
		}
		return pAddedChar;
	}

	private char validateOnomastics(string pText, int pCharIndex, char pAddedChar)
	{
		char c = pAddedChar;
		bool flag = char.IsLetter(c);
		bool flag2 = char.IsWhiteSpace(c);
		bool flag3 = c == '\'';
		bool flag4 = pText.Length == 0;
		if (!(flag || flag2 || flag3))
		{
			return '\0';
		}
		if (flag4)
		{
			return char.ToUpper(c);
		}
		char num = pText[pText.Length - 1];
		bool flag5 = char.IsLetter(num);
		bool flag6 = char.IsWhiteSpace(num);
		bool flag7 = num == '\'';
		if (flag)
		{
			if (flag5)
			{
				c = char.ToLower(c);
			}
			else if (flag6)
			{
				c = char.ToUpper(c);
			}
		}
		else if (flag2)
		{
			if (flag6)
			{
				return '\0';
			}
		}
		else if (flag3 && flag7)
		{
			return '\0';
		}
		return c;
	}

	public void addListener(UnityAction<string> pAction)
	{
		((UnityEvent<string>)(object)inputField.onValueChanged).AddListener(pAction);
	}

	private void OnEnable()
	{
		((UnityEvent<string>)(object)inputField.onEndEdit).AddListener((UnityAction<string>)checkInput);
	}

	private void OnDisable()
	{
		((UnityEventBase)inputField.onEndEdit).RemoveAllListeners();
		if ((Object)(object)_outline != (Object)null)
		{
			((Behaviour)_outline).enabled = false;
		}
	}

	public void SetOutline()
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)_outline == (Object)null)
		{
			_outline = ((Component)inputField).gameObject.AddOrGetComponent<Outline>();
		}
		((Behaviour)_outline).enabled = true;
		Color color = ((Graphic)textField).color;
		Color effectColor = default(Color);
		((Color)(ref effectColor))._002Ector(color.r, color.g, color.b, 0.2f);
		((Shadow)_outline).effectColor = effectColor;
	}

	private void checkInput(string pInput)
	{
		if (string.IsNullOrWhiteSpace(pInput) && !can_be_empty)
		{
			inputField.text = LastValue;
		}
		else
		{
			LastValue = pInput;
		}
	}

	public void setText(string pText)
	{
		textField.text = pText;
		inputField.text = pText;
		LastValue = pText;
	}
}
// --- End of File: NameInput.cs ---



// --- Start of File: NameplateAction.cs ---
public delegate bool NameplateAction(Culture pCulture = null, Alliance pAlliance = null, Kingdom pKingdom = null, City pCity = null, Clan pClan = null);
// --- End of File: NameplateAction.cs ---



// --- Start of File: NameplateAsset.cs ---
using System;

[Serializable]
public class NameplateAsset : Asset
{
	public string path_sprite;

	public NameplateAction action;

	public NameplateBase action_main;

	public MetaType map_mode;

	public int padding_left = 12;

	public int padding_top;

	public int padding_right = 18;

	public float banner_only_mode_scale = 2f;

	public bool overlap_for_fluid_mode;

	public int max_nameplate_count = 100;
}
// --- End of File: NameplateAsset.cs ---



// --- Start of File: NameplateBase.cs ---
public delegate void NameplateBase(NameplateManager pManager, NameplateAsset pAsset);
// --- End of File: NameplateBase.cs ---



// --- Start of File: NameplateLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public class NameplateLibrary : AssetLibrary<NameplateAsset>
{
	public readonly Dictionary<MetaType, NameplateAsset> map_modes_nameplates = new Dictionary<MetaType, NameplateAsset>();

	private NameplateAsset _plate_kingdom;

	private NameplateAsset _plate_city;

	private const int OFFSET_UNIT_Y = -2;

	public override void init()
	{
		base.init();
		add(new NameplateAsset
		{
			id = "plate_subspecies",
			path_sprite = "ui/nameplates/nameplate_subspecies",
			padding_left = 11,
			padding_right = 13,
			banner_only_mode_scale = 1.8f,
			map_mode = MetaType.Subspecies,
			overlap_for_fluid_mode = true,
			action_main = actionSubspecies
		});
		add(new NameplateAsset
		{
			id = "plate_army",
			path_sprite = "ui/nameplates/nameplate_army",
			padding_left = 26,
			padding_right = 18,
			padding_top = -2,
			banner_only_mode_scale = 1.5f,
			map_mode = MetaType.Army,
			action_main = actionArmy
		});
		add(new NameplateAsset
		{
			id = "plate_family",
			path_sprite = "ui/nameplates/nameplate_family",
			padding_left = 11,
			padding_right = 13,
			banner_only_mode_scale = 1.5f,
			map_mode = MetaType.Family,
			overlap_for_fluid_mode = true,
			action_main = actionFamily
		});
		add(new NameplateAsset
		{
			id = "plate_religion",
			path_sprite = "ui/nameplates/nameplate_religion",
			padding_left = 11,
			padding_right = 13,
			map_mode = MetaType.Religion,
			action_main = actionReligion
		});
		add(new NameplateAsset
		{
			id = "plate_culture",
			path_sprite = "ui/nameplates/nameplate_culture",
			padding_left = 11,
			padding_right = 13,
			map_mode = MetaType.Culture,
			action_main = actionCulture
		});
		add(new NameplateAsset
		{
			id = "plate_language",
			path_sprite = "ui/nameplates/nameplate_language",
			padding_left = 11,
			padding_right = 13,
			map_mode = MetaType.Language,
			action_main = actionLanguage
		});
		add(new NameplateAsset
		{
			id = "plate_alliance",
			path_sprite = "ui/nameplates/nameplate_alliance",
			map_mode = MetaType.Alliance,
			banner_only_mode_scale = 3f,
			padding_left = 14,
			padding_top = 2,
			action_main = actionAlliance
		});
		_plate_kingdom = add(new NameplateAsset
		{
			id = "plate_kingdom",
			path_sprite = "ui/nameplates/nameplate_kingdom",
			padding_left = 26,
			padding_right = 26,
			padding_top = -2,
			banner_only_mode_scale = 2.5f,
			map_mode = MetaType.Kingdom,
			action_main = actionKingdom
		});
		_plate_city = add(new NameplateAsset
		{
			id = "plate_city",
			path_sprite = "ui/nameplates/nameplate_city",
			map_mode = MetaType.City,
			banner_only_mode_scale = 2.5f,
			padding_left = 6,
			padding_right = 7,
			padding_top = -2,
			action_main = actionCity
		});
		add(new NameplateAsset
		{
			id = "plate_clan",
			path_sprite = "ui/nameplates/nameplate_clan",
			map_mode = MetaType.Clan,
			padding_left = 17,
			padding_right = 24,
			action_main = actionClan
		});
	}

	private bool isWithinCamera(Vector2 pVector)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		return World.world.move_camera.isWithinCameraViewNotPowerBar(pVector);
	}

	public override NameplateAsset add(NameplateAsset pAsset)
	{
		map_modes_nameplates.Add(pAsset.map_mode, pAsset);
		return base.add(pAsset);
	}

	private void actionAlliance(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_012f: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		foreach (Alliance alliance in World.world.alliances)
		{
			City city = null;
			Kingdom kingdom = null;
			foreach (Kingdom item in alliance.kingdoms_hashset)
			{
				if (item.hasCapital() && isWithinCamera(item.capital.city_center) && (kingdom == null || kingdom.power < item.power))
				{
					kingdom = item;
				}
			}
			if (kingdom != null && kingdom.hasCapital())
			{
				city = kingdom.capital;
			}
			if (city != null)
			{
				pManager.prepareNext(pAsset, alliance).showTextAlliance(alliance, city);
			}
		}
		foreach (Kingdom kingdom2 in World.world.kingdoms)
		{
			if (kingdom2.hasCapital() && !kingdom2.hasAlliance() && isWithinCamera(kingdom2.capital.city_center))
			{
				if (num >= pAsset.max_nameplate_count)
				{
					break;
				}
				num++;
				pManager.prepareNext(_plate_kingdom, kingdom2).showTextKingdom(kingdom2, kingdom2.capital.city_center);
			}
		}
	}

	private void actionReligion(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		switch (MetaTypeLibrary.religion.getZoneOptionState())
		{
		case 0:
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				if (kingdom.hasReligion() && kingdom.hasCapital() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, kingdom.religion).showTextReligion(kingdom.religion, Vector2.op_Implicit(kingdom.capital.city_center));
				}
			}
			return;
		}
		case 1:
		{
			foreach (City city in World.world.cities)
			{
				if (city.hasReligion())
				{
					Religion religion = city.getReligion();
					if (isWithinCamera(city.city_center))
					{
						pManager.prepareNext(pAsset, religion).showTextReligion(religion, Vector2.op_Implicit(city.city_center));
					}
				}
			}
			return;
		}
		}
		foreach (Religion religion2 in World.world.religions)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			if (getPositionForMeta(religion2, out var pPosition))
			{
				pManager.prepareNext(pAsset, religion2).showTextReligion(religion2, pPosition);
				num++;
			}
		}
	}

	private void actionLanguage(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		switch (MetaTypeLibrary.language.getZoneOptionState())
		{
		case 0:
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				if (kingdom.hasLanguage() && kingdom.hasCapital() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, kingdom.language).showTextLanguage(kingdom.language, Vector2.op_Implicit(kingdom.capital.city_center));
				}
			}
			return;
		}
		case 1:
		{
			foreach (City city in World.world.cities)
			{
				if (city.hasLanguage())
				{
					Language language = city.getLanguage();
					if (isWithinCamera(city.city_center))
					{
						pManager.prepareNext(pAsset, language).showTextLanguage(language, Vector2.op_Implicit(city.city_center));
					}
				}
			}
			return;
		}
		}
		foreach (Language language2 in World.world.languages)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			if (getPositionForMeta(language2, out var pPosition))
			{
				pManager.prepareNext(pAsset, language2).showTextLanguage(language2, pPosition);
				num++;
			}
		}
	}

	private void actionCulture(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		switch (MetaTypeLibrary.culture.getZoneOptionState())
		{
		case 0:
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				if (kingdom.hasCulture() && kingdom.hasCapital() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, kingdom.culture).showTextCulture(kingdom.culture, Vector2.op_Implicit(kingdom.capital.city_center));
				}
			}
			return;
		}
		case 1:
		{
			foreach (City city in World.world.cities)
			{
				if (city.hasCulture())
				{
					Culture culture = city.getCulture();
					if (isWithinCamera(city.city_center))
					{
						pManager.prepareNext(pAsset, culture).showTextCulture(culture, Vector2.op_Implicit(city.city_center));
					}
				}
			}
			return;
		}
		}
		foreach (Culture culture2 in World.world.cultures)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			if (getPositionForMeta(culture2, out var pPosition))
			{
				pManager.prepareNext(pAsset, culture2).showTextCulture(culture2, pPosition);
				num++;
			}
		}
	}

	private void actionCity(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		using ListPool<City> listPool = new ListPool<City>(World.world.cities.list);
		listPool.Sort(sortByMembers);
		if (MetaTypeLibrary.city.getZoneOptionState() == 0)
		{
			foreach (ref City item in listPool)
			{
				City current = item;
				if (num >= pAsset.max_nameplate_count)
				{
					break;
				}
				if (isWithinCamera(current.city_center))
				{
					pManager.prepareNext(_plate_city, current).showTextCity(current, current.city_center);
					num++;
				}
			}
			return;
		}
		foreach (City city in World.world.cities)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			Actor pForceActor = null;
			if (city.hasLeader() && !city.leader.isRekt() && city.leader.is_visible)
			{
				pForceActor = city.leader;
			}
			if (getPositionForMeta(city, out var pPosition, pForceActor))
			{
				pManager.prepareNext(pAsset, city).showTextCity(city, Vector2.op_Implicit(pPosition));
				num++;
			}
		}
	}

	private void actionKingdom(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		if (MetaTypeLibrary.kingdom.getZoneOptionState() == 0)
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				if (kingdom.hasCapital() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, kingdom).showTextKingdom(kingdom, kingdom.capital.city_center);
				}
			}
			return;
		}
		foreach (Kingdom kingdom2 in World.world.kingdoms)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			Actor pForceActor = null;
			if (kingdom2.hasKing() && !kingdom2.king.isRekt() && kingdom2.king.is_visible)
			{
				pForceActor = kingdom2.king;
			}
			if (getPositionForMeta(kingdom2, out var pPosition, pForceActor))
			{
				pManager.prepareNext(pAsset, kingdom2).showTextKingdom(kingdom2, Vector2.op_Implicit(pPosition));
				num++;
			}
		}
	}

	private void actionSubspecies(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		switch (MetaTypeLibrary.subspecies.getZoneOptionState())
		{
		case 0:
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				Subspecies mainSubspecies2 = kingdom.getMainSubspecies();
				if (!mainSubspecies2.isRekt() && kingdom.hasCapital() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, mainSubspecies2).showTextSubspecies(mainSubspecies2, Vector2.op_Implicit(kingdom.capital.city_center));
				}
			}
			return;
		}
		case 1:
		{
			foreach (City city in World.world.cities)
			{
				Subspecies mainSubspecies = city.getMainSubspecies();
				if (!mainSubspecies.isRekt() && isWithinCamera(city.city_center))
				{
					pManager.prepareNext(pAsset, mainSubspecies).showTextSubspecies(mainSubspecies, Vector2.op_Implicit(city.city_center));
				}
			}
			return;
		}
		}
		foreach (Subspecies subspecy in World.world.subspecies)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			if (getPositionForMeta(subspecy, out var pPosition))
			{
				pManager.prepareNext(pAsset, subspecy).showTextSubspecies(subspecy, pPosition);
				num++;
			}
		}
	}

	private bool getPositionForMeta(IMetaObject pMetaObject, out Vector3 pPosition, Actor pForceActor = null)
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		if (!pMetaObject.isAlive() || !pMetaObject.hasUnits())
		{
			pPosition = Vector3.zero;
			return false;
		}
		Actor actor = pForceActor;
		if (actor == null)
		{
			actor = pMetaObject.getOldestVisibleUnitForNameplatesCached();
		}
		if (actor == null)
		{
			pPosition = Vector3.zero;
			return false;
		}
		Vector3 val = Vector2.op_Implicit(actor.current_position);
		val.y += actor.getHeight();
		val.y += -2f;
		pPosition = val;
		return true;
	}

	private int sortByMembers(IMetaObject pObject1, IMetaObject pObject2)
	{
		int num = pObject2.isFavorite().CompareTo(pObject1.isFavorite());
		if (num != 0)
		{
			return num;
		}
		int num2 = pObject2.isSelected().CompareTo(pObject1.isSelected());
		if (num2 != 0)
		{
			return num2;
		}
		return pObject2.countUnits().CompareTo(pObject1.countUnits());
	}

	private void actionArmy(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		MetaTypeLibrary.army.getZoneOptionState();
		using ListPool<Army> listPool = new ListPool<Army>(World.world.armies.list);
		listPool.Sort(sortByMembers);
		int num = 0;
		foreach (ref Army item in listPool)
		{
			Army current = item;
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			Actor pForceActor = null;
			if (current.hasCaptain())
			{
				pForceActor = current.getCaptain();
			}
			if (getPositionForMeta(current, out var pPosition, pForceActor))
			{
				pManager.prepareNext(pAsset, current).showTextArmy(current, pPosition);
				num++;
			}
		}
	}

	private void actionFamily(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0114: Unknown result type (might be due to invalid IL or missing references)
		//IL_0199: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		switch (MetaTypeLibrary.family.getZoneOptionState())
		{
		case 0:
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				if (kingdom.hasCapital() && kingdom.hasKing() && kingdom.king.hasFamily() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, kingdom.king.family).showTextFamily(kingdom.king.family, Vector2.op_Implicit(kingdom.capital.city_center));
				}
			}
			return;
		}
		case 1:
		{
			foreach (City city in World.world.cities)
			{
				if (city.hasLeader() && city.leader.hasFamily())
				{
					Family family = city.leader.family;
					if (family != null && isWithinCamera(city.city_center))
					{
						pManager.prepareNext(pAsset, family).showTextFamily(family, Vector2.op_Implicit(city.city_center));
					}
				}
			}
			return;
		}
		}
		using ListPool<Family> listPool = new ListPool<Family>(World.world.families.list);
		listPool.Sort(sortByMembers);
		foreach (ref Family item in listPool)
		{
			Family current3 = item;
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			if (getPositionForMeta(current3, out var pPosition))
			{
				pManager.prepareNext(pAsset, current3).showTextFamily(current3, pPosition);
				num++;
			}
		}
	}

	private void actionClan(NameplateManager pManager, NameplateAsset pAsset)
	{
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0144: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		switch (MetaTypeLibrary.clan.getZoneOptionState())
		{
		case 0:
		{
			foreach (Kingdom kingdom in World.world.kingdoms)
			{
				if (kingdom.hasCapital() && kingdom.hasKing() && kingdom.king.hasClan() && isWithinCamera(kingdom.capital.city_center))
				{
					pManager.prepareNext(pAsset, kingdom.king.clan).showTextClanCity(kingdom.king.clan, kingdom.capital);
				}
			}
			return;
		}
		case 1:
		{
			foreach (City city in World.world.cities)
			{
				Clan royalClan = city.getRoyalClan();
				if (royalClan != null && isWithinCamera(city.city_center))
				{
					pManager.prepareNext(pAsset, royalClan).showTextClanCity(royalClan, city);
				}
			}
			return;
		}
		}
		foreach (Clan clan in World.world.clans)
		{
			if (num >= pAsset.max_nameplate_count)
			{
				break;
			}
			if (getPositionForMeta(clan, out var pPosition))
			{
				pManager.prepareNext(pAsset, clan).showTextClanFluid(clan, pPosition);
				num++;
			}
		}
	}
}
// --- End of File: NameplateLibrary.cs ---



// --- Start of File: NameplateManager.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class NameplateManager : MonoBehaviour
{
	private readonly Stack<NameplateText> _pool = new Stack<NameplateText>();

	private readonly List<NameplateText> _active = new List<NameplateText>();

	private int _next_index;

	public NameplateText prefab;

	private Canvas _canvas;

	internal CanvasScaler canvas_scaler;

	internal RectTransform canvas_rect;

	internal Vector2 canvas_size_delta;

	internal float canvas_size_delta_mod_x;

	internal float canvas_size_delta_mod_y;

	private MetaType _last_mode;

	public NameplateText cursor_over_text;

	private int _latest_touch_id;

	private bool _touch_released;

	private float _tween_timer;

	private float _tween_scale;

	internal bool cached_favorites_only;

	internal float cached_canvas_scale;

	private NameplateRenderingType _nameplate_mode;

	private bool _nano_object_set;

	private NanoObject _selected_nano_object;

	private void Awake()
	{
		_canvas = ((Component)this).GetComponent<Canvas>();
		canvas_rect = ((Component)_canvas).GetComponent<RectTransform>();
		canvas_scaler = ((Component)this).GetComponent<CanvasScaler>();
	}

	private void prepare()
	{
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		_next_index = 0;
		_nameplate_mode = ((PlayerConfig.getOptionInt("map_names") == 0) ? NameplateRenderingType.Full : NameplateRenderingType.BannerOnly);
		_nano_object_set = SelectedObjects.isNanoObjectSet();
		_selected_nano_object = SelectedObjects.getSelectedNanoObject();
		cached_favorites_only = PlayerConfig.optionBoolEnabled("only_favorited_meta");
		canvas_size_delta = canvas_rect.sizeDelta;
		cached_canvas_scale = canvas_scaler.scaleFactor;
		canvas_size_delta_mod_x = canvas_size_delta.x * 0.5f;
		canvas_size_delta_mod_y = canvas_size_delta.y * 0.5f;
	}

	internal void update()
	{
		Bench.bench("nameplates", "nameplates_total");
		Bench.bench("prepare", "nameplates");
		prepare();
		Bench.benchEnd("prepare", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("check_mode", "nameplates");
		MetaType currentMode = getCurrentMode();
		setMode(currentMode);
		NameplateAsset nameplateAsset = null;
		MetaTypeAsset metaTypeAsset = null;
		if (!currentMode.isNone())
		{
			nameplateAsset = AssetManager.nameplates_library.map_modes_nameplates[currentMode];
			metaTypeAsset = currentMode.getAsset();
		}
		Bench.benchEnd("check_mode", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("set_nameplates", "nameplates");
		if (CanvasMain.isNameplatesAllowed())
		{
			if (currentMode == MetaType.None)
			{
				if (((Component)this).gameObject.activeSelf)
				{
					((Component)this).gameObject.SetActive(false);
				}
			}
			else
			{
				if (!((Component)this).gameObject.activeSelf)
				{
					((Component)this).gameObject.SetActive(true);
				}
				nameplateAsset.action_main(this, nameplateAsset);
			}
		}
		Bench.benchEnd("set_nameplates", "nameplates", pSaveCounter: false, _active.Count);
		Bench.bench("updateOverlappingPositions", "nameplates");
		bool flag = false;
		if (!currentMode.isNone() && metaTypeAsset != null)
		{
			if (metaTypeAsset.isMetaZoneOptionSelectedFluid())
			{
				if (nameplateAsset.overlap_for_fluid_mode)
				{
					flag = true;
				}
			}
			else
			{
				flag = true;
			}
		}
		if (flag)
		{
			updateOverlappingPosition();
		}
		Bench.benchEnd("updateOverlappingPositions", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("updateTweenScale", "nameplates");
		updateTweenScale();
		Bench.benchEnd("updateTweenScale", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("checkActive", "nameplates");
		checkActive();
		Bench.benchEnd("checkActive", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("findObjectForTooltip", "nameplates");
		NanoObject nanoObject = findObjectForTooltip();
		Bench.benchEnd("findObjectForTooltip", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("showTooltip", "nameplates");
		nanoObject?.getMetaTypeAsset().cursor_tooltip_action(nanoObject);
		Bench.benchEnd("showTooltip", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("check_siblings", "nameplates");
		checkSiblingsToFront();
		Bench.benchEnd("check_siblings", "nameplates", pSaveCounter: false, 0L);
		Bench.bench("finale", "nameplates");
		finale();
		Bench.benchEnd("finale", "nameplates", pSaveCounter: false, 0L);
		Bench.benchEnd("nameplates", "nameplates_total", pSaveCounter: false, 0L);
	}

	private void checkSiblingsToFront()
	{
		if ((Object)(object)cursor_over_text != (Object)null)
		{
			((Component)cursor_over_text).transform.SetAsLastSibling();
		}
		if (!SelectedObjects.isNanoObjectSet())
		{
			return;
		}
		foreach (NameplateText item in _active)
		{
			if (item.nano_object == SelectedObjects.getSelectedNanoObject())
			{
				((Component)item).transform.SetAsLastSibling();
				break;
			}
		}
	}

	private void checkActive()
	{
		for (int num = _next_index - 1; num >= 0; num--)
		{
			_active[num].checkActive();
		}
	}

	private void updateTweenScale()
	{
		_tween_timer += Time.deltaTime * 2f;
		_tween_timer = Mathf.Clamp(_tween_timer, 0f, 1f);
		float num = iTween.easeOutBack(0f, 1f, _tween_timer);
		num *= 0.5f;
		_tween_scale = num;
	}

	private NanoObject findObjectForTooltip()
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0129: Unknown result type (might be due to invalid IL or missing references)
		//IL_012b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0132: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Unknown result type (might be due to invalid IL or missing references)
		//IL_013f: Unknown result type (might be due to invalid IL or missing references)
		cursor_over_text = null;
		if (World.world.isBusyWithUI())
		{
			return null;
		}
		if (ControllableUnit.isControllingUnit())
		{
			return null;
		}
		if (!InputHelpers.mouseSupported && !checkTouch(out var pPosition))
		{
			return null;
		}
		pPosition = World.world.getMousePos();
		Vector2 val = Vector2.op_Implicit(World.world.camera.WorldToScreenPoint(Vector2.op_Implicit(pPosition)));
		bool mouseSupported = InputHelpers.mouseSupported;
		NanoObject result = null;
		float num = float.MaxValue;
		NameplateText nameplateText = null;
		for (int i = 0; i < _active.Count; i++)
		{
			NameplateText nameplateText2 = _active[i];
			if (nameplateText2.isShowing())
			{
				Vector2 lastScreenPosition = nameplateText2.getLastScreenPosition();
				float num2 = Toolbox.SquaredDist(lastScreenPosition.x, lastScreenPosition.y, val.x, val.y);
				if (((Rect)(ref nameplateText2.map_text_rect_click)).Contains(val) && (!((Object)(object)nameplateText != (Object)null) || (!(num2 > num) && !(num2 > 625f))))
				{
					nameplateText = nameplateText2;
					num = num2;
				}
			}
		}
		if ((Object)(object)nameplateText != (Object)null)
		{
			NanoObject nano_object = nameplateText.nano_object;
			if (Input.mousePresent)
			{
				result = nano_object;
			}
			cursor_over_text = nameplateText;
			Vector3 localScale = ((Component)nameplateText).transform.localScale;
			localScale *= 1.1f;
			cursor_over_text.forceScale(localScale);
			if (nano_object is IMetaObject && mouseSupported)
			{
				((IMetaObject)nano_object).setCursorOver();
			}
		}
		return result;
	}

	public bool isOverNameplate()
	{
		return (Object)(object)cursor_over_text != (Object)null;
	}

	private bool checkTouch(out Vector2 pPosition)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Invalid comparison between Unknown and I4
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		pPosition = Vector2.op_Implicit(Globals.POINT_IN_VOID);
		if (Input.touchCount == 0)
		{
			return false;
		}
		Touch val = Input.touches[0];
		if ((int)((Touch)(ref val)).phase == 0 && _touch_released)
		{
			_latest_touch_id = ((Touch)(ref val)).fingerId;
			_touch_released = false;
			return false;
		}
		if (((Touch)(ref val)).fingerId != _latest_touch_id || (int)((Touch)(ref val)).phase != 3 || _touch_released)
		{
			return false;
		}
		_touch_released = true;
		pPosition = Vector2.op_Implicit(World.world.camera.ScreenToWorldPoint(Vector2.op_Implicit(((Touch)(ref val)).position)));
		return true;
	}

	private MetaType getCurrentMode()
	{
		MetaType metaType = MetaType.None;
		if (Zones.showMapNames())
		{
			if (!Zones.hasPowerForceMapMode())
			{
				metaType = Zones.getCurrentMapBorderMode();
				if (metaType.isNone())
				{
					metaType = MetaType.City;
				}
			}
			else
			{
				metaType = Zones.getForcedMapMode();
			}
		}
		return metaType;
	}

	private void setMode(MetaType pMode)
	{
		if (_last_mode != pMode)
		{
			_last_mode = pMode;
			clearAll();
		}
	}

	private void updateOverlappingPosition()
	{
		if (_next_index <= 0)
		{
			return;
		}
		using ListPool<NameplateText> listPool = new ListPool<NameplateText>(_next_index);
		for (int i = 0; i < _next_index; i++)
		{
			NameplateText item = _active[i];
			listPool.Add(item);
		}
		if (listPool.Count <= 1)
		{
			return;
		}
		listPool.Sort(compareNameplates);
		using ListPool<NameplateText> listPool2 = new ListPool<NameplateText>(_next_index);
		foreach (ref NameplateText item2 in listPool)
		{
			NameplateText current = item2;
			bool flag = false;
			foreach (ref NameplateText item3 in listPool2)
			{
				NameplateText current2 = item3;
				if (current.overlapsWithOtherPlate(current2))
				{
					flag = true;
					break;
				}
			}
			if (flag)
			{
				current.setShowing(pVal: false);
			}
			else
			{
				listPool2.Add(current);
			}
		}
	}

	private void OnDrawGizmos()
	{
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		Camera main = Camera.main;
		if (!((Object)(object)main == (Object)null))
		{
			Vector3 val = default(Vector3);
			Vector3 val2 = default(Vector3);
			Vector3 val6 = default(Vector3);
			for (int i = 0; i < _next_index; i++)
			{
				NameplateText nameplateText = _active[i];
				Rect map_text_rect_overlap = nameplateText.map_text_rect_overlap;
				((Vector3)(ref val))._002Ector(((Rect)(ref map_text_rect_overlap)).xMin, ((Rect)(ref map_text_rect_overlap)).yMin, main.nearClipPlane);
				((Vector3)(ref val2))._002Ector(((Rect)(ref map_text_rect_overlap)).xMax, ((Rect)(ref map_text_rect_overlap)).yMax, main.nearClipPlane);
				Vector3 val3 = main.ScreenToWorldPoint(val);
				Vector3 val4 = main.ScreenToWorldPoint(val2);
				Vector3 val5 = (val3 + val4) * 0.5f;
				((Vector3)(ref val6))._002Ector(val4.x - val3.x, val4.y - val3.y, 0.1f);
				Gizmos.color = (nameplateText.isShowing() ? Color.green : Color.red);
				Gizmos.DrawWireCube(val5, val6);
			}
		}
	}

	private int compareNameplates(NameplateText pText1, NameplateText pText2)
	{
		NanoObject selectedNanoObject = SelectedObjects.getSelectedNanoObject();
		bool flag = pText1.nano_object == selectedNanoObject;
		bool flag2 = pText2.nano_object == selectedNanoObject;
		if (flag != flag2)
		{
			return (flag2 ? 1 : 0) - (flag ? 1 : 0);
		}
		if (pText1.favorited != pText2.favorited)
		{
			return (pText2.favorited ? 1 : 0) - (pText1.favorited ? 1 : 0);
		}
		if (pText1.priority_capital != pText2.priority_capital)
		{
			return (pText2.priority_capital ? 1 : 0) - (pText1.priority_capital ? 1 : 0);
		}
		int num = pText2.priority_population.CompareTo(pText1.priority_population);
		if (num != 0)
		{
			return num;
		}
		return pText1.nano_object.id.CompareTo(pText2.nano_object.id);
	}

	public NameplateText prepareNext(NameplateAsset pAsset, NanoObject pMeta)
	{
		NameplateText nameplateToRender = getNameplateToRender();
		nameplateToRender.prepare(pAsset, pMeta, _tween_scale, _nameplate_mode, _nano_object_set, _selected_nano_object);
		return nameplateToRender;
	}

	private NameplateText getNameplateToRender()
	{
		NameplateText nameplateText;
		if (_active.Count > _next_index)
		{
			nameplateText = _active[_next_index];
		}
		else
		{
			nameplateText = ((_pool.Count != 0) ? _pool.Pop() : createNew());
			_active.Add(nameplateText);
		}
		_next_index++;
		return nameplateText;
	}

	protected virtual NameplateText createNew()
	{
		NameplateText nameplateText = Object.Instantiate<NameplateText>(prefab, ((Component)this).transform);
		nameplateText.newNameplate(this, $"map text {_pool.Count + _active.Count}");
		return nameplateText;
	}

	internal void clearAll()
	{
		_tween_timer = 0.5f;
		_tween_scale = 0f;
		if (_active.Count != 0)
		{
			for (int i = 0; i < _active.Count; i++)
			{
				NameplateText nameplateText = _active[i];
				nameplateText.clearFull();
				((Component)nameplateText).gameObject.SetActive(false);
				_pool.Push(nameplateText);
			}
			_active.Clear();
		}
	}

	private void finale()
	{
		clearLast();
	}

	public void clearCaches()
	{
		foreach (NameplateText item in _active)
		{
			item.clearCaches();
		}
	}

	public void clearLast()
	{
		int num = _active.Count - _next_index;
		if (num > 0)
		{
			while (num > 0)
			{
				int index = _active.Count - 1;
				NameplateText nameplateText = _active[index];
				nameplateText.clearFull();
				((Component)nameplateText).gameObject.SetActive(false);
				_active.RemoveAt(index);
				_pool.Push(nameplateText);
				num--;
			}
		}
	}
}
// --- End of File: NameplateManager.cs ---



// --- Start of File: NameplateRenderingType.cs ---
public enum NameplateRenderingType
{
	Clear,
	Full,
	BannerOnly
}
// --- End of File: NameplateRenderingType.cs ---



// --- Start of File: NameplateText.cs ---
using UnityEngine;
using UnityEngine.UI;

public class NameplateText : MonoBehaviour
{
	private NameplateManager _manager;

	[SerializeField]
	private Image _icon_species;

	[SerializeField]
	private Image _icon_special;

	[SerializeField]
	private Image _icon_favorite;

	[SerializeField]
	private Image _background_image;

	[SerializeField]
	private KingdomBanner _banner_kingdoms;

	[SerializeField]
	private CultureBanner _banner_culture;

	[SerializeField]
	private LanguageBanner _banner_language;

	[SerializeField]
	private AllianceBanner _banner_alliance;

	[SerializeField]
	private ReligionBanner _banner_religion;

	[SerializeField]
	private SubspeciesBanner _banner_subspecies;

	[SerializeField]
	private FamilyBanner _banner_family;

	[SerializeField]
	private ClanBanner _banner_clan;

	[SerializeField]
	private ArmyBanner _banner_army;

	[SerializeField]
	private CityBanner _banner_city;

	[SerializeField]
	private RectTransform _container_capture;

	public HorizontalLayoutGroup layout_group;

	private NameplateAsset _asset;

	private bool _show_icon_species;

	private bool _show_icon_special;

	private bool _show_icon_favorite;

	private bool _show_banner_army;

	private bool _show_banner_kingdom;

	private bool _show_banner_culture;

	private bool _show_banner_alliance;

	private bool _show_banner_clan;

	private bool _show_banner_religion;

	private bool _show_banner_family;

	private bool _show_banner_subspecies;

	private bool _show_banner_language;

	private bool _show_banner_city;

	private bool _show_capture_counter;

	private CanvasGroup _canvas_group;

	[SerializeField]
	private RectTransform _rect_background;

	[SerializeField]
	private Text _text_name;

	[SerializeField]
	private Text _conquer_text;

	private RectTransform _rect;

	private RectTransform _text_rect;

	private bool _showing;

	internal bool priority_capital;

	internal int priority_population;

	internal bool favorited;

	internal Rect map_text_rect_click;

	internal Rect map_text_rect_overlap;

	public NanoObject nano_object;

	private float _last_scale;

	private string _old_text;

	private float _text_width;

	private bool _active_check_dirty;

	private NameplateRenderingType _last_mode;

	private Vector2 _last_position;

	private bool is_full => _last_mode == NameplateRenderingType.Full;

	public bool is_mini => _last_mode == NameplateRenderingType.BannerOnly;

	public Vector2 getLastScreenPosition()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		return _last_position;
	}

	private void Awake()
	{
		_rect = ((Component)this).GetComponent<RectTransform>();
		_text_rect = ((Component)_text_name).GetComponent<RectTransform>();
		_canvas_group = ((Component)this).GetComponent<CanvasGroup>();
	}

	public void prepare(NameplateAsset pAsset, NanoObject pMeta, float pGlobalScale, NameplateRenderingType pNameplateMode, bool pNanoObjectSet, NanoObject pSelectedNanoObject)
	{
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		if (pNanoObjectSet)
		{
			pNameplateMode = ((pSelectedNanoObject == pMeta) ? NameplateRenderingType.Full : NameplateRenderingType.BannerOnly);
		}
		if (pNameplateMode != _last_mode)
		{
			clearCaches();
			_active_check_dirty = true;
			_last_mode = pNameplateMode;
			switch (_last_mode)
			{
			case NameplateRenderingType.Full:
				((Component)_background_image).transform.localScale = new Vector3(1f, 1f, 1f);
				((Behaviour)_background_image).enabled = true;
				break;
			case NameplateRenderingType.BannerOnly:
				((Component)_background_image).transform.localScale = new Vector3(pAsset.banner_only_mode_scale, pAsset.banner_only_mode_scale, 1f);
				((Behaviour)_background_image).enabled = false;
				break;
			}
		}
		updateScale(pMeta, pGlobalScale, pNanoObjectSet, pSelectedNanoObject);
		resetElements();
		setShowing(pVal: true);
		setAssetAndMeta(pAsset, pMeta);
		if (((IFavoriteable)pMeta).isFavorite())
		{
			showFavoriteIcon();
		}
		else
		{
			_show_icon_favorite = false;
		}
		checkSetActive((Component)(object)_icon_favorite, _show_icon_favorite);
	}

	private void updateScale(NanoObject pMeta, float pGlobalScale, bool pNanoObjectSet, NanoObject pSelectedNanoObject)
	{
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		float num = pGlobalScale;
		if (pNanoObjectSet)
		{
			num = ((pSelectedNanoObject != pMeta) ? (pGlobalScale * 0.8f) : (pGlobalScale * 1.2f));
		}
		if (_last_scale != num)
		{
			_last_scale = num;
			((Component)this).transform.localScale = new Vector3(num, num, 1f);
		}
	}

	public void forceScale(Vector3 pScale)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		_last_scale = pScale.x;
		((Component)this).transform.localScale = pScale;
	}

	public void newNameplate(NameplateManager pManager, string pName)
	{
		clearFull();
		_manager = pManager;
		((Object)this).name = pName;
	}

	public bool isShowing()
	{
		return _showing;
	}

	public void setShowing(bool pVal)
	{
		_showing = pVal;
	}

	public void checkActive()
	{
		if (_showing)
		{
			if (!((Component)this).gameObject.activeSelf)
			{
				((Component)this).gameObject.SetActive(true);
			}
		}
		else if (((Component)this).gameObject.activeSelf)
		{
			((Component)this).gameObject.SetActive(false);
		}
		if (_showing && _active_check_dirty)
		{
			_active_check_dirty = false;
			checkActiveElements();
		}
	}

	private void checkActiveElements()
	{
		checkSetActive((Component)(object)_container_capture, _show_capture_counter);
		checkSetActive((Component)(object)_icon_species, _show_icon_species);
		checkSetActive((Component)(object)_icon_special, _show_icon_special);
		checkSetActive((Component)(object)_banner_alliance, _show_banner_alliance);
		checkSetActive((Component)(object)_banner_clan, _show_banner_clan);
		checkSetActive((Component)(object)_banner_culture, _show_banner_culture);
		checkSetActive((Component)(object)_banner_kingdoms, _show_banner_kingdom);
		checkSetActive((Component)(object)_banner_religion, _show_banner_religion);
		checkSetActive((Component)(object)_banner_family, _show_banner_family);
		checkSetActive((Component)(object)_banner_language, _show_banner_language);
		checkSetActive((Component)(object)_banner_subspecies, _show_banner_subspecies);
		checkSetActive((Component)(object)_banner_army, _show_banner_army);
		checkSetActive((Component)(object)_banner_city, _show_banner_city);
	}

	private void checkSetActive(Component pComponent, bool pShouldBeActive)
	{
		checkSetActive(pComponent.gameObject, pShouldBeActive);
	}

	private void checkSetActive(GameObject pObject, bool pShouldBeActive)
	{
		if (pShouldBeActive)
		{
			if (!pObject.activeSelf)
			{
				pObject.SetActive(true);
			}
		}
		else if (pObject.activeSelf)
		{
			pObject.SetActive(false);
		}
	}

	public void clearFull()
	{
		nano_object = null;
		clearCaches();
		setShowing(pVal: false);
		resetElements();
	}

	public void clearCaches()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		_asset = null;
		_last_position = Globals.POINT_IN_VOID_2;
		_last_scale = -1f;
		_old_text = "!";
		_last_mode = NameplateRenderingType.Clear;
	}

	private void resetElements()
	{
		priority_capital = false;
		priority_population = 0;
		favorited = false;
		_show_capture_counter = false;
		_show_icon_favorite = false;
		_show_icon_species = false;
		_show_icon_special = false;
		_show_banner_alliance = false;
		_show_banner_clan = false;
		_show_banner_culture = false;
		_show_banner_army = false;
		_show_banner_kingdom = false;
		_show_banner_religion = false;
		_show_banner_subspecies = false;
		_show_banner_language = false;
		_show_banner_family = false;
		_show_banner_city = false;
	}

	private void setupMeta(MetaObjectData pData, ColorAsset pColorAsset)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		favorited = pData.favorite;
		Color colorText = pColorAsset.getColorText();
		((Graphic)_text_name).color = colorText;
		updateAlpha(pData);
	}

	private void updateAlpha(MetaObjectData pData)
	{
		float num = ((!checkShouldDrawObject(pData)) ? 0.5f : 1f);
		if (_canvas_group.alpha != num)
		{
			_canvas_group.alpha = num;
		}
	}

	internal void showTextKingdom(Kingdom pMetaObject, Vector2 pPosition)
	{
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int populationPeople = pMetaObject.getPopulationPeople();
		string text = getStringForNameplate(pMetaObject.name, populationPeople);
		if (is_full)
		{
			if (DebugConfig.isOn(DebugOption.ShowWarriorsCityText))
			{
				text = text + " | " + pMetaObject.countTotalWarriors() + "/" + pMetaObject.countWarriorsMax();
			}
			if (DebugConfig.isOn(DebugOption.ShowCityWeaponsText))
			{
				text = text + " | w" + pMetaObject.countWeapons();
			}
		}
		setText(text, Vector2.op_Implicit(pPosition));
		setPriority(populationPeople);
		showSpecies(pMetaObject.getSpriteIcon());
		_show_banner_kingdom = true;
		_banner_kingdoms.load(pMetaObject);
		if (is_full)
		{
			Clan kingClan = pMetaObject.getKingClan();
			if (kingClan != null)
			{
				_show_banner_clan = true;
				_banner_clan.load(kingClan);
			}
		}
	}

	internal void showTextReligion(Religion pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, pPosition);
		setPriority(count);
		_show_banner_religion = true;
		_banner_religion.load(pMetaObject);
		showSpecies(pMetaObject.getActorAsset().getSpriteIcon());
	}

	internal void showTextSubspecies(Subspecies pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, pPosition);
		setPriority(count);
		_show_banner_subspecies = true;
		_banner_subspecies.load(pMetaObject);
		showSpecies(pMetaObject.getSpriteIcon());
	}

	internal void showTextFamily(Family pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, pPosition);
		setPriority(count);
		_show_banner_family = true;
		_banner_family.load(pMetaObject);
	}

	internal void showTextArmy(Army pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplateLine = getStringForNameplateLine(pMetaObject.name, count);
		setText(stringForNameplateLine, pPosition);
		setPriority(count);
		_show_banner_army = true;
		_banner_army.load(pMetaObject);
		if (pMetaObject.hasCaptain())
		{
			showSpecies(pMetaObject.getCaptain().getActorAsset().getSpriteIcon());
		}
		else
		{
			showSpecies(pMetaObject.getActorAsset().getSpriteIcon());
		}
	}

	internal void showTextCulture(Culture pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, pPosition);
		setPriority(count);
		_show_banner_culture = true;
		_banner_culture.load(pMetaObject);
		showSpecies(pMetaObject.getActorAsset().getSpriteIcon());
	}

	internal void showTextLanguage(Language pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, pPosition);
		setPriority(count);
		_show_banner_language = true;
		_banner_language.load(pMetaObject);
		showSpecies(pMetaObject.getActorAsset().getSpriteIcon());
	}

	internal void showTextAlliance(Alliance pMetaObject, City pCity)
	{
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int num = pMetaObject.countPopulation();
		_show_icon_species = false;
		string text = getStringForNameplate(pMetaObject.name, num);
		if (is_full && DebugConfig.isOn(DebugOption.ShowWarriorsCityText))
		{
			text = text + " | " + pMetaObject.countWarriors();
		}
		setText(text, Vector2.op_Implicit(pCity.city_center));
		setPriority(num);
		_show_banner_alliance = true;
		_banner_alliance.load(pMetaObject);
	}

	internal void showTextClanFluid(Clan pMetaObject, Vector3 pPosition)
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, pPosition);
		setPriority(count);
		_show_banner_clan = true;
		_banner_clan.load(pMetaObject);
		showSpecies(pMetaObject.getActorAsset().getSpriteIcon());
	}

	internal void showTextClanCity(Clan pMetaObject, City pCity)
	{
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.getColor());
		int count = pMetaObject.units.Count;
		string stringForNameplate = getStringForNameplate(pMetaObject.name, count);
		setText(stringForNameplate, Vector2.op_Implicit(pCity.city_center));
		setPriority(count);
		ActorAsset actorAsset = pMetaObject.getActorAsset();
		showSpecies(actorAsset.getSpriteIcon());
		_show_banner_clan = true;
		_banner_clan.load(pMetaObject);
	}

	internal void showTextCity(City pMetaObject, Vector2 pPosition)
	{
		//IL_011e: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0185: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f9: Unknown result type (might be due to invalid IL or missing references)
		setupMeta(pMetaObject.data, pMetaObject.kingdom.getColor());
		if (pMetaObject.isCapitalCity())
		{
			setNameplateSprite("ui/nameplates/nameplate_city_capital");
		}
		else
		{
			setNameplateSprite("ui/nameplates/nameplate_city");
		}
		int populationPeople = pMetaObject.getPopulationPeople();
		string text = getStringForNameplate(pMetaObject.name, populationPeople);
		if (is_full)
		{
			if (DebugConfig.isOn(DebugOption.ShowWarriorsCityText))
			{
				text = text + " | " + pMetaObject.countWarriors() + "/" + pMetaObject.getMaxWarriors();
				if (Config.isEditor)
				{
					string text2 = "  :  " + (int)(pMetaObject.getArmyMaxMultiplier() * 100f) + "%";
					text += text2;
				}
			}
			if (DebugConfig.isOn(DebugOption.ShowCityWeaponsText))
			{
				text = text + " | w" + pMetaObject.countWeapons();
			}
			if (DebugConfig.isOn(DebugOption.ShowFoodCityText))
			{
				text = text + " | F" + pMetaObject.getTotalFood();
			}
		}
		setText(text, Vector2.op_Implicit(pPosition));
		if (pMetaObject.getMainSubspecies() != null)
		{
			showSpecies(pMetaObject.getMainSubspecies().getActorAsset().getSpriteIcon());
		}
		if (pMetaObject.last_visual_capture_ticks != 0)
		{
			_show_capture_counter = true;
			_active_check_dirty = true;
			if (pMetaObject.being_captured_by != null && pMetaObject.being_captured_by.isAlive())
			{
				((Graphic)_conquer_text).color = pMetaObject.being_captured_by.getColor().getColorText();
			}
			_conquer_text.text = pMetaObject.last_visual_capture_ticks + "%";
		}
		else
		{
			_show_capture_counter = false;
			_active_check_dirty = true;
		}
		if (_show_capture_counter)
		{
			Vector2 anchoredPosition = default(Vector2);
			if (is_full)
			{
				((Vector2)(ref anchoredPosition))._002Ector(0f, -1f);
			}
			else
			{
				((Vector2)(ref anchoredPosition))._002Ector(3f, -25f);
			}
			_container_capture.anchoredPosition = anchoredPosition;
		}
		_show_banner_city = true;
		_banner_city.load(pMetaObject);
		priority_capital = pMetaObject.isCapitalCity();
		setPriority(populationPeople);
	}

	private void showSpecies(string pPath)
	{
		showSpecies(SpriteTextureLoader.getSprite(pPath));
	}

	private void showSpecies(Sprite pSprite)
	{
		if (!is_mini)
		{
			_show_icon_species = true;
			_icon_species.sprite = pSprite;
		}
	}

	public void showFavoriteIcon()
	{
		_show_icon_favorite = true;
	}

	private void showSpecial(string pPath)
	{
		_show_icon_special = true;
		_icon_special.sprite = SpriteTextureLoader.getSprite(pPath);
	}

	private void setText(string pNewText, Vector3 pPos, int pAdditionalWidth = 10)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		if (is_mini)
		{
			pAdditionalWidth = 0;
		}
		updatePositionAndRect(pPos);
		if (!(_old_text == pNewText))
		{
			_old_text = pNewText;
			_text_name.text = pNewText;
			_text_width = _text_name.preferredWidth + (float)pAdditionalWidth;
			float y = _rect_background.sizeDelta.y;
			_text_rect.sizeDelta = new Vector2(_text_width, y);
			_last_position = Globals.POINT_IN_VOID_2;
		}
	}

	private void updatePositionAndRect(Vector3 pPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = transformPosition(pPos);
		if (val != _last_position)
		{
			_last_position = val;
			((Component)this).transform.position = Vector2.op_Implicit(val);
			recalcScaledOverlapRect(_rect_background, ref map_text_rect_click);
			float num = ((Rect)(ref map_text_rect_click)).width * 0f * 0.5f;
			float num2 = ((Rect)(ref map_text_rect_click)).height * 0f * 0.5f;
			((Rect)(ref map_text_rect_overlap)).x = ((Rect)(ref map_text_rect_click)).x + num;
			((Rect)(ref map_text_rect_overlap)).y = ((Rect)(ref map_text_rect_click)).y + num2;
			((Rect)(ref map_text_rect_overlap)).width = ((Rect)(ref map_text_rect_click)).width - num * 2f;
			((Rect)(ref map_text_rect_overlap)).height = ((Rect)(ref map_text_rect_click)).height - num2 * 2f;
		}
	}

	private string getStringForNameplate(string pName, int pCount)
	{
		if (is_mini)
		{
			return string.Empty;
		}
		return pName + " " + pCount;
	}

	private string getStringForNameplateLine(string pName, int pCount)
	{
		if (is_mini)
		{
			return string.Empty;
		}
		return pName + " - " + pCount;
	}

	public bool overlapsWithOtherPlate(NameplateText pText)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return ((Rect)(ref map_text_rect_overlap)).Overlaps(pText.map_text_rect_overlap);
	}

	private void recalcScaledOverlapRect(RectTransform pRectBackground, ref Rect pMapTextRect)
	{
		recalcScaledOverlapRectSimple(pRectBackground, ref pMapTextRect);
	}

	private void recalcScaledOverlapRectCorners(RectTransform pRectBackground, ref Rect pMapTextRect)
	{
		Vector3[] array = (Vector3[])(object)new Vector3[4];
		pRectBackground.GetWorldCorners(array);
		float num = Mathf.Min(new float[4]
		{
			array[0].x,
			array[1].x,
			array[2].x,
			array[3].x
		});
		float num2 = Mathf.Max(new float[4]
		{
			array[0].x,
			array[1].x,
			array[2].x,
			array[3].x
		});
		float num3 = Mathf.Min(new float[4]
		{
			array[0].y,
			array[1].y,
			array[2].y,
			array[3].y
		});
		float num4 = Mathf.Max(new float[4]
		{
			array[0].y,
			array[1].y,
			array[2].y,
			array[3].y
		});
		((Rect)(ref pMapTextRect)).x = num;
		((Rect)(ref pMapTextRect)).y = num3;
		((Rect)(ref pMapTextRect)).width = num2 - num;
		((Rect)(ref pMapTextRect)).height = num4 - num3;
	}

	private void recalcScaledOverlapRectSimple(RectTransform pRectBackground, ref Rect pMapTextRect)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		float cached_canvas_scale = _manager.cached_canvas_scale;
		Vector2 sizeDelta = pRectBackground.sizeDelta;
		if (is_mini)
		{
			((Vector2)(ref sizeDelta)).Set(60f, 60f);
		}
		float num = sizeDelta.x * 0.55f * cached_canvas_scale;
		float num2 = sizeDelta.y * 0.55f * cached_canvas_scale;
		Vector3 position = ((Transform)pRectBackground).position;
		((Rect)(ref pMapTextRect)).x = position.x - num * 0.5f;
		((Rect)(ref pMapTextRect)).y = position.y - num2 * 0.5f;
		((Rect)(ref pMapTextRect)).width = num;
		((Rect)(ref pMapTextRect)).height = num2;
	}

	private Vector2 transformPosition(Vector3 pVec)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.op_Implicit(World.world.camera.WorldToScreenPoint(pVec));
	}

	private bool checkShouldDrawObject(MetaObjectData pData)
	{
		if (_manager.cached_favorites_only && !pData.favorite)
		{
			return false;
		}
		return true;
	}

	public void setAssetAndMeta(NameplateAsset pAsset, NanoObject pNano)
	{
		nano_object = pNano;
		if (_asset != pAsset)
		{
			_active_check_dirty = true;
			_asset = pAsset;
			setNameplateSprite(pAsset.path_sprite);
			RectOffset padding = ((LayoutGroup)layout_group).padding;
			if (is_mini)
			{
				padding.left = 0;
				padding.right = 0;
			}
			else
			{
				padding.left = pAsset.padding_left;
				padding.right = pAsset.padding_right;
			}
			padding.top = pAsset.padding_top;
		}
	}

	public void setNameplateSprite(string pPath)
	{
		Sprite sprite = SpriteTextureLoader.getSprite(pPath);
		_background_image.sprite = sprite;
	}

	private void setPriority(int pValue)
	{
		priority_population = pValue;
	}
}
// --- End of File: NameplateText.cs ---



// --- Start of File: NameSetAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;

[Serializable]
public class NameSetAsset : Asset
{
	[DefaultValue("")]
	public string city = string.Empty;

	[DefaultValue("")]
	public string clan = string.Empty;

	[DefaultValue("")]
	public string culture = string.Empty;

	[DefaultValue("")]
	public string family = string.Empty;

	[DefaultValue("")]
	public string kingdom = string.Empty;

	[DefaultValue("")]
	public string language = string.Empty;

	[DefaultValue("")]
	public string unit = string.Empty;

	[DefaultValue("")]
	public string religion = string.Empty;

	public string get(MetaType pType)
	{
		return pType switch
		{
			MetaType.City => city, 
			MetaType.Clan => clan, 
			MetaType.Culture => culture, 
			MetaType.Family => family, 
			MetaType.Kingdom => kingdom, 
			MetaType.Language => language, 
			MetaType.Unit => unit, 
			MetaType.Religion => religion, 
			_ => null, 
		};
	}

	public static IEnumerable<MetaType> getTypes()
	{
		yield return MetaType.City;
		yield return MetaType.Clan;
		yield return MetaType.Culture;
		yield return MetaType.Family;
		yield return MetaType.Kingdom;
		yield return MetaType.Language;
		yield return MetaType.Unit;
		yield return MetaType.Religion;
	}
}
// --- End of File: NameSetAsset.cs ---



// --- Start of File: NameSetsLibrary.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class NameSetsLibrary : AssetLibrary<NameSetAsset>
{
	public override void init()
	{
		base.init();
		addHumanLike();
		addFantasyRaces();
		addAnimalRaces();
		addMobRaces();
	}

	private void addMobRaces()
	{
		add(new NameSetAsset
		{
			id = "default_set",
			city = "default_name",
			clan = "default_name",
			culture = "default_name",
			family = "default_name",
			kingdom = "default_name",
			language = "default_name",
			unit = "default_name",
			religion = "default_name"
		});
		add(new NameSetAsset
		{
			id = "cold_one_set",
			city = "cold_one_name",
			clan = "cold_one_name",
			culture = "cold_one_name",
			family = "cold_one_name",
			kingdom = "cold_one_name",
			language = "cold_one_name",
			unit = "cold_one_name",
			religion = "cold_one_name"
		});
		add(new NameSetAsset
		{
			id = "necromancer_set",
			city = "necromancer_name",
			clan = "necromancer_name",
			culture = "necromancer_name",
			family = "necromancer_name",
			kingdom = "necromancer_name",
			language = "necromancer_name",
			unit = "necromancer_name",
			religion = "necromancer_name"
		});
		add(new NameSetAsset
		{
			id = "druid_set",
			city = "flower_name",
			clan = "flower_name",
			culture = "flower_name",
			family = "flower_name",
			kingdom = "flower_name",
			language = "flower_name",
			unit = "flower_name",
			religion = "flower_name"
		});
		add(new NameSetAsset
		{
			id = "plague_doctor_set",
			city = "white_mage_name",
			clan = "white_mage_name",
			culture = "white_mage_name",
			family = "white_mage_name",
			kingdom = "white_mage_name",
			language = "white_mage_name",
			unit = "white_mage_name",
			religion = "white_mage_name"
		});
		add(new NameSetAsset
		{
			id = "white_mage_set",
			city = "white_mage_name",
			clan = "white_mage_name",
			culture = "white_mage_name",
			family = "white_mage_name",
			kingdom = "white_mage_name",
			language = "white_mage_name",
			unit = "white_mage_name",
			religion = "white_mage_name"
		});
		add(new NameSetAsset
		{
			id = "evil_mage_set",
			city = "evil_mage_name",
			clan = "evil_mage_name",
			culture = "evil_mage_name",
			family = "evil_mage_name",
			kingdom = "evil_mage_name",
			language = "evil_mage_name",
			unit = "evil_mage_name",
			religion = "evil_mage_name"
		});
		add(new NameSetAsset
		{
			id = "skeleton_set",
			city = "skeleton_name",
			clan = "skeleton_name",
			culture = "skeleton_name",
			family = "skeleton_name",
			kingdom = "skeleton_name",
			language = "skeleton_name",
			unit = "skeleton_name",
			religion = "skeleton_name"
		});
		add(new NameSetAsset
		{
			id = "jumpy_skull_set",
			city = "jumpy_skull_name",
			clan = "jumpy_skull_name",
			culture = "jumpy_skull_name",
			family = "jumpy_skull_name",
			kingdom = "jumpy_skull_name",
			language = "jumpy_skull_name",
			unit = "jumpy_skull_name",
			religion = "jumpy_skull_name"
		});
		add(new NameSetAsset
		{
			id = "fire_skull_set",
			city = "fire_skull_name",
			clan = "fire_skull_name",
			culture = "fire_skull_name",
			family = "fire_skull_name",
			kingdom = "fire_skull_name",
			language = "fire_skull_name",
			unit = "fire_skull_name",
			religion = "fire_skull_name"
		});
		add(new NameSetAsset
		{
			id = "demon_set",
			city = "demon_name",
			clan = "demon_name",
			culture = "demon_name",
			family = "demon_name",
			kingdom = "demon_name",
			language = "demon_name",
			unit = "demon_name",
			religion = "demon_name"
		});
		add(new NameSetAsset
		{
			id = "angle_set",
			city = "angle_name",
			clan = "angle_name",
			culture = "angle_name",
			family = "angle_name",
			kingdom = "angle_name",
			language = "angle_name",
			unit = "angle_name",
			religion = "angle_name"
		});
		add(new NameSetAsset
		{
			id = "fairy_set",
			city = "fairy_name",
			clan = "fairy_name",
			culture = "fairy_name",
			family = "fairy_name",
			kingdom = "fairy_name",
			language = "fairy_name",
			unit = "fairy_name",
			religion = "fairy_name"
		});
		add(new NameSetAsset
		{
			id = "bandit_set",
			city = "bandit_name",
			clan = "bandit_name",
			culture = "bandit_name",
			family = "bandit_name",
			kingdom = "bandit_name",
			language = "bandit_name",
			unit = "bandit_name",
			religion = "bandit_name"
		});
		add(new NameSetAsset
		{
			id = "snowman_set",
			city = "snowman_name",
			clan = "snowman_name",
			culture = "snowman_name",
			family = "snowman_name",
			kingdom = "snowman_name",
			language = "snowman_name",
			unit = "snowman_name",
			religion = "snowman_name"
		});
		add(new NameSetAsset
		{
			id = "alien_set",
			city = "alien_name",
			clan = "alien_name",
			culture = "alien_name",
			family = "alien_name",
			kingdom = "alien_name",
			language = "alien_name",
			unit = "alien_name",
			religion = "alien_name"
		});
		add(new NameSetAsset
		{
			id = "fire_elemental_set",
			city = "fire_elemental_name",
			clan = "fire_elemental_name",
			culture = "fire_elemental_name",
			family = "fire_elemental_name",
			kingdom = "fire_elemental_name",
			language = "fire_elemental_name",
			unit = "fire_elemental_name",
			religion = "fire_elemental_name"
		});
		add(new NameSetAsset
		{
			id = "pumpkin_set",
			city = "lil_pumpkin_name",
			clan = "lil_pumpkin_name",
			culture = "lil_pumpkin_name",
			family = "lil_pumpkin_name",
			kingdom = "lil_pumpkin_name",
			language = "lil_pumpkin_name",
			unit = "lil_pumpkin_name",
			religion = "lil_pumpkin_name"
		});
		add(new NameSetAsset
		{
			id = "assimilator_set",
			city = "assimilator_name",
			clan = "assimilator_name",
			culture = "assimilator_name",
			family = "assimilator_name",
			kingdom = "assimilator_name",
			language = "assimilator_name",
			unit = "assimilator_name",
			religion = "assimilator_name"
		});
		add(new NameSetAsset
		{
			id = "bioblob_set",
			city = "bioblob_name",
			clan = "bioblob_name",
			culture = "bioblob_name",
			family = "bioblob_name",
			kingdom = "bioblob_name",
			language = "bioblob_name",
			unit = "bioblob_name",
			religion = "bioblob_name"
		});
		add(new NameSetAsset
		{
			id = "greg_set",
			city = "greg_name",
			clan = "greg_name",
			culture = "greg_name",
			family = "greg_name",
			kingdom = "greg_name",
			language = "greg_name",
			unit = "greg_name",
			religion = "greg_name"
		});
		add(new NameSetAsset
		{
			id = "living_plant_set",
			city = "living_plant_name",
			clan = "living_plant_name",
			culture = "living_plant_name",
			family = "living_plant_name",
			kingdom = "living_plant_name",
			language = "living_plant_name",
			unit = "living_plant_name",
			religion = "living_plant_name"
		});
		add(new NameSetAsset
		{
			id = "living_house_set",
			city = "living_house_name",
			clan = "living_house_name",
			culture = "living_house_name",
			family = "living_house_name",
			kingdom = "living_house_name",
			language = "living_house_name",
			unit = "living_house_name",
			religion = "living_house_name"
		});
	}

	private void addAnimalRaces()
	{
		add(new NameSetAsset
		{
			id = "cat_set",
			city = "cat_name",
			clan = "cat_name",
			culture = "cat_name",
			family = "cat_name",
			kingdom = "cat_name",
			language = "cat_name",
			unit = "cat_name",
			religion = "cat_name"
		});
		add(new NameSetAsset
		{
			id = "wolf_set",
			city = "wolf_name",
			clan = "wolf_name",
			culture = "wolf_name",
			family = "wolf_name",
			kingdom = "wolf_name",
			language = "wolf_name",
			unit = "wolf_name",
			religion = "wolf_name"
		});
		add(new NameSetAsset
		{
			id = "fox_set",
			city = "fox_name",
			clan = "fox_name",
			culture = "fox_name",
			family = "fox_name",
			kingdom = "fox_name",
			language = "fox_name",
			unit = "fox_name",
			religion = "fox_name"
		});
		add(new NameSetAsset
		{
			id = "chicken_set",
			city = "chicken_name",
			clan = "chicken_name",
			culture = "chicken_name",
			family = "chicken_name",
			kingdom = "chicken_name",
			language = "chicken_name",
			unit = "chicken_name",
			religion = "chicken_name"
		});
		add(new NameSetAsset
		{
			id = "rabbit_set",
			city = "rabbit_name",
			clan = "rabbit_name",
			culture = "rabbit_name",
			family = "rabbit_name",
			kingdom = "rabbit_name",
			language = "rabbit_name",
			unit = "rabbit_name",
			religion = "rabbit_name"
		});
		add(new NameSetAsset
		{
			id = "monkey_set",
			city = "monkey_name",
			clan = "monkey_name",
			culture = "monkey_name",
			family = "monkey_name",
			kingdom = "monkey_name",
			language = "monkey_name",
			unit = "monkey_name",
			religion = "monkey_name"
		});
		add(new NameSetAsset
		{
			id = "sheep_set",
			city = "sheep_name",
			clan = "sheep_name",
			culture = "sheep_name",
			family = "sheep_name",
			kingdom = "sheep_name",
			language = "sheep_name",
			unit = "sheep_name",
			religion = "sheep_name"
		});
		add(new NameSetAsset
		{
			id = "cow_set",
			city = "cow_name",
			clan = "cow_name",
			culture = "cow_name",
			family = "cow_name",
			kingdom = "cow_name",
			language = "cow_name",
			unit = "cow_name",
			religion = "cow_name"
		});
		add(new NameSetAsset
		{
			id = "armadillo_set",
			city = "armadillo_name",
			clan = "armadillo_name",
			culture = "armadillo_name",
			family = "armadillo_name",
			kingdom = "armadillo_name",
			language = "armadillo_name",
			unit = "armadillo_name",
			religion = "armadillo_name"
		});
		add(new NameSetAsset
		{
			id = "bear_set",
			city = "bear_name",
			clan = "bear_name",
			culture = "bear_name",
			family = "bear_name",
			kingdom = "bear_name",
			language = "bear_name",
			unit = "bear_name",
			religion = "bear_name"
		});
		add(new NameSetAsset
		{
			id = "rhino_set",
			city = "rhino_name",
			clan = "rhino_name",
			culture = "rhino_name",
			family = "rhino_name",
			kingdom = "rhino_name",
			language = "rhino_name",
			unit = "rhino_name",
			religion = "rhino_name"
		});
		add(new NameSetAsset
		{
			id = "buffalo_set",
			city = "buffalo_name",
			clan = "buffalo_name",
			culture = "buffalo_name",
			family = "buffalo_name",
			kingdom = "buffalo_name",
			language = "buffalo_name",
			unit = "buffalo_name",
			religion = "buffalo_name"
		});
		add(new NameSetAsset
		{
			id = "rat_set",
			city = "rat_name",
			clan = "rat_name",
			culture = "rat_name",
			family = "rat_name",
			kingdom = "rat_name",
			language = "rat_name",
			unit = "rat_name",
			religion = "rat_name"
		});
		add(new NameSetAsset
		{
			id = "capybara_set",
			city = "capybara_name",
			clan = "capybara_name",
			culture = "capybara_name",
			family = "capybara_name",
			kingdom = "capybara_name",
			language = "capybara_name",
			unit = "capybara_name",
			religion = "capybara_name"
		});
		add(new NameSetAsset
		{
			id = "goat_set",
			city = "goat_name",
			clan = "goat_name",
			culture = "goat_name",
			family = "goat_name",
			kingdom = "goat_name",
			language = "goat_name",
			unit = "goat_name",
			religion = "goat_name"
		});
		add(new NameSetAsset
		{
			id = "raccoon_set",
			city = "raccoon_name",
			clan = "raccoon_name",
			culture = "raccoon_name",
			family = "raccoon_name",
			kingdom = "raccoon_name",
			language = "raccoon_name",
			unit = "raccoon_name",
			religion = "raccoon_name"
		});
		add(new NameSetAsset
		{
			id = "unicorn_set",
			city = "white_mage_name",
			clan = "white_mage_name",
			culture = "white_mage_name",
			family = "white_mage_name",
			kingdom = "white_mage_name",
			language = "white_mage_name",
			unit = "white_mage_name",
			religion = "white_mage_name"
		});
		add(new NameSetAsset
		{
			id = "seal_set",
			city = "default_name",
			clan = "default_name",
			culture = "default_name",
			family = "default_name",
			kingdom = "default_name",
			language = "default_name",
			unit = "default_name",
			religion = "default_name"
		});
		add(new NameSetAsset
		{
			id = "ostrich_set",
			city = "default_name",
			clan = "default_name",
			culture = "default_name",
			family = "default_name",
			kingdom = "default_name",
			language = "default_name",
			unit = "default_name",
			religion = "default_name"
		});
		add(new NameSetAsset
		{
			id = "scorpion_set",
			city = "scorpion_name",
			clan = "scorpion_name",
			culture = "scorpion_name",
			family = "scorpion_name",
			kingdom = "scorpion_name",
			language = "scorpion_name",
			unit = "scorpion_name",
			religion = "scorpion_name"
		});
		add(new NameSetAsset
		{
			id = "crab_set",
			city = "crab_name",
			clan = "crab_name",
			culture = "crab_name",
			family = "crab_name",
			kingdom = "crab_name",
			language = "crab_name",
			unit = "crab_name",
			religion = "crab_name"
		});
		add(new NameSetAsset
		{
			id = "penguin_set",
			city = "penguin_name",
			clan = "penguin_name",
			culture = "penguin_name",
			family = "penguin_name",
			kingdom = "penguin_name",
			language = "penguin_name",
			unit = "penguin_name",
			religion = "penguin_name"
		});
		add(new NameSetAsset
		{
			id = "turtle_set",
			city = "turtle_name",
			clan = "turtle_name",
			culture = "turtle_name",
			family = "turtle_name",
			kingdom = "turtle_name",
			language = "turtle_name",
			unit = "turtle_name",
			religion = "turtle_name"
		});
		add(new NameSetAsset
		{
			id = "crocodile_set",
			city = "crocodile_name",
			clan = "crocodile_name",
			culture = "crocodile_name",
			family = "crocodile_name",
			kingdom = "crocodile_name",
			language = "crocodile_name",
			unit = "crocodile_name",
			religion = "crocodile_name"
		});
		add(new NameSetAsset
		{
			id = "frog_set",
			city = "frog_name",
			clan = "frog_name",
			culture = "frog_name",
			family = "frog_name",
			kingdom = "frog_name",
			language = "frog_name",
			unit = "frog_name",
			religion = "frog_name"
		});
		add(new NameSetAsset
		{
			id = "piranha_set",
			city = "piranha_name",
			clan = "piranha_name",
			culture = "piranha_name",
			family = "piranha_name",
			kingdom = "piranha_name",
			language = "piranha_name",
			unit = "piranha_name",
			religion = "piranha_name"
		});
		add(new NameSetAsset
		{
			id = "flower_set",
			city = "flower_name",
			clan = "flower_name",
			culture = "flower_name",
			family = "flower_name",
			kingdom = "flower_name",
			language = "flower_name",
			unit = "flower_name",
			religion = "flower_name"
		});
		add(new NameSetAsset
		{
			id = "garlic_man_set",
			city = "garlic_name",
			clan = "garlic_name",
			culture = "garlic_name",
			family = "garlic_name",
			kingdom = "garlic_name",
			language = "garlic_name",
			unit = "garlic_name",
			religion = "garlic_name"
		});
		add(new NameSetAsset
		{
			id = "lemon_man_set",
			city = "lemon_name",
			clan = "lemon_name",
			culture = "lemon_name",
			family = "lemon_name",
			kingdom = "lemon_name",
			language = "lemon_name",
			unit = "lemon_name",
			religion = "lemon_name"
		});
		add(new NameSetAsset
		{
			id = "acid_blob_set",
			city = "acid_blob_name",
			clan = "acid_blob_name",
			culture = "acid_blob_name",
			family = "acid_blob_name",
			kingdom = "acid_blob_name",
			language = "acid_blob_name",
			unit = "acid_blob_name",
			religion = "acid_blob_name"
		});
		add(new NameSetAsset
		{
			id = "crystal_golem_set",
			city = "crystal_sword_name",
			clan = "crystal_sword_name",
			culture = "crystal_sword_name",
			family = "crystal_sword_name",
			kingdom = "crystal_sword_name",
			language = "crystal_sword_name",
			unit = "crystal_sword_name",
			religion = "crystal_sword_name"
		});
		add(new NameSetAsset
		{
			id = "crystal_sword_set",
			city = "crystal_sword_name",
			clan = "crystal_sword_name",
			culture = "crystal_sword_name",
			family = "crystal_sword_name",
			kingdom = "crystal_sword_name",
			language = "crystal_sword_name",
			unit = "crystal_sword_name",
			religion = "crystal_sword_name"
		});
		add(new NameSetAsset
		{
			id = "smore_set",
			city = "candy_name",
			clan = "candy_name",
			culture = "candy_name",
			family = "candy_name",
			kingdom = "candy_name",
			language = "candy_name",
			unit = "candy_name",
			religion = "candy_name"
		});
		add(new NameSetAsset
		{
			id = "insect_set",
			city = "bug_name",
			clan = "bug_name",
			culture = "bug_name",
			family = "bug_name",
			kingdom = "bug_name",
			language = "bug_name",
			unit = "bug_name",
			religion = "bug_name"
		});
		add(new NameSetAsset
		{
			id = "candy_man_set",
			city = "candy_name",
			clan = "candy_name",
			culture = "candy_name",
			family = "candy_name",
			kingdom = "candy_name",
			language = "candy_name",
			unit = "candy_name",
			religion = "candy_name"
		});
		add(new NameSetAsset
		{
			id = "alpaca_set",
			city = "alpaca_name",
			clan = "alpaca_name",
			culture = "alpaca_name",
			family = "alpaca_name",
			kingdom = "alpaca_name",
			language = "alpaca_name",
			unit = "alpaca_name",
			religion = "alpaca_name"
		});
		add(new NameSetAsset
		{
			id = "hyena_set",
			city = "hyena_city",
			clan = "hyena_name",
			culture = "hyena_name",
			family = "hyena_name",
			kingdom = "hyena_name",
			language = "hyena_name",
			unit = "hyena_name",
			religion = "hyena_name"
		});
		add(new NameSetAsset
		{
			id = "snake_set",
			city = "snake_city",
			clan = "snake_name",
			culture = "snake_name",
			family = "snake_name",
			kingdom = "snake_name",
			language = "snake_name",
			unit = "snake_name",
			religion = "snake_name"
		});
	}

	private void addFantasyRaces()
	{
		add(new NameSetAsset
		{
			id = "dwarf_default_set",
			city = "dwarf_city",
			clan = "dwarf_clan",
			culture = "dwarf_culture",
			family = "dwarf_clan",
			kingdom = "dwarf_kingdom",
			language = "dwarf_language",
			unit = "dwarf_unit",
			religion = "dwarf_religion"
		});
		add(new NameSetAsset
		{
			id = "dwarf_nordic_set",
			city = "nordic_city",
			clan = "nordic_clan",
			culture = "dwarf_culture",
			family = "nordic_clan",
			kingdom = "nordic_kingdom",
			language = "dwarf_language",
			unit = "nordic_unit",
			religion = "dwarf_religion"
		});
		add(new NameSetAsset
		{
			id = "elf_default_set",
			city = "elf_city",
			clan = "elf_clan",
			culture = "elf_culture",
			family = "elf_clan",
			kingdom = "elf_kingdom",
			language = "elf_language",
			unit = "elf_unit",
			religion = "elf_religion"
		});
		add(new NameSetAsset
		{
			id = "orc_default_set",
			city = "orc_city",
			clan = "orc_clan",
			culture = "orc_culture",
			family = "orc_clan",
			kingdom = "orc_kingdom",
			language = "orc_language",
			unit = "orc_unit",
			religion = "orc_religion"
		});
	}

	private void addHumanLike()
	{
		add(new NameSetAsset
		{
			id = "human_default_set",
			city = "human_city",
			clan = "human_clan",
			culture = "human_culture",
			family = "human_clan",
			kingdom = "human_kingdom",
			language = "human_language",
			unit = "human_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_slavic_set",
			city = "slavic_city",
			clan = "slavic_clan",
			culture = "human_culture",
			family = "slavic_clan",
			kingdom = "slavic_kingdom",
			language = "human_language",
			unit = "slavic_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_germanic_set",
			city = "germanic_city",
			clan = "germanic_clan",
			culture = "human_culture",
			family = "germanic_clan",
			kingdom = "germanic_kingdom",
			language = "human_language",
			unit = "germanic_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_rus_set",
			city = "rus_city",
			clan = "rus_clan",
			culture = "human_culture",
			family = "rus_clan",
			kingdom = "rus_kingdom",
			language = "human_language",
			unit = "rus_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_posh_set",
			city = "posh_city",
			clan = "posh_clan",
			culture = "human_culture",
			family = "posh_clan",
			kingdom = "posh_kingdom",
			language = "human_language",
			unit = "posh_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_folk_set",
			city = "folk_city",
			clan = "folk_clan",
			culture = "human_culture",
			family = "folk_clan",
			kingdom = "folk_kingdom",
			language = "human_language",
			unit = "folk_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_pomeranian_set",
			city = "pomeranian_city",
			clan = "pomeranian_clan",
			culture = "human_culture",
			family = "pomeranian_clan",
			kingdom = "pomeranian_kingdom",
			language = "human_language",
			unit = "pomeranian_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_frankish_set",
			city = "frankish_city",
			clan = "frankish_clan",
			culture = "human_culture",
			family = "frankish_clan",
			kingdom = "frankish_kingdom",
			language = "human_language",
			unit = "frankish_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_rome_set",
			city = "rome_city",
			clan = "rome_clan",
			culture = "human_culture",
			family = "rome_clan",
			kingdom = "rome_kingdom",
			language = "human_language",
			unit = "rome_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_iberian_set",
			city = "iberian_city",
			clan = "iberian_clan",
			culture = "human_culture",
			family = "iberian_clan",
			kingdom = "iberian_kingdom",
			language = "human_language",
			unit = "iberian_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "human_monolux_set",
			city = "monolux_city",
			clan = "monolux_clan",
			culture = "human_culture",
			family = "monolux_clan",
			kingdom = "monolux_kingdom",
			language = "human_language",
			unit = "monolux_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "polynesian_set",
			city = "poly_city",
			clan = "poly_clan",
			culture = "human_culture",
			family = "poly_clan",
			kingdom = "poly_kingdom",
			language = "human_language",
			unit = "poly_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "nomads_set",
			city = "nomad_city",
			clan = "nomad_clan",
			culture = "human_culture",
			family = "nomad_clan",
			kingdom = "nomad_kingdom",
			language = "human_language",
			unit = "nomad_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "sino_set",
			city = "sino_city",
			clan = "sino_clan",
			culture = "human_culture",
			family = "sino_clan",
			kingdom = "sino_kingdom",
			language = "human_language",
			unit = "sino_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "siam_set",
			city = "siam_city",
			clan = "siam_clan",
			culture = "human_culture",
			family = "siam_clan",
			kingdom = "siam_kingdom",
			language = "human_language",
			unit = "siam_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "vishna_set",
			city = "vishna_city",
			clan = "vishna_clan",
			culture = "human_culture",
			family = "vishna_family",
			kingdom = "vishna_kingdom",
			language = "human_language",
			unit = "vishna_unit",
			religion = "human_religion"
		});
		add(new NameSetAsset
		{
			id = "nihon_set",
			city = "nihon_city",
			clan = "nihon_clan",
			culture = "human_culture",
			family = "nihon_clan",
			kingdom = "nihon_kingdom",
			language = "human_language",
			unit = "nihon_unit",
			religion = "human_religion"
		});
	}

	public override void editorDiagnostic()
	{
		using ListPool<string> listPool = new ListPool<string>(8);
		using ListPool<string> listPool2 = new ListPool<string>(32);
		foreach (NameSetAsset item in list)
		{
			listPool.Clear();
			(AssetManager.name_generator.has(item.city) ? listPool2 : listPool).Add(item.city);
			(AssetManager.name_generator.has(item.clan) ? listPool2 : listPool).Add(item.clan);
			(AssetManager.name_generator.has(item.culture) ? listPool2 : listPool).Add(item.culture);
			(AssetManager.name_generator.has(item.family) ? listPool2 : listPool).Add(item.family);
			(AssetManager.name_generator.has(item.kingdom) ? listPool2 : listPool).Add(item.kingdom);
			(AssetManager.name_generator.has(item.language) ? listPool2 : listPool).Add(item.language);
			(AssetManager.name_generator.has(item.unit) ? listPool2 : listPool).Add(item.unit);
			(AssetManager.name_generator.has(item.religion) ? listPool2 : listPool).Add(item.religion);
			foreach (ref string item2 in listPool)
			{
				string current2 = item2;
				BaseAssetLibrary.logAssetError("<e>" + item.id + "</e>: Missing name generator", current2);
			}
		}
		foreach (string item3 in new HashSet<string>(listPool2))
		{
			if (!AssetManager.name_generator.get(item3).hasOnomastics())
			{
				BaseAssetLibrary.logAssetError("Name generator is missing onomastics", item3);
			}
		}
		base.editorDiagnostic();
	}
}
// --- End of File: NameSetsLibrary.cs ---



// --- Start of File: NanoObject.cs ---
using System;
using System.Runtime.CompilerServices;
using Newtonsoft.Json;

public class NanoObject : IComparable<NanoObject>, IEquatable<NanoObject>, IDisposable
{
	protected bool _alive;

	public bool exists;

	protected int _hashcode;

	protected int stats_dirty_version;

	protected virtual MetaType meta_type
	{
		get
		{
			throw new NotImplementedException(GetType().Name);
		}
	}

	public double created_time_unscaled { get; set; }

	[JsonProperty(Order = -1)]
	public long id => getID();

	public virtual string name
	{
		get
		{
			throw new NotImplementedException(GetType().Name);
		}
		protected set
		{
			throw new NotImplementedException(GetType().Name);
		}
	}

	public NanoObject()
	{
		setDefaultValues();
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void revive()
	{
		setDefaultValues();
	}

	protected virtual void setDefaultValues()
	{
		exists = true;
		_alive = true;
		stats_dirty_version = 0;
		created_time_unscaled = 0.0;
	}

	public virtual long getID()
	{
		throw new NotImplementedException(GetType().Name);
	}

	public virtual string getType()
	{
		return meta_type.AsString();
	}

	public virtual MetaType getMetaType()
	{
		return meta_type;
	}

	public MetaTypeAsset getMetaTypeAsset()
	{
		return meta_type.getAsset();
	}

	public virtual string getTypeID()
	{
		return getType() + "_" + getID();
	}

	public void setName(string pName, bool pTrack = true)
	{
		if (pTrack)
		{
			trackName();
		}
		name = pName;
		if (pTrack)
		{
			trackName(pPostChange: true);
		}
	}

	public virtual void trackName(bool pPostChange = false)
	{
		throw new NotImplementedException(GetType().Name);
	}

	public virtual ColorAsset getColor()
	{
		return null;
	}

	public virtual double getFoundedTimestamp()
	{
		return 0.0;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isAlive()
	{
		return _alive;
	}

	public virtual bool hasDied()
	{
		throw new NotImplementedException(GetType().Name);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public virtual void setAlive(bool pValue)
	{
		_alive = pValue;
	}

	public int getStatsDirtyVersion()
	{
		return stats_dirty_version;
	}

	public void setHash(int pHash)
	{
		_hashcode = pHash;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool Equals(NanoObject pObject)
	{
		return _hashcode == pObject.GetHashCode();
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public int CompareTo(NanoObject pTarget)
	{
		return GetHashCode().CompareTo(pTarget.GetHashCode());
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public override int GetHashCode()
	{
		return _hashcode;
	}

	public virtual void Dispose()
	{
	}
}
// --- End of File: NanoObject.cs ---



// --- Start of File: NanoObjectExtensions.cs ---
using System.Runtime.CompilerServices;
using JetBrains.Annotations;

public static class NanoObjectExtensions
{
	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	[ContractAnnotation("null => true")]
	public static bool isRekt(this NanoObject pObject)
	{
		if (pObject != null)
		{
			return !pObject.isAlive();
		}
		return true;
	}
}
// --- End of File: NanoObjectExtensions.cs ---



// --- Start of File: NapalmFlash.cs ---
using UnityEngine;

public class NapalmFlash : BaseEffect
{
	private bool killing;

	private bool bombSpawned;

	internal void spawnFlash(WorldTile pTile)
	{
		tile = pTile;
		bombSpawned = false;
		killing = false;
		prepare(pTile, 0.1f);
	}

	public static bool napalmEffect(WorldTile pTile, string pPowerID)
	{
		pTile.startFire(pForce: true);
		return true;
	}

	private void Update()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		if (((Component)this).transform.localScale.x < 1f && !killing)
		{
			Vector3 localScale = ((Component)this).transform.localScale;
			localScale.x += World.world.elapsed * 0.7f;
			if (localScale.x >= 0.6f && !bombSpawned)
			{
				bombSpawned = true;
				World.world.loopWithBrush(tile, Brush.get(12), napalmEffect);
			}
			if (localScale.x >= 0.7f)
			{
				localScale.x = 0.7f;
				killing = true;
			}
			localScale.y = localScale.x;
			((Component)this).transform.localScale = localScale;
		}
		else if (killing)
		{
			Vector3 localScale2 = ((Component)this).transform.localScale;
			localScale2.x -= World.world.elapsed * 1.5f;
			localScale2.y = localScale2.x;
			if (localScale2.x <= 0f)
			{
				localScale2.x = 0f;
				kill();
			}
			((Component)this).transform.localScale = localScale2;
		}
	}
}
// --- End of File: NapalmFlash.cs ---



// --- Start of File: NerveImpulseElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class NerveImpulseElement : MonoBehaviour
{
	public Image image;

	private const float SPEED_MIN = 1f;

	private const float SPEED_MAX = 3f;

	private const float SCALE_MIN = 0.6f;

	private const float SCALE_MAX = 1f;

	private float _speed_current;

	private float _move_timer;

	public NeuronElement presynaptic_neuron;

	public NeuronElement postsynaptic_neuron;

	private Color _color_back = Toolbox.makeColor("#26A8A8", 0.5f);

	private Color _color_front = Toolbox.makeColor("#3AFFFF", 0.7f);

	public int wave;

	public void energize(NeuronElement pPresynapticNeuron, NeuronElement pPostsynapticNeuron, int pWave)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		((Component)this).transform.localPosition = ((Component)pPresynapticNeuron).transform.localPosition;
		presynaptic_neuron = pPresynapticNeuron;
		postsynaptic_neuron = pPostsynapticNeuron;
		_move_timer = 0f;
		_speed_current = Randy.randomFloat(1f, 3f);
		wave = pWave;
	}

	public ImpulseReachResult moveTowardsNextNeuron()
	{
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)postsynaptic_neuron == (Object)null)
		{
			return ImpulseReachResult.Done;
		}
		_move_timer += _speed_current * Time.deltaTime;
		_move_timer = Mathf.Clamp01(_move_timer);
		Vector3 localPosition = ((Component)presynaptic_neuron).transform.localPosition;
		Vector3 localPosition2 = ((Component)postsynaptic_neuron).transform.localPosition;
		((Component)this).transform.localPosition = Vector3.Lerp(localPosition, localPosition2, _move_timer);
		updateImpulseColor();
		if (_move_timer >= 1f)
		{
			presynaptic_neuron = postsynaptic_neuron;
			postsynaptic_neuron = GetNextTargetNeuron();
			_move_timer = 0f;
			wave--;
			if (wave > 0)
			{
				return ImpulseReachResult.Split;
			}
			return ImpulseReachResult.Done;
		}
		return ImpulseReachResult.Move;
	}

	private NeuronElement GetNextTargetNeuron()
	{
		if (presynaptic_neuron.connected_neurons.Count == 0)
		{
			return null;
		}
		return presynaptic_neuron.connected_neurons.GetRandom();
	}

	private void updateImpulseColor()
	{
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		float num = Mathf.Lerp(presynaptic_neuron.render_depth, postsynaptic_neuron.render_depth, _move_timer);
		Color val = Color.Lerp(_color_back, _color_front, num);
		if (((Graphic)image).color != val)
		{
			((Graphic)image).color = val;
		}
		float num2 = Mathf.Lerp(0.6f, 1f, num);
		if (((Component)this).transform.localScale.x != num2)
		{
			((Component)this).transform.localScale = new Vector3(num2, num2, num2);
		}
	}
}
// --- End of File: NerveImpulseElement.cs ---



// --- Start of File: NeuralLayerAsset.cs ---
using System;
using Newtonsoft.Json;

[Serializable]
public class NeuralLayerAsset : Asset, IDescriptionAsset, ILocalizedAsset
{
	public NeuroLayer layer;

	public string color_hex;

	public bool critical;

	public float chance_to_go_to_next_layer;

	[JsonIgnore]
	public string debug_string => $"{getLocaleID().Localize()} - {getDescriptionID().Localize()} - ({layer})";

	public string getLocaleID()
	{
		return id;
	}

	public string getDescriptionID()
	{
		return id + "_priority";
	}
}
// --- End of File: NeuralLayerAsset.cs ---



// --- Start of File: NeuralLayerAssetExtensions.cs ---
public static class NeuralLayerAssetExtensions
{
	public static NeuralLayerAsset GetAsset(this NeuroLayer pLayerID)
	{
		return AssetManager.neural_layers.getWithID(pLayerID);
	}

	public static string getDebugString(this NeuroLayer pLayerID)
	{
		return pLayerID.GetAsset().debug_string;
	}
}
// --- End of File: NeuralLayerAssetExtensions.cs ---



// --- Start of File: NeuralLayerLibrary.cs ---
using System.Collections.Generic;

public class NeuralLayerLibrary : AssetLibrary<NeuralLayerAsset>
{
	private Dictionary<NeuroLayer, NeuralLayerAsset> _dict_enum_assets = new Dictionary<NeuroLayer, NeuralLayerAsset>();

	public NeuralLayerAsset[] layers_array;

	public override void init()
	{
		base.init();
		add(new NeuralLayerAsset
		{
			id = "neuro_layer_0",
			layer = NeuroLayer.Layer_0_Minimal,
			color_hex = "#B0E0E6"
		});
		add(new NeuralLayerAsset
		{
			id = "neuro_layer_1",
			layer = NeuroLayer.Layer_1_Low,
			color_hex = "#87CEEB",
			chance_to_go_to_next_layer = 0.3f
		});
		add(new NeuralLayerAsset
		{
			id = "neuro_layer_2",
			layer = NeuroLayer.Layer_2_Moderate,
			color_hex = "#FFD700",
			chance_to_go_to_next_layer = 0.2f
		});
		add(new NeuralLayerAsset
		{
			id = "neuro_layer_3",
			layer = NeuroLayer.Layer_3_High,
			color_hex = "#FF4500",
			chance_to_go_to_next_layer = 0.1f
		});
		add(new NeuralLayerAsset
		{
			id = "neuro_layer_4",
			layer = NeuroLayer.Layer_4_Critical,
			critical = true,
			color_hex = "#FF0000"
		});
	}

	public override void linkAssets()
	{
		base.linkAssets();
		layers_array = new NeuralLayerAsset[list.Count];
		foreach (NeuralLayerAsset item in list)
		{
			_dict_enum_assets.Add(item.layer, item);
			layers_array[(int)item.layer] = item;
		}
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (NeuralLayerAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
	}

	public NeuralLayerAsset getWithID(NeuroLayer pLayerID)
	{
		return _dict_enum_assets[pLayerID];
	}
}
// --- End of File: NeuralLayerLibrary.cs ---



// --- Start of File: NeuroLayer.cs ---
public enum NeuroLayer
{
	Layer_0_Minimal,
	Layer_1_Low,
	Layer_2_Moderate,
	Layer_3_High,
	Layer_4_Critical
}
// --- End of File: NeuroLayer.cs ---



// --- Start of File: NeuronElement.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class NeuronElement : MonoBehaviour, IBeginDragHandler, IEventSystemHandler, IDragHandler, IEndDragHandler, IInitializePotentialDragHandler
{
	[SerializeField]
	public Image image;

	private const float SCALE_HIGHLIGHTED = 1.6f;

	private const float SCALE_SPAWN_IMPULSE = 1.5f;

	private const float SCALE_RECEIVE_IMPULSE_INCREASE = 0.1f;

	private const float SCALE_NORMAL = 1f;

	internal float render_depth;

	internal bool highlighted;

	internal List<NeuronElement> connected_neurons = new List<NeuronElement>();

	internal float scale_mod_spawn = 1f;

	internal float bonus_scale = 1f;

	internal DecisionAsset decision;

	internal Actor actor;

	private float _spawn_interval;

	private float _spawn_timer;

	private List<AxonElement> _axons = new List<AxonElement>();

	private NeuronsOverview _neurons_overview;

	private TooltipData _tooltip_data;

	private bool _center;

	private void Start()
	{
		_neurons_overview = ((Component)this).gameObject.GetComponentInParent<NeuronsOverview>();
		initClick();
		initTooltip();
	}

	protected void initClick()
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Expected O, but got Unknown
		Button val = default(Button);
		if (((Component)this).TryGetComponent<Button>(ref val))
		{
			((UnityEvent)val.onClick).AddListener(new UnityAction(setPressed));
		}
	}

	protected void initTooltip()
	{
		TipButton tipButton = default(TipButton);
		if (((Component)this).TryGetComponent<TipButton>(ref tipButton))
		{
			Object.Destroy((Object)(object)tipButton);
		}
	}

	private void showTooltip()
	{
		if (isCenter())
		{
			Tooltip.show(this, "tip", new TooltipData
			{
				tip_name = "toggle_all_neurons",
				tip_description = "toggle_all_neurons_description"
			});
		}
		else if (hasDecisionSet())
		{
			_tooltip_data = new TooltipData
			{
				neuron = this,
				tooltip_scale = Mathf.Lerp(0.4f, 1f, render_depth)
			};
			Tooltip.show(this, "neuron", _tooltip_data);
		}
	}

	public void setupDecisionAndActor(DecisionAsset pAsset, Actor pActor)
	{
		decision = pAsset;
		actor = pActor;
		image.sprite = decision.getSprite();
		_spawn_interval = decision.cooldown;
		_spawn_timer = Randy.randomFloat(0f, _spawn_interval);
	}

	public void updateColorsAndTooltip()
	{
		if (!highlighted)
		{
			scale_mod_spawn -= Time.deltaTime * 2f;
			scale_mod_spawn = Mathf.Max(1f, scale_mod_spawn);
		}
		else if (hasDecisionSet() && Tooltip.isShowingFor(this))
		{
			_tooltip_data.tooltip_scale = Mathf.Lerp(0.4f, 1f, render_depth);
		}
	}

	public void updateSpawnTimer()
	{
		if (_spawn_timer > 0f && isDecisionEnabled())
		{
			_spawn_timer -= Time.deltaTime;
		}
	}

	public void spawnImpulseFromHere()
	{
		scale_mod_spawn = Math.Max(1.5f, scale_mod_spawn);
		_spawn_timer = _spawn_interval;
		foreach (AxonElement axon in _axons)
		{
			axon.mod_light = 1f;
		}
	}

	public bool isDecisionEnabled()
	{
		if (!hasDecisionSet())
		{
			return true;
		}
		return actor.isDecisionEnabled(decision.decision_index);
	}

	public void setHighlighted()
	{
		if (!highlighted)
		{
			highlighted = true;
			scale_mod_spawn = 1.6f;
			showTooltip();
		}
	}

	public void setPressed()
	{
		if (_neurons_overview.isDragging() || (!hasDecisionSet() && !isCenter()))
		{
			return;
		}
		_neurons_overview.setLatestTouched(this);
		if (!InputHelpers.mouseSupported)
		{
			if (!Tooltip.isShowingFor(this))
			{
				showTooltip();
				return;
			}
		}
		else
		{
			showTooltip();
		}
		scale_mod_spawn = 1.6f;
		if (isCenter())
		{
			centerBrainClick();
		}
		else
		{
			actor.switchDecisionState(decision.decision_index);
		}
		actor.makeConfused(-1f, pColorEffect: true);
		_neurons_overview.fireImpulseWaveFromHere(this);
		_neurons_overview.startNewWhat();
		actor.updateStats();
		((Component)this).GetComponentInParent<StatsWindow>().updateStats();
		AchievementLibrary.mindless_husk.check(actor);
	}

	private void centerBrainClick()
	{
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		_neurons_overview.switchAllNeurons();
		if (_neurons_overview.getAllState())
		{
			((Graphic)image).color = Color32.op_Implicit(Toolbox.color_clear);
		}
		else
		{
			((Graphic)image).color = Toolbox.color_white;
		}
	}

	public void receiveImpulse()
	{
		scale_mod_spawn += 0.1f;
		scale_mod_spawn = Mathf.Min(1.5f, scale_mod_spawn);
	}

	public bool readyToSpawnImpulse()
	{
		if (!isDecisionEnabled())
		{
			return false;
		}
		return _spawn_timer <= 0f;
	}

	public int getSimulatedTimer()
	{
		return (int)_spawn_timer;
	}

	public void clear()
	{
		decision = null;
		actor = null;
		connected_neurons.Clear();
		_axons.Clear();
		_center = false;
	}

	public void setColor(Color pColor)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		((Graphic)image).color = pColor;
	}

	public bool hasDecisionSet()
	{
		return decision != null;
	}

	public void addConnection(NeuronElement pConnection, AxonElement pAxon)
	{
		connected_neurons.Add(pConnection);
		_axons.Add(pAxon);
	}

	public void setCenter(bool pState)
	{
		_center = pState;
	}

	public bool isCenter()
	{
		return _center;
	}

	public void OnInitializePotentialDrag(PointerEventData pEventData)
	{
		NeuronsOverview neurons_overview = _neurons_overview;
		if (neurons_overview != null)
		{
			((Component)neurons_overview).SendMessage("OnInitializePotentialDrag", (object)pEventData);
		}
	}

	public void OnBeginDrag(PointerEventData pEventData)
	{
		NeuronsOverview neurons_overview = _neurons_overview;
		if (neurons_overview != null)
		{
			((Component)neurons_overview).SendMessage("OnBeginDrag", (object)pEventData);
		}
	}

	public void OnDrag(PointerEventData pEventData)
	{
		NeuronsOverview neurons_overview = _neurons_overview;
		if (neurons_overview != null)
		{
			((Component)neurons_overview).SendMessage("OnDrag", (object)pEventData);
		}
	}

	public void OnEndDrag(PointerEventData pEventData)
	{
		NeuronsOverview neurons_overview = _neurons_overview;
		if (neurons_overview != null)
		{
			((Component)neurons_overview).SendMessage("OnEndDrag", (object)pEventData);
		}
	}
}
// --- End of File: NeuronElement.cs ---



// --- Start of File: NeuronsOverview.cs ---
using System;
using System.Collections.Generic;
using System.Globalization;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

public class NeuronsOverview : UnitElement, IInitializePotentialDragHandler, IEventSystemHandler, IBeginDragHandler, IDragHandler, IEndDragHandler
{
	private const float DRAGGING_SMOOTHING_TIME = 0.1f;

	private const float ROTATION_BOUNDS = 0.7f;

	private const float ROTATION_BOUNDS_MARGIN = 1.05f;

	private const float DRAG_SPEED = 0.46f;

	private const float DRAG_ROTATE_SPEED = 0.005f;

	private const float MIN_NEURON_CURSOR_DISTANCE = 40f;

	private const float RADIUS_NEURONS = 70f;

	private const float NEURON_SCALE_MIN = 0.8f;

	private const float NEURON_SCALE_MAX = 1.5f;

	private const float BASE_AXON_DISTANCE = 250f;

	private const float DISTANCE_SCALING_FACTOR = 1.5f;

	[SerializeField]
	private NeuronElement _prefab_neuron;

	[SerializeField]
	private NerveImpulseElement _prefab_nerve_impulse;

	[SerializeField]
	private AxonElement _prefab_axon;

	[SerializeField]
	private RectTransform _parent_axons;

	[SerializeField]
	private RectTransform _parent_nerve_impulses;

	[SerializeField]
	private RectTransform _parent_neurons;

	[SerializeField]
	private GameObject _mind_main;

	[SerializeField]
	private UnitTextManager _text_phrases;

	private ObjectPoolGenericMono<NeuronElement> _pool_neurons;

	private ObjectPoolGenericMono<NerveImpulseElement> _pool_impulses;

	private ObjectPoolGenericMono<AxonElement> _pool_axons;

	private List<NeuronElement> _neurons = new List<NeuronElement>();

	private NeuronElement _last_activated_neuron;

	private List<NerveImpulseElement> _active_impulses = new List<NerveImpulseElement>();

	private Color _color_neuron_disabled_front = Toolbox.makeColor("#111111");

	private Color _color_neuron_disabled_back = Toolbox.makeColor("#111111", 0.3f);

	private Color _color_neuron_back = Toolbox.makeColor("#A9A9A9", 0.3f);

	private Color _color_neuron_front = Toolbox.makeColor("#DDDDDD");

	private Color _color_axon_default = Toolbox.makeColor("#FFFFFF", 0.1f);

	private Color _color_axon_default_center = Toolbox.makeColor("#FF6666", 0.1f);

	private Color _color_light_axon = Toolbox.makeColor("#3AFFFF", 0.54f);

	private Color _neuron_highlighted = Toolbox.makeColor("#FFFFFF");

	private float _offset_target_x = -0.015f;

	private float _offset_target_y = 0.07f;

	private bool _is_dragging;

	private Vector2 _last_mouse_delta;

	private float _offset_x;

	private float _offset_y;

	private int _decision_counter;

	private DecisionAsset[] _decision_assets;

	public static NeuronsOverview instance;

	private NeuronElement _active_neuron;

	private NeuronElement _latest_touched_neuron;

	private bool _all_state = true;

	private void Start()
	{
		instance = this;
	}

	protected override void Awake()
	{
		base.Awake();
		_pool_neurons = new ObjectPoolGenericMono<NeuronElement>(_prefab_neuron, (Transform)(object)_parent_neurons);
		_pool_impulses = new ObjectPoolGenericMono<NerveImpulseElement>(_prefab_nerve_impulse, (Transform)(object)_parent_nerve_impulses);
		_pool_axons = new ObjectPoolGenericMono<AxonElement>(_prefab_axon, (Transform)(object)_parent_axons);
	}

	public void OnInitializePotentialDrag(PointerEventData eventData)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		eventData.useDragThreshold = false;
		_last_mouse_delta = Vector2.zero;
	}

	public void OnBeginDrag(PointerEventData eventData)
	{
		_offset_x = (_offset_target_x = 0f);
		_offset_y = (_offset_target_y = 0f);
		clearHighlight();
		Tooltip.hideTooltipNow();
	}

	private void highlightAllAxons(float pLight)
	{
		foreach (AxonElement item in _pool_axons.getListTotal())
		{
			if (!(item.mod_light > pLight))
			{
				item.mod_light = pLight;
			}
		}
	}

	public void OnDrag(PointerEventData eventData)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		_is_dragging = true;
		Vector2 delta = eventData.delta;
		if (((Vector2)(ref delta)).magnitude > ((Vector2)(ref _last_mouse_delta)).magnitude)
		{
			highlightAllAxons(0.35f);
		}
		_last_mouse_delta = delta;
		_offset_x = (0f - delta.y) * 0.46f;
		_offset_y = delta.x * 0.46f;
		updateNeuronsVisual();
	}

	public void OnEndDrag(PointerEventData eventData)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		_is_dragging = false;
		Vector2 delta = eventData.delta;
		_offset_target_x += (0f - delta.y) * 0.005f;
		_offset_target_y += delta.x * 0.005f;
		if (Mathf.Abs(_offset_target_x) > 0.7f || Mathf.Abs(_offset_target_y) > 0.7f)
		{
			if (Mathf.Abs(_offset_target_x) > Mathf.Abs(_offset_target_y))
			{
				_offset_target_y = _offset_target_y / Mathf.Abs(_offset_target_x) * 0.7f;
			}
			else
			{
				_offset_target_x = _offset_target_x / Mathf.Abs(_offset_target_y) * 0.7f;
			}
		}
		_offset_target_x = Mathf.Clamp(_offset_target_x, -0.7f, 0.7f);
		_offset_target_y = Mathf.Clamp(_offset_target_y, -0.7f, 0.7f);
		highlightAllAxons(1f);
		fireImpulsesEverywhere();
	}

	private void fireImpulsesEverywhere()
	{
		for (int i = 0; i < _neurons.Count; i++)
		{
			NeuronElement pNeuron = _neurons[i];
			fireImpulseWaveFromHere(pNeuron, 2);
		}
	}

	private void highlightNeuron(NeuronElement pHighlighted = null)
	{
		foreach (NeuronElement neuron in _neurons)
		{
			if (!((Object)(object)neuron == (Object)(object)pHighlighted) && neuron.highlighted)
			{
				neuron.highlighted = false;
				Tooltip.hideTooltipNow();
			}
		}
		pHighlighted?.setHighlighted();
	}

	private NeuronElement getClosestNeuronToCursor()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		NeuronElement result = null;
		float num = float.MaxValue;
		Vector2 val = Vector2.op_Implicit(Input.mousePosition);
		foreach (NeuronElement neuron in _neurons)
		{
			Vector2 val2 = Vector2.op_Implicit(((Component)neuron).transform.position);
			float num2 = Vector2.Distance(val, val2);
			if (!(num2 > 40f))
			{
				if ((Object)(object)neuron == (Object)(object)_active_neuron)
				{
					return neuron;
				}
				if (num2 < num)
				{
					num = num2;
					result = neuron;
				}
			}
		}
		return result;
	}

	private void prepareAxons()
	{
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		int count = _neurons.Count;
		float num = 250f / Mathf.Sqrt((float)count) * 1.5f;
		for (int i = 0; i < _neurons.Count - 1; i++)
		{
			NeuronElement neuronElement = _neurons[i];
			if (neuronElement.isCenter())
			{
				continue;
			}
			for (int j = i + 1; j < _neurons.Count; j++)
			{
				NeuronElement neuronElement2 = _neurons[j];
				if (!neuronElement2.isCenter() && !(Vector3.Distance(((Component)neuronElement).transform.localPosition, ((Component)neuronElement2).transform.localPosition) > num))
				{
					makeAxon(neuronElement, neuronElement2);
				}
			}
		}
	}

	private AxonElement makeAxon(NeuronElement pNeuron1, NeuronElement pNeuron2)
	{
		AxonElement next = _pool_axons.getNext();
		next.neuron_1 = pNeuron1;
		next.neuron_2 = pNeuron2;
		pNeuron1.addConnection(pNeuron2, next);
		pNeuron2.addConnection(pNeuron1, next);
		return next;
	}

	private void checkActorDecisions()
	{
		DecisionHelper.runSimulationForMindTab(actor);
		_decision_counter = DecisionHelper.decision_system.getCounter();
		_decision_assets = DecisionHelper.decision_system.getActions();
	}

	private void updateNeuronsVisual()
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = Quaternion.Euler(_offset_x, _offset_y, 0f);
		foreach (NeuronElement neuron in _neurons)
		{
			neuron.updateColorsAndTooltip();
			Vector3 localPosition = val * ((Component)neuron).transform.localPosition;
			((Component)neuron).transform.localPosition = localPosition;
			calculateNeuronDepth(neuron, 70f);
			updateNeuronColorAndScale(neuron);
		}
		sortNeuronsByDepth();
	}

	private void updateNeuronImpulseAutoSpawn()
	{
		foreach (NeuronElement neuron in _neurons)
		{
			neuron.updateSpawnTimer();
		}
	}

	private void sortNeuronsByDepth()
	{
		foreach (NeuronElement neuron in _neurons)
		{
			((Component)neuron).transform.SetAsLastSibling();
		}
		_neurons.Sort((NeuronElement a, NeuronElement b) => a.render_depth.CompareTo(b.render_depth));
	}

	private void calculateNeuronDepth(NeuronElement pNeuronElement, float pRadius)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		float z = ((Component)pNeuronElement).transform.localPosition.z;
		float render_depth = Mathf.InverseLerp(0f - pRadius, pRadius, z);
		pNeuronElement.render_depth = render_depth;
	}

	private void updateNeuronColorAndScale(NeuronElement pElement)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		if (!pElement.isDecisionEnabled())
		{
			Color color = Color.Lerp(_color_neuron_disabled_back, _color_neuron_disabled_front, pElement.render_depth);
			pElement.setColor(color);
		}
		else if (pElement.highlighted)
		{
			Color color2 = Color.Lerp(_color_neuron_back, _neuron_highlighted, pElement.render_depth);
			pElement.setColor(color2);
		}
		else
		{
			Color color3 = Color.Lerp(_color_neuron_back, _color_neuron_front, pElement.render_depth);
			pElement.setColor(color3);
		}
		float num = Mathf.Lerp(0.8f, 1.5f, pElement.render_depth);
		num *= pElement.scale_mod_spawn * pElement.bonus_scale;
		((Component)pElement).transform.localScale = new Vector3(num, num, num);
	}

	private void updateAxonPositions()
	{
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_0128: Unknown result type (might be due to invalid IL or missing references)
		//IL_012d: Unknown result type (might be due to invalid IL or missing references)
		//IL_012f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0136: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		foreach (AxonElement item in _pool_axons.getListTotal())
		{
			item.update();
			float num = 1f;
			NeuronElement neuron_ = item.neuron_1;
			NeuronElement neuron_2 = item.neuron_2;
			if (neuron_.highlighted || neuron_2.highlighted)
			{
				num = 6f;
			}
			Color val = _color_axon_default;
			if (item.axon_center)
			{
				val = _color_axon_default_center;
				num = 7f;
			}
			if (item.mod_light > 0f)
			{
				Color color = Color.Lerp(val, _color_light_axon, item.mod_light);
				((Graphic)item.image).color = color;
			}
			else
			{
				((Graphic)item.image).color = val;
			}
			Vector2 val2 = Vector2.op_Implicit(((Component)neuron_).transform.localPosition);
			Vector2 val3 = Vector2.op_Implicit(((Component)neuron_2).transform.localPosition);
			Vector2 val4 = (val2 + val3) / 2f;
			((Component)item).transform.localPosition = Vector2.op_Implicit(val4);
			float num2 = Vector3.Distance(Vector2.op_Implicit(val2), Vector2.op_Implicit(val3));
			((Component)item).transform.localScale = new Vector3(num2, num, 1f);
			Vector3 val5 = Vector2.op_Implicit(val3 - val2);
			float num3 = Mathf.Atan2(val5.y, val5.x) * 57.29578f;
			((Component)item).transform.rotation = Quaternion.Euler(0f, 0f, num3);
		}
	}

	private void smoothOffsets()
	{
		_offset_x = Mathf.Lerp(_offset_x, _offset_target_x, 0.1f);
		_offset_y = Mathf.Lerp(_offset_y, _offset_target_y, 0.1f);
	}

	internal void fireImpulseWaveFromHere(NeuronElement pNeuron, int pWaves = 4)
	{
		if (!pNeuron.isDecisionEnabled())
		{
			return;
		}
		foreach (NeuronElement connected_neuron in pNeuron.connected_neurons)
		{
			if (connected_neuron.isDecisionEnabled())
			{
				fireImpulse(pNeuron, connected_neuron, pWaves);
			}
		}
	}

	private void fireImpulseFrom(NeuronElement pPresynapticNeuron, int pWave, NeuronElement pIgnoreNeuron = null)
	{
		if (pPresynapticNeuron.connected_neurons.Count == 0)
		{
			return;
		}
		NeuronElement random;
		if ((Object)(object)pIgnoreNeuron == (Object)null)
		{
			random = pPresynapticNeuron.connected_neurons.GetRandom();
		}
		else
		{
			using ListPool<NeuronElement> listPool = new ListPool<NeuronElement>();
			foreach (NeuronElement connected_neuron in pPresynapticNeuron.connected_neurons)
			{
				if (!((Object)(object)pIgnoreNeuron == (Object)(object)connected_neuron))
				{
					listPool.Add(connected_neuron);
				}
			}
			if (listPool.Count == 0)
			{
				return;
			}
			random = listPool.GetRandom();
		}
		if (!((Object)(object)random == (Object)null))
		{
			fireImpulse(pPresynapticNeuron, random, pWave);
		}
	}

	internal void fireImpulse(NeuronElement pPresynapticNeuron, NeuronElement pPostsynapticNeuron, int pWave)
	{
		NerveImpulseElement next = _pool_impulses.getNext();
		next.energize(pPresynapticNeuron, pPostsynapticNeuron, pWave);
		pPresynapticNeuron.spawnImpulseFromHere();
		_active_impulses.Add(next);
	}

	private void updateImpulses()
	{
		for (int num = _active_impulses.Count - 1; num >= 0; num--)
		{
			NerveImpulseElement nerveImpulseElement = _active_impulses[num];
			ImpulseReachResult impulseReachResult = nerveImpulseElement.moveTowardsNextNeuron();
			NeuronElement postsynaptic_neuron = nerveImpulseElement.postsynaptic_neuron;
			NeuronElement presynaptic_neuron = nerveImpulseElement.presynaptic_neuron;
			switch (impulseReachResult)
			{
			case ImpulseReachResult.Done:
				postsynaptic_neuron?.receiveImpulse();
				_active_impulses.RemoveAt(num);
				_pool_impulses.release(nerveImpulseElement);
				break;
			case ImpulseReachResult.Split:
				postsynaptic_neuron?.receiveImpulse();
				fireImpulseFrom(postsynaptic_neuron, nerveImpulseElement.wave, presynaptic_neuron);
				break;
			}
		}
	}

	private void Update()
	{
		if (!_is_dragging)
		{
			smoothOffsets();
			if (InputHelpers.mouseSupported)
			{
				_active_neuron = getHighlightedNeuron();
				highlightNeuron(_active_neuron);
			}
			if (InputHelpers.mouseSupported || (Object)(object)_latest_touched_neuron == (Object)null || !Tooltip.isShowingFor(_latest_touched_neuron))
			{
				updateNeuronsVisual();
			}
		}
		updateNeuronImpulseAutoSpawn();
		updateAxonPositions();
		updateImpulseSpawn();
		updateImpulses();
	}

	private NeuronElement getHighlightedNeuron()
	{
		if (_is_dragging)
		{
			return null;
		}
		if (_offset_x > 1.05f || _offset_x < -1.05f)
		{
			return null;
		}
		if (_offset_y > 1.05f || _offset_y < -1.05f)
		{
			return null;
		}
		return getClosestNeuronToCursor();
	}

	internal void startNewWhat()
	{
		_text_phrases.startNewWhat();
	}

	private void updateImpulseSpawn()
	{
		foreach (NeuronElement neuron in _neurons)
		{
			if (neuron.hasDecisionSet() && neuron.readyToSpawnImpulse())
			{
				fireImpulseFrom(neuron, 1);
			}
		}
	}

	private void initStartPositions()
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		for (int i = 0; i < _decision_counter; i++)
		{
			DecisionAsset pAsset = _decision_assets[i];
			NeuronElement next = _pool_neurons.getNext();
			next.setupDecisionAndActor(pAsset, actor);
			Vector3 positionOnSphere = getPositionOnSphere(i, _decision_counter);
			((Component)next).transform.localPosition = positionOnSphere;
			_neurons.Add(next);
		}
		updateNeuronsVisual();
	}

	private void loadLastDecisionForCenter()
	{
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		NeuronElement neuronElement = null;
		string lastDecisionForMindOverview = actor.getLastDecisionForMindOverview();
		if (!string.IsNullOrEmpty(lastDecisionForMindOverview))
		{
			foreach (NeuronElement neuron in _neurons)
			{
				if (neuron.decision.id == lastDecisionForMindOverview)
				{
					neuronElement = neuron;
					break;
				}
			}
		}
		_last_activated_neuron = _pool_neurons.getNext();
		((Component)_last_activated_neuron).transform.localPosition = Vector3.zero;
		_last_activated_neuron.image.sprite = SpriteTextureLoader.getSprite("ui/icons/iconBrain");
		_last_activated_neuron.bonus_scale = 1.5f;
		_last_activated_neuron.setCenter(pState: true);
		_last_activated_neuron.actor = actor;
		_neurons.Add(_last_activated_neuron);
		if ((Object)(object)neuronElement != (Object)null)
		{
			makeAxon(neuronElement, _last_activated_neuron).axon_center = true;
		}
	}

	private Vector3 getPositionOnSphere(int pNeuronIndex, int pTotalNeurons)
	{
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		float num = Mathf.Acos(1f - (float)(2 * (pNeuronIndex + 1)) / (float)pTotalNeurons);
		float num2 = MathF.PI * (1f + Mathf.Sqrt(5f)) * (float)pNeuronIndex;
		float num3 = 70f * Mathf.Cos(num2) * Mathf.Sin(num);
		float num4 = 70f * Mathf.Sin(num2) * Mathf.Sin(num);
		float num5 = 70f * Mathf.Cos(num);
		return new Vector3(num3, num4, num5);
	}

	private void clearMind()
	{
		foreach (NeuronElement neuron in _neurons)
		{
			neuron.clear();
		}
		_active_impulses.Clear();
		_pool_axons.clear();
		_pool_neurons.clear();
		_pool_impulses.clear();
		_neurons.Clear();
		foreach (AxonElement item in _pool_axons.getListTotal())
		{
			item.clear();
		}
	}

	protected override void OnEnable()
	{
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		base.OnEnable();
		ShortcutExtensions.DOKill((Component)(object)_mind_main.transform, false);
		_mind_main.transform.localScale = new Vector3(0.5f, 0.5f, 0.5f);
		TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(_mind_main.transform, 1f, 0.6f), (Ease)27);
		checkActorDecisions();
		clearMind();
		initStartPositions();
		loadLastDecisionForCenter();
		prepareAxons();
		_is_dragging = false;
	}

	internal bool isDragging()
	{
		return _is_dragging;
	}

	internal void clearHighlight()
	{
		if (!((Object)(object)_active_neuron == (Object)null))
		{
			_active_neuron.highlighted = false;
			_active_neuron = null;
		}
	}

	public static void debugTool(DebugTool pTool)
	{
		instance?.debug(pTool);
	}

	public void debug(DebugTool pTool)
	{
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_017d: Unknown result type (might be due to invalid IL or missing references)
		pTool.setText("offset_target_x:", getFloat(_offset_target_x), 0f, pShowBar: false, 0L);
		pTool.setText("offset_target_y:", getFloat(_offset_target_y), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("offset_x:", getFloat(_offset_x), 0f, pShowBar: false, 0L);
		pTool.setText("offset_y:", getFloat(_offset_y), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		Quaternion val = Quaternion.Euler(_offset_x, _offset_y, 0f);
		pTool.setText("combined_rotation.x:", getFloat(val.x), 0f, pShowBar: false, 0L);
		pTool.setText("combined_rotation.y:", getFloat(val.y), 0f, pShowBar: false, 0L);
		pTool.setText("combined_rotation.z:", getFloat(val.z), 0f, pShowBar: false, 0L);
		pTool.setText("combined_rotation.w:", getFloat(val.w), 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("is_dragging:", _is_dragging, 0f, pShowBar: false, 0L);
		pTool.setText("last_mouse_delta:", _last_mouse_delta, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("decisions:", _decision_counter, 0f, pShowBar: false, 0L);
		pTool.setSeparator();
		pTool.setText("neuron selected:", _active_neuron, 0f, pShowBar: false, 0L);
	}

	public static string getFloat(float pFloat)
	{
		if (pFloat < 0.001f && pFloat > -0.001f)
		{
			return pFloat.ToString("F6", CultureInfo.InvariantCulture);
		}
		if (pFloat > 0f)
		{
			return "<color=#75D53A>" + pFloat.ToString("F6", CultureInfo.InvariantCulture) + "</color>";
		}
		return "<color=#DB2920>" + pFloat.ToString("F6", CultureInfo.InvariantCulture) + "</color>";
	}

	public void setLatestTouched(NeuronElement pNeuron)
	{
		_latest_touched_neuron = pNeuron;
	}

	public void switchAllNeurons()
	{
		if (!isAnyEnabled())
		{
			_all_state = true;
		}
		else if (isAllEnabled())
		{
			_all_state = false;
		}
		else
		{
			_all_state = !_all_state;
		}
		foreach (NeuronElement neuron in _neurons)
		{
			if (neuron.hasDecisionSet())
			{
				actor.setDecisionState(neuron.decision.decision_index, _all_state);
			}
		}
		fireImpulsesEverywhere();
	}

	public bool getAllState()
	{
		return _all_state;
	}

	private bool isAnyEnabled()
	{
		foreach (NeuronElement neuron in _neurons)
		{
			if (neuron.hasDecisionSet() && actor.isDecisionEnabled(neuron.decision.decision_index))
			{
				return true;
			}
		}
		return false;
	}

	private bool isAllEnabled()
	{
		foreach (NeuronElement neuron in _neurons)
		{
			if (neuron.hasDecisionSet() && !actor.isDecisionEnabled(neuron.decision.decision_index))
			{
				return false;
			}
		}
		return true;
	}
}
// --- End of File: NeuronsOverview.cs ---



// --- Start of File: Node.cs ---
using System;

namespace EpPathFinding.cs;

public class Node : IComparable<Node>, IDisposable
{
	public WorldTile tile;

	public readonly int x;

	public readonly int y;

	public float heuristicStartToEndLen;

	public float startToCurNodeLen;

	public float? heuristicCurNodeToEndLen;

	public bool isOpened;

	public bool isClosed;

	public Node parent;

	public Node(int iX, int iY, bool? iWalkable = null)
	{
		x = iX;
		y = iY;
		heuristicStartToEndLen = 0f;
		startToCurNodeLen = 0f;
		heuristicCurNodeToEndLen = null;
		isOpened = false;
		isClosed = false;
		parent = null;
	}

	public Node(Node b)
	{
		x = b.x;
		y = b.y;
		heuristicStartToEndLen = b.heuristicStartToEndLen;
		startToCurNodeLen = b.startToCurNodeLen;
		heuristicCurNodeToEndLen = b.heuristicCurNodeToEndLen;
		isOpened = b.isOpened;
		isClosed = b.isClosed;
		parent = b.parent;
	}

	public void Reset(bool? iWalkable = null)
	{
		heuristicStartToEndLen = 0f;
		startToCurNodeLen = 0f;
		heuristicCurNodeToEndLen = null;
		isOpened = false;
		isClosed = false;
		parent = null;
	}

	public int CompareTo(Node iObj)
	{
		float num = heuristicStartToEndLen - iObj.heuristicStartToEndLen;
		if (num > 0f)
		{
			return 1;
		}
		if (num == 0f)
		{
			return 0;
		}
		return -1;
	}

	public override int GetHashCode()
	{
		return x ^ y;
	}

	public override bool Equals(object obj)
	{
		if (obj == null)
		{
			return false;
		}
		if (!(obj is Node node))
		{
			return false;
		}
		if (x == node.x)
		{
			return y == node.y;
		}
		return false;
	}

	public bool Equals(Node p)
	{
		if ((object)p == null)
		{
			return false;
		}
		if (x == p.x)
		{
			return y == p.y;
		}
		return false;
	}

	public static bool operator ==(Node a, Node b)
	{
		if ((object)a == b)
		{
			return true;
		}
		if ((object)a == null || (object)b == null)
		{
			return false;
		}
		if (a.x == b.x)
		{
			return a.y == b.y;
		}
		return false;
	}

	public static bool operator !=(Node a, Node b)
	{
		return !(a == b);
	}

	public void Dispose()
	{
		tile = null;
		parent = null;
	}
}
// --- End of File: Node.cs ---



// --- Start of File: NodePool.cs ---
using System.Collections.Generic;

namespace EpPathFinding.cs;

public class NodePool
{
	protected Dictionary<GridPos, Node> m_nodes;

	public Dictionary<GridPos, Node> Nodes => m_nodes;

	public NodePool()
	{
		m_nodes = new Dictionary<GridPos, Node>();
	}

	public Node GetNode(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return GetNode(iPos);
	}

	public Node GetNode(GridPos iPos)
	{
		Node value = null;
		m_nodes.TryGetValue(iPos, out value);
		return value;
	}

	public Node SetNode(int iX, int iY, bool? iWalkable = null)
	{
		GridPos iPos = new GridPos(iX, iY);
		return SetNode(iPos, iWalkable);
	}

	public Node SetNode(GridPos iPos, bool? iWalkable = null)
	{
		if (iWalkable.HasValue)
		{
			if (iWalkable.Value)
			{
				Node value = null;
				if (m_nodes.TryGetValue(iPos, out value))
				{
					return value;
				}
				Node node = new Node(iPos.x, iPos.y, iWalkable);
				m_nodes.Add(iPos, node);
				return node;
			}
			removeNode(iPos);
			return null;
		}
		Node node2 = new Node(iPos.x, iPos.y, true);
		m_nodes.Add(iPos, node2);
		return node2;
	}

	protected void removeNode(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		removeNode(iPos);
	}

	protected void removeNode(GridPos iPos)
	{
		if (m_nodes.ContainsKey(iPos))
		{
			m_nodes.Remove(iPos);
		}
	}
}
// --- End of File: NodePool.cs ---



// --- Start of File: NotchMover.cs ---
using UnityEngine;

public class NotchMover : MonoBehaviour
{
	private float originalTopPosition;

	private RectTransform rectTransform;

	private Canvas _canvas;

	private void Start()
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		rectTransform = ((Component)this).GetComponent<RectTransform>();
		originalTopPosition = rectTransform.anchoredPosition.y;
		_canvas = ((Component)((Component)this).gameObject.transform).GetComponentInParent<Canvas>();
	}

	private void Update()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		float num = Screen.height;
		Rect safeArea = Screen.safeArea;
		if (num != ((Rect)(ref safeArea)).height && !((Object)(object)_canvas == (Object)null))
		{
			float num2 = Screen.height;
			safeArea = Screen.safeArea;
			float num3 = (num2 - ((Rect)(ref safeArea)).height) / _canvas.scaleFactor;
			rectTransform.anchoredPosition = Vector2.op_Implicit(new Vector3(rectTransform.anchoredPosition.x, originalTopPosition - num3));
		}
	}
}
// --- End of File: NotchMover.cs ---



// --- Start of File: NucleobaseHelper.cs ---
using UnityEngine;

public static class NucleobaseHelper
{
	private const char SHORT_ADENINE = 'A';

	private const char SHORT_CYTOSINE = 'C';

	private const char SHORT_GUANINE = 'G';

	private const char SHORT_THYMINE = 'T';

	private const string NOT_CONNECTED_TRANSPARENCY = "88";

	private const string COLOR_HEX_ADENINE = "#70FF70";

	private const string COLOR_HEX_CYTOSINE = "#3A8FFF";

	private const string COLOR_HEX_GUANINE = "#FFDF42";

	private const string COLOR_HEX_THYMINE = "#FF3A3A";

	private const string COLOR_HEX_ADENINE_DARK = "#70FF7088";

	private const string COLOR_HEX_CYTOSINE_DARK = "#3A8FFF88";

	private const string COLOR_HEX_GUANINE_DARK = "#FFDF4288";

	private const string COLOR_HEX_THYMINE_DARK = "#FF3A3A88";

	private static readonly Color color_adenine = Toolbox.makeColor("#70FF70");

	private static readonly Color color_cytosine = Toolbox.makeColor("#3A8FFF");

	private static readonly Color color_guanine = Toolbox.makeColor("#FFDF42");

	private static readonly Color color_thymine = Toolbox.makeColor("#FF3A3A");

	private static readonly Color color_adenine_dark = Toolbox.makeColor("#70FF7088");

	private static readonly Color color_cytosine_dark = Toolbox.makeColor("#3A8FFF88");

	private static readonly Color color_guanine_dark = Toolbox.makeColor("#FFDF4288");

	private static readonly Color color_thymine_dark = Toolbox.makeColor("#FF3A3A88");

	public static readonly Color color_bad = Color.black;

	public const string COLOR_HEX_BAD = "#B159FF";

	public static Color getColor(char pChar, bool pDark = false)
	{
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		if (pDark)
		{
			return (Color)(pChar switch
			{
				'A' => color_adenine_dark, 
				'C' => color_cytosine_dark, 
				'G' => color_guanine_dark, 
				'T' => color_thymine_dark, 
				_ => Color.black, 
			});
		}
		return (Color)(pChar switch
		{
			'A' => color_adenine, 
			'C' => color_cytosine, 
			'G' => color_guanine, 
			'T' => color_thymine, 
			_ => Color.black, 
		});
	}

	public static string getColorHex(char pChar, bool pDark = false)
	{
		string result = string.Empty;
		if (pDark)
		{
			switch (pChar)
			{
			case 'A':
				result = "#70FF7088";
				break;
			case 'C':
				result = "#3A8FFF88";
				break;
			case 'G':
				result = "#FFDF4288";
				break;
			case 'T':
				result = "#FF3A3A88";
				break;
			}
		}
		else
		{
			switch (pChar)
			{
			case 'A':
				result = "#70FF70";
				break;
			case 'C':
				result = "#3A8FFF";
				break;
			case 'G':
				result = "#FFDF42";
				break;
			case 'T':
				result = "#FF3A3A";
				break;
			}
		}
		return result;
	}

	private static string getNucleobaseFullID(char pChar)
	{
		string result = string.Empty;
		switch (pChar)
		{
		case 'A':
			result = "nucleo_adenine";
			break;
		case 'C':
			result = "nucleo_cytosine";
			break;
		case 'G':
			result = "nucleo_guanine";
			break;
		case 'T':
			result = "nucleo_thymine";
			break;
		}
		return result;
	}

	public static string getColoredNucleobaseFull(char pChar)
	{
		string colorHex = getColorHex(pChar);
		string fullNucleobaseName = getFullNucleobaseName(pChar);
		return "<color=" + colorHex + ">" + fullNucleobaseName + "</color>";
	}

	public static string getFullNucleobaseName(char pChar)
	{
		return LocalizedTextManager.getText(getNucleobaseFullID(pChar));
	}

	public static string getColoredSequence(string pGeneticCode)
	{
		string text = string.Empty;
		foreach (char c in pGeneticCode)
		{
			string colorHex = getColorHex(c);
			text += $"<color={colorHex}>{c}</color>";
		}
		return text;
	}
}
// --- End of File: NucleobaseHelper.cs ---



// --- Start of File: Nucleus.cs ---
using System.Collections.Generic;
using UnityEngine;

public class Nucleus
{
	public readonly List<Chromosome> chromosomes = new List<Chromosome>();

	private readonly BaseStats _merged_base_stats_male = new BaseStats();

	private readonly BaseStats _merged_base_stats_female = new BaseStats();

	private readonly BaseStats _merged_base_stats = new BaseStats();

	private readonly BaseStats _merged_base_stats_meta = new BaseStats();

	private bool _dirty = true;

	private readonly BaseStats[] _base_stats_all = new BaseStats[4];

	public readonly List<string> pot_possible_attributes = new List<string>();

	public BaseStats base_stats_male => _merged_base_stats_male;

	public BaseStats base_stats_female => _merged_base_stats_female;

	public Nucleus()
	{
		_base_stats_all[0] = _merged_base_stats;
		_base_stats_all[1] = _merged_base_stats_meta;
		_base_stats_all[2] = _merged_base_stats_male;
		_base_stats_all[3] = _merged_base_stats_female;
	}

	public void createFrom(ActorAsset pActorAsset)
	{
		reset();
		Chromosome chromosome = null;
		using ListPool<string> listPool = generateGenesFromBaseStats(pActorAsset.genome_parts);
		listPool.Shuffle();
		bool flag = WorldLawLibrary.world_law_gene_spaghetti.isEnabled();
		for (int i = 0; i < listPool.Count; i++)
		{
			string text = listPool[i];
			if (flag && Randy.randomChance(0.777f))
			{
				string randomNormalGene = AssetManager.gene_library.getRandomNormalGene();
				if (!string.IsNullOrEmpty(randomNormalGene))
				{
					text = randomNormalGene;
				}
			}
			GeneAsset geneAsset = AssetManager.gene_library.get(text);
			if (geneAsset == null)
			{
				Debug.LogError((object)("GeneAsset not found: " + text));
				continue;
			}
			if (chromosome != null && chromosome.canAddGene(geneAsset))
			{
				chromosome.addGene(geneAsset);
				continue;
			}
			List<string> chromosomes_first = pActorAsset.chromosomes_first;
			ChromosomeTypeAsset chromosomeTypeAsset = ((chromosomes_first == null || chromosomes_first.Count <= 0 || chromosomes.Count != 0) ? AssetManager.chromosome_type_library.list.GetRandom() : AssetManager.chromosome_type_library.get(pActorAsset.chromosomes_first.GetRandom()));
			Chromosome chromosome2 = new Chromosome(chromosomeTypeAsset.id, pNew: true);
			addChromosome(chromosome2);
			chromosome = chromosome2;
			chromosome.addGene(geneAsset);
		}
		fillAllEmptyLoci();
		shuffleGenesBetweenChromosomes();
		setDirty();
	}

	public void fillAllEmptyLoci()
	{
		foreach (Chromosome chromosome in chromosomes)
		{
			chromosome.fillEmptyLoci();
		}
	}

	private void shuffleGenesBetweenChromosomes()
	{
		using ListPool<GeneAsset> listPool = new ListPool<GeneAsset>();
		for (int i = 0; i < chromosomes.Count; i++)
		{
			Chromosome chromosome = chromosomes[i];
			for (int j = 0; j < chromosome.genes.Count; j++)
			{
				GeneAsset geneAsset = chromosome.genes[j];
				if (!geneAsset.is_empty)
				{
					chromosome.genes[j] = GeneLibrary.gene_for_generation;
					listPool.Add(geneAsset);
				}
			}
		}
		listPool.Shuffle();
		for (int k = 0; k < chromosomes.Count; k++)
		{
			Chromosome chromosome2 = chromosomes[k];
			for (int l = 0; l < chromosome2.genes.Count; l++)
			{
				if (chromosome2.genes[l].for_generation)
				{
					chromosome2.genes[l] = listPool.Pop();
				}
			}
		}
	}

	private bool isStatGene(string pID)
	{
		switch (pID)
		{
		case "bonus_male":
		case "bonus_female":
		case "bonus_sex_random":
		case "bad":
			return false;
		default:
			return true;
		}
	}

	private ListPool<string> generateGenesFromBaseStats(HashSet<GenomePart> pGeneTemplateStats)
	{
		ListPool<string> listPool = new ListPool<string>();
		Dictionary<string, float> dictionary = new Dictionary<string, float>();
		fillRemainingValues(pGeneTemplateStats, dictionary, listPool);
		bool flag = true;
		int num = 300;
		while (flag)
		{
			flag = false;
			if (num-- < 0)
			{
				Debug.LogError((object)"generateGenesFromBaseStats infinite loop");
				break;
			}
			foreach (GenomePart tGenomePart in pGeneTemplateStats)
			{
				if (!isStatGene(tGenomePart.id))
				{
					continue;
				}
				List<GeneAsset> genesWithStat = AssetManager.gene_library.getGenesWithStat(tGenomePart.id);
				if (Randy.randomChance(0.8f))
				{
					genesWithStat.Sort((GeneAsset pG1, GeneAsset pG2) => sortByStatValue(pG1, pG2, tGenomePart.id));
				}
				else
				{
					genesWithStat.Shuffle();
				}
				for (int i = 0; i < genesWithStat.Count; i++)
				{
					GeneAsset geneAsset = genesWithStat[i];
					bool flag2 = true;
					foreach (BaseStatsContainer item in geneAsset.base_stats.getList())
					{
						if (!dictionary.ContainsKey(item.id) || dictionary[item.id] < item.value)
						{
							flag2 = false;
							break;
						}
					}
					foreach (BaseStatsContainer item2 in geneAsset.base_stats_meta.getList())
					{
						if (!dictionary.ContainsKey(item2.id) || dictionary[item2.id] < item2.value)
						{
							flag2 = false;
							break;
						}
					}
					if (!flag2)
					{
						continue;
					}
					foreach (BaseStatsContainer item3 in geneAsset.base_stats.getList())
					{
						dictionary[item3.id] -= item3.value;
					}
					foreach (BaseStatsContainer item4 in geneAsset.base_stats_meta.getList())
					{
						dictionary[item4.id] -= item4.value;
					}
					listPool.Add(geneAsset.id);
					flag = true;
					break;
				}
				if (flag)
				{
					break;
				}
			}
		}
		return listPool;
	}

	private void fillRemainingValues(HashSet<GenomePart> pGeneTemplateStats, Dictionary<string, float> pDictRemainingValues, ListPool<string> pResultGenes)
	{
		foreach (GenomePart pGeneTemplateStat in pGeneTemplateStats)
		{
			string id = pGeneTemplateStat.id;
			if (isStatGene(id))
			{
				pDictRemainingValues.Add(id, pGeneTemplateStat.value);
			}
			else
			{
				addSpecialGenes(id, (int)pGeneTemplateStat.value, pResultGenes);
			}
		}
	}

	private void addSpecialGenes(string pSpecialGeneID, int pAmount, ListPool<string> pResultGenes)
	{
		for (int i = 0; i < pAmount; i++)
		{
			if (pSpecialGeneID == "bonus_sex_random")
			{
				if (Randy.randomBool())
				{
					pResultGenes.Add("bonus_male");
				}
				else
				{
					pResultGenes.Add("bonus_female");
				}
			}
			else
			{
				pResultGenes.Add(pSpecialGeneID);
			}
		}
	}

	private static int sortByStatValue(GeneAsset pA, GeneAsset pB, string pStatID)
	{
		if (!pA.base_stats.hasStat(pStatID) && !pB.base_stats.hasStat(pStatID))
		{
			return 0;
		}
		if (!pA.base_stats.hasStat(pStatID))
		{
			return 1;
		}
		if (!pB.base_stats.hasStat(pStatID))
		{
			return -1;
		}
		return pB.base_stats[pStatID].CompareTo(pA.base_stats[pStatID]);
	}

	public List<ChromosomeData> getListForSave()
	{
		List<ChromosomeData> list = new List<ChromosomeData>();
		foreach (Chromosome chromosome in chromosomes)
		{
			ChromosomeData dataForSave = chromosome.getDataForSave();
			list.Add(dataForSave);
		}
		return list;
	}

	public BaseStats getStats()
	{
		if (_dirty)
		{
			recalculate();
		}
		return _merged_base_stats;
	}

	public BaseStats getStatsMeta()
	{
		if (_dirty)
		{
			recalculate();
		}
		return _merged_base_stats_meta;
	}

	private void recalculate()
	{
		if (!_dirty)
		{
			return;
		}
		_dirty = false;
		BaseStats merged_base_stats = _merged_base_stats;
		BaseStats merged_base_stats_meta = _merged_base_stats_meta;
		BaseStats merged_base_stats_male = _merged_base_stats_male;
		BaseStats merged_base_stats_female = _merged_base_stats_female;
		clearAllBaseStats();
		foreach (Chromosome chromosome in chromosomes)
		{
			chromosome.recalculate();
			merged_base_stats.mergeStats(chromosome.getStats());
			merged_base_stats_meta.mergeStats(chromosome.getStatsMeta());
			merged_base_stats_male.mergeStats(chromosome.getStatsMale());
			merged_base_stats_female.mergeStats(chromosome.getStatsFemale());
		}
		pot_possible_attributes.Clear();
		pot_possible_attributes.AddTimes((int)merged_base_stats["intelligence"], "intelligence");
		pot_possible_attributes.AddTimes((int)merged_base_stats["warfare"], "warfare");
		pot_possible_attributes.AddTimes((int)merged_base_stats["stewardship"], "stewardship");
		pot_possible_attributes.AddTimes((int)merged_base_stats["diplomacy"], "diplomacy");
	}

	public void setDirty()
	{
		_dirty = true;
	}

	public void addChromosome(Chromosome pChromosome)
	{
		chromosomes.Add(pChromosome);
	}

	public void reset()
	{
		setDirty();
		chromosomes.Clear();
	}

	private void clearAllBaseStats()
	{
		BaseStats[] base_stats_all = _base_stats_all;
		for (int i = 0; i < base_stats_all.Length; i++)
		{
			base_stats_all[i].clear();
		}
	}

	public void cloneFrom(Nucleus pParentsSubspeciesNucleus)
	{
		chromosomes.Clear();
		foreach (Chromosome chromosome2 in pParentsSubspeciesNucleus.chromosomes)
		{
			Chromosome chromosome = new Chromosome(chromosome2.chromosome_type, pNew: false);
			chromosome.cloneFrom(chromosome2);
			addChromosome(chromosome);
		}
		setDirty();
	}

	public void doRandomGeneMutations(int pMutationAmount)
	{
		foreach (Chromosome chromosome in chromosomes)
		{
			for (int i = 0; i < pMutationAmount; i++)
			{
				chromosome.mutateRandomGene();
			}
		}
	}

	public void unstableGenomeEvent()
	{
		foreach (Chromosome chromosome in chromosomes)
		{
			chromosome.shuffleGenes();
		}
		setDirty();
	}
}
// --- End of File: Nucleus.cs ---



// --- Start of File: NukeFlash.cs ---
using UnityEngine;

public class NukeFlash : BaseEffect
{
	private bool _killing;

	private bool _bomb_spawned;

	private TerraformOptions _terraform_asset;

	internal void spawnFlash(WorldTile pTile, string pBomb)
	{
		tile = pTile;
		_bomb_spawned = false;
		_terraform_asset = AssetManager.terraform.get(pBomb);
		_killing = false;
		prepare(pTile, 0.1f);
	}

	private void Update()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_010b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0130: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Unknown result type (might be due to invalid IL or missing references)
		Vector3 localScale = m_transform.localScale;
		if (!_killing && localScale.x < 1f)
		{
			Config.grey_goo_damaged = false;
			localScale.x += World.world.elapsed * 2.5f;
			if (localScale.x >= 0.8f && !_bomb_spawned)
			{
				_bomb_spawned = true;
				_terraform_asset.bomb_action?.Invoke(null, tile);
			}
			if (Config.grey_goo_damaged && !AchievementLibrary.isUnlocked(AchievementLibrary.final_resolution))
			{
				AchievementLibrary.final_resolution.check();
			}
			if (localScale.x >= 1f)
			{
				localScale.x = 1f;
				_killing = true;
			}
			localScale.y = localScale.x;
			m_transform.localScale = localScale;
		}
		else if (_killing)
		{
			localScale.x -= World.world.elapsed * 2.5f;
			localScale.y = localScale.x;
			if (localScale.x <= 0f)
			{
				localScale.x = 0f;
				kill();
			}
			m_transform.localScale = localScale;
		}
	}

	internal static bool atomic_bomb_action(BaseSimObject pTarget = null, WorldTile pTile = null)
	{
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_nuke_atomic", pTile, 0.8f, 0.9f);
		if (World.world.explosion_checker.checkNearby(pTile, 30))
		{
			return false;
		}
		MapAction.damageWorld(pTile, 30, TerraformLibrary.atomic_bomb);
		return true;
	}

	internal static bool crabzilla_bomb_action(BaseSimObject pTarget = null, WorldTile pTile = null)
	{
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_huge", pTile, 0.8f, 0.9f);
		if (World.world.explosion_checker.checkNearby(pTile, 30))
		{
			return false;
		}
		MapAction.damageWorld(pTile, 30, TerraformLibrary.crabzilla_bomb);
		int num = Randy.randomInt(1, 5);
		for (int i = 0; i < num; i++)
		{
			Actor actor = World.world.units.createNewUnit("crab", pTile, pMiracleSpawn: false, 0f, null, null, pSpawnWithItems: true, pAdultAge: true);
			actor.addTrait("fire_blood");
			actor.addTrait("fire_proof");
			actor.addTrait("evil");
			actor.addTrait("tough");
		}
		return true;
	}

	internal static bool czar_bomba_action(BaseSimObject pTarget = null, WorldTile pTile = null)
	{
		EffectsLibrary.spawnAtTileRandomScale("fx_explosion_huge", pTile, 1.4f, 1.6f);
		if (World.world.explosion_checker.checkNearby(pTile, 70))
		{
			return false;
		}
		MapAction.damageWorld(pTile, 70, TerraformLibrary.czar_bomba);
		return true;
	}
}
// --- End of File: NukeFlash.cs ---



// --- Start of File: NullableLongJsonConverter.cs ---
using System;
using Newtonsoft.Json;
using UnityEngine;

public class NullableLongJsonConverter : JsonConverter
{
	public override bool CanWrite => false;

	public override bool CanRead => true;

	public static long? getLong(string pString, JsonReader pReader)
	{
		if (string.IsNullOrEmpty(pString))
		{
			return null;
		}
		return LongJsonConverter.getLong(pString, pReader);
	}

	public override object ReadJson(JsonReader reader, Type objectType, object existingValue, JsonSerializer serializer)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Expected I4, but got Unknown
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		JsonToken tokenType = reader.TokenType;
		switch (tokenType - 7)
		{
		case 4:
			return null;
		case 0:
			return Convert.ToInt64(reader.Value);
		case 2:
			return getLong((string)reader.Value, reader);
		default:
		{
			string[] obj = new string[7]
			{
				"Unhandled type ",
				reader.Path,
				" ",
				reader.Value?.ToString(),
				" ",
				null,
				null
			};
			tokenType = reader.TokenType;
			obj[5] = ((object)(JsonToken)(ref tokenType)).ToString();
			obj[6] = " -> null";
			Debug.LogWarning((object)string.Concat(obj));
			return null;
		}
		}
	}

	public override void WriteJson(JsonWriter writer, object value, JsonSerializer serializer)
	{
		writer.WriteValue(value);
	}

	public override bool CanConvert(Type objectType)
	{
		return objectType == typeof(long?);
	}
}
// --- End of File: NullableLongJsonConverter.cs ---



// --- Start of File: NullableLongListJsonConverter.cs ---
using System;
using System.Collections.Generic;
using Newtonsoft.Json;
using UnityEngine;

public class NullableLongListJsonConverter : JsonConverter
{
	public override bool CanWrite => false;

	public override bool CanRead => true;

	public override object ReadJson(JsonReader reader, Type objectType, object existingValue, JsonSerializer serializer)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Invalid comparison between Unknown and I4
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Invalid comparison between Unknown and I4
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Expected I4, but got Unknown
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Invalid comparison between Unknown and I4
		if ((int)reader.TokenType == 11)
		{
			return null;
		}
		JsonToken tokenType;
		if ((int)reader.TokenType == 2)
		{
			using ListPool<long?> listPool = new ListPool<long?>();
			while (reader.Read())
			{
				tokenType = reader.TokenType;
				switch (tokenType - 7)
				{
				case 0:
					listPool.Add(Convert.ToInt64(reader.Value));
					continue;
				case 4:
					listPool.Add(null);
					continue;
				case 2:
				{
					string pString = (string)reader.Value;
					listPool.Add(NullableLongJsonConverter.getLong(pString, reader));
					continue;
				}
				case 1:
				case 3:
					continue;
				}
				if ((int)tokenType != 14)
				{
					continue;
				}
				return new List<long?>(listPool);
			}
		}
		string[] obj = new string[7]
		{
			"Unhandled type ",
			reader.Path,
			" ",
			reader.Value?.ToString(),
			" ",
			null,
			null
		};
		tokenType = reader.TokenType;
		obj[5] = ((object)(JsonToken)(ref tokenType)).ToString();
		obj[6] = " -> null";
		Debug.LogWarning((object)string.Concat(obj));
		return null;
	}

	public override void WriteJson(JsonWriter writer, object value, JsonSerializer serializer)
	{
		writer.WriteValue(value);
	}

	public override bool CanConvert(Type objectType)
	{
		return objectType == typeof(List<long?>);
	}
}
// --- End of File: NullableLongListJsonConverter.cs ---



// --- Start of File: ObjectContainer.cs ---
using System;
using System.Collections;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using JetBrains.Annotations;

public class ObjectContainer<T> : IEnumerable<T>, IEnumerable
{
	private HashSet<T> _to_remove = new HashSet<T>();

	private HashSet<T> _to_add = new HashSet<T>();

	private HashSet<T> _hashSet = new HashSet<T>();

	private T[] _array;

	private int _array_count;

	private bool _dirty_list;

	private bool _dirty_array;

	private bool _dirty_container;

	private readonly List<T> _simple_list = new List<T>();

	public int Count
	{
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		get
		{
			return _hashSet.Count;
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public IEnumerator<T> GetEnumerator()
	{
		return _hashSet.GetEnumerator();
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	IEnumerator IEnumerable.GetEnumerator()
	{
		return GetEnumerator();
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool Contains(T pObject, bool pCheckToAddRemove = true)
	{
		if (pCheckToAddRemove)
		{
			if (_to_add.Contains(pObject))
			{
				return true;
			}
			if (_to_remove.Contains(pObject))
			{
				return false;
			}
		}
		return _hashSet.Contains(pObject);
	}

	public void Clear()
	{
		_hashSet.Clear();
		_to_add.Clear();
		_to_remove.Clear();
		_simple_list.Clear();
		_dirty_list = false;
		_dirty_array = false;
		_dirty_container = false;
		if (_array_count > 0)
		{
			Array.Clear(_array, 0, _array.Length);
			_array_count = 0;
		}
	}

	public void doChecks()
	{
		checkAddRemove();
		checkSimpleListDirty();
	}

	public bool isDirtyContainer()
	{
		return _dirty_container;
	}

	public void checkAddRemove()
	{
		if (_to_add.Count > 0)
		{
			if (_hashSet.Count == 0)
			{
				HashSet<T> hashSet = _hashSet;
				_hashSet = _to_add;
				_to_add = hashSet;
			}
			else
			{
				_hashSet.UnionWith(_to_add);
				_to_add.Clear();
			}
			_dirty_list = true;
			_dirty_array = true;
		}
		if (_to_remove.Count > 0)
		{
			_hashSet.ExceptWith(_to_remove);
			_to_remove.Clear();
			_dirty_list = true;
			_dirty_array = true;
		}
		_dirty_container = false;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public List<T> getSimpleList()
	{
		checkSimpleListDirty();
		return _simple_list;
	}

	public T[] getFastSimpleArray()
	{
		if (_dirty_array)
		{
			_dirty_array = false;
			_hashSet.CopyTo(_array, 0);
			_array_count = _hashSet.Count;
		}
		return _array;
	}

	public T[] getSimpleArray()
	{
		if (_dirty_array)
		{
			_dirty_array = false;
			prepareArray(_hashSet.Count);
			_hashSet.CopyTo(_array, 0);
			_array_count = _hashSet.Count;
		}
		return _array;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	private void checkSimpleListDirty()
	{
		if (_dirty_list)
		{
			List<T> simple_list = _simple_list;
			simple_list.Clear();
			simple_list.AddRange(_hashSet);
			_dirty_list = false;
		}
	}

	public void prepareArray(int pSize)
	{
		_array = Toolbox.checkArraySize(_array, pSize);
	}

	[CanBeNull]
	public T GetRandom()
	{
		checkAddRemove();
		List<T> simpleList = getSimpleList();
		if (simpleList.Count == 0)
		{
			return default(T);
		}
		return simpleList.GetRandom();
	}

	public string debug()
	{
		return _hashSet.Count + "/" + _to_add.Count + "/" + _to_remove.Count;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Add(T pObject)
	{
		_to_add.Add(pObject);
		_to_remove.Remove(pObject);
		_dirty_container = true;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Remove(T pObject)
	{
		_to_remove.Add(pObject);
		_to_add.Remove(pObject);
		_dirty_container = true;
	}
}
// --- End of File: ObjectContainer.cs ---



// --- Start of File: ObjectContainerAction.cs ---
public delegate void ObjectContainerAction<T>(ObjectContainer<T> pContainer);
// --- End of File: ObjectContainerAction.cs ---



// --- Start of File: ObjectPoolGenericMono.cs ---
using System.Collections.Generic;
using UnityEngine;

public class ObjectPoolGenericMono<T> where T : Component
{
	private readonly List<T> _elements_total = new List<T>();

	private readonly Queue<T> _elements_inactive = new Queue<T>();

	private readonly T _prefab;

	private readonly Transform _parent_transform;

	public ObjectPoolGenericMono(T pPrefab, Transform pParentTransform)
	{
		_prefab = pPrefab;
		_parent_transform = pParentTransform;
	}

	public void clear(bool pDisable = true)
	{
		_elements_inactive.Clear();
		sortElements();
		foreach (T item in _elements_total)
		{
			release(item, pDisable);
		}
	}

	private void sortElements()
	{
		_elements_total.Sort((T a, T b) => ((Component)a).transform.GetSiblingIndex().CompareTo(((Component)b).transform.GetSiblingIndex()));
	}

	public T getFirstActive()
	{
		return _elements_total[0];
	}

	public IReadOnlyList<T> getListTotal()
	{
		return _elements_total;
	}

	public void disableInactive()
	{
		foreach (T item in _elements_inactive)
		{
			if (((Component)item).gameObject.activeSelf)
			{
				((Component)item).gameObject.SetActive(false);
			}
		}
	}

	public T getNext()
	{
		T newOrActivate = getNewOrActivate();
		checkActive(newOrActivate);
		return newOrActivate;
	}

	private T getNewOrActivate()
	{
		T val;
		if (_elements_inactive.Count > 0)
		{
			val = _elements_inactive.Dequeue();
		}
		else
		{
			val = Object.Instantiate<T>(_prefab, _parent_transform);
			_elements_total.Add(val);
			((Object)(object)val).name = typeof(T)?.ToString() + " " + _elements_total.Count + " " + ((Component)val).transform.GetSiblingIndex();
		}
		return val;
	}

	public void release(T pElement, bool pDisable = true)
	{
		if (((Component)_parent_transform).gameObject.activeInHierarchy)
		{
			((Component)pElement).transform.SetAsLastSibling();
		}
		if (!_elements_inactive.Contains(pElement))
		{
			_elements_inactive.Enqueue(pElement);
		}
		if (((Component)pElement).gameObject.activeSelf && pDisable)
		{
			((Component)pElement).gameObject.SetActive(false);
		}
	}

	private void checkActive(T pElement)
	{
		if (!((Component)pElement).gameObject.activeSelf)
		{
			((Component)pElement).gameObject.SetActive(true);
		}
	}

	public int countTotal()
	{
		return _elements_total.Count;
	}

	public int countInactive()
	{
		return _elements_inactive.Count;
	}

	public int countActive()
	{
		return _elements_total.Count - _elements_inactive.Count;
	}

	public void resetParent()
	{
		foreach (T item in _elements_total)
		{
			resetParent(item);
		}
	}

	public void resetParent(T pElement)
	{
		if (((Component)_parent_transform).gameObject.activeInHierarchy)
		{
			((Component)pElement).transform.SetParent(_parent_transform);
		}
	}
}
// --- End of File: ObjectPoolGenericMono.cs ---



// --- Start of File: OceanHelper.cs ---
using System.Collections.Generic;

namespace tools;

public class OceanHelper
{
	private static List<TileIsland> _ocean_pools_with_docks = new List<TileIsland>();

	public static bool goodForNewDock(WorldTile pTile)
	{
		if (!pTile.Type.ocean)
		{
			return false;
		}
		if (pTile.region?.island == null)
		{
			return false;
		}
		if (!pTile.region.island.goodForDocks())
		{
			return false;
		}
		if (_ocean_pools_with_docks.Contains(pTile.region.island))
		{
			return false;
		}
		return true;
	}

	public static void saveOceanPoolsWithDocks(City pCity)
	{
		List<Building> buildingListOfType = pCity.getBuildingListOfType("type_docks");
		if (buildingListOfType == null || buildingListOfType.Count == 0)
		{
			return;
		}
		for (int i = 0; i < buildingListOfType.Count; i++)
		{
			Building building = buildingListOfType[i];
			for (int j = 0; j < building.tiles.Count; j++)
			{
				addOceanPool(building.tiles[j]);
			}
		}
	}

	public static void clearOceanPools()
	{
		_ocean_pools_with_docks.Clear();
	}

	private static void addOceanPool(WorldTile pTile)
	{
		if (pTile.region.island != null && pTile.region.type == TileLayerType.Ocean)
		{
			_ocean_pools_with_docks.Add(pTile.region.island);
		}
	}

	public static WorldTile findTileForBoat(WorldTile pTileBoat, WorldTile pTileTarget)
	{
		WorldTile worldTile = findWaterTileInRegion(pTileTarget.region, pTileBoat);
		if (worldTile == null)
		{
			worldTile = findTileInWholeIsland(pTileTarget.region.island, pTileBoat);
		}
		if (worldTile == null)
		{
			return null;
		}
		for (int i = 0; i < worldTile.neighboursAll.Length; i++)
		{
			WorldTile worldTile2 = worldTile.neighboursAll[i];
			if (worldTile2.isSameIsland(pTileBoat) && worldTile2.isGoodForBoat())
			{
				worldTile = worldTile2;
				break;
			}
		}
		World.world.flash_effects.flashPixel(worldTile);
		return worldTile;
	}

	private static WorldTile findTileInWholeIsland(TileIsland pIslandTarget, WorldTile pTileBoat)
	{
		WorldTile result = null;
		int num = 10;
		float num2 = float.MaxValue;
		foreach (MapRegion item in pIslandTarget.regions.getSimpleList().LoopRandom())
		{
			WorldTile worldTile = findWaterTileInRegion(item, pTileBoat);
			if (worldTile == null)
			{
				continue;
			}
			float num3 = Toolbox.DistTile(pTileBoat, worldTile);
			if (num3 < num2)
			{
				result = worldTile;
				num2 = num3;
				num--;
				if (num <= 0)
				{
					break;
				}
			}
		}
		return result;
	}

	private static WorldTile findWaterTileInRegion(MapRegion pRegion, WorldTile pBoatTile)
	{
		List<WorldTile> edgeTiles = pRegion.getEdgeTiles();
		if (edgeTiles.Count == 0)
		{
			return null;
		}
		foreach (WorldTile item in edgeTiles.LoopRandom())
		{
			if (item.isSameIsland(pBoatTile))
			{
				return item;
			}
		}
		return null;
	}
}
// --- End of File: OceanHelper.cs ---



// --- Start of File: OnChange.cs ---
public delegate void OnChange();
// --- End of File: OnChange.cs ---



// --- Start of File: OnKnowledgeIconClick.cs ---
public delegate void OnKnowledgeIconClick(KnowledgeAsset pAsset);
// --- End of File: OnKnowledgeIconClick.cs ---



// --- Start of File: OnlineStats.cs ---
using System;

[Serializable]
public class OnlineStats
{
	public int downloads;

	public int plays;

	public int favs;

	public int reports;
}
// --- End of File: OnlineStats.cs ---



// --- Start of File: OnomasticsActionUpdate.cs ---
public delegate void OnomasticsActionUpdate();
// --- End of File: OnomasticsActionUpdate.cs ---



// --- Start of File: OnomasticsAsset.cs ---
using System;
using System.ComponentModel;
using UnityEngine;

[Serializable]
public class OnomasticsAsset : Asset, IDescription2Asset, IDescriptionAsset, ILocalizedAsset
{
	public OnomasticsAssetType type;

	public string path_icon;

	public string color_text = "#FF0000";

	[NonSerialized]
	private Sprite _cached_sprite;

	public bool affects_left;

	public bool affects_left_word;

	public bool affects_left_group_only;

	public bool affects_everything;

	public bool is_divider;

	public bool is_upper;

	public bool is_word_divider;

	public bool is_immune;

	[DefaultValue(-1)]
	public int group_id = -1;

	[DefaultValue('?')]
	public char short_id = '?';

	[DefaultValue("")]
	public string forced_locale_subname_id = string.Empty;

	[DefaultValue("")]
	public string forced_locale_description_id = string.Empty;

	[DefaultValue("")]
	public string forced_locale_description_id_2 = string.Empty;

	public OnomasticsNameMakerDelegate namemaker_delegate;

	public OnomasticsCheckDelegate check_delegate;

	public bool isGroupType()
	{
		return type == OnomasticsAssetType.Group;
	}

	public Sprite getSprite()
	{
		if (_cached_sprite == null)
		{
			_cached_sprite = SpriteTextureLoader.getSprite(path_icon);
		}
		return _cached_sprite;
	}

	public string getLocaleID()
	{
		return "onomastics_" + id;
	}

	public string getIDSubname()
	{
		if (forced_locale_subname_id != string.Empty)
		{
			return forced_locale_subname_id;
		}
		return "onomastics_" + id + "_subname";
	}

	public string getDescriptionID()
	{
		if (forced_locale_description_id != string.Empty)
		{
			return forced_locale_description_id;
		}
		return getLocaleID() + "_info";
	}

	public string getDescriptionID2()
	{
		if (forced_locale_description_id_2 != string.Empty)
		{
			return forced_locale_description_id_2;
		}
		return getLocaleID() + "_info_2";
	}
}
// --- End of File: OnomasticsAsset.cs ---



// --- Start of File: OnomasticsAssetButton.cs ---
using System;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.UI;

public class OnomasticsAssetButton : MonoBehaviour
{
	private bool _created;

	internal Image image;

	internal bool tooltip_enabled = true;

	internal Button button;

	public OnomasticsAsset onomastics_asset;

	public OnomasticsActionUpdate onomastics_action_update;

	private GetCurrentOnomasticsData _get_current_onomastics_data;

	private void Awake()
	{
		create();
		DraggableLayoutElement draggableLayoutElement = default(DraggableLayoutElement);
		if (((Component)this).TryGetComponent<DraggableLayoutElement>(ref draggableLayoutElement))
		{
			DraggableLayoutElement draggableLayoutElement2 = draggableLayoutElement;
			draggableLayoutElement2.start_being_dragged = (Action<DraggableLayoutElement>)Delegate.Combine(draggableLayoutElement2.start_being_dragged, new Action<DraggableLayoutElement>(onStartDrag));
		}
	}

	protected virtual void onStartDrag(DraggableLayoutElement pOriginalElement)
	{
		OnomasticsAssetButton component = ((Component)pOriginalElement).GetComponent<OnomasticsAssetButton>();
		setupButton(component.onomastics_asset, component._get_current_onomastics_data);
	}

	public void setupButton(OnomasticsAsset pAsset, GetCurrentOnomasticsData pDelegate)
	{
		loadAsset(pAsset);
		setOnomasticsGetter(pDelegate);
		checkSpriteButtonColor();
	}

	public RectTransform getRect()
	{
		return ((Component)this).GetComponent<RectTransform>();
	}

	private void Update()
	{
		checkSpriteButtonColor();
	}

	public bool isGroupType()
	{
		return onomastics_asset.isGroupType();
	}

	private bool doesGroupHaveContent()
	{
		if (_get_current_onomastics_data == null)
		{
			return true;
		}
		OnomasticsData onomasticsData = _get_current_onomastics_data();
		if (onomasticsData == null || onomastics_asset == null)
		{
			return false;
		}
		if (!isGroupType())
		{
			return true;
		}
		return !onomasticsData.isGroupEmpty(onomastics_asset.id);
	}

	public void checkSpriteButtonColor()
	{
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		if (doesGroupHaveContent())
		{
			((Graphic)image).color = Color.white;
		}
		else
		{
			((Graphic)image).color = Color.gray;
		}
	}

	public void setOnomasticsGetter(GetCurrentOnomasticsData pDelegate)
	{
		_get_current_onomastics_data = pDelegate;
	}

	private void Start()
	{
		TipButton tipButton = default(TipButton);
		if (!((Component)this).TryGetComponent<TipButton>(ref tipButton))
		{
			return;
		}
		tipButton.setHoverAction(delegate
		{
			if (InputHelpers.mouseSupported)
			{
				showTooltip();
			}
		});
	}

	public void loadAsset(OnomasticsAsset pAsset)
	{
		onomastics_asset = pAsset;
		image.sprite = onomastics_asset.getSprite();
	}

	public void showTooltip()
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		if (tooltip_enabled)
		{
			tooltipBuilder();
			((Component)this).transform.localScale = new Vector3(1.2f, 1.2f, 1.2f);
			ShortcutExtensions.DOKill((Component)(object)((Component)this).transform, false);
			TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).transform, 1f, 0.1f), (Ease)26);
		}
	}

	private void tooltipBuilder()
	{
		Tooltip.show(this, "onomastics_asset", new TooltipData
		{
			onomastics_asset = onomastics_asset,
			onomastics_data = _get_current_onomastics_data()
		});
	}

	private void create()
	{
		if (!_created)
		{
			_created = true;
			button = ((Component)this).GetComponent<Button>();
			image = ((Component)((Component)this).transform.Find("TiltEffect/icon")).GetComponent<Image>();
		}
	}

	private void OnDestroy()
	{
		ShortcutExtensions.DOKill((Component)(object)((Component)this).transform, false);
	}
}
// --- End of File: OnomasticsAssetButton.cs ---



// --- Start of File: OnomasticsAssetType.cs ---
public enum OnomasticsAssetType
{
	Group,
	Special
}
// --- End of File: OnomasticsAssetType.cs ---



// --- Start of File: OnomasticsButtonAction.cs ---
public delegate void OnomasticsButtonAction();
// --- End of File: OnomasticsButtonAction.cs ---



// --- Start of File: OnomasticsCache.cs ---
using System;
using System.Collections.Generic;

public static class OnomasticsCache
{
	[ThreadStatic]
	private static Dictionary<string, OnomasticsData> _cache;

	public static OnomasticsData getOriginalData(string pShortTemplate)
	{
		if (_cache == null)
		{
			_cache = new Dictionary<string, OnomasticsData>();
		}
		if (!_cache.TryGetValue(pShortTemplate, out var value))
		{
			value = new OnomasticsData();
			value.loadFromShortTemplate(pShortTemplate);
			_cache.Add(pShortTemplate, value);
		}
		return value;
	}
}
// --- End of File: OnomasticsCache.cs ---



// --- Start of File: OnomasticsCheckDelegate.cs ---
public delegate bool OnomasticsCheckDelegate(OnomasticsAsset pAsset, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex);
// --- End of File: OnomasticsCheckDelegate.cs ---



// --- Start of File: OnomasticsData.cs ---
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;

public class OnomasticsData : IDisposable
{
	public const char SEPARATOR_GROUPS = '|';

	public const char SEPARATOR_PARTS = ';';

	public const char SEPARATOR_PART_CONTAINER = ':';

	public const int MAX_NAME_LENGTH = 30;

	public Dictionary<string, OnomasticsDataGroup> groups = new Dictionary<string, OnomasticsDataGroup>();

	private List<string> _template_data = new List<string>();

	private List<string> _current_subgroup = new List<string>();

	public const string DEFAULT_NAME_FAILED = "Rebr";

	public void setTemplateData(IReadOnlyList<string> pTemplateData)
	{
		_template_data.Clear();
		_template_data.AddRange(pTemplateData);
	}

	public List<string> getFullTemplateData()
	{
		return _template_data;
	}

	public List<string> getCurrentSubgroup()
	{
		return _current_subgroup;
	}

	public void addToTemplateData(string pID)
	{
		_template_data.Add(pID);
	}

	public void shuffleAllCards()
	{
		_template_data.Shuffle();
	}

	public void clearTemplateData()
	{
		_template_data.Clear();
	}

	public string getGroupString(string pGroupID)
	{
		if (tryGetGroup(pGroupID, out var pGroup))
		{
			return pGroup.characters_string;
		}
		return null;
	}

	public bool isGroupEmpty(string pGroupID)
	{
		OnomasticsDataGroup group = getGroup(pGroupID);
		return isGroupEmpty(group);
	}

	public bool isGroupEmpty(OnomasticsDataGroup pGroup)
	{
		if (pGroup == null || pGroup.isEmpty())
		{
			return true;
		}
		return false;
	}

	public OnomasticsDataGroup getGroup(string pGroupID)
	{
		groups.TryGetValue(pGroupID, out var value);
		return value;
	}

	public bool tryGetGroup(string pGroupID, out OnomasticsDataGroup pGroup)
	{
		if (groups.TryGetValue(pGroupID, out pGroup))
		{
			return !pGroup.isEmpty();
		}
		return false;
	}

	public string getRandomPartFromGroup(string pGroupID)
	{
		if (tryGetGroup(pGroupID, out var pGroup))
		{
			return pGroup.characters.GetRandom();
		}
		return string.Empty;
	}

	private bool saveGroup(string pGroupID, string pCharacters)
	{
		bool result = true;
		if (!groups.TryGetValue(pGroupID, out var value))
		{
			value = new OnomasticsDataGroup();
			groups.Add(pGroupID, value);
			result = false;
		}
		string characters_string = value.characters_string;
		pCharacters = pCharacters.Replace("\n", " ");
		pCharacters = pCharacters.Replace("\r", " ");
		while (pCharacters.Contains("  "))
		{
			pCharacters = pCharacters.Replace("  ", " ");
		}
		pCharacters = pCharacters.Trim('\n', '\r', ' ');
		if (pCharacters.Length == 0)
		{
			value.characters_string = string.Empty;
			value.characters = null;
		}
		else
		{
			string[] array = pCharacters.Split(' ', StringSplitOptions.RemoveEmptyEntries);
			Array.Sort(array, (IComparer<string>?)StringComparer.OrdinalIgnoreCase);
			value.characters_string = string.Join(' ', array);
			value.characters = array;
		}
		if (string.Equals(characters_string, value.characters_string, StringComparison.OrdinalIgnoreCase))
		{
			result = false;
		}
		return result;
	}

	public void cloneFrom(OnomasticsData pOriginalData)
	{
		_template_data.AddRange(pOriginalData._template_data);
		foreach (KeyValuePair<string, OnomasticsDataGroup> group in pOriginalData.groups)
		{
			setGroup(group.Key, group.Value.characters_string);
		}
	}

	public void setDebugTest()
	{
		loadFromShortTemplate("0312|0:pl p s l d b;1:mp rp rt b;2:kin tin le ee;3:a e i o u y oo");
	}

	internal static bool hasCheckOnTheRight(OnomasticsData pData, int pIndex)
	{
		List<string> currentSubgroup = pData.getCurrentSubgroup();
		int num = pIndex + 1;
		if (num >= currentSubgroup.Count)
		{
			return false;
		}
		string pID = currentSubgroup[num];
		return AssetManager.onomastics_library.get(pID).check_delegate != null;
	}

	internal static bool passesCheckOnTheRight(OnomasticsData pData, StringBuilderPool pLocalNameBuilder, string pLastPart, int pIndex, ActorSex pSex)
	{
		List<string> currentSubgroup = pData.getCurrentSubgroup();
		int num = pIndex + 1;
		if (num >= currentSubgroup.Count)
		{
			return true;
		}
		string pID = currentSubgroup[num];
		OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(pID);
		bool flag = onomasticsAsset.check_delegate(onomasticsAsset, pData, pLocalNameBuilder, pLastPart, num, pSex);
		if (flag && hasCheckOnTheRight(pData, num))
		{
			return passesCheckOnTheRight(pData, pLocalNameBuilder, pLastPart, num, pSex);
		}
		return flag;
	}

	public string generateName(ActorSex pSex = ActorSex.None, int pCalls = 0, long? pSeed = null)
	{
		if (pCalls > 100)
		{
			return "Rebr";
		}
		if (pSex == ActorSex.None)
		{
			pSex = (Randy.randomBool() ? ActorSex.Female : ActorSex.Male);
		}
		string pLastPart = string.Empty;
		if (pSeed.HasValue)
		{
			Randy.resetSeed(pSeed.Value);
		}
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		using ListPool<string> collection = getSubgroup(_template_data);
		_current_subgroup.Clear();
		_current_subgroup.AddRange(collection);
		int count = _current_subgroup.Count;
		bool flag = false;
		for (int i = 0; i < count; i++)
		{
			string pID = _current_subgroup[i];
			OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(pID);
			if (hasCheckOnTheRight(this, i) && !passesCheckOnTheRight(this, stringBuilderPool, pLastPart, i, pSex))
			{
				continue;
			}
			OnomasticsAssetType type = onomasticsAsset.type;
			if ((uint)type <= 1u)
			{
				string text = onomasticsAsset.namemaker_delegate?.Invoke(onomasticsAsset, this, stringBuilderPool, pLastPart, i, pSex);
				if (text != null && text.Length > 0)
				{
					pLastPart = text;
					stringBuilderPool.Append(text);
				}
				if (onomasticsAsset.is_upper)
				{
					flag = true;
				}
			}
		}
		stringBuilderPool.Remove(',');
		stringBuilderPool.TrimEnd(' ', '-');
		if (stringBuilderPool.Length > 30)
		{
			stringBuilderPool.Cut(0, 30);
		}
		if (stringBuilderPool.Length == 0)
		{
			return generateName(pSex, ++pCalls);
		}
		if (Blacklist.checkBlackList(stringBuilderPool))
		{
			return generateName(pSex, ++pCalls);
		}
		if (flag)
		{
			stringBuilderPool.ToUpperInvariant();
		}
		else
		{
			stringBuilderPool.ToTitleCase();
		}
		return stringBuilderPool.ToString();
	}

	private ListPool<string> getSubgroup(List<string> pTemplateData)
	{
		int num = countDividers(pTemplateData) + 1;
		if (num > 1)
		{
			int pIndex = Randy.randomInt(0, num);
			return getSubgroupByIndex(pIndex);
		}
		return new ListPool<string>(pTemplateData);
	}

	private ListPool<string> getSubgroupByIndex(int pIndex)
	{
		ListPool<string> listPool = new ListPool<string>();
		int num = 0;
		foreach (string template_datum in _template_data)
		{
			if (template_datum == "divider")
			{
				num++;
				if (num > pIndex)
				{
					break;
				}
			}
			else if (num == pIndex)
			{
				listPool.Add(template_datum);
			}
		}
		return listPool;
	}

	private static int countDividers(List<string> pTemplateData)
	{
		int num = 0;
		foreach (string pTemplateDatum in pTemplateData)
		{
			if (pTemplateDatum == "divider")
			{
				num++;
			}
		}
		return num;
	}

	public static string convertToCultureTitleCase(string pString)
	{
		string text = CultureInfo.InvariantCulture.TextInfo.ToTitleCase(pString.ToLower());
		if (text.Contains('\''))
		{
			text = capitalizeAfterApostrophe(text);
		}
		return text;
	}

	private static string capitalizeAfterApostrophe(string pInput)
	{
		TextInfo textInfo = CultureInfo.InvariantCulture.TextInfo;
		char[] array = pInput.ToCharArray();
		bool flag = false;
		for (int i = 0; i < array.Length; i++)
		{
			if (flag && char.IsLetter(array[i]))
			{
				array[i] = textInfo.ToUpper(array[i]);
				flag = false;
			}
			if (array[i] == '\'')
			{
				flag = true;
			}
		}
		return new string(array);
	}

	public string getShortTemplate()
	{
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		foreach (string template_datum in _template_data)
		{
			OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(template_datum);
			stringBuilderPool.Append(onomasticsAsset.short_id);
		}
		stringBuilderPool.Append('|');
		bool flag = true;
		foreach (KeyValuePair<string, OnomasticsDataGroup> item in groups.OrderBy((KeyValuePair<string, OnomasticsDataGroup> p) => AssetManager.onomastics_library.get(p.Key).short_id))
		{
			if (!item.Value.isEmpty())
			{
				if (!flag)
				{
					stringBuilderPool.Append(';');
				}
				OnomasticsAsset onomasticsAsset2 = AssetManager.onomastics_library.get(item.Key);
				stringBuilderPool.Append(onomasticsAsset2.short_id);
				stringBuilderPool.Append(':');
				stringBuilderPool.Append(item.Value.characters_string.ToLower());
				flag = false;
			}
		}
		return stringBuilderPool.ToString();
	}

	public bool templateIsValid(string pShortTemplate)
	{
		if (string.IsNullOrEmpty(pShortTemplate))
		{
			return false;
		}
		if (!pShortTemplate.Contains('|'))
		{
			return false;
		}
		if (pShortTemplate.Split('|').Length != 2)
		{
			return false;
		}
		return true;
	}

	public void loadFromShortTemplate(string pShortTemplate)
	{
		if (string.IsNullOrEmpty(pShortTemplate))
		{
			pShortTemplate = "|";
		}
		if (!pShortTemplate.Contains('|'))
		{
			throw new ArgumentException("Invalid template format: (NS) " + pShortTemplate);
		}
		pShortTemplate = pShortTemplate.Trim('\n', '\r', ' ', '"', '`');
		if (pShortTemplate.Contains('\n'))
		{
			throw new ArgumentException("Invalid template format: (NL) " + pShortTemplate);
		}
		if (pShortTemplate.Contains('\r'))
		{
			throw new ArgumentException("Invalid template format: (NL) " + pShortTemplate);
		}
		string[] array = pShortTemplate.Split('|');
		if (array.Length != 2)
		{
			throw new ArgumentException($"Invalid template format: (L{array.Length}) " + pShortTemplate);
		}
		char[] array2 = array[0].ToCharArray();
		using ListPool<string> listPool = new ListPool<string>(array2.Length);
		char[] array3 = array2;
		for (int i = 0; i < array3.Length; i++)
		{
			char c = array3[i];
			OnomasticsAsset byShortId = AssetManager.onomastics_library.getByShortId(c.ToString());
			if (byShortId != null)
			{
				listPool.Add(byShortId.id);
				continue;
			}
			throw new ArgumentException($"Invalid template format: (0{c}) " + pShortTemplate);
		}
		setTemplateData(listPool);
		string[] array4 = array[1].Split(';');
		groups.Clear();
		string[] array5 = array4;
		for (int i = 0; i < array5.Length; i++)
		{
			string[] array6 = array5[i].Split(':');
			if (array6.Length == 2)
			{
				string text = array6[0];
				string pCharacters = array6[1];
				OnomasticsAsset byShortId2 = AssetManager.onomastics_library.getByShortId(text);
				if (byShortId2 == null)
				{
					throw new ArgumentException("Invalid template format: (G" + text + ") " + pShortTemplate);
				}
				saveGroup(byShortId2.id, pCharacters);
			}
		}
	}

	public bool isGendered()
	{
		foreach (string template_datum in _template_data)
		{
			OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(template_datum);
			if (onomasticsAsset.id == "sex_male" || onomasticsAsset.id == "sex_female")
			{
				return true;
			}
		}
		return false;
	}

	public bool isEmpty()
	{
		return _template_data.Count == 0;
	}

	public bool setGroup(string pID, string pString)
	{
		return saveGroup(pID, pString);
	}

	public void Dispose()
	{
		groups.Clear();
		groups = null;
		_template_data.Clear();
		_template_data = null;
		_current_subgroup.Clear();
		_current_subgroup = null;
	}
}
// --- End of File: OnomasticsData.cs ---



// --- Start of File: OnomasticsDataGroup.cs ---
public class OnomasticsDataGroup
{
	public string[] characters;

	public string characters_string;

	public bool isEmpty()
	{
		if (characters != null)
		{
			return characters.Length == 0;
		}
		return true;
	}
}
// --- End of File: OnomasticsDataGroup.cs ---



// --- Start of File: OnomasticsDropdown.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class OnomasticsDropdown : MonoBehaviour, IPointerClickHandler, IEventSystemHandler
{
	[SerializeField]
	private OnomasticsTab _onomastics_tab;

	private Button _button;

	private Dropdown _dropdown;

	private List<string> _options;

	internal static string current_template;

	internal static int current_template_index;

	private void Start()
	{
		_dropdown = ((Component)this).GetComponent<Dropdown>();
		createDropdownOptions();
		((UnityEvent<int>)(object)_dropdown.onValueChanged).AddListener((UnityAction<int>)dropdownValueChanged);
	}

	private void createDropdownOptions()
	{
		_dropdown.ClearOptions();
		_options = new List<string>();
		_options.Add("");
		foreach (NameGeneratorAsset item in AssetManager.name_generator.list)
		{
			if (item.onomastics_templates.Count < 1)
			{
				_options.Add("<color=red>" + item.id + "</color>");
				continue;
			}
			if (item.onomastics_templates.Count < 2)
			{
				_options.Add(item.id);
				continue;
			}
			for (int i = 0; i < item.onomastics_templates.Count; i++)
			{
				_options.Add(item.id + "#" + i);
			}
		}
		_options.Sort((string a, string b) => Toolbox.removeRichTextTags(a).CompareTo(Toolbox.removeRichTextTags(b)));
		_dropdown.AddOptions(_options);
	}

	private void dropdownValueChanged(int pOption)
	{
		if (pOption < 0 || pOption >= _dropdown.options.Count)
		{
			return;
		}
		string text = _dropdown.options[pOption].text;
		if (string.IsNullOrEmpty(text))
		{
			return;
		}
		text = Toolbox.removeRichTextTags(text);
		int result = 0;
		if (text.Contains('#'))
		{
			string[] array = text.Split('#');
			text = array[0];
			if (!int.TryParse(array[1], out result))
			{
				return;
			}
		}
		NameGeneratorAsset nameGeneratorAsset = AssetManager.name_generator.get(text);
		if (nameGeneratorAsset != null)
		{
			current_template = text;
			current_template_index = result;
			string pTemplate = null;
			if (result >= 0 && result < nameGeneratorAsset.onomastics_templates.Count)
			{
				pTemplate = nameGeneratorAsset.onomastics_templates[result];
			}
			_onomastics_tab.loadTemplate(pTemplate);
		}
	}

	public void OnPointerClick(PointerEventData pEventData)
	{
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Invalid comparison between Unknown and I4
		if ((Object)(object)((BaseEventData)pEventData).selectedObject == (Object)null || (Object)(object)((BaseEventData)pEventData).selectedObject.GetComponentInChildren<Scrollbar>() != (Object)null || !((UIBehaviour)_dropdown).IsActive() || !((Selectable)_dropdown).IsInteractable())
		{
			return;
		}
		ScrollRect componentInChildren = ((Component)this).gameObject.GetComponentInChildren<ScrollRect>();
		Scrollbar val = ((componentInChildren != null) ? componentInChildren.verticalScrollbar : null);
		if (_options.Count > 1 && (Object)(object)val != (Object)null)
		{
			if ((int)val.direction == 3)
			{
				val.value = Mathf.Max(0.001f, (float)_dropdown.value / (float)(_options.Count - 1));
			}
			else
			{
				val.value = Mathf.Max(0.001f, 1f - (float)_dropdown.value / (float)(_options.Count - 1));
			}
		}
	}
}
// --- End of File: OnomasticsDropdown.cs ---



// --- Start of File: OnomasticsEvolutionAsset.cs ---
using System;
using System.ComponentModel;

[Serializable]
public class OnomasticsEvolutionAsset : Asset
{
	public string from;

	public string to;

	public char[] not_surrounded_by;

	[DefaultValue(true)]
	public bool reverse = true;

	public OnomasticsReplacerDelegate replacer;
}
// --- End of File: OnomasticsEvolutionAsset.cs ---



// --- Start of File: OnomasticsEvolutionLibrary.cs ---
public class OnomasticsEvolutionLibrary : AssetLibrary<OnomasticsEvolutionAsset>
{
	private static readonly char[] _vowels = AssetLibrary<OnomasticsEvolutionAsset>.a<char>('a', 'e', 'i', 'o', 'u', 'y');

	private static readonly char[] _vowels_h = AssetLibrary<OnomasticsEvolutionAsset>.a<char>('a', 'e', 'i', 'o', 'u', 'y', 'h');

	private static readonly char[] _consonants = AssetLibrary<OnomasticsEvolutionAsset>.a<char>('b', 'c', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'm', 'n', 'p', 'q', 'r', 's', 't', 'v', 'w', 'x', 'z');

	public override void init()
	{
		base.init();
		add(new OnomasticsEvolutionAsset
		{
			from = "k",
			to = "c",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "g",
			to = "k",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "f",
			to = "v",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "g",
			to = "gh",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "f",
			to = "gh",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "v",
			to = "b",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ci",
			to = "z",
			not_surrounded_by = _consonants,
			replacer = replace_not_in_start
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "s",
			to = "z",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "t",
			to = "d",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ks",
			to = "x",
			not_surrounded_by = _consonants,
			replacer = replace_not_in_start
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "th",
			to = "f",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "th",
			to = "d",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "thi",
			to = "ti",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "er",
			to = "ar",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "sh",
			to = "sch",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "sh",
			to = "sz",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ch",
			to = "cz",
			not_surrounded_by = _consonants,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "mm",
			to = "m",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "mn",
			to = "m",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "gg",
			to = "g",
			not_surrounded_by = _consonants,
			replacer = replace_not_in_start
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "nn",
			to = "n",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "mm",
			to = "hm",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ph",
			to = "f",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ph",
			to = "pp",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "p",
			to = "pp",
			not_surrounded_by = _consonants,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ck",
			to = "k",
			not_surrounded_by = _consonants,
			replacer = replace_not_in_start
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ck",
			to = "gg",
			not_surrounded_by = _consonants,
			replacer = replace_not_in_start
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "e",
			to = "ai",
			not_surrounded_by = _vowels,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "e",
			to = "a",
			not_surrounded_by = _vowels,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "o",
			to = "a",
			not_surrounded_by = _vowels,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "u",
			to = "y",
			not_surrounded_by = _vowels,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ie",
			to = "y",
			not_surrounded_by = _vowels,
			replacer = replace_in_end
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "i",
			to = "y",
			not_surrounded_by = _vowels,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "y",
			to = "oe",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "e",
			to = "ae",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "a",
			to = "au",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "o",
			to = "au",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oo",
			to = "ou",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oo",
			to = "ue",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oo",
			to = "oa",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oo",
			to = "u",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ee",
			to = "i",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ie",
			to = "e",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ei",
			to = "ee",
			not_surrounded_by = _vowels,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ea",
			to = "ee",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ea",
			to = "ei",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ear",
			to = "ere",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "re",
			to = "ru",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "sp",
			to = "shp",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "sht",
			to = "st",
			not_surrounded_by = _vowels_h,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "u",
			to = "oe",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "o",
			to = "oe",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oh",
			to = "oe",
			not_surrounded_by = _vowels,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ah",
			to = "ae",
			not_surrounded_by = _vowels,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oe",
			to = "u",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oe",
			to = "oh",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ae",
			to = "ah",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ah",
			to = "oh",
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "a",
			to = "ah",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "o",
			to = "oh",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "u",
			to = "uh",
			not_surrounded_by = _vowels_h,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "ah",
			to = "a",
			not_surrounded_by = _vowels,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "oh",
			to = "o",
			not_surrounded_by = _vowels,
			reverse = false,
			replacer = replace
		});
		add(new OnomasticsEvolutionAsset
		{
			from = "uh",
			to = "u",
			not_surrounded_by = _vowels,
			reverse = false,
			replacer = replace
		});
	}

	public static bool replace(OnomasticsEvolutionAsset pAsset, ref string pReplace)
	{
		if (!pReplace.Contains(pAsset.from))
		{
			return false;
		}
		int random = pReplace.AllIndexesOf(pAsset.from).GetRandom();
		char c = ((random > 0) ? pReplace[random - 1] : ' ');
		char c2 = ((random + pAsset.from.Length < pReplace.Length) ? pReplace[random + pAsset.from.Length] : ' ');
		char c3 = pAsset.to.First();
		char c4 = pAsset.to.Last();
		if (c == c4)
		{
			return false;
		}
		if (c == c3)
		{
			return false;
		}
		if (c2 == c3)
		{
			return false;
		}
		if (c2 == c4)
		{
			return false;
		}
		char[] not_surrounded_by = pAsset.not_surrounded_by;
		if (not_surrounded_by != null && not_surrounded_by.Contains(c))
		{
			return false;
		}
		char[] not_surrounded_by2 = pAsset.not_surrounded_by;
		if (not_surrounded_by2 != null && not_surrounded_by2.Contains(c2))
		{
			return false;
		}
		pReplace = pReplace.Remove(random, pAsset.from.Length).Insert(random, pAsset.to);
		return true;
	}

	public static bool replace_in_end(OnomasticsEvolutionAsset pAsset, ref string pReplace)
	{
		if (!pReplace.Contains(pAsset.from))
		{
			return false;
		}
		int num = pReplace.LastIndexOf(pAsset.from);
		if (num + pAsset.from.Length != pReplace.Length)
		{
			return false;
		}
		char c = ((num > 0) ? pReplace[num - 1] : ' ');
		char c2 = ((num + pAsset.from.Length < pReplace.Length) ? pReplace[num + pAsset.from.Length] : ' ');
		char c3 = pAsset.to.First();
		char c4 = pAsset.to.Last();
		if (c == c4)
		{
			return false;
		}
		if (c == c3)
		{
			return false;
		}
		if (c2 == c3)
		{
			return false;
		}
		if (c2 == c4)
		{
			return false;
		}
		char[] not_surrounded_by = pAsset.not_surrounded_by;
		if (not_surrounded_by != null && not_surrounded_by.Contains(c))
		{
			return false;
		}
		char[] not_surrounded_by2 = pAsset.not_surrounded_by;
		if (not_surrounded_by2 != null && not_surrounded_by2.Contains(c2))
		{
			return false;
		}
		pReplace = pReplace.Remove(num, pAsset.from.Length).Insert(num, pAsset.to);
		return true;
	}

	public static bool replace_not_in_start(OnomasticsEvolutionAsset pAsset, ref string pReplace)
	{
		if (!pReplace.Contains(pAsset.from))
		{
			return false;
		}
		if (pReplace.IndexOf(pAsset.from) == 0)
		{
			return false;
		}
		return replace(pAsset, ref pReplace);
	}

	public override OnomasticsEvolutionAsset add(OnomasticsEvolutionAsset pAsset)
	{
		pAsset.id = pAsset.from + "_" + pAsset.to;
		t = base.add(pAsset);
		if (t.reverse)
		{
			return add(new OnomasticsEvolutionAsset
			{
				id = t.to + "_" + t.from,
				from = t.to,
				to = t.from,
				not_surrounded_by = t.not_surrounded_by,
				replacer = t.replacer,
				reverse = false
			});
		}
		return t;
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (OnomasticsEvolutionAsset item in list)
		{
			OnomasticsEvolver.add(item);
			if (item.from.Length >= item.to.Length)
			{
				OnomasticsEvolver.add(item);
				OnomasticsEvolver.add(item);
			}
			if (item.from.Length > item.to.Length)
			{
				OnomasticsEvolver.add(item);
				OnomasticsEvolver.add(item);
			}
		}
		OnomasticsEvolver.shuffle();
	}
}
// --- End of File: OnomasticsEvolutionLibrary.cs ---



// --- Start of File: OnomasticsEvolver.cs ---
using System;
using System.Collections.Generic;

public static class OnomasticsEvolver
{
	private static List<OnomasticsEvolutionAsset> _pool = new List<OnomasticsEvolutionAsset>();

	private static Dictionary<int, bool> _replaced = new Dictionary<int, bool>();

	public static void add(OnomasticsEvolutionAsset pEvolution)
	{
		_pool.Add(pEvolution);
	}

	public static void shuffle()
	{
		_pool.Shuffle();
	}

	public static bool scramble(OnomasticsData pData)
	{
		int num = 0;
		foreach (KeyValuePair<string, OnomasticsDataGroup> group in pData.groups)
		{
			OnomasticsDataGroup value = group.Value;
			if (value.isEmpty())
			{
				continue;
			}
			_replaced.Clear();
			string[] array = value.characters_string.Split(' ', StringSplitOptions.RemoveEmptyEntries);
			for (int i = 0; i < array.Length; i++)
			{
				_replaced.Add(i, value: false);
			}
			int num2 = 0;
			for (int j = 0; j < _pool.Count; j++)
			{
				if (num2 >= 7)
				{
					continue;
				}
				OnomasticsEvolutionAsset onomasticsEvolutionAsset = _pool[j];
				bool flag = false;
				if (array.Contains(onomasticsEvolutionAsset.to))
				{
					continue;
				}
				for (int k = 0; k < array.Length; k++)
				{
					if (!_replaced[k])
					{
						string pReplace = array[k];
						if (onomasticsEvolutionAsset.replacer(onomasticsEvolutionAsset, ref pReplace))
						{
							flag = true;
							_replaced[k] = true;
						}
						array[k] = pReplace;
					}
				}
				if (flag)
				{
					num2++;
				}
			}
			value.characters_string = string.Join(' ', array);
			value.characters = array;
			if (num2 > 0)
			{
				num++;
			}
		}
		return num > 0;
	}
}
// --- End of File: OnomasticsEvolver.cs ---



// --- Start of File: OnomasticsLibrary.cs ---
using System;
using System.Collections.Generic;
using Unity.Mathematics;
using UnityEngine;

public class OnomasticsLibrary : AssetLibrary<OnomasticsAsset>
{
	private Dictionary<string, OnomasticsAsset> _dict_short_id = new Dictionary<string, OnomasticsAsset>();

	[NonSerialized]
	public List<OnomasticsAsset> list_special = new List<OnomasticsAsset>();

	private static readonly char[] _word_separators = new char[3] { ' ', ',', '-' };

	private static Random _rand = default(Random);

	private Dictionary<string, string> _test_templates = new Dictionary<string, string>
	{
		{ "01|0:a;1:b", "Ab" },
		{ "0_1|0:a;1:b", "A B" },
		{ "01b|0:a;1:b", "A" },
		{ "o|0:a;1:b;2:c;5:f", "Abcf" },
		{ "110c|0:a;1:b", "Bab" },
		{ "001c|0:a;1:b", "Aa" },
		{ "001v|0:a;1:b", "Aba" },
		{ "110v|0:a;1:b", "Bb" },
		{ "110C|0:a;1:b", "Bba" },
		{ "001C|0:a;1:b", "Aa" },
		{ "001V|0:a;1:b", "Aab" },
		{ "110V|0:a;1:b", "Bb" },
		{ "10E|0:a;1:b", "A" },
		{ "01E|0:a;1:b", "A" },
		{ "01e|0:a;1:b", "B" },
		{ "10e|0:a;1:b", "B" },
		{ "1,10E|0:a;1:b", "Ba" },
		{ "1-10E|0:a;1:b", "B-A" },
		{ "0,01e|0:a;1:b", "Ab" },
		{ "0-01e|0:a;1:b", "A-B" },
		{ "01D|0:a;1:b", "Abb" },
		{ "00D|0:a;1:b", "Aa" },
		{ "01d|0:a;1:b", "Aab" },
		{ "11d|0:a;1:b", "Bb" },
		{ "0r|0:a", "Aaa" },
		{ "0rr|0:a", "Aaaaaaa" },
		{ "0rbu|0:a", "AA" }
	};

	public override void init()
	{
		base.init();
		addGroups();
		addDice();
		addUnique();
		addSpecialCharacters();
		addVowelConsonantSpecials();
		addSexes();
	}

	private void addUnique()
	{
		add(new OnomasticsAsset
		{
			id = "clone_last",
			short_id = 'l',
			color_text = "#EB2931",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _) => (pStringBuilder.Length == 0) ? string.Empty : getLastWord(pStringBuilder),
			affects_left_word = true
		});
		add(new OnomasticsAsset
		{
			id = "coin_flip",
			short_id = 'f',
			color_text = "#F5C308",
			type = OnomasticsAssetType.Special,
			check_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool _, string _, int _, ActorSex _) => Randy.randomBool(),
			affects_left = true
		});
		add(new OnomasticsAsset
		{
			id = "mirror",
			short_id = 'm',
			color_text = "#FFFFFF",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _) => (pStringBuilder.Length == 0) ? string.Empty : getLastWord(pStringBuilder).Reverse(),
			affects_left_word = true
		});
		add(new OnomasticsAsset
		{
			id = "wild_6",
			short_id = 'w',
			color_text = "#A1B1A2",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex)
			{
				using ListPool<string> listPool = new ListPool<string>(pData.groups.Count);
				foreach (KeyValuePair<string, OnomasticsDataGroup> group in pData.groups)
				{
					if (!group.Value.isEmpty() && AssetManager.onomastics_library.get(group.Key).group_id < 6)
					{
						listPool.Add(group.Key);
					}
				}
				if (listPool.Count == 0)
				{
					return string.Empty;
				}
				string random = GetRandom(listPool);
				OnomasticsAsset onomasticsAsset3 = AssetManager.onomastics_library.get(random);
				return onomasticsAsset3.namemaker_delegate(onomasticsAsset3, pData, pStringBuilder, pLastPart, pIndex, pSex);
			}
		});
		add(new OnomasticsAsset
		{
			id = "domino",
			short_id = 'o',
			color_text = "#7FA9BC",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex)
			{
				string text2 = "";
				for (int j = 0; j < 6; j++)
				{
					string pID = $"group_{j + 1}";
					OnomasticsAsset onomasticsAsset2 = AssetManager.onomastics_library.get(pID);
					text2 += onomasticsAsset2.namemaker_delegate(onomasticsAsset2, pData, pStringBuilder, pLastPart, pIndex, pSex);
				}
				return text2;
			}
		});
		add(new OnomasticsAsset
		{
			id = "repeater",
			short_id = 'r',
			color_text = "#F3AB11",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex)
			{
				if (pIndex == 0)
				{
					return string.Empty;
				}
				int num = pIndex - 1;
				List<string> currentSubgroup = pData.getCurrentSubgroup();
				OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(currentSubgroup[num]);
				if (onomasticsAsset.is_divider)
				{
					return string.Empty;
				}
				while (onomasticsAsset.namemaker_delegate == null)
				{
					num--;
					if (num < 0)
					{
						return string.Empty;
					}
					onomasticsAsset = AssetManager.onomastics_library.get(currentSubgroup[num]);
					if (onomasticsAsset.is_divider)
					{
						return string.Empty;
					}
				}
				if (onomasticsAsset.namemaker_delegate == null)
				{
					return string.Empty;
				}
				string text = "";
				for (int i = 0; i < 2; i++)
				{
					if (!OnomasticsData.hasCheckOnTheRight(pData, num) || OnomasticsData.passesCheckOnTheRight(pData, pStringBuilder, pLastPart, num, pSex))
					{
						text += onomasticsAsset.namemaker_delegate(onomasticsAsset, pData, pStringBuilder, pLastPart, num, pSex);
					}
				}
				return text;
			},
			affects_left = true
		});
		add(new OnomasticsAsset
		{
			id = "upper",
			short_id = 'u',
			color_text = "#B2FF75",
			is_upper = true,
			type = OnomasticsAssetType.Special,
			affects_everything = true
		});
		add(new OnomasticsAsset
		{
			id = "backspace",
			short_id = 'b',
			color_text = "#FF6A43",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _)
			{
				if (pStringBuilder.Length == 0)
				{
					return string.Empty;
				}
				pStringBuilder.Remove(pStringBuilder.Length - 1, 1);
				return string.Empty;
			}
		});
	}

	private void addVowelConsonantSpecials()
	{
		add(new OnomasticsAsset
		{
			id = "consonant_separator",
			short_id = 'c',
			color_text = "#657CCE",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string _, int pIndex, ActorSex _)
			{
				if (pIndex == 0)
				{
					return string.Empty;
				}
				int index4 = pIndex - 1;
				List<string> currentSubgroup4 = pData.getCurrentSubgroup();
				OnomasticsAsset onomasticsAsset4 = AssetManager.onomastics_library.get(currentSubgroup4[index4]);
				if (!onomasticsAsset4.isGroupType())
				{
					return string.Empty;
				}
				if (pData.isGroupEmpty(onomasticsAsset4.id))
				{
					return string.Empty;
				}
				ConsonantSeparator.addRandomVowels(pStringBuilder, pData.getGroup(onomasticsAsset4.id).characters);
				return string.Empty;
			},
			check_delegate = blockGroupOnLeft,
			affects_left = true,
			affects_left_word = true,
			affects_left_group_only = true
		});
		add(new OnomasticsAsset
		{
			id = "vowel_separator",
			short_id = 'v',
			color_text = "#FF68C5",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string _, int pIndex, ActorSex _)
			{
				if (pIndex == 0)
				{
					return string.Empty;
				}
				int index3 = pIndex - 1;
				List<string> currentSubgroup3 = pData.getCurrentSubgroup();
				OnomasticsAsset onomasticsAsset3 = AssetManager.onomastics_library.get(currentSubgroup3[index3]);
				if (!onomasticsAsset3.isGroupType())
				{
					return string.Empty;
				}
				if (pData.isGroupEmpty(onomasticsAsset3.id))
				{
					return string.Empty;
				}
				VowelSeparator.addRandomConsonants(pStringBuilder, pData.getGroup(onomasticsAsset3.id).characters);
				return string.Empty;
			},
			check_delegate = blockGroupOnLeft,
			affects_left = true,
			affects_left_word = true,
			affects_left_group_only = true
		});
		add(new OnomasticsAsset
		{
			id = "vowel_duplicator",
			short_id = 'd',
			color_text = "#D9B03A",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _)
			{
				if (pStringBuilder.Length == 0)
				{
					return string.Empty;
				}
				var (pStart4, pLength4) = getLastWordBounds(pStringBuilder);
				using ListPool<int> listPool4 = VowelSeparator.findAllSingleVowels(pStringBuilder, pStart4, pLength4);
				if (listPool4.Count == 0)
				{
					return string.Empty;
				}
				int random6 = GetRandom(listPool4);
				pStringBuilder.Insert(random6, pStringBuilder[random6]);
				return string.Empty;
			},
			affects_left_word = true
		});
		add(new OnomasticsAsset
		{
			id = "consonant_duplicator",
			short_id = 'D',
			color_text = "#2E76AD",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _)
			{
				if (pStringBuilder.Length == 0)
				{
					return string.Empty;
				}
				var (pStart3, pLength3) = getLastWordBounds(pStringBuilder);
				using ListPool<int> listPool3 = ConsonantSeparator.findAllSingleConsonants(pStringBuilder, pStart3, pLength3);
				if (listPool3.Count == 0)
				{
					return string.Empty;
				}
				int random5 = GetRandom(listPool3);
				pStringBuilder.Insert(random5, pStringBuilder[random5]);
				return string.Empty;
			},
			affects_left_word = true
		});
		add(new OnomasticsAsset
		{
			id = "vowel_replacer",
			short_id = 'e',
			color_text = "#FF68C5",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string _, int pIndex, ActorSex _)
			{
				if (pIndex == 0)
				{
					return string.Empty;
				}
				int index2 = pIndex - 1;
				List<string> currentSubgroup2 = pData.getCurrentSubgroup();
				OnomasticsAsset onomasticsAsset2 = AssetManager.onomastics_library.get(currentSubgroup2[index2]);
				if (!onomasticsAsset2.isGroupType())
				{
					return string.Empty;
				}
				if (pData.isGroupEmpty(onomasticsAsset2.id))
				{
					return string.Empty;
				}
				var (pStart2, pLength2) = getLastWordBounds(pStringBuilder);
				using ListPool<int> listPool2 = VowelSeparator.findAllVowels(pStringBuilder, pStart2, pLength2);
				if (listPool2.Count == 0)
				{
					return string.Empty;
				}
				string random3 = GetRandom(pData.getGroup(onomasticsAsset2.id).characters);
				int random4 = GetRandom(listPool2);
				pStringBuilder.Remove(random4, 1);
				pStringBuilder.Insert(random4, random3);
				return string.Empty;
			},
			check_delegate = blockGroupOnLeft,
			affects_left = true,
			affects_left_word = true,
			affects_left_group_only = true
		});
		add(new OnomasticsAsset
		{
			id = "consonant_replacer",
			short_id = 'E',
			color_text = "#A8A8A8",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData pData, StringBuilderPool pStringBuilder, string _, int pIndex, ActorSex _)
			{
				if (pIndex == 0)
				{
					return string.Empty;
				}
				int index = pIndex - 1;
				List<string> currentSubgroup = pData.getCurrentSubgroup();
				OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(currentSubgroup[index]);
				if (!onomasticsAsset.isGroupType())
				{
					return string.Empty;
				}
				if (pData.isGroupEmpty(onomasticsAsset.id))
				{
					return string.Empty;
				}
				var (pStart, pLength) = getLastWordBounds(pStringBuilder);
				using ListPool<int> listPool = ConsonantSeparator.findAllConsonants(pStringBuilder, pStart, pLength);
				if (listPool.Count == 0)
				{
					return string.Empty;
				}
				string random = GetRandom(pData.getGroup(onomasticsAsset.id).characters);
				int random2 = GetRandom(listPool);
				pStringBuilder.Remove(random2, 1);
				pStringBuilder.Insert(random2, random);
				return string.Empty;
			},
			check_delegate = blockGroupOnLeft,
			affects_left = true,
			affects_left_word = true,
			affects_left_group_only = true
		});
		add(new OnomasticsAsset
		{
			id = "vowel_requirer",
			short_id = 'V',
			color_text = "#FBFDC2",
			type = OnomasticsAssetType.Special,
			check_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _) => pStringBuilder.Length != 0 && VowelSeparator.isVowel(pStringBuilder[pStringBuilder.Length - 1]),
			affects_left = true
		});
		add(new OnomasticsAsset
		{
			id = "consonant_requirer",
			short_id = 'C',
			color_text = "#CAB2A8",
			type = OnomasticsAssetType.Special,
			check_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _) => pStringBuilder.Length != 0 && ConsonantSeparator.isConsonant(pStringBuilder[pStringBuilder.Length - 1]),
			affects_left = true
		});
	}

	private void addDice()
	{
	}

	private void addGroups()
	{
		add(new OnomasticsAsset
		{
			id = "group_1",
			short_id = '0',
			color_text = "#31EB29",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 0
		});
		add(new OnomasticsAsset
		{
			id = "group_2",
			short_id = '1',
			color_text = "#28ECA0",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 1
		});
		add(new OnomasticsAsset
		{
			id = "group_3",
			short_id = '2',
			color_text = "#3FABE9",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 2
		});
		add(new OnomasticsAsset
		{
			id = "group_4",
			short_id = '3',
			color_text = "#6A78FF",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 3
		});
		add(new OnomasticsAsset
		{
			id = "group_5",
			short_id = '4',
			color_text = "#A129EB",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 4
		});
		add(new OnomasticsAsset
		{
			id = "group_6",
			short_id = '5',
			color_text = "#EB29B3",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 5
		});
		add(new OnomasticsAsset
		{
			id = "group_7",
			short_id = '6',
			color_text = "#EB2931",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 6
		});
		add(new OnomasticsAsset
		{
			id = "group_8",
			short_id = '7',
			color_text = "#FF8D1A",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 7
		});
		add(new OnomasticsAsset
		{
			id = "group_9",
			short_id = '8',
			color_text = "#EFCB00",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 8
		});
		add(new OnomasticsAsset
		{
			id = "group_10",
			short_id = '9',
			color_text = "#D2DAC0",
			forced_locale_subname_id = "onomastics_group_subname",
			forced_locale_description_id = "onomastics_group_info",
			forced_locale_description_id_2 = "onomastics_group_info_2",
			type = OnomasticsAssetType.Group,
			namemaker_delegate = groupAction,
			group_id = 9
		});
	}

	private void addSpecialCharacters()
	{
		add(new OnomasticsAsset
		{
			id = "space",
			short_id = '_',
			color_text = "#D2DAC0",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _)
			{
				if (pStringBuilder.Length == 0)
				{
					return string.Empty;
				}
				return (pStringBuilder[pStringBuilder.Length - 1] == ' ') ? string.Empty : " ";
			},
			is_word_divider = true
		});
		add(new OnomasticsAsset
		{
			id = "silent_space",
			short_id = ',',
			color_text = "#C93F3F",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = delegate(OnomasticsAsset _, OnomasticsData _, StringBuilderPool pStringBuilder, string _, int _, ActorSex _)
			{
				if (pStringBuilder.Length == 0)
				{
					return string.Empty;
				}
				if (pStringBuilder[pStringBuilder.Length - 1] == ' ')
				{
					return string.Empty;
				}
				return (pStringBuilder[pStringBuilder.Length - 1] == ',') ? string.Empty : ",";
			},
			is_word_divider = true
		});
		add(new OnomasticsAsset
		{
			id = "hyphen",
			short_id = '-',
			color_text = "#BBA826",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool _, string _, int _, ActorSex _) => "-",
			is_word_divider = true
		});
		add(new OnomasticsAsset
		{
			id = "numbers",
			short_id = '#',
			color_text = "#35B929",
			type = OnomasticsAssetType.Special,
			namemaker_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool _, string _, int _, ActorSex _) => Randy.randomInt(0, 10).ToString()
		});
		add(new OnomasticsAsset
		{
			id = "divider",
			short_id = '/',
			color_text = "#D2DAC0",
			type = OnomasticsAssetType.Special,
			is_divider = true,
			is_word_divider = true,
			is_immune = true
		});
	}

	private void addSexes()
	{
		add(new OnomasticsAsset
		{
			id = "sex_male",
			short_id = 'M',
			color_text = "#86BC4E",
			type = OnomasticsAssetType.Special,
			check_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool _, string _, int _, ActorSex pSex) => pSex == ActorSex.Male,
			affects_left = true
		});
		add(new OnomasticsAsset
		{
			id = "sex_female",
			short_id = 'F',
			color_text = "#EB29B3",
			type = OnomasticsAssetType.Special,
			check_delegate = (OnomasticsAsset _, OnomasticsData _, StringBuilderPool _, string _, int _, ActorSex pSex) => pSex == ActorSex.Female,
			affects_left = true
		});
	}

	private string getLastWord(StringBuilderPool pStringBuilder)
	{
		var (num, num2) = getLastWordBounds(pStringBuilder, pPrevious: true);
		return pStringBuilder.ToString(num, num2);
	}

	private (int tStart, int tLength) getLastWordBounds(StringBuilderPool pStringBuilder, bool pPrevious = false)
	{
		if (pStringBuilder.Length == 0)
		{
			return (tStart: 0, tLength: 0);
		}
		int num = pStringBuilder.LastIndexOfAny(_word_separators) + 1;
		int num2 = pStringBuilder.Length - num;
		if (pPrevious && num2 == 0)
		{
			num = pStringBuilder.LastIndexOfAny(_word_separators, num - 2) + 1;
			num2 = pStringBuilder.Length - num - (num2 + 1);
		}
		return (tStart: num, tLength: num2);
	}

	private string groupAction(OnomasticsAsset pAsset, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex)
	{
		return pData.getRandomPartFromGroup(pAsset.id);
	}

	private bool blockGroupOnLeft(OnomasticsAsset pAsset, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex)
	{
		return !isGroupOnLeft(pAsset, pData, pStringBuilder, pLastPart, pIndex, pSex);
	}

	private bool isGroupOnLeft(OnomasticsAsset pAsset, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex)
	{
		if (pIndex == 0)
		{
			return false;
		}
		int index = pIndex - 1;
		List<string> currentSubgroup = pData.getCurrentSubgroup();
		OnomasticsAsset onomasticsAsset = AssetManager.onomastics_library.get(currentSubgroup[index]);
		if (!onomasticsAsset.isGroupType())
		{
			return false;
		}
		if (pData.isGroupEmpty(onomasticsAsset.id))
		{
			return false;
		}
		return true;
	}

	public override OnomasticsAsset add(OnomasticsAsset pAsset)
	{
		base.add(pAsset);
		_dict_short_id.Add(pAsset.short_id.ToString(), pAsset);
		return pAsset;
	}

	public OnomasticsAsset getByShortId(string pShortID)
	{
		if (_dict_short_id.ContainsKey(pShortID))
		{
			return _dict_short_id[pShortID];
		}
		return null;
	}

	public static T GetRandom<T>(T[] list)
	{
		((Random)(ref _rand)).InitState(Randy.rand.state);
		return list[((Random)(ref _rand)).NextInt(list.Length)];
	}

	public static T GetRandom<T>(ListPool<T> list)
	{
		((Random)(ref _rand)).InitState(Randy.rand.state);
		return list[((Random)(ref _rand)).NextInt(list.Count)];
	}

	public override void post_init()
	{
		base.post_init();
		foreach (OnomasticsAsset item in list)
		{
			if (string.IsNullOrEmpty(item.path_icon))
			{
				item.path_icon = "ui/Icons/onomastics/onomastics_" + item.id;
			}
		}
	}

	public override void editorDiagnostic()
	{
		foreach (OnomasticsAsset item in list)
		{
			if ((Object)(object)SpriteTextureLoader.getSprite(item.path_icon) == (Object)null)
			{
				BaseAssetLibrary.logAssetError("Missing icon file", item.path_icon);
			}
		}
		foreach (OnomasticsAsset item2 in list)
		{
			foreach (OnomasticsAsset item3 in list)
			{
				if (item2 != item3 && item2.short_id == item3.short_id)
				{
					Debug.LogError((object)("OnomasticsAsset: Duplicate short_id: " + item2.short_id + " for " + item2.id + " and " + item3.id));
				}
			}
		}
		foreach (KeyValuePair<string, string> test_template in _test_templates)
		{
			string key = test_template.Key;
			string value = test_template.Value;
			string text = NameGenerator.generateNameFromOnomastics(null, key);
			if (text != value)
			{
				BaseAssetLibrary.logAssetError("<e>Onomastics</e>: Template test failed: " + text + " != " + value, key);
			}
		}
		base.editorDiagnostic();
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (OnomasticsAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
	}
}
// --- End of File: OnomasticsLibrary.cs ---



// --- Start of File: OnomasticsNameGenerator.cs ---
using DG.Tweening;
using UnityEngine;
using UnityEngine.UI;

public class OnomasticsNameGenerator : MonoBehaviour
{
	private const int MAX_STRING_LENGTH = 250;

	private const int AMOUNT_NAME_EXAMPLES = 20;

	private const float TIMER_NAME_INTERVAL = 0.2f;

	private float _timer_name;

	private int _index_name;

	public Text text_name_examples;

	private string _male_color => ColorStyleLibrary.m.color_text_pumpkin;

	private string _female_color => ColorStyleLibrary.m.color_text_pumpkin_light;

	private string _separator_color => ColorStyleLibrary.m.color_text_grey_dark;

	protected void updateNameGeneration(OnomasticsData pData)
	{
		_timer_name += Time.deltaTime;
		if (!(_timer_name > 0.2f))
		{
			return;
		}
		_timer_name = 0f;
		if (_index_name >= 20 || Toolbox.removeRichTextTags(text_name_examples.text).Length >= 250)
		{
			return;
		}
		_index_name++;
		ActorSex actorSex = (Randy.randomBool() ? ActorSex.Female : ActorSex.Male);
		string text = pData.generateName(actorSex);
		if (text == "Rebr")
		{
			if (text_name_examples.text != string.Empty)
			{
				return;
			}
			actorSex = ((actorSex != ActorSex.Female) ? ActorSex.Female : ActorSex.Male);
			text = pData.generateName(actorSex);
		}
		if (!string.IsNullOrEmpty(text))
		{
			string text2 = text_name_examples.text;
			if (text2.Length > 0)
			{
				text2 += ", ";
			}
			text2 += Toolbox.coloredText(text, (actorSex == ActorSex.Male) ? _male_color : _female_color);
			text_name_examples.text = text2;
			textExamplesEffect(((Component)text_name_examples).gameObject.transform, 1f, 0.03f);
		}
	}

	private void textExamplesEffect(Transform pTransformTarget, float pDefaultScale = 1f, float pPower = 0.1f, float pDuration = 0.3f)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		ShortcutExtensions.DOKill((Component)(object)pTransformTarget, true);
		pTransformTarget.localScale = new Vector3(pDefaultScale, pDefaultScale, pDefaultScale);
		ShortcutExtensions.DOPunchScale(pTransformTarget, new Vector3(pPower, pPower, pPower), pDuration, 1, 1f);
	}

	protected void clickRegenerate()
	{
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		_index_name = 0;
		text_name_examples.text = string.Empty;
		((Graphic)text_name_examples).color = Toolbox.makeColor(_separator_color);
	}
}
// --- End of File: OnomasticsNameGenerator.cs ---



// --- Start of File: OnomasticsNameMakerDelegate.cs ---
public delegate string OnomasticsNameMakerDelegate(OnomasticsAsset pAsset, OnomasticsData pData, StringBuilderPool pStringBuilder, string pLastPart, int pIndex, ActorSex pSex);
// --- End of File: OnomasticsNameMakerDelegate.cs ---



// --- Start of File: OnomasticsReplacerDelegate.cs ---
public delegate bool OnomasticsReplacerDelegate(OnomasticsEvolutionAsset pAsset, ref string pReplace);
// --- End of File: OnomasticsReplacerDelegate.cs ---



// --- Start of File: OnomasticsReportGenerator.cs ---
public class OnomasticsReportGenerator
{
}
// --- End of File: OnomasticsReportGenerator.cs ---



// --- Start of File: OnomasticsTab.cs ---
using System;
using System.Collections.Generic;
using DG.Tweening;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class OnomasticsTab : OnomasticsNameGenerator
{
	private const int MAX_CARDS = 30;

	private const float BUTTON_SCALE = 1f;

	private const float WORD_SCALE = 1f;

	private const float EFFECT_SCALE = 0.8f;

	private const float WORD_BOX_SIZE_X = 2f;

	private const float WORD_BOX_SIZE_Y = 2f;

	private const float EFFECT_BOX_SIZE_X = 10f;

	private const float EFFECT_BOX_SIZE_Y = 3f;

	public Transform parent_name_variation_1;

	public DragOrderContainer name_variation_1_drag_container;

	public Transform parent_asset_groups;

	public Transform parent_asset_specials;

	public Transform parent_asset_editor_group;

	public Image icon_last_selected_group;

	public Text text_counter;

	public OnomasticsAssetButton prefab_button;

	public OnomasticsAssetButton prefab_button_template;

	private ObjectPoolGenericMono<OnomasticsAssetButton> _pool_buttons;

	protected NameInput _editor_input;

	private bool _created;

	private OnomasticsData _onomastics_data;

	private MetaType _name_set_type = MetaType.Unit;

	private OnomasticsAsset _selected_editor_group;

	private OnomasticsAssetButton _selected_editor_group_button;

	public Image selected_icon_effect;

	public Image selected_icon_effect_2;

	private ObjectPoolGenericMono<Image> _pool_boxed_effects;

	public Image boxed_effect_prefab;

	public Transform boxed_effects_transform;

	private ObjectPoolGenericMono<Image> _pool_word_effects;

	public Image word_effect_prefab;

	public Transform word_effects_transform;

	[SerializeField]
	private TabTogglesGroup _tab_groups;

	private static readonly string[] consonant_combinations = new string[30]
	{
		"b", "c", "d", "f", "g", "h", "j", "k", "l", "m",
		"n", "p", "q", "r", "s", "t", "v", "w", "x", "y",
		"z", "st", "bl", "tr", "pr", "cl", "kr", "fr", "gr", "pl"
	};

	private static readonly string[] vowel_combinations = new string[30]
	{
		"a", "e", "i", "o", "u", "ai", "ei", "oi", "au", "ou",
		"ie", "ee", "oa", "ea", "io", "ia", "ui", "ue", "oo", "ae",
		"ya", "yo", "ye", "wa", "we", "wi", "wo", "ua", "eu", "iu"
	};

	private void OnEnable()
	{
		create();
		showCategoryGroups();
	}

	private void showCategoryGroups()
	{
		((Component)_tab_groups).gameObject.SetActive(true);
		_tab_groups.clearButtons();
		_tab_groups.tryAddButton("ui/Icons/actor_traits/iconAttractive", "tab_onomastics_unit", loadNameSet, delegate
		{
			_name_set_type = MetaType.Unit;
		});
		_tab_groups.tryAddButton("ui/Icons/iconFamilyList", "tab_onomastics_family", loadNameSet, delegate
		{
			_name_set_type = MetaType.Family;
		});
		_tab_groups.tryAddButton("ui/Icons/iconClanList", "tab_onomastics_clan", loadNameSet, delegate
		{
			_name_set_type = MetaType.Clan;
		});
		_tab_groups.tryAddButton("ui/Icons/iconCityList", "tab_onomastics_city", loadNameSet, delegate
		{
			_name_set_type = MetaType.City;
		});
		_tab_groups.tryAddButton("ui/Icons/iconKingdomList", "tab_onomastics_kingdom", loadNameSet, delegate
		{
			_name_set_type = MetaType.Kingdom;
		});
		_tab_groups.enableFirst();
	}

	private void openFirstGroup()
	{
		using ListPool<OnomasticsAssetButton> listPool = getActiveButtons(parent_asset_groups);
		for (int i = 0; i < listPool.Count; i++)
		{
			OnomasticsAssetButton onomasticsAssetButton = listPool[i];
			if (onomasticsAssetButton.onomastics_asset.id == "group_1")
			{
				openGroup(onomasticsAssetButton);
				break;
			}
		}
	}

	private void Update()
	{
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		if (_selected_editor_group != null)
		{
			((Component)selected_icon_effect).transform.position = ((Component)_selected_editor_group_button).transform.position;
			Vector3 position = ((Component)_selected_editor_group_button).transform.position;
			position.y += 30f;
			((Component)selected_icon_effect_2).transform.position = position;
		}
		updateNameGeneration(_onomastics_data);
		text_counter.text = $"{_pool_buttons.countActive().ToString()}/{30}";
	}

	private void LateUpdate()
	{
		checkButtonsAndEffects();
	}

	private void checkButtonsAndEffects()
	{
		_pool_boxed_effects.clear();
		_pool_word_effects.clear();
		OnomasticsAssetButton onomasticsAssetButton = null;
		using ListPool<OnomasticsAssetButton> listPool = getActiveButtons(parent_name_variation_1);
		for (int i = 0; i < listPool.Count; i++)
		{
			OnomasticsAssetButton onomasticsAssetButton2 = listPool[i];
			OnomasticsAssetButton onomasticsAssetButton3 = null;
			if (onomasticsAssetButton2.onomastics_asset.is_word_divider)
			{
				onomasticsAssetButton = null;
			}
			else if ((Object)(object)onomasticsAssetButton == (Object)null)
			{
				onomasticsAssetButton = onomasticsAssetButton2;
			}
			if (i + 1 < listPool.Count)
			{
				onomasticsAssetButton3 = listPool[i + 1];
			}
			if (onomasticsAssetButton2.onomastics_asset.affects_left_word)
			{
				showWordBox(onomasticsAssetButton, onomasticsAssetButton2);
			}
			if (!onomasticsAssetButton2.onomastics_asset.is_immune && (Object)(object)onomasticsAssetButton3 != (Object)null && onomasticsAssetButton3.onomastics_asset.affects_left && (!onomasticsAssetButton3.onomastics_asset.affects_left_group_only || onomasticsAssetButton2.onomastics_asset.isGroupType()))
			{
				showEffectBox(onomasticsAssetButton2, onomasticsAssetButton3);
			}
		}
	}

	private ListPool<OnomasticsAssetButton> getActiveButtons(Transform pTransform)
	{
		ListPool<OnomasticsAssetButton> listPool = new ListPool<OnomasticsAssetButton>(pTransform.childCount);
		for (int i = 0; i < pTransform.childCount; i++)
		{
			OnomasticsAssetButton component = ((Component)pTransform.GetChild(i)).GetComponent<OnomasticsAssetButton>();
			if (!((Object)(object)component == (Object)null) && ((Component)component).gameObject.activeSelf)
			{
				listPool.Add(component);
			}
		}
		return listPool;
	}

	private void showEffectBox(OnomasticsAssetButton pButton1, OnomasticsAssetButton pButton2)
	{
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_012a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0159: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		Image next = _pool_boxed_effects.getNext();
		RectTransform component = ((Component)next).GetComponent<RectTransform>();
		Vector3[] array = (Vector3[])(object)new Vector3[4];
		Vector3[] array2 = (Vector3[])(object)new Vector3[4];
		pButton1.getRect().GetWorldCorners(array);
		pButton2.getRect().GetWorldCorners(array2);
		float num = Mathf.Min(array[0].x, array2[0].x);
		float num2 = Mathf.Max(array[2].x, array2[2].x);
		float num3 = Mathf.Min(array[0].y, array2[0].y);
		float num4 = Mathf.Max(array[2].y, array2[2].y);
		Vector3 val = ((Component)next).transform.parent.InverseTransformPoint(new Vector3(num, num3, 0f));
		Vector3 val2 = ((Component)next).transform.parent.InverseTransformPoint(new Vector3(num2, num4, 0f));
		float num5 = 10f;
		float num6 = 3f;
		component.anchoredPosition = new Vector2((val.x + val2.x) / 2f, (val.y + val2.y) / 2f);
		component.sizeDelta = new Vector2(val2.x - val.x + num5, val2.y - val.y + num6);
		((Transform)component).localScale = new Vector3(0.8f, 0.8f, 0.8f);
	}

	private void showWordBox(OnomasticsAssetButton pButton1, OnomasticsAssetButton pButton2)
	{
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_012a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0159: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		Image next = _pool_word_effects.getNext();
		RectTransform component = ((Component)next).GetComponent<RectTransform>();
		Vector3[] array = (Vector3[])(object)new Vector3[4];
		Vector3[] array2 = (Vector3[])(object)new Vector3[4];
		pButton1.getRect().GetWorldCorners(array);
		pButton2.getRect().GetWorldCorners(array2);
		float num = Mathf.Min(array[0].x, array2[0].x);
		float num2 = Mathf.Max(array[2].x, array2[2].x);
		float num3 = Mathf.Min(array[0].y, array2[0].y);
		float num4 = Mathf.Max(array[2].y, array2[2].y);
		Vector3 val = ((Component)next).transform.parent.InverseTransformPoint(new Vector3(num, num3, 0f));
		Vector3 val2 = ((Component)next).transform.parent.InverseTransformPoint(new Vector3(num2, num4, 0f));
		float num5 = 2f;
		float num6 = 2f;
		component.anchoredPosition = new Vector2((val.x + val2.x) / 2f, (val.y + val2.y) / 2f);
		component.sizeDelta = new Vector2(val2.x - val.x + num5, val2.y - val.y + num6);
		((Transform)component).localScale = new Vector3(1f, 1f, 1f);
	}

	private void loadOnomasicsData()
	{
		_onomastics_data = SelectedMetas.selected_culture.getOnomasticData(_name_set_type);
		loadInitialButtons();
	}

	private void loadInitialButtons()
	{
		_pool_buttons.clear();
		List<string> fullTemplateData = _onomastics_data.getFullTemplateData();
		for (int i = 0; i < fullTemplateData.Count; i++)
		{
			string pID = fullTemplateData[i];
			loadTemplateButton(pID);
		}
	}

	public OnomasticsData getOnomasticsData()
	{
		return _onomastics_data;
	}

	protected void OnDisable()
	{
		if (!((Object)(object)_editor_input == (Object)null))
		{
			_editor_input.inputField.DeactivateInputField();
		}
	}

	protected virtual void initNameInput()
	{
		if (!((Object)(object)_editor_input == (Object)null))
		{
			_editor_input.addListener(applyInputName);
		}
	}

	private void applyInputName(string pString)
	{
		pString = pString.Replace("\n", " ");
		pString = pString.Replace("\r", " ");
		while (pString.Contains("  "))
		{
			pString = pString.Replace("  ", " ");
		}
		pString = pString.Trim();
		if (_onomastics_data.setGroup(_selected_editor_group.id, pString))
		{
			resetNameGenerationTextBox();
		}
	}

	private void resetNameGenerationTextBox()
	{
		clickRegenerate();
		using ListPool<OnomasticsAssetButton> listPool = getActiveButtons(parent_name_variation_1);
		using ListPool<string> listPool2 = new ListPool<string>(listPool.Count);
		for (int i = 0; i < listPool.Count; i++)
		{
			OnomasticsAssetButton onomasticsAssetButton = listPool[i];
			listPool2.Add(onomasticsAssetButton.onomastics_asset.id);
		}
		_onomastics_data.setTemplateData(listPool2);
		if ((Object)(object)name_variation_1_drag_container.rect_transform != (Object)null)
		{
			LayoutRebuilder.ForceRebuildLayoutImmediate(name_variation_1_drag_container.rect_transform);
		}
	}

	private void create()
	{
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_0150: Expected O, but got Unknown
		if (_created)
		{
			return;
		}
		DragOrderContainer dragOrderContainer = name_variation_1_drag_container;
		dragOrderContainer.on_order_changed = (Action)Delegate.Combine(dragOrderContainer.on_order_changed, new Action(resetNameGenerationTextBox));
		_pool_boxed_effects = new ObjectPoolGenericMono<Image>(boxed_effect_prefab, boxed_effects_transform);
		_pool_word_effects = new ObjectPoolGenericMono<Image>(word_effect_prefab, word_effects_transform);
		Transform obj = ((Component)this).transform.FindRecursive("Group Editor Element");
		_editor_input = ((obj != null) ? ((Component)obj).GetComponent<NameInput>() : null);
		initNameInput();
		_created = true;
		_pool_buttons = new ObjectPoolGenericMono<OnomasticsAssetButton>(prefab_button_template, parent_name_variation_1);
		foreach (OnomasticsAsset item in AssetManager.onomastics_library.list)
		{
			Transform val = ((!item.isGroupType()) ? parent_asset_specials : parent_asset_groups);
			OnomasticsAssetButton tB = Object.Instantiate<OnomasticsAssetButton>(prefab_button, val);
			setupButton(tB, item);
			if (item.isGroupType())
			{
				((Component)tB).GetComponent<TipButton>().showOnClick = false;
				((Behaviour)((Component)tB).GetComponent<DraggableLayoutElement>()).enabled = false;
			}
			((UnityEvent)tB.button.onClick).AddListener((UnityAction)delegate
			{
				clickAssetButton(tB);
			});
		}
	}

	private void clickAssetButton(OnomasticsAssetButton pButton)
	{
		if (!InputHelpers.mouseSupported)
		{
			if (!Tooltip.isShowingFor(pButton))
			{
				pButton.showTooltip();
				return;
			}
			Tooltip.hideTooltip();
		}
		if (_selected_editor_group != pButton.onomastics_asset && pButton.isGroupType())
		{
			openGroup(pButton);
			return;
		}
		if (pButton.isGroupType() && _onomastics_data.isGroupEmpty(pButton.onomastics_asset.id))
		{
			punch(((Component)parent_asset_editor_group).transform);
			return;
		}
		if (_pool_buttons.countActive() >= 30)
		{
			punch(parent_name_variation_1.parent);
			return;
		}
		punch(((Component)pButton).transform);
		loadTemplateButton(pButton.onomastics_asset.id, pPunch: true);
		resetNameGenerationTextBox();
	}

	private void punch(Transform pTransformTarget, float pDefaultScale = 1f, float pPower = 0.1f, float pDuration = 0.3f)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		ShortcutExtensions.DOKill((Component)(object)pTransformTarget, true);
		pTransformTarget.localScale = new Vector3(pDefaultScale, pDefaultScale, pDefaultScale);
		ShortcutExtensions.DOPunchScale(pTransformTarget, new Vector3(pPower, pPower, pPower), pDuration, 10, 1f);
	}

	private void setupButton(OnomasticsAssetButton pButton, OnomasticsAsset pAsset)
	{
		pButton.setupButton(pAsset, getOnomasticsData);
	}

	private void setupButton(OnomasticsAssetButton pButton, string pAssetID)
	{
		OnomasticsAsset pAsset = AssetManager.onomastics_library.get(pAssetID);
		setupButton(pButton, pAsset);
	}

	private void loadTemplateButton(string pID, bool pPunch = false)
	{
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Expected O, but got Unknown
		OnomasticsAssetButton tNewButton = _pool_buttons.getNext();
		setupButton(tNewButton, pID);
		((Component)tNewButton).transform.SetAsLastSibling();
		((UnityEvent)tNewButton.button.onClick).AddListener((UnityAction)delegate
		{
			clickToRemoveButton(tNewButton);
		});
		punch(((Component)tNewButton).transform);
	}

	private void clickToRemoveButton(OnomasticsAssetButton pButton)
	{
		_pool_buttons.release(pButton);
		resetNameGenerationTextBox();
		Tooltip.blockTooltips(0.01f);
	}

	public void openGroup(OnomasticsAssetButton pButton)
	{
		_selected_editor_group = pButton.onomastics_asset;
		_selected_editor_group_button = pButton;
		((Component)parent_asset_editor_group).gameObject.SetActive(true);
		_editor_input.setText(_onomastics_data.getGroupString(_selected_editor_group.id));
		icon_last_selected_group.sprite = pButton.onomastics_asset.getSprite();
	}

	public void loadFromTemplate(bool pReset = false)
	{
		_onomastics_data = SelectedMetas.selected_culture.getOnomasticData(_name_set_type, pReset);
		loadInitialButtons();
		openFirstGroup();
		resetNameGenerationTextBox();
	}

	public void loadNameSet()
	{
		loadFromTemplate();
	}

	public void resetTemplate()
	{
		loadFromTemplate(pReset: true);
	}

	public void clickRegenerateNames()
	{
		resetNameGenerationTextBox();
	}

	public void randomEverything()
	{
		_onomastics_data.clearTemplateData();
		int num = Randy.randomInt(3, 5);
		bool flag = Randy.randomBool();
		for (int i = 1; i <= num; i++)
		{
			string pString = ((!flag) ? getRandomConsonants() : getRandomVowels());
			flag = !flag;
			_onomastics_data.setGroup("group_" + i, pString);
		}
		fillRandomCards();
		loadInitialButtons();
		openFirstGroup();
		resetNameGenerationTextBox();
	}

	public void randomCards()
	{
		fillRandomCards();
		loadInitialButtons();
		openFirstGroup();
		resetNameGenerationTextBox();
	}

	public void fillRandomCards()
	{
		_onomastics_data.clearTemplateData();
		using ListPool<string> listPool = new ListPool<string>();
		using (new ListPool<string>())
		{
			foreach (KeyValuePair<string, OnomasticsDataGroup> group in _onomastics_data.groups)
			{
				if (!group.Value.isEmpty())
				{
					listPool.Add(group.Key);
				}
			}
			int num = Randy.randomInt(2, 6);
			for (int i = 0; i < num; i++)
			{
				string random = listPool.GetRandom();
				_onomastics_data.addToTemplateData(random);
			}
			for (int j = 0; j < num / 2; j++)
			{
				OnomasticsAsset random2 = AssetManager.onomastics_library.list_special.GetRandom();
				_onomastics_data.addToTemplateData(random2.id);
			}
			_onomastics_data.shuffleAllCards();
		}
	}

	private string getRandomVowels()
	{
		string text = string.Empty;
		int num = Randy.randomInt(2, 4);
		for (int i = 0; i < num; i++)
		{
			text = text + vowel_combinations[Randy.randomInt(0, vowel_combinations.Length)] + " ";
		}
		return text;
	}

	private string getRandomConsonants()
	{
		string text = string.Empty;
		int num = Randy.randomInt(2, 4);
		for (int i = 0; i < num; i++)
		{
			text = text + consonant_combinations[Randy.randomInt(0, consonant_combinations.Length)] + " ";
		}
		return text;
	}

	public void saveToLibrary()
	{
		string current_template = OnomasticsDropdown.current_template;
		int current_template_index = OnomasticsDropdown.current_template_index;
		Debug.Log((object)("Saving to library: " + current_template + " " + current_template_index));
		string shortTemplate = _onomastics_data.getShortTemplate();
		NameGeneratorAsset nameGeneratorAsset = AssetManager.name_generator.get(current_template);
		if (current_template_index >= nameGeneratorAsset.onomastics_templates.Count)
		{
			nameGeneratorAsset.onomastics_templates.Add(shortTemplate);
		}
		else
		{
			nameGeneratorAsset.onomastics_templates[current_template_index] = shortTemplate;
		}
		AssetManager.name_generator.exportAssets();
	}

	public void saveToClipboard()
	{
		string shortTemplate = _onomastics_data.getShortTemplate();
		GUIUtility.systemCopyBuffer = "`" + shortTemplate + "`";
		WorldTip.showNow("onomastics_exported", pTranslate: true, "top");
	}

	public void saveNamesToClipboard()
	{
		string text = "";
		text += "## Template: \n\n";
		text += _onomastics_data.getShortTemplate();
		text += "\n\n";
		if (_onomastics_data.isGendered())
		{
			string text2 = "";
			string text3 = "";
			for (int i = 0; i < 25; i++)
			{
				string text4 = _onomastics_data.generateName(ActorSex.Male);
				text2 = text2 + "- " + text4 + "\n";
				text4 = _onomastics_data.generateName(ActorSex.Female);
				text3 = text3 + "- " + text4 + "\n";
			}
			text = text + "## Male names: \n\n" + text2;
			text += "\n";
			text = text + "## Female names: \n\n" + text3;
		}
		else
		{
			text += "## Generated names: \n\n";
			for (int j = 0; j < 50; j++)
			{
				string text5 = _onomastics_data.generateName();
				text = text + "- " + text5 + "\n";
			}
		}
		GUIUtility.systemCopyBuffer = text;
	}

	public void loadFromClipboard()
	{
		string systemCopyBuffer = GUIUtility.systemCopyBuffer;
		loadTemplate(systemCopyBuffer);
	}

	public void loadTemplate(string pTemplate = null)
	{
		string shortTemplate = _onomastics_data.getShortTemplate();
		pTemplate = pTemplate?.Trim('\n', '\r', ' ', '"', '`') ?? "";
		try
		{
			if (!_onomastics_data.templateIsValid(pTemplate))
			{
				throw new ArgumentException("Invalid template format: (OT) " + pTemplate);
			}
			_onomastics_data.loadFromShortTemplate(pTemplate);
		}
		catch (ArgumentException ex)
		{
			WorldTip.showNow("onomastics_import_error_invalid", pTranslate: true, "top", 3f, "#FF637D");
			Debug.LogWarning((object)ex.Message);
			return;
		}
		catch (Exception ex2)
		{
			WorldTip.showNow("onomastics_import_error_logs", pTranslate: true, "top", 3f, "#FF637D");
			Debug.LogWarning((object)ex2.Message);
			return;
		}
		Debug.Log((object)("old: " + shortTemplate.Trim('\n', '\r', ' ', '"', '`')));
		Debug.Log((object)("new: " + pTemplate));
		WorldTip.showNow(pTemplate, pTranslate: false, "top");
		loadInitialButtons();
		openFirstGroup();
		resetNameGenerationTextBox();
	}

	public static string debugTemplateReport(string pTemplateName)
	{
		OnomasticsData originalData = OnomasticsCache.getOriginalData(AssetManager.name_generator.get(pTemplateName).onomastics_templates.GetRandom());
		string text = "";
		text += "## Template: \n\n";
		text += originalData.getShortTemplate();
		text += "\n\n";
		if (originalData.isGendered())
		{
			string text2 = "";
			string text3 = "";
			for (int i = 0; i < 25; i++)
			{
				string text4 = originalData.generateName(ActorSex.Male);
				if (i > 0)
				{
					text2 += ", ";
				}
				text2 += text4;
				text4 = originalData.generateName(ActorSex.Female);
				if (i > 0)
				{
					text3 += ", ";
				}
				text3 += text4;
			}
			text = text + "## Male names: \n\n" + text2;
			text += "\n";
			text = text + "## Female names: \n\n" + text3;
		}
		else
		{
			text += "## Generated names: \n\n";
			for (int j = 0; j < 50; j++)
			{
				string text5 = originalData.generateName();
				if (j > 0)
				{
					text += ", ";
				}
				text += text5;
			}
		}
		return text + "\n\n";
	}
}
// --- End of File: OnomasticsTab.cs ---



// --- Start of File: OnWorldLoadAction.cs ---
public delegate void OnWorldLoadAction();
// --- End of File: OnWorldLoadAction.cs ---



// --- Start of File: OpinionAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class OpinionAsset : Asset, IMultiLocalesAsset
{
	public string translation_key;

	public string translation_key_negative;

	public OpinionDelegateCalc calc;

	public string getTranslationKey(int pValue)
	{
		if (pValue > 0)
		{
			return translation_key;
		}
		if (!string.IsNullOrEmpty(translation_key_negative))
		{
			return translation_key_negative;
		}
		return translation_key;
	}

	public IEnumerable<string> getLocaleIDs()
	{
		yield return translation_key;
		if (!string.IsNullOrEmpty(translation_key_negative))
		{
			yield return translation_key_negative;
		}
	}
}
// --- End of File: OpinionAsset.cs ---



// --- Start of File: OpinionDelegateCalc.cs ---
public delegate int OpinionDelegateCalc(Kingdom pMain, Kingdom pTarget);
// --- End of File: OpinionDelegateCalc.cs ---



// --- Start of File: OpinionLibrary.cs ---
public class OpinionLibrary : AssetLibrary<OpinionAsset>
{
	public override void init()
	{
		base.init();
		add(new OpinionAsset
		{
			id = "opinion_king",
			translation_key = "opinion_king",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num14 = 0;
				if (pTarget.hasKing())
				{
					num14 += (int)pTarget.king.stats["diplomacy"];
				}
				return num14;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_kings_mood",
			translation_key = "opinion_kings_mood",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result9 = 0;
				if (pMain.hasKing())
				{
					result9 = (int)pMain.king.stats["opinion"];
				}
				return result9;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_is_supreme",
			translation_key = "opinion_is_supreme",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result8 = 0;
				if (pTarget.isSupreme() && World.world.kingdoms.Count >= 3)
				{
					result8 = -100;
				}
				return result8;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_borders",
			translation_key = "opinion_far_borders",
			translation_key_negative = "opinion_close_borders",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num13 = 0;
				return DiplomacyHelpers.areKingdomsClose(pMain, pTarget) ? (-25) : 25;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_far_lands",
			translation_key = "opinion_far_lands",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result7 = 0;
				if (!DiplomacyHelpers.areKingdomsClose(pMain, pTarget) && pMain.hasCapital() && pTarget.hasCapital())
				{
					WorldTile tile = pMain.capital.getTile();
					WorldTile tile2 = pTarget.capital.getTile();
					if (tile != null && tile2 != null && !tile.isSameIsland(tile2))
					{
						result7 = 60;
					}
				}
				return result7;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_in_war",
			translation_key = "opinion_in_war",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result6 = 0;
				if (pMain.isEnemy(pTarget))
				{
					result6 = -500;
				}
				return result6;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_same_wars",
			translation_key = "opinion_same_wars",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				if (pMain.isEnemy(pTarget))
				{
					return 0;
				}
				return pMain.isInWarOnSameSide(pTarget) ? 50 : 0;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_species",
			translation_key = "opinion_same_species",
			translation_key_negative = "opinion_different_species",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num12 = 0;
				Actor king3 = pMain.king;
				Actor king4 = pTarget.king;
				if (king3 == null || king4 == null)
				{
					return 0;
				}
				if (!king3.canHavePrejudice())
				{
					return 0;
				}
				return (pMain.getSpecies() == pTarget.getSpecies()) ? 15 : (-10);
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_zones",
			translation_key = "opinion_zones",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num9 = 0;
				int num10 = 0;
				int num11 = 0;
				foreach (City city in pMain.getCities())
				{
					num10 += city.zones.Count;
				}
				foreach (City city2 in pTarget.getCities())
				{
					num11 += city2.zones.Count;
				}
				num9 = (num10 - num11) / 5;
				if (num9 > 0)
				{
					num9 = 0;
				}
				if (num9 < -20)
				{
					num9 = -20;
				}
				return num9;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_peace_time",
			translation_key = "opinion_peace_time",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num7 = 0;
				if (pMain.isEnemy(pTarget))
				{
					return 0;
				}
				DiplomacyRelation relation = World.world.diplomacy.getRelation(pMain, pTarget);
				if (relation == null)
				{
					return 0;
				}
				float num8 = Date.getYearsSince(relation.data.timestamp_last_war_ended);
				if (num8 <= (float)SimGlobals.m.minimum_years_between_wars)
				{
					return 0;
				}
				num7 = (int)num8;
				if (num8 > 20f)
				{
					num7 = 20;
				}
				return num7;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_power",
			translation_key = "opinion_power",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result5 = 0;
				int num5 = pMain.countCities() * 5 + pMain.getPopulationPeople();
				int num6 = pTarget.countCities() * 5 + pTarget.getPopulationPeople() - num5;
				if (num6 > 0)
				{
					result5 = num6 / 10;
				}
				return result5;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_loyalty_traits",
			translation_key = "opinion_traits",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num3 = 0;
				if (pTarget.hasCulture() && pMain.hasKing() && pTarget.hasKing())
				{
					int num4 = AssetManager.traits.checkTraitsMod(pTarget.king, pMain.king);
					num3 += num4;
				}
				return num3;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_culture",
			translation_key = "opinion_culture_same",
			translation_key_negative = "opinion_culture_different",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result4 = 0;
				if (pTarget.hasCulture())
				{
					result4 = ((pTarget.getCulture() != pMain.getCulture()) ? (-15) : 15);
				}
				return result4;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_religion",
			translation_key = "opinion_religion_same",
			translation_key_negative = "opinion_religion_different",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result3 = 0;
				if (pTarget.hasReligion())
				{
					result3 = ((pTarget.getReligion() != pMain.getReligion()) ? (-15) : 15);
				}
				return result3;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_language",
			translation_key = "opinion_language_same",
			translation_key_negative = "opinion_language_different",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result2 = 0;
				if (pTarget.hasLanguage())
				{
					result2 = ((pTarget.getLanguage() != pMain.getLanguage()) ? (-15) : 15);
				}
				return result2;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_subspecies",
			translation_key = "opinion_subspecies_same",
			translation_key_negative = "opinion_subspecies_different",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num2 = 0;
				if (!pMain.hasKing())
				{
					return 0;
				}
				if (pMain.getSpecies() == pTarget.getSpecies())
				{
					return 0;
				}
				if (!pMain.king.canHavePrejudice())
				{
					return 0;
				}
				return (pTarget.getMainSubspecies() == pMain.getMainSubspecies()) ? 10 : (-10);
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_clan",
			translation_key = "opinion_same_clan",
			translation_key_negative = "opinion_different_clan",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int num = 0;
				Actor king = pMain.king;
				Actor king2 = pTarget.king;
				if (king == null || king2 == null)
				{
					return 0;
				}
				if (king.subspecies != king2.subspecies)
				{
					return 0;
				}
				if (!king.hasClan() || !king2.hasClan())
				{
					return 0;
				}
				if (!king.canHavePrejudice())
				{
					return 0;
				}
				return (king.clan == king2.clan) ? 40 : (-40);
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_in_alliance",
			translation_key = "opinion_in_alliance",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				int result = 0;
				if (pTarget.hasAlliance() && pMain.hasAlliance() && pTarget.getAlliance() == pMain.getAlliance())
				{
					result = 30;
				}
				return result;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_truce",
			translation_key = "opinion_truce",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				if (pMain.isEnemy(pTarget))
				{
					return 0;
				}
				return ((float)Date.getYearsSince(World.world.diplomacy.getRelation(pMain, pTarget).data.timestamp_last_war_ended) <= (float)SimGlobals.m.minimum_years_between_wars) ? 100 : 0;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_world_era",
			translation_key = "opinion_world_era",
			calc = (Kingdom pMain, Kingdom pTarget) => World.world_era.bonus_opinion
		});
		add(new OpinionAsset
		{
			id = "opinion_baby_king",
			translation_key = "opinion_baby_king",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				if (!pMain.hasKing())
				{
					return 0;
				}
				if (!pTarget.hasKing())
				{
					return 0;
				}
				if (pMain.king.isBaby())
				{
					return 0;
				}
				return pTarget.king.isBaby() ? (-50) : 0;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_ethnocentric_guard",
			translation_key = "opinion_ethnocentric_guard",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				if (!pMain.hasCulture())
				{
					return 0;
				}
				if (!pMain.culture.hasTrait("ethnocentric_guard"))
				{
					return 0;
				}
				if (pMain.getMainSubspecies() != pTarget.getMainSubspecies())
				{
					return 0;
				}
				return (pMain.culture != pTarget.culture) ? (-50) : 0;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_xenophobic",
			translation_key = "opinion_xenophobic",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				if (!pMain.hasCulture())
				{
					return 0;
				}
				if (!pMain.culture.hasTrait("xenophobic"))
				{
					return 0;
				}
				return (pMain.getMainSubspecies() != pTarget.getMainSubspecies()) ? (-50) : 0;
			}
		});
		add(new OpinionAsset
		{
			id = "opinion_xenophiles",
			translation_key = "opinion_xenophiles",
			calc = delegate(Kingdom pMain, Kingdom pTarget)
			{
				if (!pMain.hasCulture())
				{
					return 0;
				}
				if (!pMain.culture.hasTrait("xenophiles"))
				{
					return 0;
				}
				return (pMain.getMainSubspecies() == pTarget.getMainSubspecies()) ? 20 : 0;
			}
		});
	}

	public override void editorDiagnosticLocales()
	{
		foreach (OpinionAsset item in list)
		{
			foreach (string localeID in item.getLocaleIDs())
			{
				checkLocale(item, localeID);
			}
		}
		base.editorDiagnosticLocales();
	}
}
// --- End of File: OpinionLibrary.cs ---



// --- Start of File: OptionAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using Newtonsoft.Json;

[Serializable]
public class OptionAsset : Asset, IDescription2Asset, IDescriptionAsset, ILocalizedAsset, IMultiLocalesAsset
{
	public OptionType type;

	[DefaultValue(true)]
	public bool has_locales = true;

	public string translation_key;

	public string translation_key_description;

	public string translation_key_description_2;

	[DefaultValue(true)]
	public bool reset_to_default_on_launch;

	[DefaultValue(true)]
	public bool default_bool = true;

	public bool computer_only;

	public bool override_bool_mobile;

	[DefaultValue(true)]
	public bool default_bool_mobile = true;

	public string default_string = string.Empty;

	public int default_int;

	public ActionOptionAsset action;

	public ActionFormatCounterOptionAsset counter_format;

	public int min_value;

	public int max_value;

	public bool multi_toggle;

	public bool counter_percent;

	public string[] locale_options_ids;

	public bool update_all_elements_after_click;

	[DefaultValue(true)]
	public bool interactable = true;

	[JsonIgnore]
	public PlayerOptionData data => PlayerConfig.dict[id];

	[JsonIgnore]
	public int current_int_value => PlayerConfig.dict[id].intVal;

	[JsonIgnore]
	public bool current_bool_value => PlayerConfig.optionBoolEnabled(id);

	public string getLocaleID()
	{
		if (!has_locales)
		{
			return null;
		}
		if (!string.IsNullOrEmpty(translation_key))
		{
			return translation_key;
		}
		return id;
	}

	public string getDescriptionID()
	{
		if (!has_locales)
		{
			return null;
		}
		return translation_key_description;
	}

	public string getDescriptionID2()
	{
		if (!has_locales)
		{
			return null;
		}
		return translation_key_description_2;
	}

	public string getOptionLocaleID(int pIndex)
	{
		return locale_options_ids[pIndex];
	}

	public string getOptionLocaleID()
	{
		return getOptionLocaleID(current_int_value);
	}

	public string getTranslatedOption()
	{
		return getOptionLocaleID().Localize();
	}

	public IEnumerable<string> getLocaleIDs()
	{
		if (!has_locales)
		{
			yield break;
		}
		yield return getLocaleID();
		yield return getDescriptionID();
		yield return getDescriptionID2();
		if (locale_options_ids != null)
		{
			string[] array = locale_options_ids;
			for (int i = 0; i < array.Length; i++)
			{
				yield return array[i];
			}
		}
	}

	public bool isActive()
	{
		if (type == OptionType.Bool)
		{
			return PlayerConfig.optionBoolEnabled(id);
		}
		return PlayerConfig.getOptionInt(id) > 0;
	}
}
// --- End of File: OptionAsset.cs ---



// --- Start of File: OptionBool.cs ---
using System;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

[Obsolete]
public class OptionBool : MonoBehaviour
{
	public bool optionEnabled = true;

	public bool invokeCallbackOnStart = true;

	public SpriteRenderer spriteRenderer;

	public Image icon;

	private Button button;

	public Sprite spriteOn;

	public Sprite spriteOff;

	public UnityEvent callback;

	public UnityEvent<bool> boolCallback;

	public bool gameOption;

	public OptionType gameOptionType;

	public string gameOptionName = "-";

	private void Start()
	{
		updateSprite();
		if (invokeCallbackOnStart)
		{
			if (callback != null)
			{
				callback.Invoke();
			}
			if (boolCallback != null)
			{
				boolCallback.Invoke(optionEnabled);
			}
		}
	}

	public void checkGameOption(bool pSwitch = false)
	{
		if (pSwitch)
		{
			PlayerConfig.switchOption(gameOptionName, gameOptionType);
		}
		optionEnabled = PlayerConfig.optionEnabled(gameOptionName, gameOptionType);
		updateSprite();
		OptionAsset optionAsset = AssetManager.options_library.get(gameOptionName);
		optionAsset.action?.Invoke(optionAsset);
	}

	private void OnEnable()
	{
		if (!((Object)(object)World.world == (Object)null) && gameOption)
		{
			updateSprite();
			checkGameOption();
			updateSprite();
		}
	}

	public void clickButton()
	{
		if (gameOption)
		{
			checkGameOption(pSwitch: true);
			PlayerConfig.saveData();
			return;
		}
		optionEnabled = !optionEnabled;
		updateSprite();
		if (callback != null)
		{
			callback.Invoke();
		}
		if (boolCallback != null)
		{
			boolCallback.Invoke(optionEnabled);
		}
	}

	private void updateSprite()
	{
		if (optionEnabled)
		{
			icon.sprite = spriteOn;
		}
		else
		{
			icon.sprite = spriteOff;
		}
	}

	public void optionSpriteAnimation()
	{
		Config.sprite_animations_on = !Config.sprite_animations_on;
	}

	public void optionShowWORLD()
	{
		((Component)World.world).gameObject.SetActive(!((Component)World.world).gameObject.activeSelf);
	}

	public void optionRemovePremuium()
	{
		Config.hasPremium = false;
		PlayerConfig.instance.data.premium = false;
		PlayerConfig.saveData();
		PremiumElementsChecker.checkElements();
		if (Config.isMobile)
		{
			InAppManager.consumePremium();
		}
	}

	public void clearRewards()
	{
		PlayerConfig.instance.data.rewardedPowers.Clear();
		PlayerConfig.saveData();
		PremiumElementsChecker.checkElements();
	}

	public void optionShowCanvas()
	{
		((Behaviour)World.world.canvas).enabled = false;
	}

	public void optionRenderer()
	{
		((Renderer)spriteRenderer).enabled = optionEnabled;
		updateSprite();
	}
}
// --- End of File: OptionBool.cs ---



// --- Start of File: OptionButton.cs ---
using System;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class OptionButton : MonoBehaviour
{
	private const float DISABLED_ALPHA = 0.8f;

	public static bool player_config_dirty;

	public Image icon;

	public Text counter;

	public Text text;

	public PowerButton button_switch;

	public SliderExtended slider;

	public GameObject sliderArea;

	public GameObject optionArea;

	public Action eventLeft;

	public Action eventRight;

	public Color color_enabled;

	public Color color_disabled;

	[SerializeField]
	private Sprite _button_sprite_interactable;

	[SerializeField]
	private Sprite _button_sprite_not_interactable;

	public SettingsWindow settings_window;

	public OptionAsset option_asset => AssetManager.options_library.get(((Object)((Component)this).transform).name);

	private void Start()
	{
		settings_window = ((Component)((Component)this).transform.parent).GetComponentInParent<SettingsWindow>();
		settings_window.buttons.Add(this);
	}

	private void OnDestroy()
	{
		if ((Object)(object)settings_window != (Object)null)
		{
			settings_window.buttons.Remove(this);
		}
	}

	private void OnEnable()
	{
		if (option_asset == null)
		{
			Debug.LogError((object)("Missing Option - " + ((Object)((Component)this).transform).name));
			return;
		}
		string localeID = option_asset.getLocaleID();
		((Component)text).GetComponent<LocalizedText>().setKeyAndUpdate(localeID);
		TipButton tipButton = ((option_asset.type != 0) ? ((Component)slider).GetComponent<TipButton>() : ((Component)button_switch).GetComponent<TipButton>());
		tipButton.setHoverAction(delegate
		{
			if (InputHelpers.mouseSupported)
			{
				showTooltip();
			}
		});
		if (!string.IsNullOrEmpty(option_asset.getDescriptionID2()))
		{
			((Component)slider).GetComponent<TipButton>().text_description_2 = option_asset.getDescriptionID2();
			((Component)button_switch).GetComponent<TipButton>().text_description_2 = option_asset.getDescriptionID2();
		}
		if (option_asset.type == OptionType.Bool)
		{
			((Component)counter).gameObject.SetActive(false);
			((Component)button_switch).gameObject.SetActive(true);
			sliderArea.SetActive(false);
		}
		else if (option_asset.type == OptionType.Int)
		{
			((Component)counter).gameObject.SetActive(true);
			((Component)button_switch).gameObject.SetActive(false);
			sliderArea.SetActive(true);
			updateSlider();
			((UnityEvent<float>)(object)((Slider)slider).onValueChanged).AddListener((UnityAction<float>)sliderChanged);
			slider.addCallbackPointerDown(checkShowSliderTooltip);
		}
		updateElements();
	}

	public void showTooltip()
	{
		Tooltip.show(this, "tip", getTooltipData());
	}

	public void checkShowSliderTooltip()
	{
		if (!InputHelpers.mouseSupported)
		{
			if (Input.touchCount >= 2)
			{
				Tooltip.hideTooltip();
			}
			else
			{
				showTooltip();
			}
		}
	}

	private TooltipData getTooltipData()
	{
		TooltipData tooltipData = new TooltipData
		{
			tip_name = option_asset.getLocaleID(),
			tip_description = option_asset.getDescriptionID()
		};
		string descriptionID = option_asset.getDescriptionID2();
		if (!string.IsNullOrEmpty(descriptionID))
		{
			tooltipData.tip_description_2 = descriptionID;
		}
		return tooltipData;
	}

	public void switchBoolOption()
	{
		bool flag = PlayerConfig.optionBoolEnabled(option_asset.id);
		PlayerConfig.setOptionBool(option_asset.id, !flag);
		player_config_dirty = true;
	}

	public void clickSwitch()
	{
		if (option_asset == null)
		{
			Debug.LogError((object)("Missing Option - " + ((Object)((Component)this).transform).name));
			return;
		}
		if (!InputHelpers.mouseSupported && !Tooltip.isShowingFor(this))
		{
			showTooltip();
			return;
		}
		switchBoolOption();
		option_asset.action?.Invoke(option_asset);
		if (option_asset.update_all_elements_after_click)
		{
			settings_window.updateAllElements();
		}
		else
		{
			updateElements();
		}
	}

	private int clampAssetValue(int pValue)
	{
		return Mathf.Clamp(pValue, option_asset.min_value, option_asset.max_value);
	}

	private void sliderChanged(float pValue)
	{
		int pValue2 = (int)pValue;
		pValue2 = clampAssetValue(pValue2);
		PlayerConfig.setOptionInt(option_asset.id, pValue2);
		player_config_dirty = true;
		option_asset.action?.Invoke(option_asset);
		updateElements();
		checkShowSliderTooltip();
	}

	public void updateElements(bool pCallCallbacks = false)
	{
		updateCounter();
		updateSwitchButton();
		updateColors();
		updateSlider(pCallCallbacks);
	}

	private void updateSlider(bool pCallCallbacks = false)
	{
		if (option_asset.type == OptionType.Int)
		{
			((Slider)slider).minValue = option_asset.min_value;
			((Slider)slider).maxValue = option_asset.max_value;
			if (!pCallCallbacks)
			{
				((Slider)slider).SetValueWithoutNotify((float)PlayerConfig.getIntValue(option_asset.id));
			}
			else
			{
				((Slider)slider).value = PlayerConfig.getIntValue(option_asset.id);
			}
			((Slider)slider).wholeNumbers = false;
		}
	}

	private void updateColors()
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		if (option_asset.type == OptionType.Bool)
		{
			if (!option_asset.interactable)
			{
				((Graphic)text).color = color_disabled;
				((Graphic)icon).color = color_disabled;
			}
			else if (PlayerConfig.optionBoolEnabled(option_asset.id))
			{
				((Graphic)text).color = color_enabled;
				((Graphic)icon).color = color_enabled;
			}
			else
			{
				((Graphic)text).color = color_disabled;
				((Graphic)icon).color = color_disabled;
			}
		}
	}

	private void updateSwitchButton()
	{
		if (option_asset.type != 0)
		{
			return;
		}
		Image component = ((Component)button_switch).GetComponent<Image>();
		CanvasGroup component2 = ((Component)button_switch).GetComponent<CanvasGroup>();
		if (!option_asset.interactable)
		{
			component2.alpha = 0.8f;
			component2.interactable = false;
			component.sprite = _button_sprite_not_interactable;
			return;
		}
		component2.interactable = true;
		component.sprite = _button_sprite_interactable;
		if (PlayerConfig.optionBoolEnabled(option_asset.id))
		{
			component2.alpha = 1f;
			((Component)((Component)button_switch).transform.Find("Text")).GetComponent<LocalizedText>().setKeyAndUpdate("short_on");
			button_switch.icon.sprite = SpriteTextureLoader.getSprite("ui/icons/IconOn");
		}
		else
		{
			component2.alpha = 0.8f;
			((Component)((Component)button_switch).transform.Find("Text")).GetComponent<LocalizedText>().setKeyAndUpdate("short_off");
			button_switch.icon.sprite = SpriteTextureLoader.getSprite("ui/icons/IconOff");
		}
	}

	public void updateCounter()
	{
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		if (option_asset.type == OptionType.Int)
		{
			int intValue = PlayerConfig.getIntValue(option_asset.id);
			string text = intValue.ToString();
			if (option_asset.counter_format != null)
			{
				text = option_asset.counter_format(option_asset);
			}
			else if (option_asset.counter_percent)
			{
				text += "%";
			}
			counter.text = text;
			if (intValue == 0)
			{
				((Graphic)this.text).color = color_disabled;
				((Graphic)counter).color = color_disabled;
				((Graphic)icon).color = color_disabled;
			}
			else
			{
				((Graphic)this.text).color = color_enabled;
				((Graphic)counter).color = color_enabled;
				((Graphic)icon).color = color_enabled;
			}
		}
	}

	private void sliderDragEnded()
	{
		if (!InputHelpers.mouseSupported)
		{
			Tooltip.hideTooltip();
		}
	}
}
// --- End of File: OptionButton.cs ---



// --- Start of File: OptionsLibrary.cs ---
using SleekRender;
using UnityEngine;

public class OptionsLibrary : AssetLibrary<OptionAsset>
{
	public override void init()
	{
		base.init();
		initGameplayOptions();
		initLayerOptions();
		initAppOptions();
		initQualityOptions();
		initOtherOptions();
		initHotkeyOptions();
	}

	private void initLayerOptions()
	{
		add(new OptionAsset
		{
			id = "map_layers",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "map_species_families",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "map_kingdom_layer",
			default_int = 0,
			max_value = 1,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_borders", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_city_layer",
			default_int = 1,
			max_value = 1,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_borders", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_clan_layer",
			default_int = 0,
			max_value = 2,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_kingdoms", "ui_zone_mode_cities", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_religion_layer",
			default_int = 2,
			max_value = 2,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_kingdoms", "ui_zone_mode_cities", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_culture_layer",
			default_int = 2,
			max_value = 2,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_kingdoms", "ui_zone_mode_cities", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_subspecies_layer",
			default_int = 2,
			max_value = 2,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_kingdoms", "ui_zone_mode_cities", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_family_layer",
			default_int = 2,
			max_value = 2,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_kingdoms", "ui_zone_mode_cities", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_language_layer",
			default_int = 2,
			max_value = 2,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_zone_mode_kingdoms", "ui_zone_mode_cities", "ui_zone_mode_units")
		});
		add(new OptionAsset
		{
			id = "map_alliance_layer",
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "map_army_layer",
			default_bool = false,
			type = OptionType.Bool
		});
	}

	private void initGameplayOptions()
	{
		add(new OptionAsset
		{
			id = "map_names",
			default_bool = true,
			default_int = 0,
			max_value = 1,
			multi_toggle = true,
			type = OptionType.Bool,
			locale_options_ids = AssetLibrary<OptionAsset>.a<string>("ui_map_names_normal", "ui_map_names_banners_only")
		});
		add(new OptionAsset
		{
			id = "map_kings_leaders",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_favorites",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_favorite_items",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_plots",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_wars",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_armies",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "only_favorited_meta",
			default_bool = false,
			reset_to_default_on_launch = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "money_flow",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "icons_happiness",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "icons_tasks",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "talk_bubbles",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "meta_conversions",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "unit_metas",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_battles",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "history_log",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "marks_boats",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "army_targets",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "tooltip_zones",
			default_bool = true,
			default_bool_mobile = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "tooltip_units",
			default_bool = true,
			default_bool_mobile = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_destination",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_house",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_lover",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_family",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_parents",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_kids",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "cursor_arrow_attack_target",
			default_bool = false,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "highlight_kingdom_enemies",
			default_bool = true,
			type = OptionType.Bool,
			override_bool_mobile = true,
			default_bool_mobile = false
		});
	}

	private void initAppOptions()
	{
		add(new OptionAsset
		{
			id = "autorotation",
			translation_key = "autorotation",
			translation_key_description = "option_description_autorotation",
			update_all_elements_after_click = true,
			default_bool = false,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				Config.setAutorotation(getSavedBool(pAsset.id));
			}
		});
		add(new OptionAsset
		{
			id = "portrait",
			translation_key = "portrait_mode",
			translation_key_description = "option_description_portrait",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				Config.setPortrait(getSavedBool(pAsset.id));
			}
		});
		add(new OptionAsset
		{
			id = "fps_lock_30",
			translation_key_description = "option_description_fps_lock_30",
			default_bool = false,
			type = OptionType.Bool,
			update_all_elements_after_click = true,
			action = delegate(OptionAsset pAsset)
			{
				bool num = (Config.fps_lock_30 = getSavedBool(pAsset.id));
				if (Config.fps_lock_30)
				{
					Application.targetFrameRate = 30;
				}
				else
				{
					Application.targetFrameRate = 60;
				}
				if (num)
				{
					forceDisableOption("vsync");
				}
			}
		});
		add(new OptionAsset
		{
			id = "sound",
			translation_key = "sound_effects",
			translation_key_description = "option_description_sound_effects",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "volume_master_sound",
			translation_key_description = "option_description_volume_master_sound",
			default_int = 100,
			type = OptionType.Int,
			max_value = 100,
			min_value = 0,
			counter_percent = true
		});
		add(new OptionAsset
		{
			id = "volume_music",
			translation_key_description = "option_description_volume_music",
			default_int = 100,
			type = OptionType.Int,
			max_value = 100,
			min_value = 0,
			counter_percent = true
		});
		add(new OptionAsset
		{
			id = "volume_sound_effects",
			translation_key_description = "option_description_volume_sound_effects",
			default_int = 100,
			type = OptionType.Int,
			max_value = 100,
			min_value = 0,
			counter_percent = true
		});
		add(new OptionAsset
		{
			id = "volume_ui",
			translation_key_description = "option_description_volume_ui",
			default_int = 100,
			type = OptionType.Int,
			max_value = 100,
			min_value = 0,
			counter_percent = true
		});
		add(new OptionAsset
		{
			id = "music",
			translation_key_description = "option_description_music",
			translation_key = "music",
			default_bool = true,
			type = OptionType.Bool
		});
		add(new OptionAsset
		{
			id = "vsync",
			translation_key = "vsync",
			translation_key_description = "option_description_vsync",
			default_bool = false,
			type = OptionType.Bool,
			update_all_elements_after_click = true,
			computer_only = true,
			action = delegate(OptionAsset pAsset)
			{
				bool savedBool = getSavedBool(pAsset.id);
				PlayerConfig.setVsync(savedBool);
				if (savedBool)
				{
					forceDisableOption("fps_lock_30");
				}
			}
		});
		add(new OptionAsset
		{
			id = "fullscreen",
			default_bool = true,
			translation_key_description = "option_description_fullscreen",
			type = OptionType.Bool,
			computer_only = true,
			action = delegate(OptionAsset pAsset)
			{
				//IL_0018: Unknown result type (might be due to invalid IL or missing references)
				//IL_001d: Unknown result type (might be due to invalid IL or missing references)
				//IL_0025: Unknown result type (might be due to invalid IL or missing references)
				//IL_002a: Unknown result type (might be due to invalid IL or missing references)
				//IL_0033: Unknown result type (might be due to invalid IL or missing references)
				//IL_0038: Unknown result type (might be due to invalid IL or missing references)
				//IL_003b: Unknown result type (might be due to invalid IL or missing references)
				//IL_0040: Unknown result type (might be due to invalid IL or missing references)
				//IL_0043: Unknown result type (might be due to invalid IL or missing references)
				Config.full_screen = getSavedBool(pAsset.id);
				if (Config.full_screen)
				{
					Resolution currentResolution = Screen.currentResolution;
					int width = ((Resolution)(ref currentResolution)).width;
					currentResolution = Screen.currentResolution;
					int height = ((Resolution)(ref currentResolution)).height;
					currentResolution = Screen.currentResolution;
					RefreshRate refreshRateRatio = ((Resolution)(ref currentResolution)).refreshRateRatio;
					Screen.SetResolution(width, height, (FullScreenMode)1, refreshRateRatio);
				}
				else
				{
					Screen.fullScreen = false;
				}
			}
		});
		add(new OptionAsset
		{
			id = "language",
			type = OptionType.String,
			default_string = "en"
		});
		add(new OptionAsset
		{
			id = "username",
			type = OptionType.String,
			default_string = "",
			has_locales = false
		});
		add(new OptionAsset
		{
			id = "wbb_confirmed",
			type = OptionType.Bool,
			default_bool = false,
			has_locales = false,
			action = delegate(OptionAsset pAsset)
			{
				Config.wbb_confirmed = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "ui_size_main",
			translation_key = "power_bar_size",
			translation_key_description = "option_description_power_bar_size",
			type = OptionType.Int,
			default_int = 100,
			max_value = 150,
			min_value = 50,
			action = delegate
			{
				CanvasMain.instance.resizeMainUI();
				PowerButtonSelector.instance.showBarTemporary();
			},
			counter_format = getCounterFormat100Percent
		});
		add(new OptionAsset
		{
			id = "ui_size_windows",
			translation_key_description = "option_description_ui_windows_size",
			type = OptionType.Int,
			default_int = 100,
			max_value = 115,
			min_value = 30,
			action = delegate
			{
				CanvasMain.instance.resizeWindowsUI();
				MetaSwitchManager.checkAndRefresh();
				HoveringBgIconManager.dropAll();
			},
			counter_format = getCounterFormat100Percent
		});
		add(new OptionAsset
		{
			id = "ui_size_tooltips",
			translation_key_description = "option_description_ui_tooltips_size",
			type = OptionType.Int,
			default_int = 100,
			max_value = 150,
			min_value = 30,
			action = delegate
			{
				CanvasMain.instance.resizeTooltipUI();
			},
			counter_format = getCounterFormat100Percent
		});
		add(new OptionAsset
		{
			id = "ui_size_map_names",
			translation_key_description = "option_description_ui_map_names_size",
			type = OptionType.Int,
			default_int = 70,
			max_value = 160,
			min_value = 30,
			action = delegate
			{
				CanvasMain.instance.resizeMapNames();
				World.world.nameplate_manager.clearCaches();
			},
			counter_format = getCounterFormat100Percent
		});
		add(new OptionAsset
		{
			id = "ui_map_border_opacity",
			translation_key_description = "option_description_map_border_opacity",
			type = OptionType.Int,
			default_int = 88,
			max_value = 100,
			min_value = 30,
			action = delegate(OptionAsset pAsset)
			{
				float minimap_opacity = (float)getSavedInt(pAsset.id) / 100f;
				World.world.zone_calculator.minimap_opacity = minimap_opacity;
			},
			counter_format = getCounterFormat100Percent
		});
		add(new OptionAsset
		{
			id = "ui_map_border_brightness",
			translation_key_description = "option_description_map_border_brightness",
			type = OptionType.Int,
			default_int = 100,
			max_value = 100,
			min_value = 60,
			action = delegate(OptionAsset pAsset)
			{
				float border_brightness = (float)getSavedInt(pAsset.id) / 100f;
				World.world.zone_calculator.border_brightness = border_brightness;
			},
			counter_format = getCounterFormat100Percent
		});
	}

	private void initQualityOptions()
	{
		add(new OptionAsset
		{
			id = "vignette",
			translation_key_description = "option_description_vignette",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				((Component)Camera.main).GetComponent<SleekRenderPostProcess>().settings.vignetteEnabled = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "bloom",
			translation_key_description = "option_description_bloom",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				((Component)Camera.main).GetComponent<SleekRenderPostProcess>().settings.bloomEnabled = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "fire",
			translation_key_description = "option_description_fire",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				((Behaviour)World.world.particles_fire).enabled = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "smoke",
			translation_key_description = "option_description_smoke",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				((Behaviour)World.world.particles_smoke).enabled = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "shadows",
			translation_key_description = "option_description_shadows",
			type = OptionType.Bool,
			default_bool = true,
			action = delegate(OptionAsset pAsset)
			{
				Config.shadows_active = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "tree_wind",
			translation_key_description = "option_description_tree_wind",
			type = OptionType.Bool,
			default_bool = true,
			action = delegate(OptionAsset pAsset)
			{
				BuildingRendererSettings.wobbly_material_enabled = getSavedBool(pAsset.id);
				World.world.buildings.checkWobblySetting();
			}
		});
		add(new OptionAsset
		{
			id = "minimap_transition_animation",
			translation_key_description = "option_description_minimap_transition_animation",
			type = OptionType.Bool,
			default_bool = true
		});
		add(new OptionAsset
		{
			id = "night_lights",
			translation_key_description = "option_description_night_lights",
			type = OptionType.Bool,
			default_bool = true
		});
		add(new OptionAsset
		{
			id = "cursor_lights",
			translation_key_description = "option_description_cursor_lights",
			type = OptionType.Bool,
			default_bool = true,
			default_bool_mobile = false
		});
		add(new OptionAsset
		{
			id = "age_particles",
			translation_key_description = "option_description_age_particles",
			type = OptionType.Bool,
			default_bool = true,
			action = delegate(OptionAsset pAsset)
			{
				WorldAgesParticles.effects_enabled = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "age_overlay_effect",
			translation_key_description = "option_description_age_overlay_effect",
			type = OptionType.Int,
			default_int = 100,
			max_value = 100,
			min_value = 0,
			counter_format = getCounterFormat100Percent
		});
		add(new OptionAsset
		{
			id = "age_night_effect",
			translation_key_description = "option_description_age_night_effect",
			type = OptionType.Int,
			default_int = 100,
			max_value = 100,
			min_value = 50,
			counter_format = getCounterFormat100Percent
		});
	}

	private string getCounterFormat100Percent(OptionAsset pAsset)
	{
		return PlayerConfig.getIntValue(pAsset.id) + "%";
	}

	private void initOtherOptions()
	{
		add(new OptionAsset
		{
			id = "preload_windows",
			translation_key_description = "option_description_preload_windows",
			default_bool = true,
			type = OptionType.Bool,
			override_bool_mobile = true,
			default_bool_mobile = false,
			action = delegate(OptionAsset pAsset)
			{
				Config.preload_windows = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "preload_quantum_sprites",
			translation_key_description = "option_description_preload_quantum_sprites",
			default_bool = true,
			type = OptionType.Bool,
			override_bool_mobile = true,
			default_bool_mobile = false,
			action = delegate(OptionAsset pAsset)
			{
				Config.preload_quantum_sprites = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "preload_buildings",
			translation_key_description = "option_description_preload_buildings",
			default_bool = true,
			type = OptionType.Bool,
			override_bool_mobile = true,
			default_bool_mobile = false,
			action = delegate(OptionAsset pAsset)
			{
				Config.preload_buildings = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "preload_units",
			translation_key_description = "option_description_preload_units",
			default_bool = true,
			type = OptionType.Bool,
			override_bool_mobile = true,
			default_bool_mobile = false,
			action = delegate(OptionAsset pAsset)
			{
				Config.preload_units = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "autosaves",
			translation_key_description = "option_description_autosaves",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				Config.autosaves = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "graphs",
			translation_key_description = "option_description_graphs",
			default_bool = true,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				Config.graphs = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "tooltips",
			translation_key_description = "option_description_tooltips",
			default_bool = true,
			type = OptionType.Bool,
			override_bool_mobile = true,
			default_bool_mobile = false,
			action = delegate(OptionAsset pAsset)
			{
				Config.tooltips_active = getSavedBool(pAsset.id);
			}
		});
		add(new OptionAsset
		{
			id = "experimental",
			translation_key_description = "option_description_experimental",
			translation_key_description_2 = "option_description_experimental_warning",
			default_bool = false,
			type = OptionType.Bool,
			action = delegate(OptionAsset pAsset)
			{
				bool flag = getSavedBool(pAsset.id);
				if (flag)
				{
					string savedString = getSavedString("last_used_version");
					if (savedString != Application.version)
					{
						flag = false;
						Debug.LogWarning((object)("Last version and current version differ, disabling experimental mode " + savedString + " " + Application.version));
						setSavedBool(pAsset.id, flag);
					}
					else
					{
						Debug.Log((object)"Experimental mode is enabled");
						WorldTip.instance.showToolbarText("Experimental mode is enabled");
					}
				}
				Config.experimental_mode = flag;
			}
		});
		add(new OptionAsset
		{
			id = "last_used_version",
			default_string = "",
			type = OptionType.String,
			has_locales = false,
			action = delegate(OptionAsset pAsset)
			{
				PlayerConfig.setOptionString(pAsset.id, Application.version);
			}
		});
	}

	private void initHotkeyOptions()
	{
		add(new OptionAsset
		{
			id = "hotkey_1",
			default_string = string.Empty,
			type = OptionType.String,
			has_locales = false
		});
		clone("hotkey_2", "hotkey_1");
		clone("hotkey_3", "hotkey_1");
		clone("hotkey_4", "hotkey_1");
		clone("hotkey_5", "hotkey_1");
		clone("hotkey_6", "hotkey_1");
		clone("hotkey_7", "hotkey_1");
		clone("hotkey_8", "hotkey_1");
		clone("hotkey_9", "hotkey_1");
		clone("hotkey_0", "hotkey_1");
	}

	public void forceDisableOption(string pID)
	{
		OptionAsset optionAsset = get(pID);
		if (!optionAsset.computer_only || !Config.isMobile)
		{
			PlayerConfig.setOptionBool(optionAsset.id, pVal: false);
			optionAsset.action?.Invoke(optionAsset);
		}
	}

	private bool getSavedBool(string pAssetID)
	{
		return PlayerConfig.optionBoolEnabled(pAssetID);
	}

	private void setSavedBool(string pAssetID, bool pValue)
	{
		PlayerConfig.setOptionBool(pAssetID, pValue);
	}

	private int getSavedInt(string pAssetID)
	{
		return PlayerConfig.getOptionInt(pAssetID);
	}

	private string getSavedString(string pAssetID)
	{
		return PlayerConfig.getOptionString(pAssetID);
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (OptionAsset item in list)
		{
			if (!item.has_locales || item.type != 0 || !string.IsNullOrEmpty(item.translation_key))
			{
				continue;
			}
			foreach (GodPower item2 in AssetManager.powers.list)
			{
				if (!(item2.toggle_name != item.id))
				{
					item.translation_key = item2.getLocaleID();
					if (string.IsNullOrEmpty(item.translation_key_description))
					{
						item.translation_key_description = item2.getDescriptionID();
					}
				}
			}
		}
	}

	public override void editorDiagnosticLocales()
	{
		foreach (OptionAsset item in list)
		{
			if (item.has_locales)
			{
				checkLocale(item, item.getLocaleID());
				checkLocale(item, item.getDescriptionID());
				checkLocale(item, item.getDescriptionID2());
			}
		}
		base.editorDiagnosticLocales();
	}
}
// --- End of File: OptionsLibrary.cs ---



// --- Start of File: OptionType.cs ---
public enum OptionType
{
	Bool,
	String,
	Int
}
// --- End of File: OptionType.cs ---



// --- Start of File: OrderedContractResolver.cs ---
using System;
using System.Collections;
using System.Collections.Generic;
using Newtonsoft.Json;
using Newtonsoft.Json.Serialization;

public class OrderedContractResolver : DefaultContractResolver
{
	protected override IList<JsonProperty> CreateProperties(Type pObjectType, MemberSerialization pMemberSerialization)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		List<JsonProperty> list = new List<JsonProperty>(((DefaultContractResolver)this).CreateProperties(pObjectType, pMemberSerialization));
		list.Sort(orderedPropertySorter);
		return list;
	}

	private int orderedPropertySorter(JsonProperty p1, JsonProperty p2)
	{
		if (p1.Order != p2.Order)
		{
			int num = p1.Order ?? int.MaxValue;
			int value = p2.Order ?? int.MaxValue;
			return num.CompareTo(value);
		}
		bool flag = isDelegate(p1.PropertyType);
		bool flag2 = isDelegate(p2.PropertyType);
		if (flag != flag2)
		{
			return flag.CompareTo(flag2);
		}
		bool flag3 = isCollection(p1.PropertyType);
		bool flag4 = isCollection(p2.PropertyType);
		if (flag3 != flag4)
		{
			return flag3.CompareTo(flag4);
		}
		return p1.PropertyName.CompareTo(p2.PropertyName);
	}

	private int getBaseTypesCount(Type pType)
	{
		int num = 0;
		while (pType != null)
		{
			num++;
			pType = pType.BaseType;
		}
		return num;
	}

	private bool isDelegate(Type pType)
	{
		if (!(pType == typeof(Delegate)))
		{
			return pType.IsSubclassOf(typeof(Delegate));
		}
		return true;
	}

	private bool isCollection(Type pType)
	{
		return typeof(ICollection).IsAssignableFrom(pType);
	}
}
// --- End of File: OrderedContractResolver.cs ---



// --- Start of File: ParallelHelper.cs ---
using System;
using System.Runtime.CompilerServices;
using UnityEngine;

public static class ParallelHelper
{
	public static int DEBUG_BATCH_SIZE = 128;

	private const int MAX_BATCH_SIZE = 256;

	private static readonly int[] _batch_sizes = new int[11]
	{
		4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048,
		4096
	};

	public static int getDynamicBatchSize(int pCount)
	{
		if (pCount <= 32)
		{
			return 4;
		}
		if (pCount <= 64)
		{
			return 8;
		}
		if (pCount <= 128)
		{
			return 16;
		}
		if (pCount <= 256)
		{
			return 32;
		}
		if (pCount <= 512)
		{
			return 64;
		}
		if (pCount <= 2048)
		{
			return 128;
		}
		return 256;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static int calcTotalBatches(int pItemsTotal, int pBatchSize)
	{
		return Mathf.CeilToInt((float)pItemsTotal / (float)pBatchSize);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static int calculateBatchEnd(int pItemsIndexStart, int pBatchSize, int pItemsTotal)
	{
		return Mathf.Min(pItemsIndexStart + pBatchSize, pItemsTotal);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static int calculateBatchBeg(int pBatchIndex, int pBatchSize)
	{
		return pBatchIndex * pBatchSize;
	}

	public static void moveDebugBatchSize()
	{
		int num = Array.IndexOf(_batch_sizes, DEBUG_BATCH_SIZE);
		if (num == -1)
		{
			num = 0;
		}
		num = (num + 1) % _batch_sizes.Length;
		DEBUG_BATCH_SIZE = _batch_sizes[num];
	}
}
// --- End of File: ParallelHelper.cs ---



// --- Start of File: ParamBase.cs ---
namespace EpPathFinding.cs;

public abstract class ParamBase
{
	internal BaseGrid m_searchGrid;

	internal Node m_startNode;

	internal Node m_endNode;

	internal HeuristicMode m_heuristicMode;

	public DiagonalMovement DiagonalMovement;

	public BaseGrid SearchGrid => m_searchGrid;

	public Node StartNode => m_startNode;

	public Node EndNode => m_endNode;

	public ParamBase(BaseGrid iGrid, GridPos iStartPos, GridPos iEndPos, DiagonalMovement iDiagonalMovement, HeuristicMode iMode)
		: this(iGrid, iDiagonalMovement, iMode)
	{
		m_startNode = m_searchGrid.GetNodeAt(iStartPos.x, iStartPos.y);
		m_endNode = m_searchGrid.GetNodeAt(iEndPos.x, iEndPos.y);
		if (m_startNode == null)
		{
			m_startNode = new Node(iStartPos.x, iStartPos.y, true);
		}
		if (m_endNode == null)
		{
			m_endNode = new Node(iEndPos.x, iEndPos.y, true);
		}
	}

	public void setGrid(BaseGrid iGrid, GridPos iStartPos, GridPos iEndPos)
	{
		m_searchGrid = iGrid;
		m_startNode = m_searchGrid.GetNodeAt(iStartPos.x, iStartPos.y);
		m_endNode = m_searchGrid.GetNodeAt(iEndPos.x, iEndPos.y);
		if (m_startNode == null)
		{
			m_startNode = new Node(iStartPos.x, iStartPos.y, true);
		}
		if (m_endNode == null)
		{
			m_endNode = new Node(iEndPos.x, iEndPos.y, true);
		}
	}

	public ParamBase(BaseGrid iGrid, DiagonalMovement iDiagonalMovement, HeuristicMode iMode)
	{
		SetHeuristic(iMode);
		m_searchGrid = iGrid;
		DiagonalMovement = iDiagonalMovement;
		m_startNode = null;
		m_endNode = null;
	}

	public ParamBase()
	{
	}

	public ParamBase(ParamBase param)
	{
		m_searchGrid = param.m_searchGrid;
		DiagonalMovement = param.DiagonalMovement;
		m_startNode = param.m_startNode;
		m_endNode = param.m_endNode;
	}

	internal abstract void _reset(GridPos iStartPos, GridPos iEndPos, BaseGrid iSearchGrid = null);

	public void Reset(GridPos iStartPos, GridPos iEndPos, BaseGrid iSearchGrid = null)
	{
		_reset(iStartPos, iEndPos, iSearchGrid);
		m_startNode = null;
		m_endNode = null;
		if (iSearchGrid != null)
		{
			m_searchGrid = iSearchGrid;
		}
		m_searchGrid.Reset();
		m_startNode = m_searchGrid.GetNodeAt(iStartPos.x, iStartPos.y);
		m_endNode = m_searchGrid.GetNodeAt(iEndPos.x, iEndPos.y);
		if (m_startNode == null)
		{
			m_startNode = new Node(iStartPos.x, iStartPos.y, true);
		}
		if (m_endNode == null)
		{
			m_endNode = new Node(iEndPos.x, iEndPos.y, true);
		}
	}

	public void SetHeuristic(HeuristicMode iMode)
	{
		m_heuristicMode = iMode;
	}
}
// --- End of File: ParamBase.cs ---



// --- Start of File: PartialGridWPool.cs ---
using System.Collections.Generic;

namespace EpPathFinding.cs;

public class PartialGridWPool : BaseGrid
{
	private NodePool m_nodePool;

	public override int width
	{
		get
		{
			return m_gridRect.maxX - m_gridRect.minX + 1;
		}
		protected set
		{
		}
	}

	public override int height
	{
		get
		{
			return m_gridRect.maxY - m_gridRect.minY + 1;
		}
		protected set
		{
		}
	}

	public PartialGridWPool(NodePool iNodePool, GridRect iGridRect = null)
	{
		if (iGridRect == null)
		{
			m_gridRect = new GridRect();
		}
		else
		{
			m_gridRect = iGridRect;
		}
		m_nodePool = iNodePool;
	}

	public PartialGridWPool(PartialGridWPool b)
		: base(b)
	{
		m_nodePool = b.m_nodePool;
	}

	public void SetGridRect(GridRect iGridRect)
	{
		m_gridRect = iGridRect;
	}

	public bool IsInside(int iX, int iY)
	{
		if (iX < m_gridRect.minX || iX > m_gridRect.maxX || iY < m_gridRect.minY || iY > m_gridRect.maxY)
		{
			return false;
		}
		return true;
	}

	public override Node GetNodeAt(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return GetNodeAt(iPos);
	}

	public override bool IsWalkableAt(int iX, int iY)
	{
		GridPos iPos = new GridPos(iX, iY);
		return IsWalkableAt(iPos);
	}

	public override bool SetWalkableAt(int iX, int iY, bool iWalkable, int pCost = 1)
	{
		if (!IsInside(iX, iY))
		{
			return false;
		}
		GridPos iPos = new GridPos(iX, iY);
		m_nodePool.SetNode(iPos, iWalkable);
		return true;
	}

	public bool IsInside(GridPos iPos)
	{
		return IsInside(iPos.x, iPos.y);
	}

	public override Node GetNodeAt(GridPos iPos)
	{
		if (!IsInside(iPos))
		{
			return null;
		}
		return m_nodePool.GetNode(iPos);
	}

	public override bool IsWalkableAt(GridPos iPos)
	{
		if (!IsInside(iPos))
		{
			return false;
		}
		return m_nodePool.Nodes.ContainsKey(iPos);
	}

	public override bool SetWalkableAt(GridPos iPos, bool iWalkable)
	{
		return SetWalkableAt(iPos.x, iPos.y, iWalkable);
	}

	public override void Reset()
	{
		int num = (m_gridRect.maxX - m_gridRect.minX) * (m_gridRect.maxY - m_gridRect.minY);
		if (m_nodePool.Nodes.Count > num)
		{
			GridPos gridPos = new GridPos(0, 0);
			for (int i = m_gridRect.minX; i <= m_gridRect.maxX; i++)
			{
				gridPos.x = i;
				for (int j = m_gridRect.minY; j <= m_gridRect.maxY; j++)
				{
					gridPos.y = j;
					Node node = m_nodePool.GetNode(gridPos);
					if (node != null)
					{
						node.Reset();
					}
				}
			}
			return;
		}
		foreach (KeyValuePair<GridPos, Node> node2 in m_nodePool.Nodes)
		{
			node2.Value.Reset();
		}
	}

	public override BaseGrid Clone()
	{
		return new PartialGridWPool(m_nodePool, m_gridRect);
	}
}
// --- End of File: PartialGridWPool.cs ---



// --- Start of File: PassableZoneChecker.cs ---
public delegate bool PassableZoneChecker(TileZone pZone, TileZone pZoneCenter = null);
// --- End of File: PassableZoneChecker.cs ---



// --- Start of File: PatchLogElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PatchLogElement : MonoBehaviour
{
	public PatchLogTitle title;

	public Text date;

	public Text date_ago;

	public Image background;

	public GameObject texts;

	public bool _folded;

	public void fold()
	{
		_folded = true;
		title.setFolded();
		texts.gameObject.SetActive(false);
	}

	public void unfold()
	{
		_folded = false;
		title.setUnfolded();
		texts.gameObject.SetActive(true);
	}

	public void toggleState()
	{
		if (_folded)
		{
			unfold();
		}
		else
		{
			fold();
		}
	}
}
// --- End of File: PatchLogElement.cs ---



// --- Start of File: PatchLogEntry.cs ---
public class PatchLogEntry
{
	public string date;

	public string text;

	public string name;

	public string icon_path;

	public string version;
}
// --- End of File: PatchLogEntry.cs ---



// --- Start of File: PatchLogLoader.cs ---
using System;
using System.Collections;
using System.Collections.Generic;
using System.Globalization;
using Humanizer;
using UnityEngine;
using UnityEngine.UI;

public class PatchLogLoader : MonoBehaviour
{
	private const int FIRST_UNFOLDED_ELEMS_AMOUNT = 5;

	[SerializeField]
	private GameObject _prefab_text;

	[SerializeField]
	private GameObject _prefab_entry_bg;

	[SerializeField]
	private PatchLogElement _prefab_element;

	private readonly List<GameObject> _visual_elements = new List<GameObject>();

	private readonly Dictionary<string, PatchLogEntry> _entries_dict = new Dictionary<string, PatchLogEntry>();

	private readonly List<PatchLogEntry> _entries_list = new List<PatchLogEntry>();

	public void OnEnable()
	{
		loadEntries();
		((MonoBehaviour)this).StartCoroutine(createElements());
	}

	private void loadEntries()
	{
		if (_entries_list.Count > 0)
		{
			return;
		}
		TextAsset[] array = Resources.LoadAll<TextAsset>("texts/patch_notes");
		if (array.Length == 0)
		{
			return;
		}
		TextAsset[] array2 = array;
		for (int i = 0; i < array2.Length; i++)
		{
			string[] array3 = array2[i].text.Split(new string[1] { "##########" }, StringSplitOptions.None);
			string[] array4 = array3[0].Split(new string[3] { "\r\n", "\r", "\n" }, StringSplitOptions.None);
			string version = array4[0];
			string name = array4[1];
			string date = array4[2];
			string icon_path = array4[3];
			string text = array3[1];
			if (text.StartsWith("\r\n"))
			{
				text = text.Substring(2);
			}
			else if (text.StartsWith("\n"))
			{
				text = text.Substring(1);
			}
			PatchLogEntry patchLogEntry = new PatchLogEntry
			{
				version = version,
				name = name,
				date = date,
				icon_path = icon_path,
				text = text
			};
			_entries_dict[patchLogEntry.version] = patchLogEntry;
			_entries_list.Add(patchLogEntry);
		}
		_entries_list.Sort((PatchLogEntry pA, PatchLogEntry pB) => (Version.TryParse(pA.version, out Version result) && Version.TryParse(pB.version, out Version result2)) ? result2.CompareTo(result) : string.Compare(pB.version, pA.version, StringComparison.Ordinal));
	}

	private IEnumerator createElements()
	{
		if (_entries_dict.Count == 0)
		{
			yield break;
		}
		for (int i = 0; i < _entries_list.Count; i++)
		{
			PatchLogEntry pEntry = _entries_list[i];
			PatchLogElement patchLogElement = showEntry(pEntry);
			if (!((Object)(object)patchLogElement == (Object)null))
			{
				if (i < 5)
				{
					patchLogElement.unfold();
				}
				else
				{
					patchLogElement.fold();
				}
				yield return (object)new WaitForSeconds(0.05f);
			}
		}
	}

	private PatchLogElement showEntry(PatchLogEntry pEntry)
	{
		//IL_01eb: Unknown result type (might be due to invalid IL or missing references)
		if (!CursedSacrifice.isAllSacrificesDone() && !WorldLawLibrary.world_law_cursed_world.isEnabled() && pEntry.name == "VoidBox")
		{
			return null;
		}
		using ListPool<string> listPool = new ListPool<string>(10);
		string[] array = pEntry.text.Split(new string[3] { "\r\n", "\r", "\n" }, StringSplitOptions.None);
		string text;
		try
		{
			text = prettyDaysAgo(pEntry.date);
		}
		catch (Exception value)
		{
			Console.WriteLine(value);
			throw;
		}
		bool num = isValidDate(pEntry.date);
		string text2 = (num ? pEntry.date : "???");
		string pColorHex = (num ? "#23F3FF" : "#96adb3");
		string pColorHex2 = (num ? "#FFFF51" : "#96adb3");
		string text3 = pEntry.version.ColorHex(pColorHex) + " - " + pEntry.name.ToUpper().ColorHex(pColorHex2);
		PatchLogElement patchLogElement = Object.Instantiate<PatchLogElement>(_prefab_element, ((Component)this).gameObject.transform);
		((Object)patchLogElement).name = "PatchLog " + pEntry.version;
		_visual_elements.Add(((Component)patchLogElement).gameObject);
		PatchLogTitle title = patchLogElement.title;
		title.title.text = text3;
		patchLogElement.date.text = text2;
		patchLogElement.date_ago.text = text;
		Sprite sprite = SpriteTextureLoader.getSprite(pEntry.icon_path);
		if ((Object)(object)sprite == (Object)null)
		{
			Debug.LogError((object)("Failed to load icon in " + pEntry.version));
		}
		title.icon_left.sprite = sprite;
		title.icon_right.sprite = sprite;
		for (int i = 0; i < array.Length; i += 10)
		{
			listPool.Clear();
			for (int j = i; j < i + 10 && j < array.Length; j++)
			{
				listPool.Add(array[j]);
			}
			string pText = string.Join("\n", listPool);
			pText = colorElements(pText);
			((Graphic)createTextField(pText, patchLogElement.texts.gameObject)).color = Toolbox.color_text_default_bright;
		}
		return patchLogElement;
	}

	private string prettyDaysAgo(string pDateString)
	{
		if (!isValidDate(pDateString))
		{
			return pDateString;
		}
		DateTime dateTime = DateTime.ParseExact(pDateString, "yyyy-MM-dd", null);
		int days = (DateTime.UtcNow - dateTime).Days;
		CultureInfo culture = LocalizedTextManager.getCulture();
		CultureInfo cultureInfo = culture;
		string text = DateHumanizeExtensions.Humanize(dateTime, true, (DateTime?)null, cultureInfo);
		if (!string.IsNullOrEmpty(text))
		{
			return text;
		}
		return days + " days ago";
	}

	private bool isValidDate(string pInput)
	{
		DateTime result;
		return DateTime.TryParseExact(pInput, "yyyy-MM-dd", CultureInfo.InvariantCulture, DateTimeStyles.None, out result);
	}

	private Text createTextField(string pText, GameObject pEntryBackground)
	{
		Text component = Object.Instantiate<GameObject>(_prefab_text, pEntryBackground.transform).GetComponent<Text>();
		component.text = pText;
		_visual_elements.Add(((Component)component).gameObject);
		return component;
	}

	private string colorElements(string pText)
	{
		pText = pText.Replace("added:", "<color=#4CCFFF>added:</color>");
		pText = pText.Replace("fixed:", "<color=#D95032>fixed:</color>");
		pText = pText.Replace("fixes:", "<color=#D95032>fixed:</color>");
		pText = pText.Replace("fxed:", "<color=#D95032>fixed:</color>");
		pText = pText.Replace("changes:", "<color=#F3961F>changed:</color>");
		pText = pText.Replace("changed:", "<color=#F3961F>changed:</color>");
		pText = pText.Replace("ongoing:", "<color=#4CCFFF>ongoing:</color>");
		pText = pText.Replace("modding:", "<color=#43FF43>modding:</color>");
		pText = pText.Replace("known issues:", "<color=#D95032>known issues:</color>");
		pText = pText.Replace("translations:", "<color=#d6abff>translation:</color>");
		return pText;
	}

	public void OnDisable()
	{
		foreach (GameObject visual_element in _visual_elements)
		{
			Object.Destroy((Object)(object)visual_element.gameObject);
		}
		_visual_elements.Clear();
	}
}
// --- End of File: PatchLogLoader.cs ---



// --- Start of File: PatchLogTitle.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PatchLogTitle : MonoBehaviour
{
	[SerializeField]
	private Image _background;

	[SerializeField]
	private Sprite _bg_folded;

	[SerializeField]
	private Sprite _bg_unfolded;

	public Image icon_left;

	public Image icon_right;

	public Text title;

	public void setUnfolded()
	{
		_background.sprite = _bg_unfolded;
	}

	public void setFolded()
	{
		_background.sprite = _bg_folded;
	}
}
// --- End of File: PatchLogTitle.cs ---



// --- Start of File: PathFinderResult.cs ---
public enum PathFinderResult
{
	PathFound,
	NotFound,
	SamePlace,
	DifferentIslands
}
// --- End of File: PathFinderResult.cs ---



// --- Start of File: PathfinderTools.cs ---
using System.Collections.Generic;
using EpPathFinding.cs;
using UnityEngine;

public class PathfinderTools
{
	private static readonly List<WorldTile> _raycast_result = new List<WorldTile>();

	public static List<WorldTile> raycast(WorldTile pFrom, WorldTile pTarget, float pMod = 0.99f)
	{
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		List<WorldTile> raycast_result = _raycast_result;
		raycast_result.Clear();
		float num = Toolbox.DistTile(pFrom, pTarget) * pMod;
		Vector2 val = default(Vector2);
		((Vector2)(ref val))._002Ector(pFrom.posV3.x, pFrom.posV3.y);
		Vector2 val2 = default(Vector2);
		((Vector2)(ref val2))._002Ector(pTarget.posV3.x, pTarget.posV3.y);
		WorldTile worldTile = null;
		for (int i = 0; (float)i <= num; i++)
		{
			Vector2 val3 = Vector2.Lerp(val, val2, (float)i / num);
			int pX = Mathf.FloorToInt(val3.x);
			int pY = Mathf.FloorToInt(val3.y);
			WorldTile tile = World.world.GetTile(pX, pY);
			if (tile != null && tile != worldTile)
			{
				raycast_result.Add(tile);
				worldTile = tile;
			}
		}
		if (worldTile != pTarget)
		{
			raycast_result.Add(pTarget);
		}
		return raycast_result;
	}

	public static List<WorldTile> raycast(Vector2 pFrom, Vector2 pTarget, float pMod = 0.99f)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		List<WorldTile> raycast_result = _raycast_result;
		raycast_result.Clear();
		float num = Toolbox.DistVec2Float(pFrom, pTarget) * pMod;
		WorldTile worldTile = null;
		for (int i = 0; (float)i <= num; i++)
		{
			Vector2 val = Vector2.Lerp(pFrom, pTarget, (float)i / num);
			int pX = Mathf.FloorToInt(val.x);
			int pY = Mathf.FloorToInt(val.y);
			WorldTile tile = World.world.GetTile(pX, pY);
			if (tile != null && tile != worldTile)
			{
				raycast_result.Add(tile);
				worldTile = tile;
			}
		}
		if (Vector2Int.op_Implicit(worldTile.pos) != pTarget)
		{
			WorldTile tile2 = World.world.GetTile((int)pTarget.x, (int)pTarget.y);
			if (tile2 != null)
			{
				raycast_result.Add(tile2);
			}
		}
		return raycast_result;
	}

	public static bool tryToGetSimplePath(WorldTile pFrom, WorldTile pTargetTile, List<WorldTile> pPathToFill, ActorAsset pAsset, AStarParam pParam, int pTileLimit = 0)
	{
		raycast(pFrom, pTargetTile);
		List<WorldTile> raycast_result = _raycast_result;
		int i = 0;
		for (int count = raycast_result.Count; i < count; i++)
		{
			WorldTile worldTile = raycast_result[i];
			if (!pParam.block && worldTile.Type.block)
			{
				return false;
			}
			if (!pParam.lava && worldTile.Type.lava)
			{
				return false;
			}
			if (!pParam.fire && worldTile.isOnFire())
			{
				return false;
			}
			if (!pParam.ocean && worldTile.Type.ocean)
			{
				return false;
			}
			if (!pParam.ground && worldTile.Type.ground)
			{
				return false;
			}
			if (pParam.boat && !worldTile.isGoodForBoat())
			{
				return false;
			}
			if (worldTile.hasWallsAround())
			{
				return false;
			}
		}
		return true;
	}

	public static WorldTile raycastTileForUnitToEmbark(WorldTile pFromGround, WorldTile pTargetOcean)
	{
		List<WorldTile> list = raycast(pTargetOcean, pFromGround);
		WorldTile result = null;
		TileIsland island = pFromGround.region.island;
		for (int i = 0; i < list.Count; i++)
		{
			WorldTile worldTile = list[i];
			if (worldTile.region.island == island)
			{
				result = worldTile;
				break;
			}
		}
		list.Clear();
		return result;
	}

	public static List<WorldTile> getLastRaycastResult()
	{
		return _raycast_result;
	}

	public static WorldTile raycastTileForUnitLandingFromOcean(WorldTile pFromOcean, WorldTile pTargetGround)
	{
		List<WorldTile> list = raycast(pFromOcean, pTargetGround);
		WorldTile result = null;
		TileIsland island = pTargetGround.region.island;
		for (int i = 0; i < list.Count; i++)
		{
			WorldTile worldTile = list[i];
			if (worldTile.region.island == island)
			{
				result = worldTile;
				break;
			}
		}
		list.Clear();
		return result;
	}
}
// --- End of File: PathfinderTools.cs ---



// --- Start of File: PathFindingVisualiser.cs ---
using System.Collections.Generic;
using EpPathFinding.cs;
using UnityEngine;

public class PathFindingVisualiser : MapLayer
{
	public Color default_color;

	private List<WorldTile> tiles = new List<WorldTile>();

	internal override void create()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		colorValues = new Color(1f, 0.46f, 0.19f, 1f);
		colorValues = default_color;
		base.create();
	}

	protected override void UpdateDirty(float pElapsed)
	{
		if (DebugConfig.isOn(DebugOption.LastPath))
		{
			if (!((Component)this).gameObject.activeSelf)
			{
				((Component)this).gameObject.SetActive(true);
			}
		}
		else if (((Component)this).gameObject.activeSelf)
		{
			((Component)this).gameObject.SetActive(false);
		}
	}

	internal override void clear()
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		if (tiles.Count != 0)
		{
			tiles.Clear();
			for (int i = 0; i < pixels.Length; i++)
			{
				pixels[i] = Color32.op_Implicit(Color.clear);
			}
			createTextureNew();
		}
	}

	internal void showPath(StaticGrid pGrid, List<WorldTile> pTilePath)
	{
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0102: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_010c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		if (!DebugConfig.isOn(DebugOption.LastPath))
		{
			return;
		}
		clear();
		if (pGrid != null)
		{
			WorldTile[] tiles_list = World.world.tiles_list;
			foreach (WorldTile worldTile in tiles_list)
			{
				tiles.Add(worldTile);
				Vector2Int pos = worldTile.pos;
				int x = ((Vector2Int)(ref pos)).x;
				pos = worldTile.pos;
				Node nodeAt = pGrid.GetNodeAt(x, ((Vector2Int)(ref pos)).y);
				if (nodeAt.isClosed)
				{
					pixels[worldTile.data.tile_id] = Color32.op_Implicit(Color.red);
				}
				else if (nodeAt.isOpened)
				{
					pixels[worldTile.data.tile_id] = Color32.op_Implicit(Color.green);
				}
				else
				{
					pixels[worldTile.data.tile_id] = Color32.op_Implicit(Color.clear);
				}
			}
		}
		foreach (WorldTile item in pTilePath)
		{
			pixels[item.data.tile_id] = Color32.op_Implicit(Color.blue);
			tiles.Add(item);
		}
		updatePixels();
	}
}
// --- End of File: PathFindingVisualiser.cs ---



// --- Start of File: PauseButton.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PauseButton : MonoBehaviour
{
	public Sprite pause;

	public Sprite play;

	private Image icon;

	private void Start()
	{
		icon = ((Component)((Component)this).transform.Find("Icon")).GetComponent<Image>();
	}

	private void Update()
	{
		updateSprite();
	}

	internal void press()
	{
		Config.paused = !Config.paused;
		if (Config.paused)
		{
			WorldTip.instance.setText("game_paused");
		}
		else
		{
			WorldTip.instance.setText("game_unpaused");
		}
	}

	private void updateSprite()
	{
		if (Config.paused)
		{
			icon.sprite = play;
		}
		else
		{
			icon.sprite = pause;
		}
	}
}
// --- End of File: PauseButton.cs ---



// --- Start of File: PerlinReplaceContainer.cs ---
using System.Collections.Generic;

public class PerlinReplaceContainer
{
	public int scale = 10;

	public List<PerlinReplaceOption> options = new List<PerlinReplaceOption>();
}
// --- End of File: PerlinReplaceContainer.cs ---



// --- Start of File: PerlinReplaceOption.cs ---
using System;

[Serializable]
public class PerlinReplaceOption
{
	public int replace_height_value;

	public string from;

	public string to;
}
// --- End of File: PerlinReplaceOption.cs ---



// --- Start of File: PersonalityAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class PersonalityAsset : Asset, ILocalizedAsset
{
	public BaseStats base_stats = new BaseStats();

	public string icon;

	public Sprite sprite;

	public string getTranslatedName()
	{
		return getLocaleID().Localize();
	}

	public string getLocaleID()
	{
		return "personality_" + id;
	}

	public Sprite getSprite()
	{
		if ((Object)(object)sprite == (Object)null)
		{
			sprite = SpriteTextureLoader.getSprite("ui/Icons/" + icon);
		}
		return sprite;
	}
}
// --- End of File: PersonalityAsset.cs ---



// --- Start of File: PersonalityLibrary.cs ---
public class PersonalityLibrary : AssetLibrary<PersonalityAsset>
{
	public override void init()
	{
		base.init();
		add(new PersonalityAsset
		{
			id = "administrator"
		});
		t.base_stats["personality_diplomatic"] = 0.1f;
		t.base_stats["personality_administration"] = 0.5f;
		t.base_stats["personality_aggression"] = 0.1f;
		add(new PersonalityAsset
		{
			id = "militarist"
		});
		t.base_stats["personality_diplomatic"] = 0.05f;
		t.base_stats["personality_administration"] = 0.1f;
		t.base_stats["personality_aggression"] = 0.5f;
		add(new PersonalityAsset
		{
			id = "diplomat"
		});
		t.base_stats["personality_diplomatic"] = 0.5f;
		t.base_stats["personality_aggression"] = 0.05f;
		t.base_stats["personality_administration"] = 0.2f;
		add(new PersonalityAsset
		{
			id = "balanced"
		});
		t.base_stats["personality_administration"] = 0.1f;
		t.base_stats["personality_diplomatic"] = 0.1f;
		t.base_stats["personality_aggression"] = 0.1f;
		add(new PersonalityAsset
		{
			id = "wildcard"
		});
		t.base_stats["personality_rationality"] = -1f;
	}

	public override void editorDiagnosticLocales()
	{
		base.editorDiagnosticLocales();
		foreach (PersonalityAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
		}
	}
}
// --- End of File: PersonalityLibrary.cs ---



// --- Start of File: PhenotypeAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class PhenotypeAsset : BaseAugmentationAsset, ISkipLocaleAsset
{
	public string shades_from;

	public string shades_to;

	public string color_eyes;

	public string color_details_1;

	public string color_details_2;

	public int phenotype_index;

	[NonSerialized]
	public Color32[] colors = (Color32[])(object)new Color32[4];

	public string subspecies_trait_id;

	public override BaseCategoryAsset getGroup()
	{
		return AssetManager.subspecies_trait_groups.get(group_id);
	}

	public PhenotypeAsset()
	{
		has_locales = false;
	}
}
// --- End of File: PhenotypeAsset.cs ---



// --- Start of File: PhenotypeLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public class PhenotypeLibrary : AssetLibrary<PhenotypeAsset>
{
	private Dictionary<int, PhenotypeAsset> _phenotypes_assets_by_index = new Dictionary<int, PhenotypeAsset>();

	public const int PHENOTYPE_SHADES = 4;

	public const int PHENOTYPE_NONE = 0;

	public static PhenotypeAsset default_asset;

	public static PhenotypeAsset default_green;

	public override void init()
	{
		base.init();
		default_asset = add(new PhenotypeAsset
		{
			id = "skin_pale",
			shades_from = "#FFF9F4",
			shades_to = "#ECD9D5"
		});
		add(new PhenotypeAsset
		{
			id = "skin_light",
			shades_from = "#F5D6BA",
			shades_to = "#F3C6BE"
		});
		add(new PhenotypeAsset
		{
			id = "skin_medium",
			shades_from = "#C5966D",
			shades_to = "#C06859"
		});
		add(new PhenotypeAsset
		{
			id = "skin_dark",
			shades_from = "#7C5A3C",
			shades_to = "#593731"
		});
		add(new PhenotypeAsset
		{
			id = "skin_black",
			shades_from = "#46372A",
			shades_to = "#34211E"
		});
		add(new PhenotypeAsset
		{
			id = "skin_mixed",
			shades_from = "#E9BA90",
			shades_to = "#34211E"
		});
		add(new PhenotypeAsset
		{
			id = "skin_red",
			shades_from = "#DB4D48",
			shades_to = "#7F2E39"
		});
		add(new PhenotypeAsset
		{
			id = "skin_yellow",
			shades_from = "#FFE18E",
			shades_to = "#AB8B51"
		});
		add(new PhenotypeAsset
		{
			id = "skin_green",
			shades_from = "#9DB361",
			shades_to = "#425338"
		});
		add(new PhenotypeAsset
		{
			id = "skin_blue",
			shades_from = "#7FC1C7",
			shades_to = "#37617A"
		});
		add(new PhenotypeAsset
		{
			id = "skin_purple",
			shades_from = "#C29FD5",
			shades_to = "#5C54A2"
		});
		add(new PhenotypeAsset
		{
			id = "skin_pink",
			shades_from = "#FFAFC0",
			shades_to = "#D1539F"
		});
		add(new PhenotypeAsset
		{
			id = "white_gray",
			shades_from = "#FAFAFA",
			shades_to = "#B0B0B0"
		});
		add(new PhenotypeAsset
		{
			id = "mid_gray",
			shades_from = "#BBBBBB",
			shades_to = "#606060"
		});
		add(new PhenotypeAsset
		{
			id = "gray_black",
			shades_from = "#7A7A7A",
			shades_to = "#3E3E3E"
		});
		add(new PhenotypeAsset
		{
			id = "bright_red",
			shades_from = "#FF9A9A",
			shades_to = "#FF2222"
		});
		add(new PhenotypeAsset
		{
			id = "bright_orange",
			shades_from = "#FFC191",
			shades_to = "#FF7316"
		});
		add(new PhenotypeAsset
		{
			id = "bright_yellow",
			shades_from = "#FFEBA3",
			shades_to = "#FFCE1F"
		});
		add(new PhenotypeAsset
		{
			id = "bright_green",
			shades_from = "#C5FFA0",
			shades_to = "#1CDA2C"
		});
		add(new PhenotypeAsset
		{
			id = "bright_teal",
			shades_from = "#A3FFE0",
			shades_to = "#0DDCA4"
		});
		add(new PhenotypeAsset
		{
			id = "bright_blue",
			shades_from = "#A8E3FF",
			shades_to = "#1CA4FF"
		});
		add(new PhenotypeAsset
		{
			id = "bright_violet",
			shades_from = "#D6B7FF",
			shades_to = "#7142F3"
		});
		add(new PhenotypeAsset
		{
			id = "bright_purple",
			shades_from = "#F3B9FF",
			shades_to = "#BE4FDD"
		});
		add(new PhenotypeAsset
		{
			id = "bright_pink",
			shades_from = "#FFB6E3",
			shades_to = "#FF5FC2"
		});
		add(new PhenotypeAsset
		{
			id = "bright_salmon",
			shades_from = "#FFAFBC",
			shades_to = "#FF537E"
		});
		add(new PhenotypeAsset
		{
			id = "dark_red",
			shades_from = "#EC2D2D",
			shades_to = "#5F1414"
		});
		add(new PhenotypeAsset
		{
			id = "dark_orange",
			shades_from = "#FF7B16",
			shades_to = "#69340B"
		});
		add(new PhenotypeAsset
		{
			id = "dark_yellow",
			shades_from = "#FFC61A",
			shades_to = "#986411"
		});
		default_green = add(new PhenotypeAsset
		{
			id = "dark_green",
			shades_from = "#72C727",
			shades_to = "#2A6016"
		});
		add(new PhenotypeAsset
		{
			id = "dark_teal",
			shades_from = "#1FDEA5",
			shades_to = "#0F6557"
		});
		add(new PhenotypeAsset
		{
			id = "dark_blue",
			shades_from = "#2182EB",
			shades_to = "#163487"
		});
		add(new PhenotypeAsset
		{
			id = "dark_violet",
			shades_from = "#6F47DF",
			shades_to = "#321A75"
		});
		add(new PhenotypeAsset
		{
			id = "dark_purple",
			shades_from = "#A341E1",
			shades_to = "#491C5F"
		});
		add(new PhenotypeAsset
		{
			id = "dark_pink",
			shades_from = "#F84EE7",
			shades_to = "#652265"
		});
		add(new PhenotypeAsset
		{
			id = "dark_salmon",
			shades_from = "#F35688",
			shades_to = "#6F2949"
		});
		add(new PhenotypeAsset
		{
			id = "toxic_green",
			shades_from = "#CBFF2E",
			shades_to = "#10F023"
		});
		add(new PhenotypeAsset
		{
			id = "aqua",
			shades_from = "#77D8D0",
			shades_to = "#3779A5"
		});
		add(new PhenotypeAsset
		{
			id = "swamp",
			shades_from = "#784D85",
			shades_to = "#367F58"
		});
		add(new PhenotypeAsset
		{
			id = "jungle",
			shades_from = "#03803D",
			shades_to = "#2EB829"
		});
		add(new PhenotypeAsset
		{
			id = "polar",
			shades_from = "#E8EEF5",
			shades_to = "#95C2E7"
		});
		add(new PhenotypeAsset
		{
			id = "savanna",
			shades_from = "#FFB52B",
			shades_to = "#D06643"
		});
		add(new PhenotypeAsset
		{
			id = "corrupted",
			shades_from = "#7E7987",
			shades_to = "#483162"
		});
		add(new PhenotypeAsset
		{
			id = "infernal",
			shades_from = "#FF5100",
			shades_to = "#FF002B"
		});
		add(new PhenotypeAsset
		{
			id = "lemon",
			shades_from = "#FFDB27",
			shades_to = "#BDF741"
		});
		add(new PhenotypeAsset
		{
			id = "desert",
			shades_from = "#D3C0AB",
			shades_to = "#B68637"
		});
		add(new PhenotypeAsset
		{
			id = "crystal",
			shades_from = "#1CFFCE",
			shades_to = "#15A1FF"
		});
		add(new PhenotypeAsset
		{
			id = "candy",
			shades_from = "#FF658C",
			shades_to = "#D166FF"
		});
		add(new PhenotypeAsset
		{
			id = "soil",
			shades_from = "#533028",
			shades_to = "#160C15"
		});
		add(new PhenotypeAsset
		{
			id = "wood",
			shades_from = "#9D582A",
			shades_to = "#4C2828"
		});
		add(new PhenotypeAsset
		{
			id = "pink_yellow_mushroom",
			shades_from = "#F12C78",
			shades_to = "#FFAC26"
		});
		add(new PhenotypeAsset
		{
			id = "black_blue",
			shades_from = "#34345B",
			shades_to = "#222229"
		});
		add(new PhenotypeAsset
		{
			id = "magical",
			shades_from = "#24C695",
			shades_to = "#9D2EA7"
		});
	}

	public override void linkAssets()
	{
		base.linkAssets();
		int num = 1;
		foreach (PhenotypeAsset item in list)
		{
			createShades(item);
			item.phenotype_index = num++;
			_phenotypes_assets_by_index.Add(item.phenotype_index, item);
		}
	}

	public PhenotypeAsset getAssetByPhenotypeIndex(int pIndex)
	{
		_phenotypes_assets_by_index.TryGetValue(pIndex, out var value);
		if (value == null)
		{
			return default_asset;
		}
		return value;
	}

	public void createShades(PhenotypeAsset pAsset)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		Color pFrom = Toolbox.makeColor(pAsset.shades_from);
		Color pTo = Toolbox.makeColor(pAsset.shades_to);
		float num = 1f / 3f;
		for (int i = 0; i < 4; i++)
		{
			float num2 = 1f - (float)i * num;
			if (num2 > 1f)
			{
				num2 = 1f;
			}
			Color val = Toolbox.blendColor(pFrom, pTo, num2);
			pAsset.colors[i] = Color32.op_Implicit(val);
		}
	}
}
// --- End of File: PhenotypeLibrary.cs ---



// --- Start of File: PivotPresets.cs ---
public enum PivotPresets
{
	TopLeft,
	TopCenter,
	TopRight,
	MiddleLeft,
	MiddleCenter,
	MiddleRight,
	BottomLeft,
	BottomCenter,
	BottomRight
}
// --- End of File: PivotPresets.cs ---



// --- Start of File: Pixel.cs ---
using UnityEngine;

public struct Pixel
{
	public readonly int x;

	public readonly int y;

	public readonly Color32 color;

	public Pixel(int pX, int pY, Color32 pColor)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		x = pX;
		y = pY;
		color = pColor;
	}
}
// --- End of File: Pixel.cs ---



// --- Start of File: PixelBag.cs ---
using UnityEngine;

public class PixelBag
{
	public readonly int texture_rect_width;

	public readonly int texture_rect_height;

	public readonly Pixel[] arr_pixels_normal;

	public readonly Pixel[] arr_pixels_light;

	public readonly Pixel[] arr_pixels_k1_0;

	public readonly Pixel[] arr_pixels_k1_1;

	public readonly Pixel[] arr_pixels_k1_2;

	public readonly Pixel[] arr_pixels_k1_3;

	public readonly Pixel[] arr_pixels_k1_4;

	public readonly Pixel[] arr_pixels_k2_0;

	public readonly Pixel[] arr_pixels_k2_1;

	public readonly Pixel[] arr_pixels_k2_2;

	public readonly Pixel[] arr_pixels_k2_3;

	public readonly Pixel[] arr_pixels_k2_4;

	public readonly Pixel[] arr_pixels_phenotype_shade_0;

	public readonly Pixel[] arr_pixels_phenotype_shade_1;

	public readonly Pixel[] arr_pixels_phenotype_shade_2;

	public readonly Pixel[] arr_pixels_phenotype_shade_3;

	private ListPool<Pixel> _pixels_normal;

	private ListPool<Pixel> _pixels_light;

	private ListPool<Pixel> _pixels_k1_0;

	private ListPool<Pixel> _pixels_k1_1;

	private ListPool<Pixel> _pixels_k1_2;

	private ListPool<Pixel> _pixels_k1_3;

	private ListPool<Pixel> _pixels_k1_4;

	private ListPool<Pixel> _pixels_k2_0;

	private ListPool<Pixel> _pixels_k2_1;

	private ListPool<Pixel> _pixels_k2_2;

	private ListPool<Pixel> _pixels_k2_3;

	private ListPool<Pixel> _pixels_k2_4;

	private ListPool<Pixel> _pixels_phenotype_shade_0;

	private ListPool<Pixel> _pixels_phenotype_shade_1;

	private ListPool<Pixel> _pixels_phenotype_shade_2;

	private ListPool<Pixel> _pixels_phenotype_shade_3;

	public PixelBag(Sprite pSpriteSource, bool pCheckPhenotypes, bool pCheckLights)
	{
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		Texture2D texture = pSpriteSource.texture;
		Rect rect = pSpriteSource.rect;
		int width = ((Texture)texture).width;
		texture_rect_width = (int)((Rect)(ref rect)).width;
		texture_rect_height = (int)((Rect)(ref rect)).height;
		int num = (int)((Rect)(ref rect)).x;
		int num2 = (int)((Rect)(ref rect)).y;
		Color32[] pixels = texture.GetPixels32();
		for (int i = 0; i < texture_rect_width; i++)
		{
			for (int j = 0; j < texture_rect_height; j++)
			{
				int num3 = i + num;
				int num4 = j + num2;
				int num5 = num3 + num4 * width;
				Color32 val = pixels[num5];
				if (val.a != 0)
				{
					checkAndSavePixel(val, i, j, pCheckPhenotypes, pCheckLights);
				}
			}
		}
		arr_pixels_normal = _pixels_normal?.ToArray();
		arr_pixels_light = _pixels_light?.ToArray();
		arr_pixels_k1_0 = _pixels_k1_0?.ToArray();
		arr_pixels_k1_1 = _pixels_k1_1?.ToArray();
		arr_pixels_k1_2 = _pixels_k1_2?.ToArray();
		arr_pixels_k1_3 = _pixels_k1_3?.ToArray();
		arr_pixels_k1_4 = _pixels_k1_4?.ToArray();
		arr_pixels_k2_0 = _pixels_k2_0?.ToArray();
		arr_pixels_k2_1 = _pixels_k2_1?.ToArray();
		arr_pixels_k2_2 = _pixels_k2_2?.ToArray();
		arr_pixels_k2_3 = _pixels_k2_3?.ToArray();
		arr_pixels_k2_4 = _pixels_k2_4?.ToArray();
		arr_pixels_phenotype_shade_0 = _pixels_phenotype_shade_0?.ToArray();
		arr_pixels_phenotype_shade_1 = _pixels_phenotype_shade_1?.ToArray();
		arr_pixels_phenotype_shade_2 = _pixels_phenotype_shade_2?.ToArray();
		arr_pixels_phenotype_shade_3 = _pixels_phenotype_shade_3?.ToArray();
		clearLists();
	}

	private void clearLists()
	{
		_pixels_normal?.Dispose();
		_pixels_light?.Dispose();
		_pixels_k1_0?.Dispose();
		_pixels_k1_1?.Dispose();
		_pixels_k1_2?.Dispose();
		_pixels_k1_3?.Dispose();
		_pixels_k1_4?.Dispose();
		_pixels_k2_0?.Dispose();
		_pixels_k2_1?.Dispose();
		_pixels_k2_2?.Dispose();
		_pixels_k2_3?.Dispose();
		_pixels_k2_4?.Dispose();
		_pixels_phenotype_shade_0?.Dispose();
		_pixels_phenotype_shade_1?.Dispose();
		_pixels_phenotype_shade_2?.Dispose();
		_pixels_phenotype_shade_3?.Dispose();
		_pixels_normal = null;
		_pixels_light = null;
		_pixels_k1_0 = null;
		_pixels_k1_1 = null;
		_pixels_k1_2 = null;
		_pixels_k1_3 = null;
		_pixels_k1_4 = null;
		_pixels_k2_0 = null;
		_pixels_k2_1 = null;
		_pixels_k2_2 = null;
		_pixels_k2_3 = null;
		_pixels_k2_4 = null;
		_pixels_phenotype_shade_0 = null;
		_pixels_phenotype_shade_1 = null;
		_pixels_phenotype_shade_2 = null;
		_pixels_phenotype_shade_3 = null;
	}

	private void checkAndSavePixel(Color32 pColor, int pX, int pY, bool pCheckPhenotypes, bool pCheckLights)
	{
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_0118: Unknown result type (might be due to invalid IL or missing references)
		//IL_0119: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_0172: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		//IL_019f: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_028b: Unknown result type (might be due to invalid IL or missing references)
		//IL_028c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0200: Unknown result type (might be due to invalid IL or missing references)
		//IL_0201: Unknown result type (might be due to invalid IL or missing references)
		//IL_022d: Unknown result type (might be due to invalid IL or missing references)
		//IL_022e: Unknown result type (might be due to invalid IL or missing references)
		//IL_025a: Unknown result type (might be due to invalid IL or missing references)
		//IL_025b: Unknown result type (might be due to invalid IL or missing references)
		Pixel item = new Pixel(pX, pY, pColor);
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_0))
		{
			if (_pixels_k1_0 == null)
			{
				_pixels_k1_0 = new ListPool<Pixel>();
			}
			_pixels_k1_0.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_1))
		{
			if (_pixels_k1_1 == null)
			{
				_pixels_k1_1 = new ListPool<Pixel>();
			}
			_pixels_k1_1.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_2))
		{
			if (_pixels_k1_2 == null)
			{
				_pixels_k1_2 = new ListPool<Pixel>();
			}
			_pixels_k1_2.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_3))
		{
			if (_pixels_k1_3 == null)
			{
				_pixels_k1_3 = new ListPool<Pixel>();
			}
			_pixels_k1_3.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_magenta_4))
		{
			if (_pixels_k1_4 == null)
			{
				_pixels_k1_4 = new ListPool<Pixel>();
			}
			_pixels_k1_4.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_0))
		{
			if (_pixels_k2_0 == null)
			{
				_pixels_k2_0 = new ListPool<Pixel>();
			}
			_pixels_k2_0.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_1))
		{
			if (_pixels_k2_1 == null)
			{
				_pixels_k2_1 = new ListPool<Pixel>();
			}
			_pixels_k2_1.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_2))
		{
			if (_pixels_k2_2 == null)
			{
				_pixels_k2_2 = new ListPool<Pixel>();
			}
			_pixels_k2_2.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_3))
		{
			if (_pixels_k2_3 == null)
			{
				_pixels_k2_3 = new ListPool<Pixel>();
			}
			_pixels_k2_3.Add(item);
			return;
		}
		if (Toolbox.areColorsEqual(pColor, Toolbox.color_teal_4))
		{
			if (_pixels_k2_4 == null)
			{
				_pixels_k2_4 = new ListPool<Pixel>();
			}
			_pixels_k2_4.Add(item);
			return;
		}
		if (pCheckPhenotypes)
		{
			if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_0))
			{
				if (_pixels_phenotype_shade_0 == null)
				{
					_pixels_phenotype_shade_0 = new ListPool<Pixel>();
				}
				_pixels_phenotype_shade_0.Add(item);
				return;
			}
			if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_1))
			{
				if (_pixels_phenotype_shade_1 == null)
				{
					_pixels_phenotype_shade_1 = new ListPool<Pixel>();
				}
				_pixels_phenotype_shade_1.Add(item);
				return;
			}
			if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_2))
			{
				if (_pixels_phenotype_shade_2 == null)
				{
					_pixels_phenotype_shade_2 = new ListPool<Pixel>();
				}
				_pixels_phenotype_shade_2.Add(item);
				return;
			}
			if (Toolbox.areColorsEqual(pColor, Toolbox.color_phenotype_green_3))
			{
				if (_pixels_phenotype_shade_3 == null)
				{
					_pixels_phenotype_shade_3 = new ListPool<Pixel>();
				}
				_pixels_phenotype_shade_3.Add(item);
				return;
			}
		}
		if (pCheckLights && Toolbox.areColorsEqual(pColor, Toolbox.color_light))
		{
			if (_pixels_light == null)
			{
				_pixels_light = new ListPool<Pixel>();
			}
			_pixels_light.Add(item);
		}
		else
		{
			if (_pixels_normal == null)
			{
				_pixels_normal = new ListPool<Pixel>();
			}
			_pixels_normal.Add(item);
		}
	}
}
// --- End of File: PixelBag.cs ---



// --- Start of File: PixelBagManager.cs ---
using System.Collections.Generic;
using UnityEngine;

public static class PixelBagManager
{
	private static readonly Dictionary<Sprite, PixelBag> _dict = new Dictionary<Sprite, PixelBag>();

	public static int total => _dict.Count;

	public static PixelBag getPixelBag(Sprite pSpriteSource, bool pCheckPhenotypes = false, bool pCheckLights = false)
	{
		_dict.TryGetValue(pSpriteSource, out var value);
		if (value == null)
		{
			createPixelBag(pSpriteSource, pCheckPhenotypes, pCheckLights);
		}
		return _dict[pSpriteSource];
	}

	private static void createPixelBag(Sprite pSpriteSource, bool pCheckPhenotypes, bool pCheckLights)
	{
		PixelBag value = new PixelBag(pSpriteSource, pCheckPhenotypes, pCheckLights);
		_dict.Add(pSpriteSource, value);
	}

	public static void preloadPixelBagUnit(Sprite pSpriteSource)
	{
		getPixelBag(pSpriteSource, pCheckPhenotypes: true);
	}
}
// --- End of File: PixelBagManager.cs ---



// --- Start of File: PixelDetector.cs ---
using System;
using UnityEngine;

public static class PixelDetector
{
	public static bool GetSpritePixelColorUnderMousePointer(MonoBehaviour mono, out Vector2Int pVector)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		pVector = new Vector2Int(-1, -1);
		Vector2 val = Vector2.op_Implicit(Input.mousePosition);
		Vector2 val2 = Vector2.op_Implicit(Camera.main.ScreenToViewportPoint(Vector2.op_Implicit(val)));
		if (val2.x <= 0f || val2.x >= 1f || val2.y <= 0f || val2.y >= 1f)
		{
			return false;
		}
		Ray ray;
		try
		{
			ray = Camera.main.ViewportPointToRay(Vector2.op_Implicit(val2));
		}
		catch (Exception)
		{
			return false;
		}
		return IntersectsSprite(mono, ray, out pVector);
	}

	private static bool IntersectsSprite(MonoBehaviour mono, Ray ray, out Vector2Int pVector)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0149: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		SpriteRenderer component = ((Component)mono).GetComponent<SpriteRenderer>();
		pVector = new Vector2Int(-1, -1);
		if ((Object)(object)component == (Object)null)
		{
			return false;
		}
		Sprite sprite = component.sprite;
		if ((Object)(object)sprite == (Object)null)
		{
			return false;
		}
		Texture2D texture = sprite.texture;
		if ((Object)(object)texture == (Object)null)
		{
			return false;
		}
		if (sprite.packed && (int)sprite.packingMode == 0)
		{
			Debug.LogError((object)"SpritePackingMode.Tight atlas packing is not supported!");
			return false;
		}
		Plane val = default(Plane);
		((Plane)(ref val))._002Ector(((Component)mono).transform.forward, ((Component)mono).transform.position);
		float num = default(float);
		if (!((Plane)(ref val)).Raycast(ray, ref num))
		{
			return false;
		}
		Matrix4x4 worldToLocalMatrix = ((Renderer)component).worldToLocalMatrix;
		Vector3 val2 = ((Matrix4x4)(ref worldToLocalMatrix)).MultiplyPoint3x4(((Ray)(ref ray)).origin + ((Ray)(ref ray)).direction * num);
		Rect textureRect = sprite.textureRect;
		float pixelsPerUnit = sprite.pixelsPerUnit;
		float num2 = (float)((Texture)texture).width * 0f;
		float num3 = (float)((Texture)texture).height * 0f;
		int num4 = (int)(val2.x * pixelsPerUnit + num2);
		int num5 = (int)(val2.y * pixelsPerUnit + num3);
		if (num4 < 0 || (float)num4 < ((Rect)(ref textureRect)).x || num4 >= Mathf.FloorToInt(((Rect)(ref textureRect)).xMax))
		{
			return false;
		}
		if (num5 < 0 || (float)num5 < ((Rect)(ref textureRect)).y || num5 >= Mathf.FloorToInt(((Rect)(ref textureRect)).yMax))
		{
			return false;
		}
		pVector = new Vector2Int(num4, num5);
		return true;
	}
}
// --- End of File: PixelDetector.cs ---



// --- Start of File: PixelFlashEffects.cs ---
using System.Collections.Generic;
using UnityEngine;

public class PixelFlashEffects : MapLayer
{
	private List<WorldTile> toRemove = new List<WorldTile>();

	private ColorArray colorWhite;

	private ColorArray colorPurple;

	private ColorArray colorBlue;

	private float _timer;

	internal override void create()
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		colors_amount = 30;
		colorValues = new Color(1f, 1f, 1f);
		colorWhite = new ColorArray(1f, 1f, 1f, 1f, colors_amount, 0.5f);
		colorPurple = new ColorArray(ConwayLife.colorEater, colors_amount);
		colorBlue = new ColorArray(Color32.op_Implicit(Toolbox.makeColor("#3BCC55")), colors_amount);
		base.create();
		((Behaviour)this).enabled = true;
	}

	public void flashPixel(WorldTile pTile, int pVal = -1, ColorType pColorType = ColorType.White)
	{
		if (SmoothLoader.isLoading())
		{
			return;
		}
		if (pVal == -1 || pVal >= colors_amount)
		{
			pVal = colors_amount - 1;
		}
		if (((Behaviour)this).enabled)
		{
			switch (pColorType)
			{
			case ColorType.White:
				pTile.color_array = colorWhite;
				break;
			case ColorType.Purple:
				pTile.color_array = colorPurple;
				break;
			case ColorType.Blue:
				pTile.color_array = colorBlue;
				break;
			}
			if (pTile.flash_state <= 0)
			{
				pixels_to_update.Add(pTile);
			}
			if (pTile.flash_state < pVal)
			{
				pTile.flash_state = pVal;
			}
		}
	}

	internal override void clear()
	{
		base.clear();
		pixels_to_update.Clear();
	}

	protected override void UpdateDirty(float pElapsed)
	{
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		if (_timer > 0f)
		{
			_timer -= World.world.delta_time;
			return;
		}
		_timer = 0.01f;
		if (pixels_to_update.Count <= 0)
		{
			return;
		}
		toRemove.Clear();
		foreach (WorldTile item2 in pixels_to_update)
		{
			if (item2.flash_state < 0)
			{
				toRemove.Add(item2);
				continue;
			}
			pixels[item2.data.tile_id] = item2.color_array.colors[item2.flash_state];
			item2.flash_state--;
		}
		for (int i = 0; i < toRemove.Count; i++)
		{
			WorldTile item = toRemove[i];
			pixels_to_update.Remove(item);
		}
		updatePixels();
	}
}
// --- End of File: PixelFlashEffects.cs ---



// --- Start of File: PlatformRemover.cs ---
using UnityEngine;

public class PlatformRemover : MonoBehaviour
{
	public bool removeOnIOS;

	public bool removeOnAndroid;

	public bool removeOnPC;

	public bool removeOnEditor;

	public bool removeOnGlobalVersion;

	public bool removeOnChineseVersion;

	public bool removeOnNonPremiumVersion;

	private void Awake()
	{
		if (removeOnGlobalVersion)
		{
			Object.Destroy((Object)(object)((Component)this).gameObject);
		}
		else if (removeOnEditor && Config.isEditor)
		{
			Object.Destroy((Object)(object)((Component)this).gameObject);
		}
		else if (removeOnPC && Config.isComputer)
		{
			Object.Destroy((Object)(object)((Component)this).gameObject);
		}
		else if (removeOnAndroid && Config.isAndroid)
		{
			Object.Destroy((Object)(object)((Component)this).gameObject);
		}
		else if (removeOnIOS && Config.isIos)
		{
			Object.Destroy((Object)(object)((Component)this).gameObject);
		}
	}
}
// --- End of File: PlatformRemover.cs ---



// --- Start of File: PlayCounterMapQueue.cs ---
using System;

[Serializable]
public class PlayCounterMapQueue : QueueItem
{
	public string username;

	public string userId;

	public string reason;

	public string error;

	public string status;

	public string mapId;
}
// --- End of File: PlayCounterMapQueue.cs ---



// --- Start of File: PlayerConfig.cs ---
using System;
using System.Collections.Generic;
using System.IO;
using Firebase.Analytics;
using Newtonsoft.Json;
using UnityEngine;

public class PlayerConfig
{
	public static PlayerConfig instance;

	public static Dictionary<string, PlayerOptionData> dict = new Dictionary<string, PlayerOptionData>();

	private string dataPath;

	internal PlayerConfigData data;

	private float rewardCheckTimer = 10f;

	private float rewardCheckTimerInterval = 60f;

	private static bool _memory_check_done = false;

	public static void init()
	{
		if (instance == null)
		{
			Debug.Log((object)"INIT PlayerConfig");
			instance = new PlayerConfig();
			instance.create();
		}
	}

	public void create()
	{
		rewardCheckTimer = rewardCheckTimerInterval;
		setNewDataPath();
		Debug.Log((object)"Init PlayerConfig");
		if (File.Exists(dataPath))
		{
			try
			{
				loadData();
				return;
			}
			catch (Exception)
			{
				initNewSave();
				return;
			}
		}
		initNewSave();
	}

	internal void start()
	{
		AdButtonTimer.setAdTimer();
	}

	internal void update()
	{
	}

	private void setNewDataPath()
	{
		dataPath = Application.persistentDataPath + "/worldboxData";
	}

	private void initNewSave()
	{
		data = new PlayerConfigData();
		data.initData();
		dict["language"].stringVal = detectLanguage();
		Config.steam_language_allow_detect = true;
		if (Globals.specialAbstudio)
		{
			dict["language"].stringVal = "fa";
		}
		saveData();
	}

	public static void setFirebaseProp(string pName, string pProp)
	{
		if (!Config.isMobile || !Config.firebase_available)
		{
			return;
		}
		try
		{
			FirebaseAnalytics.SetUserProperty(pName, pProp);
		}
		catch (Exception)
		{
		}
	}

	public static void toggleFullScreen()
	{
		setFullScreen(!dict["fullscreen"].boolVal);
	}

	public static void setFullScreen(bool pFullScreen, bool pSwitchScreen = true)
	{
		dict["fullscreen"].boolVal = pFullScreen;
		saveData();
		OptionAsset optionAsset = AssetManager.options_library.get("fullscreen");
		optionAsset.action(optionAsset);
	}

	public static string detectLanguage()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Expected I4, but got Unknown
		string text = "en";
		SystemLanguage systemLanguage = Application.systemLanguage;
		return (systemLanguage - 1) switch
		{
			38 => "vn", 
			35 => "th", 
			25 => "no", 
			24 => "lt", 
			34 => "sv", 
			16 => "he", 
			12 => "fn", 
			8 => "nl", 
			19 => "id", 
			28 => "ro", 
			17 => "hu", 
			6 => "cs", 
			40 => "ch", 
			39 => "cz", 
			9 => "en", 
			13 => "fr", 
			14 => "de", 
			26 => "pl", 
			37 => "ua", 
			29 => "ru", 
			31 => "sk", 
			33 => "es", 
			36 => "tr", 
			21 => "ja", 
			22 => "ko", 
			27 => "pt", 
			20 => "it", 
			7 => "da", 
			15 => "gr", 
			30 => "hr", 
			0 => "ar", 
			_ => "en", 
		};
	}

	public static void saveData()
	{
		string pStringData = Toolbox.encode(instance.data.toJson());
		Toolbox.WriteSafely("Player Config", instance.dataPath, ref pStringData);
		foreach (PlayerOptionData value in dict.Values)
		{
			if (value.boolVal)
			{
				setFirebaseProp("option_" + value.name, value.boolVal ? "on" : "off");
			}
		}
		setFirebaseProp("option_language", dict["language"].stringVal);
	}

	private void loadData()
	{
		if (!File.Exists(dataPath))
		{
			return;
		}
		string text = File.ReadAllText(dataPath);
		string text2 = "";
		try
		{
			text2 = Toolbox.decode(text);
		}
		catch (Exception)
		{
			text2 = "";
		}
		if (string.IsNullOrEmpty(text2))
		{
			try
			{
				text2 = Toolbox.decodeMobile(text);
			}
			catch (Exception)
			{
				text2 = "";
			}
		}
		if (!string.IsNullOrEmpty(text2))
		{
			text = text2;
		}
		if (text.Contains("list"))
		{
			data = JsonConvert.DeserializeObject<PlayerConfigData>(text);
			data.initData();
			string stringVal = data.get("language").stringVal;
			if (stringVal == "boat" || stringVal == "keys")
			{
				data.get("language").stringVal = detectLanguage();
			}
		}
		else
		{
			initNewSave();
		}
		if (data.fireworksCheck2025)
		{
			Config.EVERYTHING_FIREWORKS = true;
		}
		if (data.magicCheck2025)
		{
			Config.EVERYTHING_MAGIC_COLOR = true;
		}
		if (Config.isEditor && Config.editor_test_rewards_from_ads)
		{
			data.rewardedPowers.Clear();
		}
		if (data.premium)
		{
			Config.hasPremium = true;
		}
		bool flag = false;
		if (moveTraitsAndAchievements())
		{
			flag = true;
		}
		if (handleDebugOptions())
		{
			flag = true;
		}
		if (flag)
		{
			saveData();
		}
	}

	internal static bool optionEnabled(string gameOptionName, OptionType pType)
	{
		foreach (PlayerOptionData item in instance.data.list)
		{
			if (!(item.name != gameOptionName) && pType == OptionType.Bool)
			{
				return item.boolVal;
			}
		}
		return false;
	}

	public static int getIntValue(string pID)
	{
		PlayerOptionData playerOptionData = dict[pID];
		OptionAsset optionAsset = AssetManager.options_library.get(pID);
		if (playerOptionData.intVal != Mathf.Clamp(playerOptionData.intVal, optionAsset.min_value, optionAsset.max_value))
		{
			return optionAsset.default_int;
		}
		return playerOptionData.intVal;
	}

	public static bool optionBoolEnabled(string pName)
	{
		return dict[pName].boolVal;
	}

	public static int getOptionInt(string pName)
	{
		return dict[pName].intVal;
	}

	public static string getOptionString(string pName)
	{
		return dict[pName].stringVal;
	}

	public static void setOptionBool(string pName, bool pVal)
	{
		dict[pName].boolVal = pVal;
	}

	public static void setOptionInt(string pName, int pVal)
	{
		dict[pName].intVal = pVal;
	}

	public static void setOptionString(string pName, string pVal)
	{
		dict[pName].stringVal = pVal;
	}

	[Obsolete]
	internal static void switchOption(string gameOptionName, OptionType pType)
	{
		foreach (PlayerOptionData item in instance.data.list)
		{
			if (!(item.name != gameOptionName) && pType == OptionType.Bool)
			{
				item.boolVal = !item.boolVal;
			}
		}
		checkSettings();
	}

	public static void setVsync(bool vsyncEnabled)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		if (vsyncEnabled)
		{
			Resolution currentResolution = Screen.currentResolution;
			RefreshRate refreshRateRatio = ((Resolution)(ref currentResolution)).refreshRateRatio;
			if (((RefreshRate)(ref refreshRateRatio)).value < 61.0)
			{
				QualitySettings.vSyncCount = 1;
				return;
			}
			currentResolution = Screen.currentResolution;
			refreshRateRatio = ((Resolution)(ref currentResolution)).refreshRateRatio;
			if (((RefreshRate)(ref refreshRateRatio)).value < 121.0)
			{
				QualitySettings.vSyncCount = 2;
				return;
			}
			currentResolution = Screen.currentResolution;
			refreshRateRatio = ((Resolution)(ref currentResolution)).refreshRateRatio;
			if (((RefreshRate)(ref refreshRateRatio)).value < 181.0)
			{
				QualitySettings.vSyncCount = 3;
			}
			else
			{
				QualitySettings.vSyncCount = 4;
			}
			return;
		}
		QualitySettings.vSyncCount = 0;
		if (Config.fps_lock_30)
		{
			if (Application.targetFrameRate != 30)
			{
				Application.targetFrameRate = 30;
			}
		}
		else if (Application.targetFrameRate != 60)
		{
			Application.targetFrameRate = 60;
		}
	}

	public static void turnOffAssetsPreloading()
	{
		setOptionBool("preload_units", pVal: false);
		setOptionBool("preload_buildings", pVal: false);
		setOptionBool("preload_quantum_sprites", pVal: false);
		setOptionBool("preload_windows", pVal: false);
	}

	internal static void checkSettings()
	{
		if (SystemInfo.systemMemorySize < 3000 && !_memory_check_done)
		{
			_memory_check_done = true;
			Debug.Log((object)("[RAM is MEH] SystemInfo.systemMemorySize: " + SystemInfo.systemMemorySize));
			turnOffAssetsPreloading();
		}
		foreach (OptionAsset item in AssetManager.options_library.list)
		{
			if (!item.computer_only || Config.isComputer)
			{
				if (item.reset_to_default_on_launch)
				{
					setOptionBool(item.id, item.default_bool);
					setOptionInt(item.id, item.default_int);
					setOptionString(item.id, item.default_string);
				}
				item.action?.Invoke(item);
			}
		}
	}

	public static int countRewards()
	{
		if (instance?.data?.rewardedPowers != null)
		{
			return instance.data.rewardedPowers.Count;
		}
		return 0;
	}

	public static void clearRewards()
	{
		instance?.data?.rewardedPowers?.Clear();
	}

	private bool moveTraitsAndAchievements()
	{
		bool result = false;
		List<string> achievements = data.achievements;
		if (achievements != null && achievements.Count > 0)
		{
			foreach (string achievement in data.achievements)
			{
				GameProgress.unlockAchievement(achievement);
			}
			data.achievements.Clear();
			result = true;
		}
		List<string> unlocked_traits = data.unlocked_traits;
		if (unlocked_traits != null && unlocked_traits.Count > 0)
		{
			foreach (string unlocked_trait in data.unlocked_traits)
			{
				AssetManager.traits.get(unlocked_trait)?.unlock();
			}
			data.unlocked_traits.Clear();
			result = true;
		}
		return result;
	}

	private bool handleDebugOptions()
	{
		bool result = false;
		if (data.clearDebugOnStart)
		{
			DebugConfig.setOption(DebugOption.DisablePremium, pVal: false);
			DebugConfig.setOption(DebugOption.TestAds, pVal: false);
			data.clearDebugOnStart = false;
			data.premiumDisabled = false;
			data.testAds = false;
			result = true;
		}
		else
		{
			if (data.premiumDisabled)
			{
				DebugConfig.setOption(DebugOption.DisablePremium, pVal: true);
				data.clearDebugOnStart = true;
				result = true;
			}
			if (data.testAds)
			{
				DebugConfig.setOption(DebugOption.TestAds, pVal: true);
				data.clearDebugOnStart = true;
				result = true;
			}
		}
		return result;
	}
}
// --- End of File: PlayerConfig.cs ---



// --- Start of File: PlayerConfigData.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Globalization;
using System.IO;
using Newtonsoft.Json;
using UnityEngine.Scripting;

[Serializable]
[Preserve]
public class PlayerConfigData
{
	[DefaultValue(5)]
	public int nextReward = 5;

	[DefaultValue("")]
	public string powerReward = "";

	[DefaultValue("")]
	public string lastReward = "";

	[DefaultValue(-1.0)]
	public double nextAdTimestamp = -1.0;

	public List<RewardedPower> rewardedPowers = new List<RewardedPower>();

	public List<PlayerOptionData> list = new List<PlayerOptionData>();

	[Preserve]
	[Obsolete("use GameProgressData.achievements instead")]
	public List<string> achievements = new List<string>();

	[Preserve]
	[Obsolete("use GameProgressData.unlocked_traits instead")]
	public List<string> unlocked_traits = new List<string>();

	public List<string> trait_editor_gamma = new List<string>();

	[DefaultValue(RainState.Add)]
	public RainState trait_editor_gamma_state;

	public List<string> trait_editor_omega = new List<string>();

	[DefaultValue(RainState.Add)]
	public RainState trait_editor_omega_state;

	public List<string> trait_editor_delta = new List<string>();

	[DefaultValue(RainState.Add)]
	public RainState trait_editor_delta_state;

	public List<string> equipment_editor = new List<string>();

	[DefaultValue(RainState.Add)]
	public RainState equipment_editor_state;

	[DefaultValue(-1)]
	public int favorite_world = -1;

	internal string worldnet = "";

	public bool premium;

	public bool valCheck2025;

	public bool magicCheck2025;

	public bool fireworksCheck2025;

	public int saveVersion = 1;

	public int lastRateID;

	public bool tutorialFinished;

	[DefaultValue(true)]
	public bool pPossible0507 = true;

	public bool premiumDisabled;

	public bool clearDebugOnStart;

	public bool testAds;

	public void initData()
	{
		PlayerConfig.dict.Clear();
		foreach (OptionAsset item in AssetManager.options_library.list)
		{
			if (item.id[0] != '_')
			{
				PlayerOptionData playerOptionData = new PlayerOptionData(item.id);
				if (item.type == OptionType.Bool)
				{
					playerOptionData.boolVal = item.default_bool;
				}
				else if (item.type == OptionType.String)
				{
					playerOptionData.stringVal = item.default_string;
				}
				else if (item.type == OptionType.Int)
				{
					playerOptionData.intVal = item.default_int;
				}
				if (Config.isMobile && item.override_bool_mobile)
				{
					playerOptionData.boolVal = item.default_bool_mobile;
				}
				add(playerOptionData);
			}
		}
	}

	public PlayerOptionData get(string pKey)
	{
		foreach (PlayerOptionData item in list)
		{
			if (string.Equals(pKey, item.name))
			{
				return item;
			}
		}
		return null;
	}

	public PlayerOptionData add(PlayerOptionData pData)
	{
		foreach (PlayerOptionData item in list)
		{
			if (string.Equals(pData.name, item.name))
			{
				PlayerConfig.dict.Add(item.name, item);
				return item;
			}
		}
		list.Add(pData);
		PlayerConfig.dict.Add(pData.name, pData);
		return pData;
	}

	public string toJson()
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Expected O, but got Unknown
		using StringBuilderPool stringBuilderPool = new StringBuilderPool(8192);
		using StringWriter stringWriter = new StringWriter(stringBuilderPool.string_builder, CultureInfo.InvariantCulture);
		JsonTextWriter val = new JsonTextWriter((TextWriter)stringWriter);
		try
		{
			JsonHelper.writer.Serialize((JsonWriter)(object)val, (object)this, typeof(PlayerConfigData));
		}
		finally
		{
			((IDisposable)val)?.Dispose();
		}
		return stringWriter.ToString();
	}
}
// --- End of File: PlayerConfigData.cs ---



// --- Start of File: PlayerControl.cs ---
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

public class PlayerControl
{
	public const int TOUCH_POWER_ACTIVATION_FRAMES = 5;

	internal float timer_spawn_pixels;

	private float _over_ui_timeout;

	private GameObject _gui_check_game_object;

	private static bool? _is_pointer_over_ui_object;

	private Vector2Int _last_click;

	private Vector2 _origin_touch;

	private Vector2 _current_touch;

	internal WorldTile first_pressed_tile;

	internal TileType first_pressed_type;

	internal TopTileType first_pressed_top_type;

	internal bool first_click = true;

	public double click_started_at;

	private float _click_timer;

	private int _last_check = -1;

	internal float inspect_timer_click;

	internal int touch_ticks_skip;

	private double _last_time_touched_ui;

	internal bool already_used_zoom;

	internal bool already_used_camera_drag;

	internal bool already_used_power;

	internal float controls_lock_timer;

	private PointerEventData _event_data_current_position = new PointerEventData(EventSystem.current);

	private readonly List<RaycastResult> _results = new List<RaycastResult>();

	public Vector2 square_selection_position_current;

	private Vector2 square_selection_position_start_last;

	public bool square_selection_started;

	private bool _ignore_square_selection;

	private int _square_selection_ended_frame;

	private WorldTile _cached_mouse_tile_pos;

	public const float DRAG_DETECTION_THRESHOLD_PERCENT = 0.007f;

	public bool isSelectionHappens()
	{
		return square_selection_started;
	}

	public bool isAnyInputHappening()
	{
		if (InputHelpers.mouseSupported)
		{
			if (InputHelpers.GetMouseButton(0))
			{
				return true;
			}
			return false;
		}
		if (InputHelpers.touchCount > 0)
		{
			return true;
		}
		return false;
	}

	internal void updateControls()
	{
		_cached_mouse_tile_pos = getMouseTilePos();
		if (timer_spawn_pixels > 0f)
		{
			timer_spawn_pixels -= World.world.delta_time;
		}
		AssetManager.hotkey_library.checkHotKeyActions();
		if (controlsLocked())
		{
			return;
		}
		if (isOverUI(pCheckTimeout: false))
		{
			_over_ui_timeout = 0.05f;
		}
		else if (_over_ui_timeout > 0f)
		{
			_over_ui_timeout -= Time.deltaTime;
		}
		if (isControllingUnit())
		{
			updateTouch();
			return;
		}
		if (DebugConfig.isOn(DebugOption.MakeUnitsFollowCursor))
		{
			WorldTile mouseTilePosCachedFrame = getMouseTilePosCachedFrame();
			if (mouseTilePosCachedFrame != null && !isOverUI() && InputHelpers.GetMouseButtonDown(0))
			{
				Bench.bench("test_follow");
				foreach (Actor unit in World.world.units)
				{
					if (unit.isFavorite() && unit.current_tile.region.island == mouseTilePosCachedFrame.region.island)
					{
						unit.stopMovement();
						unit.goTo(getMouseTilePosCachedFrame());
					}
				}
				Bench.benchEnd("test_follow", "main", pSaveCounter: false, 0L);
			}
		}
		checkTrailerModeButtons();
		if (!Globals.TRAILER_MODE && !((Component)World.world.canvas).gameObject.activeSelf)
		{
			return;
		}
		World.world.magnet.magnetAction(pFromUpdate: true);
		Boulder.checkRelease();
		if (InputHelpers.GetMouseButtonUp(0))
		{
			timer_spawn_pixels = 0f;
		}
		if (!isAnyInputHappening())
		{
			already_used_zoom = false;
			already_used_camera_drag = false;
			touch_ticks_skip = 0;
			already_used_power = false;
		}
		updateTouch();
		if (controls_lock_timer > 0f)
		{
			controls_lock_timer -= Time.deltaTime;
		}
		else
		{
			if (World.world.isGameplayControlsLocked())
			{
				return;
			}
			if ((InputHelpers.GetMouseButton(1) || InputHelpers.GetMouseButton(0)) && isOverUI())
			{
				_last_time_touched_ui = World.world.getCurSessionTime();
			}
			if (!checkSquareMultiSelection())
			{
				finishSquareSelection();
			}
			if (isOverUI() || tryToMoveSelectedUnits() || checkClickTouchInspectSelect())
			{
				return;
			}
			if (!already_used_zoom && MoveCamera.inSpectatorMode() && !MoveCamera.camera_drag_activated && InputHelpers.GetMouseButtonUp(0) && getDistanceBetweenOriginAndCurrentTouch() < 20f)
			{
				Actor actorFromTile = ActionLibrary.getActorFromTile(getMouseTilePosCachedFrame());
				if (actorFromTile != null)
				{
					World.world.locateAndFollow(actorFromTile, null, null);
					return;
				}
			}
			if (InputHelpers.GetMouseButton(1) || InputHelpers.GetMouseButton(0))
			{
				inspect_timer_click += Time.deltaTime;
			}
			else
			{
				inspect_timer_click = 0f;
			}
			if (!World.world.isAnyPowerSelected())
			{
				checkEmptyClick();
			}
			else
			{
				if (World.world.selected_buttons.selectedButton.godPower == null || already_used_zoom || already_used_camera_drag)
				{
					return;
				}
				GodPower godPower = World.world.selected_buttons.selectedButton.godPower;
				if (!Globals.TRAILER_MODE)
				{
					highlightCursor(godPower);
				}
				if (InputHelpers.touchCount > 1)
				{
					already_used_zoom = true;
					already_used_camera_drag = true;
					already_used_power = false;
				}
				else
				{
					if (InputHelpers.touchCount > 0 && touch_ticks_skip < 5 && godPower.hold_action)
					{
						return;
					}
					bool flag = HotkeyLibrary.many_mod.isHolding() || godPower.hold_action;
					if (!flag && !godPower.ignore_fast_spawn && godPower.type == PowerActionType.PowerSpawnActor && DebugConfig.isOn(DebugOption.FastSpawn))
					{
						flag = true;
					}
					if (flag)
					{
						if (InputHelpers.GetMouseButton(0))
						{
							if (!first_click && DebugConfig.isOn(DebugOption.UltraFastSpawn))
							{
								for (int i = 0; i < 10; i++)
								{
									clickedStart();
								}
							}
							else
							{
								clickedStart();
							}
						}
						else
						{
							((Vector2Int)(ref _last_click)).Set(-1, -1);
							first_pressed_tile = null;
							first_pressed_type = null;
							first_pressed_top_type = null;
							first_click = true;
							click_started_at = Time.time;
						}
					}
					else
					{
						bool flag2 = false;
						if (InputHelpers.touchSupported && InputHelpers.touchCount > 0 && InputHelpers.GetMouseButtonUp(0))
						{
							flag2 = true;
						}
						else if (Input.mousePresent && InputHelpers.GetMouseButtonDown(0))
						{
							flag2 = true;
						}
						if (flag2)
						{
							clickedStart();
							return;
						}
						first_pressed_tile = null;
						first_pressed_type = null;
						first_pressed_top_type = null;
						first_click = true;
					}
				}
			}
		}
	}

	private void updateTouch()
	{
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		if (!InputHelpers.touchSupported)
		{
			return;
		}
		if (InputHelpers.touchCount > 0 && InputHelpers.GetMouseButtonDown(0) && isOverUI())
		{
			already_used_power = true;
			return;
		}
		if (InputHelpers.touchCount == 0)
		{
			touch_ticks_skip = 0;
			already_used_zoom = false;
			already_used_camera_drag = false;
			already_used_power = false;
			_origin_touch = Vector2.zero;
			_current_touch = Vector2.zero;
			return;
		}
		if (InputHelpers.touchCount > 0)
		{
			touch_ticks_skip++;
		}
		if (InputHelpers.touchCount == 1)
		{
			Touch touch = Input.GetTouch(0);
			Vector2 position = ((Touch)(ref touch)).position;
			if (_origin_touch == Vector2.zero)
			{
				_origin_touch = position;
			}
			else
			{
				_current_touch = position;
			}
		}
		else
		{
			_origin_touch = Vector2.zero;
		}
		if (!already_used_power && InputHelpers.touchCount > 1 && isTouchMoreThanDragThreshold())
		{
			already_used_camera_drag = true;
		}
	}

	public bool isTouchMoreThanDragThreshold()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		if (_origin_touch == Vector2.zero || _current_touch == Vector2.zero)
		{
			return false;
		}
		return getCurrentDragDistance() > 0.007f;
	}

	public float getCurrentDragDistance()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		if (_origin_touch == Vector2.zero || _current_touch == Vector2.zero)
		{
			return 0f;
		}
		float distanceBetweenOriginAndCurrentTouch = getDistanceBetweenOriginAndCurrentTouch();
		float num = Mathf.Sqrt((float)(Screen.width * Screen.width + Screen.height * Screen.height));
		return distanceBetweenOriginAndCurrentTouch / num;
	}

	public float getDistanceBetweenOriginAndCurrentTouch()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		if (_origin_touch == Vector2.zero || _current_touch == Vector2.zero)
		{
			return 0f;
		}
		return Toolbox.DistVec2Float(_origin_touch, _current_touch);
	}

	private bool checkSquareMultiSelection()
	{
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		if (ControllableUnit.isControllingUnit())
		{
			return false;
		}
		if (World.world.isAnyPowerSelected())
		{
			return false;
		}
		if (ScrollWindow.isWindowActive() || ScrollWindow.isAnimationActive())
		{
			return false;
		}
		if (MapBox.isRenderMiniMap())
		{
			square_selection_started = false;
			_ignore_square_selection = true;
			return true;
		}
		if (!InputHelpers.mouseSupported)
		{
			return false;
		}
		if (!InputHelpers.GetMouseButton(0))
		{
			return false;
		}
		if (InputHelpers.GetMouseButton(1))
		{
			return false;
		}
		if (InputHelpers.GetMouseButton(2))
		{
			return false;
		}
		if (!square_selection_started && !_ignore_square_selection)
		{
			if (isOverUI())
			{
				_ignore_square_selection = true;
			}
			else
			{
				square_selection_started = true;
				square_selection_position_current = getMousePos();
			}
		}
		return true;
	}

	private void finishSquareSelection()
	{
		if (!_ignore_square_selection && square_selection_started)
		{
			checkSelectedUnits();
			((Vector2)(ref square_selection_position_start_last)).Set(square_selection_position_current.x, square_selection_position_current.y);
			_square_selection_ended_frame = Time.frameCount;
		}
		_ignore_square_selection = false;
		square_selection_started = false;
		((Vector2)(ref square_selection_position_current)).Set(-1f, -1f);
	}

	private void checkSelectedUnits()
	{
		using ListPool<Actor> listPool = getUnitsToBeSelected();
		if (listPool == null || listPool.Count == 0)
		{
			return;
		}
		if (!HotkeyLibrary.isHoldingControlForSelection() && !HotkeyLibrary.many_mod.isHolding())
		{
			SelectedUnit.clear();
		}
		if (HotkeyLibrary.isHoldingControlForSelection())
		{
			foreach (ref Actor item in listPool)
			{
				SelectedUnit.unselect(item);
			}
		}
		else
		{
			SelectedUnit.selectMultiple(listPool);
		}
		if (SelectedUnit.isSet())
		{
			SelectedObjects.setNanoObject(SelectedUnit.unit);
			if (listPool.Count == 1)
			{
				PowerTabController.showTabSelectedUnit();
			}
			else
			{
				PowerTabController.showTabMultipleUnits();
			}
		}
	}

	public bool isSquareSelectionMinSizeAchievedLast()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = square_selection_position_start_last;
		Vector2 mousePos = getMousePos();
		int num = Mathf.FloorToInt(val.x);
		int num2 = Mathf.FloorToInt(val.y);
		int num3 = Mathf.FloorToInt(mousePos.x);
		int num4 = Mathf.FloorToInt(mousePos.y);
		if (num == -1 || num2 == -1 || num3 == -1 || num4 == -1)
		{
			return false;
		}
		int num5 = Mathf.Min(num, num3);
		int num6 = Mathf.Max(num, num3);
		int num7 = Mathf.Min(num2, num4);
		int num8 = Mathf.Max(num2, num4);
		if (num6 - num5 < 2 && num8 - num7 < 2)
		{
			return false;
		}
		return true;
	}

	public ListPool<Actor> getUnitsToBeSelected()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = square_selection_position_current;
		Vector2 mousePos = getMousePos();
		int num = Mathf.FloorToInt(val.x);
		int num2 = Mathf.FloorToInt(val.y);
		int num3 = Mathf.FloorToInt(mousePos.x);
		int num4 = Mathf.FloorToInt(mousePos.y);
		if (num == -1 || num2 == -1 || num3 == -1 || num4 == -1)
		{
			return null;
		}
		int num5 = Mathf.Min(num, num3);
		int num6 = Mathf.Max(num, num3);
		int num7 = Mathf.Min(num2, num4);
		int num8 = Mathf.Max(num2, num4);
		if (num6 - num5 < 2 && num8 - num7 < 2)
		{
			return null;
		}
		num5 = Mathf.Clamp(num5, 0, MapBox.width - 1);
		num6 = Mathf.Clamp(num6, 0, MapBox.width - 1);
		num7 = Mathf.Clamp(num7, 0, MapBox.height - 1);
		num8 = Mathf.Clamp(num8, 0, MapBox.height - 1);
		ListPool<Actor> tList = new ListPool<Actor>();
		for (int i = num5; i <= num6; i++)
		{
			for (int j = num7; j <= num8; j++)
			{
				World.world.GetTile(i, j)?.doUnits(delegate(Actor tActor)
				{
					if (!tActor.isInsideSomething() && tActor.asset.can_be_inspected)
					{
						tList.Add(tActor);
					}
				});
			}
		}
		return tList;
	}

	internal void clickedFinal(Vector2Int pPos, GodPower pPower = null, bool pTrack = true)
	{
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		if (pPower == null)
		{
			pPower = World.world.selected_buttons.selectedButton.godPower;
		}
		if (pPower.requires_premium && !Config.hasPremium)
		{
			ScrollWindow.showWindow("steam");
			return;
		}
		WorldTile tile = World.world.GetTile(((Vector2Int)(ref pPos)).x, ((Vector2Int)(ref pPos)).y);
		string[] obj = new string[5] { pPower.id, " ", null, null, null };
		Vector2Int pos = tile.pos;
		obj[2] = ((Vector2Int)(ref pos)).x.ToString();
		obj[3] = ":";
		pos = tile.pos;
		obj[4] = ((Vector2Int)(ref pos)).y.ToString();
		LogText.log("Clicked", string.Concat(obj));
		if (pPower.click_special_action != null)
		{
			pPower.click_special_action(tile, pPower.id);
			return;
		}
		if (first_pressed_type == null)
		{
			first_pressed_tile = tile;
			first_pressed_type = tile.main_type;
			first_pressed_top_type = tile.top_type;
		}
		if (pPower.click_interval > 0f)
		{
			if (_click_timer >= 0f)
			{
				_click_timer -= World.world.delta_time;
				return;
			}
			_click_timer = pPower.click_interval;
		}
		if (pPower.click_power_action != null || pPower.click_power_brush_action != null)
		{
			if (pPower.click_power_brush_action != null)
			{
				pPower.click_power_brush_action(tile, pPower);
			}
			else if (pPower.click_power_action != null)
			{
				pPower.click_power_action(tile, pPower);
			}
			if (pTrack)
			{
				PowerTracker.PlusOne(pPower);
			}
		}
		else if (pPower.click_action != null || pPower.click_brush_action != null)
		{
			if (pPower.click_brush_action != null)
			{
				pPower.click_brush_action(tile, pPower.id);
			}
			else if (pPower.click_action != null)
			{
				pPower.click_action(tile, pPower.id);
			}
			if (pTrack)
			{
				PowerTracker.PlusOne(pPower);
			}
		}
	}

	private void checkEmptyClick()
	{
		if (!InputHelpers.GetMouseButtonUp(0))
		{
			return;
		}
		if (!PixelDetector.GetSpritePixelColorUnderMousePointer((MonoBehaviour)(object)World.world, out var pVector) || ((Vector2Int)(ref pVector)).x == -1)
		{
			((Vector2Int)(ref _last_click)).Set(-1, -1);
		}
		else
		{
			if (World.world.GetTile(((Vector2Int)(ref pVector)).x, ((Vector2Int)(ref pVector)).y) == null)
			{
				return;
			}
			foreach (Actor unit in World.world.units)
			{
				if (!(Toolbox.Dist(unit.current_tile.posV3.x, unit.current_tile.posV3.y, ((Vector2Int)(ref pVector)).x, ((Vector2Int)(ref pVector)).y) > 10f))
				{
					unit.asset.action_click?.Invoke(unit, unit.current_tile);
				}
			}
		}
	}

	internal void clickedStart()
	{
		//IL_019d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_013a: Unknown result type (might be due to invalid IL or missing references)
		//IL_013e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_0184: Unknown result type (might be due to invalid IL or missing references)
		already_used_power = true;
		if (!PixelDetector.GetSpritePixelColorUnderMousePointer((MonoBehaviour)(object)World.world, out var pVector) || ((Vector2Int)(ref pVector)).x == -1)
		{
			((Vector2Int)(ref _last_click)).Set(-1, -1);
			return;
		}
		GodPower godPower = World.world.selected_buttons.selectedButton.godPower;
		string pID = Config.current_brush;
		if (godPower != null && !string.IsNullOrEmpty(godPower.force_brush))
		{
			pID = godPower.force_brush;
		}
		BrushData brushData = Brush.get(pID);
		if (brushData.continuous && godPower.draw_lines && ((Vector2Int)(ref _last_click)).x != -1 && (((Vector2Int)(ref pVector)).x != ((Vector2Int)(ref _last_click)).x || ((Vector2Int)(ref pVector)).y != ((Vector2Int)(ref _last_click)).y))
		{
			int num = (int)(Toolbox.Dist(((Vector2Int)(ref pVector)).x, ((Vector2Int)(ref pVector)).y, ((Vector2Int)(ref _last_click)).x, ((Vector2Int)(ref _last_click)).y) / (float)(brushData.size + 1)) + 1;
			Vector2 val2 = default(Vector2);
			Vector2Int pPos = default(Vector2Int);
			for (int i = 0; i < num; i++)
			{
				Vector2 val = new Vector2((float)((Vector2Int)(ref pVector)).x, (float)((Vector2Int)(ref pVector)).y);
				((Vector2)(ref val2))._002Ector((float)((Vector2Int)(ref _last_click)).x, (float)((Vector2Int)(ref _last_click)).y);
				Vector2 val3 = Vector2.Lerp(val, val2, (float)i / (float)num);
				((Vector2Int)(ref pPos))._002Ector((int)val3.x, (int)val3.y);
				if (((Vector2Int)(ref pPos)).x >= 0 && ((Vector2Int)(ref pPos)).x < MapBox.width && ((Vector2Int)(ref pPos)).y >= 0 && ((Vector2Int)(ref pPos)).y < MapBox.height)
				{
					clickedFinal(pPos, godPower, pTrack: false);
				}
			}
		}
		clickedFinal(pVector, godPower);
		first_click = false;
		((Vector2Int)(ref _last_click)).Set(((Vector2Int)(ref pVector)).x, ((Vector2Int)(ref pVector)).y);
	}

	private bool tryToMoveSelectedUnits()
	{
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.mouseSupported)
		{
			if (!InputHelpers.GetMouseButtonUp(1))
			{
				return false;
			}
		}
		else if (!InputHelpers.GetMouseButtonUp(0))
		{
			return false;
		}
		if (!SelectedUnit.isSet())
		{
			return false;
		}
		if (MoveCamera.camera_drag_activated)
		{
			return false;
		}
		if (already_used_camera_drag)
		{
			return false;
		}
		if (inspect_timer_click > 0.15f)
		{
			return false;
		}
		WorldTile worldTile = getMouseTilePosCachedFrame();
		Vector3 pPos = Vector2.op_Implicit(getMousePos());
		if (worldTile != null)
		{
			pPos = worldTile.posV3;
		}
		BaseEffect baseEffect = EffectsLibrary.spawnAt("fx_move", pPos, 0.1f);
		if ((Object)(object)baseEffect != (Object)null)
		{
			baseEffect.sprite_renderer.color = World.world.getArchitectColor();
		}
		inspect_timer_click = 0.16f;
		if (worldTile == null)
		{
			return false;
		}
		bool flag = HotkeyLibrary.isHoldingControlForSelection();
		Actor actorTargetNearCursor = getActorTargetNearCursor();
		using ListPool<Actor> listPool = new ListPool<Actor>(SelectedUnit.getAllSelected());
		listPool.Remove(SelectedUnit.unit);
		listPool.Insert(0, SelectedUnit.unit);
		foreach (ref Actor item in listPool)
		{
			Actor current = item;
			bool flag2 = false;
			if (flag && actorTargetNearCursor != null)
			{
				current.cancelAllBeh();
				current.addAggro(actorTargetNearCursor);
				current.startFightingWith(actorTargetNearCursor);
				if (Toolbox.DistTile(current.current_tile, actorTargetNearCursor.current_tile) > 7f)
				{
					tryToMoveSelectedUnit(current, worldTile, pCancelBeh: false);
				}
			}
			else
			{
				flag2 = tryToMoveSelectedUnit(current, worldTile);
			}
			if (flag2)
			{
				worldTile = worldTile.getNeighbourTileSameIsland();
			}
		}
		QuantumSpriteLibrary.last_order_timestamp = World.world.getCurSessionTime();
		return true;
	}

	private Actor getActorTargetNearCursor()
	{
		Actor actorNearCursor = World.world.getActorNearCursor();
		if (actorNearCursor == null || !actorNearCursor.isAlive())
		{
			return null;
		}
		return actorNearCursor;
	}

	private bool tryToMoveSelectedUnit(Actor pActor, WorldTile pTile, bool pCancelBeh = true)
	{
		if (!pActor.asset.allow_strange_urge_movement)
		{
			return false;
		}
		if (pTile.Type.block)
		{
			return false;
		}
		if (pActor.asset.id == "dragon" && !pActor.isFlying())
		{
			return false;
		}
		pActor.stopSleeping();
		bool flag = pTile.Type.liquid;
		if (pActor.isWaterCreature() || pActor.asset.is_boat)
		{
			flag = true;
		}
		if (!flag && !pTile.isSameIsland(pActor.current_tile))
		{
			flag = true;
		}
		bool lava = pTile.Type.lava;
		if (pCancelBeh)
		{
			pActor.cancelAllBeh();
			pActor.stopMovement();
		}
		pActor.goTo(pTile, flag, pWalkOnBlocks: false, lava);
		pActor.addStatusEffect("strange_urge", 100f, pColorEffect: false);
		pActor.clearWait();
		return true;
	}

	private bool checkClickTouchInspectSelect()
	{
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		if (!canInspectWithMainTouch() && !canInspectWithRightClick())
		{
			return false;
		}
		if (!DebugConfig.isOn(DebugOption.InspectObjectsOnClick))
		{
			return false;
		}
		if (MoveCamera.camera_drag_activated)
		{
			return false;
		}
		if (_over_ui_timeout > 0f)
		{
			return false;
		}
		if (already_used_zoom)
		{
			return false;
		}
		if (already_used_camera_drag)
		{
			return false;
		}
		if (isActionHappening())
		{
			return false;
		}
		if (inspect_timer_click > 0.15f)
		{
			return false;
		}
		if (MoveCamera.inSpectatorMode())
		{
			return false;
		}
		if (World.world.getCurSessionTime() - _last_time_touched_ui < 0.20000000298023224)
		{
			return false;
		}
		if (!(Toolbox.DistVec2Float(_origin_touch, _current_touch) < 20f))
		{
			return false;
		}
		NameplateText cursor_over_text = World.world.nameplate_manager.cursor_over_text;
		if ((Object)(object)cursor_over_text != (Object)null)
		{
			NanoObject nano_object = cursor_over_text.nano_object;
			nano_object.getMetaType().getAsset().selectAndInspect(nano_object, pFromNameplate: true);
			return true;
		}
		WorldTile mouseTilePosCachedFrame = getMouseTilePosCachedFrame();
		if (mouseTilePosCachedFrame == null)
		{
			return true;
		}
		MetaTypeAsset cachedMapMetaAsset = World.world.getCachedMapMetaAsset();
		if (MapBox.isRenderMiniMap() && cachedMapMetaAsset != null && Zones.showMapBorders())
		{
			cachedMapMetaAsset.click_action_zone(mouseTilePosCachedFrame);
		}
		else
		{
			bool flag = false;
			if (HotkeyLibrary.many_mod.isHolding())
			{
				if (SelectedUnit.isSet())
				{
					flag = true;
				}
				if (ActionLibrary.inspectUnitSelectedMeta())
				{
					return true;
				}
			}
			if (isAllowedToSelectUnits())
			{
				Actor actorNearCursor = World.world.getActorNearCursor();
				if (actorNearCursor != null)
				{
					if (SelectedUnit.isSelected(actorNearCursor))
					{
						if (SelectedUnit.isMainSelected(actorNearCursor))
						{
							if (isSquareSelectionMinSizeAchievedLast())
							{
								if (Time.frameCount != _square_selection_ended_frame)
								{
									ActionLibrary.inspectUnit();
								}
							}
							else
							{
								ActionLibrary.inspectUnit();
							}
						}
						else
						{
							SelectedUnit.makeMainSelected(actorNearCursor);
						}
					}
					else
					{
						if (!flag)
						{
							SelectedUnit.clear();
						}
						SelectedUnit.select(actorNearCursor);
						SelectedObjects.setNanoObject(actorNearCursor);
						PowerTabController.showTabSelectedUnit();
					}
				}
			}
			else if (!ScrollWindow.isWindowActive())
			{
				ActionLibrary.inspectUnit();
			}
		}
		return true;
	}

	public void updateCurrentPosition()
	{
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Expected O, but got Unknown
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Expected O, but got Unknown
		if (_last_check == Time.frameCount)
		{
			return;
		}
		_last_check = Time.frameCount;
		bool flag = false;
		if (InputHelpers.touchSupported && InputHelpers.touchCount != 0)
		{
			if (_event_data_current_position == null)
			{
				_event_data_current_position = new PointerEventData(EventSystem.current);
			}
			PointerEventData event_data_current_position = _event_data_current_position;
			Touch touch = Input.GetTouch(0);
			float x = ((Touch)(ref touch)).position.x;
			touch = Input.GetTouch(0);
			event_data_current_position.position = new Vector2(x, ((Touch)(ref touch)).position.y);
			flag = true;
		}
		if (!flag && InputHelpers.mouseSupported && Input.mousePosition.x >= 0f && Input.mousePosition.y >= 0f && Input.mousePosition.x <= (float)Screen.width && Input.mousePosition.y <= (float)Screen.height)
		{
			if (_event_data_current_position == null)
			{
				_event_data_current_position = new PointerEventData(EventSystem.current);
			}
			_event_data_current_position.position = new Vector2(Input.mousePosition.x, Input.mousePosition.y);
			flag = true;
		}
		if (!flag)
		{
			_event_data_current_position = null;
		}
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isBusyWithUI()
	{
		if (!ScrollWindow.isWindowActive() && !ScrollWindow.isAnimationActive())
		{
			return isOverUI();
		}
		return true;
	}

	public bool isOverUI(bool pCheckTimeout = true)
	{
		if (pCheckTimeout && _over_ui_timeout > 0f)
		{
			return true;
		}
		if (isPointerOverUIObject())
		{
			return true;
		}
		return false;
	}

	private bool isAllowedToSelectUnits()
	{
		return true;
	}

	private bool canInspectUnitWithCurrentPower()
	{
		if (World.world.isAnyPowerSelected())
		{
			if (World.world.selected_buttons.selectedButton.godPower.allow_unit_selection)
			{
				return true;
			}
			return false;
		}
		return true;
	}

	private bool canInspectWithRightClick()
	{
		if (!InputHelpers.mouseSupported)
		{
			return false;
		}
		if (!canInspectUnitWithCurrentPower())
		{
			return false;
		}
		return Input.GetMouseButtonUp(1);
	}

	private bool canInspectWithMainTouch()
	{
		if (!canInspectUnitWithCurrentPower())
		{
			return false;
		}
		return Input.GetMouseButtonUp(0);
	}

	public bool isPointerInGame()
	{
		updateCurrentPosition();
		if (_event_data_current_position == null)
		{
			return false;
		}
		return true;
	}

	public bool isPointerOverUIObject()
	{
		if (_is_pointer_over_ui_object.HasValue)
		{
			return _is_pointer_over_ui_object.Value;
		}
		updateCurrentPosition();
		if (_event_data_current_position == null)
		{
			return false;
		}
		List<RaycastResult> results = _results;
		EventSystem.current.RaycastAll(_event_data_current_position, results);
		_is_pointer_over_ui_object = results.Count > 0;
		return _is_pointer_over_ui_object.Value;
	}

	public bool isPointerOverUIButton()
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		updateCurrentPosition();
		if (_event_data_current_position == null)
		{
			return false;
		}
		List<RaycastResult> results = _results;
		EventSystem.current.RaycastAll(_event_data_current_position, results);
		for (int i = 0; i < results.Count; i++)
		{
			RaycastResult val = results[i];
			if (((RaycastResult)(ref val)).isValid)
			{
				GameObject gameObject = ((RaycastResult)(ref val)).gameObject;
				if (gameObject.HasComponent<Button>())
				{
					return true;
				}
				if (gameObject.HasComponent<EventTrigger>())
				{
					return true;
				}
			}
		}
		return false;
	}

	public bool isTouchOverUI(Touch pTouch)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Invalid comparison between Unknown and I4
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Invalid comparison between Unknown and I4
		if ((int)((Touch)(ref pTouch)).phase == 3 || (int)((Touch)(ref pTouch)).phase == 4)
		{
			return false;
		}
		return EventSystem.current.IsPointerOverGameObject(((Touch)(ref pTouch)).fingerId);
	}

	public bool isPointerOverUIScroll()
	{
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		updateCurrentPosition();
		if (_event_data_current_position == null)
		{
			return false;
		}
		List<RaycastResult> results = _results;
		if (results.Count == 0)
		{
			EventSystem.current.RaycastAll(_event_data_current_position, results);
		}
		for (int i = 0; i < results.Count; i++)
		{
			RaycastResult val = results[i];
			if (!((RaycastResult)(ref val)).isValid)
			{
				return false;
			}
			_gui_check_game_object = ((RaycastResult)(ref val)).gameObject;
			if ((Object)(object)_gui_check_game_object == (Object)null)
			{
				return false;
			}
			if (_gui_check_game_object.HasComponent<ScrollRectExtended>())
			{
				return true;
			}
			if (!(((Object)_gui_check_game_object).name == "Scroll View"))
			{
				continue;
			}
			Transform val2 = _gui_check_game_object.transform.Find("Viewport/Content");
			if ((Object)(object)val2 != (Object)null)
			{
				Vector2 sizeDelta = _gui_check_game_object.GetComponent<RectTransform>().sizeDelta;
				if (((Component)val2).GetComponent<RectTransform>().sizeDelta.y > sizeDelta.y)
				{
					return true;
				}
			}
		}
		return false;
	}

	public bool isActionHappening()
	{
		if (Earthquake.isQuakeActive())
		{
			return true;
		}
		AutoTesterBot auto_tester = World.world.auto_tester;
		if (auto_tester != null && auto_tester.active)
		{
			return false;
		}
		if (Input.touchSupported && Input.touchCount > 1)
		{
			return true;
		}
		if (Input.mousePresent && (Input.GetMouseButton(0) || Input.GetMouseButton(2)))
		{
			return true;
		}
		return false;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool controlsLocked()
	{
		if (MapBox.instance.tutorial.isActive())
		{
			return true;
		}
		if (Config.lockGameControls)
		{
			return true;
		}
		if (Config.isDraggingItem())
		{
			return true;
		}
		return false;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public static bool isControllingUnit()
	{
		if (ControllableUnit.isControllingUnit())
		{
			return true;
		}
		if (MapBox.instance.stack_effects.isLocked())
		{
			return true;
		}
		return false;
	}

	private void highlightCursor(GodPower pPower)
	{
		if (!Config.isComputer && !Config.isEditor)
		{
			return;
		}
		WorldTile mouseTilePos = World.world.getMouseTilePos();
		if (mouseTilePos == null)
		{
			return;
		}
		World.world.flash_effects.flashPixel(mouseTilePos, 10);
		if (pPower != null)
		{
			if (!string.IsNullOrEmpty(pPower.force_brush))
			{
				highlightFrom(mouseTilePos, Brush.get(pPower.force_brush));
			}
			else if (pPower.highlight || pPower.show_tool_sizes)
			{
				highlightFrom(mouseTilePos, Config.current_brush_data);
			}
		}
	}

	private void highlightFrom(WorldTile pTile, BrushData pBrushData)
	{
		for (int i = 0; i < pBrushData.pos.Length; i++)
		{
			WorldTile tile = World.world.GetTile(pBrushData.pos[i].x + pTile.x, pBrushData.pos[i].y + pTile.y);
			if (tile != null)
			{
				World.world.flash_effects.flashPixel(tile, 20);
			}
		}
	}

	public void clearLateUpdate()
	{
		_is_pointer_over_ui_object = null;
		_results.Clear();
	}

	public void clear()
	{
		_results.Clear();
		first_click = true;
		_cached_mouse_tile_pos = null;
	}

	public Vector2 getMousePos()
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Vector2.op_Implicit(Input.mousePosition);
		return Vector2.op_Implicit(World.world.camera.ScreenToWorldPoint(Vector2.op_Implicit(val)));
	}

	public WorldTile getMouseTilePosCachedFrame()
	{
		return _cached_mouse_tile_pos;
	}

	public WorldTile getMouseTilePos()
	{
		if (!PixelDetector.GetSpritePixelColorUnderMousePointer((MonoBehaviour)(object)World.world, out var pVector))
		{
			return null;
		}
		return World.world.GetTile(((Vector2Int)(ref pVector)).x, ((Vector2Int)(ref pVector)).y);
	}

	public bool getTouchPos(out Touch pTouch, bool pOnlyGameplay = false)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		pTouch = default(Touch);
		bool result = false;
		Touch[] touches = Input.touches;
		foreach (Touch val in touches)
		{
			if (!pOnlyGameplay || !World.world.isTouchOverUI(val))
			{
				pTouch = val;
				result = true;
				break;
			}
		}
		return result;
	}

	internal void checkTrailerModeButtons()
	{
		if (Globals.TRAILER_MODE)
		{
			if (!ScrollWindow.isWindowActive() && Input.GetKeyDown((KeyCode)290))
			{
				((Component)World.world.canvas).gameObject.SetActive(!((Component)World.world.canvas).gameObject.activeSelf);
			}
			if (Input.GetKeyDown((KeyCode)96))
			{
				TrailerModeSettings.startEvent();
			}
			if (Input.GetKeyDown((KeyCode)289))
			{
				DebugConfig.switchOption(DebugOption.FastSpawn);
			}
			if (Input.GetKeyDown((KeyCode)288))
			{
				DebugConfig.switchOption(DebugOption.SonicSpeed);
			}
			if (Input.GetKeyDown((KeyCode)32))
			{
				Config.paused = !Config.paused;
			}
			if (Input.GetKeyDown((KeyCode)257) || Input.GetKeyDown((KeyCode)49))
			{
				World.world.selected_buttons.clickPowerButton(PowerButton.get("seeds"));
			}
			else if (Input.GetKeyDown((KeyCode)258) || Input.GetKeyDown((KeyCode)50))
			{
				World.world.selected_buttons.clickPowerButton(PowerButton.get("tile_shallow_waters"));
			}
			else if (Input.GetKeyDown((KeyCode)259) || Input.GetKeyDown((KeyCode)51))
			{
				World.world.selected_buttons.clickPowerButton(PowerButton.get("fruit_bush"));
			}
			else if (Input.GetKeyDown((KeyCode)260) || Input.GetKeyDown((KeyCode)52))
			{
				World.world.selected_buttons.clickPowerButton(PowerButton.get("cat"));
			}
			else if (Input.GetKeyDown((KeyCode)261) || Input.GetKeyDown((KeyCode)53))
			{
				World.world.selected_buttons.clickPowerButton(PowerButton.get("atomic_bomb"));
			}
			else if (Input.GetKeyDown((KeyCode)262) || Input.GetKeyDown((KeyCode)54))
			{
				World.world.selected_buttons.clickPowerButton(PowerButton.get("czar_bomba"));
			}
		}
	}
}
// --- End of File: PlayerControl.cs ---



// --- Start of File: PlayerNameInput.cs ---
using UnityEngine;
using UnityEngine.UI;

[RequireComponent(typeof(NameInput))]
public class PlayerNameInput : MonoBehaviour
{
	private NameInput _name_input;

	private void Awake()
	{
		_name_input = ((Component)this).GetComponent<NameInput>();
		_name_input.addListener(inputAction);
	}

	private void Update()
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		((Graphic)_name_input.textField).color = World.world.getArchitectMood().getColorText();
	}

	private void OnEnable()
	{
		_name_input.setText(World.world.map_stats.player_name);
	}

	private void inputAction(string pInput)
	{
		World.world.map_stats.player_name = pInput;
	}
}
// --- End of File: PlayerNameInput.cs ---



// --- Start of File: PlayerOptionAction.cs ---
public delegate void PlayerOptionAction(PlayerOptionData pOption);
// --- End of File: PlayerOptionAction.cs ---



// --- Start of File: PlayerOptionData.cs ---
using System;
using System.ComponentModel;

[Serializable]
public class PlayerOptionData
{
	public string name = "OPTION";

	[DefaultValue(true)]
	public bool boolVal = true;

	[DefaultValue("")]
	public string stringVal = string.Empty;

	[DefaultValue(0)]
	public int intVal;

	[NonSerialized]
	public PlayerOptionAction on_switch;

	public PlayerOptionData(string pName)
	{
		name = pName;
	}
}
// --- End of File: PlayerOptionData.cs ---



// --- Start of File: PlayInterstitialAd.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class PlayInterstitialAd : MonoBehaviour
{
	public static PlayInterstitialAd instance;

	internal static List<IWorldBoxAd> adProviders = new List<IWorldBoxAd>();

	public static IWorldBoxAd adProvider;

	public static bool initiated = false;

	public float timeout;

	private int failed;

	private bool should_switch = true;

	private const int AD_TIMEOUT = 8;

	private const int LOST_FOCUS_TIMEOUT = 3;

	internal static bool _isShowing = false;

	private void Awake()
	{
		instance = this;
	}

	private void Update()
	{
	}

	public void initAds()
	{
	}

	public void realInit()
	{
		initiated = true;
		adProviders.Add(new IronSourceInterstitialAd());
		adProviders.Add(new GoogleInterstitialAd());
		foreach (IWorldBoxAd adProvider in adProviders)
		{
			adProvider.adResetCallback = adReset;
			adProvider.adFinishedCallback = adFinished;
			adProvider.adFailedCallback = adFailed;
			adProvider.adStartedCallback = adStarted;
			adProvider.logger = log;
		}
		switchProvider();
		scheduleAd(8f);
	}

	public void switchProvider()
	{
		if (!should_switch)
		{
			return;
		}
		should_switch = false;
		using ListPool<IWorldBoxAd> listPool = new ListPool<IWorldBoxAd>(adProviders.Count);
		foreach (IWorldBoxAd adProvider in adProviders)
		{
			if (adProvider.IsInitialized() && adProvider != PlayInterstitialAd.adProvider)
			{
				listPool.Add(adProvider);
			}
		}
		if (listPool.Count == 0)
		{
			foreach (IWorldBoxAd adProvider2 in adProviders)
			{
				if (adProvider2.IsInitialized())
				{
					listPool.Add(adProvider2);
				}
			}
		}
		PlayInterstitialAd.adProvider = listPool.GetRandom();
		PlayInterstitialAd.adProvider.Reset();
		log("Switched provider: " + PlayInterstitialAd.adProvider.GetProviderName());
	}

	internal bool isReady()
	{
		return false;
	}

	public static bool hasAd()
	{
		return adProvider.HasAd();
	}

	internal void showAd()
	{
		log("Show interstitial ad");
		log("Active ad provider: " + adProvider.GetProviderName());
		MonoBehaviour.print((object)("- Show interstitial ad " + isReady()));
		logEvent("interstitial_ad_show");
		adProvider.ShowAd();
	}

	public static void forceShowAd()
	{
		try
		{
			logEvent("interstitial_ad_force_show");
			if (!initiated)
			{
				instance.realInit();
				adProvider.RequestAd();
			}
			if (adProvider.IsReady())
			{
				adProvider.ShowAd();
			}
			else
			{
				adProvider.RequestAd();
			}
		}
		catch (Exception)
		{
		}
	}

	private void scheduleAd(float pTimer = 60f)
	{
		if (!(timeout > 0f))
		{
			adProvider.KillAd();
			timeout = pTimer;
			switchProvider();
		}
	}

	private static void logEvent(string pEvent)
	{
		Analytics.LogEvent(pEvent);
	}

	private void log(string pString)
	{
		Debug.Log((object)("<color=yellow>[I] " + pString + "</color>"));
	}

	private void adReset()
	{
		failed = 0;
		timeout = 2f;
	}

	private void adStarted()
	{
		failed = 0;
		timeout = 8f;
		logEvent("interstitial_ad_started");
		_isShowing = true;
	}

	private void adFailed()
	{
		failed++;
		timeout = 8 * failed;
		logEvent("interstitial_ad_failed");
		_isShowing = false;
		should_switch = failed > 1;
	}

	private void adFinished()
	{
		failed = 0;
		timeout = 8f;
		logEvent("interstitial_ad_finished");
		_isShowing = false;
	}

	internal static bool isShowing()
	{
		return _isShowing;
	}

	internal static void setActive(bool pActive = false)
	{
		if ((Object)(object)instance == (Object)null)
		{
			instance = GameObject.Find("Services").GetComponentInChildren<PlayInterstitialAd>(true);
		}
		((Component)instance).gameObject.SetActive(pActive);
	}
}
// --- End of File: PlayInterstitialAd.cs ---



// --- Start of File: Plot.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class Plot : MetaObject<PlotData>
{
	public static bool DEBUG_PLOTS = false;

	private static Dictionary<int, Sprite> _cache_sprites;

	public City target_city;

	public Kingdom target_kingdom;

	public Alliance target_alliance;

	public Actor target_actor;

	public War target_war;

	private PlotAsset _plot_asset;

	private PlotState _state;

	private int _power;

	private static int _total_sprites = 7;

	private int _last_index;

	public float transition_animation;

	private float _transition_animation_speed;

	private Actor _plot_author;

	public float progress_target;

	public double last_update_progress;

	protected override MetaType meta_type => MetaType.Plot;

	public override BaseSystemManager manager => World.world.plots;

	public void newPlot(Actor pAuthor, PlotAsset pAsset, bool pForced)
	{
		data.plot_type_id = pAsset.id;
		_plot_asset = pAsset;
		string pName = _plot_asset.getLocaleID().Localize();
		setName(pName);
		data.forced = pForced;
		data.founder_name = pAuthor.getName();
		data.founder_id = pAuthor.getID();
		pAuthor.setPlot(this);
		_plot_author = pAuthor;
	}

	protected sealed override void setDefaultValues()
	{
		base.setDefaultValues();
		_state = PlotState.Active;
		_power = 0;
		_last_index = -1;
		transition_animation = 1f;
		_transition_animation_speed = 0.8f;
		progress_target = 0f;
		last_update_progress = 0.0;
	}

	private bool isState(PlotState pState)
	{
		return _state == pState;
	}

	public void finishPlot(PlotState pState, Actor pActor)
	{
		if (_state == pState)
		{
			return;
		}
		_state = pState;
		switch (_state)
		{
		case PlotState.Finished:
			World.world.game_stats.data.plotsSucceeded++;
			World.world.map_stats.plotsSucceeded++;
			if (pActor != null)
			{
				pActor.changeHappiness("just_finished_plot");
				pActor.addStatusEffect("recovery_plot");
			}
			break;
		case PlotState.Cancelled:
			World.world.game_stats.data.plotsForgotten++;
			World.world.map_stats.plotsForgotten++;
			pActor?.addStatusEffect("recovery_plot");
			break;
		}
		startRemovalAnimation();
		foreach (Actor unit in base.units)
		{
			unit.leavePlot();
		}
		startAnimation();
		data.progress_current = getProgressMax();
	}

	public PlotState getState()
	{
		return _state;
	}

	public override bool isReadyForRemoval()
	{
		return !isActive();
	}

	public override void loadData(PlotData pData)
	{
		base.loadData(pData);
		_plot_asset = AssetManager.plots_library.get(data.plot_type_id);
		target_city = World.world.cities.get(data.id_target_city);
		target_kingdom = World.world.kingdoms.get(data.id_target_kingdom);
		target_alliance = World.world.alliances.get(data.id_target_alliance);
		target_war = World.world.wars.get(data.id_target_war);
	}

	public void loadAuthors()
	{
		_plot_author = World.world.units.get(data.founder_id);
		target_actor = World.world.units.get(data.id_target_actor);
	}

	public override void save()
	{
		base.save();
		data.id_target_actor = target_actor?.data.id ?? (-1);
		data.id_target_city = target_city?.data.id ?? (-1);
		data.id_target_kingdom = target_kingdom?.data.id ?? (-1);
		data.id_target_alliance = target_alliance?.data.id ?? (-1);
		data.id_target_war = target_war?.data.id ?? (-1);
	}

	public void updateAnimations(float pElapsed)
	{
		if (transition_animation > 1f)
		{
			transition_animation -= Time.deltaTime * _transition_animation_speed;
			if (transition_animation < 1f)
			{
				transition_animation = 1f;
			}
		}
	}

	public override ColorAsset getColor()
	{
		Actor author = getAuthor();
		ColorAsset result = null;
		if (author != null)
		{
			result = author.kingdom.getColor();
		}
		return result;
	}

	public bool updateProgressTarget(Actor pActor, float pIntelligence)
	{
		last_update_progress = World.world.getCurWorldTime();
		progress_target += pIntelligence + 1f;
		if (progress_target > getProgressMax())
		{
			progress_target = getProgressMax();
		}
		float progressMod = getProgressMod();
		_transition_animation_speed = 1.5f * progressMod;
		if (transition_animation <= 1f)
		{
			startAnimation();
		}
		if (data.progress_current >= getProgressMax())
		{
			if (_plot_asset.action(pActor))
			{
				_plot_asset.post_action?.Invoke(pActor);
			}
			finishPlot(PlotState.Finished, pActor);
			return true;
		}
		return false;
	}

	public void updateProgress(float pElapsed)
	{
		if (data.progress_current < progress_target)
		{
			data.progress_current += pElapsed * 2f;
			if (data.progress_current > progress_target)
			{
				data.progress_current = progress_target;
			}
		}
	}

	public int getProgressPercentage()
	{
		float progress = getProgress();
		float progressMax = getProgressMax();
		if (progressMax == 0f)
		{
			return 0;
		}
		return (int)(progress / progressMax * 100f);
	}

	public float getProgressMod()
	{
		float progress = getProgress();
		float progressMax = getProgressMax();
		return progress / progressMax;
	}

	public bool checkInitiatorAndTargets()
	{
		if (_plot_asset.check_target_actor && !target_actor.isAlive())
		{
			return false;
		}
		if (_plot_asset.check_target_alliance && !target_alliance.isAlive())
		{
			return false;
		}
		if (_plot_asset.check_target_city && !target_city.isAlive())
		{
			return false;
		}
		if (_plot_asset.check_target_kingdom)
		{
			if (!target_kingdom.isAlive())
			{
				return false;
			}
			if (!target_kingdom.hasCities())
			{
				return false;
			}
		}
		if (_plot_asset.check_target_war && !target_war.isAlive())
		{
			return false;
		}
		return true;
	}

	public PlotAsset getAsset()
	{
		return _plot_asset;
	}

	public int getPower()
	{
		return _power;
	}

	public int getMaxSupporters()
	{
		return 15;
	}

	public int getSupporters()
	{
		return base.units.Count;
	}

	public float getProgressMax()
	{
		return _plot_asset.progress_needed;
	}

	public float getProgress()
	{
		return data.progress_current;
	}

	public void startAnimation()
	{
		transition_animation = 1.3f;
	}

	public void startRemovalAnimation()
	{
		foreach (Actor unit in base.units)
		{
			if (unit.isAlive())
			{
				World.world.stack_effects.plot_removals.Add(new PlotIconData
				{
					actor = unit,
					sprite = getSpritePath(),
					timestamp = World.world.getCurSessionTime()
				});
			}
		}
	}

	public Sprite getSprite()
	{
		return SpriteTextureLoader.getSprite(getSpritePath());
	}

	public string getSpritePath()
	{
		if (isFinished())
		{
			return "plots/icons/progress/plot_finished";
		}
		if (isCancelled())
		{
			return "plots/icons/progress/plot_cancelled";
		}
		return _plot_asset.path_icon;
	}

	public Sprite getSpriteIconProgress()
	{
		int num = (int)(getProgress() / getProgressMax() * (float)(_total_sprites + 1));
		if (num > _total_sprites)
		{
			num = _total_sprites;
		}
		if (_cache_sprites == null)
		{
			_cache_sprites = new Dictionary<int, Sprite>();
			for (int i = 0; i <= _total_sprites; i++)
			{
				_cache_sprites.Add(i, SpriteTextureLoader.getSprite("plots/speech_bubbles/speech_bubble_0" + i));
			}
		}
		Sprite result = _cache_sprites[num];
		if (num != _last_index)
		{
			_last_index = num;
			startAnimation();
		}
		return result;
	}

	public bool hasSupporter(Actor pActor)
	{
		if (base.units.Contains(pActor))
		{
			return true;
		}
		return false;
	}

	public bool isActive()
	{
		return isState(PlotState.Active);
	}

	public bool isCancelled()
	{
		return isState(PlotState.Cancelled);
	}

	public bool isFinished()
	{
		return isState(PlotState.Finished);
	}

	public bool isSameType(PlotAsset pAsset)
	{
		return pAsset == getAsset();
	}

	public Actor getAuthor()
	{
		_plot_author = World.world.units.get(data.founder_id);
		return _plot_author;
	}

	public override void clearLastYearStats()
	{
		throw new NotImplementedException(GetType().Name);
	}

	public override void increaseBirths()
	{
		throw new NotImplementedException(GetType().Name);
	}

	public override void increaseDeaths(AttackType pType)
	{
		throw new NotImplementedException(GetType().Name);
	}

	public override void Dispose()
	{
		target_city = null;
		target_kingdom = null;
		target_alliance = null;
		target_actor = null;
		target_war = null;
		_plot_asset = null;
		_plot_author = null;
		base.Dispose();
	}

	public bool isAuthorDead()
	{
		if (_plot_author != null)
		{
			return !_plot_author.isAlive();
		}
		return true;
	}
}
// --- End of File: Plot.cs ---



// --- Start of File: PlotAction.cs ---
public delegate bool PlotAction(Actor pActor);
// --- End of File: PlotAction.cs ---



// --- Start of File: PlotActorDelegate.cs ---
public delegate int PlotActorDelegate(Actor pActor);
// --- End of File: PlotActorDelegate.cs ---



// --- Start of File: PlotActorPlotDelegate.cs ---
public delegate bool PlotActorPlotDelegate(Actor pActor, Plot pPlot);
// --- End of File: PlotActorPlotDelegate.cs ---



// --- Start of File: PlotAsset.cs ---
using System;
using System.Collections.Generic;
using System.ComponentModel;

[Serializable]
public class PlotAsset : BaseAugmentationAsset, IDescription2Asset, IDescriptionAsset, ILocalizedAsset
{
	public int limit_members;

	[DefaultValue(1)]
	public int pot_rate = 1;

	public int min_level;

	public int min_renown_kingdom;

	public int min_renown_actor;

	[DefaultValue(2)]
	public int min_intelligence = 2;

	[DefaultValue(2)]
	public int min_diplomacy = 2;

	[DefaultValue(2)]
	public int min_warfare = 2;

	[DefaultValue(2)]
	public int min_stewardship = 2;

	public bool can_be_done_by_king;

	public bool can_be_done_by_leader;

	public bool can_be_done_by_clan_member;

	public bool requires_diplomacy;

	public bool requires_rebellion;

	[DefaultValue(60f)]
	public float progress_needed = 60f;

	[DefaultValue(5)]
	public int money_cost = 5;

	public bool is_basic_plot;

	public Rarity rarity;

	public PlotDescription get_formatted_description;

	public PlotCheckerDelegate check_is_possible;

	public PlotCheckerDelegate check_can_be_forced;

	public PlotCheckerDelegate check_should_continue;

	public PlotActorPlotDelegate check_other_plots;

	public PlotTryToStart try_to_start_advanced;

	public PlotStart start;

	public PlotAction action;

	public PlotAction post_action;

	public PlotActorPlotDelegate check_supporters;

	public bool check_target_actor;

	public bool check_target_city;

	public bool check_target_kingdom;

	public bool check_target_alliance;

	public bool check_target_war;

	protected override HashSet<string> progress_elements => base._progress_data?.unlocked_plots;

	public override BaseCategoryAsset getGroup()
	{
		return AssetManager.plot_category_library.get(group_id);
	}

	public PlotCategoryAsset getPlotGroup()
	{
		return AssetManager.plot_category_library.get(group_id);
	}

	public bool checkIsPossible(Actor pActor, bool pWorldLawsCheck = true)
	{
		if (!pActor.hasEnoughMoney(money_cost))
		{
			return false;
		}
		if (pActor.level < min_level)
		{
			return false;
		}
		if (pActor.renown < min_renown_actor)
		{
			return false;
		}
		if (pActor.kingdom.getRenown() < min_renown_kingdom)
		{
			return false;
		}
		if (pActor.intelligence < min_intelligence)
		{
			return false;
		}
		if (pActor.diplomacy < min_diplomacy)
		{
			return false;
		}
		if (pActor.warfare < min_warfare)
		{
			return false;
		}
		if (pActor.stewardship < min_stewardship)
		{
			return false;
		}
		if (!canBeDoneByRole(pActor))
		{
			return false;
		}
		if (pWorldLawsCheck && !isAllowedByWorldLaws())
		{
			return false;
		}
		if (!check_is_possible(pActor))
		{
			return false;
		}
		return true;
	}

	public bool canBeDoneByRole(Actor pActor)
	{
		if (can_be_done_by_king && pActor.isKing())
		{
			return true;
		}
		if (can_be_done_by_leader && pActor.isCityLeader())
		{
			return true;
		}
		if (can_be_done_by_clan_member && pActor.hasClan())
		{
			return true;
		}
		return false;
	}

	public bool isAllowedByWorldLaws()
	{
		if (requires_diplomacy && !isDiplomacyON())
		{
			return false;
		}
		if (requires_rebellion && !isRebellionON())
		{
			return false;
		}
		return true;
	}

	private static bool isDiplomacyON()
	{
		return WorldLawLibrary.world_law_diplomacy.isEnabled();
	}

	private static bool isRebellionON()
	{
		return WorldLawLibrary.world_law_rebellions.isEnabled();
	}

	protected override bool isDebugUnlockedAll()
	{
		return DebugConfig.isOn(DebugOption.UnlockAllPlots);
	}

	public override string getLocaleID()
	{
		return "plot_" + id;
	}

	public string getDescriptionID()
	{
		return "plot_" + id + "_info";
	}

	public string getDescriptionID2()
	{
		return "plot_" + id + "_info_base";
	}
}
// --- End of File: PlotAsset.cs ---



// --- Start of File: PlotBanner.cs ---
public class PlotBanner : BannerGeneric<Plot, PlotData>
{
	protected override MetaType meta_type => MetaType.Plot;

	protected override string tooltip_id => "plot";

	protected override TooltipData getTooltipData()
	{
		TooltipData tooltipData = base.getTooltipData();
		tooltipData.plot = meta_object;
		return tooltipData;
	}

	protected override void setupBanner()
	{
		base.setupBanner();
		PlotAsset asset = meta_object.getAsset();
		string pPath = "plots/backgrounds/plot_background_0";
		string path_icon = asset.path_icon;
		part_background.sprite = SpriteTextureLoader.getSprite(pPath);
		part_icon.sprite = SpriteTextureLoader.getSprite(path_icon);
	}
}
// --- End of File: PlotBanner.cs ---



// --- Start of File: PlotButton.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PlotButton : AugmentationButton<PlotAsset>
{
	protected override string tooltip_type => "plot_in_editor";

	public override void load(PlotAsset pElement)
	{
		create();
		augmentation_asset = pElement;
		image.sprite = augmentation_asset.getSprite();
		((Object)((Component)this).gameObject).name = getElementType() + "_" + augmentation_asset.id;
		loadLegendaryOutline();
	}

	protected override void Update()
	{
		if (!is_editor_button)
		{
			if (augmentation_asset.unlocked_with_achievement)
			{
				((Component)locked_bg).gameObject.SetActive(false);
				return;
			}
			bool active = !augmentation_asset.isAvailable();
			((Component)locked_bg).gameObject.SetActive(active);
		}
	}

	public override void updateIconColor(bool pSelected)
	{
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		if (!is_editor_button)
		{
			return;
		}
		if (!getElementAsset().isAvailable())
		{
			((Graphic)image).color = Toolbox.color_black;
			return;
		}
		if (pSelected)
		{
			((Graphic)image).color = Toolbox.color_augmentation_selected;
			return;
		}
		Actor unit = SelectedUnit.unit;
		if (augmentation_asset.canBeDoneByRole(unit))
		{
			if (augmentation_asset.check_can_be_forced != null && !augmentation_asset.check_can_be_forced(SelectedUnit.unit))
			{
				((Graphic)image).color = Toolbox.color_gray;
			}
			else
			{
				((Graphic)image).color = Toolbox.color_white;
			}
		}
		else
		{
			((Graphic)image).color = Toolbox.color_gray;
		}
	}

	protected override bool unlockElement()
	{
		return augmentation_asset.unlock();
	}

	protected override void startSignal()
	{
		AchievementLibrary.plots_explorer.checkBySignal();
	}

	protected override void fillTooltipData(PlotAsset pElement)
	{
		Tooltip.show(this, tooltip_type, tooltipDataBuilder());
	}

	protected override TooltipData tooltipDataBuilder()
	{
		return new TooltipData
		{
			plot_asset = augmentation_asset
		};
	}

	protected override string getElementType()
	{
		return "plot";
	}

	public override string getElementId()
	{
		return augmentation_asset.id;
	}

	protected override Rarity getRarity()
	{
		return augmentation_asset.rarity;
	}
}
// --- End of File: PlotButton.cs ---



// --- Start of File: PlotCategoryAsset.cs ---
using System;

[Serializable]
public class PlotCategoryAsset : BaseCategoryAsset
{
	public PlotRetryAction plot_retry_action;
}
// --- End of File: PlotCategoryAsset.cs ---



// --- Start of File: PlotCategoryLibrary.cs ---
public class PlotCategoryLibrary : BaseCategoryLibrary<PlotCategoryAsset>
{
	public override void init()
	{
		base.init();
		add(new PlotCategoryAsset
		{
			id = "diplomacy",
			name = "plot_group_diplomacy",
			color = "#5EFFFF",
			show_counter = false,
			plot_retry_action = diplomacyRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "rites_wrathful",
			name = "plot_group_rites_wrathful",
			color = "#FF6145",
			show_counter = false,
			plot_retry_action = ritesRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "rites_summoning",
			name = "plot_group_rites_summoning",
			color = "#BC42FF",
			show_counter = false,
			plot_retry_action = ritesRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "rites_merciful",
			name = "plot_group_rites_merciful",
			color = "#89FF56",
			show_counter = false,
			plot_retry_action = ritesRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "culture",
			name = "plot_group_culture",
			color = "#FFDA23",
			show_counter = false,
			plot_retry_action = culturePlotsRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "language",
			name = "plot_group_language",
			color = "#A3AFFF",
			show_counter = false,
			plot_retry_action = culturePlotsRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "religion",
			name = "plot_group_religion",
			color = "#BAF0F4",
			show_counter = false,
			plot_retry_action = culturePlotsRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "rites_various",
			name = "plot_group_rites_various",
			color = "#d86569",
			show_counter = false,
			plot_retry_action = ritesRetryAction
		});
		add(new PlotCategoryAsset
		{
			id = "plots_others",
			name = "plot_group_others",
			color = "#D8D8D8",
			show_counter = false,
			plot_retry_action = ritesRetryAction
		});
	}

	public static bool diplomacyRetryAction()
	{
		if (World.world.cities.isLocked())
		{
			return true;
		}
		if (World.world.kingdoms.isLocked())
		{
			return true;
		}
		if (World.world.alliances.isLocked())
		{
			return true;
		}
		if (World.world.wars.isLocked())
		{
			return true;
		}
		if (World.world.clans.isLocked())
		{
			return true;
		}
		return false;
	}

	public static bool ritesRetryAction()
	{
		if (World.world.cities.isLocked())
		{
			return true;
		}
		if (World.world.kingdoms.isLocked())
		{
			return true;
		}
		if (World.world.clans.isLocked())
		{
			return true;
		}
		if (World.world.religions.isLocked())
		{
			return true;
		}
		if (World.world.subspecies.isLocked())
		{
			return true;
		}
		return false;
	}

	public static bool culturePlotsRetryAction()
	{
		if (World.world.cultures.isLocked())
		{
			return true;
		}
		if (World.world.religions.isLocked())
		{
			return true;
		}
		if (World.world.languages.isLocked())
		{
			return true;
		}
		return false;
	}
}
// --- End of File: PlotCategoryLibrary.cs ---



// --- Start of File: PlotCheckerDelegate.cs ---
public delegate bool PlotCheckerDelegate(Actor pActor);
// --- End of File: PlotCheckerDelegate.cs ---



// --- Start of File: PlotData.cs ---
using System.ComponentModel;

public class PlotData : MetaObjectData
{
	public string plot_type_id;

	public string founder_name;

	[DefaultValue(-1L)]
	public long founder_id = -1L;

	[DefaultValue(-1L)]
	public long id_initiator_actor = -1L;

	[DefaultValue(-1L)]
	public long id_initiator_city = -1L;

	[DefaultValue(-1L)]
	public long id_initiator_kingdom = -1L;

	[DefaultValue(-1L)]
	public long id_target_actor = -1L;

	[DefaultValue(-1L)]
	public long id_target_city = -1L;

	[DefaultValue(-1L)]
	public long id_target_kingdom = -1L;

	[DefaultValue(-1L)]
	public long id_target_alliance = -1L;

	[DefaultValue(-1L)]
	public long id_target_war = -1L;

	public bool forced;

	public float progress_current;

	public override void Dispose()
	{
		base.Dispose();
	}
}
// --- End of File: PlotData.cs ---



// --- Start of File: PlotDescription.cs ---
public delegate string PlotDescription(Plot pPlot);
// --- End of File: PlotDescription.cs ---



// --- Start of File: PlotEditorButton.cs ---
public class PlotEditorButton : AugmentationEditorButton<PlotButton, PlotAsset>
{
}
// --- End of File: PlotEditorButton.cs ---



// --- Start of File: PlotElement.cs ---
public class PlotElement : WindowMetaElement<Plot, PlotData>
{
	protected Plot plot => meta_object;
}
// --- End of File: PlotElement.cs ---



// --- Start of File: PlotGroupElement.cs ---
public class PlotGroupElement : AugmentationCategory<PlotAsset, PlotButton, PlotEditorButton>
{
	protected override bool isUnlocked(PlotButton pButton)
	{
		if (pButton.getElementAsset().isAvailable())
		{
			return true;
		}
		return false;
	}
}
// --- End of File: PlotGroupElement.cs ---



// --- Start of File: PlotIconData.cs ---
public struct PlotIconData
{
	public Actor actor;

	public string sprite;

	public double timestamp;
}
// --- End of File: PlotIconData.cs ---



// --- Start of File: PlotListComponent.cs ---
public class PlotListComponent : ComponentListBase<PlotListElement, Plot, PlotData, PlotListComponent>
{
	protected override MetaType meta_type => MetaType.Plot;

	protected override void setupSortingTabs()
	{
		sorting_tab.tryAddButton("ui/Icons/iconAge", "sort_by_age", show, delegate
		{
			current_sort = sortByAge;
		});
		sorting_tab.tryAddButton("ui/Icons/iconPopulation", "sort_by_members", show, delegate
		{
			current_sort = sortBySupporters;
		});
	}

	public static int sortByAge(Plot pPlot1, Plot pPlot2)
	{
		return -pPlot2.data.created_time.CompareTo(pPlot1.data.created_time);
	}

	public static int sortBySupporters(Plot pPlot1, Plot pPlot2)
	{
		return pPlot2.units.Count.CompareTo(pPlot1.units.Count);
	}
}
// --- End of File: PlotListComponent.cs ---



// --- Start of File: PlotListElement.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PlotListElement : WindowListElementBase<Plot, PlotData>
{
	[SerializeField]
	private Text _text_name;

	[SerializeField]
	private CountUpOnClick _members;

	[SerializeField]
	private CountUpOnClick _age;

	[SerializeField]
	private CountUpOnClick _progress;

	[SerializeField]
	private UiUnitAvatarElement _avatar_loader;

	[SerializeField]
	private StatBar _bar;

	[SerializeField]
	private GameObject _locked_effect;

	internal override void show(Plot pPlot)
	{
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		base.show(pPlot);
		Actor author = pPlot.getAuthor();
		_avatar_loader.show(author);
		ColorAsset colorAsset = null;
		if (author != null)
		{
			colorAsset = author.kingdom.getColor();
		}
		if (colorAsset != null)
		{
			((Graphic)_text_name).color = author.kingdom.getColor().getColorText();
		}
		else
		{
			((Graphic)_text_name).color = Toolbox.color_white;
		}
		_text_name.text = pPlot.data.name;
		_members.setValue(pPlot.getSupporters());
		_progress.setValue((int)pPlot.getProgress(), "/" + pPlot.getProgressMax().ToText());
		float progress = pPlot.getProgress();
		float progressMax = pPlot.getProgressMax();
		_bar.setBar(progress, progressMax, "/" + progressMax.ToText(), pReset: true, pFloat: true);
		_age.setValue(pPlot.getAge());
		if (pPlot.getAsset().isAvailable())
		{
			_locked_effect.gameObject.SetActive(false);
		}
		else
		{
			_locked_effect.gameObject.SetActive(true);
		}
	}

	protected override void tooltipAction()
	{
		Tooltip.show(this, "plot", new TooltipData
		{
			plot = meta_object
		});
	}
}
// --- End of File: PlotListElement.cs ---



// --- Start of File: PlotManager.cs ---
using System.Collections.Generic;

public class PlotManager : MetaSystemManager<Plot, PlotData>
{
	public PlotManager()
	{
		type_id = "plot";
	}

	public override Plot loadObject(PlotData pData)
	{
		if (AssetManager.plots_library.get(pData.plot_type_id) == null)
		{
			return null;
		}
		return base.loadObject(pData);
	}

	public override void startCollectHistoryData()
	{
	}

	public override void clearLastYearStats()
	{
	}

	public void cancelPlot(Plot pPlot)
	{
		pPlot.finishPlot(PlotState.Cancelled, null);
	}

	public bool tryStartPlot(Actor pActor, PlotAsset pPlotAsset, bool pForced = true)
	{
		if (pPlotAsset.try_to_start_advanced != null)
		{
			return pPlotAsset.try_to_start_advanced(pActor, pPlotAsset, pForced);
		}
		World.world.plots.newPlot(pActor, pPlotAsset, pForced);
		return true;
	}

	public Plot newPlot(Actor pAuthor, PlotAsset pAsset, bool pForced)
	{
		World.world.game_stats.data.plotsStarted++;
		World.world.map_stats.plotsStarted++;
		Plot plot = newObject();
		plot.newPlot(pAuthor, pAsset, pForced);
		plot.data.founder_name = pAuthor.getName();
		if (!pForced)
		{
			pAuthor.spendMoney(pAsset.money_cost);
		}
		return plot;
	}

	public override void update(float pElapsed)
	{
		base.update(pElapsed);
		updateProgress(pElapsed);
		updateAnimations(pElapsed);
		checkForgottenPlots();
	}

	private void updateProgress(float pElapsed)
	{
		if (World.world.isPaused())
		{
			return;
		}
		using IEnumerator<Plot> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.updateProgress(pElapsed);
		}
	}

	private void updateAnimations(float pElapsed)
	{
		using IEnumerator<Plot> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			enumerator.Current.updateAnimations(pElapsed);
		}
	}

	private void checkForgottenPlots()
	{
		using IEnumerator<Plot> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			Plot current = enumerator.Current;
			if (current.last_update_progress != 0.0 && current.isActive() && (World.world.getWorldTimeElapsedSince(current.last_update_progress) > SimGlobals.m.forgotten_plot_time || current.isAuthorDead()))
			{
				cancelPlot(current);
			}
		}
	}

	public override void removeObject(Plot pPlot)
	{
		base.removeObject(pPlot);
	}

	protected override void updateDirtyUnits()
	{
		List<Actor> units_only_alive = World.world.units.units_only_alive;
		for (int i = 0; i < units_only_alive.Count; i++)
		{
			Actor actor = units_only_alive[i];
			Plot plot = actor.plot;
			if (plot != null && plot.isDirtyUnits())
			{
				plot.listUnit(actor);
			}
		}
		using IEnumerator<Plot> enumerator = GetEnumerator();
		while (enumerator.MoveNext())
		{
			Plot current = enumerator.Current;
			if (current.isActive() && current.isDirtyUnits() && current.units.Count == 0)
			{
				cancelPlot(current);
			}
		}
	}

	public bool isPlotTypeAlreadyRunning(Actor pActor, PlotAsset pPlotAsset)
	{
		using (IEnumerator<Plot> enumerator = GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				Plot current = enumerator.Current;
				if (current.isActive() && current.isSameType(pPlotAsset))
				{
					return true;
				}
			}
		}
		return false;
	}
}
// --- End of File: PlotManager.cs ---



// --- Start of File: PlotMembers.cs ---
using System.Collections;
using UnityEngine;

public class PlotMembers : PlotElement
{
	[SerializeField]
	private UiUnitAvatarElement _prefab_avatar;

	[SerializeField]
	private Transform _transform_members;

	private ObjectPoolGenericMono<UiUnitAvatarElement> _pool_members;

	protected override void Awake()
	{
		_pool_members = new ObjectPoolGenericMono<UiUnitAvatarElement>(_prefab_avatar, _transform_members);
		base.Awake();
	}

	protected override IEnumerator showContent()
	{
		using ListPool<Actor> tPlotMembers = new ListPool<Actor>(base.plot.units.Count);
		foreach (Actor unit in base.plot.units)
		{
			if (unit.isRekt())
			{
				Debug.LogError((object)"dead actor inside plot found");
			}
			else
			{
				tPlotMembers.Add(unit);
			}
		}
		if (tPlotMembers.Count == 0)
		{
			yield break;
		}
		track_objects.AddRange(tPlotMembers);
		tPlotMembers.Sort(ListSorters.sortUnitByAgeOldFirst);
		foreach (ref Actor item in tPlotMembers)
		{
			Actor current2 = item;
			yield return showMember(current2);
		}
	}

	private IEnumerator showMember(Actor pActor)
	{
		if (pActor != null)
		{
			yield return (object)new WaitForSecondsRealtime(0.025f);
			UiUnitAvatarElement next = _pool_members.getNext();
			((Component)next).transform.localScale = new Vector3(0.6f, 0.6f, 1f);
			next.show(pActor);
		}
	}

	protected override void clear()
	{
		_pool_members.clear();
		base.clear();
	}
}
// --- End of File: PlotMembers.cs ---



// --- Start of File: PlotRetryAction.cs ---
public delegate bool PlotRetryAction();
// --- End of File: PlotRetryAction.cs ---



// --- Start of File: PlotsEditor.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;

public class PlotsEditor : AugmentationsEditor<PlotAsset, PlotButton, PlotEditorButton, PlotCategoryAsset, PlotGroupElement, IPlotsWindow, IPlotsEditor>, IPlotsEditor, IAugmentationsEditor
{
	protected override List<PlotCategoryAsset> augmentation_groups_list => AssetManager.plot_category_library.list;

	protected override PlotAsset edited_marker_augmentation => null;

	protected override List<PlotAsset> all_augmentations_list => AssetManager.plots_library.list;

	protected override void metaAugmentationClick(PlotEditorButton pButton)
	{
		if (isAugmentationAvailable(pButton.augmentation_button))
		{
			PlotButton augmentation_button = pButton.augmentation_button;
			bool num = hasAugmentation(augmentation_button);
			if (getCurrentActor().hasPlot())
			{
				removeAugmentation(augmentation_button);
			}
			if (!num)
			{
				addAugmentation(augmentation_button);
			}
			base.metaAugmentationClick(pButton);
		}
	}

	protected override void createButton(PlotAsset pElement, PlotGroupElement pGroup)
	{
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Expected O, but got Unknown
		if (pElement.show_in_meta_editor)
		{
			PlotEditorButton tEditorButton = Object.Instantiate<PlotEditorButton>(prefab_editor_augmentation, pGroup.augmentation_buttons_transform);
			tEditorButton.augmentation_button.is_editor_button = true;
			tEditorButton.augmentation_button.load(pElement);
			all_augmentation_buttons.Add(tEditorButton);
			pGroup.augmentation_buttons.Add(tEditorButton);
			((UnityEventBase)tEditorButton.augmentation_button.button.onClick).RemoveAllListeners();
			((UnityEvent)tEditorButton.augmentation_button.button.onClick).AddListener((UnityAction)delegate
			{
				editorButtonClick(tEditorButton);
			});
			((Component)tEditorButton).gameObject.SetActive(true);
		}
	}

	protected override bool hasAugmentation(PlotButton pButton)
	{
		Actor currentActor = getCurrentActor();
		if (!currentActor.hasPlot())
		{
			return false;
		}
		if (currentActor.plot.getAsset().id != pButton.getElementId())
		{
			return false;
		}
		return true;
	}

	protected override bool addAugmentation(PlotButton pButton)
	{
		Actor currentActor = getCurrentActor();
		currentActor.addStatusEffect("voices_in_my_head");
		if (currentActor.hasPlot())
		{
			World.world.plots.cancelPlot(currentActor.plot);
			currentActor.plot = null;
		}
		PlotAsset elementAsset = pButton.getElementAsset();
		if (!elementAsset.canBeDoneByRole(currentActor))
		{
			WorldTip.showNowTop("plot_force_not_possible");
			return false;
		}
		if (elementAsset.check_can_be_forced != null && !elementAsset.check_can_be_forced(currentActor))
		{
			WorldTip.showNowTop("plot_force_bad_conditions");
			return false;
		}
		if (!World.world.plots.tryStartPlot(currentActor, elementAsset))
		{
			WorldTip.showNowTop("plot_force_failed");
			return false;
		}
		WorldTip.showNowTop("plot_force_started");
		currentActor.cancelAllBeh();
		currentActor.setTask("check_plot");
		return true;
	}

	protected override bool removeAugmentation(PlotButton pButton)
	{
		getCurrentActor().setPlot(null);
		return true;
	}

	protected override void showActiveButtons()
	{
	}

	protected override void startSignal()
	{
		AchievementLibrary.plots_explorer.checkBySignal();
	}

	protected override bool isAugmentationExists(string pId)
	{
		return AssetManager.plots_library.has(pId);
	}

	private Actor getCurrentActor()
	{
		return SelectedUnit.unit;
	}
}
// --- End of File: PlotsEditor.cs ---



// --- Start of File: PlotsLibrary.cs ---
using System;
using System.Collections.Generic;
using UnityEngine;

public class PlotsLibrary : BaseLibraryWithUnlockables<PlotAsset>
{
	public static PlotAsset rebellion;

	public static PlotAsset new_war;

	public static PlotAsset alliance_create;

	[NonSerialized]
	public readonly List<PlotAsset> basic_plots = new List<PlotAsset>();

	private static bool tryStartReligionRiteOnEnemyCity(Actor pActor, PlotAsset pPlotAsset, bool pForced)
	{
		using ListPool<Kingdom> listPool = pActor.kingdom.getEnemiesKingdoms();
		if (listPool.Count == 0)
		{
			return false;
		}
		Kingdom random = listPool.GetRandom();
		if (!random.hasCities())
		{
			return false;
		}
		World.world.plots.newPlot(pActor, pPlotAsset, pForced).target_city = random.getCities().GetRandom();
		return true;
	}

	private static bool tryStartCauseRebellion(Actor pActor, PlotAsset pPlotAsset, bool pForced)
	{
		using ListPool<Kingdom> listPool = pActor.kingdom.getEnemiesKingdoms();
		if (listPool.Count == 0)
		{
			return false;
		}
		Kingdom random = listPool.GetRandom();
		if (!random.hasCities())
		{
			return false;
		}
		using ListPool<City> listPool2 = new ListPool<City>();
		foreach (City city in random.getCities())
		{
			if (!city.isCapitalCity())
			{
				listPool2.Add(city);
			}
		}
		if (listPool2.Count == 0)
		{
			return false;
		}
		World.world.plots.newPlot(pActor, pPlotAsset, pForced).target_city = listPool2.GetRandom();
		return true;
	}

	private static bool tryStartReligionRiteOnSelfCity(Actor pActor, PlotAsset pPlotAsset, bool pForced)
	{
		World.world.plots.newPlot(pActor, pPlotAsset, pForced).target_city = pActor.city;
		return true;
	}

	private static bool tryStartReligionRiteOnSelfKingdom(Actor pActor, PlotAsset pPlotAsset, bool pForced)
	{
		World.world.plots.newPlot(pActor, pPlotAsset, pForced).target_kingdom = pActor.kingdom;
		return true;
	}

	private static bool checkShouldContinueReligionRiteOnEnemyCity(Actor pActor)
	{
		if (!pActor.hasKingdom())
		{
			return false;
		}
		if (!pActor.hasReligion())
		{
			return false;
		}
		if (!pActor.kingdom.hasEnemies())
		{
			return false;
		}
		City target_city = pActor.plot.target_city;
		if (target_city == null)
		{
			return false;
		}
		if (!target_city.isAlive())
		{
			return false;
		}
		if (!target_city.hasKingdom())
		{
			return false;
		}
		if (!target_city.kingdom.isEnemy(pActor.kingdom))
		{
			return false;
		}
		return true;
	}

	private static bool summonCloudAction(Actor pActor, string pCloud, int pMin, int pMax, float pLifespanMin, float pLifespanMax)
	{
		City target_city = pActor.plot.target_city;
		int num = MapBox.width;
		int num2 = MapBox.height;
		int num3 = 0;
		foreach (TileZone zone in target_city.zones)
		{
			if (zone.centerTile.x < num)
			{
				num = zone.centerTile.x;
			}
			if (zone.centerTile.y < num2)
			{
				num2 = zone.centerTile.y;
			}
			if (zone.centerTile.y > num3)
			{
				num3 = zone.centerTile.y;
			}
		}
		int num4 = Randy.randomInt(pMin, pMax + 1);
		int num5 = (num3 - num2) / num4;
		for (int i = 0; i < num4; i++)
		{
			int num6 = Randy.randomInt(-7, 8);
			int pX = Mathf.Clamp(num + num6, 0, MapBox.width - 1);
			int pY = num2 + num5 * i;
			WorldTile tileSimple = MapBox.instance.GetTileSimple(pX, pY);
			((Cloud)EffectsLibrary.spawn("fx_cloud", tileSimple, pCloud)).setLifespan(Randy.randomFloat(pLifespanMin, pLifespanMax));
		}
		return true;
	}

	private static bool summonUnitsAction(Actor pActor, string pActorAssetId, int pMin, int pMax, bool pJoinCasters)
	{
		City target_city = pActor.plot.target_city;
		if (target_city == null)
		{
			return false;
		}
		int num = Randy.randomInt(pMin, pMax + 1);
		for (int i = 0; i < num; i++)
		{
			WorldTile randomTile = target_city.zones.GetRandom().getRandomTile();
			Actor actor = World.world.units.createNewUnit(pActorAssetId, randomTile, pMiracleSpawn: false, 0f, null, null, pSpawnWithItems: true, pAdultAge: true, pGiveOwnerlessItems: false, pJoinCasters);
			EffectsLibrary.spawn("fx_spawn", randomTile);
			if (pJoinCasters && actor != null && pActor.isKingdomCiv())
			{
				if (actor.subspecies.isJustCreated())
				{
					actor.subspecies.addTrait("prefrontal_cortex");
				}
				actor.joinKingdom(pActor.kingdom);
			}
		}
		return true;
	}

	private static bool afterRiteWorldTransform(Actor pActor)
	{
		if (WorldLawLibrary.world_law_gaias_covenant.isEnabled())
		{
			return false;
		}
		Religion religion = pActor.religion;
		if (religion == null)
		{
			return false;
		}
		using ListPool<ReligionTrait> listPool = new ListPool<ReligionTrait>();
		foreach (ReligionTrait trait in religion.getTraits())
		{
			if (!(trait.group_id != "transformation"))
			{
				listPool.Add(trait);
			}
		}
		if (listPool.Count == 0)
		{
			return false;
		}
		ReligionTrait random = listPool.GetRandom();
		TileTypeBase tileHigh = AssetManager.biome_library.get(random.transformation_biome_id).getTileHigh();
		WorldTile randomTile = World.world.islands_calculator.getRandomIslandGround().getRandomTile();
		WorldBehaviourActionBiomes.trySpreadBiomeAround(randomTile, tileHigh);
		BrushData brushData = Brush.get(2, "special_");
		int num = brushData.pos.Length;
		int num2 = Randy.randomInt((int)((float)num * 0.25f), (int)((float)num * 0.5f));
		using ListPool<BrushPixelData> listPool2 = new ListPool<BrushPixelData>(brushData.pos);
		for (int i = 0; i < num2; i++)
		{
			BrushPixelData random2 = listPool2.GetRandom();
			listPool2.Remove(random2);
			WorldTile tile = MapBox.instance.GetTile(randomTile.x + random2.x, randomTile.y + random2.y);
			if (tile != null)
			{
				WorldBehaviourActionBiomes.trySpreadBiomeAround(tile, tileHigh, pCheckRoad: false, pCheckBonuses: false, pForce: true);
			}
		}
		return true;
	}

	public override void init()
	{
		Debug.Log((object)"Init PlotLibrary");
		base.init();
		addBasic();
		addBasicMetas();
		addMagicRites();
	}

	public override void linkAssets()
	{
		base.linkAssets();
		foreach (PlotAsset item in list)
		{
			if (item.is_basic_plot)
			{
				basic_plots.Add(item);
			}
		}
	}

	public override PlotAsset add(PlotAsset pAsset)
	{
		base.add(pAsset);
		pAsset.get_formatted_description = getDescriptionGeneric;
		return pAsset;
	}

	public override void editorDiagnosticLocales()
	{
		foreach (PlotAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
			checkLocale(item, item.getDescriptionID2());
		}
		base.editorDiagnosticLocales();
	}

	private static string getDescriptionGeneric(Plot pPlot)
	{
		string pString = pPlot.getAsset().getDescriptionID().Localize();
		Actor author = pPlot.getAuthor();
		return tryToReplace(tryToReplace(tryToReplace(tryToReplace(tryToReplace(tryToReplace(pString, "$initiator_actor$", author?.name), "$initiator_kingdom$", author?.kingdom?.name), "$initiator_city$", author?.city?.name), "$target_kingdom$", pPlot.target_kingdom?.name), "$target_alliance$", pPlot.target_alliance?.name), "$target_war$", pPlot.target_war?.name);
	}

	private static string tryToReplace(string pString, string pReplaceID, string pName)
	{
		if (pString.Contains(pReplaceID))
		{
			pString = pString.Replace(pReplaceID, pName);
		}
		return pString;
	}

	public void addBasic()
	{
		PlotAsset obj = new PlotAsset
		{
			id = "rebellion",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_rebellion",
			group_id = "diplomacy",
			min_level = 2,
			money_cost = 15,
			min_stewardship = 6,
			min_warfare = 5,
			can_be_done_by_leader = true,
			check_target_kingdom = true,
			requires_diplomacy = true,
			requires_rebellion = true,
			check_is_possible = delegate(Actor pActor)
			{
				Kingdom kingdom13 = pActor.kingdom;
				if (pActor.isKing())
				{
					return false;
				}
				if (kingdom13.countCities() == 1)
				{
					return false;
				}
				if (!kingdom13.hasCapital())
				{
					return false;
				}
				if (kingdom13.getAge() <= SimGlobals.m.rebellions_min_age)
				{
					return false;
				}
				if (pActor.hasTrait("pacifist"))
				{
					return false;
				}
				City city = pActor.city;
				if (city.isCapitalCity())
				{
					return false;
				}
				if (city.isHappy())
				{
					return false;
				}
				float num5 = city.countWarriors();
				float num6 = kingdom13.capital.countWarriors();
				if (num5 < (float)SimGlobals.m.rebellions_min_warriors)
				{
					return false;
				}
				float num7 = (float)kingdom13.countUnhappyCities() * SimGlobals.m.rebellions_unhappy_multiplier;
				float num8 = num6 - num6 * num7;
				if (!(num5 >= num8))
				{
					return false;
				}
				foreach (War war2 in kingdom13.getWars())
				{
					if (war2.getAsset() == WarTypeLibrary.rebellion && war2.isMainDefender(kingdom13))
					{
						return false;
					}
				}
				int num9 = kingdom13.countCities();
				if (num9 <= 6)
				{
					int maxCities = kingdom13.getMaxCities();
					if (num9 <= maxCities)
					{
						return false;
					}
				}
				foreach (Plot plot12 in World.world.plots)
				{
					if (plot12.isActive() && plot12.isSameType(rebellion) && plot12.target_kingdom == kingdom13)
					{
						return false;
					}
				}
				return true;
			},
			try_to_start_advanced = delegate(Actor pActor, PlotAsset pPlotAsset, bool pForced)
			{
				Plot plot11 = World.world.plots.newPlot(pActor, pPlotAsset, pForced);
				plot11.target_kingdom = pActor.kingdom;
				if (!plot11.checkInitiatorAndTargets())
				{
					Debug.Log((object)"tryPlotRebellion is missing start requirements");
					return true;
				}
				return true;
			},
			check_other_plots = (Actor pActor, Plot pPlot) => (pActor.kingdom == pPlot.target_kingdom) ? true : false,
			check_can_be_forced = delegate(Actor pActor)
			{
				if (pActor.isKing())
				{
					return false;
				}
				Kingdom kingdom12 = pActor.kingdom;
				if (pActor.city.isCapitalCity())
				{
					return false;
				}
				return kingdom12.countCities() != 1;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.isCityLeader())
				{
					return false;
				}
				if (pActor.isKing())
				{
					return false;
				}
				return !pActor.city.isCapitalCity();
			},
			action = delegate(Actor pActor)
			{
				bool pCheckForHappiness = !pActor.plot.data.forced;
				DiplomacyHelpersRebellion.startRebellion(pActor, pActor.plot, pCheckForHappiness);
				return true;
			}
		};
		PlotAsset pAsset = obj;
		t = obj;
		rebellion = add(pAsset);
		add(t = new PlotAsset
		{
			id = "new_war",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_new_war",
			group_id = "diplomacy",
			min_level = 3,
			min_warfare = 6,
			money_cost = 20,
			min_renown_kingdom = 50,
			can_be_done_by_king = true,
			check_target_kingdom = true,
			requires_diplomacy = true,
			check_is_possible = delegate(Actor pActor)
			{
				Kingdom kingdom11 = pActor.kingdom;
				if (!DiplomacyHelpers.isWarNeeded(kingdom11))
				{
					return false;
				}
				if (pActor.hasCulture() && pActor.culture.hasTrait("serenity_now"))
				{
					return false;
				}
				if (pActor.hasTrait("pacifist"))
				{
					return false;
				}
				if (kingdom11.hasAlliance())
				{
					foreach (Kingdom item in kingdom11.getAlliance().kingdoms_hashset)
					{
						if (item != kingdom11 && item.hasKing())
						{
							Actor king = item.king;
							if (king.hasPlot() && king.plot.isSameType(new_war))
							{
								return false;
							}
						}
					}
				}
				return true;
			},
			try_to_start_advanced = delegate(Actor pActor, PlotAsset pPlotAsset, bool pForced)
			{
				Kingdom warTarget = DiplomacyHelpers.getWarTarget(pActor.kingdom);
				if (warTarget == null)
				{
					return false;
				}
				Plot plot10 = World.world.plots.newPlot(pActor, pPlotAsset, pForced);
				plot10.target_kingdom = warTarget;
				if (!plot10.checkInitiatorAndTargets())
				{
					Debug.Log((object)"tryPlotWar is missing start requirements");
					return true;
				}
				return true;
			},
			check_should_continue = delegate(Actor pActor)
			{
				Plot plot9 = pActor.plot;
				if (!plot9.target_kingdom.isAlive())
				{
					return false;
				}
				if (pActor.kingdom.hasAlliance() && pActor.kingdom.getAlliance() == plot9.target_kingdom.getAlliance())
				{
					return false;
				}
				return DiplomacyHelpers.isWarNeeded(pActor.kingdom) ? true : false;
			},
			action = delegate(Actor pActor)
			{
				World.world.diplomacy.startWar(pActor.kingdom, pActor.plot.target_kingdom, WarTypeLibrary.normal);
				return true;
			}
		});
		alliance_create = add(t = new PlotAsset
		{
			id = "alliance_create",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_alliance_create",
			group_id = "diplomacy",
			min_level = 5,
			money_cost = 20,
			min_renown_kingdom = 60,
			can_be_done_by_king = true,
			requires_diplomacy = true,
			check_is_possible = delegate(Actor pActor)
			{
				Kingdom kingdom10 = pActor.kingdom;
				if (kingdom10.hasAlliance())
				{
					return false;
				}
				if (kingdom10.hasEnemies())
				{
					return false;
				}
				if (kingdom10.isSupreme())
				{
					return false;
				}
				if (Date.getYearsSince(kingdom10.data.timestamp_alliance) < SimGlobals.m.alliance_timeout)
				{
					return false;
				}
				return !World.world.plots.isPlotTypeAlreadyRunning(pActor, alliance_create);
			},
			try_to_start_advanced = delegate(Actor pActor, PlotAsset pPlotAsset, bool pForced)
			{
				if (DiplomacyHelpers.getAllianceTarget(pActor.kingdom) == null)
				{
					return false;
				}
				if (!World.world.plots.newPlot(pActor, pPlotAsset, pForced).checkInitiatorAndTargets())
				{
					Debug.Log((object)"tryPlotNewAlliance is missing start requirements");
					return true;
				}
				return true;
			},
			check_other_plots = delegate(Actor pActor, Plot pPlot)
			{
				Kingdom kingdom9 = pActor.kingdom;
				foreach (Actor unit in pPlot.units)
				{
					if (DiplomacyHelpers.areKingdomsClose(unit.kingdom, kingdom9))
					{
						return true;
					}
				}
				return false;
			},
			check_can_be_forced = (Actor pActor) => !pActor.kingdom.hasAlliance(),
			check_should_continue = delegate(Actor pActor)
			{
				foreach (Actor unit2 in pActor.plot.units)
				{
					Kingdom kingdom8 = unit2.kingdom;
					if (!kingdom8.isAlive())
					{
						return false;
					}
					if (kingdom8.hasEnemies())
					{
						return false;
					}
					if (kingdom8 != pActor.kingdom && !kingdom8.isOpinionTowardsKingdomGood(pActor.kingdom))
					{
						return false;
					}
				}
				return true;
			},
			action = delegate(Actor pActor)
			{
				Plot plot8 = pActor.plot;
				Kingdom allianceTarget = DiplomacyHelpers.getAllianceTarget(pActor.kingdom);
				if (allianceTarget == null)
				{
					return false;
				}
				using ListPool<Kingdom> listPool = new ListPool<Kingdom>(World.world.kingdoms.Count);
				listPool.Add(pActor.kingdom);
				listPool.Add(allianceTarget);
				Kingdom kingdom6 = listPool.Shift();
				Kingdom kingdom7 = listPool.Shift();
				if (!kingdom6.isOpinionTowardsKingdomGood(kingdom7))
				{
					return false;
				}
				Alliance alliance4 = World.world.alliances.newAlliance(kingdom6, kingdom7);
				if (kingdom6.hasKing())
				{
					kingdom6.king.leavePlot();
				}
				if (kingdom7.hasKing())
				{
					kingdom7.king.leavePlot();
				}
				foreach (ref Kingdom item2 in listPool)
				{
					Kingdom current5 = item2;
					alliance4.join(current5, pRecalc: false);
				}
				foreach (Actor unit3 in plot8.units)
				{
					unit3.leavePlot();
				}
				alliance4.recalculate();
				return true;
			}
		});
		add(t = new PlotAsset
		{
			id = "alliance_join",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_alliance_create",
			group_id = "diplomacy",
			min_level = 2,
			money_cost = 5,
			min_diplomacy = 5,
			min_renown_kingdom = 50,
			can_be_done_by_king = true,
			check_target_alliance = true,
			requires_diplomacy = true,
			check_is_possible = delegate(Actor pActor)
			{
				Kingdom kingdom5 = pActor.kingdom;
				if (kingdom5.isSupreme())
				{
					return false;
				}
				if (kingdom5.hasAlliance())
				{
					return false;
				}
				if (kingdom5.hasEnemies())
				{
					return false;
				}
				if (Date.getYearsSince(kingdom5.data.timestamp_alliance) < SimGlobals.m.alliance_timeout)
				{
					return false;
				}
				return World.world.alliances.anyAlliances() ? true : false;
			},
			try_to_start_advanced = delegate(Actor pActor, PlotAsset pPlotAsset, bool pForced)
			{
				Kingdom kingdom4 = pActor.kingdom;
				_ = kingdom4.power;
				Alliance alliance3 = null;
				foreach (Alliance item3 in World.world.alliances.list.LoopRandom())
				{
					if (!item3.hasWars())
					{
						if (pForced)
						{
							alliance3 = item3;
							break;
						}
						if (item3.canJoin(kingdom4) && !item3.hasSupremeKingdom())
						{
							_ = item3.power;
							bool flag = false;
							if (kingdom4.countCities() <= 2 && !kingdom4.hasNearbyKingdoms())
							{
								flag = true;
							}
							if (!flag && item3.hasSharedBordersWithKingdom(kingdom4))
							{
								flag = true;
							}
							if (flag)
							{
								alliance3 = item3;
							}
						}
					}
				}
				if (alliance3 == null)
				{
					return false;
				}
				Plot plot7 = World.world.plots.newPlot(pActor, pPlotAsset, pForced);
				plot7.target_alliance = alliance3;
				if (!plot7.checkInitiatorAndTargets())
				{
					Debug.Log((object)"tryPlotJoinAlliance is missing start requirements");
					return true;
				}
				pActor.setPlot(plot7);
				return true;
			},
			check_other_plots = alliance_create.check_other_plots,
			check_can_be_forced = (Actor pActor) => !pActor.kingdom.hasAlliance(),
			check_should_continue = delegate(Actor pActor)
			{
				Plot plot6 = pActor.plot;
				if (pActor.kingdom.hasAlliance())
				{
					return false;
				}
				if (!plot6.target_alliance.isAlive())
				{
					return false;
				}
				if (!plot6.target_alliance.canJoin(pActor.kingdom))
				{
					return false;
				}
				if (pActor.kingdom.hasEnemies())
				{
					return false;
				}
				return !plot6.target_alliance.hasWars();
			},
			action = delegate(Actor pActor)
			{
				Plot plot5 = pActor.plot;
				if (pActor.kingdom.hasAlliance())
				{
					return false;
				}
				if (!plot5.target_alliance.isAlive())
				{
					return false;
				}
				plot5.target_alliance.join(pActor.kingdom);
				if (pActor.kingdom.hasKing())
				{
					pActor.kingdom.king.leavePlot();
				}
				return true;
			}
		});
		add(t = new PlotAsset
		{
			id = "alliance_destroy",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_alliance_destroy",
			group_id = "diplomacy",
			min_level = 5,
			money_cost = 15,
			can_be_done_by_king = true,
			check_target_alliance = true,
			requires_diplomacy = true,
			check_is_possible = delegate(Actor pActor)
			{
				Kingdom kingdom3 = pActor.kingdom;
				if (!kingdom3.hasAlliance())
				{
					return false;
				}
				if (kingdom3.hasEnemies())
				{
					return false;
				}
				Alliance alliance2 = kingdom3.getAlliance();
				if (alliance2.isForcedType())
				{
					return false;
				}
				if ((float)Date.getYearsSince(alliance2.data.timestamp_member_joined) < 10f)
				{
					return false;
				}
				if (!kingdom3.isSupreme() && !kingdom3.isSecondBest())
				{
					return false;
				}
				if (alliance2.getAge() < 10)
				{
					return false;
				}
				float num3 = alliance2.power;
				float num4 = 0f;
				foreach (Kingdom kingdom14 in World.world.kingdoms)
				{
					if (kingdom14.getAlliance() != alliance2)
					{
						num4 += (float)kingdom14.power;
					}
				}
				if (num3 < num4 * 2f)
				{
					return false;
				}
				foreach (Kingdom item4 in alliance2.kingdoms_hashset)
				{
					if (item4.isSupreme())
					{
						return true;
					}
				}
				return false;
			},
			try_to_start_advanced = delegate(Actor pActor, PlotAsset pPlotAsset, bool pForced)
			{
				Kingdom kingdom2 = pActor.kingdom;
				if (!kingdom2.hasAlliance())
				{
					return false;
				}
				Plot plot4 = World.world.plots.newPlot(pActor, pPlotAsset, pForced);
				plot4.target_alliance = kingdom2.getAlliance();
				if (!plot4.checkInitiatorAndTargets())
				{
					Debug.Log((object)"tryPlotDisbandAlliance is missing start requirements");
					return true;
				}
				return true;
			},
			check_should_continue = (Actor pActor) => pActor.kingdom.hasAlliance() ? true : false,
			action = delegate(Actor pActor)
			{
				if (!pActor.kingdom.hasAlliance())
				{
					return false;
				}
				Alliance alliance = pActor.kingdom.getAlliance();
				World.world.alliances.dissolveAlliance(alliance);
				return true;
			}
		});
		t.check_can_be_forced = t.check_should_continue;
		add(t = new PlotAsset
		{
			id = "attacker_stop_war",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_stop_war",
			group_id = "diplomacy",
			min_level = 4,
			money_cost = 20,
			min_diplomacy = 8,
			can_be_done_by_king = true,
			check_target_war = true,
			requires_diplomacy = true,
			check_is_possible = (Actor pActor) => pActor.kingdom.hasEnemies() ? true : false,
			try_to_start_advanced = delegate(Actor pActor, PlotAsset pPlotAsset, bool pForced)
			{
				Kingdom kingdom = pActor.kingdom;
				War war = null;
				foreach (War war3 in kingdom.getWars(pRandom: true))
				{
					if (war3.getAge() > SimGlobals.m.minimum_age_before_war_stop && war3.getAsset().can_end_with_plot && war3.isAttacker(kingdom))
					{
						int num = war3.countAttackersWarriors();
						int num2 = war3.countDefendersWarriors();
						if (!war3.areDefendersGettingCaptured() && !war3.areAttackersAttackingAnotherCity() && !war3.areAttackersGettingCaptured() && !war3.areDefendersAttackingAnotherCity() && (num <= 100 || num2 <= 100))
						{
							if (war3.isAttacker(kingdom))
							{
								if (num < num2 * 2)
								{
									continue;
								}
							}
							else if (num2 < num * 2)
							{
								continue;
							}
							war = war3;
							break;
						}
					}
				}
				if (war == null)
				{
					return false;
				}
				foreach (Plot plot13 in World.world.plots)
				{
					if (plot13.isActive() && plot13.isSameType(pPlotAsset) && plot13.target_war == war)
					{
						pActor.setPlot(plot13);
						return true;
					}
				}
				Plot plot3 = World.world.plots.newPlot(pActor, pPlotAsset, pForced);
				plot3.target_war = war;
				if (!plot3.checkInitiatorAndTargets())
				{
					Debug.Log((object)"tryPlotStopWar is missing start requirements");
					return true;
				}
				return true;
			},
			check_can_be_forced = (Actor pActor) => pActor.kingdom.hasEnemies() ? true : false,
			check_should_continue = delegate(Actor pActor)
			{
				Plot plot2 = pActor.plot;
				War target_war = plot2.target_war;
				if (target_war == null || target_war.isRekt())
				{
					return false;
				}
				return !plot2.target_war.hasEnded();
			},
			action = delegate(Actor pActor)
			{
				Plot plot = pActor.plot;
				if (plot.target_war.hasEnded())
				{
					return false;
				}
				World.world.wars.endWar(plot.target_war, WarWinner.Peace);
				return true;
			}
		});
		add(t = new PlotAsset
		{
			id = "new_book",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_new_book",
			group_id = "plots_others",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			can_be_done_by_clan_member = true,
			progress_needed = 200f,
			min_level = 10,
			money_cost = 200,
			min_intelligence = 3,
			pot_rate = 5,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.hasCulture())
				{
					return false;
				}
				if (!pActor.hasLanguage())
				{
					return false;
				}
				return pActor.city.hasBookSlots() ? true : false;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.hasCulture())
				{
					return false;
				}
				if (!pActor.hasLanguage())
				{
					return false;
				}
				return pActor.city.hasBookSlots() ? true : false;
			},
			action = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.city.hasBookSlots())
				{
					return false;
				}
				World.world.books.generateNewBook(pActor);
				return true;
			}
		});
		t.check_can_be_forced = t.check_is_possible;
	}

	public void addBasicMetas()
	{
		PlotAsset obj = new PlotAsset
		{
			id = "new_language",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_new_language",
			group_id = "language",
			priority = 99,
			min_level = 1,
			money_cost = 0,
			min_intelligence = 3,
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_is_possible = delegate(Actor pActor)
			{
				if (pActor.hasLanguage())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_communication ? true : false;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (pActor.hasLanguage())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_communication ? true : false;
			},
			action = delegate(Actor pActor)
			{
				Language language4 = World.world.languages.newLanguage(pActor, pAddDefaultTraits: true);
				pActor.joinLanguage(language4);
				language4.forceConvertSameSpeciesAroundUnit(pActor);
				return true;
			}
		};
		PlotAsset pAsset = obj;
		t = obj;
		add(pAsset);
		t.check_can_be_forced = (Actor pActor) => pActor.subspecies.has_advanced_communication ? true : false;
		add(t = new PlotAsset
		{
			id = "new_religion",
			path_icon = "plots/icons/plot_new_religion",
			group_id = "religion",
			priority = 99,
			min_level = 5,
			money_cost = 25,
			min_intelligence = 8,
			is_basic_plot = true,
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_is_possible = delegate(Actor pActor)
			{
				if (pActor.hasReligion())
				{
					return false;
				}
				if (!pActor.hasCulture())
				{
					return false;
				}
				if (!pActor.hasLanguage())
				{
					return false;
				}
				if (!pActor.subspecies.has_advanced_memory)
				{
					return false;
				}
				return pActor.culture.countUnits() >= 50;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (pActor.hasReligion())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_memory ? true : false;
			},
			action = delegate(Actor pActor)
			{
				Religion religion4 = World.world.religions.newReligion(pActor, pAddDefaultTraits: true);
				pActor.setReligion(religion4);
				religion4.forceConvertSameSpeciesAroundUnit(pActor);
				return true;
			}
		});
		t.check_can_be_forced = (Actor pActor) => pActor.subspecies.has_advanced_memory ? true : false;
		add(t = new PlotAsset
		{
			id = "new_culture",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_new_culture",
			group_id = "culture",
			priority = 99,
			min_level = 1,
			money_cost = 0,
			min_intelligence = 2,
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_is_possible = delegate(Actor pActor)
			{
				if (pActor.hasCulture())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_memory ? true : false;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (pActor.hasCulture())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_memory ? true : false;
			},
			action = delegate(Actor pActor)
			{
				Culture culture4 = World.world.cultures.newCulture(pActor, pAddDefaultTraits: true);
				pActor.setCulture(culture4);
				culture4.forceConvertSameSpeciesAroundUnit(pActor);
				return true;
			}
		});
		t.check_can_be_forced = (Actor pActor) => pActor.subspecies.has_advanced_memory ? true : false;
		add(t = new PlotAsset
		{
			id = "clan_ascension",
			path_icon = "plots/icons/plot_clan_ascension",
			can_be_done_by_king = true,
			group_id = "rites_various",
			min_level = 7,
			money_cost = 100,
			min_intelligence = 5,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasReligion())
				{
					return false;
				}
				if (!pActor.hasClan())
				{
					return false;
				}
				if (pActor.clan.hasTrait("mark_of_becoming"))
				{
					return false;
				}
				if (!pActor.clan.hasChief())
				{
					return false;
				}
				if (pActor.clan.getChief() != pActor)
				{
					return false;
				}
				if (pActor.kingdom.getPopulationPeople() < 500)
				{
					return false;
				}
				if (!pActor.hasTrait("evil"))
				{
					return false;
				}
				return !pActor.hasSubspeciesTrait("pure");
			},
			check_should_continue = (Actor pActor) => pActor.hasClan() ? true : false,
			action = delegate(Actor pActor)
			{
				Clan clan = pActor.clan;
				if (!ActionLibrary.tryToEvolveUnitViaAscension(pActor, out var pEvolvedActorForm))
				{
					return false;
				}
				clan.addTrait("mark_of_becoming");
				Subspecies subspecies = pEvolvedActorForm.subspecies;
				if (clan != null)
				{
					foreach (Actor unit in clan.units)
					{
						unit.setSubspecies(subspecies);
					}
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = (Actor pActor) => !pActor.hasSubspeciesTrait("pure");
		add(t = new PlotAsset
		{
			id = "culture_divide",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_culture_divide",
			group_id = "culture",
			can_be_done_by_leader = true,
			min_level = 5,
			money_cost = 20,
			min_intelligence = 6,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.hasCulture())
				{
					return false;
				}
				if (!pActor.hasLanguage())
				{
					return false;
				}
				if (pActor.isOneCityKingdom())
				{
					return false;
				}
				Culture culture3 = pActor.culture;
				if (culture3.countUnits() < SimGlobals.m.people_before_meta_divide)
				{
					return false;
				}
				if (culture3.getAge() < SimGlobals.m.years_before_meta_divide)
				{
					return false;
				}
				if (culture3.hasTrait("legacy_keepers"))
				{
					return false;
				}
				if (!pActor.wantsToSplitMeta())
				{
					return false;
				}
				if (culture3 != pActor.kingdom.culture)
				{
					return false;
				}
				if (!pActor.subspecies.has_advanced_memory)
				{
					return false;
				}
				if (culture3.data.creator_kingdom_id == pActor.kingdom.id)
				{
					return false;
				}
				return (culture3.data.creator_clan_id != pActor.clan.id) ? true : false;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (!pActor.hasCulture())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_memory ? true : false;
			},
			action = delegate(Actor pActor)
			{
				Culture culture = pActor.culture;
				Culture culture2 = World.world.cultures.newCulture(pActor, pAddDefaultTraits: false);
				culture2.cloneAndEvolveOnomastics(culture);
				culture2.copyTraits(culture.getTraits());
				pActor.setCulture(culture2);
				culture2.forceConvertSameSpeciesAroundUnit(pActor);
				return true;
			}
		});
		t.check_can_be_forced = delegate(Actor pActor)
		{
			if (!pActor.hasCity())
			{
				return false;
			}
			if (!pActor.hasCulture())
			{
				return false;
			}
			if (!pActor.hasLanguage())
			{
				return false;
			}
			return pActor.subspecies.has_advanced_memory ? true : false;
		};
		add(t = new PlotAsset
		{
			id = "religion_schism",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_religion_schism",
			can_be_done_by_leader = true,
			group_id = "religion",
			min_level = 5,
			money_cost = 15,
			min_intelligence = 6,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.hasCulture())
				{
					return false;
				}
				if (!pActor.hasLanguage())
				{
					return false;
				}
				if (!pActor.hasReligion())
				{
					return false;
				}
				if (pActor.isOneCityKingdom())
				{
					return false;
				}
				if (!pActor.wantsToSplitMeta())
				{
					return false;
				}
				if (pActor.culture.hasTrait("legacy_keepers"))
				{
					return false;
				}
				Religion religion3 = pActor.religion;
				if (religion3.countUnits() < SimGlobals.m.people_before_meta_divide)
				{
					return false;
				}
				if (religion3.getAge() < SimGlobals.m.years_before_meta_divide)
				{
					return false;
				}
				if (religion3 != pActor.kingdom.religion)
				{
					return false;
				}
				if (!pActor.subspecies.has_advanced_memory)
				{
					return false;
				}
				if (religion3.data.creator_kingdom_id == pActor.kingdom.id)
				{
					return false;
				}
				return (religion3.data.creator_clan_id != pActor.clan.id) ? true : false;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (!pActor.hasReligion())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_memory ? true : false;
			},
			action = delegate(Actor pActor)
			{
				Religion religion = pActor.religion;
				Religion religion2 = World.world.religions.newReligion(pActor, pAddDefaultTraits: false);
				religion2.copyTraits(religion.getTraits());
				pActor.setReligion(religion2);
				religion2.forceConvertSameSpeciesAroundUnit(pActor);
				return true;
			}
		});
		t.check_can_be_forced = delegate(Actor pActor)
		{
			if (!pActor.hasCity())
			{
				return false;
			}
			if (!pActor.hasCulture())
			{
				return false;
			}
			if (!pActor.hasLanguage())
			{
				return false;
			}
			if (!pActor.hasReligion())
			{
				return false;
			}
			if (pActor.religion != pActor.kingdom.religion)
			{
				return false;
			}
			return pActor.subspecies.has_advanced_memory ? true : false;
		};
		add(t = new PlotAsset
		{
			id = "language_divergence",
			is_basic_plot = true,
			path_icon = "plots/icons/plot_language_divergence",
			can_be_done_by_leader = true,
			group_id = "language",
			min_level = 5,
			money_cost = 15,
			min_intelligence = 8,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasCity())
				{
					return false;
				}
				if (!pActor.hasCulture())
				{
					return false;
				}
				if (!pActor.hasLanguage())
				{
					return false;
				}
				if (!pActor.hasReligion())
				{
					return false;
				}
				if (pActor.isOneCityKingdom())
				{
					return false;
				}
				if (!pActor.wantsToSplitMeta())
				{
					return false;
				}
				if (pActor.culture.hasTrait("legacy_keepers"))
				{
					return false;
				}
				Language language3 = pActor.language;
				if (language3.countUnits() < SimGlobals.m.people_before_meta_divide)
				{
					return false;
				}
				if (language3.getAge() < SimGlobals.m.years_before_meta_divide)
				{
					return false;
				}
				if (language3 != pActor.kingdom.language)
				{
					return false;
				}
				if (!pActor.subspecies.has_advanced_communication)
				{
					return false;
				}
				if (language3.data.creator_kingdom_id == pActor.kingdom.id)
				{
					return false;
				}
				return (language3.data.creator_clan_id != pActor.clan.id) ? true : false;
			},
			check_should_continue = delegate(Actor pActor)
			{
				if (!pActor.hasLanguage())
				{
					return false;
				}
				return pActor.subspecies.has_advanced_communication ? true : false;
			},
			action = delegate(Actor pActor)
			{
				Language language = pActor.language;
				Language language2 = World.world.languages.newLanguage(pActor, pAddDefaultTraits: false);
				language2.copyTraits(language.getTraits());
				pActor.joinLanguage(language2);
				language2.forceConvertSameSpeciesAroundUnit(pActor);
				return true;
			}
		});
		t.check_can_be_forced = delegate(Actor pActor)
		{
			if (!pActor.hasCity())
			{
				return false;
			}
			if (!pActor.hasCulture())
			{
				return false;
			}
			if (!pActor.hasLanguage())
			{
				return false;
			}
			if (!pActor.hasReligion())
			{
				return false;
			}
			return pActor.subspecies.has_advanced_communication ? true : false;
		};
	}

	public void addMagicRites()
	{
		PlotAsset obj = new PlotAsset
		{
			id = "summon_meteor_rain",
			path_icon = "plots/icons/plot_summon_meteor_rain",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 200f,
			min_level = 13,
			money_cost = 1000,
			check_is_possible = (Actor pActor) => pActor.kingdom.hasEnemies() ? true : false,
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				City target_city4 = pActor.plot.target_city;
				int num2 = 7;
				int num3 = Randy.randomInt(3, num2 + 1);
				for (int j = 0; j < num3; j++)
				{
					Meteorite.spawnMeteoriteDisaster(target_city4.zones.GetRandom().getRandomTile(), pActor);
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		};
		PlotAsset pAsset = obj;
		t = obj;
		add(pAsset);
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_earthquake",
			path_icon = "plots/icons/plot_summon_earthquake",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 200f,
			min_level = 13,
			money_cost = 600,
			pot_rate = 2,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				Earthquake.startQuake(pActor.plot.target_city.zones.GetRandom().getRandomTile(), EarthquakeType.SmallDisaster);
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_thunderstorm",
			path_icon = "plots/icons/plot_summon_thunderstorm",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 200f,
			min_level = 13,
			money_cost = 500,
			pot_rate = 4,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				City target_city3 = pActor.plot.target_city;
				if (!target_city3.hasZones())
				{
					return false;
				}
				WorldTile randomTile = target_city3.zones.GetRandom().getRandomTile();
				MapBox.spawnLightningMedium(randomTile, 0.15f, pActor);
				int num = Randy.randomInt(5, 13);
				for (int i = 0; i < num; i++)
				{
					WorldTile tTargetTileL = Toolbox.getRandomTileWithinDistance(randomTile, 10);
					DelayedActionsManager.addAction(pDelay: Randy.randomFloat(0.1f, 0.75f) * (float)i, pAction: delegate
					{
						MapBox.spawnLightningMedium(tTargetTileL, 0.15f, pActor);
					});
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_stormfront",
			path_icon = "plots/icons/plot_summon_stormfront",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 100f,
			min_level = 13,
			money_cost = 200,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = (Actor pActor) => summonCloudAction(pActor, "cloud_lightning", 5, 15, 20f, 60f),
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_hellstorm",
			path_icon = "plots/icons/plot_summon_hellstorm",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 100f,
			min_level = 13,
			money_cost = 300,
			pot_rate = 4,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = (Actor pActor) => summonCloudAction(pActor, "cloud_fire", 3, 5, 20f, 60f),
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_demons",
			path_icon = "plots/icons/plot_summon_demons",
			group_id = "rites_summoning",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 100f,
			min_level = 13,
			money_cost = 300,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				if (Randy.randomChance(0.0666f))
				{
					pActor.plot.target_city = pActor.city;
				}
				return summonUnitsAction(pActor, "demon", 5, 10, pJoinCasters: false);
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_angles",
			path_icon = "plots/icons/plot_summon_angles",
			group_id = "rites_summoning",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 100f,
			min_level = 12,
			money_cost = 200,
			pot_rate = 2,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = (Actor pActor) => summonUnitsAction(pActor, "angle", 3, 7, pJoinCasters: true),
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_skeletons",
			path_icon = "plots/icons/plot_summon_skeletons",
			group_id = "rites_summoning",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 100f,
			min_level = 13,
			money_cost = 150,
			pot_rate = 2,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = (Actor pActor) => summonUnitsAction(pActor, "skeleton", 6, 13, pJoinCasters: true),
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "summon_living_plants",
			path_icon = "plots/icons/plot_summon_living_plants",
			group_id = "rites_summoning",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 100f,
			min_level = 13,
			money_cost = 400,
			pot_rate = 2,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				if (!pActor.kingdom.hasEnemies())
				{
					return false;
				}
				return AssetManager.actor_library.get("living_plants").units.Count <= 100;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				foreach (WorldTile calculated_farm_field in pActor.plot.target_city.calculated_farm_fields)
				{
					if (calculated_farm_field.hasBuilding())
					{
						ActionLibrary.tryToMakeFloraAlive(calculated_farm_field.building, pFullyGrownOnly: false);
					}
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "big_cast_coffee",
			path_icon = "plots/icons/plot_big_cast_coffee",
			group_id = "rites_merciful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 60f,
			min_level = 9,
			money_cost = 100,
			pot_rate = 2,
			check_is_possible = (Actor pActor) => pActor.hasCity(),
			try_to_start_advanced = tryStartReligionRiteOnSelfCity,
			check_should_continue = (Actor pActor) => pActor.hasCity(),
			action = delegate(Actor pActor)
			{
				foreach (Actor unit in pActor.plot.target_city.getUnits())
				{
					unit.addStatusEffect("caffeinated");
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "big_cast_bubble_shield",
			path_icon = "plots/icons/plot_big_cast_bubble_shield",
			group_id = "rites_merciful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_kingdom = true,
			progress_needed = 50f,
			min_level = 11,
			money_cost = 200,
			pot_rate = 3,
			check_is_possible = (Actor pActor) => pActor.hasKingdom(),
			try_to_start_advanced = tryStartReligionRiteOnSelfKingdom,
			check_should_continue = (Actor pActor) => pActor.hasKingdom(),
			action = delegate(Actor pActor)
			{
				foreach (Actor unit2 in pActor.plot.target_kingdom.getUnits())
				{
					if (unit2.isProfession(UnitProfession.Warrior))
					{
						unit2.addStatusEffect("shield");
					}
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "big_cast_madness",
			path_icon = "plots/icons/plot_big_cast_madness",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			progress_needed = 120f,
			min_level = 11,
			money_cost = 600,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				City target_city2 = pActor.plot.target_city;
				float pVal = 0.8f;
				foreach (Actor unit3 in target_city2.getUnits())
				{
					if (Randy.randomChance(pVal))
					{
						unit3.addTrait("madness");
					}
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "big_cast_slowness",
			path_icon = "plots/icons/plot_big_cast_slowness",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			pot_rate = 3,
			progress_needed = 70f,
			min_level = 11,
			money_cost = 150,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartReligionRiteOnEnemyCity,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				foreach (Actor unit4 in pActor.plot.target_city.getUnits())
				{
					if (unit4.isProfession(UnitProfession.Warrior))
					{
						unit4.addStatusEffect("slowness");
					}
				}
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
		add(t = new PlotAsset
		{
			id = "cause_rebellion",
			path_icon = "plots/icons/plot_cause_rebellion",
			group_id = "rites_wrathful",
			can_be_done_by_king = true,
			can_be_done_by_leader = true,
			check_target_city = true,
			pot_rate = 2,
			progress_needed = 70f,
			min_level = 12,
			money_cost = 400,
			check_is_possible = delegate(Actor pActor)
			{
				if (!pActor.hasKingdom())
				{
					return false;
				}
				return pActor.kingdom.hasEnemies() ? true : false;
			},
			try_to_start_advanced = tryStartCauseRebellion,
			check_should_continue = checkShouldContinueReligionRiteOnEnemyCity,
			action = delegate(Actor pActor)
			{
				City target_city = pActor.plot.target_city;
				if (target_city.isCapitalCity())
				{
					return false;
				}
				if (target_city.units.Count == 0)
				{
					return false;
				}
				Actor random = target_city.getUnits().GetRandom();
				if (!random.isAlive())
				{
					return false;
				}
				DiplomacyHelpersRebellion.startRebellion(random, pActor.plot, pCheckForHappiness: false);
				return true;
			},
			post_action = afterRiteWorldTransform
		});
		t.check_can_be_forced = t.check_is_possible;
	}
}
// --- End of File: PlotsLibrary.cs ---



// --- Start of File: PlotStart.cs ---
public delegate bool PlotStart(Actor pActor, PlotAsset pPlotAsset);
// --- End of File: PlotStart.cs ---



// --- Start of File: PlotState.cs ---
public enum PlotState
{
	Active,
	Finished,
	Cancelled
}
// --- End of File: PlotState.cs ---



// --- Start of File: PlotTryToStart.cs ---
public delegate bool PlotTryToStart(Actor pActor, PlotAsset pPlotAsset, bool pForced);
// --- End of File: PlotTryToStart.cs ---



// --- Start of File: PlotWindow.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PlotWindow : WindowMetaGeneric<Plot, PlotData>
{
	[SerializeField]
	private GameObject content_author;

	[SerializeField]
	private PrefabUnitElement author_element;

	public StatsIcon text_info_age;

	public StatsIcon text_info_members;

	public StatsIcon text_info_power;

	public StatsIcon text_info_dead;

	public Text text_description;

	public StatBar bar;

	public override MetaType meta_type => MetaType.Plot;

	protected override Plot meta_object => SelectedMetas.selected_plot;

	public override void startShowingWindow()
	{
		base.startShowingWindow();
		AchievementLibrary.plots_explorer.check();
	}

	protected override void showTopPartInformation()
	{
		Plot plot = meta_object;
		if (plot != null)
		{
			if (plot.getAsset().needs_to_be_explored)
			{
				plot.getAsset().unlock();
			}
			float progress = plot.getProgress();
			float progressMax = plot.getProgressMax();
			bar.setBar(progress, progressMax, "/" + progressMax.ToText(), pReset: true, pFloat: true);
			text_description.text = plot.getAsset().get_formatted_description(plot);
			((Component)text_description).GetComponent<LocalizedText>().checkTextFont();
			((Component)text_description).GetComponent<LocalizedText>().checkSpecialLanguages();
			showAuthor();
		}
	}

	private void showAuthor()
	{
		Actor author = meta_object.getAuthor();
		if (author.isRekt())
		{
			content_author.SetActive(false);
			return;
		}
		content_author.SetActive(true);
		author_element.show(author);
	}

	internal override void showStatsRows()
	{
		Plot plot = meta_object;
		if (plot != null)
		{
			tryShowPastNames();
			showStatRow("started_by", plot.data.founder_name, MetaType.Unit, plot.data.founder_id);
			showStatRow("started_at", plot.getFoundedDate(), MetaType.None, -1L);
		}
	}
}
// --- End of File: PlotWindow.cs ---



// --- Start of File: Poop.cs ---
using UnityEngine;

public class Poop : BaseBuildingComponent
{
	public override void update(float pElapsed)
	{
		if (Time.frameCount % 30 == 0 && Date.getYearsSince(building.data.created_time) >= 1)
		{
			BuildingActions.tryGrowVegetationRandom(building.current_tile, VegetationType.Plants, pOnStart: false, pCheckLimit: false, pCheckRandom: false);
			building.startDestroyBuilding();
		}
	}
}
// --- End of File: Poop.cs ---



// --- Start of File: PopulationPyramidController.cs ---
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PopulationPyramidController : MonoBehaviour
{
	[SerializeField]
	private MetaType _meta_type = MetaType.Special;

	[SerializeField]
	private Transform _population_pyramid_container;

	[SerializeField]
	private PopulationPyramidRow _population_pyramid_row;

	private Dictionary<int, GenderCount> _age_data = new Dictionary<int, GenderCount>();

	private List<int> _age_groups = new List<int>(20);

	private int _max_amount;

	private ObjectPoolGenericMono<PopulationPyramidRow> _pool_rows;

	private int _max_life_span;

	private int _age_steps;

	private IEnumerable<Actor> _units;

	private void Awake()
	{
		if (_pool_rows == null)
		{
			for (int i = 0; i < _population_pyramid_container.childCount; i++)
			{
				Object.Destroy((Object)(object)((Component)_population_pyramid_container.GetChild(i)).gameObject);
			}
			_pool_rows = new ObjectPoolGenericMono<PopulationPyramidRow>(_population_pyramid_row, _population_pyramid_container);
		}
	}

	private void OnEnable()
	{
		load();
	}

	private void OnDisable()
	{
		clearBars();
	}

	internal void load()
	{
		calculateLifespan();
		calculateAgeData();
		calculateAgeGroups();
		((MonoBehaviour)this).StartCoroutine(showBars());
	}

	private void clearBars()
	{
		_units = null;
		_pool_rows.clear();
	}

	private void calculateLifespan()
	{
		IMetaObject metaObject = (IMetaObject)AssetManager.meta_type_library.getAsset(_meta_type).get_selected();
		_units = metaObject.getUnits();
		_max_life_span = metaObject.getMaxPossibleLifespan();
		foreach (Actor unit in _units)
		{
			if (unit.isAlive())
			{
				int age = unit.getAge();
				if (age > _max_life_span)
				{
					_max_life_span = age;
				}
			}
		}
		_max_life_span = Mathf.CeilToInt((float)_max_life_span / 20f) * 20;
		_max_life_span = Mathf.Clamp(_max_life_span, 40, 100);
		_age_steps = _max_life_span / 10;
	}

	private void calculateAgeData()
	{
		_max_amount = 0;
		_age_data.Clear();
		foreach (Actor unit in _units)
		{
			if (unit.isAlive())
			{
				int key = unit.getAge() / _age_steps;
				if (!_age_data.ContainsKey(key))
				{
					_age_data[key] = new GenderCount();
				}
				int num = 0;
				if (unit.isSexMale())
				{
					num = ++_age_data[key].males;
				}
				if (unit.isSexFemale())
				{
					num = ++_age_data[key].females;
				}
				if (num > _max_amount)
				{
					_max_amount = num;
				}
			}
		}
	}

	private void calculateAgeGroups()
	{
		_age_groups.Clear();
		int num = 10;
		foreach (int key in _age_data.Keys)
		{
			if (key > num)
			{
				num = key;
			}
		}
		while (num >= 0)
		{
			_age_groups.Add(num--);
		}
	}

	private IEnumerator showBars()
	{
		foreach (int age_group in _age_groups)
		{
			if (_age_data.ContainsKey(age_group) || age_group <= 10)
			{
				PopulationPyramidRow next = _pool_rows.getNext();
				next.setAgeGroup(age_group * _age_steps, (age_group + 1) * _age_steps - 1);
				if (_age_data.ContainsKey(age_group))
				{
					int colorTextBasedOnAmount = _age_data[age_group].males + _age_data[age_group].females;
					next.setMaleCount(_age_data[age_group].males, _max_amount);
					next.setFemaleCount(_age_data[age_group].females, _max_amount);
					next.setColorTextBasedOnAmount(colorTextBasedOnAmount);
				}
				else
				{
					next.setColorTextBasedOnAmount(0);
					next.setMaleCount(0, _max_amount);
					next.setFemaleCount(0, _max_amount);
				}
				yield return CoroutineHelper.wait_for_next_frame;
			}
		}
	}
}
// --- End of File: PopulationPyramidController.cs ---



// --- Start of File: PopulationPyramidItem.cs ---
using DG.Tweening;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class PopulationPyramidItem : MonoBehaviour
{
	[SerializeField]
	private RectTransform _mask;

	[SerializeField]
	private RectTransform _bar;

	[SerializeField]
	private Image _bar_image;

	[SerializeField]
	private Text _count_text;

	[SerializeField]
	private float _bar_width = 80f;

	[SerializeField]
	private int _count;

	[SerializeField]
	private int _max_count;

	[SerializeField]
	private float _percent;

	[SerializeField]
	private float _calc_percent;

	private Tweener _cur_tween;

	private void Awake()
	{
		resetBar();
	}

	private void Start()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Expected O, but got Unknown
		((UnityEvent)((Component)this).gameObject.AddOrGetComponent<Button>().onClick).AddListener(new UnityAction(animateBar));
	}

	internal void setCount(int pCount, int pMax)
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		_count_text.text = pCount.ToString();
		Color color = ((Graphic)_count_text).color;
		if (pCount == 0)
		{
			color.a = 0.5f;
		}
		else
		{
			color.a = 1f;
		}
		((Graphic)_count_text).color = color;
		_count = pCount;
		_max_count = pMax;
		animateBar();
	}

	internal int getCount()
	{
		return _count;
	}

	private void resetBar()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		checkDestroyTween();
		_bar.sizeDelta = new Vector2(0.1f, _bar.sizeDelta.y);
	}

	internal void setOpacity(float pOpacity)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		Color color = ((Graphic)_bar_image).color;
		color.a = pOpacity;
		((Graphic)_bar_image).color = color;
	}

	internal void animateBar()
	{
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		resetBar();
		_percent = (float)_count / (float)_max_count;
		if (_count > 0)
		{
			_calc_percent = 4f + Mathf.Floor(_percent * _bar_width);
		}
		else
		{
			_calc_percent = 0f;
		}
		_cur_tween = (Tweener)(object)DOTweenModuleUI.DOSizeDelta(_bar, new Vector2(_calc_percent, _bar.sizeDelta.y), 0.3f, false);
	}

	private void OnDisable()
	{
		checkDestroyTween();
	}

	private void checkDestroyTween()
	{
		if (TweenExtensions.IsActive((Tween)(object)_cur_tween))
		{
			TweenExtensions.Complete((Tween)(object)_cur_tween, false);
			TweenExtensions.Kill((Tween)(object)_cur_tween, false);
		}
		_cur_tween = null;
	}
}
// --- End of File: PopulationPyramidItem.cs ---



// --- Start of File: PopulationPyramidRow.cs ---
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class PopulationPyramidRow : MonoBehaviour
{
	[SerializeField]
	private Image _left_icon;

	[SerializeField]
	private Image _right_icon;

	[SerializeField]
	private PopulationPyramidItem _left_item;

	[SerializeField]
	private PopulationPyramidItem _right_item;

	[SerializeField]
	private Text _text;

	private int _age_group_min;

	private int _age_group_max;

	private void Start()
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Expected O, but got Unknown
		((UnityEvent)((Component)this).gameObject.AddOrGetComponent<Button>().onClick).AddListener(new UnityAction(animateBars));
		setupTooltip();
	}

	private void setupTooltip()
	{
		TipButton tipButton = default(TipButton);
		if (((Component)this).TryGetComponent<TipButton>(ref tipButton))
		{
			tipButton.setHoverAction(showTooltip, pAddAnimation: false);
		}
	}

	private void showTooltip()
	{
		CustomDataContainer<string> customDataContainer = new CustomDataContainer<string>();
		customDataContainer["age_range"] = _age_group_min + " - " + _age_group_max;
		CustomDataContainer<int> customDataContainer2 = new CustomDataContainer<int>();
		customDataContainer2["males"] = _left_item.getCount();
		customDataContainer2["females"] = _right_item.getCount();
		Tooltip.show(((Component)this).gameObject, "gender_data", new TooltipData
		{
			custom_data_string = customDataContainer,
			custom_data_int = customDataContainer2
		});
	}

	private void animateBars()
	{
		_left_item.animateBar();
		_right_item.animateBar();
	}

	internal void setAgeGroup(int pAgeGroup, int pAgeGroupMax)
	{
		_age_group_min = pAgeGroup;
		_age_group_max = pAgeGroupMax;
		_text.text = pAgeGroup.ToString();
		float num = 0.75f + (float)pAgeGroup / 400f;
		num = Mathf.Clamp(num, 0.75f, 1f);
		_left_item.setOpacity(num);
		_right_item.setOpacity(num);
	}

	internal void setColorTextBasedOnAmount(int pAmount)
	{
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		if (pAmount == 0)
		{
			((Graphic)_text).color = new Color(1f, 1f, 1f, 0.3f);
		}
		else
		{
			((Graphic)_text).color = new Color(1f, 1f, 1f, 1f);
		}
	}

	internal void setMaleCount(int pCount, int pMax)
	{
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		_left_item.setCount(pCount, pMax);
		if (pCount == 0)
		{
			((Graphic)_left_icon).color = new Color(1f, 1f, 1f, 0.3f);
		}
		else
		{
			((Graphic)_left_icon).color = new Color(1f, 1f, 1f, 1f);
		}
	}

	internal void setFemaleCount(int pCount, int pMax)
	{
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		_right_item.setCount(pCount, pMax);
		if (pCount == 0)
		{
			((Graphic)_right_icon).color = new Color(1f, 1f, 1f, 0.3f);
		}
		else
		{
			((Graphic)_right_icon).color = new Color(1f, 1f, 1f, 1f);
		}
	}
}
// --- End of File: PopulationPyramidRow.cs ---



// --- Start of File: PossessionActionMode.cs ---
public enum PossessionActionMode
{
	Attack,
	Talk,
	Swear,
	Steal,
	Kick
}
// --- End of File: PossessionActionMode.cs ---



// --- Start of File: PossessionModeButton.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PossessionModeButton : MonoBehaviour
{
	public PossessionActionMode mode;

	[SerializeField]
	private Image _image_icon;

	[SerializeField]
	private Image _image_background;

	public void updateGraphics(PossessionActionMode pCurrentSelectedMode)
	{
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		if (mode == pCurrentSelectedMode)
		{
			((Graphic)_image_icon).color = Color.white;
			((Graphic)_image_background).color = Color.white;
		}
		else
		{
			((Graphic)_image_icon).color = new Color(0.3f, 0.3f, 0.3f, 1f);
			((Graphic)_image_background).color = Color.gray;
		}
	}
}
// --- End of File: PossessionModeButton.cs ---



// --- Start of File: PossessionUI.cs ---
using DG.Tweening;
using UnityEngine;
using UnityEngine.UI;

public class PossessionUI : MonoBehaviour
{
	[SerializeField]
	private UiMover _mover;

	[SerializeField]
	private GameObject _inner;

	public static PossessionUI instance;

	private Text _text_backstep;

	private Text _text_dash;

	private Text _text_steal;

	private Text _text_yell;

	private Text _text_talk;

	private Text _text_walk;

	private Text _text_attack;

	private Text _text_special;

	private Text _text_jump;

	private Text _text_kick;

	private bool _planned_state;

	private bool _state_change_planned;

	private void Awake()
	{
		instance = this;
		_text_backstep = ((Component)((Component)this).transform.FindRecursive("backstep")).GetComponent<Text>();
		_text_dash = ((Component)((Component)this).transform.FindRecursive("dash")).GetComponent<Text>();
		_text_steal = ((Component)((Component)this).transform.FindRecursive("steal")).GetComponent<Text>();
		_text_yell = ((Component)((Component)this).transform.FindRecursive("yell")).GetComponent<Text>();
		_text_talk = ((Component)((Component)this).transform.FindRecursive("talk")).GetComponent<Text>();
		_text_walk = ((Component)((Component)this).transform.FindRecursive("walk")).GetComponent<Text>();
		_text_attack = ((Component)((Component)this).transform.FindRecursive("attack")).GetComponent<Text>();
		_text_special = ((Component)((Component)this).transform.FindRecursive("special")).GetComponent<Text>();
		_text_jump = ((Component)((Component)this).transform.FindRecursive("jump")).GetComponent<Text>();
		_text_kick = ((Component)((Component)this).transform.FindRecursive("kick")).GetComponent<Text>();
		setText(_text_backstep, "possession_tip_backstep", "CONTROL");
		setText(_text_dash, "possession_tip_dash", "SHIFT");
		setText(_text_steal, "possession_tip_steal", "Q");
		setText(_text_yell, "possession_tip_yell", "F");
		setText(_text_talk, "possession_tip_talk", "T");
		setText(_text_walk, "possession_tip_walk", "WASD/ARROWS");
		setText(_text_attack, "possession_tip_attack", "LEFT CLICK");
		setText(_text_special, "possession_tip_special", "MIDDLE CLICK");
		setText(_text_jump, "possession_tip_jump", "SPACE");
		setText(_text_kick, "possession_tip_kick", "RIGHT CLICK");
		toggleInstance(pState: false);
	}

	private void Update()
	{
		if (_state_change_planned)
		{
			_state_change_planned = false;
			if (_mover.visible != _planned_state)
			{
				toggleInstance(_planned_state);
			}
		}
	}

	private void setText(Text pTextField, string pLocaleID, string pKey)
	{
		string text = LocalizedTextManager.getText(pLocaleID);
		text = Toolbox.coloredString(text, "white");
		pKey = Toolbox.coloredString(pKey, "#F3961F");
		pTextField.text = text + " --> [ " + pKey + " ]";
	}

	public static void toggle(bool pState)
	{
		instance._state_change_planned = true;
		instance._planned_state = pState;
	}

	private void toggleInstance(bool pState)
	{
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Expected O, but got Unknown
		if (pState)
		{
			instance._inner.SetActive(true);
		}
		instance._mover.setVisible(pState, pNow: false, (TweenCallback)delegate
		{
			if (!pState && !instance._mover.visible)
			{
				instance._inner.SetActive(false);
			}
		});
	}
}
// --- End of File: PossessionUI.cs ---



// --- Start of File: PossessionUnitInfo.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PossessionUnitInfo : MonoBehaviour
{
	[SerializeField]
	private Text _name_field;

	[SerializeField]
	private Image _icon_species;

	[SerializeField]
	private Image _icon_sex;

	[SerializeField]
	private KingdomBanner _banner_kingdom;

	[SerializeField]
	private Text _text_age;

	[SerializeField]
	private Text _text_kills;

	[SerializeField]
	private Text _text_level;

	[SerializeField]
	private StatBar _bar_health;

	private void OnEnable()
	{
		Actor controllableUnit = ControllableUnit.getControllableUnit();
		if (controllableUnit != null)
		{
			showForUnit(controllableUnit);
		}
	}

	private void Update()
	{
		Actor controllableUnit = ControllableUnit.getControllableUnit();
		if (controllableUnit != null)
		{
			showForUnit(controllableUnit);
		}
	}

	private void showForUnit(Actor pActor)
	{
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		if (pActor.isSexMale())
		{
			_icon_sex.sprite = SpriteTextureLoader.getSprite("ui/icons/IconMale");
		}
		else
		{
			_icon_sex.sprite = SpriteTextureLoader.getSprite("ui/icons/IconFemale");
		}
		_icon_species.sprite = pActor.asset.getSpriteIcon();
		if (pActor.kingdom.isCiv())
		{
			((Component)_banner_kingdom).gameObject.SetActive(true);
			_banner_kingdom.load(pActor.kingdom);
		}
		else
		{
			((Component)_banner_kingdom).gameObject.SetActive(false);
		}
		float pVal = pActor.getHealth();
		float num = pActor.getMaxHealth();
		_bar_health.setBar(pVal, num, "/" + ((int)num).ToText(4), pReset: false, pFloat: false, pUpdateText: true, 0.25f);
		_name_field.text = pActor.getName();
		((Graphic)_name_field).color = pActor.kingdom.getColor().getColorText();
		_text_age.text = pActor.getAge().ToString();
		_text_kills.text = pActor.data.kills.ToString();
		_text_level.text = pActor.level.ToString();
	}
}
// --- End of File: PossessionUnitInfo.cs ---



// --- Start of File: PowerAction.cs ---
using System;

[Serializable]
public delegate bool PowerAction(WorldTile pTile, GodPower pPower);
// --- End of File: PowerAction.cs ---



// --- Start of File: PowerActionType.cs ---
public enum PowerActionType
{
	PowerSpecial,
	PowerSpawnActor,
	PowerDrawTile,
	PowerSpawnDrops,
	PowerSpawnSeeds,
	PowerSpawnBuilding
}
// --- End of File: PowerActionType.cs ---



// --- Start of File: PowerActionWithID.cs ---
using System;

[Serializable]
public delegate bool PowerActionWithID(WorldTile pTile, string pPowerID);
// --- End of File: PowerActionWithID.cs ---



// --- Start of File: PowerButton.cs ---
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class PowerButton : MonoBehaviour, IPointerClickHandler, IEventSystemHandler, IBeginDragHandler, IDragHandler, IEndDragHandler, IInitializePotentialDragHandler, IScrollHandler
{
	public bool drag_power_bar;

	public string open_window_id = string.Empty;

	public bool block_same_window;

	public Image icon;

	private Image _image;

	private Button _button;

	public PowerButtonType type;

	public GameObject sizeButtons;

	public PowerButton mainSizeButton;

	internal GodPower godPower;

	private Image _icon_lock;

	public GameObject buttonUnlocked;

	public GameObject buttonUnlockedFlash;

	public static List<PowerButton> power_buttons = new List<PowerButton>();

	public static List<PowerButton> toggle_buttons = new List<PowerButton>();

	public static Dictionary<ActorAsset, PowerButton> actor_spawn_buttons = new Dictionary<ActorAsset, PowerButton>();

	internal RectTransform rect_transform;

	internal PowerButton left;

	internal PowerButton right;

	internal PowerButton down;

	internal PowerButton up;

	private Vector3 _default_scale;

	private Vector3 _clicked_scale;

	[HideInInspector]
	public bool is_selectable = true;

	private bool _initialized;

	private PowerButtonSelector _selected_buttons => PowerButtonSelector.instance;

	public static PowerButton get(string pID)
	{
		for (int i = 0; i < power_buttons.Count; i++)
		{
			PowerButton powerButton = power_buttons[i];
			if (((Object)((Component)powerButton).gameObject).name == pID)
			{
				return powerButton;
			}
		}
		return null;
	}

	private void init()
	{
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		rect_transform = ((Component)this).GetComponent<RectTransform>();
		_image = ((Component)this).GetComponent<Image>();
		_button = ((Component)this).GetComponent<Button>();
		if (type == PowerButtonType.Special || type == PowerButtonType.Active)
		{
			power_buttons.Add(this);
			godPower = AssetManager.powers.get(((Object)((Component)this).gameObject).name);
		}
		else if (type == PowerButtonType.Shop)
		{
			godPower = AssetManager.powers.get(((Object)((Component)this).gameObject).name);
		}
		if (godPower == null)
		{
			return;
		}
		if (godPower.disabled_on_mobile && Config.isMobile)
		{
			((Component)this).gameObject.SetActive(false);
			return;
		}
		if (type == PowerButtonType.Active)
		{
			GodPower.addPower(godPower, this);
		}
		if (godPower.toggle_action != null)
		{
			toggle_buttons.Add(this);
		}
		if (isActorSpawn())
		{
			ActorAsset actorAsset = godPower.getActorAsset();
			if (!actorAsset.isAvailable())
			{
				((Graphic)icon).color = Toolbox.color_black;
			}
			actor_spawn_buttons.TryAdd(actorAsset, this);
		}
	}

	private void OnEnable()
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Expected O, but got Unknown
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Expected O, but got Unknown
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		if (_initialized)
		{
			return;
		}
		_initialized = true;
		init();
		_default_scale = ((Component)this).transform.localScale;
		_clicked_scale = _default_scale * 0.9f;
		if (type == PowerButtonType.Active && godPower != null)
		{
			if (((Object)((Component)this).gameObject).name.Contains("Button"))
			{
				Color color = default(Color);
				((Color)(ref color))._002Ector(0.5f, 0.5f, 0.5f, 1f);
				((Graphic)_image).color = color;
				((Graphic)icon).color = color;
			}
			else
			{
				godPower.id = ((Object)((Component)this).gameObject.transform).name;
			}
		}
		if (!((Component)(object)this).HasComponent<TipButton>())
		{
			_button.OnHover(new UnityAction(showTooltip));
			_button.OnHoverOut(new UnityAction(Tooltip.hideTooltip));
		}
	}

	public void OnPointerClick(PointerEventData pEventData)
	{
		if (!draggingBarEnabled() || !ScrollRectExtended.isAnyDragged())
		{
			if (!InputHelpers.mouseSupported && !Tooltip.isShowingFor(this) && (type == PowerButtonType.Active || type == PowerButtonType.Special) && (Object)(object)PowerButtonSelector.instance.selectedButton != (Object)(object)this)
			{
				showTooltip();
			}
			clickButton();
		}
	}

	internal void clickButton()
	{
		newClickAnimation();
		playSound();
		if ((type == PowerButtonType.Active || type == PowerButtonType.Library || type == PowerButtonType.Special) && (godPower == null || godPower.track_activity))
		{
			PowerTracker.trackPower(getText());
		}
		if (type == PowerButtonType.Active)
		{
			clickActivePower();
		}
		if (type == PowerButtonType.BrushSizeMain)
		{
			clickSizeMainTool();
		}
		if (type == PowerButtonType.TimeScale)
		{
			clickTimeScaleTool();
		}
		if (type == PowerButtonType.Shop)
		{
			clickShop();
		}
		if (type == PowerButtonType.Special)
		{
			clickSpecial();
		}
		if (type == PowerButtonType.Window)
		{
			clickOpenWindow();
		}
	}

	private void showTooltip()
	{
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		if (InputHelpers.mouseSupported && !Config.tooltips_active)
		{
			return;
		}
		if (godPower != null)
		{
			TooltipData tooltipData = new TooltipData();
			if ((Config.isComputer || Config.isEditor) && godPower.multiple_spawn_tip && type != PowerButtonType.Shop)
			{
				tooltipData.tip_description_2 = "hotkey_many_mod";
			}
			tooltipData.tip_name = godPower.getLocaleID();
			tooltipData.tip_description = godPower.getDescriptionID();
			switch (godPower.type)
			{
			case PowerActionType.PowerSpawnActor:
				tooltipData.power = godPower;
				Tooltip.show(this, "unit_spawn", tooltipData);
				break;
			case PowerActionType.PowerSpawnSeeds:
				tooltipData.power = godPower;
				Tooltip.show(this, "biome_seed", tooltipData);
				break;
			default:
				Tooltip.show(this, "normal", tooltipData);
				break;
			}
		}
		else
		{
			string text = getText();
			string description = getDescription();
			if (text == "")
			{
				return;
			}
			if (description != "")
			{
				Tooltip.show(this, "normal", new TooltipData
				{
					tip_name = text,
					tip_description = description
				});
			}
			else
			{
				Tooltip.show(this, "tip", new TooltipData
				{
					tip_name = text
				});
			}
		}
		((Component)this).transform.localScale = new Vector3(1.1f, 1.1f, 1.1f);
		ShortcutExtensions.DOKill((Component)(object)((Component)this).transform, false);
		TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).transform, 1f, 0.1f), (Ease)26);
	}

	private string getText()
	{
		if (godPower != null)
		{
			return godPower.getLocaleID();
		}
		string text = ((Object)_button).name.Underscore();
		if (LocalizedTextManager.stringExists("button_" + text))
		{
			return "button_" + text;
		}
		if (LocalizedTextManager.stringExists(text))
		{
			return text;
		}
		return "";
	}

	private string getDescription()
	{
		if (godPower != null)
		{
			return godPower.getDescriptionID();
		}
		string text = ((Object)_button).name.Underscore();
		if (LocalizedTextManager.stringExists("button_" + text + "_description"))
		{
			return "button_" + text + "_description";
		}
		if (LocalizedTextManager.stringExists(text + "_description"))
		{
			return text + "_description";
		}
		return "";
	}

	private void clickOpenWindow()
	{
		if (open_window_id == "steam" && (Config.isComputer || Config.isEditor))
		{
			open_window_id = "steam_workshop_main";
		}
		if (ScrollWindow.isAnimationActive() && !ScrollWindow.isCurrentWindow(open_window_id))
		{
			ScrollWindow.finishAnimations();
		}
		PowerButtonSelector.instance.clearHighlightedButton();
		showWindow(open_window_id, block_same_window);
	}

	internal void clickSpecial()
	{
		Analytics.LogEvent("select_power", "powerID", godPower.id);
		if (godPower.id == "pause")
		{
			((Component)this).GetComponent<PauseButton>().press();
		}
		if (godPower.toggle_action != null)
		{
			godPower.toggle_action(godPower.id);
			PowerButtonSelector.instance.unselectAll();
			PowerButtonSelector.instance.checkToggleIcons();
		}
	}

	public void checkToggleIcon()
	{
		GodPower godPower = this.godPower;
		if (godPower == null || string.IsNullOrEmpty(godPower.toggle_name))
		{
			return;
		}
		OptionAsset option_asset = this.godPower.option_asset;
		bool flag = option_asset.isActive();
		int num = 0;
		bool pEnabled = flag;
		bool pEnabled2 = flag;
		bool pEnabled3 = flag;
		ToggleIcon toggleIcon = null;
		ToggleIcon toggleIcon2 = null;
		ToggleIcon toggleIcon3 = null;
		ToggleIcon toggleIcon4 = null;
		Transform obj = ((Component)this).transform.Find("ToggleIcon");
		toggleIcon = ((obj != null) ? ((Component)obj).GetComponent<ToggleIcon>() : null);
		if (godPower.multi_toggle)
		{
			num = option_asset.current_int_value;
			Transform obj2 = ((Component)this).transform.Find("toggle_0");
			toggleIcon2 = ((obj2 != null) ? ((Component)obj2).GetComponent<ToggleIcon>() : null);
			Transform obj3 = ((Component)this).transform.Find("toggle_1");
			toggleIcon3 = ((obj3 != null) ? ((Component)obj3).GetComponent<ToggleIcon>() : null);
			Transform obj4 = ((Component)this).transform.Find("toggle_2");
			toggleIcon4 = ((obj4 != null) ? ((Component)obj4).GetComponent<ToggleIcon>() : null);
			switch (option_asset.max_value)
			{
			case 2:
				pEnabled = num == 0;
				pEnabled2 = num == 1;
				pEnabled3 = num == 2;
				break;
			case 1:
				pEnabled = num == 0;
				pEnabled3 = num == 1;
				break;
			default:
				pEnabled = flag;
				pEnabled2 = flag;
				pEnabled3 = flag;
				break;
			}
		}
		toggleIcon?.updateIcon(flag);
		if (godPower.multi_toggle)
		{
			toggleIcon2?.updateIconMultiToggle(flag, pEnabled3);
			toggleIcon3?.updateIconMultiToggle(flag, pEnabled);
			toggleIcon4?.updateIconMultiToggle(flag, pEnabled2);
		}
	}

	private void playSound()
	{
		SoundBox.click();
	}

	public void checkLockIcon()
	{
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0110: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Unknown result type (might be due to invalid IL or missing references)
		if (type == PowerButtonType.Shop)
		{
			return;
		}
		if (godPower != null && godPower.requires_premium)
		{
			if ((Object)(object)_icon_lock == (Object)null)
			{
				_icon_lock = Object.Instantiate<Image>(PrefabLibrary.instance.iconLock, ((Component)this).transform);
				((Behaviour)_icon_lock).enabled = true;
			}
			if ((Object)(object)buttonUnlocked == (Object)null)
			{
				buttonUnlocked = Object.Instantiate<GameObject>(PowerButtonSelector.instance.buttonUnlockedFlashNew, ((Component)this).transform);
				buttonUnlocked.transform.position = ((Component)this).transform.position;
				buttonUnlocked.SetActive(false);
				buttonUnlocked.transform.SetSiblingIndex(0);
				buttonUnlocked.GetComponent<RectTransform>().pivot = ((Component)this).GetComponent<RectTransform>().pivot;
			}
			if ((Object)(object)buttonUnlockedFlash == (Object)null)
			{
				buttonUnlockedFlash = Object.Instantiate<GameObject>(PowerButtonSelector.instance.buttonUnlockedFlash, ((Component)this).transform);
				buttonUnlockedFlash.transform.position = ((Component)this).transform.position;
				buttonUnlockedFlash.SetActive(false);
				buttonUnlockedFlash.transform.SetSiblingIndex(0);
				buttonUnlockedFlash.GetComponent<RectTransform>().pivot = ((Component)this).GetComponent<RectTransform>().pivot;
			}
		}
		if (!((Object)(object)_icon_lock == (Object)null))
		{
			if (godPower == null)
			{
				((Behaviour)_icon_lock).enabled = false;
			}
			else if (Config.hasPremium)
			{
				((Behaviour)_icon_lock).enabled = false;
			}
			else
			{
				((Behaviour)_icon_lock).enabled = true;
			}
		}
	}

	public void showOthers()
	{
		Debug.Log((object)"other");
	}

	public bool isSelected()
	{
		return _selected_buttons.isPowerSelected(this);
	}

	public void cancelSelection()
	{
		_selected_buttons.unselectAll();
	}

	public void unselectActivePower()
	{
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		if (((Component)this).gameObject.activeInHierarchy)
		{
			((MonoBehaviour)this).StartCoroutine(angleToZero());
		}
		else
		{
			((Component)icon).transform.localEulerAngles = new Vector3(0f, 0f, 0f);
		}
	}

	public void hideSizes()
	{
		sizeButtons.SetActive(false);
	}

	private void clickSizeMainTool()
	{
		sizeButtons.SetActive(!sizeButtons.activeSelf);
	}

	public void clickTimeScaleTool()
	{
		sizeButtons.SetActive(false);
		Config.setWorldSpeed(((Object)((Component)this).transform).name);
		mainSizeButton.newClickAnimation();
		World.world.player_control.inspect_timer_click = 1f;
	}

	private void clickActivePower()
	{
		_selected_buttons.clickPowerButton(this);
	}

	public bool canSelect()
	{
		if (!is_selectable)
		{
			return false;
		}
		if (!isActorSpawn())
		{
			return true;
		}
		if (godPower.getActorAsset().isAvailable())
		{
			return true;
		}
		return false;
	}

	private void clickShop()
	{
		WorldTip.showNow(LocalizedTextManager.getText(godPower.getLocaleID()) + "\n" + LocalizedTextManager.getText(godPower.getDescriptionID()), pTranslate: false, "top");
	}

	public void setSelectedPower(PowerButton pLibraryButton, bool pAnim = false)
	{
		godPower = pLibraryButton.godPower;
	}

	public void newClickAnimation()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		((Component)this).gameObject.transform.localScale = _clicked_scale;
		TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).gameObject.transform, _default_scale, 0.1f), (Ease)28);
	}

	protected IEnumerator angleToZero()
	{
		while (((Component)icon).transform.localEulerAngles.z != 0f)
		{
			Vector3 localEulerAngles = ((Component)icon).transform.localEulerAngles;
			localEulerAngles.z -= 100f * Time.deltaTime;
			if (localEulerAngles.z < 0f)
			{
				localEulerAngles.z = 0f;
			}
			((Component)icon).transform.localEulerAngles = localEulerAngles;
			yield return null;
		}
	}

	public void animate(float pElapsed)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		if (((Component)icon).transform.localEulerAngles.z < 20f)
		{
			Vector3 localEulerAngles = ((Component)icon).transform.localEulerAngles;
			localEulerAngles.z += 100f * pElapsed;
			if (localEulerAngles.z > 20f)
			{
				localEulerAngles.z = 20f;
			}
			((Component)icon).transform.localEulerAngles = localEulerAngles;
		}
	}

	public void destroyLockIcon()
	{
		if ((Object)(object)buttonUnlocked != (Object)null)
		{
			Object.Destroy((Object)(object)buttonUnlocked);
		}
		if ((Object)(object)buttonUnlockedFlash != (Object)null)
		{
			Object.Destroy((Object)(object)buttonUnlockedFlash);
		}
		if ((Object)(object)_icon_lock != (Object)null)
		{
			Object.Destroy((Object)(object)((Component)_icon_lock).gameObject);
			return;
		}
		Transform val = ((Component)this).transform.Find("IconLock");
		if ((Object)(object)val != (Object)null)
		{
			Object.Destroy((Object)(object)((Component)val).gameObject);
			val = null;
			return;
		}
		val = ((Component)this).transform.Find("IconLock(Clone)");
		if ((Object)(object)val != (Object)null)
		{
			Object.Destroy((Object)(object)((Component)val).gameObject);
		}
	}

	public void showWindow(string pID, bool pBlockSame)
	{
		if (!ScrollWindow.isAnimationActive())
		{
			ScrollWindow.showWindow(pID, pSkipAnimation: false, pBlockSame);
		}
	}

	public void showWindow(string pID)
	{
		ScrollWindow.showWindow(pID, pSkipAnimation: false, pBlockSame: false);
	}

	public void selectPowerTab(TweenCallback pOnComplete = null)
	{
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0149: Unknown result type (might be due to invalid IL or missing references)
		//IL_0153: Expected O, but got Unknown
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_012b: Expected O, but got Unknown
		if (!((Component)((Component)this).transform.parent).gameObject.activeInHierarchy)
		{
			Button tabForTabGroup = PowerTabController.instance.getTabForTabGroup(((Object)((Component)this).transform.parent).name);
			if ((Object)(object)tabForTabGroup != (Object)null)
			{
				PowersTab.showTabFromButton(tabForTabGroup);
			}
		}
		Transform parent = ((Component)this).transform.parent.parent.parent;
		RectTransform val = (RectTransform)(object)((parent is RectTransform) ? parent : null);
		Rect rect = val.rect;
		float width = ((Rect)(ref rect)).width;
		float num = (float)Screen.width / CanvasMain.instance.canvas_ui.scaleFactor;
		float num2 = 0f - ((Component)this).transform.localPosition.x + 32f + num / 2f;
		float num3 = 0f;
		if (width > num)
		{
			num3 = -1f * (width - num);
		}
		num2 = Mathf.Clamp(num2, num3, 0f);
		ScrollRectExtended tScrollRect = ((Component)val).GetComponentInParent<ScrollRectExtended>();
		tScrollRect.movementType = ScrollRectExtended.MovementType.Clamped;
		if (pOnComplete == null)
		{
			TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetDelay<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMoveX((Transform)(object)val, num2, 1.5f, false), (Ease)27), 0.3f), (TweenCallback)delegate
			{
				tScrollRect.StopMovement();
				tScrollRect.movementType = ScrollRectExtended.MovementType.Elastic;
			});
			return;
		}
		TweenSettingsExtensions.OnComplete<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOLocalMoveX((Transform)(object)val, num2, 0.125f, false), (Ease)27), (TweenCallback)delegate
		{
			tScrollRect.StopMovement();
			tScrollRect.movementType = ScrollRectExtended.MovementType.Elastic;
			pOnComplete.Invoke();
		});
	}

	internal void findNeighbours(List<PowerButton> pButtons, bool pCheckForActive = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_0126: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_017a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0180: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_016b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_022a: Unknown result type (might be due to invalid IL or missing references)
		//IL_022f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0231: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0304: Unknown result type (might be due to invalid IL or missing references)
		//IL_0306: Unknown result type (might be due to invalid IL or missing references)
		//IL_024b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0252: Unknown result type (might be due to invalid IL or missing references)
		//IL_0320: Unknown result type (might be due to invalid IL or missing references)
		//IL_0327: Unknown result type (might be due to invalid IL or missing references)
		//IL_027d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0287: Unknown result type (might be due to invalid IL or missing references)
		//IL_0352: Unknown result type (might be due to invalid IL or missing references)
		//IL_035c: Unknown result type (might be due to invalid IL or missing references)
		Vector2 anchoredPosition = rect_transform.anchoredPosition;
		if (anchoredPosition.y == -2f)
		{
			anchoredPosition.y = 16f;
		}
		foreach (PowerButton pButton in pButtons)
		{
			if ((Object)(object)pButton == (Object)(object)this || (pCheckForActive && !((Component)pButton).gameObject.activeSelf))
			{
				continue;
			}
			Vector2 anchoredPosition2 = pButton.rect_transform.anchoredPosition;
			if (anchoredPosition2.y == -2f)
			{
				anchoredPosition2.y = 16f;
			}
			if (anchoredPosition2.y == anchoredPosition.y)
			{
				if (anchoredPosition2.x < anchoredPosition.x)
				{
					if ((Object)(object)left == (Object)null)
					{
						left = pButton;
					}
					else if (left.rect_transform.anchoredPosition.x < anchoredPosition2.x)
					{
						left = pButton;
					}
				}
				if (anchoredPosition2.x > anchoredPosition.x)
				{
					if ((Object)(object)right == (Object)null)
					{
						right = pButton;
					}
					else if (right.rect_transform.anchoredPosition.x > anchoredPosition2.x)
					{
						right = pButton;
					}
				}
			}
			if (anchoredPosition2.x != anchoredPosition.x)
			{
				continue;
			}
			if (anchoredPosition2.y < anchoredPosition.y)
			{
				if ((Object)(object)down == (Object)null)
				{
					down = pButton;
				}
				else if (down.rect_transform.anchoredPosition.y < anchoredPosition2.y)
				{
					down = pButton;
				}
			}
			if (anchoredPosition2.y > anchoredPosition.y)
			{
				if ((Object)(object)up == (Object)null)
				{
					up = pButton;
				}
				else if (up.rect_transform.anchoredPosition.y > anchoredPosition2.y)
				{
					up = pButton;
				}
			}
		}
		if ((Object)(object)left == (Object)null)
		{
			foreach (PowerButton pButton2 in pButtons)
			{
				if ((Object)(object)pButton2 == (Object)(object)this || (pCheckForActive && !((Component)pButton2).gameObject.activeSelf))
				{
					continue;
				}
				Vector2 anchoredPosition3 = pButton2.rect_transform.anchoredPosition;
				if (anchoredPosition3.y == -2f)
				{
					anchoredPosition3.y = 16f;
				}
				if (anchoredPosition3.y == anchoredPosition.y)
				{
					if ((Object)(object)left == (Object)null)
					{
						left = pButton2;
					}
					else if (left.rect_transform.anchoredPosition.x < anchoredPosition3.x)
					{
						left = pButton2;
					}
				}
			}
		}
		if (!((Object)(object)right == (Object)null))
		{
			return;
		}
		foreach (PowerButton pButton3 in pButtons)
		{
			if ((Object)(object)pButton3 == (Object)(object)this || (pCheckForActive && !((Component)pButton3).gameObject.activeSelf))
			{
				continue;
			}
			Vector2 anchoredPosition4 = pButton3.rect_transform.anchoredPosition;
			if (anchoredPosition4.y == -2f)
			{
				anchoredPosition4.y = 16f;
			}
			if (anchoredPosition4.y == anchoredPosition.y)
			{
				if ((Object)(object)right == (Object)null)
				{
					right = pButton3;
				}
				else if (right.rect_transform.anchoredPosition.x > anchoredPosition4.x)
				{
					right = pButton3;
				}
			}
		}
	}

	private bool isActorSpawn()
	{
		if (godPower != null)
		{
			return godPower.type == PowerActionType.PowerSpawnActor;
		}
		return false;
	}

	public static void checkActorSpawnButtons()
	{
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		Color color = default(Color);
		((Color)(ref color))._002Ector(0.75f, 0.75f, 0.75f, 0.9f);
		foreach (KeyValuePair<ActorAsset, PowerButton> actor_spawn_button in actor_spawn_buttons)
		{
			ActorAsset key = actor_spawn_button.Key;
			PowerButton value = actor_spawn_button.Value;
			if (key.isAvailable())
			{
				if (key.countPopulation() > 0)
				{
					value._image.sprite = ToolbarButtons.getSpriteButtonUnitExists();
					((Graphic)value.icon).color = Toolbox.color_white;
				}
				else
				{
					value._image.sprite = ToolbarButtons.getSpriteButtonNormal();
					((Graphic)value.icon).color = color;
				}
			}
			else
			{
				((Graphic)value.icon).color = Toolbox.color_black;
			}
		}
	}

	private bool draggingBarEnabled()
	{
		if (drag_power_bar)
		{
			return InputHelpers.mouseSupported;
		}
		return false;
	}

	public void OnBeginDrag(PointerEventData pEventData)
	{
		if (draggingBarEnabled())
		{
			ScrollRectExtended.SendMessageToAll("OnBeginDrag", pEventData);
		}
	}

	public void OnDrag(PointerEventData pEventData)
	{
		if (draggingBarEnabled())
		{
			ScrollRectExtended.SendMessageToAll("OnDrag", pEventData);
		}
	}

	public void OnEndDrag(PointerEventData pEventData)
	{
		if (draggingBarEnabled())
		{
			ScrollRectExtended.SendMessageToAll("OnEndDrag", pEventData);
		}
	}

	public void OnInitializePotentialDrag(PointerEventData pEventData)
	{
		if (draggingBarEnabled())
		{
			ScrollRectExtended.SendMessageToAll("OnInitializePotentialDrag", pEventData);
		}
	}

	public void OnScroll(PointerEventData pEventData)
	{
		if (draggingBarEnabled())
		{
			ScrollRectExtended.SendMessageToAll("OnScroll", pEventData);
		}
	}

	public void OnDestroy()
	{
		ShortcutExtensions.DOKill((Component)(object)((Component)this).transform, false);
		power_buttons.Remove(this);
		toggle_buttons.Remove(this);
		if (actor_spawn_buttons.ContainsValue(this))
		{
			ActorAsset key = actor_spawn_buttons.FirstOrDefault((KeyValuePair<ActorAsset, PowerButton> x) => (Object)(object)x.Value == (Object)(object)this).Key;
			actor_spawn_buttons.Remove(key);
		}
	}
}
// --- End of File: PowerButton.cs ---



// --- Start of File: PowerButtonClickAction.cs ---
using System;

[Serializable]
public delegate bool PowerButtonClickAction(string pPower);
// --- End of File: PowerButtonClickAction.cs ---



// --- Start of File: PowerButtonSelector.cs ---
using System.Collections;
using DG.Tweening;
using UnityEngine;
using UnityEngine.UI;

public class PowerButtonSelector : MonoBehaviour
{
	private const float TOOLBAR_TEMP_SHOW_DURATION = 1f;

	private const float TOOLBAR_TEMP_SHOW_ALPHA = 0.5f;

	public GameObject buttonSelectionSprite;

	public GameObject buttonUnlocked;

	public GameObject buttonUnlockedFlash;

	public GameObject buttonUnlockedFlashNew;

	[SerializeField]
	private CanvasGroup _toolbar_canvas_group;

	public UiMover cancelUnitSelectedMover;

	public UiMover cancelButtMover;

	public UiMover sizeButtMover;

	public UiMover clockButtMover;

	public UiMover bottomElementsMover;

	public UiMover spectateUnitMover;

	public UiMover pauseButtonMover;

	public UiMover unhideButtonMover;

	public PowerButton clockButton;

	public PowerButton sizeButton;

	public CancelButton cancelButton;

	public PowerButton pauseButton;

	public PowerButton pauseButton2;

	public PowerButton cityInfo;

	public PowerButton cityZones;

	public PowerButton boatMarks;

	public PowerButton kingsAndLeaders;

	public PowerButton historyLog;

	public PowerButton followUnit;

	public GameObject joy_control_cancel_button;

	[SerializeField]
	private Image _joy_control_cancel_button_icon;

	private Coroutine _toolbar_hide_routine;

	private bool _is_toolbar_temp_showed;

	internal PowerButton selectedButton;

	public GameObject buttons;

	internal static PowerButtonSelector instance;

	private void Awake()
	{
		instance = this;
	}

	private void Start()
	{
		clockButtMover.setVisible(pVisible: false, pNow: true);
		sizeButtMover.setVisible(pVisible: false, pNow: true);
		cancelButtMover.setVisible(pVisible: false, pNow: true);
		cancelUnitSelectedMover.setVisible(pVisible: false, pNow: true);
		toggleBottomElements(pState: false, pNow: true);
		spectateUnitMover.setVisible(pVisible: false, pNow: true);
		resetToolbarTempShow();
	}

	internal void checkToggleIcons()
	{
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		Color color = default(Color);
		((Color)(ref color))._002Ector(0.7f, 0.7f, 0.7f, 1f);
		foreach (PowerButton toggle_button in PowerButton.toggle_buttons)
		{
			toggle_button.checkToggleIcon();
			if (toggle_button.godPower.option_asset.isActive())
			{
				((Graphic)toggle_button.icon).color = Color.white;
			}
			else
			{
				((Graphic)toggle_button.icon).color = color;
			}
		}
	}

	public virtual void setSelectedPower(PowerButton pButton, GodPower pPower, bool pAnim = false)
	{
		if (!((Object)(object)selectedButton == (Object)null))
		{
			_ = selectedButton.godPower;
			selectedButton.setSelectedPower(pButton);
			selectedButton.newClickAnimation();
		}
	}

	public void setPower(PowerButton pButton)
	{
		selectedButton = pButton;
		if ((Object)(object)selectedButton != (Object)null && selectedButton.godPower != null)
		{
			Config.debug_last_selected_power_button = selectedButton.godPower.id;
			if (selectedButton.godPower.type == PowerActionType.PowerSpawnActor)
			{
				ActorAsset actorAsset = selectedButton.godPower.getActorAsset();
				if (actorAsset.has_sound_spawn)
				{
					MusicBox.playSoundUI(actorAsset.sound_spawn);
				}
			}
		}
		if ((Object)(object)selectedButton != (Object)null)
		{
			cancelButton.setIconFrom(selectedButton);
			LogText.log("Power Selected", pButton.godPower.id);
		}
		if ((Object)(object)pButton == (Object)null)
		{
			PowerTracker.setPower(null);
		}
		else
		{
			PowerTracker.setPower(pButton.godPower);
		}
	}

	public void unselectTabs()
	{
		if (PowersTab.isTabSelected())
		{
			SelectedObjects.unselectNanoObject();
			PowersTab.unselect();
			SelectedTabsHistory.clear();
		}
	}

	public void unselectAll()
	{
		if ((Object)(object)selectedButton != (Object)null)
		{
			selectedButton.unselectActivePower();
			setPower(null);
			clearHighlightedButton();
			WorldTip.instance.startHide();
		}
		if (ControllableUnit.isControllingUnit())
		{
			ControllableUnit.clear();
		}
		if (MoveCamera.hasFocusUnit())
		{
			MoveCamera.clearFocusUnitOnly();
		}
	}

	public bool isPowerSelected()
	{
		return (Object)(object)selectedButton != (Object)null;
	}

	public bool isPowerSelected(PowerButton pButton)
	{
		return (Object)(object)selectedButton == (Object)(object)pButton;
	}

	public void clickPowerButton(PowerButton pButton)
	{
		if (!pButton.canSelect())
		{
			if (!InputHelpers.mouseSupported)
			{
				showToolbarText(pButton);
			}
			return;
		}
		if ((Object)(object)selectedButton == (Object)(object)pButton)
		{
			unselectAll();
			return;
		}
		if ((Object)(object)selectedButton != (Object)null)
		{
			selectedButton.unselectActivePower();
		}
		if (pButton.godPower.select_button_action != null && pButton.godPower.select_button_action(pButton.godPower.id))
		{
			return;
		}
		setPower(pButton);
		if ((Object)(object)selectedButton != (Object)null)
		{
			highlightButton(selectedButton);
			if (selectedButton.godPower != null)
			{
				Config.logSelectedPower(selectedButton.godPower);
			}
		}
		if (InputHelpers.mouseSupported)
		{
			showToolbarText(pButton);
		}
		Analytics.LogEvent("select_power", "powerID", pButton.godPower.id);
	}

	public void showToolbarText(PowerButton pButton)
	{
		WorldTip.instance.showToolbarText(pButton.godPower);
	}

	internal void highlightButton(PowerButton pButton)
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)pButton == (Object)null))
		{
			buttonSelectionSprite.SetActive(true);
			RectTransform val = (RectTransform)buttonSelectionSprite.transform;
			((Transform)val).position = ((Component)pButton).transform.position;
			((Transform)val).SetParent(((Component)pButton).transform.parent);
			((Transform)val).localScale = Vector3.one;
			val.sizeDelta = pButton.rect_transform.sizeDelta;
		}
	}

	internal void clearHighlightedButton()
	{
		buttonSelectionSprite.SetActive(false);
	}

	private void Update()
	{
		updateSelectedPowerButtons();
		updateHideUiButton();
		updateSelectedUnitCancelButton();
	}

	private bool isSpecialTabActive()
	{
		if (SelectedUnit.isSet())
		{
			return true;
		}
		if (SelectedObjects.isNanoObjectSet())
		{
			return true;
		}
		return false;
	}

	private void updateSelectedUnitCancelButton()
	{
		if (!World.world.isAnyPowerSelected() && isSpecialTabActive() && !ScrollWindow.isWindowActive())
		{
			cancelUnitSelectedMover.setVisible(pVisible: true);
		}
		else
		{
			cancelUnitSelectedMover.setVisible(pVisible: false);
		}
	}

	private void updateHideUiButton()
	{
		if (Config.ui_main_hidden)
		{
			unhideButtonMover.setVisible(pVisible: true);
		}
		else
		{
			unhideButtonMover.setVisible(pVisible: false);
		}
	}

	private void updateSelectedPowerButtons()
	{
		PowerButton powerButton = selectedButton;
		GodPower godPower = (((Object)(object)powerButton != (Object)null) ? powerButton.godPower : null);
		if ((Object)(object)powerButton == (Object)null)
		{
			cancelButtMover.setVisible(pVisible: false);
		}
		else if (ScrollWindow.isWindowActive())
		{
			cancelButtMover.setVisible(pVisible: false);
		}
		else
		{
			cancelButtMover.setVisible(pVisible: true);
		}
		bool flag = MoveCamera.inSpectatorMode();
		if ((Object)(object)powerButton == (Object)null || ScrollWindow.isWindowActive() || flag)
		{
			sizeButtMover.setVisible(pVisible: false);
			sizeButton.hideSizes();
			if (flag)
			{
				clockButtMover.setVisible(pVisible: true);
			}
			else
			{
				clockButtMover.setVisible(pVisible: false);
				clockButton.hideSizes();
			}
		}
		else
		{
			powerButton.animate(Time.deltaTime);
			if (godPower.show_tool_sizes)
			{
				sizeButtMover.setVisible(pVisible: true);
			}
			else
			{
				sizeButtMover.setVisible(pVisible: false);
				sizeButton.hideSizes();
			}
			if (selectedButton.godPower.id == "clock")
			{
				clockButtMover.setVisible(pVisible: true);
			}
			else
			{
				clockButtMover.setVisible(pVisible: false);
				clockButton.hideSizes();
			}
		}
		if (CanvasMain.isBottomBarShowing())
		{
			toggleBottomElements(pState: true);
			if (_is_toolbar_temp_showed)
			{
				resetToolbarTempShow();
			}
		}
		else if (!_is_toolbar_temp_showed)
		{
			toggleBottomElements(pState: false);
		}
		pauseButtonMover.setVisible(flag);
		spectateUnitMover.setVisible(flag);
		updateTopButtons();
	}

	private void updateTopButtons()
	{
		if (bottomElementsMover.visible)
		{
			cancelButton.goDown = false;
			cancelButton.goUp = false;
			((Component)cancelButton).gameObject.SetActive(true);
			PremiumElementsChecker.checkElements();
			bool active = DebugConfig.isOn(DebugOption.DebugButton);
			DebugConfig.instance.debugButton.SetActive(active);
			((Component)clockButton).GetComponent<CancelButton>().goDown = false;
			joy_control_cancel_button.SetActive(false);
			return;
		}
		if (ControllableUnit.isControllingUnit())
		{
			((Component)cancelButton).gameObject.SetActive(false);
			PremiumElementsChecker.toggleActive(pState: false);
			DebugConfig.instance.debugButton.SetActive(false);
			joy_control_cancel_button.SetActive(true);
			Sprite spriteIcon = ControllableUnit.getControllableUnit().getActorAsset().getSpriteIcon();
			_joy_control_cancel_button_icon.sprite = spriteIcon;
		}
		bool flag = MoveCamera.inSpectatorMode();
		cancelButton.goDown = flag || (ControllableUnit.isControllingUnit() && !Config.joyControls);
		((Component)clockButton).GetComponent<CancelButton>().goDown = flag;
	}

	private void toggleBottomElements(bool pState, bool pNow = false)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Expected O, but got Unknown
		TweenCallback pCompleteCallback = null;
		if (!pState)
		{
			pCompleteCallback = (TweenCallback)delegate
			{
				buttons.SetActive(false);
				resetToolbarCanvasGroup();
			};
		}
		else
		{
			buttons.SetActive(true);
		}
		bottomElementsMover.setVisible(pState, pNow, pCompleteCallback);
	}

	public void showBarTemporary()
	{
		if (Config.game_loaded)
		{
			if (_toolbar_hide_routine != null)
			{
				((MonoBehaviour)this).StopCoroutine(_toolbar_hide_routine);
			}
			_is_toolbar_temp_showed = true;
			_toolbar_canvas_group.blocksRaycasts = false;
			_toolbar_canvas_group.alpha = 0.5f;
			toggleBottomElements(pState: true);
			_toolbar_hide_routine = ((MonoBehaviour)this).StartCoroutine(toolbarHideRoutine());
		}
	}

	private IEnumerator toolbarHideRoutine()
	{
		yield return (object)new WaitForSeconds(1f);
		toggleBottomElements(pState: false);
		_is_toolbar_temp_showed = false;
	}

	private void resetToolbarCanvasGroup()
	{
		_toolbar_canvas_group.blocksRaycasts = true;
		_toolbar_canvas_group.alpha = 1f;
	}

	private void resetToolbarTempShow()
	{
		resetToolbarCanvasGroup();
		_is_toolbar_temp_showed = false;
		if (_toolbar_hide_routine != null)
		{
			((MonoBehaviour)this).StopCoroutine(_toolbar_hide_routine);
		}
	}
}
// --- End of File: PowerButtonSelector.cs ---



// --- Start of File: PowerButtonType.cs ---
public enum PowerButtonType
{
	Library,
	Options,
	Active,
	BrushSize,
	BrushSizeMain,
	TimeScale,
	Shop,
	Special,
	Window
}
// --- End of File: PowerButtonType.cs ---



// --- Start of File: PowerClockButton.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PowerClockButton : MonoBehaviour
{
	public Image currentSpeedIcon;

	private string _latest_used = string.Empty;

	private void Update()
	{
		if (Config.time_scale_asset != null && Config.time_scale_asset.id != _latest_used)
		{
			_latest_used = Config.time_scale_asset.id;
			currentSpeedIcon.sprite = SpriteTextureLoader.getSprite(Config.time_scale_asset.path_icon);
		}
	}
}
// --- End of File: PowerClockButton.cs ---



// --- Start of File: PowerLibrary.cs ---
using System;
using System.Collections.Generic;
using Beebyte.Obfuscator;
using UnityEngine;
using strings;

[ObfuscateLiterals]
public class PowerLibrary : AssetLibrary<GodPower>
{
	private const string TEMPLATE_EXPLOSIVE_TILES = "$template_explosive_tiles$";

	private const string TEMPLATE_BOMBS = "$template_bombs$";

	private const string TEMPLATE_DROPS = "$template_drops$";

	private const string TEMPLATE_SEEDS = "$template_seeds$";

	private const string TEMPLATE_PLANTS = "$template_plants$";

	private const string TEMPLATE_DROP_MINERALS = "$template_minerals$";

	private const string TEMPLATE_DROP_BUILDING = "$template_drop_building$";

	private const string TEMPLATE_PRINTER = "$template_printer$";

	private const string TEMPLATE_SPAWN_SPECIAL = "$template_spawn_special$";

	private const string TEMPLATE_SPAWN_ACTOR = "$template_spawn_actor$";

	private const string TEMPLATE_TERRAFORM_TILES = "$template_terraform_tiles$";

	private const string TEMPLATE_WALL = "$template_wall$";

	private const string TEMPLATE_DRAW = "$template_draw$";

	private const string TEMPLATE_ERASER = "$template_eraser$";

	public static GodPower traits_gamma_rain_edit;

	public static GodPower traits_delta_rain_edit;

	public static GodPower traits_omega_rain_edit;

	public static GodPower equipment_rain_edit;

	public static GodPower inspect_unit;

	public override void init()
	{
		base.init();
		addCivsClassic();
		addCivsAnimals();
		addMobs();
		addSpecial();
		addTerraformTiles();
		addDestruction();
		addClouds();
		addPrinters();
		addDrops();
		addWaypoints();
	}

	private void addWaypoints()
	{
		clone("desire_alien_mold", "$template_drops$");
		t.name = "Alien Mold Desire";
		t.drop_id = t.id;
		clone("desire_computer", "$template_drops$");
		t.name = "Evil Computer Desire";
		t.drop_id = t.id;
		clone("desire_golden_egg", "$template_drops$");
		t.name = "Golden Egg Desire";
		t.drop_id = t.id;
		clone("desire_harp", "$template_drops$");
		t.name = "Ethereal Harp Desire";
		t.drop_id = t.id;
		clone("waypoint_alien_mold", "$template_drop_building$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Alien Mold";
		t.drop_id = t.id;
		clone("waypoint_computer", "$template_drop_building$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Evil Computer";
		t.drop_id = t.id;
		clone("waypoint_golden_egg", "$template_drop_building$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Golden Egg";
		t.drop_id = t.id;
		clone("waypoint_harp", "$template_drop_building$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Ethereal Harp";
		t.drop_id = t.id;
	}

	private void addTerraformTiles()
	{
		add(new GodPower
		{
			id = "$template_terraform_tiles$",
			draw_lines = true,
			terraform = true,
			type = PowerActionType.PowerDrawTile,
			mouse_hold_animation = MouseHoldAnimation.Draw,
			rank = PowerRank.Rank0_free,
			show_tool_sizes = true,
			unselect_when_window = true,
			hold_action = true,
			click_interval = 0f
		});
		t.click_action = cleanBurnedTile;
		GodPower godPower = t;
		godPower.click_action = (PowerActionWithID)Delegate.Combine(godPower.click_action, new PowerActionWithID(stopFire));
		GodPower godPower2 = t;
		godPower2.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower2.click_brush_action, new PowerActionWithID(fmodDrawingSound));
		GodPower godPower3 = t;
		godPower3.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower3.click_brush_action, new PowerActionWithID(loopWithCurrentBrush));
		GodPower godPower4 = t;
		godPower4.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower4.click_brush_action, new PowerActionWithID(drawingCursorEffect));
		clone("$template_draw$", "$template_terraform_tiles$");
		GodPower godPower5 = t;
		godPower5.click_action = (PowerActionWithID)Delegate.Combine(godPower5.click_action, new PowerActionWithID(drawTiles));
		clone("$template_wall$", "$template_draw$");
		t.make_buildings_transparent = true;
		t.force_brush = "sqr_0";
		t.show_tool_sizes = false;
		t.click_action = cleanBurnedTile;
		GodPower godPower6 = t;
		godPower6.click_action = (PowerActionWithID)Delegate.Combine(godPower6.click_action, new PowerActionWithID(stopFire));
		GodPower godPower7 = t;
		godPower7.click_action = (PowerActionWithID)Delegate.Combine(godPower7.click_action, new PowerActionWithID(destroyBuildings));
		GodPower godPower8 = t;
		godPower8.click_action = (PowerActionWithID)Delegate.Combine(godPower8.click_action, new PowerActionWithID(drawLifeEraser));
		GodPower godPower9 = t;
		godPower9.click_action = (PowerActionWithID)Delegate.Combine(godPower9.click_action, new PowerActionWithID(drawTiles));
		t.sound_drawing = "event:/SFX/POWERS/Mountains";
		clone("$template_eraser$", "$template_terraform_tiles$");
		t.click_action = flashPixel;
		clone("fuse", "$template_draw$");
		t.name = "Fuse";
		t.top_tile_type = "fuse";
		GodPower godPower10 = t;
		godPower10.click_action = (PowerActionWithID)Delegate.Combine(godPower10.click_action, new PowerActionWithID(destroyBuildings));
		GodPower godPower11 = t;
		godPower11.click_action = (PowerActionWithID)Delegate.Combine(godPower11.click_action, new PowerActionWithID(flashPixel));
		t.sound_drawing = "event:/SFX/POWERS/Fuse";
		clone("tile_deep_ocean", "$template_draw$");
		t.name = "Deep Ocean";
		t.tile_type = "pit_deep_ocean";
		t.path_icon = "iconTileDeepOcean";
		t.sound_drawing = "event:/SFX/POWERS/Pit";
		GodPower godPower12 = t;
		godPower12.click_action = (PowerActionWithID)Delegate.Combine(godPower12.click_action, new PowerActionWithID(destroyBuildings));
		clone("tile_close_ocean", "$template_draw$");
		t.name = "Close Ocean";
		t.tile_type = "pit_close_ocean";
		t.path_icon = "iconTileCloseOcean";
		t.sound_drawing = "event:/SFX/POWERS/Pit";
		GodPower godPower13 = t;
		godPower13.click_action = (PowerActionWithID)Delegate.Combine(godPower13.click_action, new PowerActionWithID(destroyBuildings));
		clone("tile_shallow_waters", "$template_draw$");
		t.name = "Shallow Waters";
		t.tile_type = "pit_shallow_waters";
		t.path_icon = "iconTileShallowWater";
		t.sound_drawing = "event:/SFX/POWERS/Pit";
		GodPower godPower14 = t;
		godPower14.click_action = (PowerActionWithID)Delegate.Combine(godPower14.click_action, new PowerActionWithID(destroyBuildings));
		clone("tile_sand", "$template_draw$");
		t.name = "Sand";
		t.tile_type = "sand";
		t.path_icon = "iconTileSand";
		t.sound_drawing = "event:/SFX/POWERS/Sand";
		clone("tile_soil", "$template_draw$");
		t.name = "Soil";
		t.tile_type = "soil_low";
		t.path_icon = "iconTileSoil";
		t.sound_drawing = "event:/SFX/POWERS/SoilLow";
		clone("tile_high_soil", "$template_draw$");
		t.name = "Soil High";
		t.tile_type = "soil_high";
		t.path_icon = "iconTileHighSoil";
		t.sound_drawing = "event:/SFX/POWERS/SoilHigh";
		clone("tile_hills", "$template_draw$");
		t.name = "Hills";
		t.tile_type = "hills";
		t.path_icon = "iconTileHills";
		GodPower godPower15 = t;
		godPower15.click_action = (PowerActionWithID)Delegate.Combine(godPower15.click_action, new PowerActionWithID(destroyBuildings));
		t.sound_drawing = "event:/SFX/POWERS/Hills";
		clone("tile_mountains", "$template_draw$");
		t.name = "Mountains";
		t.tile_type = "mountains";
		t.path_icon = "iconTileMountains";
		GodPower godPower16 = t;
		godPower16.click_action = (PowerActionWithID)Delegate.Combine(godPower16.click_action, new PowerActionWithID(destroyBuildings));
		t.sound_drawing = "event:/SFX/POWERS/Mountains";
		clone("tile_summit", "$template_draw$");
		t.name = "Summit";
		t.tile_type = "summit";
		t.path_icon = "iconTileSummit";
		GodPower godPower17 = t;
		godPower17.click_action = (PowerActionWithID)Delegate.Combine(godPower17.click_action, new PowerActionWithID(destroyBuildings));
		t.sound_drawing = "event:/SFX/POWERS/Mountains";
		clone("wall_order", "$template_wall$");
		t.name = "Stone Wall";
		t.top_tile_type = "wall_order";
		t.path_icon = "iconWallOrder";
		clone("wall_evil", "$template_wall$");
		t.name = "Wall of Evil";
		t.top_tile_type = "wall_evil";
		t.path_icon = "iconWallEvil";
		clone("wall_ancient", "$template_wall$");
		t.name = "Ancient Wall";
		t.top_tile_type = "wall_ancient";
		t.path_icon = "iconWallAncient";
		clone("wall_wild", "$template_wall$");
		t.name = "Wooden Wall";
		t.top_tile_type = "wall_wild";
		t.path_icon = "iconWallWild";
		clone("wall_green", "$template_wall$");
		t.name = "Green Wall";
		t.top_tile_type = "wall_green";
		t.path_icon = "iconWallGreen";
		clone("wall_iron", "$template_wall$");
		t.name = "Iron Wall";
		t.top_tile_type = "wall_iron";
		t.path_icon = "iconWallIron";
		clone("wall_light", "$template_wall$");
		t.name = "Wall of Light";
		t.top_tile_type = "wall_light";
		t.path_icon = "iconWallLight";
		clone("shovel_plus", "$template_terraform_tiles$");
		t.name = "Shovel Plus";
		t.path_icon = "iconShovelPlus";
		GodPower godPower18 = t;
		godPower18.click_action = (PowerActionWithID)Delegate.Combine(godPower18.click_action, new PowerActionWithID(drawShovelPlus));
		GodPower godPower19 = t;
		godPower19.click_action = (PowerActionWithID)Delegate.Combine(godPower19.click_action, new PowerActionWithID(destroyBuildings));
		GodPower godPower20 = t;
		godPower20.click_action = (PowerActionWithID)Delegate.Combine(godPower20.click_action, new PowerActionWithID(flashPixel));
		t.sound_drawing = "event:/SFX/POWERS/ShovelPlus";
		clone("shovel_minus", "$template_terraform_tiles$");
		t.name = "Shovel Minus";
		t.path_icon = "iconShovelMinus";
		GodPower godPower21 = t;
		godPower21.click_action = (PowerActionWithID)Delegate.Combine(godPower21.click_action, new PowerActionWithID(drawShovelMinus));
		GodPower godPower22 = t;
		godPower22.click_action = (PowerActionWithID)Delegate.Combine(godPower22.click_action, new PowerActionWithID(destroyBuildings));
		GodPower godPower23 = t;
		godPower23.click_action = (PowerActionWithID)Delegate.Combine(godPower23.click_action, new PowerActionWithID(flashPixel));
		t.sound_drawing = "event:/SFX/POWERS/ShovelMinus";
		clone("vortex", "$template_terraform_tiles$");
		t.name = "Vortex";
		t.path_icon = "iconVertex2";
		t.click_action = stopFire;
		t.sound_drawing = "event:/SFX/POWERS/Vortex";
		GodPower godPower24 = t;
		godPower24.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower24.click_brush_action, new PowerActionWithID(useVortex));
		clone("grey_goo", "$template_eraser$");
		t.name = "Grey Goo";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		GodPower godPower25 = t;
		godPower25.click_action = (PowerActionWithID)Delegate.Combine(godPower25.click_action, new PowerActionWithID(drawGreyGoo));
		GodPower godPower26 = t;
		godPower26.click_action = (PowerActionWithID)Delegate.Combine(godPower26.click_action, new PowerActionWithID(stopFire));
		t.sound_drawing = "event:/SFX/POWERS/GreyGoo";
		t.tester_enabled = false;
		clone("conway", "$template_eraser$");
		t.name = "Conway game of Life1";
		GodPower godPower27 = t;
		godPower27.click_action = (PowerActionWithID)Delegate.Combine(godPower27.click_action, new PowerActionWithID(drawConway));
		GodPower godPower28 = t;
		godPower28.click_action = (PowerActionWithID)Delegate.Combine(godPower28.click_action, new PowerActionWithID(stopFire));
		t.sound_drawing = "event:/SFX/POWERS/Conway";
		clone("conway_inverse", "$template_eraser$");
		t.name = "Conway game of Life2";
		GodPower godPower29 = t;
		godPower29.click_action = (PowerActionWithID)Delegate.Combine(godPower29.click_action, new PowerActionWithID(drawConwayInverse));
		GodPower godPower30 = t;
		godPower30.click_action = (PowerActionWithID)Delegate.Combine(godPower30.click_action, new PowerActionWithID(stopFire));
		t.sound_drawing = "event:/SFX/POWERS/Conway";
		clone("finger", "$template_eraser$");
		t.name = "Finger";
		t.path_icon = "iconTileFinger";
		GodPower godPower31 = t;
		godPower31.click_action = (PowerActionWithID)Delegate.Combine(godPower31.click_action, new PowerActionWithID(drawFinger));
		GodPower godPower32 = t;
		godPower32.click_action = (PowerActionWithID)Delegate.Combine(godPower32.click_action, new PowerActionWithID(stopFire));
		GodPower godPower33 = t;
		godPower33.click_action = (PowerActionWithID)Delegate.Combine(godPower33.click_action, new PowerActionWithID(cleanBurnedTile));
		t.sound_drawing = "event:/SFX/POWERS/Finger";
		clone("life_eraser", "$template_eraser$");
		GodPower godPower34 = t;
		godPower34.click_action = (PowerActionWithID)Delegate.Combine(godPower34.click_action, new PowerActionWithID(drawLifeEraser));
		t.name = "Life Eraser";
		t.sound_drawing = "event:/SFX/POWERS/LifeEraser";
		clone("demolish", "$template_eraser$");
		GodPower godPower35 = t;
		godPower35.click_action = (PowerActionWithID)Delegate.Combine(godPower35.click_action, new PowerActionWithID(drawDemolish));
		t.name = "Demolish";
		t.sound_drawing = "event:/SFX/POWERS/Demolish";
		clone("scissors", "$template_eraser$");
		t.path_icon = "iconScissors";
		t.force_map_mode = MetaType.City;
		GodPower godPower36 = t;
		godPower36.click_action = (PowerActionWithID)Delegate.Combine(godPower36.click_action, new PowerActionWithID(drawScissors));
		t.name = "Scissors";
		t.sound_drawing = "event:/SFX/POWERS/Demolish";
		clone("border_brush", "$template_eraser$");
		t.path_icon = "iconBorderBrush";
		t.force_map_mode = MetaType.City;
		GodPower godPower37 = t;
		godPower37.click_action = (PowerActionWithID)Delegate.Combine(godPower37.click_action, new PowerActionWithID(drawBorderBrush));
		t.name = "Border Brush";
		t.sound_drawing = "event:/SFX/POWERS/Demolish";
		clone("sponge", "$template_eraser$");
		t.path_icon = "iconSponge";
		GodPower godPower38 = t;
		godPower38.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower38.click_brush_action, new PowerActionWithID(removeClouds));
		GodPower godPower39 = t;
		godPower39.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower39.click_brush_action, new PowerActionWithID(removeTornadoes));
		GodPower godPower40 = t;
		godPower40.click_action = (PowerActionWithID)Delegate.Combine(godPower40.click_action, new PowerActionWithID(removeBuildingsBySponge));
		GodPower godPower41 = t;
		godPower41.click_action = (PowerActionWithID)Delegate.Combine(godPower41.click_action, new PowerActionWithID(removeGoo));
		GodPower godPower42 = t;
		godPower42.click_action = (PowerActionWithID)Delegate.Combine(godPower42.click_action, new PowerActionWithID(cleanBurnedTile));
		GodPower godPower43 = t;
		godPower43.click_action = (PowerActionWithID)Delegate.Combine(godPower43.click_action, new PowerActionWithID(stopFire));
		t.name = "Sponge";
		t.sound_drawing = "event:/SFX/POWERS/Sponge";
		clone("sickle", "$template_eraser$");
		t.path_icon = "iconSickle";
		GodPower godPower44 = t;
		godPower44.click_action = (PowerActionWithID)Delegate.Combine(godPower44.click_action, new PowerActionWithID(drawSickle));
		t.name = "Sickle";
		t.sound_event = "event:/SFX/POWERS/Sickle";
		t.sound_drawing = "event:/SFX/POWERS/Sickle";
		clone("spade", "$template_eraser$");
		t.path_icon = "iconSpade";
		GodPower godPower45 = t;
		godPower45.click_action = (PowerActionWithID)Delegate.Combine(godPower45.click_action, new PowerActionWithID(drawSpade));
		t.name = "Spade";
		t.sound_drawing = "event:/SFX/POWERS/Spade";
		clone("axe", "$template_eraser$");
		t.path_icon = "iconAxe";
		GodPower godPower46 = t;
		godPower46.click_action = (PowerActionWithID)Delegate.Combine(godPower46.click_action, new PowerActionWithID(drawAxe));
		t.name = "Axe";
		t.sound_drawing = "event:/SFX/POWERS/Axe";
		clone("bucket", "$template_eraser$");
		t.path_icon = "iconBucket";
		GodPower godPower47 = t;
		godPower47.click_action = (PowerActionWithID)Delegate.Combine(godPower47.click_action, new PowerActionWithID(drawBucket));
		t.name = "Bucket";
		t.sound_drawing = "event:/SFX/POWERS/Bucket";
		clone("pickaxe", "$template_eraser$");
		t.path_icon = "iconPickaxe";
		GodPower godPower48 = t;
		godPower48.click_action = (PowerActionWithID)Delegate.Combine(godPower48.click_action, new PowerActionWithID(drawPickaxe));
		t.name = "Pickaxe";
		t.sound_drawing = "event:/SFX/POWERS/Pickaxe";
		clone("divine_light", "$template_eraser$");
		t.path_icon = "iconDivineLight";
		GodPower godPower49 = t;
		godPower49.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower49.click_brush_action, new PowerActionWithID(divineLightFX));
		t.click_action = drawDivineLight;
		t.name = "Divine Light";
		t.show_tool_sizes = true;
		t.sound_drawing = "event:/SFX/POWERS/DivineLight";
	}

	private void addDrops()
	{
		add(new GodPower
		{
			id = "$template_drops$",
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true,
			falling_chance = 0.05f,
			type = PowerActionType.PowerSpawnDrops,
			mouse_hold_animation = MouseHoldAnimation.Sprinkle
		});
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower = t;
		godPower.click_power_brush_action = (PowerAction)Delegate.Combine(godPower.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		GodPower godPower2 = t;
		godPower2.click_power_action = (PowerAction)Delegate.Combine(godPower2.click_power_action, new PowerAction(fmodDrawingSound));
		t.surprises_units = false;
		clone("paint", "$template_drops$");
		t.name = "Paint";
		t.force_map_mode = MetaType.City;
		t.drop_id = t.id;
		clone("dust_white", "$template_drops$");
		t.name = "White Dust";
		t.drop_id = t.id;
		clone("dust_black", "$template_drops$");
		t.name = "Black Dust";
		t.drop_id = t.id;
		clone("dust_red", "$template_drops$");
		t.name = "Red Dust";
		t.drop_id = t.id;
		clone("dust_blue", "$template_drops$");
		t.name = "Blue Dust";
		t.drop_id = t.id;
		clone("dust_gold", "$template_drops$");
		t.name = "Gold Dust";
		t.drop_id = t.id;
		clone("dust_purple", "$template_drops$");
		t.name = "Purple Dust";
		t.drop_id = t.id;
		clone("$template_explosive_tiles$", "$template_drops$");
		t.falling_chance = 1f;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsRandom;
		GodPower godPower3 = t;
		godPower3.click_power_brush_action = (PowerAction)Delegate.Combine(godPower3.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		clone("tnt", "$template_explosive_tiles$");
		t.name = "tnt";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/Tnt";
		clone("tnt_timed", "$template_explosive_tiles$");
		t.name = "tnt_timed";
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/TntTimed";
		clone("water_bomb", "$template_explosive_tiles$");
		t.name = "Water Bomb";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/WaterBomb";
		clone("landmine", "$template_explosive_tiles$");
		t.name = "Landmine";
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/LandMine";
		clone("fireworks", "$template_explosive_tiles$");
		t.name = "Fireworks";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/Fireworks";
		clone("inspiration", "$template_drops$");
		t.force_map_mode = MetaType.City;
		t.name = "Inspiration";
		t.drop_id = t.id;
		t.path_icon = "iconInspiration";
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Inspiration";
		clone("discord", "$template_drops$");
		t.force_map_mode = MetaType.Alliance;
		t.name = "Discord";
		t.drop_id = t.id;
		t.path_icon = "iconDiscord";
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Inspiration";
		clone("friendship", "$template_drops$");
		t.force_map_mode = MetaType.Kingdom;
		t.name = "Friendship";
		t.path_icon = "iconFriendship";
		t.drop_id = t.id;
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Friendship";
		clone("spite", "$template_drops$");
		t.force_map_mode = MetaType.Kingdom;
		t.name = "Spite";
		t.path_icon = "iconSprite";
		t.drop_id = t.id;
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Spite";
		clone("madness", "$template_drops$");
		t.name = "Madness";
		t.falling_chance = 0.01f;
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/Madness";
		clone("blessing", "$template_drops$");
		t.name = "Blessing";
		t.drop_id = t.id;
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Blessing";
		clone("shield", "$template_drops$");
		t.name = "Shield";
		t.drop_id = t.id;
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Shield";
		clone("curse", "$template_drops$");
		t.name = "Curse";
		t.rank = PowerRank.Rank0_free;
		t.drop_id = t.id;
		t.falling_chance = 0.01f;
		t.sound_drawing = "event:/SFX/POWERS/Curse";
		clone("zombie_infection", "$template_drops$");
		t.name = "Zombie Infection";
		t.falling_chance = 0.01f;
		t.rank = PowerRank.Rank3_good;
		t.drop_id = t.id;
		t.requires_premium = true;
		t.sound_drawing = "event:/SFX/POWERS/ZombieInfection";
		clone("mush_spores", "$template_drops$");
		t.name = "Mush Spores";
		t.falling_chance = 0.01f;
		t.rank = PowerRank.Rank2_normal;
		t.drop_id = t.id;
		t.requires_premium = true;
		t.sound_drawing = "event:/SFX/POWERS/MushSpores";
		clone("coffee", "$template_drops$");
		t.name = "Coffee";
		t.falling_chance = 0.01f;
		t.rank = PowerRank.Rank1_common;
		t.drop_id = t.id;
		t.requires_premium = true;
		t.sound_drawing = "event:/SFX/POWERS/Coffee";
		clone("powerup", "$template_drops$");
		t.name = "Powerup";
		t.falling_chance = 0.01f;
		t.rank = PowerRank.Rank1_common;
		t.drop_id = t.id;
		t.requires_premium = true;
		t.sound_drawing = "event:/SFX/POWERS/Powerup";
		clone("plague", "$template_drops$");
		t.name = "Plague";
		t.drop_id = t.id;
		t.falling_chance = 0.01f;
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.sound_drawing = "event:/SFX/POWERS/Plague";
		clone("living_plants", "$template_drops$");
		t.name = "Living Plants";
		t.drop_id = t.id;
		t.actor_asset_id = "living_plants";
		t.falling_chance = 0.01f;
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		t.sound_drawing = "event:/SFX/POWERS/LivingPlants";
		t.surprises_units = true;
		clone("living_house", "$template_drops$");
		t.name = "Living Houses";
		t.drop_id = t.id;
		t.actor_asset_id = "living_house";
		t.falling_chance = 0.01f;
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		t.sound_drawing = "event:/SFX/POWERS/LivingHouses";
		t.surprises_units = true;
		clone("$template_bombs$", "$template_drops$");
		t.falling_chance = 1f;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsRandom;
		GodPower godPower4 = t;
		godPower4.click_power_brush_action = (PowerAction)Delegate.Combine(godPower4.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		clone("bomb", "$template_bombs$");
		t.name = "Bomb";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/Bomb";
		t.surprises_units = true;
		clone("grenade", "bomb");
		t.name = "Grenade";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/Grenade";
		clone("napalm_bomb", "bomb");
		t.name = "Napalm Bomb";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/NapalmBomb";
		clone("atomic_bomb", "$template_bombs$");
		t.name = "Atomic Bomb";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.sound_drawing = "event:/SFX/POWERS/AtomicBomb";
		t.surprises_units = true;
		clone("antimatter_bomb", "$template_bombs$");
		t.name = "Antimatter Bomb";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/AntimatterBomb";
		t.surprises_units = true;
		clone("czar_bomba", "$template_bombs$");
		t.name = "Tsar Bomba";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		t.sound_drawing = "event:/SFX/POWERS/TsarBomb";
		t.surprises_units = true;
		clone("crab_bomb", "bomb");
		t.name = "Crab Bomb";
		t.drop_id = t.id;
		t.sound_drawing = "event:/SFX/POWERS/CrabBomb";
		clone("rain", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Rain";
		t.falling_chance = 0.02f;
		t.sound_drawing = "event:/SFX/POWERS/Rain";
		clone("blood_rain", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Blood Rain";
		t.falling_chance = 0.02f;
		t.sound_drawing = "event:/SFX/POWERS/BloodRain";
		t.surprises_units = true;
		clone("clone_rain", "$template_drops$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		t.drop_id = t.id;
		t.name = "Clone Rain";
		t.falling_chance = 0.02f;
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower5 = t;
		godPower5.click_power_brush_action = (PowerAction)Delegate.Combine(godPower5.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/BloodRain";
		GodPower godPower6 = t;
		godPower6.click_power_action = (PowerAction)Delegate.Combine(godPower6.click_power_action, new PowerAction(fmodDrawingSound));
		clone("dispel", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Dispel";
		t.falling_chance = 0.02f;
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower7 = t;
		godPower7.click_power_brush_action = (PowerAction)Delegate.Combine(godPower7.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/BloodRain";
		GodPower godPower8 = t;
		godPower8.click_power_action = (PowerAction)Delegate.Combine(godPower8.click_power_action, new PowerAction(fmodDrawingSound));
		clone("sleep", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Sleep";
		t.falling_chance = 0.02f;
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower9 = t;
		godPower9.click_power_brush_action = (PowerAction)Delegate.Combine(godPower9.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/BloodRain";
		GodPower godPower10 = t;
		godPower10.click_power_action = (PowerAction)Delegate.Combine(godPower10.click_power_action, new PowerAction(fmodDrawingSound));
		clone("jazz", "$template_drops$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		t.drop_id = t.id;
		t.name = "Smooth Jazz";
		t.falling_chance = 0.02f;
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower11 = t;
		godPower11.click_power_brush_action = (PowerAction)Delegate.Combine(godPower11.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/BloodRain";
		GodPower godPower12 = t;
		godPower12.click_power_action = (PowerAction)Delegate.Combine(godPower12.click_power_action, new PowerAction(fmodDrawingSound));
		clone("fire", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Fire";
		t.falling_chance = 0.01f;
		t.particle_interval = 0.3f;
		t.sound_drawing = "event:/SFX/POWERS/Fire";
		t.surprises_units = true;
		clone("acid", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Acid";
		t.falling_chance = 0.02f;
		t.sound_drawing = "event:/SFX/POWERS/Acid";
		t.surprises_units = true;
		clone("lava", "$template_drops$");
		t.drop_id = t.id;
		t.name = "Lava";
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		t.falling_chance = 0.03f;
		t.sound_drawing = "event:/SFX/POWERS/Lava";
		t.surprises_units = true;
		add(new GodPower
		{
			id = "$template_seeds$",
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true,
			falling_chance = 0.05f,
			type = PowerActionType.PowerSpawnSeeds,
			mouse_hold_animation = MouseHoldAnimation.Sprinkle
		});
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower13 = t;
		godPower13.click_power_brush_action = (PowerAction)Delegate.Combine(godPower13.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		GodPower godPower14 = t;
		godPower14.click_power_action = (PowerAction)Delegate.Combine(godPower14.click_power_action, new PowerAction(fmodDrawingSound));
		t.surprises_units = false;
		clone("seeds_grass", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Grass Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_savanna", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Savanna Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsSavanna";
		clone("seeds_enchanted", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Enchanted Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsEnchanted";
		clone("seeds_corrupted", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Corrupted Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsCorrupted";
		clone("seeds_mushroom", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Mushroom Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsMushroom";
		clone("seeds_swamp", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Swamp Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsSwamp";
		clone("seeds_infernal", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Infernal Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsInfernal";
		clone("seeds_jungle", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Jungle Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsJungle";
		clone("seeds_desert", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Desert Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsDesert";
		clone("seeds_lemon", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Lemon Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsLemon";
		clone("seeds_permafrost", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Permafrost Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsPermafrost";
		clone("seeds_candy", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Candy Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsCandy";
		clone("seeds_crystal", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Crystal Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsCrystal";
		clone("seeds_birch", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Birch Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_maple", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Maple Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_rocklands", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Rocklands Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_garlic", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Garlic Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_flower", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Flower Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_celestial", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Celestial Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_singularity", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Singularity Swamp Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_clover", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Clover Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("seeds_paradox", "$template_seeds$");
		t.drop_id = t.id;
		t.name = "Paradox Seeds";
		t.sound_drawing = "event:/SFX/POWERS/SeedsGrass";
		clone("$template_plants$", "$template_seeds$");
		t.type = PowerActionType.PowerSpawnDrops;
		clone("fruit_bush", "$template_plants$");
		t.type = PowerActionType.PowerSpawnDrops;
		t.falling_chance = 1f;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsRandom;
		GodPower godPower15 = t;
		godPower15.click_power_brush_action = (PowerAction)Delegate.Combine(godPower15.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.drop_id = t.id;
		t.name = "Fruit Bush";
		t.sound_drawing = "event:/SFX/POWERS/FruitBush";
		clone("fertilizer_plants", "$template_plants$");
		t.falling_chance = 1f;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsRandom;
		GodPower godPower16 = t;
		godPower16.click_power_brush_action = (PowerAction)Delegate.Combine(godPower16.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.drop_id = t.id;
		t.name = "Plants Fertilizer";
		t.sound_drawing = "event:/SFX/POWERS/FertilizerPlants";
		clone("fertilizer_trees", "$template_plants$");
		t.falling_chance = 1f;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsRandom;
		GodPower godPower17 = t;
		godPower17.click_power_brush_action = (PowerAction)Delegate.Combine(godPower17.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.drop_id = t.id;
		t.name = "Trees Fertilizer";
		t.sound_drawing = "event:/SFX/POWERS/FertilizerTrees";
		add(new GodPower
		{
			id = "$template_drop_building$",
			unselect_when_window = true,
			type = PowerActionType.PowerSpawnBuilding,
			mouse_hold_animation = MouseHoldAnimation.Sprinkle,
			force_brush = "circ_1",
			set_used_camera_drag_on_long_move = true
		});
		t.click_power_action = spawnDrops;
		GodPower godPower18 = t;
		godPower18.click_power_action = (PowerAction)Delegate.Combine(godPower18.click_power_action, new PowerAction(flashPixel));
		clone("$template_minerals$", "$template_drops$");
		t.falling_chance = 1f;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsRandom;
		GodPower godPower19 = t;
		godPower19.click_power_brush_action = (PowerAction)Delegate.Combine(godPower19.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		clone("stone", "$template_minerals$");
		t.drop_id = t.id;
		t.name = "Stone";
		t.sound_drawing = "event:/SFX/POWERS/Minerals";
		clone("metals", "$template_minerals$");
		t.drop_id = t.id;
		t.name = "Ore Deposit";
		t.sound_drawing = "event:/SFX/POWERS/Minerals";
		clone("gold", "$template_minerals$");
		t.drop_id = t.id;
		t.name = "Gold";
		t.sound_drawing = "event:/SFX/POWERS/Minerals";
		clone("silver", "$template_minerals$");
		t.drop_id = t.id;
		t.name = "Silver";
		t.sound_drawing = "event:/SFX/POWERS/Minerals";
		clone("mythril", "$template_minerals$");
		t.drop_id = t.id;
		t.name = "Mythril";
		t.sound_drawing = "event:/SFX/POWERS/Minerals";
		clone("adamantine", "$template_minerals$");
		t.drop_id = t.id;
		t.name = "Adamantine";
		t.sound_drawing = "event:/SFX/POWERS/Minerals";
		clone("tumor", "$template_drop_building$");
		t.name = "Tumor";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		clone("biomass", "$template_drop_building$");
		t.name = "Biomass";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		clone("super_pumpkin", "$template_drop_building$");
		t.name = "Super Pumpkin";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		clone("cybercore", "$template_drop_building$");
		t.name = "Cybercore";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		clone("geyser", "$template_drop_building$");
		t.name = "Geyser";
		t.drop_id = t.id;
		clone("geyser_acid", "$template_drop_building$");
		t.name = "Acid Geyser";
		t.drop_id = t.id;
		clone("volcano", "$template_drop_building$");
		t.name = "Volcano";
		t.drop_id = t.id;
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		clone("golden_brain", "$template_drop_building$");
		t.name = "Golden Brain";
		t.drop_id = t.id;
		clone("monolith", "$template_drop_building$");
		t.name = "Monolith";
		t.requires_premium = true;
		t.rank = PowerRank.Rank5_noAwards;
		t.drop_id = t.id;
		clone("corrupted_brain", "$template_drop_building$");
		t.name = "Corrupted Brain";
		t.drop_id = t.id;
		clone("ice_tower", "$template_drop_building$");
		t.name = "Ice Tower";
		t.requires_premium = true;
		t.drop_id = t.id;
		t.rank = PowerRank.Rank3_good;
		clone("beehive", "$template_drop_building$");
		t.name = "Beehive";
		t.drop_id = t.id;
		t.rank = PowerRank.Rank1_common;
		clone("flame_tower", "$template_drop_building$");
		t.name = "Flame Tower";
		t.requires_premium = true;
		t.drop_id = t.id;
		t.rank = PowerRank.Rank3_good;
		clone("angle_tower", "$template_drop_building$");
		t.name = "Angle Tower";
		t.requires_premium = true;
		t.drop_id = t.id;
		t.rank = PowerRank.Rank5_noAwards;
	}

	private void addPrinters()
	{
		add(new GodPower
		{
			id = "$template_printer$",
			name = "Printer",
			unselect_when_window = true,
			actor_spawn_height = 3f,
			show_spawn_effect = true,
			actor_asset_id = "printer"
		});
		t.click_action = spawnPrinter;
		clone("printer_hexagon", "$template_printer$");
		t.printers_print = "hexagon";
		clone("printer_skull", "$template_printer$");
		t.printers_print = "skull";
		clone("printer_squares", "$template_printer$");
		t.printers_print = "squares";
		clone("printer_yinyang", "$template_printer$");
		t.printers_print = "yinyang";
		clone("printer_island1", "$template_printer$");
		t.printers_print = "island1";
		clone("printer_star", "$template_printer$");
		t.printers_print = "star";
		clone("printer_heart", "$template_printer$");
		t.printers_print = "heart";
		clone("printer_diamond", "$template_printer$");
		t.printers_print = "diamond";
		clone("printer_alien_drawing", "$template_printer$");
		t.printers_print = "aliendrawing";
		clone("printer_crater", "$template_printer$");
		t.printers_print = "crater";
		clone("printer_labyrinth", "$template_printer$");
		t.printers_print = "labyrinth";
		clone("printer_spiral", "$template_printer$");
		t.printers_print = "spiral";
		clone("printer_star_fort", "$template_printer$");
		t.printers_print = "starfort";
		clone("printer_code", "$template_printer$");
		t.printers_print = "code";
	}

	private void addClouds()
	{
		clone("cloud", "$template_spawn_special$");
		t.name = "Cloud of Life";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudOfLife;
		clone("cloud_rain", "$template_spawn_special$");
		t.name = "Rain Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudRain;
		clone("cloud_fire", "$template_spawn_special$");
		t.name = "Fire Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudFire;
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		clone("cloud_lightning", "$template_spawn_special$");
		t.name = "Thunder Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudLightning;
		clone("cloud_ash", "$template_spawn_special$");
		t.name = "Ash Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudAsh;
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		clone("cloud_magic", "$template_spawn_special$");
		t.name = "Magic Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudMagic;
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		clone("cloud_rage", "$template_spawn_special$");
		t.name = "Rage Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudRage;
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		clone("cloud_acid", "$template_spawn_special$");
		t.name = "Acid Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudAcid;
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		clone("cloud_lava", "$template_spawn_special$");
		t.name = "Lava Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudLava;
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		clone("cloud_snow", "$template_spawn_special$");
		t.name = "Snow Cloud";
		t.multiple_spawn_tip = true;
		t.click_action = spawnCloudSnow;
	}

	private void addDestruction()
	{
		add(new GodPower
		{
			id = "$template_spawn_special$",
			name = "$template_spawn_special$",
			unselect_when_window = true,
			set_used_camera_drag_on_long_move = true
		});
		clone("force", "$template_spawn_special$");
		t.name = "Force";
		GodPower godPower = t;
		godPower.click_action = (PowerActionWithID)Delegate.Combine(godPower.click_action, new PowerActionWithID(spawnForce));
		clone("finger_flick", "$template_spawn_special$");
		t.show_close_actor = true;
		t.name = "finger_flick";
		GodPower godPower2 = t;
		godPower2.click_action = (PowerActionWithID)Delegate.Combine(godPower2.click_action, new PowerActionWithID(fingerFlick));
		add(new GodPower
		{
			id = "infinity_coin",
			name = "Infinity Coin",
			multiple_spawn_tip = true,
			set_used_camera_drag_on_long_move = true
		});
		GodPower godPower3 = t;
		godPower3.click_action = (PowerActionWithID)Delegate.Combine(godPower3.click_action, new PowerActionWithID(spawnInfinityCoin));
		add(new GodPower
		{
			id = "heatray",
			name = "Heatray",
			requires_premium = true,
			rank = PowerRank.Rank2_normal,
			force_brush = "circ_10",
			show_tool_sizes = false,
			unselect_when_window = true,
			hold_action = true
		});
		GodPower godPower4 = t;
		godPower4.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower4.click_brush_action, new PowerActionWithID(heatrayFX));
		GodPower godPower5 = t;
		godPower5.click_action = (PowerActionWithID)Delegate.Combine(godPower5.click_action, new PowerActionWithID(drawHeatray));
		GodPower godPower6 = t;
		godPower6.click_action = (PowerActionWithID)Delegate.Combine(godPower6.click_action, new PowerActionWithID(flashPixel));
		add(new GodPower
		{
			id = "meteorite",
			name = "Meteorite",
			requires_premium = true,
			rank = PowerRank.Rank3_good,
			unselect_when_window = true,
			set_used_camera_drag_on_long_move = true,
			show_spawn_effect = true,
			multiple_spawn_tip = true
		});
		GodPower godPower7 = t;
		godPower7.click_action = (PowerActionWithID)Delegate.Combine(godPower7.click_action, new PowerActionWithID(spawnMeteorite));
		add(new GodPower
		{
			id = "bowling_ball",
			name = "Bowling Ball",
			requires_premium = true,
			rank = PowerRank.Rank2_normal,
			unselect_when_window = true,
			show_spawn_effect = true,
			hold_action = true,
			sound_drawing = "event:/SFX/POWERS/DivineMagnet",
			multiple_spawn_tip = true
		});
		GodPower godPower8 = t;
		godPower8.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower8.click_brush_action, new PowerActionWithID(prepareBoulder));
		GodPower godPower9 = t;
		godPower9.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower9.click_brush_action, new PowerActionWithID(fmodDrawingSound));
		add(new GodPower
		{
			id = "robot_santa",
			name = "Robot Santa",
			requires_premium = false,
			rank = PowerRank.Rank0_free,
			unselect_when_window = true,
			set_used_camera_drag_on_long_move = true,
			show_spawn_effect = true,
			multiple_spawn_tip = true
		});
		GodPower godPower10 = t;
		godPower10.click_action = (PowerActionWithID)Delegate.Combine(godPower10.click_action, new PowerActionWithID(spawnSanta));
		add(new GodPower
		{
			id = "lightning",
			name = "Lightning",
			unselect_when_window = true,
			set_used_camera_drag_on_long_move = true
		});
		GodPower godPower11 = t;
		godPower11.click_action = (PowerActionWithID)Delegate.Combine(godPower11.click_action, new PowerActionWithID(spawnLightning));
		add(new GodPower
		{
			id = "earthquake",
			name = "Earthquake",
			unselect_when_window = true,
			set_used_camera_drag_on_long_move = true
		});
		GodPower godPower12 = t;
		godPower12.click_action = (PowerActionWithID)Delegate.Combine(godPower12.click_action, new PowerActionWithID(spawnEarthquake));
		add(new GodPower
		{
			id = "tornado",
			name = "Tornado",
			requires_premium = true,
			rank = PowerRank.Rank3_good,
			unselect_when_window = true,
			set_used_camera_drag_on_long_move = true,
			show_spawn_effect = true,
			multiple_spawn_tip = true
		});
		GodPower godPower13 = t;
		godPower13.click_action = (PowerActionWithID)Delegate.Combine(godPower13.click_action, new PowerActionWithID(spawnTornado));
	}

	private void addSpecial()
	{
		add(new GodPower
		{
			id = "temperature_plus",
			name = "Temperature",
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true
		});
		t.click_action = drawTemperaturePlus;
		GodPower godPower = t;
		godPower.click_action = (PowerActionWithID)Delegate.Combine(godPower.click_action, new PowerActionWithID(flashPixel));
		t.click_brush_action = loopWithCurrentBrush;
		GodPower godPower2 = t;
		godPower2.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower2.click_brush_action, new PowerActionWithID(fmodDrawingSound));
		t.sound_drawing = "event:/SFX/POWERS/IncreaseTemperature";
		clone("temperature_minus", "temperature_plus");
		t.click_action = drawTemperatureMinus;
		GodPower godPower3 = t;
		godPower3.click_action = (PowerActionWithID)Delegate.Combine(godPower3.click_action, new PowerActionWithID(flashPixel));
		t.sound_drawing = "event:/SFX/POWERS/DecreaseTemperature";
		add(new GodPower
		{
			id = "magnet",
			name = "Magnet",
			show_tool_sizes = true,
			hold_action = true,
			highlight = true,
			sound_drawing = "event:/SFX/POWERS/DivineMagnet",
			unselect_when_window = true
		});
		t.click_brush_action = useMagnet;
		GodPower godPower4 = t;
		godPower4.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower4.click_brush_action, new PowerActionWithID(flashBrushPixelsDuringClick));
		GodPower godPower5 = t;
		godPower5.click_brush_action = (PowerActionWithID)Delegate.Combine(godPower5.click_brush_action, new PowerActionWithID(fmodDrawingSound));
		add(new GodPower
		{
			id = "hide_ui",
			name = "hide_ui",
			path_icon = "iconHideUI",
			rank = PowerRank.Rank0_free
		});
		t.select_button_action = clickHideUI;
		t.tester_enabled = false;
		t.activate_on_hotkey_select = false;
		traits_gamma_rain_edit = add(new GodPower
		{
			id = "traits_gamma_rain_edit",
			name = "Gamma Rain",
			path_icon = "iconRainGammaEdit",
			requires_premium = true,
			rank = PowerRank.Rank5_noAwards
		});
		t.select_button_action = clickTraitEditorRainButton;
		t.tester_enabled = false;
		t.activate_on_hotkey_select = false;
		traits_delta_rain_edit = add(new GodPower
		{
			id = "traits_delta_rain_edit",
			name = "Delta Rain",
			path_icon = "iconRainDeltaEdit",
			requires_premium = true,
			rank = PowerRank.Rank5_noAwards
		});
		t.select_button_action = clickTraitEditorRainButton;
		t.tester_enabled = false;
		t.activate_on_hotkey_select = false;
		traits_omega_rain_edit = add(new GodPower
		{
			id = "traits_omega_rain_edit",
			name = "Omega Rain",
			path_icon = "iconRainOmegaEdit",
			requires_premium = true,
			rank = PowerRank.Rank5_noAwards
		});
		t.select_button_action = clickTraitEditorRainButton;
		t.tester_enabled = false;
		t.activate_on_hotkey_select = false;
		add(new GodPower
		{
			id = "traits_gamma_rain",
			name = "Gamma Rain",
			path_icon = "iconRainGammaEdit",
			requires_premium = true,
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true,
			falling_chance = 0.05f,
			rank = PowerRank.Rank5_noAwards
		});
		t.drop_id = "gamma_rain";
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower6 = t;
		godPower6.click_power_brush_action = (PowerAction)Delegate.Combine(godPower6.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/GammaRain";
		GodPower godPower7 = t;
		godPower7.click_power_action = (PowerAction)Delegate.Combine(godPower7.click_power_action, new PowerAction(fmodDrawingSound));
		add(new GodPower
		{
			id = "traits_delta_rain",
			name = "Delta Rain",
			path_icon = "iconRainDeltaEdit",
			requires_premium = true,
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true,
			falling_chance = 0.05f,
			rank = PowerRank.Rank5_noAwards
		});
		t.drop_id = "delta_rain";
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower8 = t;
		godPower8.click_power_brush_action = (PowerAction)Delegate.Combine(godPower8.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/DeltaRain";
		GodPower godPower9 = t;
		godPower9.click_power_action = (PowerAction)Delegate.Combine(godPower9.click_power_action, new PowerAction(fmodDrawingSound));
		add(new GodPower
		{
			id = "traits_omega_rain",
			name = "Omega Rain",
			path_icon = "iconRainOmegaEdit",
			requires_premium = true,
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true,
			falling_chance = 0.05f,
			rank = PowerRank.Rank5_noAwards
		});
		t.drop_id = "omega_rain";
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower10 = t;
		godPower10.click_power_brush_action = (PowerAction)Delegate.Combine(godPower10.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/OmegaRain";
		GodPower godPower11 = t;
		godPower11.click_power_action = (PowerAction)Delegate.Combine(godPower11.click_power_action, new PowerAction(fmodDrawingSound));
		equipment_rain_edit = add(new GodPower
		{
			id = "equipment_rain_edit",
			name = "Loot Rain",
			path_icon = "iconRainGammaEdit",
			requires_premium = true,
			rank = PowerRank.Rank5_noAwards
		});
		t.select_button_action = clickEquipmentEditorRainButton;
		t.tester_enabled = false;
		t.activate_on_hotkey_select = false;
		add(new GodPower
		{
			id = "equipment_rain",
			name = "Loot Rain",
			path_icon = "iconRainLootEdit",
			requires_premium = true,
			hold_action = true,
			show_tool_sizes = true,
			unselect_when_window = true,
			falling_chance = 0.05f,
			rank = PowerRank.Rank5_noAwards
		});
		t.drop_id = "loot_rain";
		t.click_power_action = spawnDrops;
		t.click_power_brush_action = loopWithCurrentBrushPowerForDropsFull;
		GodPower godPower12 = t;
		godPower12.click_power_brush_action = (PowerAction)Delegate.Combine(godPower12.click_power_brush_action, new PowerAction(flashBrushPixelsDuringClick));
		t.sound_drawing = "event:/SFX/POWERS/GammaRain";
		GodPower godPower13 = t;
		godPower13.click_power_action = (PowerAction)Delegate.Combine(godPower13.click_power_action, new PowerAction(fmodDrawingSound));
		add(new GodPower
		{
			id = "city_select",
			name = "Select City",
			force_map_mode = MetaType.City,
			path_icon = "iconCityInspect",
			can_drag_map = true
		});
		t.tester_enabled = false;
		t.track_activity = false;
		GodPower godPower14 = t;
		godPower14.click_action = (PowerActionWithID)Delegate.Combine(godPower14.click_action, new PowerActionWithID(ActionLibrary.inspectCity));
		add(new GodPower
		{
			id = "relations",
			name = "Relations",
			force_map_mode = MetaType.Kingdom,
			path_icon = "iconDiplomacy",
			can_drag_map = true
		});
		GodPower godPower15 = t;
		godPower15.select_button_action = (PowerButtonClickAction)Delegate.Combine(godPower15.select_button_action, new PowerButtonClickAction(ActionLibrary.selectRelations));
		GodPower godPower16 = t;
		godPower16.click_special_action = (PowerActionWithID)Delegate.Combine(godPower16.click_special_action, new PowerActionWithID(ActionLibrary.clickRelations));
		t.tester_enabled = false;
		add(new GodPower
		{
			id = "whisper_of_war",
			name = "Whisper of War",
			force_map_mode = MetaType.Kingdom,
			path_icon = "iconWhisperOfWar",
			can_drag_map = true
		});
		GodPower godPower17 = t;
		godPower17.select_button_action = (PowerButtonClickAction)Delegate.Combine(godPower17.select_button_action, new PowerButtonClickAction(ActionLibrary.selectWhisperOfWar));
		GodPower godPower18 = t;
		godPower18.click_special_action = (PowerActionWithID)Delegate.Combine(godPower18.click_special_action, new PowerActionWithID(ActionLibrary.clickWhisperOfWar));
		t.tester_enabled = false;
		add(new GodPower
		{
			id = "unity",
			name = "unity",
			force_map_mode = MetaType.Alliance,
			path_icon = "iconUnity",
			can_drag_map = true
		});
		GodPower godPower19 = t;
		godPower19.select_button_action = (PowerButtonClickAction)Delegate.Combine(godPower19.select_button_action, new PowerButtonClickAction(ActionLibrary.selectUnity));
		GodPower godPower20 = t;
		godPower20.click_special_action = (PowerActionWithID)Delegate.Combine(godPower20.click_special_action, new PowerActionWithID(ActionLibrary.clickUnity));
		t.tester_enabled = false;
		inspect_unit = add(new GodPower
		{
			id = "inspect",
			name = "inspect",
			can_drag_map = true,
			set_used_camera_drag_on_long_move = true
		});
		t.tester_enabled = false;
		GodPower godPower21 = t;
		godPower21.click_action = (PowerActionWithID)Delegate.Combine(godPower21.click_action, new PowerActionWithID(ActionLibrary.inspectUnit));
		t.allow_unit_selection = true;
		add(new GodPower
		{
			id = "map_names",
			name = "Map Names",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.toggle_name = "map_names";
		GodPower godPower22 = t;
		godPower22.toggle_action = (PowerToggleAction)Delegate.Combine(godPower22.toggle_action, new PowerToggleAction(toggleMultiOption));
		add(new GodPower
		{
			id = "map_layers",
			name = "map_layers",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "map_layers";
		GodPower godPower23 = t;
		godPower23.toggle_action = (PowerToggleAction)Delegate.Combine(godPower23.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "map_species_families",
			name = "map_species_families",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "map_species_families";
		GodPower godPower24 = t;
		godPower24.toggle_action = (PowerToggleAction)Delegate.Combine(godPower24.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "city_layer",
			name = "city_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_city_layer";
		GodPower godPower25 = t;
		godPower25.toggle_action = (PowerToggleAction)Delegate.Combine(godPower25.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "culture_layer",
			name = "culture_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_culture_layer";
		GodPower godPower26 = t;
		godPower26.toggle_action = (PowerToggleAction)Delegate.Combine(godPower26.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "subspecies_layer",
			name = "subspecies_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_subspecies_layer";
		GodPower godPower27 = t;
		godPower27.toggle_action = (PowerToggleAction)Delegate.Combine(godPower27.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "family_layer",
			name = "family_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_family_layer";
		GodPower godPower28 = t;
		godPower28.toggle_action = (PowerToggleAction)Delegate.Combine(godPower28.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "language_layer",
			name = "language_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_language_layer";
		GodPower godPower29 = t;
		godPower29.toggle_action = (PowerToggleAction)Delegate.Combine(godPower29.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "religion_layer",
			name = "religion_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_religion_layer";
		GodPower godPower30 = t;
		godPower30.toggle_action = (PowerToggleAction)Delegate.Combine(godPower30.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "clan_layer",
			name = "clan_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_clan_layer";
		GodPower godPower31 = t;
		godPower31.toggle_action = (PowerToggleAction)Delegate.Combine(godPower31.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "kingdom_layer",
			name = "kingdom_layer",
			unselect_when_window = true,
			multi_toggle = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_kingdom_layer";
		GodPower godPower32 = t;
		godPower32.toggle_action = (PowerToggleAction)Delegate.Combine(godPower32.toggle_action, new PowerToggleAction(toggleOptionZone));
		add(new GodPower
		{
			id = "alliance_layer",
			name = "alliance_layer",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_alliance_layer";
		GodPower godPower33 = t;
		godPower33.toggle_action = (PowerToggleAction)Delegate.Combine(godPower33.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "army_layer",
			name = "army_layer",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.map_modes_switch = true;
		t.toggle_name = "map_army_layer";
		GodPower godPower34 = t;
		godPower34.toggle_action = (PowerToggleAction)Delegate.Combine(godPower34.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "map_kings_leaders",
			name = "map_kings_leaders",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "map_kings_leaders";
		GodPower godPower35 = t;
		godPower35.toggle_action = (PowerToggleAction)Delegate.Combine(godPower35.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_favorites",
			name = "marks_favorites",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_favorites";
		GodPower godPower36 = t;
		godPower36.toggle_action = (PowerToggleAction)Delegate.Combine(godPower36.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_favorite_items",
			name = "marks_favorite_items",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_favorite_items";
		GodPower godPower37 = t;
		godPower37.toggle_action = (PowerToggleAction)Delegate.Combine(godPower37.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_armies",
			name = "Show Armies",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_armies";
		GodPower godPower38 = t;
		godPower38.toggle_action = (PowerToggleAction)Delegate.Combine(godPower38.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_battles",
			name = "Show Battles",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_battles";
		GodPower godPower39 = t;
		godPower39.toggle_action = (PowerToggleAction)Delegate.Combine(godPower39.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_plots",
			name = "Plot Icons",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_plots";
		GodPower godPower40 = t;
		godPower40.toggle_action = (PowerToggleAction)Delegate.Combine(godPower40.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_wars",
			name = "War Icons",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_wars";
		GodPower godPower41 = t;
		godPower41.toggle_action = (PowerToggleAction)Delegate.Combine(godPower41.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "highlight_kingdom_enemies",
			name = "Highlight Kingdom Enemies",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "highlight_kingdom_enemies";
		GodPower godPower42 = t;
		godPower42.toggle_action = (PowerToggleAction)Delegate.Combine(godPower42.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "only_favorited_meta",
			name = "only_favorited_meta",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "only_favorited_meta";
		GodPower godPower43 = t;
		godPower43.toggle_action = (PowerToggleAction)Delegate.Combine(godPower43.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "unit_metas",
			name = "unit_metas",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "unit_metas";
		GodPower godPower44 = t;
		godPower44.toggle_action = (PowerToggleAction)Delegate.Combine(godPower44.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "money_flow",
			name = "money_flow",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "money_flow";
		GodPower godPower45 = t;
		godPower45.toggle_action = (PowerToggleAction)Delegate.Combine(godPower45.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "meta_conversions",
			name = "meta_conversions",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "meta_conversions";
		GodPower godPower46 = t;
		godPower46.toggle_action = (PowerToggleAction)Delegate.Combine(godPower46.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "talk_bubbles",
			name = "talk_bubbles",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "talk_bubbles";
		GodPower godPower47 = t;
		godPower47.toggle_action = (PowerToggleAction)Delegate.Combine(godPower47.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "icons_happiness",
			name = "icons_happiness",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "icons_happiness";
		GodPower godPower48 = t;
		godPower48.toggle_action = (PowerToggleAction)Delegate.Combine(godPower48.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "icons_tasks",
			name = "icons_tasks",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "icons_tasks";
		GodPower godPower49 = t;
		godPower49.toggle_action = (PowerToggleAction)Delegate.Combine(godPower49.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "army_targets",
			name = "Army Targets",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "army_targets";
		GodPower godPower50 = t;
		godPower50.toggle_action = (PowerToggleAction)Delegate.Combine(godPower50.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "tooltip_zones",
			name = "Tooltip Zones",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "tooltip_zones";
		GodPower godPower51 = t;
		godPower51.toggle_action = (PowerToggleAction)Delegate.Combine(godPower51.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "tooltip_units",
			name = "Tooltip Units",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "tooltip_units";
		GodPower godPower52 = t;
		godPower52.toggle_action = (PowerToggleAction)Delegate.Combine(godPower52.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_destination",
			name = "cursor_arrow_destination",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_destination";
		GodPower godPower53 = t;
		godPower53.toggle_action = (PowerToggleAction)Delegate.Combine(godPower53.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_lover",
			name = "cursor_arrow_lover",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_lover";
		GodPower godPower54 = t;
		godPower54.toggle_action = (PowerToggleAction)Delegate.Combine(godPower54.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_house",
			name = "cursor_arrow_house",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_house";
		GodPower godPower55 = t;
		godPower55.toggle_action = (PowerToggleAction)Delegate.Combine(godPower55.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_family",
			name = "cursor_arrow_family",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_family";
		GodPower godPower56 = t;
		godPower56.toggle_action = (PowerToggleAction)Delegate.Combine(godPower56.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_parents",
			name = "cursor_arrow_parents",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_parents";
		GodPower godPower57 = t;
		godPower57.toggle_action = (PowerToggleAction)Delegate.Combine(godPower57.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_kids",
			name = "cursor_arrow_kids",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_kids";
		GodPower godPower58 = t;
		godPower58.toggle_action = (PowerToggleAction)Delegate.Combine(godPower58.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "cursor_arrow_attack_target",
			name = "cursor_arrow_attack_target",
			unselect_when_window = true
		});
		t.disabled_on_mobile = true;
		t.tester_enabled = false;
		t.toggle_name = "cursor_arrow_attack_target";
		GodPower godPower59 = t;
		godPower59.toggle_action = (PowerToggleAction)Delegate.Combine(godPower59.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "marks_boats",
			name = "marks_boats",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "marks_boats";
		GodPower godPower60 = t;
		godPower60.toggle_action = (PowerToggleAction)Delegate.Combine(godPower60.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "history_log",
			name = "History Log",
			unselect_when_window = true
		});
		t.tester_enabled = false;
		t.toggle_name = "history_log";
		GodPower godPower61 = t;
		godPower61.toggle_action = (PowerToggleAction)Delegate.Combine(godPower61.toggle_action, new PowerToggleAction(toggleOption));
		add(new GodPower
		{
			id = "pause",
			name = "Pause",
			unselect_when_window = true,
			can_drag_map = true
		});
		t.tester_enabled = false;
		t.activate_on_hotkey_select = false;
		add(new GodPower
		{
			id = "clock",
			name = "Clock",
			unselect_when_window = true,
			requires_premium = true,
			ignore_cursor_icon = true,
			rank = PowerRank.Rank0_free,
			can_drag_map = true
		});
		t.tester_enabled = false;
		t.allow_unit_selection = true;
		add(new GodPower
		{
			id = "follow_unit",
			name = "follow_unit",
			unselect_when_window = true,
			can_drag_map = true
		});
		t.tester_enabled = false;
		t.allow_unit_selection = true;
	}

	private void addCivsAnimals()
	{
		clone("civ_cat", "$template_spawn_actor$");
		t.name = "civ_cat";
		t.actor_asset_id = "civ_cat";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_dog", "$template_spawn_actor$");
		t.name = "civ_dog";
		t.actor_asset_id = "civ_dog";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_chicken", "$template_spawn_actor$");
		t.name = "civ_chicken";
		t.actor_asset_id = "civ_chicken";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_rabbit", "$template_spawn_actor$");
		t.name = "civ_rabbit";
		t.actor_asset_id = "civ_rabbit";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_monkey", "$template_spawn_actor$");
		t.name = "civ_monkey";
		t.actor_asset_id = "civ_monkey";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_fox", "$template_spawn_actor$");
		t.name = "civ_fox";
		t.actor_asset_id = "civ_fox";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_sheep", "$template_spawn_actor$");
		t.name = "civ_sheep";
		t.actor_asset_id = "civ_sheep";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_cow", "$template_spawn_actor$");
		t.name = "civ_cow";
		t.actor_asset_id = "civ_cow";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_armadillo", "$template_spawn_actor$");
		t.name = "civ_armadillo";
		t.actor_asset_id = "civ_armadillo";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_wolf", "$template_spawn_actor$");
		t.name = "civ_wolf";
		t.actor_asset_id = "civ_wolf";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_bear", "$template_spawn_actor$");
		t.name = "civ_bear";
		t.actor_asset_id = "civ_bear";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_rhino", "$template_spawn_actor$");
		t.name = "civ_rhino";
		t.actor_asset_id = "civ_rhino";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_buffalo", "$template_spawn_actor$");
		t.name = "civ_buffalo";
		t.actor_asset_id = "civ_buffalo";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_hyena", "$template_spawn_actor$");
		t.name = "civ_hyena";
		t.actor_asset_id = "civ_hyena";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_rat", "$template_spawn_actor$");
		t.name = "civ_rat";
		t.actor_asset_id = "civ_rat";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_alpaca", "$template_spawn_actor$");
		t.name = "civ_alpaca";
		t.actor_asset_id = "civ_alpaca";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_capybara", "$template_spawn_actor$");
		t.name = "civ_capybara";
		t.actor_asset_id = "civ_capybara";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_goat", "$template_spawn_actor$");
		t.name = "civ_goat";
		t.actor_asset_id = "civ_goat";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_crab", "$template_spawn_actor$");
		t.name = "civ_crab";
		t.actor_asset_id = "civ_crab";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_penguin", "$template_spawn_actor$");
		t.name = "civ_penguin";
		t.actor_asset_id = "civ_penguin";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_turtle", "$template_spawn_actor$");
		t.name = "civ_turtle";
		t.actor_asset_id = "civ_turtle";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_crocodile", "$template_spawn_actor$");
		t.name = "civ_crocodile";
		t.actor_asset_id = "civ_crocodile";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_snake", "$template_spawn_actor$");
		t.name = "civ_snake";
		t.actor_asset_id = "civ_snake";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_frog", "$template_spawn_actor$");
		t.name = "civ_frog";
		t.actor_asset_id = "civ_frog";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_piranha", "$template_spawn_actor$");
		t.name = "civ_piranha";
		t.actor_asset_id = "civ_piranha";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_scorpion", "$template_spawn_actor$");
		t.name = "civ_scorpion";
		t.actor_asset_id = "civ_scorpion";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_candy_man", "$template_spawn_actor$");
		t.name = "civ_candy_man";
		t.actor_asset_id = "civ_candy_man";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_crystal_golem", "$template_spawn_actor$");
		t.name = "civ_crystal_golem";
		t.actor_asset_id = "civ_crystal_golem";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_liliar", "$template_spawn_actor$");
		t.name = "civ_liliar";
		t.actor_asset_id = "civ_liliar";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_garlic_man", "$template_spawn_actor$");
		t.name = "civ_garlic_man";
		t.actor_asset_id = "civ_garlic_man";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_lemon_man", "$template_spawn_actor$");
		t.name = "civ_lemon_man";
		t.actor_asset_id = "civ_lemon_man";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_acid_gentleman", "$template_spawn_actor$");
		t.name = "civ_acid_gentleman";
		t.actor_asset_id = "civ_acid_gentleman";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_beetle", "$template_spawn_actor$");
		t.name = "civ_beetle";
		t.actor_asset_id = "civ_beetle";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_seal", "$template_spawn_actor$");
		t.name = "civ_seal";
		t.actor_asset_id = "civ_seal";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		clone("civ_unicorn", "$template_spawn_actor$");
		t.name = "civ_unicorn";
		t.actor_asset_id = "civ_unicorn";
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
	}

	private void addMobs()
	{
		clone("cold_one", "$template_spawn_actor$");
		t.name = "Cold Ones";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "cold_one";
		clone("demon", "$template_spawn_actor$");
		t.name = "Demon";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "demon";
		clone("angle", "$template_spawn_actor$");
		t.name = "Angle";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "angle";
		clone("tumor_monster_unit", "$template_spawn_actor$");
		t.name = "Tumor Monster";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_ids = AssetLibrary<GodPower>.a<string>("tumor_monster_unit", "tumor_monster_animal");
		clone("mush_unit", "$template_spawn_actor$");
		t.name = "Mush";
		t.requires_premium = false;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_ids = AssetLibrary<GodPower>.a<string>("mush_unit", "mush_animal");
		clone("bioblob", "$template_spawn_actor$");
		t.name = "Bioblob";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "bioblob";
		clone("lil_pumpkin", "$template_spawn_actor$");
		t.name = "Lil Pumpkin";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "lil_pumpkin";
		clone("assimilator", "$template_spawn_actor$");
		t.name = "Assimilator";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "assimilator";
		clone("necromancer", "$template_spawn_actor$");
		t.name = "Necromancer";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "necromancer";
		clone("druid", "$template_spawn_actor$");
		t.name = "Druid";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "druid";
		clone("plague_doctor", "$template_spawn_actor$");
		t.name = "Plague Doctor";
		t.actor_asset_id = "plague_doctor";
		clone("evil_mage", "$template_spawn_actor$");
		t.name = "Evil Mage";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "evil_mage";
		clone("white_mage", "$template_spawn_actor$");
		t.name = "White Mage";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_id = "white_mage";
		clone("bandit", "$template_spawn_actor$");
		t.name = "Bandits";
		t.actor_asset_id = "bandit";
		clone("snowman", "$template_spawn_actor$");
		t.name = "Snowman";
		t.actor_asset_id = "snowman";
		clone("zombie", "$template_spawn_actor$");
		t.name = "Zombie";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		t.actor_asset_ids = AssetLibrary<GodPower>.a<string>("zombie_human", "zombie_orc", "zombie_dwarf", "zombie_elf");
		clone("skeleton", "$template_spawn_actor$");
		t.name = "Skeleton";
		t.rank = PowerRank.Rank0_free;
		t.actor_asset_id = "skeleton";
		clone("sheep", "$template_spawn_actor$");
		t.name = "Sheeps";
		t.actor_asset_id = "sheep";
		clone("rhino", "$template_spawn_actor$");
		t.name = "Rhino";
		t.actor_asset_id = "rhino";
		clone("monkey", "$template_spawn_actor$");
		t.name = "Monkey";
		t.actor_asset_id = "monkey";
		clone("buffalo", "$template_spawn_actor$");
		t.name = "Buffalo";
		t.actor_asset_id = "buffalo";
		clone("fox", "$template_spawn_actor$");
		t.name = "Fox";
		t.actor_asset_id = "fox";
		clone("hyena", "$template_spawn_actor$");
		t.name = "Hyena";
		t.actor_asset_id = "hyena";
		clone("dog", "$template_spawn_actor$");
		t.name = "Dog";
		t.actor_asset_id = "dog";
		clone("cow", "$template_spawn_actor$");
		t.name = "Cow";
		t.actor_asset_id = "cow";
		clone("frog", "$template_spawn_actor$");
		t.name = "Frog";
		t.actor_asset_id = "frog";
		clone("crocodile", "$template_spawn_actor$");
		t.name = "Crocodile";
		t.actor_asset_id = "crocodile";
		clone("snake", "$template_spawn_actor$");
		t.name = "Snake";
		t.actor_asset_id = "snake";
		clone("turtle", "$template_spawn_actor$");
		t.name = "Turtle";
		t.actor_asset_id = "turtle";
		clone("penguin", "$template_spawn_actor$");
		t.name = "Penguin";
		t.actor_asset_id = "penguin";
		clone("crab", "$template_spawn_actor$");
		t.name = "Crab";
		t.actor_asset_id = "crab";
		clone("rabbit", "$template_spawn_actor$");
		t.name = "Rabbit";
		t.actor_asset_id = "rabbit";
		clone("cat", "$template_spawn_actor$");
		t.name = "Cat";
		t.actor_asset_id = "cat";
		clone("chicken", "$template_spawn_actor$");
		t.name = "Chicken";
		t.actor_asset_id = "chicken";
		clone("wolf", "$template_spawn_actor$");
		t.name = "Wolfs";
		t.actor_asset_id = "wolf";
		clone("armadillo", "$template_spawn_actor$");
		t.name = "Armadillo";
		t.actor_asset_id = "armadillo";
		clone("raccoon", "$template_spawn_actor$");
		t.name = "Raccoon";
		t.actor_asset_id = "raccoon";
		clone("seal", "$template_spawn_actor$");
		t.name = "Seal";
		t.actor_asset_id = "seal";
		clone("ostrich", "$template_spawn_actor$");
		t.name = "Ostrich";
		t.actor_asset_id = "ostrich";
		clone("unicorn", "$template_spawn_actor$");
		t.name = "Unicorn";
		t.actor_asset_id = "unicorn";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		clone("alpaca", "$template_spawn_actor$");
		t.name = "Alpaca";
		t.actor_asset_id = "alpaca";
		clone("capybara", "$template_spawn_actor$");
		t.name = "Capybara";
		t.actor_asset_id = "capybara";
		clone("scorpion", "$template_spawn_actor$");
		t.name = "Scorpion";
		t.actor_asset_id = "scorpion";
		clone("flower_bud", "$template_spawn_actor$");
		t.name = "Flower Bud";
		t.actor_asset_id = "flower_bud";
		clone("lemon_snail", "$template_spawn_actor$");
		t.name = "Bitba";
		t.actor_asset_id = "lemon_snail";
		clone("garl", "$template_spawn_actor$");
		t.name = "Garl";
		t.actor_asset_id = "garl";
		clone("bear", "$template_spawn_actor$");
		t.name = "Bear";
		t.actor_asset_id = "bear";
		clone("piranha", "$template_spawn_actor$");
		t.name = "Piranha";
		t.actor_asset_id = "piranha";
		clone("worm", "$template_spawn_actor$");
		t.name = "Worm";
		t.actor_asset_id = "worm";
		clone("crystal_sword", "$template_spawn_actor$");
		t.name = "Crystal Sword";
		t.actor_asset_id = "crystal_sword";
		clone("jumpy_skull", "$template_spawn_actor$");
		t.name = "Rude Skull";
		t.actor_asset_id = "jumpy_skull";
		clone("fire_skull", "$template_spawn_actor$");
		t.name = "Fire Skull";
		t.actor_asset_id = "fire_skull";
		clone("fire_elemental", "$template_spawn_actor$");
		t.name = "Fire Elemental";
		t.actor_asset_ids = SA.fire_elementals;
		clone("ghost", "$template_spawn_actor$");
		t.name = "Ghost";
		t.actor_asset_id = "ghost";
		clone("alien", "$template_spawn_actor$");
		t.name = "Alien";
		t.actor_asset_id = "alien";
		t.requires_premium = true;
		t.rank = PowerRank.Rank3_good;
		clone("greg", "$template_spawn_actor$");
		t.name = "Greg";
		t.actor_asset_id = "greg";
		t.requires_premium = true;
		t.rank = PowerRank.Rank5_noAwards;
		clone("smore", "$template_spawn_actor$");
		t.name = "Smore";
		t.actor_asset_id = "smore";
		clone("sand_spider", "$template_spawn_actor$");
		t.name = "Sand Spider";
		t.actor_asset_id = "sand_spider";
		t.hold_action = true;
		clone("goat", "$template_spawn_actor$");
		t.name = "Goat";
		t.actor_asset_id = "goat";
		clone("acid_blob", "$template_spawn_actor$");
		t.name = "Acid Blob";
		t.actor_asset_id = "acid_blob";
		clone("god_finger", "$template_spawn_actor$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank2_normal;
		t.name = "God Finger";
		t.actor_asset_id = "god_finger";
		clone("UFO", "$template_spawn_actor$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		t.name = "UFO";
		t.actor_asset_id = "UFO";
		clone("dragon", "$template_spawn_actor$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank4_awesome;
		t.name = "Dragon";
		t.actor_asset_id = "dragon";
		clone("fairy", "$template_spawn_actor$");
		t.rank = PowerRank.Rank2_normal;
		t.name = "Fairy";
		t.actor_asset_id = "fairy";
		t.requires_premium = true;
		clone("butterfly", "$template_spawn_actor$");
		t.rank = PowerRank.Rank1_common;
		t.name = "Butterfly";
		t.actor_asset_id = "butterfly";
		clone("bee", "$template_spawn_actor$");
		t.rank = PowerRank.Rank1_common;
		t.name = "Bee";
		t.actor_asset_id = "bee";
		t.click_action = spawnUnit;
		clone("grasshopper", "$template_spawn_actor$");
		t.rank = PowerRank.Rank1_common;
		t.name = "Grasshopper";
		t.actor_asset_id = "grasshopper";
		clone("fly", "$template_spawn_actor$");
		t.rank = PowerRank.Rank1_common;
		t.name = "Fly";
		t.actor_asset_id = "fly";
		clone("beetle", "$template_spawn_actor$");
		t.rank = PowerRank.Rank1_common;
		t.name = "Beetle";
		t.actor_asset_id = "beetle";
		clone("rat", "$template_spawn_actor$");
		t.name = "Rat";
		t.actor_asset_id = "rat";
		clone("ant_blue", "$template_spawn_actor$");
		t.name = "Blue Ant";
		t.actor_asset_id = "ant_blue";
		clone("ant_green", "$template_spawn_actor$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Green Ant";
		t.actor_asset_id = "ant_green";
		clone("ant_black", "$template_spawn_actor$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Black Ant";
		t.actor_asset_id = "ant_black";
		clone("ant_red", "$template_spawn_actor$");
		t.requires_premium = true;
		t.rank = PowerRank.Rank1_common;
		t.name = "Red Ant";
		t.actor_asset_id = "ant_red";
		clone("crabzilla", "$template_spawn_actor$");
		t.name = "Crabzilla";
		t.rank = PowerRank.Rank4_awesome;
		t.requires_premium = true;
		t.actor_asset_id = "crabzilla";
		t.actor_spawn_height = 0f;
		t.ignore_fast_spawn = true;
		t.tester_enabled = false;
		t.multiple_spawn_tip = false;
		t.click_action = spawnCrabzilla;
	}

	private void addCivsClassic()
	{
		add(new GodPower
		{
			id = "$template_spawn_actor$",
			type = PowerActionType.PowerSpawnActor,
			rank = PowerRank.Rank0_free,
			unselect_when_window = true,
			show_spawn_effect = true,
			actor_spawn_height = 3f,
			multiple_spawn_tip = true,
			show_unit_stats_overview = true,
			set_used_camera_drag_on_long_move = true
		});
		t.click_action = spawnUnit;
		clone("human", "$template_spawn_actor$");
		t.name = "Human";
		t.actor_asset_id = "human";
		clone("orc", "$template_spawn_actor$");
		t.rank = PowerRank.Rank4_awesome;
		t.requires_premium = true;
		t.name = "Orc";
		t.actor_asset_id = "orc";
		clone("elf", "$template_spawn_actor$");
		t.rank = PowerRank.Rank4_awesome;
		t.requires_premium = true;
		t.name = "Elf";
		t.actor_asset_id = "elf";
		clone("dwarf", "$template_spawn_actor$");
		t.rank = PowerRank.Rank4_awesome;
		t.requires_premium = true;
		t.name = "Dwarf";
		t.actor_asset_id = "dwarf";
	}

	public override void linkAssets()
	{
		foreach (GodPower item in list)
		{
			if (!string.IsNullOrEmpty(item.drop_id))
			{
				item.cached_drop_asset = AssetManager.drops.get(item.drop_id);
			}
			if (!string.IsNullOrEmpty(item.tile_type))
			{
				item.cached_tile_type_asset = AssetManager.tiles.get(item.tile_type);
			}
			if (!string.IsNullOrEmpty(item.top_tile_type))
			{
				item.cached_top_tile_type_asset = AssetManager.top_tiles.get(item.top_tile_type);
			}
			if (item.actor_asset_id != null)
			{
				ActorAsset actorAsset = AssetManager.actor_library.get(item.actor_asset_id);
				if (actorAsset.power_id == null)
				{
					actorAsset.power_id = item.id;
				}
			}
			string[] actor_asset_ids = item.actor_asset_ids;
			if (actor_asset_ids == null || actor_asset_ids.Length == 0)
			{
				continue;
			}
			string[] actor_asset_ids2 = item.actor_asset_ids;
			foreach (string pID in actor_asset_ids2)
			{
				ActorAsset actorAsset2 = AssetManager.actor_library.get(pID);
				if (actorAsset2.power_id == null)
				{
					actorAsset2.power_id = item.id;
				}
			}
		}
	}

	private void traceRanks(PowerButton pTarget)
	{
		string text = "";
		string text2 = "";
		string text3 = "";
		string text4 = "";
		string text5 = "";
		for (int i = 0; i < list.Count; i++)
		{
			GodPower godPower = list[i];
			switch (godPower.rank)
			{
			case PowerRank.Rank0_free:
				text = text + godPower.name + ", ";
				break;
			case PowerRank.Rank1_common:
				text2 = text2 + godPower.name + ", ";
				break;
			case PowerRank.Rank2_normal:
				text3 = text3 + godPower.name + ", ";
				break;
			case PowerRank.Rank3_good:
				text4 = text4 + godPower.name + ", ";
				break;
			case PowerRank.Rank4_awesome:
				text5 = text5 + godPower.name + ", ";
				break;
			}
		}
		Debug.Log((object)("rank 0: " + text));
		Debug.Log((object)("rank 1: " + text2));
		Debug.Log((object)("rank 2: " + text3));
		Debug.Log((object)("rank 3: " + text4));
		Debug.Log((object)("rank 4: " + text5));
	}

	private bool spawnDrops(WorldTile tTile, GodPower pPower)
	{
		BrushData current_brush_data = Config.current_brush_data;
		bool flag = false;
		if (current_brush_data.size == 0 && current_brush_data.fast_spawn)
		{
			if (World.world.player_control.timer_spawn_pixels <= 0f)
			{
				World.world.player_control.timer_spawn_pixels = 0.5f;
				flag = true;
			}
		}
		else if (current_brush_data.fast_spawn && Randy.randomBool())
		{
			if (World.world.player_control.timer_spawn_pixels <= 0f)
			{
				World.world.player_control.timer_spawn_pixels = 0.3f;
				flag = true;
			}
		}
		else
		{
			flag = Randy.randomChance(pPower.falling_chance);
		}
		if (World.world.player_control.first_click)
		{
			World.world.player_control.first_click = false;
			flag = true;
			World.world.player_control.timer_spawn_pixels = 0.3f;
		}
		if (flag)
		{
			World.world.drop_manager.spawn(tTile, pPower.cached_drop_asset, -1f, -1f, pForceSurprise: true, -1L).soundOn = true;
		}
		return true;
	}

	private bool spawnPrinter(WorldTile pTile, string pPower)
	{
		GodPower godPower = get(pPower);
		EffectsLibrary.spawn("fx_spawn", pTile);
		World.world.units.spawnNewUnitByPlayer("printer", pTile, pSpawnSound: true).data.set("template", godPower.printers_print);
		AchievementLibrary.print_heart.check(godPower);
		return true;
	}

	private bool useMagnet(WorldTile pTile, string pPower)
	{
		World.world.magnet.magnetAction(pFromUpdate: false, pTile);
		return true;
	}

	private bool spawnCloudSnow(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_snow");
		return true;
	}

	private bool spawnCloudLava(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_lava");
		return true;
	}

	private bool spawnCloudAcid(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_acid");
		return true;
	}

	private bool spawnCloudOfLife(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_normal");
		return true;
	}

	private bool spawnCloudRain(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_rain");
		return true;
	}

	private bool spawnCloudFire(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_fire");
		return true;
	}

	private bool spawnCloudLightning(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_lightning");
		return true;
	}

	private bool spawnCloudMagic(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_magic");
		return true;
	}

	private bool spawnCloudRage(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_rage");
		return true;
	}

	private bool spawnCloudAsh(WorldTile pTile, string pPower)
	{
		spawnCloud(pTile, "cloud_ash");
		return true;
	}

	private void spawnCloud(WorldTile pTile, string pCloudID)
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		EffectsLibrary.spawn("fx_cloud", pTile, pCloudID);
		Vector2Int pos = pTile.pos;
		float pX = ((Vector2Int)(ref pos)).x;
		pos = pTile.pos;
		MusicBox.playSound("event:/SFX/UNIQUE/SpawnCloud", pX, ((Vector2Int)(ref pos)).y);
	}

	private bool spawnCrabzilla(WorldTile pTile, string pPower)
	{
		World.world.player_control.already_used_power = false;
		World.world.selected_buttons.unselectAll();
		((SpawnEffect)EffectsLibrary.spawn("fx_spawn_big", pTile)).setEvent("crabzilla", pTile);
		return true;
	}

	private bool spawnLightning(WorldTile pTile, string pPower)
	{
		MapBox.spawnLightningBig(pTile);
		return true;
	}

	private bool spawnForce(WorldTile pTile, string pPower)
	{
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		MusicBox.playSound("event:/SFX/EXPLOSIONS/ExplosionForce", pTile);
		World.world.applyForceOnTile(pTile, 10, 3f, pForceOut: true, 0, null, null, null, pChangeHappiness: true);
		EffectsLibrary.spawnExplosionWave(pTile.posV3, 10f);
		return true;
	}

	private bool fingerFlick(WorldTile pTile, string pPower)
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		Actor actorNearCursor = World.world.getActorNearCursor();
		if (actorNearCursor == null)
		{
			return false;
		}
		Vector2 mousePos = World.world.getMousePos();
		Vector2 current_position = actorNearCursor.current_position;
		float pForceAmountDirection = Randy.randomFloat(2.5f, 5f);
		float pForceHeight = Randy.randomFloat(2.5f, 3f);
		actorNearCursor.calculateForce(current_position.x, current_position.y, mousePos.x, mousePos.y, pForceAmountDirection, pForceHeight, pCheckCancelJobOnLand: true);
		actorNearCursor.addStatusEffect("flicked");
		actorNearCursor.makeStunned();
		return true;
	}

	private bool spawnInfinityCoin(WorldTile pTile, string pPower)
	{
		EffectsLibrary.spawn("fx_infinity_coin", pTile);
		return true;
	}

	private bool spawnEarthquake(WorldTile pTile, string pPower)
	{
		Earthquake.startQuake(pTile);
		return true;
	}

	private bool spawnMeteorite(WorldTile pTile, string pPower)
	{
		Meteorite.spawnMeteorite(pTile);
		return true;
	}

	private bool spawnTornado(WorldTile pTile, string pPower)
	{
		EffectsLibrary.spawnAtTile("fx_tornado", pTile, 0.5f);
		return true;
	}

	private bool prepareBoulder(WorldTile pTile, string pPower)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		Touch pTouch = default(Touch);
		Vector2 pPosition;
		if (InputHelpers.mouseSupported)
		{
			pPosition = World.world.getMousePos();
		}
		else
		{
			if (!World.world.player_control.getTouchPos(out pTouch, pOnlyGameplay: true))
			{
				return false;
			}
			pPosition = Vector2.op_Implicit(World.world.camera.ScreenToWorldPoint(Vector2.op_Implicit(((Touch)(ref pTouch)).position)));
		}
		Boulder.chargeBoulder(pPosition, pTouch);
		return true;
	}

	private bool spawnSanta(WorldTile pTile, string pPower)
	{
		EffectsLibrary.spawn("fx_santa", pTile, "santa");
		return true;
	}

	private void toggleOptionZone(string pPower)
	{
		GodPower pPower2 = AssetManager.powers.get(pPower);
		MetaTypeAsset fromPower = AssetManager.meta_type_library.getFromPower(pPower2);
		if (InputHelpers.GetMouseButtonUp(1))
		{
			fromPower.toggleOptionZone(pPower2, -1);
		}
		else
		{
			fromPower.toggleOptionZone(pPower2);
		}
	}

	internal void toggleMultiOption(string pPower)
	{
		GodPower godPower = AssetManager.powers.get(pPower);
		string toggle_name = godPower.toggle_name;
		OptionAsset optionAsset = AssetManager.options_library.get(toggle_name);
		int num = 1;
		num = ((!InputHelpers.GetMouseButtonUp(1)) ? 1 : (-1));
		PlayerOptionData data = optionAsset.data;
		if (data.boolVal)
		{
			data.intVal += num;
			if (data.intVal > optionAsset.max_value)
			{
				data.intVal = 0;
				data.boolVal = false;
			}
			if (data.intVal < 0)
			{
				data.intVal = optionAsset.max_value;
			}
		}
		else
		{
			data.boolVal = true;
		}
		PlayerConfig.saveData();
		string translatedName = godPower.getTranslatedName();
		string translatedDescription = godPower.getTranslatedDescription();
		string translatedOption = optionAsset.getTranslatedOption();
		if (data.boolVal)
		{
			WorldTip.instance.showToolbarText(translatedName + " - " + translatedOption, translatedDescription);
		}
	}

	private void toggleOption(string pPower)
	{
		GodPower godPower = AssetManager.powers.get(pPower);
		WorldTip.instance.showToolbarText(godPower);
		PlayerOptionData playerOptionData = PlayerConfig.dict[godPower.toggle_name];
		playerOptionData.boolVal = !playerOptionData.boolVal;
		if (godPower.map_modes_switch)
		{
			if (playerOptionData.boolVal)
			{
				disableAllOtherMapModes(pPower);
			}
			else
			{
				WorldTip.instance.startHide();
			}
		}
		PlayerConfig.saveData();
	}

	internal static void disableAllOtherMapModes(string pMainPower)
	{
		for (int i = 0; i < AssetManager.powers.list.Count; i++)
		{
			GodPower godPower = AssetManager.powers.list[i];
			if (godPower.map_modes_switch && !(godPower.id == pMainPower))
			{
				PlayerConfig.dict[godPower.toggle_name].boolVal = false;
			}
		}
	}

	private bool useVortex(WorldTile pTile, string pPower)
	{
		if (pTile.isTemporaryFrozen())
		{
			pTile.unfreeze(99);
		}
		VortexAction.moveTiles(pTile, Config.current_brush_data);
		return true;
	}

	private bool drawTiles(WorldTile pTile, string pPowerID)
	{
		GodPower godPower = get(pPowerID);
		TileType cached_tile_type_asset = godPower.cached_tile_type_asset;
		TopTileType cached_top_tile_type_asset = godPower.cached_top_tile_type_asset;
		World.world.flash_effects.flashPixel(pTile, 25);
		if (cached_top_tile_type_asset != null && cached_top_tile_type_asset.wall && pTile.Type.id != cached_top_tile_type_asset.id)
		{
			World.world.game_stats.data.wallsPlaced++;
			AchievementLibrary.segregator.check();
		}
		MapAction.terraformTile(pTile, cached_tile_type_asset, cached_top_tile_type_asset, TerraformLibrary.draw);
		return true;
	}

	private bool flashPixel(WorldTile pTile, string pPowerID = null)
	{
		World.world.flash_effects.flashPixel(pTile, 10);
		return true;
	}

	private bool flashPixel(WorldTile pTile, GodPower pPower)
	{
		World.world.flash_effects.flashPixel(pTile, 10);
		return true;
	}

	private bool drawTemperaturePlus(WorldTile pTile, string pPower)
	{
		if (pTile.isTemporaryFrozen() && Randy.randomBool())
		{
			pTile.unfreeze();
		}
		WorldBehaviourUnitTemperatures.checkTile(pTile, 5);
		if (pTile.Type.lava)
		{
			LavaHelper.heatUpLava(pTile);
		}
		if (pTile.hasBuilding() && pTile.building.asset.spawn_drops)
		{
			pTile.building.data.removeFlag("stop_spawn_drops");
		}
		return true;
	}

	public bool clickHideUI(string pPowerId)
	{
		if (ScrollWindow.isWindowActive())
		{
			return true;
		}
		Config.ui_main_hidden = true;
		return true;
	}

	public bool clickTraitEditorRainButton(string pPowerId)
	{
		Config.selected_trait_editor = pPowerId;
		ScrollWindow.showWindow("trait_rain_editor");
		return true;
	}

	public bool clickEquipmentEditorRainButton(string pPowerId)
	{
		ScrollWindow.showWindow("equipment_rain_editor");
		return true;
	}

	public static bool drawTemperatureMinus(WorldTile pTile, string pPower)
	{
		if (pTile.Type.lava)
		{
			LavaHelper.coolDownLava(pTile);
		}
		if (pTile.isOnFire())
		{
			pTile.stopFire();
		}
		if (pTile.canBeFrozen() && Randy.randomBool())
		{
			if (pTile.health > 0)
			{
				pTile.health--;
			}
			else
			{
				pTile.freeze();
			}
		}
		WorldBehaviourUnitTemperatures.checkTile(pTile, -5);
		if (pTile.hasBuilding())
		{
			ActionLibrary.addFrozenEffectOnTarget(null, pTile.building);
		}
		if (pTile.hasBuilding() && pTile.building.asset.spawn_drops)
		{
			pTile.building.data.addFlag("stop_spawn_drops");
		}
		return true;
	}

	private bool drawShovelPlus(WorldTile pTile, string pPower)
	{
		if (pTile.health > 0)
		{
			pTile.health--;
		}
		else
		{
			MapAction.increaseTile(pTile, pDamage: false, "destroy");
		}
		return false;
	}

	private bool drawShovelMinus(WorldTile pTile, string pPower)
	{
		if (pTile.health > 0)
		{
			pTile.health--;
		}
		else
		{
			MapAction.decreaseTile(pTile, pDamage: false, "destroy");
		}
		return false;
	}

	private bool drawGreyGoo(WorldTile pTile, string pPower)
	{
		World.world.grey_goo_layer.add(pTile);
		return false;
	}

	private bool drawConway(WorldTile pTile, string pPower)
	{
		if (Randy.randomBool())
		{
			World.world.conway_layer.add(pTile, "conway");
		}
		return false;
	}

	private bool drawConwayInverse(WorldTile pTile, string pPower)
	{
		if (Randy.randomBool())
		{
			World.world.conway_layer.add(pTile, "conway_inverse");
		}
		return false;
	}

	private bool drawFinger(WorldTile pTile, string pPower)
	{
		TileType first_pressed_type = World.world.player_control.first_pressed_type;
		TopTileType topTileType = World.world.player_control.first_pressed_top_type;
		if (topTileType != null && !topTileType.allowed_to_be_finger_copied)
		{
			topTileType = null;
		}
		if (first_pressed_type.ground && (topTileType == null || topTileType.ground))
		{
			MapAction.terraformTile(pTile, first_pressed_type, topTileType, TerraformLibrary.draw);
		}
		else
		{
			destroyBuildings(pTile, pPower);
			MapAction.terraformTile(pTile, first_pressed_type, topTileType, TerraformLibrary.destroy_no_flash);
		}
		if (pTile.Type.grey_goo)
		{
			World.world.grey_goo_layer.add(pTile);
		}
		if (topTileType != null && topTileType.biome_id == "biome_grass")
		{
			AchievementLibrary.touch_the_grass.check();
		}
		return false;
	}

	private bool drawBorderBrush(WorldTile pTile, string pPower)
	{
		WorldTile first_pressed_tile = World.world.player_control.first_pressed_tile;
		if (first_pressed_tile == null)
		{
			return false;
		}
		City zone_city = first_pressed_tile.zone_city;
		if (zone_city == null)
		{
			return false;
		}
		zone_city.addZone(pTile.zone);
		World.world.city_zone_helper.city_place_finder.setDirty();
		zone_city.setAbandonedZonesDirty();
		return false;
	}

	private bool spawnUnit(WorldTile pTile, string pPowerID)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		GodPower godPower = get(pPowerID);
		Vector2Int pos = pTile.pos;
		float pX = ((Vector2Int)(ref pos)).x;
		pos = pTile.pos;
		MusicBox.playSound("event:/SFX/UNIQUE/SpawnWhoosh", pX, ((Vector2Int)(ref pos)).y);
		if (godPower.id == "sheep" && pTile.Type.lava)
		{
			AchievementLibrary.sacrifice.check();
		}
		EffectsLibrary.spawn("fx_spawn", pTile);
		string[] actor_asset_ids = godPower.actor_asset_ids;
		string pStatsID = ((actor_asset_ids == null || actor_asset_ids.Length == 0) ? godPower.actor_asset_id : godPower.actor_asset_ids.GetRandom());
		Actor pCheckData = World.world.units.spawnNewUnitByPlayer(pStatsID, pTile, pSpawnSound: true, pMiracleSpawn: true, godPower.actor_spawn_height);
		AchievementLibrary.back_to_beta_testing.check(pCheckData);
		return true;
	}

	private bool divineLightFX(WorldTile pCenterTile, string pPowerID)
	{
		World.world.fx_divine_light.playOn(pCenterTile);
		return true;
	}

	private bool drawDivineLight(WorldTile pCenterTile, string pPowerID)
	{
		pCenterTile.doUnits(delegate(Actor pActor)
		{
			clearBadTraitsFrom(pActor);
			if (pActor.asset.can_be_killed_by_divine_light)
			{
				pActor.getHit(pActor.getMaxHealthPercent(0.4f), pFlash: true, AttackType.Divine);
			}
			else
			{
				pActor.startColorEffect();
			}
			pActor.finishStatusEffect("ash_fever");
			pActor.finishAngryStatus();
			if (!pActor.isInLiquid())
			{
				pActor.cancelAllBeh();
			}
			if (pActor.hasPlot())
			{
				World.world.plots.cancelPlot(pActor.plot);
			}
		});
		return true;
	}

	private void clearBadTraitsFrom(Actor pActor)
	{
		using ListPool<ActorTrait> listPool = new ListPool<ActorTrait>();
		foreach (ActorTrait trait in pActor.getTraits())
		{
			if (trait.can_be_removed_by_divine_light)
			{
				listPool.Add(trait);
			}
		}
		if (listPool.Count > 0)
		{
			pActor.removeTraits(listPool);
			pActor.setStatsDirty();
			pActor.changeHappiness("just_felt_the_divine");
		}
	}

	private bool cleanBurnedTile(WorldTile pTile, string pPowerID)
	{
		pTile.removeBurn();
		return true;
	}

	private bool removeTornadoes(WorldTile pTile, string pPowerID)
	{
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		using ListPool<BaseEffect> listPool = new ListPool<BaseEffect>(World.world.stack_effects.get("fx_tornado").getList());
		if (listPool.Count == 0)
		{
			return false;
		}
		float num = 2 * (Config.current_brush_data.size + 1);
		num *= num;
		foreach (ref BaseEffect item in listPool)
		{
			BaseEffect current = item;
			if (current.active)
			{
				Vector3 localPosition = ((Component)current).transform.localPosition;
				if (!(Toolbox.SquaredDist(localPosition.x, localPosition.y, pTile.x, pTile.y) > num))
				{
					((TornadoEffect)current).die();
				}
			}
		}
		return true;
	}

	private bool drawPickaxe(WorldTile pTile, string pPowerID)
	{
		if (pTile.hasBuilding() && pTile.building.asset.building_type == BuildingType.Building_Mineral)
		{
			pTile.building.startDestroyBuilding();
		}
		if (pTile.Type.can_be_removed_with_pickaxe)
		{
			MapAction.decreaseTile(pTile, pDamage: false, "remove");
		}
		return true;
	}

	private bool drawBucket(WorldTile pTile, string pPowerID)
	{
		MapAction.removeLiquid(pTile);
		if (pTile.Type.lava)
		{
			MapAction.decreaseTile(pTile, pDamage: false);
		}
		if (pTile.Type.can_be_removed_with_bucket)
		{
			MapAction.decreaseTile(pTile, pDamage: false);
		}
		return true;
	}

	private bool drawAxe(WorldTile pTile, string pPowerID)
	{
		if (pTile.hasBuilding())
		{
			Building building = pTile.building;
			BuildingAsset asset = building.asset;
			if (asset.building_type == BuildingType.Building_Tree && !building.chopped)
			{
				if (asset.resources_given != null && pTile.hasCity())
				{
					foreach (ResourceContainer item in asset.resources_given)
					{
						pTile.zone_city.addResourcesToRandomStockpile(item.id, item.amount);
					}
				}
				building.chopTree();
			}
		}
		foreach (Actor item2 in Finder.getUnitsFromChunk(pTile, 0))
		{
			if (!(item2.kingdom.name != "living_plants"))
			{
				item2.a.getHitFullHealth(AttackType.Divine);
			}
		}
		if (pTile.Type.can_be_removed_with_axe)
		{
			MapAction.decreaseTile(pTile, pDamage: false, "remove");
		}
		return true;
	}

	private bool drawSpade(WorldTile pTile, string pPowerID)
	{
		if (pTile.Type.can_be_removed_with_spade)
		{
			MapAction.removeGreens(pTile);
		}
		return true;
	}

	private bool drawSickle(WorldTile pTile, string pPowerID)
	{
		if (pTile.hasBuilding())
		{
			BuildingType building_type = pTile.building.asset.building_type;
			if (building_type == BuildingType.Building_Fruits || (uint)(building_type - 5) <= 1u)
			{
				pTile.building.startDestroyBuilding();
			}
		}
		if (pTile.Type.can_be_removed_with_sickle)
		{
			MapAction.decreaseTile(pTile, pDamage: false, "remove");
		}
		return true;
	}

	private bool drawDemolish(WorldTile pTile, string pPowerID)
	{
		if (pTile.hasBuilding() && pTile.building.asset.can_be_demolished)
		{
			pTile.building.startDestroyBuilding();
		}
		if (pTile.Type.can_be_removed_with_demolish)
		{
			MapAction.decreaseTile(pTile, pDamage: false);
		}
		foreach (Actor item in Finder.getUnitsFromChunk(pTile, 0))
		{
			if (!(item.kingdom.name != "living_houses"))
			{
				item.a.getHitFullHealth(AttackType.Divine);
			}
		}
		return true;
	}

	private bool drawScissors(WorldTile pTile, string pPowerID)
	{
		if (pTile.zone.hasCity())
		{
			pTile.zone.city.removeZone(pTile.zone);
		}
		return true;
	}

	private bool drawLifeEraser(WorldTile pTile, string pPowerID)
	{
		MapAction.removeLifeFromTile(pTile);
		return true;
	}

	private bool drawHeatray(WorldTile pTile, string pPowerID)
	{
		if (World.world.heat_ray_fx.isReady())
		{
			World.world.heat.addTile(pTile, Randy.randomInt(1, 3));
		}
		return true;
	}

	[ClickActionCaller]
	private bool heatrayFX(WorldTile pTile, string pPowerID)
	{
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		if (World.world.heat_ray_fx.isReady())
		{
			MusicBox.inst.playDrawingSound("event:/SFX/POWERS/HeatRayMelts", pTile.x, pTile.y);
		}
		World.world.heat_ray_fx.play(Vector2Int.op_Implicit(pTile.pos), 10);
		loopWithBrush(pTile, pPowerID);
		return true;
	}

	[ClickActionCaller]
	private bool loopWithCurrentBrush(WorldTile pCenterTile, string pPowerID)
	{
		GodPower godPower = get(pPowerID);
		loopWithBrush(pCenterTile, godPower);
		if (godPower.surprises_units)
		{
			ActionLibrary.suprisedByArchitector(null, pCenterTile);
		}
		return true;
	}

	[ClickActionCaller]
	private bool drawingCursorEffect(WorldTile pTile, string pPowerID)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		EffectsLibrary.spawnAt("fx_spark", pTile.posV3, 0.2f);
		return true;
	}

	private bool flashBrushPixelsDuringClick(WorldTile pCenterTile, string pPower)
	{
		BrushData current_brush_data = Config.current_brush_data;
		World.world.highlightTilesBrush(pCenterTile, current_brush_data, flashPixel);
		return true;
	}

	private bool flashBrushPixelsDuringClick(WorldTile pCenterTile, GodPower pPower)
	{
		BrushData current_brush_data = Config.current_brush_data;
		World.world.highlightTilesBrush(pCenterTile, current_brush_data, flashPixel, pPower);
		return true;
	}

	[ClickPowerActionCaller]
	private bool loopWithCurrentBrushPowerForDropsFull(WorldTile pCenterTile, GodPower pPower)
	{
		BrushData current_brush_data = Config.current_brush_data;
		WorldBehaviourTileEffects.checkTileForEffectKill(pCenterTile, current_brush_data.size);
		World.world.loopWithBrushPowerForDropsFull(pCenterTile, current_brush_data, pPower.click_power_action, pPower);
		return true;
	}

	[ClickPowerActionCaller]
	private bool loopWithCurrentBrushPowerForDropsRandom(WorldTile pCenterTile, GodPower pPower)
	{
		BrushData current_brush_data = Config.current_brush_data;
		WorldBehaviourTileEffects.checkTileForEffectKill(pCenterTile, current_brush_data.size);
		World.world.loopWithBrushPowerForDropsRandom(pCenterTile, current_brush_data, pPower.click_power_action, pPower);
		return true;
	}

	[ClickActionCaller]
	private bool loopWithBrush(WorldTile pCenterTile, string pPowerID)
	{
		GodPower pPower = get(pPowerID);
		return loopWithBrush(pCenterTile, pPower);
	}

	[ClickActionCaller]
	private bool loopWithBrush(WorldTile pCenterTile, GodPower pPower)
	{
		string pID = Config.current_brush;
		if (!string.IsNullOrEmpty(pPower.force_brush))
		{
			pID = pPower.force_brush;
		}
		BrushData brushData = Brush.get(pID);
		WorldBehaviourTileEffects.checkTileForEffectKill(pCenterTile, brushData.size);
		World.world.loopWithBrush(pCenterTile, brushData, pPower.click_action, pPower.id);
		return true;
	}

	private bool stopFire(WorldTile pTile, string pPowerID)
	{
		pTile.stopFire();
		if (pTile.hasBuilding() && pTile.building.hasStatus("burning"))
		{
			pTile.building.stopFire();
		}
		return true;
	}

	private bool fmodDrawingSound(WorldTile pTile, GodPower pPower)
	{
		if (pPower.has_sound_drawing)
		{
			MusicBox.inst.playDrawingSound(pPower.sound_drawing, pTile.x, pTile.y);
		}
		return true;
	}

	private bool fmodDrawingSound(WorldTile pTile, string pPowerID)
	{
		GodPower pPower = get(pPowerID);
		fmodDrawingSound(pTile, pPower);
		return true;
	}

	private bool destroyBuildings(WorldTile pTile, string pPowerID)
	{
		if (!pTile.hasBuilding())
		{
			return false;
		}
		pTile.building.startDestroyBuilding();
		return true;
	}

	private bool removeClouds(WorldTile pTile, string pPowerID)
	{
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		List<BaseEffect> list = World.world.stack_effects.get("fx_cloud").getList();
		float num = 10 * (Config.current_brush_data.size + 1);
		num *= num;
		for (int i = 0; i < list.Count; i++)
		{
			BaseEffect baseEffect = list[i];
			if (baseEffect.active)
			{
				Vector3 localPosition = ((Component)baseEffect).transform.localPosition;
				if (!(Toolbox.SquaredDist(localPosition.x, localPosition.y, pTile.x, pTile.y) > num))
				{
					((Cloud)baseEffect).startToDie();
				}
			}
		}
		return true;
	}

	private bool removeGoo(WorldTile pTile, string pPowerID)
	{
		if (pTile.Type.grey_goo)
		{
			MapAction.decreaseTile(pTile, pDamage: false);
		}
		return true;
	}

	private bool removeBuildingsBySponge(WorldTile pTile, string pPowerID)
	{
		if (!pTile.hasBuilding())
		{
			return false;
		}
		bool flag = false;
		if (pTile.building.isRuin() || pTile.building.asset.removed_by_sponge)
		{
			flag = true;
		}
		if (flag)
		{
			pTile.building.startDestroyBuilding();
		}
		return true;
	}

	public override void editorDiagnosticLocales()
	{
		foreach (GodPower item in list)
		{
			if (item.show_tool_sizes && !string.IsNullOrEmpty(item.force_brush))
			{
				BaseAssetLibrary.logAssetError("<e>PowerLibrary</e>: <b>show_tool_sizes</b> is enabled - but <b>force_brush</b> is set to <b>" + item.force_brush + "</b> - making the tool sizes useless", item.id);
			}
			if (item.show_tool_sizes && item.click_brush_action == null && item.click_power_brush_action == null)
			{
				BaseAssetLibrary.logAssetError("<e>PowerLibrary</e>: <b>show_tool_sizes</b> is enabled - but <b>click_brush_action</b> and <b>click_power_brush_action</b> are not set - making the tool sizes useless", item.id);
			}
		}
		localeChecks();
		callbackChecks();
		base.editorDiagnosticLocales();
	}

	private void localeChecks()
	{
		foreach (GodPower item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
	}

	private void callbackChecks()
	{
		foreach (GodPower item in list)
		{
			Delegate[] invocationList;
			if (item.click_action != null)
			{
				if (item.click_brush_action != null)
				{
					bool flag = false;
					invocationList = item.click_brush_action.GetInvocationList();
					for (int i = 0; i < invocationList.Length; i++)
					{
						if (invocationList[i].Method.GetCustomAttributes(typeof(ClickActionCallerAttribute), inherit: true).Length != 0)
						{
							flag = true;
						}
					}
					if (!flag)
					{
						string text = item.click_action.AsString();
						string text2 = item.click_brush_action.AsString();
						BaseAssetLibrary.logAssetError("<e>PowerLibrary</e>: <b>click_brush_action</b> (" + text2 + ") overrides <b>click_action</b> (" + text + ") - either add <b>loopWithBrush</b> which will call them - or mark a similar caller method with [ClickActionCaller] attribute", item.id);
					}
				}
				invocationList = item.click_action.GetInvocationList();
				for (int i = 0; i < invocationList.Length; i++)
				{
					if (invocationList[i].Method.GetCustomAttributes(typeof(ClickActionCallerAttribute), inherit: true).Length != 0)
					{
						BaseAssetLibrary.logAssetError("<e>PowerLibrary</e>: <b>click_action</b> (" + item.click_action.AsString() + ") has [ClickActionCaller] attribute - it should be used only in <b>click_brush_action</b>", item.id);
					}
				}
			}
			if (item.click_power_action == null)
			{
				continue;
			}
			if (item.click_power_brush_action != null)
			{
				bool flag2 = false;
				invocationList = item.click_power_brush_action.GetInvocationList();
				for (int i = 0; i < invocationList.Length; i++)
				{
					if (invocationList[i].Method.GetCustomAttributes(typeof(ClickPowerActionCallerAttribute), inherit: true).Length != 0)
					{
						flag2 = true;
					}
				}
				if (!flag2)
				{
					string text3 = item.click_power_action.AsString();
					string text4 = item.click_power_brush_action.AsString();
					BaseAssetLibrary.logAssetError("<e>PowerLibrary</e>: <b>click_power_brush_action</b> (" + text4 + ") overrides <b>click_power_action</b> (" + text3 + ") - either add <b>loopWithCurrentBrushPower</b> which will call them - or mark a similar caller method with [ClickPowerActionCaller] attribute", item.id);
				}
			}
			invocationList = item.click_power_action.GetInvocationList();
			for (int i = 0; i < invocationList.Length; i++)
			{
				if (invocationList[i].Method.GetCustomAttributes(typeof(ClickPowerActionCallerAttribute), inherit: true).Length != 0)
				{
					BaseAssetLibrary.logAssetError("<e>PowerLibrary</e>: <b>click_power_action</b> (" + item.click_power_action.AsString() + ") has [ClickPowerActionCaller] attribute - it should be used only in <b>click_power_brush_action</b>", item.id);
				}
			}
		}
	}

	public string addToGameplayReport(string pWhat)
	{
		string empty = string.Empty;
		empty = empty + pWhat + "\n";
		foreach (GodPower item in list)
		{
			string translatedName = item.getTranslatedName();
			string translatedDescription = item.getTranslatedDescription();
			string text = "\n" + translatedName;
			text += "\n";
			if (!string.IsNullOrEmpty(translatedDescription))
			{
				text = text + "1: " + translatedDescription;
			}
			empty += text;
		}
		return empty + "\n\n";
	}
}
// --- End of File: PowerLibrary.cs ---



// --- Start of File: PowerRank.cs ---
public enum PowerRank
{
	Rank0_free,
	Rank1_common,
	Rank2_normal,
	Rank3_good,
	Rank4_awesome,
	Rank5_noAwards
}
// --- End of File: PowerRank.cs ---



// --- Start of File: PowersTab.cs ---
using System.Collections.Generic;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class PowersTab : MonoBehaviour
{
	private const float END_SPACE = 5f;

	private static PowersTab _current_tab;

	private static Button _current_tab_button;

	private static PowersTab _main_tab;

	private GameObject parentObj;

	public Sprite image_normal;

	public Sprite image_selected;

	public Button powerButton;

	public static float scale_time = 0.2f;

	public static float buttonScaleTime = 0.1f;

	private List<PowerButton> _power_buttons = new List<PowerButton>();

	private PowerButton _last_selected_button;

	private PowerTabAsset _asset;

	private SelectedNanoBase _selected_nano;

	private int _children;

	public const int BACK_BUTTON_Y = -2;

	public const int TOP_BUTTON_Y = 16;

	private const int Y_TOP_ITEM = 32;

	private const int Y_BOTTOM_ITEM = -4;

	private const float Y_LINE_ITEM = 37.2f;

	private const int SIDE_SPACING = 2;

	private const int BUTTON_WIDTH = 32;

	private void Start()
	{
		parentObj = ((Component)((Component)this).transform.parent.parent).gameObject;
		_selected_nano = ((Component)this).GetComponent<SelectedNanoBase>();
		if ((Object)(object)PowerTabController.instance.tab_main == (Object)(object)this)
		{
			setActive();
			_main_tab = PowerTabController.instance.tab_main;
		}
		else
		{
			hideTab();
		}
		PowerButton[] componentsInChildren = ((Component)this).GetComponentsInChildren<PowerButton>();
		foreach (PowerButton powerButton in componentsInChildren)
		{
			if (!((Object)(object)powerButton == (Object)null) && !((Object)(object)powerButton.rect_transform == (Object)null))
			{
				_power_buttons.Add(powerButton);
			}
		}
		findNeighbours();
		_asset = AssetManager.power_tab_library.get(((Object)((Component)this).gameObject).name);
		if (_asset == null)
		{
			Debug.LogError((object)("No Power_Tab_library found for " + ((Object)((Component)this).gameObject).name));
		}
	}

	public void findNeighbours(bool pCheckForActive = false)
	{
		foreach (PowerButton power_button in _power_buttons)
		{
			power_button.up = null;
			power_button.down = null;
			power_button.left = null;
			power_button.right = null;
		}
		foreach (PowerButton power_button2 in _power_buttons)
		{
			power_button2.findNeighbours(_power_buttons, pCheckForActive);
		}
	}

	public void update()
	{
		if ((Object)(object)_selected_nano != (Object)null && !ScrollWindow.isWindowActive() && !ScrollWindow.isAnimationActive())
		{
			_selected_nano.update();
		}
		int num = ((Component)this).transform.CountChildren(delegate(Transform pChild)
		{
			if (!((Component)pChild).gameObject.activeSelf)
			{
				return false;
			}
			return !((Object)pChild).name.StartsWith("ButtonSelection");
		});
		if (_children != num)
		{
			_children = num;
			sortButtons();
			setNewWidth();
			if (_asset != null)
			{
				_asset.last_scroll_position = 0f;
			}
		}
	}

	public PowerTabAsset getAsset()
	{
		return _asset;
	}

	private void selectButton(PowerButton pButton)
	{
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		World.world.selected_buttons.unselectAll();
		if ((Object)(object)pButton == (Object)null)
		{
			World.world.selected_buttons.clearHighlightedButton();
			return;
		}
		_last_selected_button = pButton;
		if (pButton.godPower != null && pButton.godPower.activate_on_hotkey_select)
		{
			World.world.selected_buttons.clickPowerButton(pButton);
		}
		else
		{
			World.world.selected_buttons.highlightButton(pButton);
		}
		float num = (float)Screen.width / CanvasMain.instance.canvas_ui.scaleFactor;
		if (!(((Transform)pButton.rect_transform).position.x > 0f) || !(((Transform)pButton.rect_transform).position.x + 32f < (float)Screen.width))
		{
			float num2 = 0f - ((Component)pButton).transform.localPosition.x - 96f + num;
			if (num2 > 0f)
			{
				num2 = 0f;
			}
			ShortcutExtensions.DOLocalMoveX(((Component)((Component)pButton).transform.parent.parent.parent).transform, num2, 0.25f, false);
		}
	}

	internal int currentPowerIndex()
	{
		int num = -1;
		PowerButton selectedButton = World.world.selected_buttons.selectedButton;
		if ((Object)(object)selectedButton != (Object)null && (Object)(object)selectedButton != (Object)(object)_last_selected_button)
		{
			if ((Object)(object)_last_selected_button == (Object)null)
			{
				_last_selected_button = selectedButton;
			}
			else if (_power_buttons.IndexOf(selectedButton) >= 0)
			{
				_last_selected_button = selectedButton;
			}
		}
		num = _power_buttons.IndexOf(_last_selected_button);
		if (num < 0)
		{
			num = 0;
		}
		return num;
	}

	internal PowerButton getActiveButton()
	{
		return _power_buttons[currentPowerIndex()];
	}

	internal void leftButton()
	{
		PowerButton powerButton = getActiveButton();
		while ((Object)(object)powerButton.left != (Object)null)
		{
			powerButton = powerButton.left;
			if (powerButton.canSelect() && ((Behaviour)powerButton).isActiveAndEnabled)
			{
				break;
			}
		}
		selectButton(powerButton);
	}

	internal void rightButton()
	{
		PowerButton powerButton = getActiveButton();
		while ((Object)(object)powerButton.right != (Object)null)
		{
			powerButton = powerButton.right;
			if (powerButton.canSelect() && ((Behaviour)powerButton).isActiveAndEnabled)
			{
				break;
			}
		}
		selectButton(powerButton);
	}

	internal void upButton()
	{
		PowerButton activeButton = getActiveButton();
		if ((Object)(object)activeButton.up != (Object)null && ((Behaviour)activeButton.up).isActiveAndEnabled && activeButton.up.canSelect())
		{
			selectButton(activeButton.up);
		}
		else if ((Object)(object)activeButton.down != (Object)null && ((Behaviour)activeButton.down).isActiveAndEnabled && activeButton.down.canSelect())
		{
			selectButton(activeButton.down);
		}
	}

	internal void downButton()
	{
		PowerButton activeButton = getActiveButton();
		if ((Object)(object)activeButton.down != (Object)null && ((Behaviour)activeButton.down).isActiveAndEnabled && activeButton.down.canSelect())
		{
			selectButton(activeButton.down);
		}
		else if ((Object)(object)activeButton.up != (Object)null && ((Behaviour)activeButton.up).isActiveAndEnabled && activeButton.up.canSelect())
		{
			selectButton(activeButton.up);
		}
	}

	public static void showTabFromButton(Button pButtonTab, bool pHideTooltips = false)
	{
		((UnityEvent)pButtonTab.onClick).Invoke();
		if (pHideTooltips)
		{
			Tooltip.hideTooltipNow();
		}
	}

	public static PowersTab getActiveTab()
	{
		if (!isTabSelected())
		{
			return _main_tab;
		}
		return _current_tab;
	}

	public static bool isTabSelected()
	{
		return (Object)(object)_current_tab != (Object)null;
	}

	public static void unselect()
	{
		_current_tab?.hideTab();
		_main_tab.setActive();
		Tooltip.hideTooltip();
	}

	public bool isCurrentPowerTabSelected()
	{
		return (Object)(object)_current_tab == (Object)(object)this;
	}

	public void tryToShowTab()
	{
		if (!isCurrentPowerTabSelected())
		{
			showTab(null);
		}
	}

	public void showTab(Button pTabButton)
	{
		bool flag = false;
		if ((Object)(object)_current_tab != (Object)null)
		{
			if (isCurrentPowerTabSelected())
			{
				flag = true;
			}
			_current_tab.hideTab();
			_current_tab = null;
		}
		if (flag)
		{
			_main_tab.setActive();
			return;
		}
		PowerTabController.instance.tab_main.hideTab();
		_current_tab = this;
		_current_tab_button = pTabButton;
		setActive(pTabButton);
		if ((Object)(object)pTabButton != (Object)null)
		{
			string textOnClick = ((Component)pTabButton).gameObject.GetComponent<TipButton>().textOnClick;
			WorldTip.instance.showToolbarText(LocalizedTextManager.getText(textOnClick));
		}
		MusicBox.playSoundUI("event:/SFX/UI/ThumbnailsSlide");
	}

	private void setActive(Button pTabButton = null)
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)pTabButton != (Object)null)
		{
			((Selectable)pTabButton).image.sprite = image_selected;
		}
		((Component)this).gameObject.SetActive(true);
		((Component)this).gameObject.transform.localPosition = new Vector3(0f, -16f);
		setNewWidth();
		if (_asset != null)
		{
			PowerTabController.loadScrollPosition(_asset.last_scroll_position);
			if (_asset.tab_type_main)
			{
				SelectedTabsHistory.clear();
			}
		}
		TabCenterer component = ((Component)this).GetComponent<TabCenterer>();
		_ = (Object)(object)component == (Object)null;
		((Component)this).gameObject.transform.localScale = new Vector3(0.2f, 0.9f, 0.9f);
		TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(((Component)this).gameObject.transform, 1f, scale_time), (Ease)9);
		if (_asset == null || !_asset.tab_type_main)
		{
			return;
		}
		foreach (PowerTabAsset item in AssetManager.power_tab_library.list)
		{
			item.on_main_tab_select?.Invoke(item);
		}
	}

	private bool setNewWidth()
	{
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		int childCount = ((Component)this).transform.childCount;
		RectTransform component = parentObj.GetComponent<RectTransform>();
		float x = component.sizeDelta.x;
		float num = 0f;
		float num2 = 0f;
		for (int i = 0; i < childCount; i++)
		{
			GameObject gameObject = ((Component)((Component)this).transform.GetChild(i)).gameObject;
			if (gameObject.activeSelf)
			{
				RectTransform component2 = gameObject.GetComponent<RectTransform>();
				float num3 = ((Transform)component2).localPosition.x + component2.sizeDelta.x;
				Rect rect = component2.rect;
				num = num3 + ((Rect)(ref rect)).x;
				if (num > num2)
				{
					num2 = num;
				}
			}
		}
		component.sizeDelta = new Vector2(num2 + 5f, component.sizeDelta.y);
		PowerTabController.instance.resetToStartScrollPosition();
		return x != num2;
	}

	public bool recalc()
	{
		return setNewWidth();
	}

	public void hideTab()
	{
		saveScrollPosition();
		completeHide();
		_current_tab = null;
		if ((Object)(object)_current_tab_button != (Object)null)
		{
			((Selectable)_current_tab_button).image.sprite = image_normal;
			_current_tab_button = null;
		}
	}

	private void saveScrollPosition()
	{
		if (_asset != null)
		{
			_asset.last_scroll_position = PowerTabController.currentScrollPosition();
		}
	}

	private void completeHide()
	{
		((Component)this).gameObject.SetActive(false);
	}

	private void OnDisable()
	{
		if (Config.isDraggingItem())
		{
			Config.getDraggingObject().KillDrag();
		}
	}

	private void prepareButtonPosition(RectTransform pRect)
	{
		if (!((Object)(object)pRect == (Object)null))
		{
			pRect.SetAnchor(AnchorPresets.TopLeft);
			pRect.SetPivot(PivotPresets.TopLeft);
		}
	}

	private void restoreButtonPosition(RectTransform pRect)
	{
		if (!((Object)(object)pRect == (Object)null))
		{
			pRect.SetPivot(PivotPresets.MiddleCenter, pKeepPosition: true);
		}
	}

	public void sortButtons()
	{
		//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0112: Unknown result type (might be due to invalid IL or missing references)
		//IL_0117: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0228: Unknown result type (might be due to invalid IL or missing references)
		Transform transform = ((Component)this).gameObject.transform;
		float num = 9.6f;
		int num2 = 0;
		int num3 = 0;
		int num4 = 0;
		float num5 = 20f;
		RectTransform pRect = default(RectTransform);
		PowerButton powerButton = default(PowerButton);
		for (int i = 0; i < transform.childCount; i++)
		{
			GameObject gameObject = ((Component)transform.GetChild(i)).gameObject;
			ShortcutExtensions.DOKill((Component)(object)gameObject.transform, true);
			if (!gameObject.activeSelf)
			{
				continue;
			}
			gameObject.TryGetComponent<RectTransform>(ref pRect);
			if (((Object)gameObject).name.StartsWith("_space_half"))
			{
				if (num4 > 0)
				{
					num5 += 36f;
					num4 = 0;
				}
				num5 += num;
				continue;
			}
			if (((Object)gameObject).name.StartsWith("_line") || ((Object)gameObject).name.StartsWith("element_"))
			{
				if (num4 > 0)
				{
					num5 += 36f;
					num4 = 0;
				}
				float num6 = 32f;
				if (((Object)gameObject).name.StartsWith("_line"))
				{
					num6 = 37.2f;
				}
				prepareButtonPosition(pRect);
				gameObject.transform.localPosition = new Vector3(num5, num6, 0f);
				float num7 = num5;
				Rect rect = ((RectTransform)gameObject.transform).rect;
				num5 = num7 + ((Rect)(ref rect)).width;
				num5 += 4f;
				restoreButtonPosition(pRect);
				continue;
			}
			gameObject.TryGetComponent<PowerButton>(ref powerButton);
			if (!((Object)gameObject).name.Contains("_space") && ((Object)(object)powerButton == (Object)null || !((Behaviour)powerButton).isActiveAndEnabled))
			{
				continue;
			}
			bool flag = false;
			if (num4 % 2 == 0)
			{
				num2++;
				num3 = 0;
				flag = num4 > 0;
			}
			else
			{
				num3 = 1;
			}
			num4++;
			if (((Object)gameObject).name.StartsWith("_space"))
			{
				if (flag)
				{
					num5 += 36f;
				}
				continue;
			}
			if (flag)
			{
				num5 += 36f;
			}
			if (!((Object)(object)powerButton == (Object)null) && ((Behaviour)powerButton).isActiveAndEnabled)
			{
				float num8 = 0f;
				num8 = ((num3 != 0) ? (-4f) : 32f);
				if (((Object)gameObject).name.Contains("tab_back_button"))
				{
					num8 = 32f;
				}
				prepareButtonPosition(pRect);
				((Component)powerButton).transform.localPosition = new Vector3(num5, num8, 0f);
				restoreButtonPosition(pRect);
			}
		}
	}
}
// --- End of File: PowersTab.cs ---



// --- Start of File: PowerTabAction.cs ---
public delegate void PowerTabAction(PowerTabAsset pPowerTabAsset);
// --- End of File: PowerTabAction.cs ---



// --- Start of File: PowerTabActionCheck.cs ---
public delegate bool PowerTabActionCheck(PowerTabAsset pPowerTabAsset);
// --- End of File: PowerTabActionCheck.cs ---



// --- Start of File: PowerTabAsset.cs ---
using System;
using UnityEngine;

[Serializable]
public class PowerTabAsset : Asset, IDescriptionAsset, ILocalizedAsset
{
	[NonSerialized]
	public PowersTab gameplay_tab;

	public bool tab_type_selected;

	public bool tab_type_main;

	public PowerTabGetter get_power_tab;

	public string window_id;

	public MetaType meta_type;

	public PowerTabAction on_main_tab_select;

	public PowerTabAction on_main_info_click;

	public PowerTabActionCheck on_update_check_active;

	public PowerTabWorldtipAction get_localized_worldtip;

	public string icon_path;

	public string locale_key;

	[NonSerialized]
	public float last_scroll_position;

	public void tryToShowPowerTab()
	{
		PowersTab powersTab = get_power_tab?.Invoke();
		if ((Object)(object)powersTab == (Object)null)
		{
			Debug.LogError((object)("PowerTabAsset: tryToShowPowerTab: get_power_tab returned null for " + meta_type));
		}
		else
		{
			powersTab.tryToShowTab();
		}
	}

	public string getLocaleID()
	{
		return locale_key;
	}

	public string getDescriptionID()
	{
		if (locale_key == null)
		{
			return null;
		}
		return locale_key + "_info";
	}

	public Sprite getIcon()
	{
		return SpriteTextureLoader.getSprite(icon_path);
	}
}
// --- End of File: PowerTabAsset.cs ---



// --- Start of File: PowerTabController.cs ---
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.UI;

public class PowerTabController : MonoBehaviour
{
	public PowersTab tab_main;

	public PowersTab tab_selected_unit;

	public PowersTab tab_multiple_units;

	public PowersTab tab_selected_kingdom;

	public PowersTab tab_selected_subspecies;

	public PowersTab tab_selected_alliance;

	public PowersTab tab_selected_army;

	public PowersTab tab_selected_family;

	public PowersTab tab_selected_language;

	public PowersTab tab_selected_culture;

	public PowersTab tab_selected_religion;

	public PowersTab tab_selected_clan;

	public PowersTab tab_selected_city;

	[Space]
	public Button t_main;

	public Button t_drawing;

	public Button t_kingdoms;

	public Button t_creatures;

	public Button t_bombs;

	public Button t_nature;

	public Button t_other;

	public Transform copyTarget;

	[Space]
	internal static PowerTabController instance;

	public ToolbarArrow arrowLeft;

	public ToolbarArrow arrowRight;

	public RectTransform rect;

	public ScrollRectExtended scrollRect;

	private List<Button> _buttons;

	public static string prev_selected_meta_id;

	private void Awake()
	{
		instance = this;
		_buttons = new List<Button> { t_drawing, t_kingdoms, t_creatures, t_nature, t_bombs, t_other };
	}

	private void Update()
	{
		PowersTab activeTab = PowersTab.getActiveTab();
		PowerTabAsset asset = activeTab.getAsset();
		if (asset.on_update_check_active != null && !asset.on_update_check_active(asset))
		{
			activeTab.hideTab();
			showMainTab();
			World.world.selected_buttons.unselectTabs();
		}
		else
		{
			activeTab.update();
		}
	}

	internal static float currentScrollPosition()
	{
		return instance.scrollRect.horizontalNormalizedPosition;
	}

	public static void loadScrollPosition(float pPosition)
	{
	}

	internal void resetToStartScrollPosition()
	{
		scrollRect.horizontalNormalizedPosition = 0f;
	}

	public Button getTabForTabGroup(string pGroupName)
	{
		foreach (Button button in _buttons)
		{
			if (((UnityEventBase)button.onClick).GetPersistentTarget(0).name == pGroupName)
			{
				return button;
			}
		}
		return null;
	}

	public Button getNext(string pActiveTab)
	{
		_buttons.Sort((Button a, Button b) => ((Component)a).transform.GetSiblingIndex().CompareTo(((Component)b).transform.GetSiblingIndex()));
		for (int i = 0; i < _buttons.Count; i++)
		{
			if (((UnityEventBase)_buttons[i].onClick).GetPersistentTarget(0).name == pActiveTab && i < _buttons.Count - 1)
			{
				return _buttons[i + 1];
			}
		}
		return _buttons.First();
	}

	public Button getPrev(string pActiveTab)
	{
		_buttons.Sort((Button a, Button b) => ((Component)a).transform.GetSiblingIndex().CompareTo(((Component)b).transform.GetSiblingIndex()));
		for (int i = 0; i < _buttons.Count; i++)
		{
			if (((UnityEventBase)_buttons[i].onClick).GetPersistentTarget(0).name == pActiveTab && i > 0)
			{
				return _buttons[i - 1];
			}
		}
		return _buttons.Last();
	}

	public static void showMainTab()
	{
		instance.tab_main.showTab(null);
	}

	public static void showTabSelectedUnit()
	{
		SelectedTabsHistory.addToHistory(SelectedUnit.unit);
		PowerTabAsset asset = getAsset("selected_unit");
		asset.tryToShowPowerTab();
		showWorldTipSelected(asset.id);
	}

	public static void showTabMultipleUnits()
	{
		PowerTabAsset asset = getAsset("multiple_units");
		asset.tryToShowPowerTab();
		showWorldTipSelected(asset.id);
	}

	public static void showTabSelectedMeta(MetaTypeAsset pMetaTypeAsset)
	{
		PowerTabAsset asset = getAsset(pMetaTypeAsset.power_tab_id);
		asset.tryToShowPowerTab();
		MetaTypeAsset.last_meta_type = pMetaTypeAsset.id;
		showWorldTipSelected(asset.id);
	}

	public static void showWorldTipSelected(string pPowerTabId, bool pBar = true)
	{
		string typeID = SelectedObjects.getSelectedNanoObject().getTypeID();
		if (!(prev_selected_meta_id == typeID))
		{
			prev_selected_meta_id = typeID;
			PowerTabAsset powerTabAsset = AssetManager.power_tab_library.get(pPowerTabId);
			string pText = powerTabAsset.get_localized_worldtip(powerTabAsset);
			if (pBar)
			{
				WorldTip.instance.showToolbarText(pText);
			}
			else
			{
				WorldTip.showNowTop(pText, pTranslate: false);
			}
		}
	}

	public static PowerTabAsset getAsset(string pID)
	{
		return AssetManager.power_tab_library.get(pID);
	}
}
// --- End of File: PowerTabController.cs ---



// --- Start of File: PowerTabGetter.cs ---
public delegate PowersTab PowerTabGetter();
// --- End of File: PowerTabGetter.cs ---



// --- Start of File: PowerTabLibrary.cs ---
public class PowerTabLibrary : AssetLibrary<PowerTabAsset>
{
	public override void init()
	{
		addMainTabs();
		addSelectionTabs();
		add(new PowerTabAsset
		{
			id = "selected_unit",
			meta_type = MetaType.Unit,
			window_id = "unit",
			on_main_tab_select = delegate
			{
				if (SelectedUnit.isSet())
				{
					SelectedUnit.clear();
				}
			},
			on_main_info_click = delegate
			{
				ActionLibrary.openUnitWindow(SelectedUnit.unit);
				ScrollWindow.getCurrentWindow().tabs.showTab("MainTab");
			},
			on_update_check_active = (PowerTabAsset _) => SelectedUnit.isSet(),
			get_localized_worldtip = getWorldTipTextMetaName,
			get_power_tab = () => PowerTabController.instance.tab_selected_unit
		});
		add(new PowerTabAsset
		{
			id = "multiple_units",
			on_update_check_active = (PowerTabAsset _) => SelectedUnit.isSet(),
			on_main_tab_select = delegate
			{
				if (SelectedUnit.isSet())
				{
					SelectedUnit.clear();
				}
			},
			on_main_info_click = delegate
			{
				ActionLibrary.openUnitWindow(SelectedUnit.unit);
				ScrollWindow.getCurrentWindow().tabs.showTab("MainTab");
			},
			get_localized_worldtip = getWorldTipTextAmount,
			get_power_tab = () => PowerTabController.instance.tab_multiple_units
		});
		add(new PowerTabAsset
		{
			id = "selected_building"
		});
	}

	private void addMainTabs()
	{
		add(new PowerTabAsset
		{
			id = "main",
			tab_type_main = true
		});
		add(new PowerTabAsset
		{
			id = "creation",
			locale_key = "tab_world_creation",
			icon_path = "ui/Icons/power_tabs/icon_tab_drawings",
			tab_type_main = true
		});
		add(new PowerTabAsset
		{
			id = "noosphere",
			locale_key = "tab_noosphere",
			icon_path = "ui/Icons/power_tabs/icon_tab_noosphere",
			tab_type_main = true
		});
		add(new PowerTabAsset
		{
			id = "units",
			locale_key = "tab_world_creatures",
			icon_path = "ui/Icons/power_tabs/icon_tab_creatures",
			tab_type_main = true
		});
		add(new PowerTabAsset
		{
			id = "nature",
			locale_key = "tab_nature",
			icon_path = "ui/Icons/power_tabs/icon_tab_nature",
			tab_type_main = true
		});
		add(new PowerTabAsset
		{
			id = "destruction",
			locale_key = "tab_explosions",
			icon_path = "ui/Icons/power_tabs/icon_tab_bombs",
			tab_type_main = true
		});
		add(new PowerTabAsset
		{
			id = "other",
			locale_key = "tab_other",
			icon_path = "ui/Icons/power_tabs/icon_tab_other",
			tab_type_main = true
		});
	}

	private void addSelectionTabs()
	{
		add(new PowerTabAsset
		{
			id = "selected_army",
			meta_type = MetaType.Army,
			window_id = "army",
			get_power_tab = () => PowerTabController.instance.tab_selected_army,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_family",
			meta_type = MetaType.Family,
			window_id = "family",
			get_power_tab = () => PowerTabController.instance.tab_selected_family,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_subspecies",
			meta_type = MetaType.Subspecies,
			window_id = "subspecies",
			get_power_tab = () => PowerTabController.instance.tab_selected_subspecies,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_language",
			meta_type = MetaType.Language,
			window_id = "language",
			get_power_tab = () => PowerTabController.instance.tab_selected_language,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_culture",
			meta_type = MetaType.Culture,
			window_id = "culture",
			get_power_tab = () => PowerTabController.instance.tab_selected_culture,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_religion",
			meta_type = MetaType.Religion,
			window_id = "religion",
			get_power_tab = () => PowerTabController.instance.tab_selected_religion,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_clan",
			meta_type = MetaType.Clan,
			window_id = "clan",
			get_power_tab = () => PowerTabController.instance.tab_selected_clan,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_city",
			meta_type = MetaType.City,
			window_id = "city",
			get_power_tab = () => PowerTabController.instance.tab_selected_city,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_kingdom",
			meta_type = MetaType.Kingdom,
			window_id = "kingdom",
			get_power_tab = () => PowerTabController.instance.tab_selected_kingdom,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
		add(new PowerTabAsset
		{
			id = "selected_alliance",
			meta_type = MetaType.Alliance,
			window_id = "alliance",
			get_power_tab = () => PowerTabController.instance.tab_selected_alliance,
			on_update_check_active = defaultOnUpdateCheckActive,
			on_main_tab_select = defaultMainTabSelect,
			on_main_info_click = defaultMainInfoClick,
			get_localized_worldtip = getWorldTipTextMetaName
		});
	}

	private void defaultMainTabSelect(PowerTabAsset pAsset)
	{
		SelectedObjects.unselectNanoObject();
		pAsset.meta_type.getAsset().window_action_clear();
	}

	private bool defaultOnUpdateCheckActive(PowerTabAsset pAsset)
	{
		return SelectedObjects.isNanoObjectSet();
	}

	private void defaultMainInfoClick(PowerTabAsset pAsset)
	{
		ScrollWindow.showWindow(pAsset.window_id);
		ScrollWindow.getCurrentWindow().tabs.showTab("MainTab");
	}

	private string getWorldTipTextMetaName(PowerTabAsset pAsset)
	{
		NanoObject selectedNanoObject = SelectedObjects.getSelectedNanoObject();
		string text = LocalizedTextManager.getText("show_tab_" + pAsset.id);
		string newValue = StringExtension.ColorHex(pColorHex: selectedNanoObject.getColor().color_text, pString: selectedNanoObject.name);
		return text.Replace("$name$", newValue);
	}

	private string getWorldTipTextAmount(PowerTabAsset pAsset)
	{
		int num = SelectedUnit.countSelected();
		return LocalizedTextManager.getText("show_tab_" + pAsset.id).Replace("$amount$", num.ToString());
	}

	public override void editorDiagnosticLocales()
	{
		foreach (PowerTabAsset item in list)
		{
			checkLocale(item, item.getLocaleID());
			checkLocale(item, item.getDescriptionID());
		}
		base.editorDiagnosticLocales();
	}
}
// --- End of File: PowerTabLibrary.cs ---



// --- Start of File: PowerTabWorldtipAction.cs ---
public delegate string PowerTabWorldtipAction(PowerTabAsset pPowerTabAsset);
// --- End of File: PowerTabWorldtipAction.cs ---



// --- Start of File: PowerToggleAction.cs ---
using System;

[Serializable]
public delegate void PowerToggleAction(string pPower);
// --- End of File: PowerToggleAction.cs ---



// --- Start of File: PowerTracker.cs ---
using System.Collections.Generic;
using UnityEngine;

internal class PowerTracker : MonoBehaviour
{
	private static int amount = 0;

	private static PowerTracker instance;

	private static bool frameDone = false;

	internal static SteamTracker steamTracker;

	internal static DiscordTracker discordTracker;

	private static bool initiated = false;

	internal static StatisticsAsset activeStat;

	internal static string statValue = "";

	private static float timer = 10f;

	private static float secTimer = 1f;

	private static int currentIndex = 0;

	private static List<StatisticsAsset> rotateStats => StatisticsLibrary.power_tracker_pool;

	private void Start()
	{
		instance = this;
		if (!Config.disable_discord)
		{
			discordTracker = ((Component)this).gameObject.AddComponent<DiscordTracker>();
		}
		if (!Config.disable_steam)
		{
			steamTracker = ((Component)this).gameObject.AddComponent<SteamTracker>();
		}
		initiated = true;
	}

	internal static void PlusOne(GodPower pPower = null)
	{
		if (!((Object)(object)instance == (Object)null) && !MoveCamera.hasFocusUnit() && pPower != null)
		{
			frameDone = true;
			amount++;
			discordTracker?.updateUsing(amount, pPower.getLocaleID());
			steamTracker?.updateUsing(amount, pPower.getLocaleID());
		}
	}

	internal static void trackPower(string pString = "")
	{
		if ((Object)(object)instance == (Object)null || MoveCamera.hasFocusUnit())
		{
			return;
		}
		switch (pString)
		{
		case "ButtonLeader":
			return;
		case "ButtonKingdom":
			return;
		case "ButtonCapital":
			return;
		}
		amount = 0;
		if (!frameDone)
		{
			steamTracker?.trackViewing(pString);
			discordTracker?.trackViewing(pString);
		}
	}

	internal static void setPower(GodPower pPower)
	{
		if ((Object)(object)instance == (Object)null || MoveCamera.hasFocusUnit())
		{
			return;
		}
		frameDone = true;
		if (pPower == null)
		{
			trackWatching();
		}
		else
		{
			if (!pPower.track_activity)
			{
				return;
			}
			if (LocalizedTextManager.stringExists(pPower.getLocaleID()))
			{
				discordTracker?.trackUsing(pPower.getLocaleID());
				steamTracker?.trackUsing(pPower.getLocaleID());
			}
		}
		amount = 0;
	}

	internal static void trackWatching()
	{
		if (!((Object)(object)instance == (Object)null))
		{
			discordTracker?.trackWatching();
			steamTracker?.trackWatching();
		}
	}

	internal static void spectatingUnit(string pUnit)
	{
		if (!((Object)(object)instance == (Object)null))
		{
			frameDone = true;
			steamTracker?.spectatingUnit(pUnit);
			discordTracker?.spectatingUnit(pUnit);
		}
	}

	internal static void trackWindow(string screen_id, ScrollWindow pWindow)
	{
		if ((Object)(object)instance == (Object)null)
		{
			return;
		}
		frameDone = true;
		switch (screen_id)
		{
		case "kingdom":
			steamTracker?.inspectKingdom(SelectedMetas.selected_kingdom.name);
			discordTracker?.inspectKingdom(SelectedMetas.selected_kingdom.name);
			return;
		case "city":
			steamTracker?.inspectVillage(SelectedMetas.selected_city.name);
			discordTracker?.inspectVillage(SelectedMetas.selected_city.name);
			return;
		case "unit":
			steamTracker?.inspectUnit(SelectedUnit.unit.getName());
			discordTracker?.inspectUnit(SelectedUnit.unit.getName());
			return;
		}
		Transform val = ((Component)pWindow).transform.Find("Background/Title");
		if ((Object)(object)val == (Object)null)
		{
			val = ((Component)pWindow).transform.FindRecursive("Title");
		}
		if ((Object)(object)val != (Object)null && ((Component)(object)val).HasComponent<LocalizedText>() && ((Component)val).GetComponent<LocalizedText>().key != "??????")
		{
			steamTracker?.trackViewing(((Component)val).GetComponent<LocalizedText>().key);
			discordTracker?.trackViewing(((Component)val).GetComponent<LocalizedText>().key);
		}
		else
		{
			Debug.Log((object)("[PT] Not found " + screen_id));
			steamTracker?.trackViewing(screen_id);
			discordTracker?.trackViewing(screen_id);
		}
	}

	private static void resetTimer()
	{
		timer = 9f;
	}

	private static void nextStat()
	{
		currentIndex = Randy.randomInt(0, rotateStats.Count);
		if (currentIndex >= rotateStats.Count)
		{
			currentIndex = 0;
		}
	}

	private void updateStat()
	{
		if (!((Object)(object)instance == (Object)null))
		{
			StatisticsAsset statisticsAsset = rotateStats[currentIndex];
			string text = statisticsAsset.string_action(statisticsAsset);
			if (text != "0" && !string.IsNullOrEmpty(text))
			{
				statisticsAsset.last_value = text;
				activeStat = statisticsAsset;
			}
			else
			{
				nextStat();
				updateStat();
			}
		}
	}

	private void OnDestroy()
	{
		instance = null;
	}

	private void Update()
	{
		if (initiated && (Object)(object)discordTracker == (Object)null && (Object)(object)steamTracker == (Object)null)
		{
			Object.Destroy((Object)(object)this);
			Debug.Log((object)"[PT] Destroying...");
			return;
		}
		if (secTimer > 0f)
		{
			secTimer -= Time.deltaTime;
		}
		else
		{
			secTimer = 1f;
			updateStat();
		}
		if (timer > 0f)
		{
			timer -= Time.deltaTime;
			return;
		}
		resetTimer();
		nextStat();
	}

	private void LateUpdate()
	{
		frameDone = false;
	}
}
// --- End of File: PowerTracker.cs ---



// --- Start of File: PreciseLocale.cs ---
using System;
using System.Runtime.InteropServices;

public class PreciseLocale
{
	private interface PlatformBridge
	{
		string GetRegion();

		string GetLanguage();

		string GetLanguageID();

		string GetCurrencyCode();

		string GetCurrencySymbol();
	}

	private class EditorBridge : PlatformBridge
	{
		public string GetRegion()
		{
			return "US";
		}

		public string GetLanguage()
		{
			return "en";
		}

		public string GetLanguageID()
		{
			return "en_US";
		}

		public string GetCurrencyCode()
		{
			return "USD";
		}

		public string GetCurrencySymbol()
		{
			return "$";
		}
	}

	private class PreciseLocaleWindows : PlatformBridge
	{
		[DllImport("PreciseLocale")]
		private static extern IntPtr _getLanguage();

		[DllImport("PreciseLocale")]
		private static extern IntPtr _getRegion();

		[DllImport("PreciseLocale")]
		private static extern IntPtr _getCurrencyCode();

		[DllImport("PreciseLocale")]
		private static extern IntPtr _getCurrencySymbol();

		public string GetLanguage()
		{
			return Marshal.PtrToStringUni(_getLanguage());
		}

		public string GetLanguageID()
		{
			return GetLanguage() + "_" + GetRegion();
		}

		public string GetRegion()
		{
			return Marshal.PtrToStringUni(_getRegion());
		}

		public string GetCurrencyCode()
		{
			return Marshal.PtrToStringUni(_getCurrencyCode());
		}

		public string GetCurrencySymbol()
		{
			return Marshal.PtrToStringUni(_getCurrencySymbol());
		}
	}

	private static PlatformBridge _platform;

	private static PlatformBridge platform
	{
		get
		{
			if (_platform == null)
			{
				_platform = new PreciseLocaleWindows();
			}
			return _platform;
		}
	}

	public static string GetRegion()
	{
		return platform.GetRegion();
	}

	public static string GetLanguageID()
	{
		return platform.GetLanguageID();
	}

	public static string GetLanguage()
	{
		return platform.GetLanguage();
	}

	public static string GetCurrencyCode()
	{
		return platform.GetCurrencyCode();
	}

	public static string GetCurrencySymbol()
	{
		return platform.GetCurrencySymbol();
	}
}
// --- End of File: PreciseLocale.cs ---



// --- Start of File: PrefabLibrary.cs ---
using UnityEngine;
using UnityEngine.UI;

public class PrefabLibrary : MonoBehaviour
{
	internal static PrefabLibrary instance;

	public GameObject graphy;

	public DebugTool debugTool;

	public DragonAsset dragonAsset;

	public DragonAsset zombieDragonAsset;

	public Image iconLock;

	private void Awake()
	{
		instance = this;
	}
}
// --- End of File: PrefabLibrary.cs ---



// --- Start of File: PrefabUnitElement.cs ---
using System;
using System.Runtime.CompilerServices;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.UI;

public class PrefabUnitElement : WindowListElementBaseActor, IPointerMoveHandler, IEventSystemHandler
{
	[Serializable]
	[CompilerGenerated]
	private sealed class _003C_003Ec
	{
		public static readonly _003C_003Ec _003C_003E9 = new _003C_003Ec();

		public static UnityAction _003C_003E9__20_0;

		internal void _003CinitTooltip_003Eb__20_0()
		{
			Tooltip.hideTooltip();
		}
	}

	private Actor _actor;

	public Text unitName;

	public UiUnitAvatarElement avatarElement;

	public StatBar health_bar;

	public CountUpOnClick text_damage;

	public CountUpOnClick text_level;

	public CountUpOnClick text_kills;

	public CountUpOnClick text_age;

	public Image icon_sex;

	[SerializeField]
	private Image _icon_species;

	[SerializeField]
	private GameObject _icon_favorite;

	private void Awake()
	{
		initTooltip();
	}

	internal void show(Actor pActor)
	{
		_actor = pActor;
		unitName.text = pActor.coloredName;
		avatarElement.show(pActor);
		health_bar.setBar(pActor.getHealth(), pActor.getMaxHealth(), "");
		text_level.setValue(pActor.level);
		text_kills.setValue(pActor.data.kills);
		text_age.setValue(pActor.getAge());
		if (pActor.asset.inspect_sex)
		{
			((Component)icon_sex).gameObject.SetActive(true);
			if (pActor.isSexMale())
			{
				icon_sex.sprite = SpriteTextureLoader.getSprite("ui/icons/IconMale");
			}
			else
			{
				icon_sex.sprite = SpriteTextureLoader.getSprite("ui/icons/IconFemale");
			}
		}
		else
		{
			((Component)icon_sex).gameObject.SetActive(false);
		}
		_icon_species.sprite = _actor.asset.getSpriteIcon();
		toggleFavorited(_actor.isFavorite());
	}

	public void clickLocate()
	{
		WorldLog.locationFollow(_actor);
	}

	public void clickInspect()
	{
		if (!InputHelpers.mouseSupported && !Tooltip.isShowingFor(this))
		{
			tooltipAction();
		}
		else
		{
			ActionLibrary.openUnitWindow(_actor);
		}
	}

	public Actor getActor()
	{
		return _actor;
	}

	public void toggleFavorited(bool pState)
	{
		_icon_favorite.SetActive(pState);
	}

	private void OnDisable()
	{
		_actor = null;
	}

	public void OnPointerMove(PointerEventData pData)
	{
		if (InputHelpers.mouseSupported && !Tooltip.anyActive())
		{
			tooltipAction();
		}
	}

	private void tooltipAction()
	{
		_actor.showTooltip(this);
	}

	private void initTooltip()
	{
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Expected O, but got Unknown
		Button component = ((Component)this).GetComponent<Button>();
		object obj = _003C_003Ec._003C_003E9__20_0;
		if (obj == null)
		{
			UnityAction val = delegate
			{
				Tooltip.hideTooltip();
			};
			_003C_003Ec._003C_003E9__20_0 = val;
			obj = (object)val;
		}
		component.OnHoverOut((UnityAction)obj);
	}
}
// --- End of File: PrefabUnitElement.cs ---



// --- Start of File: PrefixesSettings.cs ---
using System;

[Serializable]
public class PrefixesSettings : StructureSettings
{
	public override void create(LanguageStructure pStructure, int pSizeMin, int pSizeMax)
	{
		WordType[] word_types = LanguageStructureHelpers.word_types;
		foreach (WordType pWord in word_types)
		{
			generate(pStructure, pWord, pSizeMin, pSizeMax);
		}
	}

	public void generate(LanguageStructure pStructure, WordType pWord, int pSizeMin, int pSizeMax)
	{
		int num = Randy.randomInt(pSizeMin, pSizeMax);
		bool flag = num != 0 && Randy.randomBool();
		enabled[(int)pWord] = flag;
		if (flag)
		{
			sets[(int)pWord] = generateSets(pStructure, num);
			separator[(int)pWord] = "";
		}
	}

	private string[] generateSets(LanguageStructure pStructure, int pAmount)
	{
		string[] array = new string[pAmount];
		for (int i = 0; i < pAmount; i++)
		{
			array[i] = Randy.randomInt(0, 5) switch
			{
				0 => pStructure.sets_consonants.GetRandom() + pStructure.sets_vowels.GetRandom(), 
				1 => pStructure.sets_onset_2.GetRandom() + pStructure.sets_vowels.GetRandom(), 
				2 => pStructure.sets_consonants.GetRandom() + pStructure.sets_vowels.GetRandom(), 
				_ => pStructure.sets_vowels.GetRandom() + pStructure.sets_consonants.GetRandom(), 
			};
		}
		return array;
	}
}
// --- End of File: PrefixesSettings.cs ---



// --- Start of File: PreloadHelpers.cs ---
using System.Collections.Generic;
using System.IO;
using UnityEngine;

public static class PreloadHelpers
{
	private static bool _initiated = false;

	public static int total_building_sprite_containers = 0;

	public static int total_building_sprites = 0;

	public static List<Sprite> all_preloaded_sprites_buildings = new List<Sprite>();

	public static void init()
	{
		if (!_initiated)
		{
			_initiated = true;
			WindowPreloader.addWindowPreloadResources();
			SmoothLoader.add(delegate
			{
				HandRendererTexturePreloader.launch();
			}, "Preload hand item textures...", pSkipFrame: false, 0.2f);
			SmoothLoader.add(delegate
			{
				AssetManager.actor_library.preloadMainUnitSprites();
				Debug.Log((object)("Loaded unit related sprites: " + ActorTextureSubAsset.all_preloaded_sprites_units.Count));
			}, "Preload main unit textures...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				AssetManager.subspecies_traits.preloadMainUnitSprites();
				Debug.Log((object)("Loaded unit related sprites: " + ActorTextureSubAsset.all_preloaded_sprites_units.Count));
			}, "Preload unit trait textures...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				preloadBuildingSpriteLists();
			}, "Preload building sprite lists...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				preloadBuildingSprites();
			}, "Preload building sprites...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				preloadBoatAnimations();
			}, "Preload boat animations...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				preloadActorAnimations();
			}, "Preload unit animations...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				preloadPixelBagsUnits();
			}, "Preload pixel bags units...", pSkipFrame: false, 0.1f);
			SmoothLoader.add(delegate
			{
				preloadPixelBagsBuildings();
			}, "Preload pixel bags buildings...", pSkipFrame: false, 0.1f);
		}
	}

	private static void preloadBuildingSpriteLists()
	{
		if (!Config.preload_buildings)
		{
			return;
		}
		foreach (BuildingAsset item in AssetManager.buildings.list)
		{
			item.loadBuildingSpriteList();
		}
	}

	private static void preloadBuildingSprites()
	{
		if (!Config.preload_buildings)
		{
			return;
		}
		foreach (BuildingAsset item in AssetManager.buildings.list)
		{
			item.loadBuildingSprites();
		}
		AssetManager.dynamic_sprites_library.checkDirty();
	}

	private static void preloadBoatAnimations()
	{
		if (!Config.preload_units)
		{
			return;
		}
		foreach (ActorAsset list_only_boat_asset in AssetManager.actor_library.list_only_boat_assets)
		{
			ActorAnimationLoader.loadAnimationBoat(list_only_boat_asset.boat_texture_id);
		}
	}

	private static void preloadActorAnimations()
	{
		if (!Config.preload_units)
		{
			return;
		}
		foreach (ActorAsset item in AssetManager.actor_library.list)
		{
			if (item.isTemplateAsset() || item.is_boat || item.ignore_generic_render || item.texture_asset == null)
			{
				continue;
			}
			foreach (KeyValuePair<string, Sprite[]> dict_main in item.texture_asset.dict_mains)
			{
				ActorAnimationLoader.getAnimationContainer(dict_main.Key, item);
			}
		}
	}

	private static void preloadPixelBagsUnits()
	{
		if (!Config.preload_units)
		{
			return;
		}
		foreach (Sprite all_preloaded_sprites_unit in ActorTextureSubAsset.all_preloaded_sprites_units)
		{
			PixelBagManager.preloadPixelBagUnit(all_preloaded_sprites_unit);
		}
	}

	private static void preloadPixelBagsBuildings()
	{
		if (!Config.preload_buildings)
		{
			return;
		}
		foreach (Sprite all_preloaded_sprites_building in all_preloaded_sprites_buildings)
		{
			PixelBagManager.preloadPixelBagUnit(all_preloaded_sprites_building);
		}
	}

	private static void createPreloadReport()
	{
		string path = "GenAssets/wbdiag/preloaded_assets_report.txt";
		using StringBuilderPool stringBuilderPool = new StringBuilderPool();
		int num = 0;
		num += ActorTextureSubAsset.all_preloaded_sprites_units.Count;
		num += PixelBagManager.total;
		num += SpriteTextureLoader.total_sprites;
		num += SpriteTextureLoader.total_sprites_list;
		num += SpriteTextureLoader.total_sprites_list_single_sprites;
		num += ActorAnimationLoader.count_units;
		num += ActorAnimationLoader.count_heads;
		num += ActorAnimationLoader.count_boats;
		num += ActorTextureSubAsset.getTotal();
		num += total_building_sprite_containers;
		num += total_building_sprites;
		num += HandRendererTexturePreloader.getTotal();
		int num2 = 0;
		foreach (BaseAssetLibrary item in AssetManager.getList())
		{
			num2 += item.total_items;
		}
		stringBuilderPool.AppendLine("# Preloaded Assets Report");
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine("Total Preloaded Graphical Stuff: " + num);
		stringBuilderPool.AppendLine("Total Preloaded Assets: " + num2);
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine("[Sprites] Preloaded Sprites: " + ActorTextureSubAsset.all_preloaded_sprites_units.Count);
		stringBuilderPool.AppendLine("[Sprites] Preloaded Building Sprites: " + total_building_sprites);
		stringBuilderPool.AppendLine("[Sprites] Hand Renderer Sprites: " + HandRendererTexturePreloader.getTotal());
		stringBuilderPool.AppendLine("[Objects] Preloaded Building Sprite Containers: " + total_building_sprite_containers);
		stringBuilderPool.AppendLine("[Objects] Preloaded Pixel Bags: " + PixelBagManager.total);
		stringBuilderPool.AppendLine("[Objects] Texture Sub Assets: " + ActorTextureSubAsset.getTotal());
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine("[SpriteTextureLoader] Total Single Sprites: " + SpriteTextureLoader.total_sprites);
		stringBuilderPool.AppendLine("[SpriteTextureLoader] Total Sprites Lists: " + SpriteTextureLoader.total_sprites_list);
		stringBuilderPool.AppendLine("[SpriteTextureLoader] Total Sprites Lists Single Sprites: " + SpriteTextureLoader.total_sprites_list_single_sprites);
		stringBuilderPool.AppendLine();
		stringBuilderPool.AppendLine("[ActorAnimationLoader] Total Units: " + ActorAnimationLoader.count_units);
		stringBuilderPool.AppendLine("[ActorAnimationLoader] Total Heads: " + ActorAnimationLoader.count_heads);
		stringBuilderPool.AppendLine("[ActorAnimationLoader] Total Boats: " + ActorAnimationLoader.count_boats);
		stringBuilderPool.AppendLine();
		foreach (BaseAssetLibrary item2 in AssetManager.getList())
		{
			stringBuilderPool.AppendLine(item2.id + ": " + item2.total_items);
		}
		File.WriteAllTextAsync(path, stringBuilderPool.ToString());
	}
}
// --- End of File: PreloadHelpers.cs ---



// --- Start of File: PremiumElementsChecker.cs ---
using UnityEngine;

public class PremiumElementsChecker : MonoBehaviour
{
	public GameObject premiumButtonCorner;

	public GameObject adsButton;

	private static PremiumElementsChecker instance;

	internal float insterAdTimer = 25f;

	private void Awake()
	{
		instance = this;
	}

	internal static bool goodForInterstitialAd()
	{
		if (DebugConfig.isOn(DebugOption.TestAds))
		{
			return true;
		}
		return false;
	}

	public static void setInterstitialAdTimer(int howLong = 80)
	{
		if (DebugConfig.isOn(DebugOption.TestAds))
		{
			howLong = 15;
		}
		if (howLong > 100)
		{
			howLong = 100;
		}
		instance.insterAdTimer = howLong;
	}

	private void Update()
	{
	}

	public static void checkElements()
	{
		if (Config.hasPremium)
		{
			if ((Object)(object)instance.premiumButtonCorner != (Object)null)
			{
				instance.premiumButtonCorner.SetActive(false);
			}
			if ((Object)(object)instance.adsButton != (Object)null)
			{
				instance.adsButton.SetActive(false);
			}
		}
		else if ((Object)(object)instance.premiumButtonCorner != (Object)null)
		{
			instance.premiumButtonCorner.SetActive(true);
		}
		foreach (PowerButton power_button in PowerButton.power_buttons)
		{
			power_button.checkLockIcon();
		}
	}

	public static void toggleActive(bool pState)
	{
		if ((Object)(object)instance.premiumButtonCorner != (Object)null)
		{
			instance.premiumButtonCorner.SetActive(pState);
		}
		if ((Object)(object)instance.adsButton != (Object)null)
		{
			instance.adsButton.SetActive(pState);
		}
	}
}
// --- End of File: PremiumElementsChecker.cs ---



// --- Start of File: PremiumUnlockAnimation.cs ---
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Plugins.Options;
using UnityEngine;

public class PremiumUnlockAnimation : MonoBehaviour
{
	public float time;

	public GameObject circleFX;

	public GameObject shineFX;

	public GameObject aye;

	private CanvasGroup canvasGroup;

	public float fadeDelay;

	private int index;

	public Vector3 scaleAdd;

	public static float scaleTime = 1f;

	public static float delayTime = 0.5f;

	private void Awake()
	{
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		aye.transform.localScale = new Vector3(1f, 0f, 1f);
	}

	private void Start()
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		canvasGroup = shineFX.GetComponent<CanvasGroup>();
		circleFX.SetActive(true);
		TweenSettingsExtensions.SetLoops<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(circleFX.transform, Vector3.one, scaleTime), -1, (LoopType)1);
		TweenSettingsExtensions.SetDelay<TweenerCore<Vector3, Vector3, VectorOptions>>(TweenSettingsExtensions.SetEase<TweenerCore<Vector3, Vector3, VectorOptions>>(ShortcutExtensions.DOScale(aye.transform, Vector3.one, scaleTime), (Ease)24), delayTime);
	}

	private void Update()
	{
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		CanvasGroup obj = canvasGroup;
		obj.alpha += Time.deltaTime / fadeDelay;
		shineFX.transform.Rotate(new Vector3(0f, 0f, 1f));
	}

	public void clickClose()
	{
		circleFX.gameObject.SetActive(false);
		shineFX.gameObject.SetActive(false);
	}
}
// --- End of File: PremiumUnlockAnimation.cs ---



// --- Start of File: PremiumWindow.cs ---
using System.Collections.Generic;
using UnityEngine;

public class PremiumWindow : MonoBehaviour
{
	public Transform buttons_transform;

	public void Awake()
	{
		clearButtons();
		addButtons();
	}

	private void addButtons()
	{
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		Dictionary<string, PowerButton> dictionary = new Dictionary<string, PowerButton>();
		foreach (PowerButton premium_button in GodPower.premium_buttons)
		{
			dictionary.TryAdd(premium_button.godPower.id, premium_button);
		}
		foreach (PowerButton value in dictionary.Values)
		{
			((Component)value).gameObject.SetActive(false);
			PowerButton powerButton = Object.Instantiate<PowerButton>(value, buttons_transform);
			((Object)((Component)powerButton).transform).name = ((Object)((Component)value).transform).name;
			powerButton.type = PowerButtonType.Shop;
			powerButton.destroyLockIcon();
			((Component)powerButton).GetComponent<RectTransform>().pivot = ((Component)value).GetComponent<RectTransform>().pivot;
			IconRotationAnimation iconRotationAnimation = ((Component)powerButton).gameObject.AddComponent<IconRotationAnimation>();
			iconRotationAnimation.delay = Randy.randomFloat(1f, 10f);
			iconRotationAnimation.randomDelay = true;
			((Component)value).gameObject.SetActive(true);
			((Component)powerButton).gameObject.SetActive(true);
		}
	}

	private void clearButtons()
	{
		while (buttons_transform.childCount > 0)
		{
			GameObject gameObject = ((Component)buttons_transform.GetChild(0)).gameObject;
			gameObject.transform.SetParent((Transform)null);
			Object.Destroy((Object)(object)gameObject);
		}
	}
}
// --- End of File: PremiumWindow.cs ---



// --- Start of File: PreviewHelper.cs ---
using System.IO;
using UnityEngine;

public static class PreviewHelper
{
	public static Sprite loadWorkshopMapPreview()
	{
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Expected O, but got Unknown
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		string text = SaveManager.generatePngPreviewPath(SaveManager.currentWorkshopMapData.main_path);
		if (string.IsNullOrEmpty(text) || !File.Exists(text))
		{
			return null;
		}
		byte[] array = File.ReadAllBytes(text);
		Texture2D val = new Texture2D(64, 64);
		if (ImageConversion.LoadImage(val, array))
		{
			return Sprite.Create(val, new Rect(0f, 0f, (float)((Texture)val).width, (float)((Texture)val).height), new Vector2(0.5f, 0.5f));
		}
		return null;
	}

	public static Sprite getCurrentWorldPreview()
	{
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		World.world.redrawMiniMap(pForce: true);
		Texture2D val = Toolbox.ScaleTexture(World.world.world_layer.texture, 512, 512);
		return Sprite.Create(val, new Rect(0f, 0f, (float)((Texture)val).width, (float)((Texture)val).height), new Vector2(0f, 0f));
	}

	public static Texture2D convertMapToTexture()
	{
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Expected O, but got Unknown
		Texture2D texture = World.world.world_layer.texture;
		Texture2D val = new Texture2D(((Texture)texture).width, ((Texture)texture).height);
		Color32[] pixels = texture.GetPixels32();
		val.SetPixels32(pixels);
		val.Apply();
		return val;
	}

	public static int getMaxAdSlots()
	{
		int num = 1;
		if (World.world.game_stats.data.gameLaunches > 10 && World.world.game_stats.data.gameTime > 36000.0)
		{
			num = 3;
		}
		if (World.world.game_stats.data.gameLaunches > 30 && World.world.game_stats.data.gameTime > 72000.0)
		{
			num = 6;
		}
		for (int i = num + 1; i <= 6; i++)
		{
			if (SaveManager.slotExists(i))
			{
				return 6;
			}
		}
		return num;
	}
}
// --- End of File: PreviewHelper.cs ---



// --- Start of File: PreviewUploader.cs ---
using System;
using System.IO;
using RSG;

public static class PreviewUploader
{
	public static Promise<string> uploadImagePreview()
	{
		string text = DateTime.UtcNow.ToString("yyyyMMdd");
		return S3Manager.instance.uploadFileToAWS3("png/" + text.ToString() + "/" + Auth.userId + "_" + Guid.NewGuid().ToString() + ".png", getImagePreview());
	}

	private static byte[] getImagePreview()
	{
		return File.ReadAllBytes(SaveManager.getPngSlotPath());
	}
}
// --- End of File: PreviewUploader.cs ---



// --- Start of File: PrintLibrary.cs ---
using System.Collections.Generic;
using UnityEngine;

public class PrintLibrary : MonoBehaviour
{
	private readonly Color _color_0 = Toolbox.makeColor("#FFFFFF");

	private readonly Color _color_1 = Toolbox.makeColor("#CCCCCC");

	private readonly Color _color_2 = Toolbox.makeColor("#7F7F7F");

	private readonly Color _color_3 = Toolbox.makeColor("#000000");

	public List<PrintTemplate> list;

	private readonly Dictionary<string, PrintTemplate> _dict = new Dictionary<string, PrintTemplate>();

	private readonly List<PrintTemplate> _list_quakes = new List<PrintTemplate>();

	private static PrintLibrary _instance;

	private void Awake()
	{
		_instance = this;
		for (int i = 0; i < list.Count; i++)
		{
			PrintTemplate printTemplate = list[i];
			calcSteps(printTemplate);
			_dict.Add(printTemplate.name, printTemplate);
			if (printTemplate.name.Contains("quake"))
			{
				_list_quakes.Add(printTemplate);
				addRotatedQuake(printTemplate, 90);
				addRotatedQuake(printTemplate, 180);
				addRotatedQuake(printTemplate, 360);
				addRotatedQuake(printTemplate, -360);
				addRotatedQuake(printTemplate, -90);
				addRotatedQuake(printTemplate, -180);
				addRotatedQuake(printTemplate, -270);
			}
		}
	}

	private void addRotatedQuake(PrintTemplate pOrigin, int pRotation)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		PrintTemplate printTemplate = new PrintTemplate();
		printTemplate.name = pOrigin.name + "_" + pRotation;
		Texture2D originTexture = Object.Instantiate<Texture2D>(pOrigin.graphics);
		printTemplate.graphics = TextureRotator.Rotate(originTexture, pRotation, new Color32((byte)0, (byte)0, (byte)0, (byte)0));
		calcSteps(printTemplate);
		_list_quakes.Add(printTemplate);
	}

	private void calcSteps(PrintTemplate pPrint)
	{
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		List<PrintStep> list = new List<PrintStep>();
		int width = ((Texture)pPrint.graphics).width;
		int height = ((Texture)pPrint.graphics).height;
		for (int i = 1; i < width - 1; i++)
		{
			for (int j = 1; j < height - 1; j++)
			{
				Color pixel = pPrint.graphics.GetPixel(i, j);
				if (!(pixel == _color_0))
				{
					PrintStep printStep = default(PrintStep);
					printStep.x = i - 1 - width / 2;
					printStep.y = j - 1 - height / 2;
					printStep.action = 1;
					PrintStep item = printStep;
					list.Add(item);
					if (pixel == _color_2)
					{
						list.Add(item);
					}
					else if (pixel == _color_3)
					{
						list.Add(item);
						list.Add(item);
					}
				}
			}
		}
		pPrint.steps = list.ToArray();
		pPrint.steps_per_tick = (int)((float)pPrint.steps.Length * 0.005f + 1f);
	}

	public static PrintTemplate getTemplate(string pTemplateID)
	{
		return _instance._dict[pTemplateID];
	}

	public static List<PrintTemplate> getQuakes()
	{
		return _instance._list_quakes;
	}
}
// --- End of File: PrintLibrary.cs ---



// --- Start of File: PrintStep.cs ---
public struct PrintStep
{
	public int x;

	public int y;

	public int action;
}
// --- End of File: PrintStep.cs ---



// --- Start of File: PrintTemplate.cs ---
using System;
using UnityEngine;

[Serializable]
public class PrintTemplate
{
	public string name;

	public Texture2D graphics;

	internal PrintStep[] steps;

	internal int steps_per_tick = 1;
}
// --- End of File: PrintTemplate.cs ---



// --- Start of File: ProfessionAsset.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class ProfessionAsset : Asset
{
	public UnitProfession profession_id;

	public bool can_capture;

	public bool is_civilian;

	public bool cancel_when_no_city;

	public List<string> decision_ids;

	[NonSerialized]
	public DecisionAsset[] decisions_assets;

	public bool hasDecisions()
	{
		return decision_ids != null;
	}

	public bool hasDecision(string pID)
	{
		return decision_ids.Contains(pID);
	}

	public void linkDecisions()
	{
		if (decision_ids != null)
		{
			decisions_assets = new DecisionAsset[decision_ids.Count];
			for (int i = 0; i < decision_ids.Count; i++)
			{
				string pID = decision_ids[i];
				DecisionAsset decisionAsset = AssetManager.decisions_library.get(pID);
				decisions_assets[i] = decisionAsset;
			}
		}
	}

	public void addDecision(string pID)
	{
		if (decision_ids == null)
		{
			decision_ids = new List<string>();
		}
		decision_ids.Add(pID);
	}
}
// --- End of File: ProfessionAsset.cs ---



// --- Start of File: ProfessionLibrary.cs ---
using System;
using System.Collections.Generic;

[Serializable]
public class ProfessionLibrary : AssetLibrary<ProfessionAsset>
{
	public static readonly UnitProfession[] list_enum_profession_ids = (UnitProfession[])Enum.GetValues(typeof(UnitProfession));

	private Dictionary<UnitProfession, ProfessionAsset> _dict_profession_id = new Dictionary<UnitProfession, ProfessionAsset>();

	public override void init()
	{
		base.init();
		add(new ProfessionAsset
		{
			id = "nothing",
			profession_id = UnitProfession.Nothing
		});
		add(new ProfessionAsset
		{
			id = "unit",
			profession_id = UnitProfession.Unit,
			is_civilian = true
		});
		add(new ProfessionAsset
		{
			id = "warrior",
			profession_id = UnitProfession.Warrior,
			can_capture = true,
			cancel_when_no_city = true
		});
		t.addDecision("warrior_try_join_army_group");
		t.addDecision("check_warrior_limit");
		t.addDecision("city_walking_to_danger_zone");
		t.addDecision("warrior_army_captain_idle_walking_city");
		t.addDecision("warrior_army_captain_waiting");
		t.addDecision("warrior_army_leader_move_random");
		t.addDecision("warrior_army_leader_move_to_attack_target");
		t.addDecision("warrior_army_follow_leader");
		t.addDecision("warrior_random_move");
		t.addDecision("check_warrior_transport");
		t.addDecision("warrior_train_with_dummy");
		add(new ProfessionAsset
		{
			id = "king",
			profession_id = UnitProfession.King,
			can_capture = true
		});
		t.addDecision("king_check_new_city_foundation");
		t.addDecision("king_change_kingdom_language");
		t.addDecision("king_change_kingdom_culture");
		t.addDecision("king_change_kingdom_religion");
		t.addDecision("claim_land");
		add(new ProfessionAsset
		{
			id = "leader",
			profession_id = UnitProfession.Leader,
			can_capture = true
		});
		t.addDecision("leader_change_city_language");
		t.addDecision("leader_change_city_culture");
		t.addDecision("leader_change_city_religion");
		t.addDecision("claim_land");
	}

	public override void linkAssets()
	{
		base.linkAssets();
		linkDecisions();
	}

	private void linkDecisions()
	{
		foreach (ProfessionAsset item in list)
		{
			item.linkDecisions();
		}
	}

	public override ProfessionAsset add(ProfessionAsset pAsset)
	{
		_dict_profession_id.Add(pAsset.profession_id, pAsset);
		return base.add(pAsset);
	}

	public virtual ProfessionAsset get(UnitProfession pID)
	{
		return _dict_profession_id[pID];
	}
}
// --- End of File: ProfessionLibrary.cs ---



// --- Start of File: Projectile.cs ---
using System;
using System.Runtime.CompilerServices;
using UnityEngine;

public class Projectile : CoreSystemObject<ProjectileData>
{
	internal readonly BaseStats stats = new BaseStats();

	private BaseSimObject by_who;

	private BaseSimObject _main_target;

	private long _main_target_id;

	internal Kingdom kingdom;

	private Action _kill_action;

	public ProjectileAsset asset;

	private Vector2 _vector_start;

	private Vector2 _vector_target;

	private float _current_scale;

	private float _target_scale;

	private bool _is_target_reached;

	private Vector3 _current_position_3d;

	private float _angle_horizontal;

	private float _angle_vertical;

	private float _timer_smoke;

	private float _dead_alpha;

	private ProjectileState _state;

	private float _collision_timeout;

	private Vector3 _velocity;

	public Quaternion rotation;

	private float _speed;

	public override BaseSystemManager manager => World.world.projectiles;

	protected sealed override void setDefaultValues()
	{
		base.setDefaultValues();
		_current_scale = 0f;
		_target_scale = 0f;
		_is_target_reached = false;
		_angle_horizontal = 0f;
		_angle_vertical = 0f;
		_timer_smoke = 0f;
		_dead_alpha = 1f;
		_state = ProjectileState.Active;
		_collision_timeout = 0f;
		_speed = 0f;
	}

	public Vector2 getStartVector()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		return _vector_start;
	}

	public Vector2 getTargetVector()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		return _vector_target;
	}

	public void start(BaseSimObject pInitiator, BaseSimObject pTargetObject, Vector3 pLaunchPosition, Vector3 pTargetPosition, string pAssetID, float pTargetPosZ = 0f, float pStartZ = 0.25f, float pForce = 0f, Action pKillAction = null, Kingdom pForcedKingdom = null)
	{
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_014c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0152: Unknown result type (might be due to invalid IL or missing references)
		_kill_action = pKillAction;
		by_who = pInitiator;
		_main_target = pTargetObject;
		if (_main_target != null)
		{
			_main_target_id = _main_target.id;
		}
		if (by_who != null)
		{
			setStats(pInitiator.stats);
			kingdom = by_who.kingdom;
		}
		if (pForcedKingdom != null)
		{
			kingdom = pForcedKingdom;
		}
		asset = AssetManager.projectiles.get(pAssetID);
		_speed = asset.speed + Randy.randomFloat(0f, asset.speed_random);
		if (pForce != 0f)
		{
			_speed = pForce;
		}
		Vector3 val = default(Vector3);
		((Vector3)(ref val))._002Ector(pLaunchPosition.x, pLaunchPosition.y, 0f);
		val.z = pStartZ;
		_current_position_3d = val;
		calculateAngles(pLaunchPosition, pTargetPosition, val.z, pTargetPosZ);
		calculateVelocities();
		if (asset.frames == null || asset.frames.Length == 0)
		{
			asset.frames = SpriteTextureLoader.getSpriteList("effects/projectiles/" + asset.texture);
		}
		if (asset.sound_launch != string.Empty)
		{
			MusicBox.playSound(asset.sound_launch, pLaunchPosition.x, pLaunchPosition.y, pGameViewOnly: true);
		}
		_current_scale = asset.scale_start;
		_target_scale = asset.scale_target;
		_is_target_reached = false;
		_dead_alpha = 1f;
		setState(ProjectileState.Active);
	}

	private void calculateAngles(Vector3 pStart, Vector3 pTarget, float pStartZ, float pTargetZ)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		_vector_start = Vector2.op_Implicit(pStart);
		_vector_target = Vector2.op_Implicit(pTarget);
		_angle_horizontal = getHorizontalLaunchAngle(pStart, pTarget);
		_angle_vertical = getVerticalLaunchAngle(pStart, pTarget, _speed, pStartZ, pTargetZ);
	}

	private void calculateVelocities()
	{
		float num = _speed / asset.mass;
		_velocity.x = num * Mathf.Cos(_angle_vertical) * Mathf.Cos(_angle_horizontal);
		_velocity.y = num * Mathf.Cos(_angle_vertical) * Mathf.Sin(_angle_horizontal);
		_velocity.z = num * Mathf.Sin(_angle_vertical);
	}

	private float getVerticalLaunchAngle(Vector3 pStart, Vector3 pTarget, float pForce, float pStartHeight, float pTargetHeight)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		float gravity = SimGlobals.m.gravity;
		float num = Toolbox.DistVec3(pStart, pTarget);
		float num2 = pTargetHeight - pStartHeight;
		float num3 = pForce / asset.mass;
		float num4 = num3 * num3;
		float num5 = Mathf.Pow(num3, 4f);
		float num6 = gravity * (gravity * num * num + 2f * num2 * num4);
		if (num6 > num5)
		{
			return MathF.PI / 4f;
		}
		float num7 = Mathf.Sqrt(num5 - num6);
		float num8 = Mathf.Atan((num4 + num7) / (SimGlobals.m.gravity * num));
		float num9 = Mathf.Atan((num4 - num7) / (SimGlobals.m.gravity * num));
		float num10 = 2f * num3 * Mathf.Sin(num8) / gravity;
		float num11 = 2f * num3 * Mathf.Sin(num9) / gravity;
		if (asset.use_min_angle_height)
		{
			return (num10 < num11) ? num8 : num9;
		}
		if (num8 > num9)
		{
			return num8;
		}
		return num9;
	}

	private float getHorizontalLaunchAngle(Vector3 pStart, Vector3 pTarget)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		return Mathf.Atan2(pTarget.y - pStart.y, pTarget.x - pStart.x);
	}

	private void updateVelocity(float pElapsed)
	{
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0116: Unknown result type (might be due to invalid IL or missing references)
		//IL_011b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		_velocity.z -= SimGlobals.m.gravity * pElapsed;
		Vector3 current_position_3d = _current_position_3d + _velocity * pElapsed;
		_current_position_3d = current_position_3d;
		float num = Mathf.Atan2(_velocity.y + _velocity.z, _velocity.x) * 57.29578f;
		rotation = Quaternion.AngleAxis(num, Vector3.forward);
		if (_current_position_3d.z <= 0f)
		{
			((Vector3)(ref _velocity)).Set(0f, 0f, 0f);
			_current_position_3d.z = 0f;
		}
		if (_collision_timeout != 0f && _current_position_3d.z != 0f)
		{
			return;
		}
		AttackDataResult pDataResult = checkHitOnNearbyUnits();
		switch (pDataResult.state)
		{
		case ApplyAttackState.Deflect:
			getDeflected(Vector2.op_Implicit(_vector_start), pDataResult);
			return;
		case ApplyAttackState.Block:
			getCollided(Vector2.op_Implicit(_vector_target));
			return;
		case ApplyAttackState.Hit:
			setState(ProjectileState.ToRemove);
			_kill_action?.Invoke();
			targetReached();
			return;
		case ApplyAttackState.Continue:
			return;
		}
		EffectsLibrary.spawnAt("fx_miss", _current_position_3d, 0.1f);
		if (asset.can_be_left_on_ground)
		{
			setState(ProjectileState.AlphaAnimation);
		}
		else
		{
			setState(ProjectileState.ToRemove);
		}
		targetReached();
	}

	private bool isOnGround()
	{
		return _current_position_3d.z <= 0f;
	}

	private AttackDataResult checkHitOnNearbyUnits()
	{
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		if (_is_target_reached)
		{
			return AttackDataResult.Continue;
		}
		WorldTile tile = World.world.GetTile((int)_current_position_3d.x, (int)_current_position_3d.y);
		if (tile == null)
		{
			if (isOnGround())
			{
				return AttackDataResult.Miss;
			}
			return AttackDataResult.Continue;
		}
		if (by_who.isRekt())
		{
			return AttackDataResult.Miss;
		}
		EnemyFinderData enemyFinderData = EnemiesFinder.findEnemiesFrom(tile, kingdom);
		bool num = isMainTargetStillValid();
		if (!num)
		{
			_main_target = null;
			_main_target_id = -1L;
		}
		if (num && !enemyFinderData.list.Contains(_main_target))
		{
			enemyFinderData.list.Add(_main_target);
		}
		if (enemyFinderData.isEmpty())
		{
			if (isOnGround())
			{
				return AttackDataResult.Miss;
			}
			return AttackDataResult.Continue;
		}
		Vector3 val = Vector2.op_Implicit(by_who.current_position);
		BaseSimObject pInitiator = by_who;
		Kingdom pKingdom = kingdom;
		Vector3 pInitiatorPosition = val;
		AttackData pData = new AttackData(pInitiator, tile, _current_position_3d, pInitiatorPosition, null, pKingdom, AttackType.Weapon, pMetallicWeapon: false, pSkipShake: false, pProjectile: true, asset.id);
		if (isOnGround())
		{
			AttackDataResult result = MapBox.newAttack(pData);
			if (result.state == ApplyAttackState.Continue)
			{
				result.state = ApplyAttackState.Miss;
			}
			return result;
		}
		foreach (BaseSimObject item in enemyFinderData.list.LoopRandom())
		{
			AttackDataResult result2 = checkHitForUnit(item, pData);
			ApplyAttackState state = result2.state;
			if (state == ApplyAttackState.Hit || (uint)(state - 2) <= 1u)
			{
				return result2;
			}
		}
		return AttackDataResult.Continue;
	}

	private bool isMainTargetStillValid()
	{
		if (_main_target.isRekt())
		{
			return false;
		}
		if (_main_target.id != _main_target_id)
		{
			return false;
		}
		return true;
	}

	private AttackDataResult checkHitForUnit(BaseSimObject pObject, AttackData pData)
	{
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		if (pObject == null)
		{
			return AttackDataResult.Continue;
		}
		if (!pObject.isAlive())
		{
			return AttackDataResult.Continue;
		}
		float z = _current_position_3d.z;
		float height = pObject.getHeight();
		if (Mathf.Abs(z - height) > 3f)
		{
			return AttackDataResult.Continue;
		}
		Vector3 val = Vector2.op_Implicit(pObject.current_position);
		Vector3 current_position_3d = _current_position_3d;
		float num = Toolbox.Dist(current_position_3d.x, current_position_3d.y + current_position_3d.z, val.x, val.y + pObject.getHeight());
		float num2 = asset.size + pObject.stats["size"];
		if (num > num2)
		{
			return AttackDataResult.Continue;
		}
		return MapBox.checkAttackFor(pData, pObject);
	}

	public void setStats(BaseStats pStats)
	{
		stats.clear();
		stats.mergeStats(pStats);
	}

	public float getLaunchAngle()
	{
		return Mathf.Atan2(_velocity.y + _velocity.z, _velocity.x) * 57.29578f;
	}

	private void updateScaleEffect(float pElapsed)
	{
		if (_current_scale < _target_scale)
		{
			_current_scale += pElapsed * 0.2f;
			if (_current_scale > _target_scale)
			{
				_current_scale = _target_scale;
			}
		}
	}

	private void updateTrailEffect(float pElapsed)
	{
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		if (!asset.trail_effect_enabled)
		{
			return;
		}
		if (_timer_smoke > 0f)
		{
			_timer_smoke -= pElapsed;
			return;
		}
		Vector3 pPos = default(Vector3);
		((Vector3)(ref pPos))._002Ector(_current_position_3d.x, _current_position_3d.y + _current_position_3d.z, 0f);
		BaseEffect baseEffect = EffectsLibrary.spawnAt(asset.trail_effect_id, pPos, asset.trail_effect_scale);
		if (asset.look_at_target && (Object)(object)baseEffect != (Object)null)
		{
			((Component)baseEffect).transform.rotation = rotation;
		}
		_timer_smoke = asset.trail_effect_timer;
	}

	public void update(float pElapsed)
	{
		if (_collision_timeout > 0f)
		{
			_collision_timeout -= pElapsed;
			if (_collision_timeout < 0f)
			{
				_collision_timeout = 0f;
			}
		}
		switch (_state)
		{
		case ProjectileState.Active:
			updateVelocity(pElapsed);
			break;
		case ProjectileState.AlphaAnimation:
			updateDeadAnimation(pElapsed);
			break;
		}
		updateScaleEffect(pElapsed);
		updateTrailEffect(pElapsed);
		updateLightEffect(pElapsed);
	}

	private void updateLightEffect(float pElapsed)
	{
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		if (asset.draw_light_area)
		{
			Vector2 position = default(Vector2);
			((Vector2)(ref position))._002Ector(_current_position_3d.x, _current_position_3d.y + _current_position_3d.z);
			position.x += asset.draw_light_area_offset_x;
			position.y += asset.draw_light_area_offset_y;
			World.world.stack_effects.light_blobs.Add(new LightBlobData
			{
				position = position,
				radius = asset.draw_light_size
			});
		}
	}

	private void updateDeadAnimation(float pElapsed)
	{
		_dead_alpha -= pElapsed * 0.5f;
		if (_dead_alpha < 0f)
		{
			setState(ProjectileState.ToRemove);
		}
	}

	private void targetReached()
	{
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		_is_target_reached = true;
		WorldTile worldTile = getCurrentTilePosition();
		if (worldTile == null)
		{
			worldTile = World.world.GetTile((int)_vector_target.x, (int)_vector_target.y);
		}
		if (asset.impact_actions != null && worldTile != null && !asset.impact_actions(by_who, null, worldTile))
		{
			reset();
			return;
		}
		Vector2 transformedPositionWithHeight = getTransformedPositionWithHeight();
		if (!string.IsNullOrEmpty(asset.end_effect))
		{
			EffectsLibrary.spawnAt(asset.end_effect, transformedPositionWithHeight, asset.end_effect_scale);
		}
		if (asset.sound_impact != string.Empty)
		{
			MusicBox.playSound(asset.sound_impact, transformedPositionWithHeight.x, transformedPositionWithHeight.y, pGameViewOnly: true);
		}
		if (worldTile != null)
		{
			if (asset.world_actions != null)
			{
				asset.world_actions(by_who, null, worldTile);
			}
			if (asset.hit_freeze)
			{
				worldTile.freeze();
				for (int i = 0; i < worldTile.neighbours.Length; i++)
				{
					WorldTile worldTile2 = worldTile.neighbours[i];
					if (Randy.randomBool())
					{
						worldTile2.freeze();
					}
				}
			}
			if (asset.hit_shake && worldTile.zone.visible && MapBox.isRenderGameplay())
			{
				World.world.startShake(asset.shake_duration, asset.shake_interval, asset.shake_intensity, asset.shake_x, asset.shake_y);
			}
			if (asset.terraform_option != string.Empty)
			{
				MapAction.damageWorld(worldTile, asset.terraform_range, AssetManager.terraform.get(asset.terraform_option), by_who);
			}
		}
		reset();
	}

	public void getDeflected(Vector3 pPos, AttackDataResult pDataResult)
	{
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		BaseSimObject pInitiator = World.world.units.get(pDataResult.deflected_by_who_id);
		Vector3 pLaunchPosition = Vector2.op_Implicit(getCurrentPosition());
		Vector3 pTargetPosition = Vector2.op_Implicit(_vector_start);
		start(pInitiator, null, pLaunchPosition, pTargetPosition, asset.id, getCurrentHeight(), getCurrentHeight(), _speed);
	}

	public void getCollided(Vector3 pPos)
	{
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		if (asset.trigger_on_collision)
		{
			targetReached();
			setState(ProjectileState.ToRemove);
			return;
		}
		_collision_timeout = 1f;
		Vector3 val = Vector2.op_Implicit(getCurrentPosition());
		Vector3 newPoint = Toolbox.getNewPoint(val.x, val.y, pPos.x, pPos.y, 6f);
		start(by_who, null, val, newPoint, asset.id, getCurrentHeight() + 5f, getCurrentHeight(), _speed * 0.2f);
	}

	private void setState(ProjectileState pState)
	{
		_state = pState;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isTargetReached()
	{
		return _is_target_reached;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public float getCurrentHeight()
	{
		return _current_position_3d.z;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public Vector2 getCurrentPosition()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.op_Implicit(_current_position_3d);
	}

	private WorldTile getCurrentTilePosition()
	{
		return World.world.GetTile((int)_current_position_3d.x, (int)_current_position_3d.y);
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public Vector2 getTransformedPositionWithHeight()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		Vector2 result = Vector2.op_Implicit(_current_position_3d);
		result.y += getCurrentHeight();
		return result;
	}

	public float getCurrentScale()
	{
		return _current_scale;
	}

	public float getAngleForShadow()
	{
		return Toolbox.getAngleDegrees(_current_position_3d.x, _current_position_3d.y, _vector_target.x, _vector_target.y);
	}

	public override void setAlive(bool pValue)
	{
		_alive = pValue;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool isFinished()
	{
		return _state == ProjectileState.ToRemove;
	}

	public bool isDeadAnimation()
	{
		return _state == ProjectileState.AlphaAnimation;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public bool canBeCollided()
	{
		if (!asset.can_be_collided)
		{
			return false;
		}
		if (isFinished())
		{
			return false;
		}
		if (isTargetReached())
		{
			return false;
		}
		if (_collision_timeout > 0f)
		{
			return false;
		}
		return true;
	}

	public float getAlpha()
	{
		return _dead_alpha;
	}

	private void reset()
	{
		_kill_action = null;
		_collision_timeout = 0f;
		by_who = null;
		_main_target = null;
		_main_target_id = -1L;
		kingdom = null;
		stats.clear();
	}

	public override void Dispose()
	{
		reset();
		asset = null;
		stats.reset();
		base.Dispose();
	}
}
// --- End of File: Projectile.cs ---



=== END OF SOURCE 2 ===

